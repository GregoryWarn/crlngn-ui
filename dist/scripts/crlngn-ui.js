var bs=Object.defineProperty;var Mo=i=>{throw TypeError(i)};var Cs=(i,e,t)=>e in i?bs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var w=(i,e,t)=>Cs(i,typeof e!="symbol"?e+"":e,t),zn=(i,e,t)=>e.has(i)||Mo("Cannot "+t);var p=(i,e,t)=>(zn(i,e,"read from private field"),t?t.call(i):e.get(i)),T=(i,e,t)=>e.has(i)?Mo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),A=(i,e,t,n)=>(zn(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),F=(i,e,t)=>(zn(i,e,"access private method"),t);const U={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},Se="crlngn-ui",pn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Rn=class Rn{static log(e="",t=[],n=!1){try{const o=Rn.debugOn;if(!(n||o))return;console.log(...pn,e,...t)}catch{console.log(...pn,e,...t)}}static warn(e="",t=[]){console.warn(...pn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...pn,e)}};w(Rn,"debugOn",!1);let g=Rn;const M={select:"select",checkbox:"checkbox",text:"text",number:"number"},I={client:"client",world:"world"},tt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Yn={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},Tt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},nt={noButton:{name:"noButton"},lastScene:{name:"lastScene"},defaultScenes:{name:"defaultScenes"}},gt={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},Do=140,qe=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function E(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:M.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:I.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:I.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:M.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:Tt.playerColor.name},scope:I.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:M.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide"],default:{bottomBuffer:200,iconSize:tt.small.name,autoHideSecondary:!1},scope:I.client,config:!1,requiresReload:!1},playersListMenu:{tag:"players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,inputType:M.button,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:I.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:M.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth","dockWasResized"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:gt.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140,dockWasResized:!1},scope:I.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:M.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navShowRootFolders","sceneClickToView","useSceneIcons","sceneNavAlias","navStartCollapsed","showNavOnHover","useNavBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,sceneNavAlias:"",showFolderListOnClick:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useNavBackButton:nt.lastScene.name},scope:I.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:I.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:M.select,propType:String,default:Yn.small.name,scope:I.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.world,config:!1},useNavBackButton:{tag:"use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.hint"),propType:String,inputType:M.select,options:{noButton:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.noButton"),lastScene:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.lastScene"),defaultScenes:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.defaultScenes")},default:nt.lastScene.name,scope:I.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:M.text,default:"",scope:I.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:M.number,default:0,scope:I.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.world,config:!0},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:I.client,config:!1},playerListAvatars:{tag:"player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:I.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:I.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:I.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:I.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:M.text,propType:String,default:"",scope:I.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:I.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:M.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:I.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:M.text,propType:String,default:"",scope:I.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:M.text,default:Tt.playerColor.name,scope:I.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:I.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:M.number,default:200,scope:I.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:M.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:tt.small.name,scope:I.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:I.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:M.checkbox,propType:Boolean,default:!0,scope:I.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:M.number,propType:Number,default:0,scope:I.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:M.number,propType:Number,default:120,scope:I.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:M.number,propType:Number,default:160,scope:I.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:M.number,propType:Number,default:145,scope:I.client,config:!1},dockWasResized:{tag:"dock-was-resized",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:I.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:M.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:gt.off.name,scope:I.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:M.number,propType:Number,default:160,scope:I.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:I.world,config:!1,default:""}}}const{ApplicationV2:Ns,HandlebarsApplicationMixin:Es}=foundry.applications.api;var mo,kt,qo,Ho;const Ee=class Ee extends Es(Ns){static get DEFAULT_OPTIONS(){return{id:E().playersListMenu.tag,actions:{redefine:F(Ee,kt,Ho)},form:{handler:F(Ee,kt,qo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=E(),n=t.playersListMenu.fields,o={},s={},a={};n.forEach(l=>{if(t[l]){const c=L.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,a[l]=t[l].default}}),g.log("_prepareContext A",[o,n,s,a]);const r={...s,default:{...a},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E();Ee.element=this.element,Ee.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ee.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=L.get(n.playersListMenu.tag);g.log("_onRender",[e,t,s])}};mo=new WeakMap,kt=new WeakSet,qo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.playersListMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),L.set(o[r].tag,a[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ho=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),a=n.playersListMenu.default;s.forEach(r=>{r.value=a[r.name],r.type==="checkbox"&&(r.checked=a[r.name])}),g.log("#onReset",[e,t,n.playersListMenu.default])},T(Ee,kt),T(Ee,mo),w(Ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Xn=Ee;const{ApplicationV2:Ls,HandlebarsApplicationMixin:Ts}=foundry.applications.api;var Rt,Vo,Wo,Xt,Kn;const Le=class Le extends Ts(Ls){constructor(){super(...arguments);T(this,Xt)}static get DEFAULT_OPTIONS(){return{id:E().cameraDockMenu.tag,actions:{redefine:F(Le,Rt,Wo)},form:{handler:F(Le,Rt,Vo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=E(),o=n.cameraDockMenu.fields,s={},a={},r={};o.forEach(u=>{if(g.log("_prepareContext",[n[u].oldName]),n[u]){const m=L.get(n[u].tag);s[u]=n[u],a[u]=m!==void 0?m:n[u].default,r[u]=n[u].default}});const l={...a,default:{...r},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var a;g.log("_onRender",[t,n]),Le.element=this.element,Le.element.querySelector(".toggle-hint").addEventListener("click",()=>{Le.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(a=this.element)==null?void 0:a.querySelector('input[name="enableFloatingDock"]');g.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",F(this,Xt,Kn).bind(this)),F(this,Xt,Kn).call(this,{target:s}))}};Rt=new WeakSet,Vo=async function(t,n,o){const s=E();t.preventDefault(),t.stopPropagation();const a=s.cameraDockMenu.fields,r=o.object;a.forEach(m=>{s[m].inputType==="checkbox"&&!r.hasOwnProperty(m)&&(r[m]=!1)});const l=foundry.utils.expandObject(r),c=L.get(s.enableFloatingDock.tag);g.log("Compared settings:",[l.enableFloatingDock,c]),a.forEach(m=>{g.log("Saving setting >>",[s[m].tag,l[m]]),l[m]!==void 0&&L.set(s[m].tag,l[m])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==c&&location.reload()},Wo=async function(t,n){const o=E(),a=this.element.querySelectorAll("input, select"),r=o.cameraDockMenu.fields,l={};r.forEach(c=>{o[c]&&(o[c],l[c]=o[c].default)}),a.forEach(c=>{c.value=l[c.name]}),g.log("#onReset",[t,n,o.cameraDockMenu.default])},Xt=new WeakSet,Kn=function(t){var s,a;const n=(s=this.element)==null?void 0:s.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(r=>r.disabled=!t.target.checked);const o=(a=this.element)==null?void 0:a.querySelectorAll("select");o.forEach(r=>r.disabled=!t.target.checked),g.log("onDockEnabledChange",[this.element,n,o])},T(Le,Rt),w(Le,"element"),w(Le,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Jn=Le;const{ApplicationV2:ws,HandlebarsApplicationMixin:Is}=foundry.applications.api;var yo,Mt,jo,$o;const Te=class Te extends Is(ws){static get DEFAULT_OPTIONS(){return{id:E().chatMessagesMenu.tag,actions:{redefine:F(Te,Mt,$o)},form:{handler:F(Te,Mt,jo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=E(),n=t.chatMessagesMenu.fields,o={},s={},a={};n.forEach(c=>{if(g.log("_prepareContext",[t[c].oldName]),t[c]){const u=L.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,a[c]=t[c].default}}),g.log("_prepareContext",[s,a]);const r={...s,default:{...a},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E();Te.element=this.element,Te.element.querySelector(".toggle-hint").addEventListener("click",()=>{Te.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=L.get(n.chatMessagesMenu.tag);g.log("_onRender",[e,t,s])}};yo=new WeakMap,Mt=new WeakSet,jo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.chatMessagesMenu.fields,a=n.object;s.forEach(u=>{o[u].inputType==="checkbox"&&!a.hasOwnProperty(u)&&(a[u]=!1)});const r=foundry.utils.expandObject(a),l=L.get(o.chatBorderColor.tag);g.log("Compared settings:",[r.chatBorderColor,l]),s.forEach(u=>{g.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&L.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},$o=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),a=n.chatMessagesMenu.fields,r={};a.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},T(Te,Mt),T(Te,yo),w(Te,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Zn=Te;const $t=class $t{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let s=0;s<o.length;s++){const a=o[s];if(a instanceof CSSFontFaceRule){const r=a.style.getPropertyValue("font-family");r&&(t.add(r),g.log("Found font-face rule:",[r]))}else if(a instanceof CSSImportRule){if(g.log("Found import rule:",[a.href]),a.styleSheet)await this.processStyleSheetRules(a.styleSheet,t);else if(a.href)try{const l=await(await fetch(a.href)).text();this.extractFontsFromCSSText(l,t)}catch(r){g.warn("Error fetching imported CSS:",[r])}}}}catch(o){if(o.name==="SecurityError"&&e.href){g.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const a=await(await fetch(e.href)).text();this.extractFontsFromCSSText(a,t)}catch(s){g.warn("Error fetching cross-origin stylesheet:",[s])}}else g.warn("Error accessing CSS rules:",[o])}}catch(o){g.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];g.log("Font face matches in CSS text:",[o.length]),o.forEach(s=>{const a=/font-family\s*:\s*(['"])(.+?)\1/,r=s.match(a);if(r&&r[2]){const l=r[2].trim();t.add(l),g.log("Found font-face in CSS text:",[l])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([a])=>a),o=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(a=>!/FontAwesome|Font Awesome|FoundryVTT/.test(a)).map(a=>a.replace(/['"]/g,"").trim()).sort((a,r)=>a.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const y=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,y.prepend(n)}let o=n.textContent,s=o.indexOf("body.crlngn-ui {"),a=o.indexOf("}",s);s===-1&&(o=`body.crlngn-ui {
}
`,s=0,a=o.indexOf("}"));const l=o.substring(s+16,a).split(";").map(y=>y.trim()).filter(y=>y!==""),c={};l.forEach(y=>{const N=y.split(":");if(N.length>=2){const b=N[0].trim(),S=N.slice(1).join(":").trim();b&&(c[b]=S)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([y,N])=>`  ${y}: ${N};`).join(`
`),m=o.substring(0,s)+`body.crlngn-ui {
`+u+`
}`+o.substring(a+1);n.textContent=m}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}};w($t,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));g.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([a])=>a);g.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const a of document.styleSheets)try{if(a.ownerNode){const r=a.href||"",l=r.includes("css/")||r.includes("styles/"),c=r.includes("modules/crlngn-ui/"),u=r.includes("systems/");if(r&&!l&&!c&&!u){g.log("Skipping stylesheet:",[r]);continue}g.log("Processing stylesheet:",[a,r]),await $t.processStyleSheetRules(a,o)}}catch(r){g.warn("Error processing stylesheet:",[r])}return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(a=>!/FontAwesome|Font Awesome|FoundryVTT/.test(a)).map(a=>a.replace(/['"]/g,"").trim()).sort((a,r)=>a.toLowerCase().localeCompare(r.toLowerCase()))}),w($t,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let G=$t;const{ApplicationV2:ks,HandlebarsApplicationMixin:Rs}=foundry.applications.api;var So,Xe,Yo,Xo,Jo;const re=class re extends Rs(ks){static get DEFAULT_OPTIONS(){return{id:E().customFontsMenu.tag,actions:{redefine:F(re,Xe,Jo)},form:{handler:F(re,Xe,Yo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=E(),n=t.customFontsMenu.fields,o={},s={},a={},r=await G.getAllFonts();return n.forEach(c=>{if(t[c]){const u=L.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,a[c]=t[c].default}}),{...s,default:{...a},fontList:r,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){re.element=this.element,re.element.querySelector(".toggle-hint").addEventListener("click",()=>{re.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))}),re.element.querySelectorAll('input[type="text"]').forEach(a=>{const r=a.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const c=()=>{var u;F(u=re,Xe,Xo).call(u),l.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",u=>{const m=l.classList.contains("active"),y=Array.from(l.querySelectorAll(".dropdown-option"));let N=y.findIndex(b=>b.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),m||l.classList.add("active"),y.forEach(b=>b.classList.remove("highlighted")),N===-1?N=u.key==="ArrowDown"?0:y.length-1:N=u.key==="ArrowDown"?(N+1)%y.length:(N-1+y.length)%y.length,y[N]&&(y[N].classList.add("highlighted"),y[N].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),m&&N!==-1&&y[N]&&y[N].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),re.element.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",r=>{const l=a.closest(".dropdown-wrapper").querySelector("input");let c=a.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,a.closest(".dropdown-options").classList.remove("active")})})}};So=new WeakMap,Xe=new WeakSet,Yo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),L.set(o[r].tag,a[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Xo=function(){re.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Jo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),a=n.customFontsMenu.fields,r={};a.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},T(re,Xe),T(re,So),w(re,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Qn=re;const{ApplicationV2:Ms,HandlebarsApplicationMixin:Ds}=foundry.applications.api;var vo,Dt,Ko,Zo;const we=class we extends Ds(Ms){static get DEFAULT_OPTIONS(){return{id:E().leftControlsMenu.tag,actions:{redefine:F(we,Dt,Zo)},form:{handler:F(we,Dt,Ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=E(),n=t.leftControlsMenu.fields,o={},s={},a={};n.forEach(l=>{if(t[l]){const c=L.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,a[l]=t[l].default}});const r={...s,default:{...a},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E();we.element=this.element,we.element.querySelector(".toggle-hint").addEventListener("click",()=>{we.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=L.get(n.leftControlsMenu.tag);g.log("_onRender",[e,t,s])}};vo=new WeakMap,Dt=new WeakSet,Ko=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.leftControlsMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),L.set(o[r].tag,a[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Zo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),a=n.leftControlsMenu.default;s.forEach(r=>{r.value=a[r.name],r.type==="checkbox"&&(r.checked=a[r.name])}),g.log("#onReset",[e,t,n.leftControlsMenu.default])},T(we,Dt),T(we,vo),w(we,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let _n=we;const{ApplicationV2:Ps,HandlebarsApplicationMixin:As}=foundry.applications.api;var bo,Pt,Qo,_o,Jt,to;const Ie=class Ie extends As(Ps){constructor(){super(...arguments);T(this,Jt)}static get DEFAULT_OPTIONS(){return{id:E().sceneNavMenu.tag,actions:{redefine:F(Ie,Pt,_o)},form:{handler:F(Ie,Pt,Qo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=E(),o=n.sceneNavMenu.fields,s={},a={},r={};o.forEach(c=>{if(n[c]){const u=L.get(n[c].tag);s[c]=n[c],a[c]=u!==void 0?u:n[c].default,r[c]=n[c].default}});const l={...a,default:{...r},fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var a;g.log("_onRender",[t,n]),Ie.element=this.element,Ie.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ie.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(a=this.element)==null?void 0:a.querySelector('input[name="sceneNavEnabled"]');g.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",F(this,Jt,to).bind(this)),F(this,Jt,to).call(this,{target:s}))}};bo=new WeakMap,Pt=new WeakSet,Qo=async function(t,n,o){t.preventDefault(),t.stopPropagation();const s=E(),a=s.sceneNavMenu.fields;let r=L.get(s.sceneNavEnabled.tag),l=L.get(s.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);a.forEach(y=>{c[y]!==void 0&&(g.log("Saving setting:",[c[y]]),L.set(s[y].tag,c[y]))});let u=L.get(s.sceneNavEnabled.tag),m=L.get(s.navFoldersEnabled.tag);g.log("Saving settings...",[r,u]),await L.set(s.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==m)&&location.reload()},_o=async function(t,n){const o=E(),a=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;a.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),g.log("#onReset",[t,n,o.sceneNavMenu.default])},Jt=new WeakSet,to=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(s=>s.disabled=!t.target.checked),g.log("onSceneNavEnabledChange",[this.element,n])},T(Ie,Pt),T(Ie,bo),w(Ie,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let eo=Ie;const{ApplicationV2:Gs,HandlebarsApplicationMixin:Fs}=foundry.applications.api;var Co,No,Je,es,ts,ns;const Z=class Z extends Fs(Gs){static get DEFAULT_OPTIONS(){return{id:E().themeAndStylesMenu.tag,actions:{redefine:F(Z,Je,ns)},form:{handler:F(Z,Je,es),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=E(),n=t.themeAndStylesMenu.fields,o={},s={},a={};n.forEach(c=>{if(t[c]){const u=L.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,a[c]=t[c].default}});const r=qe.find(c=>c.className===s.colorTheme);s.colorTheme=(r==null?void 0:r.label)||qe[0].label;const l={...s,default:{...a},fields:{...o},selectedTheme:r,themes:qe,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...s},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){Z.element=this.element,Z.element.querySelector(".toggle-hint").addEventListener("click",()=>{Z.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=qe,Z.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const m=u.closest(".dropdown-wrapper"),y=m==null?void 0:m.querySelector(".dropdown-options");if(!m||!y)return;const N=()=>{var b;F(b=Z,Je,ts).call(b),y.classList.add("active")};u.addEventListener("focus",N),u.addEventListener("click",N),u.addEventListener("keydown",b=>{const S=y.classList.contains("active"),k=Array.from(y.querySelectorAll(".dropdown-option"));let B=k.findIndex(q=>q.classList.contains("highlighted"));b.key==="ArrowDown"||b.key==="ArrowUp"?(b.preventDefault(),S||y.classList.add("active"),k.forEach(q=>q.classList.remove("highlighted")),B===-1?B=b.key==="ArrowDown"?0:k.length-1:B=b.key==="ArrowDown"?(B+1)%k.length:(B-1+k.length)%k.length,k[B]&&(k[B].classList.add("highlighted"),k[B].scrollIntoView({block:"nearest"}))):b.key==="Enter"?(b.preventDefault(),S&&B!==-1&&k[B]&&k[B].click()):b.key==="Escape"&&y.classList.remove("active")}),document.addEventListener("click",b=>{m.contains(b.target)||y.classList.remove("active")})});const s=Z.element.querySelectorAll(".dropdown-option"),a=this;s.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(y=>y.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(m){g.log("option",[u,u.querySelector(".theme-name")]);const y=u.closest(".dropdown-wrapper").querySelector("input");let N=u.querySelector(".theme-name").innerHTML.toString();if(y.value=N,y.name==="colorTheme"){const S=a._themes.find(k=>k.label===N);a._selectedTheme=S,a._updateThemePreview(S)}u.closest(".dropdown-options").classList.remove("active")})});const r=Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=Z.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",m=>{const y=m.currentTarget;let b=`${l.value}`.split(",")||[],S=b.indexOf(y.value);!m.currentTarget.checked&&S>-1?b.splice(S,1):m.currentTarget.checked&&S===-1&&b.push(y.value),l.value=b.join(","),g.log("checkbox changed",[b,l.value])})}),Z.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(y=>{y.checked=u.currentTarget.checked;const N=new Event("change",{bubbles:!0});y.dispatchEvent(N)})})}_updateThemePreview(e){if(g.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};Co=new WeakMap,No=new WeakMap,Je=new WeakSet,es=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.themeAndStylesMenu.fields,a=foundry.utils.expandObject(n.object),r=qe.find(l=>l.label===a.colorTheme);a.colorTheme=r?r.className:"",s.forEach(l=>{a[l]!==void 0&&(g.log("Saving setting:",[a[l]]),L.set(o[l].tag,a[l]))}),L.set(o.themeAndStylesMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ts=function(){Z.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ns=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),a=n.themeAndStylesMenu.fields,r={};a.forEach(c=>{n[c]&&(n[c],r[c]=n[c].default)});const l=qe.find(c=>c.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||qe[0].label,s.forEach(c=>{c.value=r[c.name]})},T(Z,Je),T(Z,Co),T(Z,No,!1),w(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let no=Z;function Os(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Qn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:no,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Zn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:_n,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:eo,restricted:!1},playersListMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-camera",propType:Xn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Jn,restricted:!1}}}var ot,st,Kt,Zt,Qt,_t,en,Y,oo,zt,so,ao,io,ro;const h=class h{static init(){const e=E();h.currSettings={enableFloatingDock:L.get(e.enableFloatingDock.tag),defaultVideoWidth:L.get(e.defaultVideoWidth.tag),dockHeight:L.get(e.dockHeight.tag),dockWidth:L.get(e.dockWidth.tag),dockPosX:L.get(e.dockPosX.tag),dockPosY:L.get(e.dockPosY.tag),dockWasResized:L.get(e.dockWasResized.tag),dockResizeOnUserJoin:L.get(e.dockResizeOnUserJoin.tag)},h.currSettings.enableFloatingDock?(Hooks.on(U.RENDER_CAMERA_VIEWS,h.onRenderFloating),g.log("CameraUtil settings",[h.currSettings]),h.onRenderFloating()):(Hooks.on(U.RENDER_CAMERA_VIEWS,h.onRenderPlain),h.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,s,a;E();const e=h.currSettings;(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),h.cameraContainer=document.querySelector("#camera-views .camera-container");const t=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");g.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),h.cameraContainer&&n&&t&&((s=h.cameraContainer)==null||s.insertBefore(t,n),(a=document.querySelector("#camera-views .camera-container"))==null||a.classList.add("visible")),h.makeDraggable(),h.makeResizeable(),h.resetPositionAndSize(),h.placeControlsToggle(),h.applyDockResize(),h.applyVideoWidth()}static applyDockResize(e){var n,o,s,a,r,l;const t=e||h.currSettings.dockResizeOnUserJoin;t===gt.horizontal.name?((n=document.querySelector("#camera-views"))==null||n.classList.add("crlngn-horizontal"),(o=document.querySelector("#camera-views"))==null||o.classList.remove("crlngn-vertical")):t===gt.vertical.name?((s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-vertical"),(a=document.querySelector("#camera-views"))==null||a.classList.remove("crlngn-horizontal")):((r=document.querySelector("#camera-views"))==null||r.classList.remove("crlngn-vertical"),(l=document.querySelector("#camera-views"))==null||l.classList.remove("crlngn-horizontal"))}static applyVideoWidth(e){const t=E(),n=L.get(t.defaultVideoWidth.tag);let o=e||n;if(o<Do)o=Do,L.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){h.currSettings.defaultVideoWidth=o;const s=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),a=document.querySelector("#camera-views.crlngn-ui");!s&&a?a.style.setProperty("--av-width",o+"px"):a&&a.style.removeProperty("--av-width"),h.resizeDock()}}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(g.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e,t;(e=h.cameraContainer)==null||e.addEventListener("mousedown",n=>{var a,r;if(n.button!==0)return;const o=document.querySelector("body.crlngn-ui");if((a=n.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",F(h,Y,so)),o==null||o.addEventListener("mouseup",F(h,Y,oo));const s=G.getOffsetBottom(h.cameraContainer);h.isDragging=!0,A(h,ot,n.clientX-((r=h.cameraContainer)==null?void 0:r.offsetLeft)),A(h,st,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=h.cameraContainer)==null||t.addEventListener("touchstart",n=>{var r,l;if(n.touches.length>1)return;const o=document.querySelector("body.crlngn-ui");if((r=n.target.parentNode)!=null&&r.classList.contains("volume-bar"))return;o==null||o.addEventListener("touchmove",F(h,Y,ao)),o==null||o.addEventListener("touchend",F(h,Y,zt)),o==null||o.addEventListener("touchcancel",F(h,Y,zt));const s=n.touches[0],a=G.getOffsetBottom(h.cameraContainer);h.isDragging=!0,A(h,ot,s.clientX-((l=h.cameraContainer)==null?void 0:l.offsetLeft)),A(h,st,window.innerHeight-s.clientY-a),n.preventDefault(),n.stopPropagation()})}static makeResizeable(){if(h.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),h.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),h.isResizing=!0,A(h,Kt,n.clientX),A(h,Zt,n.clientY),A(h,en,parseInt(getComputedStyle(h.cameraContainer).bottom)||0),A(h,Qt,h.cameraContainer.offsetWidth),A(h,_t,h.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",F(h,Y,io)),e==null||e.addEventListener("mouseup",F(h,Y,ro))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){E();const s=h.currSettings;if(!(!s.enableFloatingDock||!h.cameraContainer))if(!e&&!t&&!n&&!o){const a=s.dockPosX||0,r=s.dockPosY||0;if(h.cameraContainer.style.left=`${a}px`,h.cameraContainer.style.bottom=`${r}px`,h.currSettings.dockResizeOnUserJoin===gt.off.name){const l=s.dockWidth||0,c=s.dockHeight||0;h.cameraContainer.style.width=`${l}px`,h.cameraContainer.style.height=`${c}px`}}else e&&(h.cameraContainer.style.left=`${e}px`),t&&(h.cameraContainer.style.bottom=`${t}px`),h.currSettings.dockResizeOnUserJoin===gt.horizontal.name&&(n&&(h.cameraContainer.style.width=`${n}px`),o&&(h.cameraContainer.style.height=`${o}px`))}};ot=new WeakMap,st=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,_t=new WeakMap,en=new WeakMap,Y=new WeakSet,oo=function(e){var o,s;const t=E(),n={...h.currSettings};if(h.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=h.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=h.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),L.set(t.dockPosX.tag,n.dockPosX),L.set(t.dockPosY.tag,n.dockPosY),a==null||a.removeEventListener("mousemove",F(h,Y,so)),a==null||a.removeEventListener("mouseup",F(h,Y,oo)),h.isDragging=!1,e.stopPropagation()}},zt=function(e){var o,s;const t=E(),n={...h.currSettings};if(h.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=h.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=h.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),L.set(t.dockPosX.tag,n.dockPosX),L.set(t.dockPosY.tag,n.dockPosY),a==null||a.removeEventListener("touchmove",F(h,Y,ao)),a==null||a.removeEventListener("touchend",F(h,Y,zt)),a==null||a.removeEventListener("touchcancel",F(h,Y,zt)),h.isDragging=!1,e.preventDefault(),e.stopPropagation()}},so=function(e){if(h.isDragging){if(g.log("mousemove",[e.target.parentNode]),h.cameraContainer){let t=e.clientX-p(h,ot),n=window.innerHeight-e.clientY-p(h,st);t+h.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-h.cameraContainer.offsetWidth),h.cameraContainer.style.left=`${t}px`,n+h.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-h.cameraContainer.offsetHeight),h.cameraContainer.style.bottom=`${n}px`}e.preventDefault(),e.stopPropagation()}},ao=function(e){if(!(!h.isDragging||!e.touches[0])){if(h.cameraContainer){const t=e.touches[0];let n=t.clientX-p(h,ot),o=window.innerHeight-t.clientY-p(h,st);n+h.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-h.cameraContainer.offsetWidth),h.cameraContainer.style.left=`${n}px`,o+h.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-h.cameraContainer.offsetHeight),h.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}},io=function(e){if(!h.isResizing)return;const t=p(h,Qt)+(e.clientX-p(h,Kt)),n=e.clientY-p(h,Zt),o=p(h,_t)+n,s=p(h,en)-n;h.cameraContainer.style.width=`${t}px`,h.cameraContainer.style.height=`${o}px`,h.cameraContainer.style.bottom=`${s}px`},ro=function(){var o,s,a,r,l,c;const e=E(),t={...h.currSettings},n=document.querySelector("body.crlngn-ui");h.isResizing=!1,n==null||n.removeEventListener("mousemove",F(h,Y,io)),n==null||n.removeEventListener("mouseup",F(h,Y,ro)),g.log("onStopResize",[(o=h.cameraContainer)==null?void 0:o.style.width,(s=h.cameraContainer)==null?void 0:s.style.height,(a=h.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((r=h.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=h.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=h.cameraContainer)==null?void 0:c.style.bottom)||0),L.set(e.dockWidth.tag,t.dockWidth),L.set(e.dockHeight.tag,t.dockHeight),L.set(e.dockPosY.tag,t.dockPosY),L.set(e.dockWasResized.tag,!0)},T(h,Y),T(h,ot,0),T(h,st,0),w(h,"isDragging",!1),w(h,"cameraContainer"),w(h,"isResizing",!1),T(h,Kt,0),T(h,Zt,0),T(h,Qt,0),T(h,_t,0),T(h,en,0),w(h,"currSettings",{}),w(h,"resizeDock",()=>{E(),!h.currSettings.enableFloatingDock||h.cameraContainer});let se=h;const ke=class ke{static init(){const e=E();ke.enableChatStyles=L.get(e.enableChatStyles.tag),ke.chatBorderColor=L.get(e.chatBorderColor.tag)}};w(ke,"chatBorderColor"),w(ke,"enableChatStyles"),w(ke,"enrichCard",async(e,t)=>{var a,r,l,c,u,m,y,N;g.log("renderChatMessage",[ke.chatBorderColor,ke.enableChatStyles,Tt.playerColor.name,(a=e.author)==null?void 0:a.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((y=(m=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:m.roll)==null?void 0:y.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const s=o.querySelectorAll(".card-buttons button[data-action=rollSave]");s.length>0&&s.forEach(b=>{const S=b.querySelector(".visible-dc"),k=b.querySelector(".hidden-dc");g.log("enrichCard",[S,k]),S.setAttribute("data-ability",b.getAttribute("data-ability")||""),S.setAttribute("data-dc",b.getAttribute("data-dc")||""),k.setAttribute("data-ability",b.getAttribute("data-ability")||"")}),ke.chatBorderColor===Tt.playerColor.name&&((N=e.author)!=null&&N.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let wt=ke;var Eo;const me=class me{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,me.checkPlayersList),Hooks.on(U.RENDER_HOTBAR,me.checkPlayersList),G.isModuleOn("foundry-taskbar")&&Hooks.on(U.UPDATE_USER,me.checkTaskbarLock),me.checkTaskbarLock(),me.addModuleClasses(),G.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})}};Eo=new WeakMap,T(me,Eo),w(me,"addModuleClasses",()=>{const e=E(),t=L.get(e.otherModulesList.tag)||"",n=t.split(",");g.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const s=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+s)}),n.forEach(o=>{const s=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+s)})}),w(me,"checkTaskbarLock",()=>{var s,a,r;const e=G.isModuleOn("foundry-taskbar"),t=(s=game.user.flags)==null?void 0:s["foundry-taskbar"];if(g.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(a=t.taskbarSettings)!=null&&a.locked?G.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):G.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?G.addCSSVars("--crlngn-taskbar-height","50px"):G.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),me.checkPlayersList()}),w(me,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=G.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,s=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;g.log("checkPlayersList",[o,n,s,game.settings]),document.querySelector("#hotbar"),o?(g.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.minimized")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let lt=me;class Me{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,Me.onRender),Me.applyPlayersListSettings(),g.log("PlayersList init")}static onRender(e,t,n){E(),Me.applyPlayersListSettings(),Me.applyAvatars()}static applyPlayersListSettings(){var t,n;const e=E();g.log("applyPlayersListSettings",[L.get(e.autoHidePlayerList.tag)]),L.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized"),lt.checkPlayersList()}static applyAvatars(){const e=E();g.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(a=>a.active===!0),o=game.users.filter(a=>a.active===!1),s=[...n,...o];L.get(e.playerListAvatars.tag)?(t==null||t.classList.add("crlngn-avatars"),s.forEach(a=>{var m;const r=t==null?void 0:t.querySelector(`li[data-user-id='${a.id}']`),l=game.users.get(a.id),c=((m=l.character)==null?void 0:m.img)||"";g.log("player",[l]);const u=document.createElement("img");u.src=c||l.avatar||"",u.alt="*",u.classList.add("avatar"),r&&r.prepend(u)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const l=r.querySelector("img.avatar");l==null||l.remove()}),t==null||t.classList.remove("crlngn-avatars")),lt.checkPlayersList()}}var ae,$,at,ht,tn,mt,nn,on,yt,St,fe,be,Mn,Dn;const f=class f{static handleNavState(){const e=E();game.ready&&p(f,St)?(A(f,St,!1),f.toggleNav(f.navStartCollapsed)):f.toggleNav(L.get(e.sceneNavCollapsed.tag))}static toggleNav(e){clearTimeout(p(f,on)),A(f,on,setTimeout(()=>{if(!ui.nav){f.toggleNav(e);return}f.resetLocalVars(),e===!0?(ui.nav.collapse(),p(f,mt).classList.add("navigation-collapsed")):e===!1&&(ui.nav.expand(),p(f,mt).classList.remove("navigation-collapsed"))},500))}static checkSceneNavCompat(){var n,o;const e=E(),t=document.querySelector("#ui-middle");A(this,fe,G.isModuleOn("monks-scene-navigation")),A(this,be,G.isModuleOn("compact-scene-navigation")),p(this,be)&&f.navFoldersEnabled&&(n=game.user)!=null&&n.isGM&&p(this,be)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),p(this,fe)&&f.sceneNavEnabled&&(t.classList.remove("crlngn-ui"),game.ready&&(L.set(e.sceneNavEnabled.tag,!1),f.sceneNavEnabled=!1),g.log("checkSceneNavCompat",[p(this,fe),p(this,be)]),(o=game.user)!=null&&o.isGM&&p(this,fe)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static resetLocalVars(){A(f,ae,document.querySelector("#navigation")),A(f,ht,document.querySelector("#navigation .nav-item.is-root")),A(f,tn,document.querySelector("#nav-toggle")),A(f,mt,document.querySelector("#ui-middle")),f.navFoldersEnabled?(A(f,$,document.querySelector("#crlngn-scene-list")),g.log("TopNavigation resetLocalVars",[p(f,$)])):A(f,$,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=p(f,ae))==null||e.addEventListener("mouseenter",n=>{if(g.log("TopNavigation mouseenter",[]),!f.isCollapsed||!f.showNavOnHover)return;n.stopPropagation(),clearTimeout(p(f,at)),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,ae))==null||t.addEventListener("mouseleave",n=>{g.log("TopNavigation mouseleave",[]),!(!f.isCollapsed||!f.showNavOnHover)&&(n.stopPropagation(),A(this,at,setTimeout(()=>{clearTimeout(p(this,at)),A(this,at,null),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){clearTimeout(p(this,yt)),A(f,yt,setTimeout(()=>{var l,c,u,m,y,N,b;clearTimeout(p(this,yt)),f.resetLocalVars();const e=((c=(l=p(f,ae))==null?void 0:l.querySelector("#crlngn-scene-folders"))==null?void 0:c.offsetWidth)||0,t=(u=p(f,ae))==null?void 0:u.querySelectorAll("button.crlngn-nav"),n=((m=p(f,$))==null?void 0:m.scrollWidth)+e>=((y=p(this,ae))==null?void 0:y.offsetWidth);if(g.log("placeNavButtons",[p(f,$),n]),!n)return;t.forEach(S=>S.remove());const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),o.addEventListener("click",p(this,Mn)),o.append(s);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const r=document.createElement("i");r.classList.add("fa"),r.classList.add("fa-chevron-right"),a.append(r),a.addEventListener("click",p(this,Dn)),(N=p(this,ae))==null||N.appendChild(o),(b=p(this,ae))==null||b.appendChild(a),p(this,$)&&p(this,$).classList.remove("no-transition")},100))}static setNavPosition(e){var t,n;try{g.log("setNavPosition",["Starting with pos:",e]);const o=E();if(!p(this,$)){g.log("setNavPosition",["No scenes list found"]);return}const s=((t=p(this,$))==null?void 0:t.querySelectorAll("li.nav-item:not(.is-root)"))||[];if(s.length===0){g.log("setNavPosition",["No scene items found"]);return}const a=p(this,be)&&((n=p(this,ht))==null?void 0:n.offsetWidth)||0,r=e!==void 0?e:f.navPos||0;if(r>=s.length){g.log("setNavPosition",["Position out of bounds:",r,"max:",s.length-1]);return}const l=s[r];if(!l){g.log("setNavPosition",["Target scene not found at position:",r]);return}const c=l.offsetLeft;if(typeof c!="number"){g.log("setNavPosition",["Invalid offsetLeft for scene:",c]);return}const u=(parseInt(c)-a)*-1;g.log("setNavPosition",["Calculated margin:",u]),p(this,$).style.marginLeft=u+"px",f.navPos=r,L.set(o.sceneNavPos.tag,r),g.log("setNavPosition",["Complete:",{pos:e,position:r,newMargin:u}])}catch(o){g.log("setNavPosition",["Error:",o]),console.error("Error in setNavPosition:",o)}}};ae=new WeakMap,$=new WeakMap,at=new WeakMap,ht=new WeakMap,tn=new WeakMap,mt=new WeakMap,nn=new WeakMap,on=new WeakMap,yt=new WeakMap,St=new WeakMap,fe=new WeakMap,be=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,T(f,ae),T(f,$),T(f,at),T(f,ht),T(f,tn),T(f,mt),w(f,"sceneFoldersTemplate"),T(f,nn),T(f,on),T(f,yt),T(f,St,!0),T(f,fe,!1),T(f,be,!1),w(f,"sceneNavEnabled"),w(f,"navFoldersEnabled"),w(f,"navFoldersForPlayers"),w(f,"navShowRootFolders"),w(f,"navStartCollapsed"),w(f,"showFolderListOnClick"),w(f,"showNavOnHover"),w(f,"useSceneIcons"),w(f,"useScenePreview"),w(f,"useNavBackButton"),w(f,"sceneNavAlias",""),w(f,"sceneClickToView"),w(f,"isCollapsed"),w(f,"navPos"),w(f,"init",async()=>{const e=E();f.checkSceneNavCompat(),f.navStartCollapsed=L.get(e.navStartCollapsed.tag),f.showNavOnHover=L.get(e.showNavOnHover.tag),f.sceneNavEnabled=L.get(e.sceneNavEnabled.tag),f.navFoldersEnabled=L.get(e.navFoldersEnabled.tag),f.navFoldersForPlayers=L.get(e.navFoldersForPlayers.tag),f.showFolderListOnClick=L.get(e.showFolderListOnClick.tag),f.isCollapsed=p(f,St)?f.navStartCollapsed:L.get(e.sceneNavCollapsed.tag),f.navPos=L.get(e.sceneNavPos.tag),f.resetLocalVars();const t=document.querySelector("#ui-middle");if(g.log("SCENE NAV INIT",[f.sceneNavEnabled]),f.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}if(p(f,fe))p(f,fe)&&t.classList.add("with-monks-scene");else{p(f,be)||(he.init(),he.registerHooks(),he.renderSceneFolders());const n=L.get(e.sceneNavPos.tag);f.setNavPosition(n),f.placeNavButtons(),f.addListeners(),f.handleNavState()}Hooks.on(U.RENDER_SCENE_NAV,async()=>{g.log("SCENE NAV",[f.navPos]),g.log("TopNavigation",[f.isCollapsed,f.navStartCollapsed]);const n=E();if(!p(f,fe)){g.log("NAV no transition add"),f.navPos=L.get(n.sceneNavPos.tag),p(f,be)||(he.init(),await he.renderSceneFolders()),p(f,$)&&p(f,$).classList.add("no-transition");const o=f.navPos;f.resetLocalVars(),f.setNavPosition(o),f.placeNavButtons(),f.addListeners(),f.handleNavState(),clearTimeout(p(f,nn)),A(f,nn,setTimeout(()=>{g.log("NAV no transition remove"),p(f,$)&&p(f,$).classList.remove("no-transition"),f.placeNavButtons()},250))}}),Hooks.on(U.COLLAPSE_SIDE_BAR,n=>{g.log(U.COLLAPSE_SIDE_BAR,["isMonksSceneNavOn",p(f,fe)]),p(f,fe)||(f.placeNavButtons(),n?document.querySelector("body").classList.add("nav-collapsed"):document.querySelector("body").classList.remove("nav-collapsed"))}),Hooks.on(U.COLLAPSE_SCENE_NAV,(n,o)=>{const s=E();L.set(s.sceneNavCollapsed.tag,o),g.log("NAV toggle",[n,o]),f.isCollapsed=o,f.toggleNav(o)}),Hooks.on(U.EXPAND_SCENE_NAV,(n,o)=>{g.log("NAV expand",[n,!1])}),Hooks.on(U.CANVAS_INIT,async()=>{try{const n=game.scenes.viewed;if(!n)return;const o=await f.getCurrScenePosition(n.id);await new Promise(s=>setTimeout(s,100)),f.setNavPosition(o)}catch(n){g.warn(U.CANVAS_INIT,["Error in canvas init:",n]),console.error("Error in canvas init:",n)}}),window.addEventListener("resize",()=>{p(f,fe)||f.placeNavButtons()}),g.log("TopNavigation - init",[f.sceneNavEnabled])}),T(f,Mn,async e=>{var s;const t=await f.getItemsPerPage();(s=p(f,$))!=null&&s.querySelectorAll("li.nav-item:not(.is-root)");const n=f.navPos||0;let o=n-(t-1);o=o<0?0:o,g.log("onNavLast",["currPos",n,"items",t,o]),f.setNavPosition(o)}),T(f,Dn,async e=>{var a;const t=await f.getItemsPerPage(),n=((a=p(f,$))==null?void 0:a.querySelectorAll("li.nav-item:not(.is-root)"))||[],o=f.navPos||0;let s=o+(t-1);s=s>n.length-1?n.length-1:s,g.log("onNavNext",["currPos",o,"items",t,s]),f.setNavPosition(s)}),w(f,"getItemsPerPage",async()=>{var e,t,n,o,s,a;try{if(g.log("getItemsPerPage",["Starting"]),p(f,ae)||(g.log("getItemsPerPage",["No nav element, resetting vars"]),f.resetLocalVars(),await new Promise(S=>setTimeout(S,100))),!p(f,ae))return g.log("getItemsPerPage",["Nav element still not found after reset"]),0;const r=((t=(e=p(f,ae))==null?void 0:e.querySelector("#crlngn-scene-folders"))==null?void 0:t.offsetWidth)||0,l=p(f,be)&&((n=p(f,ht))==null?void 0:n.offsetWidth)||0,c=((o=p(f,tn))==null?void 0:o.offsetWidth)||0,u=(s=p(f,$))==null?void 0:s.querySelector("li.nav-item:not(.is-root)");if(!u)return g.log("getItemsPerPage",["No scene items found"]),0;const m=u.offsetWidth;if(!m)return g.log("getItemsPerPage",["Scene item has no width"]),0;const y=f.navPos||0,N=(a=p(f,ae))==null?void 0:a.offsetWidth;if(!N)return g.log("getItemsPerPage",["Nav element has no width"]),0;const b=Math.floor((N-(y===0?l+r:0)-c*2)/m);return g.log("getItemsPerPage",["Calculated items per page:",b]),b||0}catch(r){return g.log("getItemsPerPage",["Error:",r]),console.error("Error in getItemsPerPage:",r),0}}),w(f,"getCurrScenePosition",async e=>{try{if(g.log("getCurrScenePosition",["Starting with id:",e]),!p(f,$))return g.log("getCurrScenePosition",["No scenes list found"]),0;const t=await f.getItemsPerPage()||1;g.log("getCurrScenePosition",["Items per page:",t]);const n=p(f,$).querySelectorAll("li.nav-item:not(.is-root)");if(!n||n.length===0)return g.log("getCurrScenePosition",["No scene items found"]),0;const o=Array.from(n);if(!e)return g.log("getCurrScenePosition",["No scene ID provided"]),0;const s=o.findIndex(l=>l.dataset.sceneId===e);if(g.log("getCurrScenePosition",["Found scene index:",s]),s===-1)return g.log("getCurrScenePosition",["Scene not found with id:",e]),0;const a=s>=f.navPos&&s<=f.navPos+t,r=a?f.navPos:s;return g.log("getCurrScenePosition",["Final position:",r,"isVisible:",a]),r}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}});let O=f;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Po(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(i,o).enumerable})),t.push.apply(t,n)}return t}function Pe(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Po(Object(t),!0).forEach(function(n){zs(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Po(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function vn(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vn=function(e){return typeof e}:vn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(i)}function zs(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ze(){return ze=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ze.apply(this,arguments)}function xs(i,e){if(i==null)return{};var t={},n=Object.keys(i),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(t[o]=i[o]);return t}function Us(i,e){if(i==null)return{};var t=xs(i,e),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(o=0;o<s.length;o++)n=s[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}var Bs="1.15.6";function Oe(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var xe=Oe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),un=Oe(/Edge/i),Ao=Oe(/firefox/i),qt=Oe(/safari/i)&&!Oe(/chrome/i)&&!Oe(/android/i),To=Oe(/iP(ad|od|hone)/i),os=Oe(/chrome/i)&&Oe(/android/i),ss={capture:!1,passive:!1};function x(i,e,t){i.addEventListener(e,t,!xe&&ss)}function z(i,e,t){i.removeEventListener(e,t,!xe&&ss)}function Ln(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch{return!1}return!1}}function as(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function Ne(i,e,t,n){if(i){t=t||document;do{if(e!=null&&(e[0]===">"?i.parentNode===t&&Ln(i,e):Ln(i,e))||n&&i===t)return i;if(i===t)break}while(i=as(i))}return null}var Go=/\s+/g;function ue(i,e,t){if(i&&e)if(i.classList)i.classList[t?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(Go," ").replace(" "+e+" "," ");i.className=(n+(t?" "+e:"")).replace(Go," ")}}function D(i,e,t){var n=i&&i.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function pt(i,e){var t="";if(typeof i=="string")t=i;else do{var n=D(i,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(i=i.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function is(i,e,t){if(i){var n=i.getElementsByTagName(e),o=0,s=n.length;if(t)for(;o<s;o++)t(n[o],o);return n}return[]}function De(){var i=document.scrollingElement;return i||document.documentElement}function K(i,e,t,n,o){if(!(!i.getBoundingClientRect&&i!==window)){var s,a,r,l,c,u,m;if(i!==window&&i.parentNode&&i!==De()?(s=i.getBoundingClientRect(),a=s.top,r=s.left,l=s.bottom,c=s.right,u=s.height,m=s.width):(a=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,m=window.innerWidth),(e||t)&&i!==window&&(o=o||i.parentNode,!xe))do if(o&&o.getBoundingClientRect&&(D(o,"transform")!=="none"||t&&D(o,"position")!=="static")){var y=o.getBoundingClientRect();a-=y.top+parseInt(D(o,"border-top-width")),r-=y.left+parseInt(D(o,"border-left-width")),l=a+s.height,c=r+s.width;break}while(o=o.parentNode);if(n&&i!==window){var N=pt(o||i),b=N&&N.a,S=N&&N.d;N&&(a/=S,r/=b,m/=b,u/=S,l=a+u,c=r+m)}return{top:a,left:r,bottom:l,right:c,width:m,height:u}}}function Fo(i,e,t){for(var n=Ye(i,!0),o=K(i)[e];n;){var s=K(n)[t],a=void 0;if(a=o>=s,!a)return n;if(n===De())break;n=Ye(n,!1)}return!1}function It(i,e,t,n){for(var o=0,s=0,a=i.children;s<a.length;){if(a[s].style.display!=="none"&&a[s]!==R.ghost&&(n||a[s]!==R.dragged)&&Ne(a[s],t.draggable,i,!1)){if(o===e)return a[s];o++}s++}return null}function wo(i,e){for(var t=i.lastElementChild;t&&(t===R.ghost||D(t,"display")==="none"||e&&!Ln(t,e));)t=t.previousElementSibling;return t||null}function ye(i,e){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==R.clone&&(!e||Ln(i,e))&&t++;return t}function Oo(i){var e=0,t=0,n=De();if(i)do{var o=pt(i),s=o.a,a=o.d;e+=i.scrollLeft*s,t+=i.scrollTop*a}while(i!==n&&(i=i.parentNode));return[e,t]}function qs(i,e){for(var t in i)if(i.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[t][n])return Number(t)}return-1}function Ye(i,e){if(!i||!i.getBoundingClientRect)return De();var t=i,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=D(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return De();if(n||e)return t;n=!0}}while(t=t.parentNode);return De()}function Hs(i,e){if(i&&e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function xn(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var Ht;function rs(i,e){return function(){if(!Ht){var t=arguments,n=this;t.length===1?i.call(n,t[0]):i.apply(n,t),Ht=setTimeout(function(){Ht=void 0},e)}}}function Vs(){clearTimeout(Ht),Ht=void 0}function ls(i,e,t){i.scrollLeft+=e,i.scrollTop+=t}function cs(i){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function ds(i,e,t){var n={};return Array.from(i.children).forEach(function(o){var s,a,r,l;if(!(!Ne(o,e.draggable,i,!1)||o.animated||o===t)){var c=K(o);n.left=Math.min((s=n.left)!==null&&s!==void 0?s:1/0,c.left),n.top=Math.min((a=n.top)!==null&&a!==void 0?a:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var le="Sortable"+new Date().getTime();function Ws(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(D(o,"display")==="none"||o===R.ghost)){i.push({target:o,rect:K(o)});var s=Pe({},i[i.length-1].rect);if(o.thisAnimationDuration){var a=pt(o,!0);a&&(s.top-=a.f,s.left-=a.e)}o.fromRect=s}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(qs(i,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var s=!1,a=0;i.forEach(function(r){var l=0,c=r.target,u=c.fromRect,m=K(c),y=c.prevFromRect,N=c.prevToRect,b=r.rect,S=pt(c,!0);S&&(m.top-=S.f,m.left-=S.e),c.toRect=m,c.thisAnimationDuration&&xn(y,m)&&!xn(u,m)&&(b.top-m.top)/(b.left-m.left)===(u.top-m.top)/(u.left-m.left)&&(l=$s(b,y,N,o.options)),xn(m,u)||(c.prevFromRect=u,c.prevToRect=m,l||(l=o.options.animation),o.animate(c,b,m,l)),l&&(s=!0,a=Math.max(a,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof n=="function"&&n()},a):typeof n=="function"&&n(),i=[]},animate:function(n,o,s,a){if(a){D(n,"transition",""),D(n,"transform","");var r=pt(this.el),l=r&&r.a,c=r&&r.d,u=(o.left-s.left)/(l||1),m=(o.top-s.top)/(c||1);n.animatingX=!!u,n.animatingY=!!m,D(n,"transform","translate3d("+u+"px,"+m+"px,0)"),this.forRepaintDummy=js(n),D(n,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),D(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){D(n,"transition",""),D(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},a)}}}}function js(i){return i.offsetWidth}function $s(i,e,t,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var ct=[],Un={initializeByDefault:!0},gn={mount:function(e){for(var t in Un)Un.hasOwnProperty(t)&&!(t in e)&&(e[t]=Un[t]);ct.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ct.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var s=e+"Global";ct.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][s]&&t[a.pluginName][s](Pe({sortable:t},n)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](Pe({sortable:t},n)))})},initializePlugins:function(e,t,n,o){ct.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,ze(n,c.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var a=this.modifyOption(e,s,e.options[s]);typeof a<"u"&&(e.options[s]=a)}},getEventProperties:function(e,t){var n={};return ct.forEach(function(o){typeof o.eventProperties=="function"&&ze(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return ct.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[t]=="function"&&(o=s.optionListeners[t].call(e[s.pluginName],n))}),o}};function Ys(i){var e=i.sortable,t=i.rootEl,n=i.name,o=i.targetEl,s=i.cloneEl,a=i.toEl,r=i.fromEl,l=i.oldIndex,c=i.newIndex,u=i.oldDraggableIndex,m=i.newDraggableIndex,y=i.originalEvent,N=i.putSortable,b=i.extraEventProperties;if(e=e||t&&t[le],!!e){var S,k=e.options,B="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!xe&&!un?S=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(S=document.createEvent("Event"),S.initEvent(n,!0,!0)),S.to=a||t,S.from=r||t,S.item=o||t,S.clone=s,S.oldIndex=l,S.newIndex=c,S.oldDraggableIndex=u,S.newDraggableIndex=m,S.originalEvent=y,S.pullMode=N?N.lastPutMode:void 0;var q=Pe(Pe({},b),gn.getEventProperties(n,e));for(var _ in q)S[_]=q[_];t&&t.dispatchEvent(S),k[B]&&k[B].call(e,S)}}var Xs=["evt"],ie=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,s=Us(n,Xs);gn.pluginEvent.bind(R)(e,t,Pe({dragEl:C,parentEl:j,ghostEl:P,rootEl:V,nextEl:et,lastDownEl:bn,cloneEl:W,cloneHidden:Ve,dragStarted:xt,putSortable:te,activeSortable:R.active,originalEvent:o,oldIndex:ft,oldDraggableIndex:Vt,newIndex:ge,newDraggableIndex:He,hideGhostForTarget:ps,unhideGhostForTarget:hs,cloneNowHidden:function(){Ve=!0},cloneNowShown:function(){Ve=!1},dispatchSortableEvent:function(r){oe({sortable:t,name:r,originalEvent:o})}},s))};function oe(i){Ys(Pe({putSortable:te,cloneEl:W,targetEl:C,rootEl:V,oldIndex:ft,oldDraggableIndex:Vt,newIndex:ge,newDraggableIndex:He},i))}var C,j,P,V,et,bn,W,Ve,ft,ge,Vt,He,hn,te,ut=!1,Tn=!1,wn=[],Qe,ve,Bn,qn,zo,xo,xt,dt,Wt,jt=!1,mn=!1,Cn,ne,Hn=[],lo=!1,In=[],On=typeof document<"u",yn=To,Uo=un||xe?"cssFloat":"float",Js=On&&!os&&!To&&"draggable"in document.createElement("div"),us=function(){if(On){if(xe)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),gs=function(e,t){var n=D(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),s=It(e,0,t),a=It(e,1,t),r=s&&D(s),l=a&&D(a),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+K(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+K(a).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&r.float&&r.float!=="none"){var m=r.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===m)?"vertical":"horizontal"}return s&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[Uo]==="none"||a&&n[Uo]==="none"&&c+u>o)?"vertical":"horizontal"},Ks=function(e,t,n){var o=n?e.left:e.top,s=n?e.right:e.bottom,a=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||s===l||o+a/2===r+c/2},Zs=function(e,t){var n;return wn.some(function(o){var s=o[le].options.emptyInsertThreshold;if(!(!s||wo(o))){var a=K(o),r=e>=a.left-s&&e<=a.right+s,l=t>=a.top-s&&t<=a.bottom+s;if(r&&l)return n=o}}),n},fs=function(e){function t(s,a){return function(r,l,c,u){var m=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(s==null&&(a||m))return!0;if(s==null||s===!1)return!1;if(a&&s==="clone")return s;if(typeof s=="function")return t(s(r,l,c,u),a)(r,l,c,u);var y=(a?r:l).options.group.name;return s===!0||typeof s=="string"&&s===y||s.join&&s.indexOf(y)>-1}}var n={},o=e.group;(!o||vn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},ps=function(){!us&&P&&D(P,"display","none")},hs=function(){!us&&P&&D(P,"display","")};On&&!os&&document.addEventListener("click",function(i){if(Tn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),Tn=!1,!1},!0);var _e=function(e){if(C){e=e.touches?e.touches[0]:e;var t=Zs(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[le]._onDragOver(n)}}},Qs=function(e){C&&C.parentNode[le]._isOutsideThisEl(e.target)};function R(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=ze({},e),i[le]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return gs(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,r){a.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:R.supportPointer!==!1&&"PointerEvent"in window&&(!qt||To),emptyInsertThreshold:5};gn.initializePlugins(this,i,t);for(var n in t)!(n in e)&&(e[n]=t[n]);fs(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Js,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(i,"pointerdown",this._onTapStart):(x(i,"mousedown",this._onTapStart),x(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(i,"dragover",this),x(i,"dragenter",this)),wn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ze(this,Ws())}R.prototype={constructor:R,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(dt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,C):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,s=o.preventOnFilter,a=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(ia(n),!C&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&qt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Ne(l,o.draggable,n,!1),!(l&&l.animated)&&bn!==l)){if(ft=ye(l),Vt=ye(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){oe({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),ie("filter",t,{evt:e}),s&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(m){if(m=Ne(c,m.trim(),n,!1),m)return oe({sortable:t,rootEl:m,name:"filter",targetEl:l,fromEl:n,toEl:n}),ie("filter",t,{evt:e}),!0}),u)){s&&e.preventDefault();return}o.handle&&!Ne(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,s=o.el,a=o.options,r=s.ownerDocument,l;if(n&&!C&&n.parentNode===s){var c=K(n);if(V=s,C=n,j=C.parentNode,et=C.nextSibling,bn=n,hn=a.group,R.dragged=C,Qe={target:C,clientX:(t||e).clientX,clientY:(t||e).clientY},zo=Qe.clientX-c.left,xo=Qe.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,C.style["will-change"]="all",l=function(){if(ie("delayEnded",o,{evt:e}),R.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Ao&&o.nativeDraggable&&(C.draggable=!0),o._triggerDragStart(e,t),oe({sortable:o,name:"choose",originalEvent:e}),ue(C,a.chosenClass,!0)},a.ignore.split(",").forEach(function(u){is(C,u.trim(),Vn)}),x(r,"dragover",_e),x(r,"mousemove",_e),x(r,"touchmove",_e),a.supportPointer?(x(r,"pointerup",o._onDrop),!this.nativeDraggable&&x(r,"pointercancel",o._onDrop)):(x(r,"mouseup",o._onDrop),x(r,"touchend",o._onDrop),x(r,"touchcancel",o._onDrop)),Ao&&this.nativeDraggable&&(this.options.touchStartThreshold=4,C.draggable=!0),ie("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(un||xe))){if(R.eventCanceled){this._onDrop();return}a.supportPointer?(x(r,"pointerup",o._disableDelayedDrag),x(r,"pointercancel",o._disableDelayedDrag)):(x(r,"mouseup",o._disableDelayedDrag),x(r,"touchend",o._disableDelayedDrag),x(r,"touchcancel",o._disableDelayedDrag)),x(r,"mousemove",o._delayedDragTouchMoveHandler),x(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&x(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){C&&Vn(C),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;z(e,"mouseup",this._disableDelayedDrag),z(e,"touchend",this._disableDelayedDrag),z(e,"touchcancel",this._disableDelayedDrag),z(e,"pointerup",this._disableDelayedDrag),z(e,"pointercancel",this._disableDelayedDrag),z(e,"mousemove",this._delayedDragTouchMoveHandler),z(e,"touchmove",this._delayedDragTouchMoveHandler),z(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):t?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(C,"dragend",this),x(V,"dragstart",this._onDragStart));try{document.selection?Nn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(ut=!1,V&&C){ie("dragStarted",this,{evt:t}),this.nativeDraggable&&x(document,"dragover",Qs);var n=this.options;!e&&ue(C,n.dragClass,!1),ue(C,n.ghostClass,!0),R.active=this,e&&this._appendGhost(),oe({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ve){this._lastX=ve.clientX,this._lastY=ve.clientY,ps();for(var e=document.elementFromPoint(ve.clientX,ve.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ve.clientX,ve.clientY),e!==t);)t=e;if(C.parentNode[le]._isOutsideThisEl(e),t)do{if(t[le]){var n=void 0;if(n=t[le]._onDragOver({clientX:ve.clientX,clientY:ve.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=as(t));hs()}},_onTouchMove:function(e){if(Qe){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,s=e.touches?e.touches[0]:e,a=P&&pt(P,!0),r=P&&a&&a.a,l=P&&a&&a.d,c=yn&&ne&&Oo(ne),u=(s.clientX-Qe.clientX+o.x)/(r||1)+(c?c[0]-Hn[0]:0)/(r||1),m=(s.clientY-Qe.clientY+o.y)/(l||1)+(c?c[1]-Hn[1]:0)/(l||1);if(!R.active&&!ut){if(n&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(P){a?(a.e+=u-(Bn||0),a.f+=m-(qn||0)):a={a:1,b:0,c:0,d:1,e:u,f:m};var y="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");D(P,"webkitTransform",y),D(P,"mozTransform",y),D(P,"msTransform",y),D(P,"transform",y),Bn=u,qn=m,ve=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!P){var e=this.options.fallbackOnBody?document.body:V,t=K(C,!0,yn,!0,e),n=this.options;if(yn){for(ne=e;D(ne,"position")==="static"&&D(ne,"transform")==="none"&&ne!==document;)ne=ne.parentNode;ne!==document.body&&ne!==document.documentElement?(ne===document&&(ne=De()),t.top+=ne.scrollTop,t.left+=ne.scrollLeft):ne=De(),Hn=Oo(ne)}P=C.cloneNode(!0),ue(P,n.ghostClass,!1),ue(P,n.fallbackClass,!0),ue(P,n.dragClass,!0),D(P,"transition",""),D(P,"transform",""),D(P,"box-sizing","border-box"),D(P,"margin",0),D(P,"top",t.top),D(P,"left",t.left),D(P,"width",t.width),D(P,"height",t.height),D(P,"opacity","0.8"),D(P,"position",yn?"absolute":"fixed"),D(P,"zIndex","100000"),D(P,"pointerEvents","none"),R.ghost=P,e.appendChild(P),D(P,"transform-origin",zo/parseInt(P.style.width)*100+"% "+xo/parseInt(P.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,s=n.options;if(ie("dragStart",this,{evt:e}),R.eventCanceled){this._onDrop();return}ie("setupClone",this),R.eventCanceled||(W=cs(C),W.removeAttribute("id"),W.draggable=!1,W.style["will-change"]="",this._hideClone(),ue(W,this.options.chosenClass,!1),R.clone=W),n.cloneId=Nn(function(){ie("clone",n),!R.eventCanceled&&(n.options.removeCloneOnHide||V.insertBefore(W,C),n._hideClone(),oe({sortable:n,name:"clone"}))}),!t&&ue(C,s.dragClass,!0),t?(Tn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(z(document,"mouseup",n._onDrop),z(document,"touchend",n._onDrop),z(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",s.setData&&s.setData.call(n,o,C)),x(document,"drop",n),D(C,"transform","translateZ(0)")),ut=!0,n._dragStartId=Nn(n._dragStarted.bind(n,t,e)),x(document,"selectstart",n),xt=!0,window.getSelection().removeAllRanges(),qt&&D(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,s,a,r=this.options,l=r.group,c=R.active,u=hn===l,m=r.sort,y=te||c,N,b=this,S=!1;if(lo)return;function k(Ot,Ss){ie(Ot,b,Pe({evt:e,isOwner:u,axis:N?"vertical":"horizontal",revert:a,dragRect:o,targetRect:s,canSort:m,fromSortable:y,target:n,completed:q,onMove:function(Ro,vs){return Sn(V,t,C,o,Ro,K(Ro),e,vs)},changed:_},Ss))}function B(){k("dragOverAnimationCapture"),b.captureAnimationState(),b!==y&&y.captureAnimationState()}function q(Ot){return k("dragOverCompleted",{insertion:Ot}),Ot&&(u?c._hideClone():c._showClone(b),b!==y&&(ue(C,te?te.options.ghostClass:c.options.ghostClass,!1),ue(C,r.ghostClass,!0)),te!==b&&b!==R.active?te=b:b===R.active&&te&&(te=null),y===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){k("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==y&&(y.animateAll(),y._ignoreWhileAnimating=null)),(n===C&&!C.animated||n===t&&!n.animated)&&(dt=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(C.parentNode[le]._isOutsideThisEl(e.target),!Ot&&_e(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),S=!0}function _(){ge=ye(C),He=ye(C,r.draggable),oe({sortable:b,name:"change",toEl:t,newIndex:ge,newDraggableIndex:He,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Ne(n,r.draggable,t,!0),k("dragOver"),R.eventCanceled)return S;if(C.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return q(!1);if(Tn=!1,c&&!r.disabled&&(u?m||(a=j!==V):te===this||(this.lastPutMode=hn.checkPull(this,c,C,e))&&l.checkPut(this,c,C,e))){if(N=this._getDirection(e,n)==="vertical",o=K(C),k("dragOverValid"),R.eventCanceled)return S;if(a)return j=V,B(),this._hideClone(),k("revert"),R.eventCanceled||(et?V.insertBefore(C,et):V.appendChild(C)),q(!0);var H=wo(t,r.draggable);if(!H||na(e,N,this)&&!H.animated){if(H===C)return q(!1);if(H&&t===e.target&&(n=H),n&&(s=K(n)),Sn(V,t,C,o,n,s,e,!!n)!==!1)return B(),H&&H.nextSibling?t.insertBefore(C,H.nextSibling):t.appendChild(C),j=t,_(),q(!0)}else if(H&&ta(e,N,this)){var Q=It(t,0,r,!0);if(Q===C)return q(!1);if(n=Q,s=K(n),Sn(V,t,C,o,n,s,e,!1)!==!1)return B(),t.insertBefore(C,Q),j=t,_(),q(!0)}else if(n.parentNode===t){s=K(n);var ee=0,Ae,Ke=C.parentNode!==t,ce=!Ks(C.animated&&C.toRect||o,n.animated&&n.toRect||s,N),At=N?"top":"left",Ue=Fo(n,"top","top")||Fo(C,"top","top"),Gt=Ue?Ue.scrollTop:void 0;dt!==n&&(Ae=s[At],jt=!1,mn=!ce&&r.invertSwap||Ke),ee=oa(e,n,s,N,ce?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,mn,dt===n);var Ge;if(ee!==0){var Ze=ye(C);do Ze-=ee,Ge=j.children[Ze];while(Ge&&(D(Ge,"display")==="none"||Ge===P))}if(ee===0||Ge===n)return q(!1);dt=n,Wt=ee;var Ft=n.nextElementSibling,Be=!1;Be=ee===1;var fn=Sn(V,t,C,o,n,s,e,Be);if(fn!==!1)return(fn===1||fn===-1)&&(Be=fn===1),lo=!0,setTimeout(ea,30),B(),Be&&!Ft?t.appendChild(C):n.parentNode.insertBefore(C,Be?Ft:n),Ue&&ls(Ue,0,Gt-Ue.scrollTop),j=C.parentNode,Ae!==void 0&&!mn&&(Cn=Math.abs(Ae-K(n)[At])),_(),q(!0)}if(t.contains(C))return q(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){z(document,"mousemove",this._onTouchMove),z(document,"touchmove",this._onTouchMove),z(document,"pointermove",this._onTouchMove),z(document,"dragover",_e),z(document,"mousemove",_e),z(document,"touchmove",_e)},_offUpEvents:function(){var e=this.el.ownerDocument;z(e,"mouseup",this._onDrop),z(e,"touchend",this._onDrop),z(e,"pointerup",this._onDrop),z(e,"pointercancel",this._onDrop),z(e,"touchcancel",this._onDrop),z(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(ge=ye(C),He=ye(C,n.draggable),ie("drop",this,{evt:e}),j=C&&C.parentNode,ge=ye(C),He=ye(C,n.draggable),R.eventCanceled){this._nulling();return}ut=!1,mn=!1,jt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),co(this.cloneId),co(this._dragStartId),this.nativeDraggable&&(z(document,"drop",this),z(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),qt&&D(document.body,"user-select",""),D(C,"transform",""),e&&(xt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),P&&P.parentNode&&P.parentNode.removeChild(P),(V===j||te&&te.lastPutMode!=="clone")&&W&&W.parentNode&&W.parentNode.removeChild(W),C&&(this.nativeDraggable&&z(C,"dragend",this),Vn(C),C.style["will-change"]="",xt&&!ut&&ue(C,te?te.options.ghostClass:this.options.ghostClass,!1),ue(C,this.options.chosenClass,!1),oe({sortable:this,name:"unchoose",toEl:j,newIndex:null,newDraggableIndex:null,originalEvent:e}),V!==j?(ge>=0&&(oe({rootEl:j,name:"add",toEl:j,fromEl:V,originalEvent:e}),oe({sortable:this,name:"remove",toEl:j,originalEvent:e}),oe({rootEl:j,name:"sort",toEl:j,fromEl:V,originalEvent:e}),oe({sortable:this,name:"sort",toEl:j,originalEvent:e})),te&&te.save()):ge!==ft&&ge>=0&&(oe({sortable:this,name:"update",toEl:j,originalEvent:e}),oe({sortable:this,name:"sort",toEl:j,originalEvent:e})),R.active&&((ge==null||ge===-1)&&(ge=ft,He=Vt),oe({sortable:this,name:"end",toEl:j,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ie("nulling",this),V=C=j=P=et=W=bn=Ve=Qe=ve=xt=ge=He=ft=Vt=dt=Wt=te=hn=R.dragged=R.ghost=R.clone=R.active=null,In.forEach(function(e){e.checked=!0}),In.length=Bn=qn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":C&&(this._onDragOver(e),_s(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,s=n.length,a=this.options;o<s;o++)t=n[o],Ne(t,a.draggable,this.el,!1)&&e.push(t.getAttribute(a.dataIdAttr)||aa(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(s,a){var r=o.children[a];Ne(r,this.options.draggable,o,!1)&&(n[s]=r)},this),t&&this.captureAnimationState(),e.forEach(function(s){n[s]&&(o.removeChild(n[s]),o.appendChild(n[s]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ne(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=gn.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&fs(n)},destroy:function(){ie("destroy",this);var e=this.el;e[le]=null,z(e,"mousedown",this._onTapStart),z(e,"touchstart",this._onTapStart),z(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(z(e,"dragover",this),z(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),wn.splice(wn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ve){if(ie("hideClone",this),R.eventCanceled)return;D(W,"display","none"),this.options.removeCloneOnHide&&W.parentNode&&W.parentNode.removeChild(W),Ve=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ve){if(ie("showClone",this),R.eventCanceled)return;C.parentNode==V&&!this.options.group.revertClone?V.insertBefore(W,C):et?V.insertBefore(W,et):V.appendChild(W),this.options.group.revertClone&&this.animate(C,W),D(W,"display",""),Ve=!1}}};function _s(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function Sn(i,e,t,n,o,s,a,r){var l,c=i[le],u=c.options.onMove,m;return window.CustomEvent&&!xe&&!un?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=i,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=s||K(e),l.willInsertAfter=r,l.originalEvent=a,i.dispatchEvent(l),u&&(m=u.call(c,l,a)),m}function Vn(i){i.draggable=!1}function ea(){lo=!1}function ta(i,e,t){var n=K(It(t.el,0,t.options,!0)),o=ds(t.el,t.options,P),s=10;return e?i.clientX<o.left-s||i.clientY<n.top&&i.clientX<n.right:i.clientY<o.top-s||i.clientY<n.bottom&&i.clientX<n.left}function na(i,e,t){var n=K(wo(t.el,t.options.draggable)),o=ds(t.el,t.options,P),s=10;return e?i.clientX>o.right+s||i.clientY>n.bottom&&i.clientX>n.left:i.clientY>o.bottom+s||i.clientX>n.right&&i.clientY>n.top}function oa(i,e,t,n,o,s,a,r){var l=n?i.clientY:i.clientX,c=n?t.height:t.width,u=n?t.top:t.left,m=n?t.bottom:t.right,y=!1;if(!a){if(r&&Cn<c*o){if(!jt&&(Wt===1?l>u+c*s/2:l<m-c*s/2)&&(jt=!0),jt)y=!0;else if(Wt===1?l<u+Cn:l>m-Cn)return-Wt}else if(l>u+c*(1-o)/2&&l<m-c*(1-o)/2)return sa(e)}return y=y||a,y&&(l<u+c*s/2||l>m-c*s/2)?l>u+c/2?1:-1:0}function sa(i){return ye(C)<ye(i)?1:-1}function aa(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function ia(i){In.length=0;for(var e=i.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&In.push(n)}}function Nn(i){return setTimeout(i,0)}function co(i){return clearTimeout(i)}On&&x(document,"touchmove",function(i){(R.active||ut)&&i.cancelable&&i.preventDefault()});R.utils={on:x,off:z,css:D,find:is,is:function(e,t){return!!Ne(e,t,e,!1)},extend:Hs,throttle:rs,closest:Ne,toggleClass:ue,clone:cs,index:ye,nextTick:Nn,cancelNextTick:co,detectDirection:gs,getChild:It,expando:le};R.get=function(i){return i[le]};R.mount=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(R.utils=Pe(Pe({},R.utils),n.utils)),gn.mount(n)})};R.create=function(i,e){return new R(i,e)};R.version=Bs;var J=[],Ut,uo,go=!1,Wn,jn,kn,Bt;function ra(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):n.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):(z(document,"pointermove",this._handleFallbackAutoScroll),z(document,"touchmove",this._handleFallbackAutoScroll),z(document,"mousemove",this._handleFallbackAutoScroll)),Bo(),En(),Vs()},nulling:function(){kn=uo=Ut=go=Bt=Wn=jn=null,J.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,s=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(s,a);if(kn=t,n||this.options.forceAutoScrollFallback||un||xe||qt){$n(t,this.options,r,n);var l=Ye(r,!0);go&&(!Bt||s!==Wn||a!==jn)&&(Bt&&Bo(),Bt=setInterval(function(){var c=Ye(document.elementFromPoint(s,a),!0);c!==l&&(l=c,En()),$n(t,o.options,c,n)},10),Wn=s,jn=a)}else{if(!this.options.bubbleScroll||Ye(r,!0)===De()){En();return}$n(t,this.options,Ye(r,!1),!1)}}},ze(i,{pluginName:"scroll",initializeByDefault:!0})}function En(){J.forEach(function(i){clearInterval(i.pid)}),J=[]}function Bo(){clearInterval(Bt)}var $n=rs(function(i,e,t,n){if(e.scroll){var o=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,a=e.scrollSensitivity,r=e.scrollSpeed,l=De(),c=!1,u;uo!==t&&(uo=t,En(),Ut=e.scroll,u=e.scrollFn,Ut===!0&&(Ut=Ye(t,!0)));var m=0,y=Ut;do{var N=y,b=K(N),S=b.top,k=b.bottom,B=b.left,q=b.right,_=b.width,H=b.height,Q=void 0,ee=void 0,Ae=N.scrollWidth,Ke=N.scrollHeight,ce=D(N),At=N.scrollLeft,Ue=N.scrollTop;N===l?(Q=_<Ae&&(ce.overflowX==="auto"||ce.overflowX==="scroll"||ce.overflowX==="visible"),ee=H<Ke&&(ce.overflowY==="auto"||ce.overflowY==="scroll"||ce.overflowY==="visible")):(Q=_<Ae&&(ce.overflowX==="auto"||ce.overflowX==="scroll"),ee=H<Ke&&(ce.overflowY==="auto"||ce.overflowY==="scroll"));var Gt=Q&&(Math.abs(q-o)<=a&&At+_<Ae)-(Math.abs(B-o)<=a&&!!At),Ge=ee&&(Math.abs(k-s)<=a&&Ue+H<Ke)-(Math.abs(S-s)<=a&&!!Ue);if(!J[m])for(var Ze=0;Ze<=m;Ze++)J[Ze]||(J[Ze]={});(J[m].vx!=Gt||J[m].vy!=Ge||J[m].el!==N)&&(J[m].el=N,J[m].vx=Gt,J[m].vy=Ge,clearInterval(J[m].pid),(Gt!=0||Ge!=0)&&(c=!0,J[m].pid=setInterval((function(){n&&this.layer===0&&R.active._onTouchMove(kn);var Ft=J[this.layer].vy?J[this.layer].vy*r:0,Be=J[this.layer].vx?J[this.layer].vx*r:0;typeof u=="function"&&u.call(R.dragged.parentNode[le],Be,Ft,i,kn,J[this.layer].el)!=="continue"||ls(J[this.layer].el,Be,Ft)}).bind({layer:m}),24))),m++}while(e.bubbleScroll&&y!==l&&(y=Ye(y,!1)));go=c}},30),ms=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,s=e.activeSortable,a=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||s;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,m=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(m)&&(a("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Io(){}Io.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=It(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:ms};ze(Io,{pluginName:"revertOnSpill"});function ko(){}ko.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:ms};ze(ko,{pluginName:"removeOnSpill"});R.mount(new ra);R.mount(ko,Io);const de="favorites";var sn,vt,bt,pe,Re,an,fo,Ct,it,We,Pn,rn,ln,Fe,rt,Ce,Nt,Et,An,Gn,je,Lo;const d=class d{static init(){var e;d.noFolderView()||!ui.scenes||(!d.folderListData||d.folderListData.length===0)&&(d.preloadTemplate(),d.folderListData=d.getFolders(ui.scenes.folders),d.selectedFolder=d.selectFolder(de),F(e=d,an,fo).call(e),g.log("getFolders / sortOrder",[p(d,Re)]))}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||de}static getParentFolders(e){const t=[];let n=ui.scenes.folders.find(s=>s.id===e);const o=new Set;for(;n!=null&&n.folder&&!o.has(n.id);){o.add(n.id);const s=n.folder;if(s)t.unshift(s),n=s;else break}return t}static registerHooks(){Hooks.on(U.CANVAS_INIT,()=>{var s,a;const e=(a=(s=game.scenes)==null?void 0:s.viewed)==null?void 0:a.id,t=p(d,pe).length,n=t>0?p(d,pe)[t-1]:null,o=t>0?p(d,pe)[t-2]:null;(t===0||o!==e&&n!==e)&&(p(d,pe).push(e),g.log(U.CANVAS_INIT,[p(d,pe)]))}),Hooks.on(U.RENDER_SCENE_DIRECTORY,(e,t)=>{var n;F(n=d,an,fo).call(n)}),Hooks.on(U.CREATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.UPDATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.DELETE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.CREATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.UPDATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.DELETE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;const t=document.querySelector("#scenes .directory-list");t.addEventListener("contextmenu",o=>{var a;const s=o.target.closest(".directory-item");if(s&&(d.contextMenuSceneId=s.dataset.documentId||null,d.contextMenuSceneId)){const l=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",c=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+l);p(a=d,ln).call(a,c)}}),t.querySelectorAll("li.scene").forEach(o=>{var a,r;const s=game.scenes.get(o.dataset.sceneId||o.dataset.documentId);if(O.sceneClickToView&&(o.addEventListener("dblclick",p(d,Et)),o.addEventListener("click",p(d,Nt))),O.useSceneIcons&&s&&((a=game.user)!=null&&a.isGM)){let l=document.createElement("i");l.classList.add("fas"),l.classList.add("icon"),s.ownership.default!==0?(s.active&&(l.classList.add("fa-bullseye"),o.prepend(l)),((r=game.scenes.current)==null?void 0:r.id)===s.id&&(l.classList.add("fa-crown"),o.prepend(l))):(l.classList.add("fa-lock"),o.prepend(l))}})}),Hooks.on(U.RENDER_SCENE_NAV,()=>{document.querySelector("#navigation").addEventListener("contextmenu",t=>{var o;const n=t.target.closest(".nav-item");if(n&&(d.contextMenuSceneId=t.currentTarget.dataset.sceneId||n.dataset.sceneId||null,d.contextMenuSceneId)){const a=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",r=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+a);p(o=d,ln).call(o,r)}})}),Hooks.on(U.GET_SCENE_NAV_CONTEXT,(e,t)=>{t.find(o=>o.name==="CRLNGN_UI.ui.sceneNav.initialViewBtn")||t.push({...t[0],condition:o=>{var s;return((s=game.user)==null?void 0:s.isGM)&&game.scenes.get(o.data("sceneId"))._view},callback:o=>{let s=game.scenes.get(o.data("sceneId")),a=parseInt(canvas.stage.pivot.x),r=parseInt(canvas.stage.pivot.y),l=canvas.stage.scale.x;s.update({initial:{x:a,y:r,scale:l}},{diff:!1}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.initialViewSet"))},icon:'<i class="fas fa-expand"></i>',name:"CRLNGN_UI.ui.sceneNav.initialViewBtn"})})}};sn=new WeakMap,vt=new WeakMap,bt=new WeakMap,pe=new WeakMap,Re=new WeakMap,an=new WeakSet,fo=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){A(d,Re,game.scenes.sortingMode),d.refreshFolderView(),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}A(d,Re,"a"),g.log("updateSortMode fallback",[p(d,Re)])},Ct=new WeakMap,it=new WeakMap,We=new WeakMap,Pn=new WeakMap,rn=new WeakMap,ln=new WeakMap,Fe=new WeakMap,rt=new WeakMap,Ce=new WeakMap,Nt=new WeakMap,Et=new WeakMap,An=new WeakMap,Gn=new WeakMap,je=new WeakMap,Lo=new WeakMap,T(d,an),w(d,"selectedFolder"),w(d,"folderList"),w(d,"folderListData",[]),w(d,"searchValue",""),T(d,sn,""),w(d,"contextMenuSceneId",null),T(d,vt,{}),T(d,bt),T(d,pe,[]),T(d,Re,"a"),w(d,"getFolders",e=>{const t=o=>{o.isOpen=p(d,vt)[o.id]??!1,o.children.forEach(t)};let n=e.filter(o=>o.folder===null);return n.forEach(t),g.log("getFolders / sortOrder",[p(d,Re)]),p(d,Re)==="a"?n.sort((o,s)=>o.name.toLowerCase().localeCompare(s.name.toLowerCase())):n.sort((o,s)=>o.sort-s.sort),n}),w(d,"selectFolder",e=>d.getFolderById(e)||null),w(d,"createFolderElem",()=>document.createElement("li")),w(d,"preloadTemplate",async()=>{const e=[`modules/${Se}/templates/scene-folder-list.hbs`];return await loadTemplates(e),!0}),w(d,"getFoldersData",e=>{const t=e.children.map(o=>d.getFoldersData(o.folder));return{...e,isOpen:p(d,vt)[e.id]||!1,children:t,hasSubfolders:t.length>0,id:e.id}}),T(d,Ct,null),T(d,it,null),T(d,We,null),w(d,"renderSceneFolders",async()=>{var y,N,b,S,k,B,q,_;if(d.noFolderView()||!d.selectedFolder)return;A(d,sn,game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"));const e=d.getFolders(ui.scenes.folders),t=`CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.${O.useNavBackButton}`,n=game.i18n.localize("CRLNGN_UI.ui.sceneNav.backTo"),o=O.sceneNavAlias||game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"),s={favoritesId:de,favoritesName:p(d,sn),folderList:e.map(H=>d.getFoldersData(H)),viewedSceneId:(y=game.scenes.current)==null?void 0:y.id,users:game.users.contents,isGM:(N=game.user)==null?void 0:N.isGM,searchValue:d.searchValue,showSearchResults:!!d.searchValue,useNavBackButton:d.isBackBtnActive(),backButtonLabel:d.isBackBtnActive()?game.i18n.localize(t):"",rootButtonLabel:`${n} ${o}`,useSceneIcons:O.useSceneIcons,useScenePreview:O.useScenePreview,sceneNavAlias:O.sceneNavAlias,showRootFolders:O.navShowRootFolders};if(g.log("rootFolders",[(b=ui.scenes)==null?void 0:b.folders,game.folders]),d.selectedFolder===de){const H=O.navShowRootFolders?((S=ui.scenes)==null?void 0:S.folders.filter(Q=>Q.folder===null))||[]:[];p(d,Re)==="a"?H.sort((Q,ee)=>Q.name.toLowerCase().localeCompare(ee.name.toLowerCase())):H.sort((Q,ee)=>Q.sort-ee.sort),A(d,Ct,{...s,currFolder:{name:"",id:de},currIcon:"fa-map",folders:H,scenes:ui.nav.scenes.filter(Q=>Q.permission>=2),hasParents:!1,parentFolders:[]})}else{const H=d.selectedFolder.children,Q=d.getParentFolders(d.selectedFolder.id),ee=[...d.selectedFolder.contents];ee.sort((Ae,Ke)=>Ae.sort-Ke.sort),A(d,Ct,{...s,currFolder:d.selectedFolder,currIcon:"fa-folder",folders:H,scenes:ee,hasParents:Q.length>0,parentFolders:Q})}A(d,it,document.querySelector("#crlngn-scene-folders")),A(d,We,document.querySelector("#crlngn-scene-list")),(k=p(d,it))==null||k.remove(),(B=p(d,We))==null||B.remove();const a=await renderTemplate(`modules/${Se}/templates/scene-folder-list.hbs`,p(d,Ct)),r=document.querySelector("#scene-list");r.insertAdjacentHTML("beforebegin",a),A(d,it,document.querySelector("#crlngn-scene-folders")),A(d,We,document.querySelector("#crlngn-scene-list")),r==null||r.classList.add("hidden");const l=p(d,We),c=l.querySelectorAll("li.nav-item"),u=O.navPos||0,m=parseInt((q=c[u])==null?void 0:q.offsetLeft)*-1;l.style.marginLeft=m+"px",d.activateFolderListeners(p(d,it)),p(_=d,Pn).call(_,p(d,We)),O.resetLocalVars()}),w(d,"isBackBtnActive",()=>O.useNavBackButton===nt.lastScene.name?p(d,pe).length>1:O.useNavBackButton===nt.defaultScenes.name?d.selectedFolder!==de:!1),w(d,"activateFolderListeners",e=>{if(d.noFolderView())return;const t=e.querySelector("i.root");t==null||t.addEventListener("click",p(d,Gn));const n=e.querySelector("i.fa-turn-left");n==null||n.addEventListener("click",p(d,An));const o=e.querySelector("a.selected");O.showFolderListOnClick?(o==null||o.removeEventListener("mouseover",p(d,Fe)),e.removeEventListener("mouseleave",p(d,Fe)),o==null||o.addEventListener("click",p(d,Fe))):(o==null||o.addEventListener("mouseover",p(d,Fe)),e.addEventListener("mouseleave",p(d,Fe)),o==null||o.removeEventListener("click",p(d,Fe))),e.querySelectorAll(".parent-folder").forEach(l=>{l.addEventListener("click",p(d,je))}),e.querySelectorAll("span.toggle").forEach(l=>{l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();const u=c.currentTarget.closest("li"),m=u.dataset.folderId,y=u.querySelector("ol.subfolders");let N=!1;if(!y)return;!y.classList.contains("open")?(y.classList.add("open"),N=!0):(y.classList.remove("open"),N=!1),c.currentTarget.textContent=N?"−":"+",p(d,vt)[m]=N})}),e.querySelectorAll(".folder-list li.folder").forEach(l=>{l.addEventListener("click",p(d,je))});const a=e.querySelector(".search-container .input-scene-search");a.addEventListener("keyup",d.onSearchInput),a.addEventListener("keydown",l=>{l.stopPropagation()}),e.querySelector(".search-container .back-to-favorites").addEventListener("click",p(d,je))}),T(d,Pn,e=>{var n,o;e.querySelectorAll("li.nav-item").forEach(s=>{const a=s.classList.contains("folder");s.addEventListener("click",a?p(d,je):p(d,Nt)),s.addEventListener("dblclick",a?()=>{}:p(d,Et))}),(n=game.user)!=null&&n.isGM&&p(o=d,rn).call(o,e)}),T(d,rn,e=>{clearInterval(p(d,bt));let t=0;if(!R&&t<5){A(d,bt,setTimeout(()=>{var a;return p(a=d,rn).call(a,e)},500)),t++;return}clearInterval(p(d,bt));const n={animation:200,delay:100,delayOnTouchOnly:!0,onStart:function(){e.querySelectorAll(".scene.nav-item").forEach(a=>a.classList.add("no-hover")),this.el.classList.add("no-hover")},onEnd:function(){e.querySelectorAll(".scene.nav-item").forEach(a=>a.classList.remove("no-hover")),this.el.classList.remove("no-hover")}},o={...n,draggable:".scene.nav-item",onEnd:async a=>{var N,b;const r=e.querySelectorAll(".scene.nav-item"),l=[],c=Array.from(r).map(S=>game.scenes.get(S.dataset.sceneId));let u=0;const m=CONST.SORT_INTEGER_DENSITY;for(const S of c){if(!S)continue;const k={_id:S.id};d.selectedFolder===de?S.navigation&&(k.navOrder=u,u+=m):d.selectedFolder&&((N=S.folder)==null?void 0:N.id)===d.selectedFolder.id&&(k.sort=u,u+=m),l.push(k)}const y=game.scenes.contents.filter(S=>!l.some(k=>k._id===S.id));y.sort((S,k)=>{var B,q;if(d.selectedFolder===de)return!S.navigation&&!k.navigation?0:S.navigation?k.navigation?S.navOrder-k.navOrder:-1:1;{const _=((B=S.folder)==null?void 0:B.id)===d.selectedFolder.id,H=((q=k.folder)==null?void 0:q.id)===d.selectedFolder.id;return!_&&!H?0:_?H?S.sort-k.sort:-1:1}});for(const S of y)d.selectedFolder===de?S.navigation&&(l.push({_id:S.id,navOrder:u}),u+=m):((b=S.folder)==null?void 0:b.id)===d.selectedFolder.id&&(l.push({_id:S.id,sort:u}),u+=m);l.length&&(await Scene.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}},s={...n,draggable:".folder.nav-item",onEnd:async a=>{var N,b;const r=e.querySelectorAll(".folder.nav-item"),l=[],c=Array.from(r).map(S=>{const k=S.dataset.folderId;return game.scenes.folders.find(B=>B.id===k)}).filter(S=>S);let u=0;const m=CONST.SORT_INTEGER_DENSITY;for(const S of c)S&&((N=S.folder)==null?void 0:N.id)===((b=d.selectedFolder)==null?void 0:b.id)&&(l.push({_id:S.id,sort:u}),u+=m);const y=game.scenes.folders.filter(S=>{var k,B;return((k=S.folder)==null?void 0:k.id)===((B=d.selectedFolder)==null?void 0:B.id)&&!l.some(q=>q._id===S.id)}).sort((S,k)=>S.sort-k.sort);for(const S of y)l.push({_id:S.id,sort:u}),u+=m;l.length&&(await Folder.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}};R.create(e,o),R.create(e,s)}),w(d,"refreshFolderView",async()=>{d.noFolderView()||(d.folderListData=d.getFolders(ui.scenes.folders),await d.renderSceneFolders(),O.placeNavButtons())}),w(d,"updateSearchResults",e=>{var s,a;if(d.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((s=game.scenes)==null?void 0:s.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];n.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase()));const o=((a=game.scenes)==null?void 0:a.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(r=>{const l=document.createElement("li");l.className="folder",l.dataset.folderId=r.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,l.addEventListener("click",p(d,je)),t.appendChild(l)}),n.forEach(r=>{const l=document.createElement("li");l.className="scene",l.dataset.sceneId=r.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,l.addEventListener("dblclick",p(d,Et)),l.addEventListener("click",p(d,Nt)),t.appendChild(l)}),o.length===0&&n.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}}),T(d,ln,e=>{const t=()=>{const o=document.querySelector("#context-menu");if(!o)return!1;const s=o.querySelectorAll(".context-item"),a=Array.from(s).find(r=>r.innerHTML.includes(game.i18n.localize("SCENES.ToggleNav")));return a?(a.innerHTML=`<i class="fas fa-compass fa-fw"></i>${e}`,!0):!1};if(t())return;const n=new MutationObserver((o,s)=>{t()&&s.disconnect()});n.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>n.disconnect(),1e3)}),T(d,Fe,e=>{e.stopPropagation(),e.preventDefault();const t=document.querySelector("#crlngn-scene-folders"),n=e.type.startsWith("mouse"),o=!O.showFolderListOnClick;if(n&&o&&e.type==="mouseover"){t!=null&&t.classList.contains("open")||t==null||t.classList.add("open");return}if(n&&o&&e.type==="mouseleave"){t==null||t.classList.remove("open");return}n||(t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),document.addEventListener("click",p(d,rt))))}),T(d,rt,e=>{e.preventDefault(),document.removeEventListener("click",p(d,rt));const t=e.target,n=document.querySelector("#crlngn-scene-folders");n!=null&&n.classList.contains("open")&&!n.contains(t)&&n.classList.remove("open")}),T(d,Ce,null),T(d,Nt,e=>{var a;e.preventDefault(),document.removeEventListener("click",p(d,rt));const t=e.currentTarget,n=t.dataset,o=game.scenes.get(n.sceneId||n.documentId),s=(a=t.parentElement)==null?void 0:a.classList.contains("search-results");if(o&&o.sheet){const r=o.sheet.render;o.sheet.render=function(){return this},setTimeout(()=>{o.sheet.render=r},300)}p(d,Ce)&&(clearTimeout(p(d,Ce)),A(d,Ce,null)),A(d,Ce,setTimeout(()=>{s&&(o.navigation=!0,d.selectedFolder=d.selectFolder(de)),o.view(),d.refreshFolderView(),A(d,Ce,null)},250))}),T(d,Et,e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset,o=game.scenes.get(n.sceneId||n.documentId);p(d,Ce)&&(clearTimeout(p(d,Ce)),A(d,Ce,null)),o.activate(),d.refreshFolderView()}),T(d,An,e=>{var t;switch(e.stopPropagation(),e.preventDefault(),O.useNavBackButton){case nt.defaultScenes.name:d.selectedFolder=d.selectFolder(de),g.log("onBackButton",[nt.defaultScenes.name]);break;case nt.lastScene.name:const n=p(d,pe).length,o=n?p(d,pe)[n-2]:null,s=o?(t=game.scenes)==null?void 0:t.get(o):null;if(s){s.view();const r=!(s.folder&&d.selectedFolder.id===s.folder.id)&&s.navigation||!s.folder?de:s.folder.id;d.selectedFolder=d.selectFolder(r),p(d,pe).splice(n-1,1)}g.log("onBackButton",[s,o,p(d,pe)]);break}d.refreshFolderView()}),T(d,Gn,e=>{e.stopPropagation(),e.preventDefault(),d.selectedFolder=d.selectFolder(de),d.refreshFolderView()}),T(d,je,e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("click",p(d,rt));const n=e.currentTarget.dataset,o=d.selectFolder(n.folderId||"");o!==d.selectedFolder&&(O.navPos=0),d.selectedFolder=o,d.refreshFolderView()}),w(d,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;d.searchValue=n,d.updateSearchResults(n)}),T(d,Lo,e=>{var o,s,a,r;e.preventDefault(),e.stopPropagation();let t=((s=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:s.sceneId)||"",n=((r=(a=e.currentTarget)==null?void 0:a.dataset)==null?void 0:r.folderId)||"";t?game.scenes.get(t).view():n&&(d.selectedFolder=d.selectFolder(n),d.refreshFolderView())}),w(d,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!O.navFoldersForPlayers||!O.navFoldersEnabled||!O.sceneNavEnabled});let he=d;var Lt;const v=class v{static registerSettings(){const e=E();g.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{const c=l[1];g.log("Registering... ",[l],!0);const u={name:c.label,hint:c.hint,default:c.default,type:c.propType,scope:c.scope,config:c.config,requiresReload:c.requiresReload||!1,onChange:m=>v.apply(c.tag,m)};(c.choices||c.options)&&(u.choices=c.choices||c.options),await game.settings.register(Se,c.tag,u),v.get(c.tag)===void 0&&(g.log("resetting...",[c.tag]),v.set(c.tag,c.default))}),game.keybindings.register(Se,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{v.hideInterface()},restricted:!1}),v.applyThemeSettings(),v.applyCustomCSS(),v.applyModuleAdjustments(),Object.entries(Os()).forEach(async l=>{const c=l[1],u={name:c.tag,label:c.label,hint:c.hint,icon:c.icon,type:c.propType,restricted:c.restricted};await game.settings.registerMenu(Se,c.tag,u)}),Hooks.on(U.RENDER_SCENE_CONTROLS,v.applyLeftControlsSettings),Hooks.on(U.RENDER_PLAYERS_LIST,Me.applyPlayersListSettings),Hooks.on(U.RENDER_HOTBAR,()=>{v.firstLoad&&(v.firstLoad=!1,v.applyHotBarCollapse()),v.applyHotBarSettings()}),v.applyDebugSettings(),v.applyChatStyles(),v.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{v.apply(e[l].tag)}),e.cameraDockMenu.fields.forEach(l=>{v.apply(e[l].tag)}),e.customFontsMenu.fields.forEach(l=>{v.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{v.applyLeftControlsSettings(e[l].tag)}),v.applyUiScale(),g.log("game settings",[game.settings])}static get(e,t=Se){if(!e)return null;let n=!1;if(t===Se)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,g.log("GET Setting",[s,n])}return n}static set(e,t,n=Se){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),g.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{g.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,s,a,r;const n=E();switch(t===void 0&&(t=v.get(e)),g.log("SettingsUtil.apply",[e,t,v.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:v.applyHotBarSettings();break;case n.collapseMacroBar.tag:v.applyHotBarCollapse();break;case n.playerListAvatars.tag:Me.applyAvatars();break;case n.autoHidePlayerList.tag:Me.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:v.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:v.applyLeftControlsSettings(e,t);break;case n.enableFloatingDock.tag:se.currSettings.enableFloatingDock=t;break;case n.dockHeight.tag:se.currSettings.dockHeight=t,v.applyCameraHeight(t);break;case n.dockWidth.tag:se.currSettings.dockWidth=t,v.applyCameraWidth(t);break;case n.dockPosX.tag:se.currSettings.dockPosX=t,v.applyCameraPosX(t);break;case n.dockPosY.tag:se.currSettings.dockPosY=t,v.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:se.currSettings.defaultVideoWidth=t,se.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:se.currSettings.dockResizeOnUserJoin=t,se.applyDockResize(t);break;case n.chatBorderColor.tag:wt.chatBorderColor=v.get(n.chatBorderColor.tag),v.applyBorderColors();break;case n.enableChatStyles.tag:wt.enableChatStyles=v.get(n.enableChatStyles.tag),v.applyChatStyles();break;case n.enforceDarkMode.tag:v.resetFoundryThemeSettings();break;case n.debugMode.tag:v.applyDebugSettings();break;case n.sceneNavEnabled.tag:O.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:O.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:O.navShowRootFolders=t;break;case n.sceneClickToView.tag:O.sceneClickToView=t,(o=game.scenes)==null||o.directory.render(),he.refreshFolderView();break;case n.useSceneIcons.tag:O.useSceneIcons=t,(s=game.scenes)==null||s.directory.render(),he.refreshFolderView();break;case n.useNavBackButton.tag:O.useNavBackButton=t,(a=ui.nav)==null||a.render();break;case n.useScenePreview.tag:O.useScenePreview=t,(r=ui.nav)==null||r.render();break;case n.sceneNavAlias.tag:O.sceneNavAlias=t,he.refreshFolderView();break;case n.navStartCollapsed.tag:O.navStartCollapsed=t;break;case n.showFolderListOnClick.tag:O.showFolderListOnClick=t,he.refreshFolderView();break;case n.showNavOnHover.tag:O.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:O.isCollapsed=v.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:v.applySceneNavPos();break;case n.colorTheme.tag:v.applyThemeSettings();break;case n.customStyles.tag:v.applyCustomCSS();break;case n.adjustOtherModules.tag:v.applyModuleAdjustments();break;case n.otherModulesList.tag:v.applyOtherModulesList();break;case n.uiScale.tag:v.applyUiScale(t);break}}static applyBorderColors(){const e=E(),t=v.get(e.chatBorderColor.tag),n=document.querySelector("body");t===Tt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===Tt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=E(),t=v.get(e.enableChatStyles.tag),n=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=E(),t=v.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=E();v.get(e.collapseMacroBar.tag)}static applyLeftControlsSettings(e,t){const n=E();v.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:v.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break;case n.controlsBottomBuffer.tag:v.applyControlsBuffer();break;case n.controlsIconSize.tag:v.applyControlIconSize();break}}static applyControlIconSize(){const e=E(),t=v.get(e.controlsIconSize.tag);document.querySelector("body");const n=tt[t]?tt[t].size:tt.regular.size;function o(s){switch(s){case tt.large.name:return"var(--font-size-18);";case tt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[n]),G.addCSSVars("--icon-font-size",o(t)),G.addCSSVars("--left-control-item-size",n),v.applyLeftControlsSettings()}static applyUiScale(e){var o,s,a,r,l,c;const t=E(),n=e||v.get(t.uiScale.tag);n===Yn.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(s=document.querySelector("#interface"))==null||s.classList.remove("scale-large"),v.set(t.controlsIconSize.tag,n),G.addCSSVars("--macro-size","50px")):n===Yn.large.name?((a=document.querySelector("#interface"))==null||a.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),v.set(t.controlsIconSize.tag,n),G.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(c=document.querySelector("#interface"))==null||c.classList.remove("scale-large"),v.set(t.controlsIconSize.tag,n),G.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=E(),t=v.get(e.leftControlsMenu.tag),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;G.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applySceneNavPos(e){const t=E();O.navPos=e||v.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=E(),n=v.get(t.dockPosX.tag),o=e||n;se.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=E(),n=v.get(t.dockPosY.tag),o=e||n;se.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=E(),n=v.get(t.dockWidth.tag),o=e||n;se.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=E(),n=v.get(t.dockHeight.tag),o=e||n;se.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=E(),o=n.customFontsMenu.fields,s={};switch(g.log("applyCustomFonts",[e,t]),o.forEach(a=>{s[a]=v.get(n[a].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:G.addCSSVars("--crlngn-font-family",t||s.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:G.addCSSVars("--crlngn-font-titles",t||s.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:G.addCSSVars("--crlngn-font-journal-body",t||s.journalFontBody||s.journalFontBody||"");break;case n.journalFontTitles.tag:G.addCSSVars("--crlngn-font-journal-title",t||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var a,r;const e=E(),t=G.isModuleOn("monks-player-settings"),n=G.isModuleOn("force-client-settings"),o=v.get(e.enforceDarkMode.tag);if(o&&t){(a=game.user)!=null&&a.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),v.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),v.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","uiConfig")||null;if(g.log("resetFoundryThemeSettings",[s,game.settings]),o){const l={...s,colorScheme:{application:s.colorScheme.applications===""?"dark":s.colorScheme.applications,interface:s.colorScheme.interface===""?"dark":s.colorScheme.interface}};game.settings.set("core","uiConfig",l)}}static applyDebugSettings(e){const t=E();g.debugOn=e||v.get(t.debugMode.tag)}};Lt=new WeakMap,T(v,Lt,!1),w(v,"firstLoad",!0),w(v,"applyThemeSettings",e=>{const t=E(),n=e||v.get(t.colorTheme.tag)||"",o=document.querySelector("body");g.log("applyThemeSettings",[e,n,v.get(t.colorTheme.tag)]),qe.forEach(s=>{s.className&&o.classList.remove(s.className)}),n&&o.classList.add(n)}),w(v,"applyCustomCSS",e=>{const t=E(),n=e||v.get(t.customStyles.tag)||"";G.addCustomCSS(n)}),w(v,"applyModuleAdjustments",e=>{const t=E();(e||v.get(t.adjustOtherModules.tag)||!1)&&lt.addModuleClasses()}),w(v,"applyOtherModulesList",e=>{const t=E(),n=e||v.get(t.otherModulesList.tag);g.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?v.set(t.adjustOtherModules.tag,!1):v.set(t.adjustOtherModules.tag,!0),lt.addModuleClasses()}),w(v,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");p(v,Lt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),A(v,Lt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),A(v,Lt,!0))});let L=v;var $e,cn,dn;const X=class X{static init(){g.log("LeftControls - init",[]),Hooks.on(U.RENDER_SCENE_CONTROLS,X.initSceneControls),X.initSceneControls()}static resetLocalVars(){A(X,$e,document.querySelector("#ui-left #controls")),A(X,cn,document.querySelector("#ui-left"))}static initSceneControls(){g.log("initSceneControls",[]),X.resetLocalVars(),X.observeControlsWidth()}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!p(X,$e))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};A(X,dn,new ResizeObserver(n=>{t(()=>X.updateCSSVars(),250)})),p(X,dn).observe(p(X,$e),{box:"border-box"}),X.updateCSSVars()}static updateCSSVars(){if(!p(X,$e))return;let e=parseInt(p(X,cn).offsetWidth),t=parseInt(p(X,$e).offsetWidth),n=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&G.addCSSVars("--ui-controls-margin-left",n+"px")}};$e=new WeakMap,cn=new WeakMap,dn=new WeakMap,T(X,$e),T(X,cn),T(X,dn);let po=X;class ys{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=E();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){g.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=L.get(e.lastUpdateId.tag);if(g.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),L.set(e.lastUpdateId.tag,n.id),g.log("checkForUpdates SUCCESS",[n.id])}catch(t){g.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}w(ys,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());class la{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Fn;const Yt=class Yt{static init(){Hooks.once(U.INIT,()=>{var n,o;document.querySelector("body").classList.add(Se),(n=document.querySelector("#ui-middle"))==null||n.classList.add(Se),g.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},L.registerSettings();const e=E(),t=L.get(e.disableUI.tag);if(g.log(U.INIT,[t]),t){document.querySelector("body").classList.remove(Se),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(Se);return}O.navFoldersEnabled&&(window.crlngnUI.SceneNavFolders=he,he.init()),po.init(),wt.init(),Me.init(),Hooks.on(U.RENDER_CHAT_MESSAGE,p(Yt,Fn))}),Hooks.once(U.READY,()=>{g.log("Core Ready",[]);const e=E();var t=L.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),la.init(),Me.applyPlayersListSettings(),lt.init(),ys.init(),L.get(e.enableChatStyles.tag)&&Yt.addCSSLocalization(),L.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";G.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),G.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),G.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),G.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),G.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),G.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),G.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),G.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),G.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),G.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Fn=new WeakMap,T(Yt,Fn,(e,t)=>{g.log(U.RENDER_CHAT_MESSAGE,[e,t]),wt.enrichCard(e,t)});let ho=Yt;ho.init();
//# sourceMappingURL=crlngn-ui.js.map
