var Ct=Object.defineProperty;var ot=I=>{throw TypeError(I)};var Lt=(I,e,t)=>e in I?Ct(I,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):I[e]=t;var N=(I,e,t)=>Lt(I,typeof e!="symbol"?e+"":e,t),Ve=(I,e,t)=>e.has(I)||ot("Cannot "+t);var m=(I,e,t)=>(Ve(I,e,"read from private field"),t?t.call(I):e.get(I)),L=(I,e,t)=>e.has(I)?ot("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(I):e.set(I,t),M=(I,e,t,s)=>(Ve(I,e,"write to private field"),s?s.call(I,t):e.set(I,t),t),R=(I,e,t)=>(Ve(I,e,"access private method"),t);const k={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},V="crlngn-ui",De=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Oe=class Oe{static log(e="",t=[],s=!1){try{const n=Oe.debugOn;if(!(s||n))return;console.log(...De,e,...t)}catch{console.log(...De,e,...t)}}static warn(e="",t=[]){console.warn(...De,e,...t)}static logError(e,t){var s;t.ui&&((s=ui.notifications)==null||s.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...De,e)}};N(Oe,"debugOn",!1);let d=Oe;const E={select:"select",checkbox:"checkbox",text:"text",number:"number"},v={client:"client",world:"world"},be={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},ue={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},W=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function h(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:E.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:v.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:v.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:E.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:ue.playerColor.name},scope:v.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:E.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:be.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:v.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:E.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:E.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:E.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:E.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:E.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:E.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:v.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:E.button,fields:["sceneNavEnabled","navFoldersEnabled","navFoldersForPlayers","showFolderListOnClick","showNavOnHover"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navFoldersForPlayers:!1,showFolderListOnClick:!1,showNavOnHover:!1},scope:v.client,config:!1,requiresReload:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:v.client,config:!1},showFolderListOnClick:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:v.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:v.client,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:E.number,default:0,scope:v.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:v.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:E.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:v.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:E.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:v.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:E.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:v.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:E.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:v.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:E.text,propType:String,default:"",scope:v.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:E.checkbox,propType:Boolean,default:!1,scope:v.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:E.text,propType:String,default:"",scope:v.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:E.text,default:ue.playerColor.name,scope:v.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:v.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:E.number,default:200,scope:v.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:E.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:be.small.name,scope:v.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:E.checkbox,propType:Boolean,default:!1,scope:v.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:E.checkbox,propType:Boolean,default:!0,scope:v.client,config:!1}}}const{ApplicationV2:Et,HandlebarsApplicationMixin:Tt}=foundry.applications.api;var fe,at,it;const ee=class ee extends Tt(Et){static get DEFAULT_OPTIONS(){return{id:h().cameraDockMenu.tag,actions:{redefine:R(ee,fe,it)},form:{handler:R(ee,fe,at),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=h(),s={...S.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return d.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};fe=new WeakSet,at=async function(e,t,s){const n=h();let a=S.get(n.cameraDockMenu.tag),o=a.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(s.object);await S.set(n.cameraDockMenu.tag,i),a=S.get(n.cameraDockMenu.tag),d.log("Saving settings:",[n.cameraDockMenu.tag,t,s.object,i,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.enableFloatingDock!=o&&location.reload()},it=async function(e,t){const s=h(),a=this.element.querySelectorAll("input, select"),o=s.cameraDockMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.cameraDockMenu.default])},L(ee,fe),N(ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let $e=ee;const{ApplicationV2:vt,HandlebarsApplicationMixin:Mt}=foundry.applications.api;var me,lt,rt;const te=class te extends Mt(vt){static get DEFAULT_OPTIONS(){return{id:h().chatMessagesMenu.tag,actions:{redefine:R(te,me,rt)},form:{handler:R(te,me,lt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=h(),s=S.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,a={},o={},i={};n.forEach(l=>{if(d.log("_prepareContext",[t[l].oldName]),t[l]){const p=S.get(t[l].tag);a[l]=t[l],o[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,i[l]=t[l].default}}),d.log("_prepareContext",[o,i]);const r={...o,default:{...i},isGM:game.user.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return d.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=h(),n=S.get(s.chatMessagesMenu.tag);d.log("_onRender",[e,t,n])}};me=new WeakSet,lt=async function(e,t,s){const n=h();e.preventDefault(),e.stopPropagation();const a=n.chatMessagesMenu.fields,o=foundry.utils.expandObject(s.object),i=S.get(n.chatBorderColor.tag);d.log("Compared settings:",[o.chatBorderColor,i]),a.forEach(l=>{d.log("Saving setting >>",[n[l].tag,o[l]]),o[l]!==void 0&&S.set(n[l].tag,o[l])}),await S.set(n.chatMessagesMenu.tag,o),o.chatBorderColor!==i&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},rt=async function(e,t){const s=h(),a=this.element.querySelectorAll("input, select"),o=s.chatMessagesMenu.fields,i={};o.forEach(r=>{s[r]&&(s[r],i[r]=s[r].default)}),a.forEach(r=>{r.value=i[r.name]})},L(te,me),N(te,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let je=te;class C{static isModuleOn(e){var s;const t=(s=game.modules)==null?void 0:s.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(n=>typeof e[n]=="function"&&n!=="constructor"&&n!=="prototype"&&n!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(n=>{const a=e[n];e[n]=function(...o){return console.log(`TEST: Executing: ${e.name}.${n}`),a.apply(this,o)}});const s=Object.getOwnPropertyNames(e.prototype).filter(n=>typeof e.prototype[n]=="function"&&n!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,s),s.forEach(n=>{const a=e.prototype[n];e.prototype[n]=function(...o){return console.log(`TEST: Executing: ${e.name}.${n}`),a.apply(this,o)}})}}N(C,"getAllFonts",async()=>{var o;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},s=Object.entries(t).map(([i])=>i),n=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){let r="";if(i.ownerNode.tagName==="STYLE")r=i.ownerNode.textContent;else if(i.ownerNode.tagName==="LINK")try{if((o=i.href)!=null&&o.startsWith(window.location.origin)){const b=i.cssRules||i.rules;r=Array.from(b).map(y=>y.cssText).join(`
`)}}catch(b){d.warn("Could not read stylesheet rules:",[b])}const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let p;for(;(p=l.exec(r))!==null;){const b=p[1];if(d.log("Found import URL:",[b]),b.includes("fonts.googleapis.com")){const y=b.match(/family=([^&]+)/);y&&decodeURIComponent(y[1]).split("|").map(w=>w.split(":")[0].replace(/\+/g," ")).forEach(w=>{n.add(w)})}else try{const y=await fetch(b);y.ok?(css.match(/@font-face\s*{[^}]+}/g)||[]).forEach(w=>{const P=w.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(P){const q=P[1].trim();n.add(q)}}):y.status===404?d.warn("getAllFonts() - Resource not found (404)",[b]):d.warn("getAllFonts() - HTTP error",[y.status])}catch(y){d.warn("Error processing imported CSS:",[y])}}}if(!i.href||i.href.startsWith(window.location.origin))try{const r=i.cssRules||i.rules;for(const l of r)if(l instanceof CSSFontFaceRule){const p=l.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();n.add(p)}}catch(r){d.warn("Could not read stylesheet rules:",[r])}}catch(r){d.warn("Error processing stylesheet:",[r])}return d.log("Found fonts:",[{foundry:Array.from(e),custom:s,cssImported:Array.from(n)}]),Array.from(new Set([...e,...s,...n])).filter(i=>!i.includes("FontAwesome")&&!i.includes("Font Awesome")).map(i=>i.replace(/['"`]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))}),N(C,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t}),N(C,"addCSSVars",(e,t)=>{let s=document.querySelector("#crlngn-ui-vars");if(!s){const y=document.querySelector("body");s=document.createElement("style"),s.id="crlngn-ui-vars",s.textContent=`body.crlngn-ui {
}
`,y.prepend(s)}let n=s.textContent,a=n.indexOf("body.crlngn-ui {"),o=n.indexOf("}",a);a===-1&&(n=`body.crlngn-ui {
}
`,a=0,o=n.indexOf("}"));const r=n.substring(a+16,o).split(";").map(y=>y.trim()).filter(y=>y!==""),l={};r.forEach(y=>{const T=y.split(":");if(T.length>=2){const w=T[0].trim(),P=T.slice(1).join(":").trim();w&&(l[w]=P)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),l[e]=t;const p=Object.entries(l).map(([y,T])=>`  ${y}: ${T};`).join(`
`),b=n.substring(0,a)+`body.crlngn-ui {
`+p+`
}`+n.substring(o+1);s.textContent=b}),N(C,"addCustomCSS",e=>{let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const s=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,s.appendChild(t)}t.textContent=e});const{ApplicationV2:kt,HandlebarsApplicationMixin:Rt}=foundry.applications.api;var J,X,ct,dt,ut;const x=class x extends Rt(kt){static get DEFAULT_OPTIONS(){return{id:h().customFontsMenu.tag,actions:{redefine:R(x,X,ut)},form:{handler:R(x,X,ct),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=h(),s=S.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,a={},o={},i={};return n.forEach(l=>{if(t[l]){const p=S.get(t[l].tag);a[l]=t[l],o[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,i[l]=t[l].default}}),{...o,default:{...i},fontList:C.getAllFonts(),fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(x,J,this.element),m(x,J).querySelectorAll('input[type="text"]').forEach(a=>{const o=a.closest(".dropdown-wrapper"),i=o==null?void 0:o.querySelector(".dropdown-options");if(!o||!i)return;const r=()=>{var l;R(l=x,X,dt).call(l),i.classList.add("active")};a.addEventListener("focus",r),a.addEventListener("click",r),a.addEventListener("keydown",l=>{const p=i.classList.contains("active"),b=Array.from(i.querySelectorAll(".dropdown-option"));let y=b.findIndex(T=>T.classList.contains("highlighted"));l.key==="ArrowDown"||l.key==="ArrowUp"?(l.preventDefault(),p||i.classList.add("active"),b.forEach(T=>T.classList.remove("highlighted")),y===-1?y=l.key==="ArrowDown"?0:b.length-1:y=l.key==="ArrowDown"?(y+1)%b.length:(y-1+b.length)%b.length,b[y]&&(b[y].classList.add("highlighted"),b[y].scrollIntoView({block:"nearest"}))):l.key==="Enter"?(l.preventDefault(),p&&y!==-1&&b[y]&&b[y].click()):l.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",l=>{o.contains(l.target)||i.classList.remove("active")})}),m(x,J).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",o=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let r=a.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),i.value=r,a.closest(".dropdown-options").classList.remove("active")})})}};J=new WeakMap,X=new WeakSet,ct=async function(e,t,s){const n=h();e.preventDefault(),e.stopPropagation();const a=n.customFontsMenu.fields,o=foundry.utils.expandObject(s.object);a.forEach(i=>{o[i]!==void 0&&(d.log("Saving setting:",[o[i]]),S.set(n[i].tag,o[i]))}),S.set(n.customFontsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},dt=function(){m(x,J).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ut=async function(e,t){const s=h(),a=this.element.querySelectorAll("input[type=text]"),o=s.customFontsMenu.fields,i={};o.forEach(r=>{s[r]&&(s[r],i[r]=s[r].default)}),a.forEach(r=>{r.value=i[r.name]})},L(x,X),L(x,J),N(x,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let We=x;const{ApplicationV2:It,HandlebarsApplicationMixin:wt}=foundry.applications.api;var pe,gt,ft;const se=class se extends wt(It){static get DEFAULT_OPTIONS(){return{id:h().leftControlsMenu.tag,actions:{redefine:R(se,pe,ft)},form:{handler:R(se,pe,gt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=h(),s=S.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,a={},o={},i={};n.forEach(l=>{if(t[l]){const p=S.get(t[l].tag);a[l]=t[l],o[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,i[l]=t[l].default}});const r={...o,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return d.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=h(),n=S.get(s.leftControlsMenu.tag);d.log("_onRender",[e,t,n])}};pe=new WeakSet,gt=async function(e,t,s){const n=h();e.preventDefault(),e.stopPropagation();const a=n.leftControlsMenu.fields,o=foundry.utils.expandObject(s.object);a.forEach(i=>{o[i]!==void 0&&(d.log("Saving setting:",[o[i]]),S.set(n[i].tag,o[i]))}),await S.set(n.leftControlsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ft=async function(e,t){const s=h(),a=this.element.querySelectorAll("input, select"),o=s.leftControlsMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.leftControlsMenu.default])},L(se,pe),N(se,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ye=se;const{ApplicationV2:Gt,HandlebarsApplicationMixin:Ft}=foundry.applications.api;var he,mt,pt;const ne=class ne extends Ft(Gt){static get DEFAULT_OPTIONS(){return{id:h().sceneNavMenu.tag,actions:{redefine:R(ne,he,pt)},form:{handler:R(ne,he,mt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=h(),s=S.get(t.sceneNavMenu.tag),n=t.sceneNavMenu.fields,a={},o={},i={};n.forEach(l=>{if(t[l]){const p=S.get(t[l].tag);a[l]=t[l],o[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,i[l]=t[l].default}});const r={...o,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return d.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};he=new WeakSet,mt=async function(e,t,s){e.preventDefault(),e.stopPropagation();const n=h(),a=n.sceneNavMenu.fields;let o=S.get(n.sceneNavEnabled.tag),i=S.get(n.navFoldersEnabled.tag);const r=foundry.utils.expandObject(s.object);a.forEach(b=>{r[b]!==void 0&&(d.log("Saving setting:",[r[b]]),S.set(n[b].tag,r[b]))});let l=S.get(n.sceneNavEnabled.tag),p=S.get(n.navFoldersEnabled.tag);d.log("Saving settings...",[t,s.object,r]),await S.set(n.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(o!==l||i!==p)&&location.reload()},pt=async function(e,t){const s=h(),a=this.element.querySelectorAll("input, select"),o=s.sceneNavMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.sceneNavMenu.default])},L(ne,he),N(ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Xe=ne;const{ApplicationV2:At,HandlebarsApplicationMixin:Pt}=foundry.applications.api;var Q,K,ht,yt,St;const U=class U extends Pt(At){static get DEFAULT_OPTIONS(){return{id:h().themeAndStylesMenu.tag,actions:{redefine:R(U,K,St)},form:{handler:R(U,K,ht),closeOnSubmit:!0},position:{width:600,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=h();S.get(t.themeAndStylesMenu.tag);const s=t.themeAndStylesMenu.fields,n={},a={},o={};s.forEach(l=>{if(t[l]){const p=S.get(t[l].tag);n[l]=t[l],a[l]=p!==void 0?p:t[l].default,o[l]=t[l].default}});const i=W.find(l=>l.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||W[0].label;const r={...a,default:{...o},fields:{...n},selectedTheme:i,themes:W,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(U,Q,this.element),this._themes=W,m(U,Q).querySelectorAll('input[type="text"]').forEach(o=>{const i=o.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const l=()=>{var p;R(p=U,K,yt).call(p),r.classList.add("active")};o.addEventListener("focus",l),o.addEventListener("click",l),o.addEventListener("keydown",p=>{const b=r.classList.contains("active"),y=Array.from(r.querySelectorAll(".dropdown-option"));let T=y.findIndex(w=>w.classList.contains("highlighted"));p.key==="ArrowDown"||p.key==="ArrowUp"?(p.preventDefault(),b||r.classList.add("active"),y.forEach(w=>w.classList.remove("highlighted")),T===-1?T=p.key==="ArrowDown"?0:y.length-1:T=p.key==="ArrowDown"?(T+1)%y.length:(T-1+y.length)%y.length,y[T]&&(y[T].classList.add("highlighted"),y[T].scrollIntoView({block:"nearest"}))):p.key==="Enter"?(p.preventDefault(),b&&T!==-1&&y[T]&&y[T].click()):p.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",p=>{i.contains(p.target)||r.classList.remove("active")})});const n=m(U,Q).querySelectorAll(".dropdown-option"),a=this;n.forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",function(i){d.log("option",[o,o.querySelector(".theme-name")]);const r=o.closest(".dropdown-wrapper").querySelector("input");let l=o.querySelector(".theme-name").innerHTML.toString();if(r.value=l,r.name==="colorTheme"){const b=a._themes.find(y=>y.label===l);a._selectedTheme=b,a._updateThemePreview(b)}o.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(d.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((s,n)=>{s.style.setProperty("background-color",e.colorPreview[n])})}};Q=new WeakMap,K=new WeakSet,ht=async function(e,t,s){const n=h();e.preventDefault(),e.stopPropagation();const a=n.themeAndStylesMenu.fields,o=foundry.utils.expandObject(s.object),i=W.find(r=>r.label===o.colorTheme);o.colorTheme=i?i.className:"",a.forEach(r=>{o[r]!==void 0&&(d.log("Saving setting:",[o[r]]),S.set(n[r].tag,o[r]))}),S.set(n.themeAndStylesMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},yt=function(){m(U,Q).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},St=async function(e,t){const s=h(),a=this.element.querySelectorAll("input[type=text]"),o=s.themeAndStylesMenu.fields,i={};o.forEach(l=>{s[l]&&(s[l],i[l]=s[l].default)});const r=W.find(l=>l.label===s.colorTheme.default);i.colorTheme=(r==null?void 0:r.label)||W[0].label,a.forEach(l=>{l.value=i[l.name]})},L(U,K),L(U,Q),N(U,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ke=U;function Dt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:We,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-cog",propType:Ke,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:je,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Ye,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:$e,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Xe,restricted:!1}}}var Ce,Le,Ee,Te,ve,Me,ke,z,Ze,Je,Qe,_e;const u=class u{static init(){const e=h(),t=S.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(k.RENDER_CAMERA_VIEWS,u.onRenderFloating),d.log("CameraUtil",[t]),u.onRenderFloating()):(Hooks.on(k.RENDER_CAMERA_VIEWS,u.onRenderPlain),u.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var a,o,i;const e=h(),t=S.get(e.cameraDockMenu.tag);(a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-ui"),u.cameraContainer=document.querySelector("#camera-views .camera-container");const s=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");d.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),u.cameraContainer&&n&&s&&((o=u.cameraContainer)==null||o.insertBefore(s,n),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),u.makeDraggable(),u.makeResizeable(),u.resetPositionAndSize(),u.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(d.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const s=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,s)}static makeDraggable(){var e;(e=u.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,o;const s=document.querySelector("body.crlngn-ui");if((a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;s==null||s.addEventListener("mousemove",R(u,z,Je)),s==null||s.addEventListener("mouseup",R(u,z,Ze));const n=C.getOffsetBottom(u.cameraContainer);u.isDragging=!0,M(u,Ce,t.clientX-((o=u.cameraContainer)==null?void 0:o.offsetLeft)),M(u,Le,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(u.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),u.cameraContainer.append(t),t.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),u.isResizing=!0,M(u,Ee,s.clientX),M(u,Te,s.clientY),M(u,ke,parseInt(getComputedStyle(u.cameraContainer).bottom)||0),M(u,ve,u.cameraContainer.offsetWidth),M(u,Me,u.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",R(u,z,Qe)),e==null||e.addEventListener("mouseup",R(u,z,_e))})}}static resetPositionAndSize({x:e,y:t,w:s,h:n}={x:null,y:null,w:null,h:null}){const a=h(),o=S.get(a.cameraDockMenu.tag);if(!(!o.enableFloatingDock||!u.cameraContainer))if(!e&&!t&&!s&&!n){const i=o.dockPosX||0,r=o.dockPosY||0,l=o.dockWidth||0,p=o.dockHeight||0;u.cameraContainer.style.left=`${i}px`,u.cameraContainer.style.bottom=`${r}px`,u.cameraContainer.style.width=`${l}px`,u.cameraContainer.style.height=`${p}px`}else e&&(u.cameraContainer.style.left=`${e}px`),t&&(u.cameraContainer.style.bottom=`${t}px`),s&&(u.cameraContainer.style.width=`${s}px`),n&&(u.cameraContainer.style.height=`${n}px`)}};Ce=new WeakMap,Le=new WeakMap,Ee=new WeakMap,Te=new WeakMap,ve=new WeakMap,Me=new WeakMap,ke=new WeakMap,z=new WeakSet,Ze=function(e){var n,a;const t=h(),s={...S.get(t.cameraDockMenu.tag)};if(u.isDragging){const o=document.querySelector("body.crlngn-ui");s.dockPosX=parseInt((n=u.cameraContainer)==null?void 0:n.style.left)||0,s.dockPosY=parseInt((a=u.cameraContainer)==null?void 0:a.style.bottom)||0,s.dockPosY<=0&&(s.dockPosY=0),S.set(t.cameraDockMenu.tag,s),o==null||o.removeEventListener("mousemove",R(u,z,Je)),o==null||o.removeEventListener("mouseup",R(u,z,Ze)),u.isDragging=!1,e.stopPropagation()}},Je=function(e){if(u.isDragging&&(d.log("mousemove",[e.target.parentNode]),u.cameraContainer)){let t=e.clientX-m(u,Ce),s=window.innerHeight-e.clientY-m(u,Le);t+u.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-u.cameraContainer.offsetWidt),u.cameraContainer.style.left=`${t}px`,s+u.cameraContainer.offsetHeight>window.innerHeight&&(s=window.innerHeight-u.cameraContainer.offsetHeight),u.cameraContainer.style.bottom=`${s}px`}},Qe=function(e){if(!u.isResizing)return;const t=m(u,ve)+(e.clientX-m(u,Ee)),s=e.clientY-m(u,Te),n=m(u,Me)+s,a=m(u,ke)-s;u.cameraContainer.style.width=`${t}px`,u.cameraContainer.style.height=`${n}px`,u.cameraContainer.style.bottom=`${a}px`},_e=function(){var n,a,o,i,r,l;const e=h(),t={...S.get(e.cameraDockMenu.tag)},s=document.querySelector("body.crlngn-ui");u.isResizing=!1,s==null||s.removeEventListener("mousemove",R(u,z,Qe)),s==null||s.removeEventListener("mouseup",R(u,z,_e)),d.log("onStopResize",[(n=u.cameraContainer)==null?void 0:n.style.width,(a=u.cameraContainer)==null?void 0:a.style.height,(o=u.cameraContainer)==null?void 0:o.style.bottom]),t.dockWidth=parseInt(((i=u.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((r=u.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((l=u.cameraContainer)==null?void 0:l.style.bottom)||0),S.set(e.cameraDockMenu.tag,t)},L(u,z),L(u,Ce,0),L(u,Le,0),N(u,"isDragging",!1),N(u,"cameraContainer"),N(u,"isResizing",!1),L(u,Ee,0),L(u,Te,0),L(u,ve,0),L(u,Me,0),L(u,ke,0);let Z=u;const B=class B{static init(){const e=h();B.enableChatStyles=S.get(e.enableChatStyles.tag),B.chatBorderColor=S.get(e.chatBorderColor.tag)}};N(B,"chatBorderColor"),N(B,"enableChatStyles"),N(B,"enrichCard",async(e,t)=>{var o,i,r,l,p,b,y,T;d.log("renderChatMessage",[B.chatBorderColor,B.enableChatStyles,ue.playerColor.name,(o=e.author)==null?void 0:o.id]);const s=((l=(r=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:r.activity)==null?void 0:l.type)||((y=(b=(p=e.flags)==null?void 0:p.dnd5e)==null?void 0:b.roll)==null?void 0:y.type)||"custom";let n=t.get?t.get(0):t;if(!n)return;n.classList.add(s),n.classList.add("crlngn");const a=n.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(w=>{const P=w.querySelector(".visible-dc"),q=w.querySelector(".hidden-dc");d.log("enrichCard",[P,q]),P.setAttribute("data-ability",w.getAttribute("data-ability")||""),P.setAttribute("data-dc",w.getAttribute("data-dc")||""),q.setAttribute("data-ability",w.getAttribute("data-ability")||"")}),B.chatBorderColor===ue.playerColor.name&&((T=e.author)!=null&&T.id)&&n.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let ge=B;var ae;const O=class O{static init(){Hooks.on(k.RENDER_PLAYERS_LIST,O.checkPlayersList),Hooks.on(k.RENDER_HOTBAR,O.checkPlayersList),C.isModuleOn("foundry-taskbar")&&Hooks.on(k.UPDATE_USER,O.checkTaskbarLock),O.checkTaskbarLock()}};ae=new WeakMap,L(O,ae),N(O,"checkTaskbarLock",()=>{var a,o,i;const e=C.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(d.log("checkTaskbarLock",[t]),!e||!t)return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(o=t.taskbarSettings)!=null&&o.locked?C.addCSSVars("--crlngn-sidebar-bottom",s?"50px":"0px"):C.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?C.addCSSVars("--crlngn-taskbar-height","50px"):C.addCSSVars("--crlngn-taskbar-height","10px");const n=document.querySelector("#ft-move-players-macro");n&&(n.innerHTML=""),O.checkPlayersList()}),N(O,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),s=C.isModuleOn("foundry-taskbar"),n=s?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=s?game.settings.get("foundry-taskbar","dockMacroBar"):!1;d.log("checkPlayersList",[n,s,a,game.settings]);let o=10;n&&(o=250);const i=document.querySelector("#hotbar");i&&i.style.setProperty("visibility","hidden"),clearTimeout(m(O,ae)),M(O,ae,setTimeout(()=>{n?(d.log("checkPlayersList TEST",[n]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),i&&i.style.removeProperty("visibility"),clearTimeout(m(O,ae))},o))});let ze=O;var D,A,_,ie,le,re,Re,Ie,xe,Ue;const f=class f{static toggleNav(e){clearTimeout(m(f,Ie)),M(f,Ie,setTimeout(()=>{f.resetLocalVars(),e?(ui.nav.collapse(),m(f,re).classList.add("navigation-collapsed")):(ui.nav.expand(),m(f,re).classList.remove("navigation-collapsed"))},500))}static resetLocalVars(){M(f,D,document.querySelector("#navigation")),M(f,ie,document.querySelector("#navigation .nav-item.is-root")),M(f,le,document.querySelector("#nav-toggle")),M(f,re,document.querySelector("#ui-middle")),f.navFoldersEnabled?(M(f,A,document.querySelector("#crlngn-scene-list")),d.log("TopNavigation resetLocalVars",[m(f,A)])):M(f,A,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=m(f,D))==null||e.addEventListener("mouseenter",()=>{if(d.log("TopNavigation mouseenter",[]),!f.isCollapsed||!f.showNavOnHover)return;clearTimeout(m(this,_));const s=document.querySelector("#scene-list");s&&(s.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=m(this,D))==null||t.addEventListener("mouseleave",n=>{if(d.log("TopNavigation mouseleave",[]),!(!f.isCollapsed||!f.showNavOnHover)){if(!n)var n=window.event;n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),M(this,_,setTimeout(()=>{clearTimeout(m(this,_)),M(this,_,null);const a=document.querySelector("#scene-list");a&&(a.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var i,r,l,p,b;f.resetLocalVars();const e=(i=m(this,D))==null?void 0:i.querySelectorAll("button.crlngn-nav"),t=((r=m(this,A))==null?void 0:r.scrollWidth)>=((l=m(this,D))==null?void 0:l.offsetWidth);if(d.log("placeNavButtons",[m(this,A)]),!t||e.length>0)return;const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-left");const n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-chevron-left"),s.addEventListener("click",m(this,xe)),s.append(n);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-right"),a.append(o),a.addEventListener("click",m(this,Ue)),(p=m(this,D))==null||p.appendChild(s),(b=m(this,D))==null||b.appendChild(a)}static setNavPosition(e){var o,i;const t=h();if(!m(this,A))return;const s=e!==void 0?e:f.navPos||0,n=((o=m(this,A))==null?void 0:o.querySelectorAll("li.nav-item:not(.is-root)"))||[],a=((i=n[s])==null?void 0:i.offsetLeft)*-1;m(this,A).style.marginLeft=a+"px",S.set(t.sceneNavPos.tag,s),d.log("setNavPosition",[e,s,n[s],a])}};D=new WeakMap,A=new WeakMap,_=new WeakMap,ie=new WeakMap,le=new WeakMap,re=new WeakMap,Re=new WeakMap,Ie=new WeakMap,xe=new WeakMap,Ue=new WeakMap,L(f,D),L(f,A),L(f,_),L(f,ie),L(f,le),L(f,re),N(f,"sceneFoldersTemplate"),L(f,Re),L(f,Ie),N(f,"sceneNavEnabled"),N(f,"navFoldersEnabled"),N(f,"navFoldersForPlayers"),N(f,"showFolderListOnClick"),N(f,"showNavOnHover"),N(f,"isCollapsed"),N(f,"navPos"),N(f,"init",async()=>{const e=h();f.isCollapsed=S.get(e.sceneNavCollapsed.tag),f.navPos=S.get(e.sceneNavPos.tag),f.resetLocalVars();const t=document.querySelector("#ui-middle");if(d.log("SCENE NAV INIT",[f.sceneNavEnabled]),f.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}const s=C.isModuleOn("monks-scene-navigation");s&&f.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),S.set(e.sceneNavEnabled.tag,!1)),d.log("TopNavigation - init",[s]),s?t.classList.add("with-monks-scene"):(f.resetLocalVars(),oe.renderSceneFolders(),f.setNavPosition(),f.placeNavButtons(),f.toggleNav(S.get(e.sceneNavCollapsed.tag))),Hooks.on(k.RENDER_SCENE_NAV,(n,a,o,i)=>{d.log("SCENE NAV",[n,a,o,i]);const r=h(),l=C.isModuleOn("monks-scene-navigation");d.log(k.RENDER_SCENE_NAV,[l]),l||(d.log("NAV no transition add"),f.navPos=S.get(r.sceneNavPos.tag),oe.init(),f.resetLocalVars(),oe.renderSceneFolders(),m(f,A)&&m(f,A).classList.add("no-transition"),d.log(k.RENDER_SCENE_NAV,[]),f.placeNavButtons(),f.addListeners(),f.setNavPosition(),f.toggleNav(S.get(r.sceneNavCollapsed.tag)),clearTimeout(m(f,Re)),M(f,Re,setTimeout(()=>{m(f,A)&&m(f,A).classList.remove("no-transition"),d.log("NAV no transition remove")},500))),d.log("SCENE NAV STATE",[S.get(r.sceneNavCollapsed.tag)])}),Hooks.on(k.COLLAPSE_SIDE_BAR,n=>{const a=C.isModuleOn("monks-scene-navigation");d.log(k.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",a]),a||f.placeNavButtons()}),Hooks.on(k.COLLAPSE_SCENE_NAV,(n,a)=>{const o=h();S.set(o.sceneNavCollapsed.tag,a),d.log("NAV toggle",[n,a]),f.isCollapsed=a,f.toggleNav(a)}),Hooks.on(k.EXPAND_SCENE_NAV,(n,a)=>{d.log("NAV expand",[n,!1])}),window.addEventListener("resize",()=>{C.isModuleOn("monks-scene-navigation")||f.placeNavButtons()}),d.log("TopNavigation - init",[f.sceneNavEnabled])}),L(f,xe,e=>{var b,y,T,w,P,q,Se;const t=((y=(b=m(f,D))==null?void 0:b.querySelector("#crlngn-scene-folders"))==null?void 0:y.offsetWidth)||0,s=(T=m(f,le))==null?void 0:T.offsetWidth,n=C.isModuleOn("compact-scene-navigation")?((w=m(f,ie))==null?void 0:w.offsetWidth)+t:t,a=(P=m(f,A))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),o=((q=m(f,A))==null?void 0:q.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=a.offsetWidth,r=f.navPos||0,l=Math.floor((((Se=m(f,D))==null?void 0:Se.offsetWidth)-(r===0?n:0)-s*2)/i);d.log("onNavLast",[t,"currPos",r,"items",l,e]);let p=r-l;p=p<0?0:p,d.log("onNavLast",["sceneCount",o.length,r,p]),f.setNavPosition(p)}),L(f,Ue,e=>{var b,y,T,w,P,q,Se;const t=((y=(b=m(f,D))==null?void 0:b.querySelector("#crlngn-scene-folders"))==null?void 0:y.offsetWidth)||0,s=(T=m(f,le))==null?void 0:T.offsetWidth,n=C.isModuleOn("compact-scene-navigation")?((w=m(f,ie))==null?void 0:w.offsetWidth)+t:t,a=(P=m(f,A))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),o=((q=m(f,A))==null?void 0:q.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=a.offsetWidth,r=f.navPos||0,l=Math.floor((((Se=m(f,D))==null?void 0:Se.offsetWidth)-(r===0?n:0)-s*2)/i);d.log("onNavNext",[t,"currPos",r,"items",l,e]);let p=r+l;p=p>o.length?o.length:p,f.setNavPosition(p)});let G=f;const j="Favorites";var ye,bt,Nt,He,$,we,H,Ge,Fe,ce,qe,st;const c=class c{static init(){c.noFolderView()||((!c.folderListData||c.folderListData.length===0)&&(C.isModuleOn("monks-scene-navigation")||c.preloadTemplate(),d.log("SceneNavFolders",[ui.scenes]),c.folderListData=c.getFolders(ui.scenes.folders),c.selectedFolder=c.selectFolder(j)),c.registerHooks())}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||j}static registerHooks(){Hooks.on(k.CREATE_FOLDER,e=>{e.type==="Scene"&&c.refreshFolderView()}),Hooks.on(k.UPDATE_FOLDER,e=>{e.type==="Scene"&&c.refreshFolderView()}),Hooks.on(k.DELETE_FOLDER,e=>{e.type==="Scene"&&c.refreshFolderView()}),Hooks.on(k.CREATE_SCENE,()=>c.refreshFolderView()),Hooks.on(k.UPDATE_SCENE,()=>c.refreshFolderView()),Hooks.on(k.DELETE_SCENE,()=>c.refreshFolderView()),Hooks.on(k.GET_SCENE_NAV_CONTEXT,R(c,ye,bt).bind(c)),Hooks.on(k.GET_SCENE_DIRECTORY_ENTRY_CONTEXT,R(c,ye,Nt).bind(c)),Hooks.on(k.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;const t=document.querySelector("#scenes .directory-list");t==null||t.addEventListener("contextmenu",s=>{s.preventDefault();const n=s.target.closest(".scene");d.log("contextmenu",[e,n]),n&&(c.contextMenuSceneId=n.dataset.documentId)})})}};ye=new WeakSet,bt=function(e,t,s){const n=t.findIndex(i=>i.name==="SCENES.ToggleNav"),a=this.contextMenuSceneId,o=a?game.scenes.get(a):null;d.log("#modifyContextMenu",[e,t,o,n]),n!==-1&&(t[n]={...t[n],icon:'<i class="fas fa-star"></i>',name:"CRLNGN_UI.ui.sceneNav.addToFavorites"})},Nt=function(e,t,s){const n=t.findIndex(i=>i.name==="SCENES.ToggleNav"),a=this.contextMenuSceneId,o=a?game.scenes.get(a):null;d.log("#modifyDirectoryContextMenu",[e,t,o,n]),n!==-1&&(t[n]={...t[n],icon:'<i class="fas fa-star"></i>',name:"CRLNGN_UI.ui.sceneNav.addToFavorites"})},He=new WeakMap,$=new WeakMap,we=new WeakMap,H=new WeakMap,Ge=new WeakMap,Fe=new WeakMap,ce=new WeakMap,qe=new WeakMap,st=new WeakMap,L(c,ye),N(c,"selectedFolder"),N(c,"folderList"),N(c,"folderListData",[]),N(c,"searchValue",""),N(c,"getFolders",e=>{let t=e.filter(s=>s.folder===null);return t.sort((s,n)=>s.name.toLowerCase().localeCompare(n.name.toLowerCase())),t}),N(c,"selectFolder",e=>c.getFolderById(e)||null),N(c,"createFolderElem",()=>document.createElement("li")),N(c,"createListElement",e=>{const t=document.createElement("ol");return t.classList.add("folder-list"),e.forEach(s=>{const n=document.createElement("li");d.log("createListElement",[s]),s.children&&s.children.length>0?n.innerHTML=`<a class="with-subfolders">${s.name}</a>`:n.innerHTML=`<a>${s.name}</a>`,t.append(n)}),t}),N(c,"preloadTemplate",async()=>{const e=[`modules/${V}/templates/scene-folder-list.hbs`];return await loadTemplates(e),d.log("preloadTemplate",[!0]),!0}),N(c,"getFoldersData",e=>({...e,children:e.children.map(t=>c.getFoldersData(t)),hasSubfolders:e.children.length>0,id:e.id})),N(c,"renderSceneFolders",async()=>{var i;if(c.noFolderView())return;let e,t,s;if(!c.selectedFolder)return;d.log("SCENE NAV renderSceneFolders",[]),e=document.querySelector("#crlngn-scene-folders"),t=document.querySelector("#crlngn-scene-list"),e&&e.remove(),t&&t.remove();const n=c.getFolders(ui.scenes.folders);if(c.selectedFolder===j)s={favoritesId:j,folderList:n.map(r=>c.getFoldersData(r)),currFolder:{name:j,id:j},currIcon:"fa-star",folders:[],scenes:ui.nav.scenes.filter(r=>r.permission>=2),users:game.users.contents,isGM:game.user.isGM,searchValue:c.searchValue,showSearchResults:!!c.searchValue};else{const r=c.selectedFolder.children;d.log("foldersData",[r]),s={favoritesId:j,folderList:n.map(l=>c.getFoldersData(l)),currFolder:c.selectedFolder,currIcon:"fa-folder",folders:r,scenes:c.selectedFolder.contents,users:game.users.contents,isGM:game.user.isGM,searchValue:c.searchValue,showSearchResults:!!c.searchValue}}d.log("SCENE NAV templateData",[s]);const a=await renderTemplate(`modules/${V}/templates/scene-folder-list.hbs`,s),o=document.querySelector("#scene-list");o.insertAdjacentHTML("beforebegin",a),e=document.querySelector("#crlngn-scene-folders"),t=document.querySelector("#crlngn-scene-list"),o==null||o.classList.add("hidden"),c.activateFolderListeners(e),m(i=c,He).call(i,t)}),N(c,"activateFolderListeners",e=>{var n,a;if(c.noFolderView())return;d.log("activateFolderListeners",[e]),G.showFolderListOnClick?(e.removeEventListener("mouseover",m(c,$)),e.removeEventListener("mouseout",m(c,$)),(n=e.querySelector("a.selected"))==null||n.addEventListener("click",m(c,$))):(e.addEventListener("mouseover",m(c,$)),e.addEventListener("mouseout",m(c,$)),(a=e.querySelector("a.selected"))==null||a.removeEventListener("click",m(c,$))),e.querySelectorAll("span.toggle").forEach(o=>{o.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation();const l=i.currentTarget.closest("li").querySelector("ol.subfolders");if(!l)return;!l.classList.contains("open")?(l.classList.add("open"),i.currentTarget.textContent="−"):(l.classList.remove("open"),i.currentTarget.textContent="+")})}),e.querySelectorAll(".folder-list li.folder").forEach(o=>{o.addEventListener("click",m(c,ce))});const s=e.querySelector(".search-container .input-scene-search");s.addEventListener("keyup",m(c,qe)),s.addEventListener("keydown",o=>{o.stopPropagation()})}),L(c,He,e=>{e.querySelectorAll("li.nav-item").forEach(s=>{const n=s.classList.contains("folder");s.addEventListener("click",n?m(c,ce):m(c,Ge)),s.addEventListener("dblclick",n?()=>{}:m(c,Fe))})}),N(c,"refreshFolderView",async()=>{c.noFolderView()||(c.folderListData=c.getFolders(ui.scenes.folders),await c.renderSceneFolders(),G.placeNavButtons())}),N(c,"updateSearchResults",e=>{if(c.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const s=game.scenes.filter(a=>a.name.toLowerCase().includes(e.toLowerCase())&&a.permission>=2),n=game.scenes.folders.filter(a=>a.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),n.forEach(a=>{const o=document.createElement("li");o.className="folder",o.dataset.folderId=a.id,o.innerHTML=`<a><i class="fas fa-folder"></i> ${a.name}</a>`,o.addEventListener("click",m(c,ce)),t.appendChild(o)}),s.forEach(a=>{const o=document.createElement("li");o.className="scene",o.dataset.sceneId=a.id,o.innerHTML=`<a><i class="fas fa-map"></i> ${a.name}</a>`,o.addEventListener("dblclick",m(c,Fe)),o.addEventListener("click",m(c,Ge)),t.appendChild(o)}),n.length===0&&s.length===0){const a=document.createElement("li");a.className="no-results",a.textContent="No matching results found",t.appendChild(a)}}),L(c,$,e=>{e.stopPropagation(),e.preventDefault(),e.currentTarget;const t=document.querySelector("#crlngn-scene-folders");t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),G.showFolderListOnClick&&document.addEventListener("click",m(c,we)))}),L(c,we,e=>{e.preventDefault(),e.stopPropagation();const t=e.target,s=document.querySelector("#crlngn-scene-folders");d.log("#onOutsideClick",[s,t,s.contains(t)]),s!=null&&s.classList.contains("open")&&!s.contains(t)&&(s.classList.remove("open"),document.removeEventListener("click",m(c,we)))}),L(c,H,null),L(c,Ge,e=>{e.preventDefault(),e.stopPropagation();const s=e.currentTarget.dataset,n=game.scenes.get(s.sceneId);m(c,H)&&(clearTimeout(m(c,H)),M(c,H,null)),M(c,H,setTimeout(()=>{d.log("scene click",[n]),n.view(),c.selectedFolder=j,c.refreshFolderView(),M(c,H,null)},250))}),L(c,Fe,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset,n=game.scenes.get(s.sceneId);m(c,H)&&(clearTimeout(m(c,H)),M(c,H,null)),d.log("#onActivateScene",[n]),n.activate(),c.refreshSceneView()}),L(c,ce,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset;c.selectedFolder=c.selectFolder(s.folderId||""),c.refreshFolderView()}),L(c,qe,e=>{e.stopPropagation();const s=e.currentTarget.value;c.searchValue=s,c.updateSearchResults(s)}),L(c,st,e=>{var n,a,o,i;e.preventDefault(),e.stopPropagation();let t=((a=(n=e.currentTarget)==null?void 0:n.dataset)==null?void 0:a.sceneId)||"",s=((i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.folderId)||"";t?game.scenes.get(t).view():s&&(c.selectedFolder=c.selectFolder(s),c.refreshFolderView())}),N(c,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!G.navFoldersForPlayers||!G.navFoldersEnabled||!G.sceneNavEnabled});let oe=c;var de;const g=class g{static registerSettings(){const e=h();d.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(V),Object.entries(e).forEach(async o=>{const i=o[1];d.log("Registering... ",[o],!0);const r={name:i.label,hint:i.hint,default:i.default,type:i.propType,scope:i.scope,config:i.config,requiresReload:i.requiresReload||!1,onChange:l=>g.apply(i.tag,l)};i.choices&&(r.choices=i.choices),await game.settings.register(V,i.tag,r),g.get(i.tag)===void 0&&g.set(i.tag,i.default),game.keybindings.register(V,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{g.hideInterface()},restricted:!1})}),g.applyThemeSettings(),g.applyCustomCSS(),g.applyModuleAdjustments(),G.sceneNavEnabled=g.get(e.sceneNavEnabled.tag),G.navFoldersEnabled=g.get(e.navFoldersEnabled.tag),G.navFoldersForPlayers=g.get(e.navFoldersForPlayers.tag),G.showFolderListOnClick=g.get(e.showFolderListOnClick.tag),G.showNavOnHover=g.get(e.showNavOnHover.tag),Object.entries(Dt()).forEach(async o=>{const i=o[1],r={name:i.tag,label:i.label,hint:i.hint,icon:i.icon,type:i.propType,restricted:i.restricted};await game.settings.registerMenu(V,i.tag,r)}),Hooks.on(k.RENDER_SCENE_CONTROLS,g.applyLeftControlsSettings),Hooks.on(k.RENDER_PLAYERS_LIST,g.applyPlayersListSettings),Hooks.on(k.RENDER_HOTBAR,()=>{g.firstLoad&&(g.firstLoad=!1,g.applyHotBarCollapse()),g.applyHotBarSettings()}),g.applyDebugSettings(),g.applySceneNavPos(),g.applyChatStyles(),g.applyBorderColors(),e.customFontsMenu.fields.forEach(o=>{g.applyCustomFonts(e[o].tag)}),e.leftControlsMenu.fields.forEach(o=>{g.applyLeftControlsSettings(e[o].tag)})}static get(e,t=V){if(!e)return null;let s=!1;if(t===V)s=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),s=a==null?void 0:a.value,d.log("GET Setting",[a,s])}return s}static set(e,t,s=V){if(!e)return!1;let n=game.settings.storage.get("client")[`${s}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${s}.${e}`)),d.log("Setting",[e,n]);try{game.settings.set(s,e,t)}catch{d.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const s=h();switch(t===void 0&&(t=g.get(e)),d.log("SettingsUtil.apply",[e,t,g.get(e)]),e){case s.enableMacroLayout.tag:g.applyHotBarSettings();break;case s.collapseMacroBar.tag:g.applyHotBarCollapse();break;case s.autoHidePlayerList.tag:g.applyPlayersListSettings();break;case s.uiFontBody.tag:case s.uiFontTitles.tag:case s.journalFontBody.tag:case s.journalFontTitles.tag:g.applyCustomFonts(e,t);break;case s.controlsBottomBuffer.tag:case s.controlsIconSize.tag:case s.controlsAutoHide.tag:case s.hideFoundryLogo.tag:g.applyLeftControlsSettings(e,t);break;case s.cameraDockMenu.tag:g.applyCameraPosX(),g.applyCameraPosY(),g.applyCameraWidth(),g.applyCameraHeight();break;case s.chatBorderColor.tag:ge.chatBorderColor=g.get(s.chatBorderColor.tag),d.log("SettingsUtil.apply",[e]),g.applyBorderColors();break;case s.enableChatStyles.tag:ge.enableChatStyles=g.get(s.enableChatStyles.tag),d.log("SettingsUtil.apply",[e]),g.applyChatStyles();break;case s.enforceDarkMode.tag:g.resetFoundryThemeSettings();break;case s.debugMode.tag:g.applyDebugSettings();break;case s.sceneNavEnabled.tag:G.sceneNavEnabled=t;break;case s.navFoldersEnabled.tag:G.navFoldersEnabled=t;break;case s.navFoldersForPlayers.tag:G.navFoldersForPlayers=t;break;case s.showFolderListOnClick.tag:G.showFolderListOnClick=t,oe.refreshFolderView();break;case s.showNavOnHover.tag:G.showNavOnHover=t;break;case s.sceneNavCollapsed.tag:G.isCollapsed=g.get(s.sceneNavCollapsed.tag);break;case s.sceneNavPos.tag:g.applySceneNavPos();break;case s.colorTheme.tag:g.applyThemeSettings();break;case s.customStyles.tag:g.applyCustomCSS();break;case s.adjustOtherModules.tag:g.applyModuleAdjustments();break}}static applyBorderColors(){const e=h(),t=g.get(e.chatBorderColor.tag),s=document.querySelector("body");t===ue.playerColor.name?(s.classList.add("player-chat-borders"),s.classList.remove("roll-chat-borders")):t===ue.rollType.name?(s.classList.add("roll-chat-borders"),s.classList.remove("player-chat-borders")):(s.classList.remove("player-chat-borders"),s.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=h(),t=g.get(e.enableChatStyles.tag),s=document.querySelector("body");d.log("applyChatStyles",[t,e]),t?s.classList.add("crlngn-chat"):s.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=h(),t=g.get(e.enableMacroLayout.tag),s=document.querySelector("#hotbar");!t&&s?s.classList.add("foundry-default"):s&&s.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=h();g.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const s=h(),n=g.get(s.sceneNavEnabled.tag),a=document.querySelector("#ui-left"),o=document.querySelector("#ui-left #logo"),i=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),d.log("applyLeftControlsSettings",[e]),e){case s.controlsAutoHide.tag:g.get(s.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break;case s.hideFoundryLogo.tag:const l=window.getComputedStyle(i).getPropertyValue("--top-nav-height")||"0px",p=parseFloat(l)||0,b=g.get(s.hideFoundryLogo.tag);d.log("applyLeftControlsSettings",[e,p,l]),b===void 0||b===!0?(o.classList.remove("visible"),C.addCSSVars("--ui-top-padding",`${p}px`),document.querySelector("body").classList.remove("logo-visible")):(o.classList.add("visible"),n?(C.addCSSVars("--ui-top-padding",`${72+p}px`),document.querySelector("body").classList.add("logo-visible")):C.addCSSVars("--ui-top-padding","72px"));break;case s.controlsBottomBuffer.tag:g.applyControlsBuffer();break;case s.controlsIconSize.tag:g.applyControlIconSize();break}}static applyControlIconSize(){const e=h(),t=g.get(e.controlsIconSize.tag);document.querySelector("body");const s=t==be.small.name?be.small.size:be.regular.size;d.log("applyControlIconSize",[s]),C.addCSSVars("--left-control-item-size",s),g.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=h(),t=g.get(e.leftControlsMenu.tag),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;C.addCSSVars("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,s;const e=h();d.log("applyPlayersListSettings",[document.querySelector("#players"),g.get(e.autoHidePlayerList.tag)]),g.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(s=document.querySelector("#players"))==null||s.classList.remove("auto-hide"),ze.checkPlayersList()}static applySceneNavPos(e){const t=h();g.set(t.sceneNavPos.tag,e||g.get(t.sceneNavPos.tag)),G.navPos=e||g.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=h(),s=g.get(t.cameraDockMenu.tag),n=e||s.dockPosX;Z.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=h(),s=g.get(t.cameraDockMenu.tag),n=e||s.dockPosY;Z.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=h(),s=g.get(t.cameraDockMenu.tag),n=e||s.dockWidth;Z.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=h(),s=g.get(t.cameraDockMenu.tag),n=e||s.dockHeight;Z.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const s=h(),n=s.customFontsMenu.fields,a={};switch(d.log("applyCustomFonts",[e,t]),n.forEach(o=>{a[o]=g.get(s[o].tag)}),document.querySelector("body.crlngn-ui"),e){case s.uiFontBody.tag:C.addCSSVars("--crlngn-font-family",t||a.uiFontBody||s.uiFontBody.default.uiFont||"");break;case s.uiFontTitles.tag:C.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||s.uiFontTitles.default.uiTitles||"");break;case s.journalFontBody.tag:C.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case s.journalFontTitles.tag:C.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=h(),t=C.isModuleOn("monks-player-settings"),s=C.isModuleOn("force-client-settings"),n=g.get(e.enforceDarkMode.tag);if(n&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),g.set(e.enforceDarkMode.tag,!1));return}if(n&&s){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),g.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","colorScheme");d.log("resetFoundryThemeSettings",[a,n]),a===!1&&n&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=h();d.debugOn=e||g.get(t.debugMode.tag)}};de=new WeakMap,L(g,de,!1),N(g,"firstLoad",!0),N(g,"applyThemeSettings",e=>{const t=h(),s=e||g.get(t.colorTheme.tag)||"",n=document.querySelector("body");d.log("applyThemeSettings",[e,s,g.get(t.colorTheme.tag)]),W.forEach(a=>{a.className&&n.classList.remove(a.className)}),s&&n.classList.add(s)}),N(g,"applyCustomCSS",e=>{const t=h(),s=e||g.get(t.customStyles.tag)||"";C.addCustomCSS(s)}),N(g,"applyModuleAdjustments",e=>{const t=h(),s=e||g.get(t.adjustOtherModules.tag)||!1,n=document.querySelector("body");s?n.classList.add("crlngn-enforce-styles"):n.classList.remove("crlngn-enforce-styles")}),N(g,"hideInterface",()=>{d.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),s=document.querySelector(".taskbar");m(g,de)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&s.style.removeProperty("visibility"),M(g,de,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),s&&s.style.setProperty("visibility","hidden"),M(g,de,!0))});let S=g;class nt{static init(){Hooks.on(k.RENDER_PLAYERS_LIST,nt.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child"),s=e.offsetHeight;C.addCSSVars("--players-list-height",s+"px"),!(!e||!t)&&t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var Y,Ae,Pe;const F=class F{static init(){d.log("LeftControls - init",[]),Hooks.on(k.RENDER_SCENE_CONTROLS,F.initSceneControls),F.initSceneControls()}static resetLocalVars(){M(F,Y,document.querySelector("#ui-left #controls")),M(F,Ae,document.querySelector("#ui-left"))}static initSceneControls(){d.log("initSceneControls",[]),F.resetLocalVars(),F.observeControlsWidth()}static observeControlsWidth(){if(d.log("observeControlsWidth",[]),!m(F,Y))return;let e;const t=(s,n)=>{e||(e=setTimeout(()=>{s(),e=null},n))};M(F,Pe,new ResizeObserver(s=>{t(()=>F.updateCSSVars(),250)},{box:"border-box"})),m(F,Pe).observe(m(F,Y)),F.updateCSSVars()}static updateCSSVars(){if(!m(F,Y))return;let e=Number(m(F,Ae).offsetWidth),t=Number(m(F,Y).offsetWidth),s=-e+t+24;d.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&C.addCSSVars("--ui-controls-margin-left",s+"px")}};Y=new WeakMap,Ae=new WeakMap,Pe=new WeakMap,L(F,Y),L(F,Ae),L(F,Pe);let et=F;var Be;const Ne=class Ne{static init(){Hooks.once(k.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(V),d.log("Initiating module...",[],!0),Hooks.on(k.RENDER_CHAT_MESSAGE,m(Ne,Be)),S.registerSettings(),G.init(),Z.init(),nt.init(),et.init(),ge.init()}),Hooks.once(k.READY,()=>{d.log("Core Ready",[]);const e=h();var t=S.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),ze.init(),S.get(e.enableChatStyles.tag)&&Ne.addCSSLocalization(),S.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";C.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),C.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),C.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),C.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),C.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),C.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),C.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),C.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),C.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),C.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Be=new WeakMap,L(Ne,Be,(e,t)=>{d.log(k.RENDER_CHAT_MESSAGE,[e,t]),ge.enrichCard(e,t)});let tt=Ne;tt.init();
//# sourceMappingURL=crlngn-ui.js.map
