var na=Object.defineProperty;var go=r=>{throw TypeError(r)};var oa=(r,e,t)=>e in r?na(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var b=(r,e,t)=>oa(r,typeof e!="symbol"?e+"":e,t),Nn=(r,e,t)=>e.has(r)||go("Cannot "+t);var m=(r,e,t)=>(Nn(r,e,"read from private field"),t?t.call(r):e.get(r)),L=(r,e,t)=>e.has(r)?go("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),A=(r,e,t,n)=>(Nn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),j=(r,e,t)=>(Nn(r,e,"access private method"),t);const z={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},U="crlngn-ui",_t=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],hn=class hn{static log(e="",t=[],n=!1){try{const o=hn.debugOn;if(!(n||o))return;console.log(..._t,e,...t)}catch{console.log(..._t,e,...t)}}static warn(e="",t=[]){console.warn(..._t,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(..._t,e)}};b(hn,"debugOn",!1);let f=hn;const D={select:"select",checkbox:"checkbox",text:"text",number:"number"},R={client:"client",world:"world"},Et={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},ct={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},pe={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},Tn=140,Pe=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function v(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:D.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:R.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:R.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:D.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:ct.playerColor.name},scope:R.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:D.button,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:R.client,config:!1,requiresReload:!1},playersListMenu:{tag:"players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,inputType:D.button,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:R.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:D.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:pe.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:R.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:D.button,fields:["sceneNavEnabled","navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:R.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:R.client,config:!0,default:!1},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!1},sceneNavItemWidth:{tag:"scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,inputType:D.number,default:"",scope:R.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.world,config:!1},useSceneBackButton:{tag:"use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:String,inputType:D.select,default:!0,scope:R.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:D.number,default:0,scope:R.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.world,config:!0},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,inputType:D.checkbox,default:!1,scope:R.client,config:!1},playerListAvatars:{tag:"player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!1},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:D.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:R.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:D.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:R.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:D.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:R.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:D.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:R.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:D.text,propType:String,default:"",scope:R.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:D.checkbox,propType:Boolean,default:!1,scope:R.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:D.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:R.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:D.text,propType:String,default:"",scope:R.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:D.text,default:ct.playerColor.name,scope:R.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:D.checkbox,default:!0,scope:R.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:D.checkbox,propType:Boolean,default:!1,scope:R.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:D.checkbox,propType:Boolean,default:!0,scope:R.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:D.number,propType:Number,default:0,scope:R.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:D.number,propType:Number,default:120,scope:R.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:D.number,propType:Number,default:160,scope:R.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:D.number,propType:Number,default:145,scope:R.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:D.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:pe.off.name,scope:R.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:D.number,propType:Number,default:160,scope:R.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:R.world,config:!1,default:""}}}const{ApplicationV2:aa,HandlebarsApplicationMixin:sa}=foundry.applications.api;var Kn,gt,Eo,No;const ve=class ve extends sa(aa){static get DEFAULT_OPTIONS(){return{id:v().playersListMenu.tag,actions:{redefine:j(ve,gt,No)},form:{handler:j(ve,gt,Eo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=v(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=N.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}}),f.log("_prepareContext A",[o,n,a,s]);const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=v();ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=N.get(n.playersListMenu.tag);f.log("_onRender",[e,t,a])}};Kn=new WeakMap,gt=new WeakSet,Eo=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),N.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},No=async function(e,t){const n=v(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.playersListMenu.default])},L(ve,gt),L(ve,Kn),b(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let On=ve;const{ApplicationV2:ia,HandlebarsApplicationMixin:ra}=foundry.applications.api;var ft,To,Lo,Pt,xn;const be=class be extends ra(ia){constructor(){super(...arguments);L(this,Pt)}static get DEFAULT_OPTIONS(){return{id:v().cameraDockMenu.tag,actions:{redefine:j(be,ft,Lo)},form:{handler:j(be,ft,To),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=v(),o=n.cameraDockMenu.fields,a={},s={},i={};o.forEach(u=>{if(f.log("_prepareContext",[n[u].oldName]),n[u]){const p=N.get(n[u].tag);a[u]=n[u],s[u]=p!==void 0?p:n[u].default,i[u]=n[u].default}});const l={...s,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),be.element=this.element,be.element.querySelector(".toggle-hint").addEventListener("click",()=>{be.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",j(this,Pt,xn).bind(this)),j(this,Pt,xn).call(this,{target:a}))}};ft=new WeakSet,To=async function(t,n,o){const a=v();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,i=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!i.hasOwnProperty(p)&&(i[p]=!1)});const l=foundry.utils.expandObject(i),c=N.get(a.enableFloatingDock.tag);f.log("Compared settings:",[l.enableFloatingDock,c]),s.forEach(p=>{f.log("Saving setting >>",[a[p].tag,l[p]]),l[p]!==void 0&&N.set(a[p].tag,l[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==c&&location.reload()},Lo=async function(t,n){const o=v(),s=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.fields,l={};i.forEach(c=>{o[c]&&(o[c],l[c]=o[c].default)}),s.forEach(c=>{c.value=l[c.name]}),f.log("#onReset",[t,n,o.cameraDockMenu.default])},Pt=new WeakSet,xn=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(i=>i.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(i=>i.disabled=!t.target.checked),f.log("onDockEnabledChange",[this.element,n,o])},L(be,ft),b(be,"element"),b(be,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Gn=be;const{ApplicationV2:la,HandlebarsApplicationMixin:ca}=foundry.applications.api;var Zn,pt,wo,Io;const Ce=class Ce extends ca(la){static get DEFAULT_OPTIONS(){return{id:v().chatMessagesMenu.tag,actions:{redefine:j(Ce,pt,Io)},form:{handler:j(Ce,pt,wo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=v(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(f.log("_prepareContext",[t[c].oldName]),t[c]){const u=N.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}}),f.log("_prepareContext",[a,s]);const i={...a,default:{...s},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=v();Ce.element=this.element,Ce.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ce.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=N.get(n.chatMessagesMenu.tag);f.log("_onRender",[e,t,a])}};Zn=new WeakMap,pt=new WeakSet,wo=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(u=>{o[u].inputType==="checkbox"&&!s.hasOwnProperty(u)&&(s[u]=!1)});const i=foundry.utils.expandObject(s),l=N.get(o.chatBorderColor.tag);f.log("Compared settings:",[i.chatBorderColor,l]),a.forEach(u=>{f.log("Saving setting >>",[o[u].tag,i[u]]),i[u]!==void 0&&N.set(o[u].tag,i[u])}),i.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Io=async function(e,t){const n=v(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(l=>{n[l]&&(n[l],i[l]=n[l].default)}),a.forEach(l=>{l.value=i[l.name]})},L(Ce,pt),L(Ce,Zn),b(Ce,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Fn=Ce;const Dt=class Dt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family");i&&(t.add(i),f.log("Found font-face rule:",[i]))}else if(s instanceof CSSImportRule){if(f.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const l=await(await fetch(s.href)).text();this.extractFontsFromCSSText(l,t)}catch(i){f.warn("Error fetching imported CSS:",[i])}}}}catch(o){if(o.name==="SecurityError"&&e.href){f.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){f.warn("Error fetching cross-origin stylesheet:",[a])}}else f.warn("Error accessing CSS rules:",[o])}}catch(o){f.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];f.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,i=a.match(s);if(i&&i[2]){const l=i[2].trim();t.add(l),f.log("Found font-face in CSS text:",[l])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return f.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const l=o.substring(a+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),c={};l.forEach(h=>{const E=h.split(":");if(E.length>=2){const C=E[0].trim(),w=E.slice(1).join(":").trim();C&&(c[C]=w)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([h,E])=>`  ${h}: ${E};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+u+`
}`+o.substring(s+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const i=n==="horizontal",l=i?e.scrollLeft:e.scrollTop,c=t-l;if(c===0)return a&&a(),null;const u=performance.now(),p=E=>{const C=E-u;if(C>=o){i?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const w=C/o,x=w<.5?2*w*w:1-Math.pow(-2*w+2,2)/2;i?e.scrollLeft=l+c*x:e.scrollTop=l+c*x;const q=requestAnimationFrame(p);return e.dataset.scrollAnimationId=q,q},h=requestAnimationFrame(p);return e.dataset.scrollAnimationId=h,h}};b(Dt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));f.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);f.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const i=s.href||"",l=i.includes("css/")||i.includes("styles/"),c=i.includes("modules/crlngn-ui/"),u=i.includes("systems/");if(i&&!l&&!c&&!u){f.log("Skipping stylesheet:",[i]);continue}f.log("Processing stylesheet:",[s,i]),await Dt.processStyleSheetRules(s,o)}}catch(i){f.warn("Error processing stylesheet:",[i])}return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))}),b(Dt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let G=Dt;const{ApplicationV2:da,HandlebarsApplicationMixin:ua}=foundry.applications.api;var Qn,Be,ko,Ro,Mo;const oe=class oe extends ua(da){static get DEFAULT_OPTIONS(){return{id:v().customFontsMenu.tag,actions:{redefine:j(oe,Be,Mo)},form:{handler:j(oe,Be,ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=v(),n=t.customFontsMenu.fields,o={},a={},s={},i=await G.getAllFonts();return n.forEach(c=>{if(t[c]){const u=N.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:i,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){oe.element=this.element,oe.element.querySelector(".toggle-hint").addEventListener("click",()=>{oe.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),oe.element.querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),l=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!l)return;const c=()=>{var u;j(u=oe,Be,Ro).call(u),l.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",u=>{const p=l.classList.contains("active"),h=Array.from(l.querySelectorAll(".dropdown-option"));let E=h.findIndex(C=>C.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),p||l.classList.add("active"),h.forEach(C=>C.classList.remove("highlighted")),E===-1?E=u.key==="ArrowDown"?0:h.length-1:E=u.key==="ArrowDown"?(E+1)%h.length:(E-1+h.length)%h.length,h[E]&&(h[E].classList.add("highlighted"),h[E].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),p&&E!==-1&&h[E]&&h[E].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{i.contains(u.target)||l.classList.remove("active")})}),oe.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const l=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};Qn=new WeakMap,Be=new WeakSet,ko=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),N.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ro=function(){oe.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Mo=async function(e,t){const n=v(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(l=>{n[l]&&(n[l],i[l]=n[l].default)}),a.forEach(l=>{l.value=i[l.name]})},L(oe,Be),L(oe,Qn),b(oe,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Un=oe;const{ApplicationV2:ga,HandlebarsApplicationMixin:fa}=foundry.applications.api;var _n,ht,Do,Ao;const Ee=class Ee extends fa(ga){static get DEFAULT_OPTIONS(){return{id:v().leftControlsMenu.tag,actions:{redefine:j(Ee,ht,Ao)},form:{handler:j(Ee,ht,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=v(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=N.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=v();Ee.element=this.element,Ee.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ee.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=N.get(n.leftControlsMenu.tag);f.log("_onRender",[e,t,a])}};_n=new WeakMap,ht=new WeakSet,Do=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),N.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ao=async function(e,t){const n=v(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.leftControlsMenu.default])},L(Ee,ht),L(Ee,_n),b(Ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let qn=Ee;const{ApplicationV2:pa,HandlebarsApplicationMixin:ha}=foundry.applications.api;var eo,mt,Po,zo,zt,Hn;const Ne=class Ne extends ha(pa){constructor(){super(...arguments);L(this,zt)}static get DEFAULT_OPTIONS(){return{id:v().sceneNavMenu.tag,actions:{redefine:j(Ne,mt,zo)},form:{handler:j(Ne,mt,Po),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=v(),o=n.sceneNavMenu.fields,a={},s={},i={};o.forEach(c=>{if(n[c]){const u=N.get(n[c].tag);a[c]=n[c],s[c]=u!==void 0?u:n[c].default,i[c]=n[c].default}});const l={...s,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),Ne.element=this.element,Ne.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ne.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",j(this,zt,Hn).bind(this)),j(this,zt,Hn).call(this,{target:a}))}};eo=new WeakMap,mt=new WeakSet,Po=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=v(),s=a.sceneNavMenu.fields;let i=N.get(a.sceneNavEnabled.tag),l=N.get(a.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);s.forEach(h=>{c[h]!==void 0&&(f.log("Saving setting:",[c[h]]),N.set(a[h].tag,c[h]))});let u=N.get(a.sceneNavEnabled.tag),p=N.get(a.navFoldersEnabled.tag);f.log("Saving settings...",[i,u]),await N.set(a.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(i!==u||l!==p)&&location.reload()},zo=async function(t,n){const o=v(),s=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;s.forEach(l=>{l.value=i[l.name],l.type==="checkbox"&&(l.checked=i[l.name])}),f.log("#onReset",[t,n,o.sceneNavMenu.default])},zt=new WeakSet,Hn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),f.log("onSceneNavEnabledChange",[this.element,n])},L(Ne,mt),L(Ne,eo),b(Ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Bn=Ne;const{ApplicationV2:ma,HandlebarsApplicationMixin:ya}=foundry.applications.api;var to,no,He,Oo,Go,xo;const Z=class Z extends ya(ma){static get DEFAULT_OPTIONS(){return{id:v().themeAndStylesMenu.tag,actions:{redefine:j(Z,He,xo)},form:{handler:j(Z,He,Oo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=v(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const u=N.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}});const i=Pe.find(c=>c.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||Pe[0].label;const l={...a,default:{...s},fields:{...o},selectedTheme:i,themes:Pe,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){Z.element=this.element,Z.element.querySelector(".toggle-hint").addEventListener("click",()=>{Z.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=Pe,Z.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const p=u.closest(".dropdown-wrapper"),h=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!h)return;const E=()=>{var C;j(C=Z,He,Go).call(C),h.classList.add("active")};u.addEventListener("focus",E),u.addEventListener("click",E),u.addEventListener("keydown",C=>{const w=h.classList.contains("active"),x=Array.from(h.querySelectorAll(".dropdown-option"));let q=x.findIndex(K=>K.classList.contains("highlighted"));C.key==="ArrowDown"||C.key==="ArrowUp"?(C.preventDefault(),w||h.classList.add("active"),x.forEach(K=>K.classList.remove("highlighted")),q===-1?q=C.key==="ArrowDown"?0:x.length-1:q=C.key==="ArrowDown"?(q+1)%x.length:(q-1+x.length)%x.length,x[q]&&(x[q].classList.add("highlighted"),x[q].scrollIntoView({block:"nearest"}))):C.key==="Enter"?(C.preventDefault(),w&&q!==-1&&x[q]&&x[q].click()):C.key==="Escape"&&h.classList.remove("active")}),document.addEventListener("click",C=>{p.contains(C.target)||h.classList.remove("active")})});const a=Z.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(p){f.log("option",[u,u.querySelector(".theme-name")]);const h=u.closest(".dropdown-wrapper").querySelector("input");let E=u.querySelector(".theme-name").innerHTML.toString();if(h.value=E,h.name==="colorTheme"){const w=s._themes.find(x=>x.label===E);s._selectedTheme=w,s._updateThemePreview(w)}u.closest(".dropdown-options").classList.remove("active")})});const i=Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=Z.element.querySelector("input.otherModulesList");i.forEach(u=>{u.addEventListener("change",p=>{const h=p.currentTarget;let C=`${l.value}`.split(",")||[],w=C.indexOf(h.value);!p.currentTarget.checked&&w>-1?C.splice(w,1):p.currentTarget.checked&&w===-1&&C.push(h.value),l.value=C.join(","),f.log("checkbox changed",[C,l.value])})}),Z.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(h=>{h.checked=u.currentTarget.checked;const E=new Event("change",{bubbles:!0});h.dispatchEvent(E)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};to=new WeakMap,no=new WeakMap,He=new WeakSet,Oo=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),i=Pe.find(l=>l.label===s.colorTheme);s.colorTheme=i?i.className:"",a.forEach(l=>{s[l]!==void 0&&(f.log("Saving setting:",[s[l]]),N.set(o[l].tag,s[l]))}),N.set(o.themeAndStylesMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Go=function(){Z.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},xo=async function(e,t){const n=v(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)});const l=Pe.find(c=>c.label===n.colorTheme.default);i.colorTheme=(l==null?void 0:l.label)||Pe[0].label,a.forEach(c=>{c.value=i[c.name]})},L(Z,He),L(Z,to),L(Z,no,!1),b(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Wn=Z;function Sa(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Un,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Wn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Fn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:qn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:Bn,restricted:!1},playersListMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-camera",propType:On,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Gn,restricted:!1}}}var Je,Ge,Ot,Gt,xt,Ft,Ut,qt,Bt,Ht,Ke,Wt,Vt;const d=class d{static init(){const e=v();d.currSettings={enableFloatingDock:N.get(e.enableFloatingDock.tag),defaultVideoWidth:N.get(e.defaultVideoWidth.tag),dockHeight:N.get(e.dockHeight.tag),dockWidth:N.get(e.dockWidth.tag),dockPosX:N.get(e.dockPosX.tag),dockPosY:N.get(e.dockPosY.tag),dockResizeOnUserJoin:N.get(e.dockResizeOnUserJoin.tag)},Hooks.on("updateSetting",t=>{f.log("checkMinimizedState",[t]),t.key==="rtcClientSettings"&&t.namespace==="core"&&d.checkMinimizedState()}),Hooks.on(z.RENDER_CAMERA_VIEWS,(t,n,o)=>{setTimeout(()=>d.checkMinimizedState(),100)}),d.currSettings.enableFloatingDock?(d.positionIntervalId&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null),Hooks.on(z.RENDER_CAMERA_VIEWS,d.onRenderFloating),Hooks.on(z.WEBRTC_SETTINGS_CHANGED,d.resetPositionAndSize),Hooks.on(z.WEBRTC_USER_STATE_CHANGED,d.resetPositionAndSize),Hooks.on(z.UPDATE_USER,d.resetPositionAndSize),Hooks.on(z.RENDER_PLAYERS_LIST,d.resetPositionAndSize),Hooks.once(z.READY,()=>{d.onRenderFloating()}),f.log("CameraUtil settings",[d.currSettings])):(Hooks.on(z.RENDER_CAMERA_VIEWS,d.onRenderPlain),d.onRenderPlain())}static onRenderPlain(){d.cameraContainer.classList.add("visible")}static onRenderFloating(){v();const e=d.currSettings;if(d.cameraContainer=document.querySelector("#camera-views"),!d.cameraContainer)return;d.cameraContainer.classList.add("crlngn-ui"),f.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),d.checkMinimizedState();const t=game.settings.get("core","rtcClientSettings");(t==null?void 0:t.hideDock)!==!0&&(d.makeDraggable(),d.makeResizeable(),d.applyDockResize(e.dockResizeOnUserJoin),d.applyVideoWidth(),d.resetPositionAndSize(),d.applyPositionWithDelay())}static applyPositionWithDelay(){d.positionIntervalId&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null);let e=0;d.positionIntervalId=setInterval(()=>{d.resetPositionAndSize(),e++,e>=d.positionAttempts&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null)},50)}static applyVideoWidth(e){const t=v(),n=N.get(t.defaultVideoWidth.tag);let o=e||n;if(o<Tn)o=Tn,N.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){d.currSettings.defaultVideoWidth=o;const a=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),s=document.querySelector("#camera-views.crlngn-ui");!a&&s?s.style.setProperty("--av-width",o+"px"):s&&s.style.removeProperty("--av-width"),d.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){v();const a=d.currSettings;if(!a.enableFloatingDock||!d.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){d.checkMinimizedState();return}if(d.cameraContainer.style.removeProperty("top"),f.log("CameraUtil",[a]),!e&&!t&&!n&&!o){const i=a.dockPosX||0,l=a.dockPosY||0;if(d.cameraContainer.style.transform=`translateX(${i}px)`,d.cameraContainer.style.bottom=`${l}px`,d.cameraContainer.style.removeProperty("left"),d.cameraContainer.style.removeProperty("top"),d.currSettings.dockResizeOnUserJoin===pe.off.name){const c=a.dockWidth||0,u=a.dockHeight||0;d.cameraContainer.style.width=`${c}px`,d.cameraContainer.style.height=`${u}px`}}else e!==null&&(d.cameraContainer.style.transform=`translateX(${e}px)`),t!==null&&(d.cameraContainer.style.bottom=`${t}px`),d.currSettings.dockResizeOnUserJoin===pe.horizontal.name?n!==null&&(d.cameraContainer.style.width=`${n}px`):d.currSettings.dockResizeOnUserJoin===pe.vertical.name&&o!==null&&(d.cameraContainer.style.height=`${o}px`),d.cameraContainer.style.removeProperty("left"),d.cameraContainer.style.removeProperty("top");d.cameraContainer.style.top="",d.cameraContainer.style.left=""}static applyDockResize(e){const t=v();d.cameraContainer&&(d.currSettings.dockResizeOnUserJoin=e,N.set(t.dockResizeOnUserJoin.tag,e),d.cameraContainer.classList.remove("horizontal","vertical"),e===pe.horizontal.name?d.cameraContainer.classList.add("horizontal"):e===pe.vertical.name&&d.cameraContainer.classList.add("vertical"),d.updateDockSize())}static makeDraggable(){var e,t;(e=d.cameraContainer)==null||e.addEventListener("mousedown",n=>{var c,u,p;const o=document.querySelector("#camera-views.minimized");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a==null||a.addEventListener("mousemove",m(d,qt)),a==null||a.addEventListener("mouseup",m(d,Bt)),o))return;const s=G.getOffsetBottom(d.cameraContainer),i=(u=d.cameraContainer)==null?void 0:u.style.transform;let l=0;if(i){const h=i.match(/translateX\(([-\d.]+)px\)/);h&&h[1]&&(l=parseInt(h[1]))}else l=((p=d.cameraContainer)==null?void 0:p.offsetLeft)||0;d.isDragging=!0,A(d,Je,n.clientX-l),A(d,Ge,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=d.cameraContainer)==null||t.addEventListener("touchstart",n=>{var u,p,h;const o=document.querySelector("#camera-views.minimized");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((u=n.target.parentNode)!=null&&u.classList.contains("volume-bar")||(a.addEventListener("touchmove",m(d,Ht)),a.addEventListener("touchend",m(d,Ke)),a.addEventListener("touchcancel",m(d,Ke)),o))return;const s=n.touches[0],i=G.getOffsetBottom(d.cameraContainer),l=(p=d.cameraContainer)==null?void 0:p.style.transform;let c=0;if(l){const E=l.match(/translateX\(([-\d.]+)px\)/);E&&E[1]&&(c=parseInt(E[1]))}else c=((h=d.cameraContainer)==null?void 0:h.offsetLeft)||0;d.isDragging=!0,A(d,Je,s.clientX-c),A(d,Ge,window.innerHeight-s.clientY-i),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var l,c;if(!d.cameraContainer)return;const e=v(),t=d.currSettings.dockResizeOnUserJoin,n=d.currSettings.defaultVideoWidth||Tn,a=(((c=(l=game.webrtc)==null?void 0:l.users)==null?void 0:c.filter(u=>u.active&&u.canBroadcastVideo))||[]).length;if(a===0)return;if(t===pe.horizontal.name){const u=n*a+16;d.cameraContainer.style.width=`${u}px`}else if(t===pe.vertical.name){const u=n*a+16;d.cameraContainer.style.height=`${u}px`}const s=parseInt(d.cameraContainer.style.width||0),i=parseInt(d.cameraContainer.style.height||0);s>0&&N.set(e.dockWidth.tag,s),i>0&&N.set(e.dockHeight.tag,i)}static applyDockResize(e){d.cameraContainer&&(d.currSettings.dockResizeOnUserJoin=e,d.cameraContainer.classList.remove("horizontal","vertical"),e===pe.horizontal.name?d.cameraContainer.classList.add("horizontal"):e===pe.vertical.name&&d.cameraContainer.classList.add("vertical"),d.updateDockSize())}static makeResizeable(){if(d.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=d.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),d.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),d.isResizing=!0,A(d,Ot,o.clientX),A(d,Gt,o.clientY),A(d,Ut,parseInt(getComputedStyle(d.cameraContainer).bottom)||0),A(d,xt,d.cameraContainer.offsetWidth),A(d,Ft,d.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(d,Wt)),e==null||e.addEventListener("mouseup",m(d,Vt))})}}static checkMinimizedState(){if(!d.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;f.log("Checking minimized state",[e,t]),d.handleMinimizedState(t),d.cameraContainer.style.removeProperty("top")}static handleMinimizedState(e){const t=document.querySelector("#interface #players #players-active"),n=d.cameraContainer.querySelector("button[data-action=toggleDock]");!t||!n||!d.cameraContainer||(e?d.cameraContainer.parentNode!==t&&(d.originalParent=d.cameraContainer.parentNode,d.originalNextSibling=d.cameraContainer.nextSibling,n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"),t.insertBefore(d.cameraContainer,t.firstChild),d.cameraContainer.style.transform="",d.cameraContainer.style.bottom="",d.cameraContainer.style.top="",d.cameraContainer.style.left="",d.cameraContainer.style.position="relative"):d.originalParent&&d.cameraContainer.parentNode===t&&(d.originalNextSibling?d.originalParent.insertBefore(d.cameraContainer,d.originalNextSibling):d.originalParent.appendChild(d.cameraContainer),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),d.cameraContainer.style.position="absolute",d.resetPositionAndSize(),d.makeDraggable(),d.makeResizeable(),f.log("Restored camera position from settings",[d.currSettings])))}};Je=new WeakMap,Ge=new WeakMap,Ot=new WeakMap,Gt=new WeakMap,xt=new WeakMap,Ft=new WeakMap,Ut=new WeakMap,qt=new WeakMap,Bt=new WeakMap,Ht=new WeakMap,Ke=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,L(d,Je,0),L(d,Ge,0),b(d,"isDragging",!1),b(d,"cameraContainer"),b(d,"isResizing",!1),L(d,Ot,0),L(d,Gt,0),L(d,xt,0),L(d,Ft,0),L(d,Ut,0),b(d,"currSettings",{}),b(d,"positionIntervalId",null),b(d,"positionAttempts",10),L(d,qt,e=>{const t=document.querySelector("#camera-views.minimized");if(!(!d.isDragging||t)){if(f.log("mousemove",[window.innerHeight,e.clientY,m(d,Ge)]),d.cameraContainer){let n=e.clientX-m(d,Je),o=window.innerHeight-e.clientY-m(d,Ge);d.cameraContainer.style.removeProperty("top"),n+d.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-d.cameraContainer.offsetWidth),n<0&&(n=0),d.cameraContainer.style.transform=`translateX(${n}px)`,o+d.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),L(d,Bt,e=>{var a,s;const t=v(),n={...d.currSettings},o=document.querySelector("#camera-views.minimized");if(d.isDragging&&!o){const i=document.querySelector("body.crlngn-ui"),l=(a=d.cameraContainer)==null?void 0:a.style.transform;let c=0;if(l){const u=l.match(/translateX\(([\d.]+)px\)/);u&&u[1]&&(c=parseInt(u[1]))}n.dockPosX=c,n.dockPosY=parseInt((s=d.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),N.set(t.dockPosX.tag,n.dockPosX),N.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",m(d,qt)),i==null||i.removeEventListener("mouseup",m(d,Bt)),d.isDragging=!1,e.stopPropagation()}}),L(d,Ht,e=>{if(!(!d.isDragging||!e.touches[0])){if(d.cameraContainer){const t=e.touches[0];let n=t.clientX-m(d,Je),o=window.innerHeight-t.clientY-m(d,Ge);d.cameraContainer.style.removeProperty("top"),n+d.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-d.cameraContainer.offsetWidth),n<0&&(n=0),d.cameraContainer.style.transform=`translateX(${n}px)`,o+d.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),L(d,Ke,e=>{var o,a;const t=v(),n={...d.currSettings};if(d.isDragging){const s=document.querySelector("body.crlngn-ui"),i=(o=d.cameraContainer)==null?void 0:o.style.transform;let l=0;if(i){const c=i.match(/translateX\(([\d.]+)px\)/);c&&c[1]&&(l=parseInt(c[1]))}n.dockPosX=l,n.dockPosY=parseInt((a=d.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),N.set(t.dockPosX.tag,n.dockPosX),N.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",m(d,Ht)),s==null||s.removeEventListener("touchend",m(d,Ke)),s==null||s.removeEventListener("touchcancel",m(d,Ke)),d.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),L(d,Wt,e=>{if(!d.isResizing)return;const t=m(d,xt)+(e.clientX-m(d,Ot)),n=e.clientY-m(d,Gt),o=m(d,Ft)+n,a=m(d,Ut)-n;d.cameraContainer.style.width=`${t}px`,d.cameraContainer.style.height=`${o}px`,d.cameraContainer.style.bottom=`${a}px`}),L(d,Vt,()=>{var s,i,l,c,u,p,h;const e=v(),t={...d.currSettings},n=document.querySelector("body.crlngn-ui");d.isResizing=!1,n==null||n.removeEventListener("mousemove",m(d,Wt)),n==null||n.removeEventListener("mouseup",m(d,Vt)),f.log("onStopResize",[(s=d.cameraContainer)==null?void 0:s.style.width,(i=d.cameraContainer)==null?void 0:i.style.height,(l=d.cameraContainer)==null?void 0:l.style.bottom]),t.dockWidth=parseInt(((c=d.cameraContainer)==null?void 0:c.style.width)||0),t.dockHeight=parseInt(((u=d.cameraContainer)==null?void 0:u.style.height)||0),t.dockPosY=parseInt(((p=d.cameraContainer)==null?void 0:p.style.bottom)||0);const o=(h=d.cameraContainer)==null?void 0:h.style.transform;let a=0;if(o){const E=o.match(/translateX\(([\d.]+)px\)/);E&&E[1]&&(a=parseInt(E[1]))}t.dockPosX=a,N.set(e.dockWidth.tag,t.dockWidth),N.set(e.dockHeight.tag,t.dockHeight),N.set(e.dockPosY.tag,t.dockPosY),N.set(e.dockPosX.tag,t.dockPosX)});let ee=d;const ae=class ae{static init(){const e=v();ae.enableChatStyles=N.get(e.enableChatStyles.tag),ae.chatBorderColor=N.get(e.chatBorderColor.tag),Hooks.on(z.RENDER_SIDE_BAR,ae.addChatToggle)}};b(ae,"chatBorderColor"),b(ae,"enableChatStyles"),b(ae,"enrichCard",async(e,t)=>{var s,i,l,c,u,p,h,E;f.log("renderChatMessage",[ae.chatBorderColor,ae.enableChatStyles,ct.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(l=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((h=(p=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:p.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(C=>{const w=C.querySelector(".visible-dc"),x=C.querySelector(".hidden-dc");f.log("enrichCard",[w,x]),w.setAttribute("data-ability",C.getAttribute("data-ability")||""),w.setAttribute("data-dc",C.getAttribute("data-dc")||""),x.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),ae.chatBorderColor===ct.playerColor.name&&((E=e.author)!=null&&E.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}),b(ae,"addChatToggle",async()=>{const e=await renderTemplate(`modules/${U}/templates/chat-toggle-button.hbs`,{}),t=document.querySelector("#ui-right #roll-privacy");t.insertAdjacentHTML("afterbegin",e),t.querySelector("button[data-action=toggleChat]").addEventListener("click",ae.onToggleChatBox)}),b(ae,"onToggleChatBox",e=>{const t=document.querySelector("button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications #chat-message");t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("hidden")):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("hidden"))});let dt=ae;var oo;const de=class de{static init(){Hooks.on(z.RENDER_PLAYERS_LIST,de.checkPlayersList),Hooks.on(z.RENDER_HOTBAR,de.checkPlayersList),G.isModuleOn("foundry-taskbar")&&Hooks.on(z.UPDATE_USER,de.checkTaskbarLock),de.checkTaskbarLock(),de.addModuleClasses(),G.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})}};oo=new WeakMap,L(de,oo),b(de,"addModuleClasses",()=>{const e=v(),t=N.get(e.otherModulesList.tag)||"",n=t.split(",");f.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),b(de,"checkTaskbarLock",()=>{var a,s,i;const e=G.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(f.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(s=t.taskbarSettings)!=null&&s.locked?G.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):G.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?G.addCSSVars("--crlngn-taskbar-height","50px"):G.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),de.checkPlayersList()}),b(de,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=G.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,n,a,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.minimized")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let _e=de;class Te{static init(){Hooks.on(z.RENDER_PLAYERS_LIST,Te.onRender),Te.applyPlayersListSettings(),f.log("PlayersList init")}static onRender(e,t,n){v(),Te.applyPlayersListSettings(),Te.applyAvatars()}static applyPlayersListSettings(){var t,n;const e=v();f.log("applyPlayersListSettings",[N.get(e.autoHidePlayerList.tag)]),N.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized"),_e.checkPlayersList()}static applyAvatars(){const e=v();f.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];N.get(e.playerListAvatars.tag)?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const i=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),l=game.users.get(s.id),c=((p=l.character)==null?void 0:p.img)||"";f.log("player",[l]);const u=document.createElement("img");u.src=c||l.avatar||"",u.alt="*",u.classList.add("avatar"),i&&i.prepend(u)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(i=>{const l=i.querySelector("img.avatar");l==null||l.remove()}),t==null||t.classList.remove("crlngn-avatars")),_e.checkPlayersList()}}var V,jt,Ze,ao,it,rt,Qe,$t,so,Yt,he,xe,me,mn,yn,Sn;const g=class g{static resetLocalVars(){A(g,V,document.querySelector("#scene-navigation")),A(g,it,document.querySelector("#scene-navigation-expand")),A(g,rt,document.querySelector("#ui-left")),A(g,jt,document.querySelector("#scene-navigation-inactive"))}static handleBackButton(e,t,n){if(v(),f.log("handleBackButton",[e,t,n]),!g.useSceneBackButton)return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",m(g,mn)),o.prepend(a)}static handleFolderList(e,t,n){v(),g.navFoldersEnabled&&at.addFolderButtons(e,t,n)}static handleNavState(){v(),m(g,Yt)&&(A(g,Yt,!1),g.toggleNav(g.navStartCollapsed))}static toggleNav(e){clearTimeout(m(g,$t)),A(g,$t,setTimeout(()=>{g.resetLocalVars(),e===!0?f.log("toggleNav collapse",[e,g.navStartCollapsed]):e===!1&&(ui.nav.expand(),f.log("toggleNav expand",[e,g.navStartCollapsed]))},500))}static checkSceneNavCompat(){v(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=m(g,V))==null||e.addEventListener("mouseenter",n=>{if(f.log("TopNavigation mouseenter",[g.isCollapsed,g.showNavOnHover]),!g.isCollapsed||!g.showNavOnHover)return;n.stopPropagation(),clearTimeout(m(g,Ze)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=m(g,V))==null||t.addEventListener("mouseleave",n=>{f.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)&&(n.stopPropagation(),A(g,Ze,setTimeout(()=>{clearTimeout(m(g,Ze)),A(g,Ze,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=v();if(!m(g,V))return;const i=((o=m(g,V))==null?void 0:o.querySelectorAll("li.nav-item"))||[],l=0,c=e!==null?e:g.navPos||0,u=(a=m(g,V))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!u)return;const p=i[c],h=u.offsetWidth||0,E=parseInt(h)*c;f.log("setNavPosition",["position",c,E,m(g,V).scrollWidth]);const C=E-l;if(C>m(g,V).scrollWidth)return;g.navPos=c,N.set(s.sceneNavPos.tag,c),t?G.smoothScrollTo(m(g,V),C,"horizontal",n):m(g,V).scrollTo({left:C,behavior:"instant"})}catch(s){f.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}};V=new WeakMap,jt=new WeakMap,Ze=new WeakMap,ao=new WeakMap,it=new WeakMap,rt=new WeakMap,Qe=new WeakMap,$t=new WeakMap,so=new WeakMap,Yt=new WeakMap,he=new WeakMap,xe=new WeakMap,me=new WeakMap,mn=new WeakMap,yn=new WeakMap,Sn=new WeakMap,L(g,V),L(g,jt),L(g,Ze),L(g,ao),L(g,it),L(g,rt),b(g,"sceneFoldersTemplate"),b(g,"navButtonsTemplate"),L(g,Qe),L(g,$t),L(g,so),L(g,Yt,!0),L(g,he,null),L(g,xe,""),L(g,me,[]),b(g,"sceneNavEnabled"),b(g,"navFoldersEnabled"),b(g,"navFoldersForPlayers"),b(g,"navShowRootFolders"),b(g,"navStartCollapsed"),b(g,"showNavOnHover"),b(g,"useSceneIcons"),b(g,"useScenePreview"),b(g,"useSceneBackButton"),b(g,"sceneClickToView"),b(g,"isCollapsed"),b(g,"navPos"),b(g,"init",()=>{const e=v();g.checkSceneNavCompat(),g.preloadTemplates(),g.navStartCollapsed=N.get(e.navStartCollapsed.tag),g.showNavOnHover=N.get(e.showNavOnHover.tag),g.sceneNavEnabled=N.get(e.sceneNavEnabled.tag),g.useScenePreview=N.get(e.useScenePreview.tag),g.navFoldersEnabled=N.get(e.navFoldersEnabled.tag),g.navFoldersForPlayers=N.get(e.navFoldersForPlayers.tag),g.isCollapsed=g.navStartCollapsed,at.init(),f.log("SCENE NAV INIT",[g.sceneNavEnabled]);const t=document.querySelector("#ui-left");if(g.sceneNavEnabled&&t)t.classList.add("crlngn-nav");else if(t){t.classList.remove("crlngn-nav");return}Hooks.on(z.RENDER_SCENE_NAV,(n,o,a)=>{const s=v();g.handleBackButton(n,o,a),g.handleSceneList(n,o,a),g.handleFolderList(n,o,a);const i=N.get(s.sceneNavPos.tag);g.resetLocalVars(),g.setNavPosition(i,!1),g.handleNavState(),g.addSceneListeners(o),g.addListeners(),g.navShowRootFolders&&(at.init(),at.renderFolderList()),f.log(z.RENDER_SCENE_NAV),clearTimeout(m(g,Qe)),A(g,Qe,setTimeout(()=>{f.log("NAV no transition remove"),g.placeNavButtons()},300))}),Hooks.on(z.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==m(g,me)[m(g,me).length-1]&&m(g,me).push(n)}),Hooks.on(z.COLLAPSE_SIDE_BAR,n=>{f.log(z.COLLAPSE_SIDE_BAR,[n]),n&&g.checkSideBar(n.expanded),g.placeNavButtons()}),Hooks.on(z.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(m(g,Qe)),g.isCollapsed=o,A(g,Qe,setTimeout(()=>{g.setCollapsedClass(o)},250))}),Hooks.on(z.RENDER_SCENE_DIRECTORY,n=>{f.log(z.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var l,c;const i=game.scenes.get(s.dataset.entryId);if(f.log(z.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,g.sceneClickToView]),g.sceneClickToView&&(s.addEventListener("dblclick",g.onActivateScene),s.addEventListener("click",g.onSelectScene)),g.useSceneIcons&&i&&((l=game.user)!=null&&l.isGM)){let u=document.createElement("i");u.classList.add("fas"),u.classList.add("icon"),i.ownership.default!==0?(i.active&&(u.classList.add("fa-bullseye"),s.prepend(u)),((c=game.scenes.current)==null?void 0:c.id)===i.id&&(u.classList.add("fa-star"),s.prepend(u))):(u.classList.add("fa-eye-slash"),s.prepend(u))}})}),ui.sidebar&&g.checkSideBar(ui.sidebar.expanded),g.placeNavButtons()}),b(g,"setCollapsedClass",e=>{e?m(g,rt).classList.add("navigation-collapsed"):(m(g,rt).classList.remove("navigation-collapsed"),g.placeNavButtons())}),b(g,"checkSideBar",e=>{g.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),b(g,"handleSceneList",async(e,t,n)=>{var o,a;if(g.sceneNavEnabled){f.log("handleSceneList",[e,t,n]);const s=t.querySelectorAll(".scene-navigation-menu li.scene");for(const i of s){const l=i.dataset.sceneId;if(g.useScenePreview){const c=game.scenes.find(p=>p.id===l);c.isGM=(o=game.user)==null?void 0:o.isGM;const u=await renderTemplate(`modules/${U}/templates/scene-nav-preview.hbs`,c);if(f.log("sceneData",[c]),i.classList.add("nav-item"),i.insertAdjacentHTML("beforeend",u),c.isGM&&m(g,xe)===l){const p=new MouseEvent("mouseenter");i.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&g.addPreviewIconListeners(i,c)}g.useSceneIcons&&(i.classList.contains("active")||i.classList.contains("view"))&&i.classList.add("crlngn")}}if(g.sceneNavEnabled){const s=t.querySelector("#scene-navigation-expand"),i=document.querySelector("#ui-left-column-2"),l=document.querySelector("#crlngn-scene-navigation-expand");l&&l.remove();const c=s==null?void 0:s.cloneNode(!0);c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{s.click()}),f.log("toggle events",[e,c]),i.prepend(c)}}),L(g,mn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=m(g,me).length,n=m(g,me)[t-2];let o;f.log("#onBackButton before",[t,n,m(g,me)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),m(g,me).pop()),f.log("#onBackButton after",[m(g,me)])}),b(g,"placeNavButtons",async()=>{var l;const e=document.querySelector("#scene-navigation");e.querySelector("#scene-navigation-inactive");const t=document.querySelectorAll(".crlngn-btn");if(!e)return;const n=((l=m(g,it))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(f.log("placeNavButtons",[o,t]),t.forEach(c=>c.remove()),!o)return;const a=await renderTemplate(`modules/${U}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=e.parentNode.querySelector("button.crlngn-btn.ui-nav-left"),i=e.parentNode.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",m(g,yn)),i&&i.addEventListener("click",m(g,Sn))}),L(g,yn,async e=>{const t=await g.getItemsPerPage(),n=g.navPos||0;if(!m(g,jt)||!m(g,V))return;let o=n-(t-1);f.log("onNavLast",["pos",o,m(g,V).scrollWidth]),o=o<0?0:o,g.setNavPosition(o)}),L(g,Sn,async e=>{var c,u;const t=await g.getItemsPerPage(),n=g.navPos||0,o=(c=m(g,V))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((u=m(g,V))==null?void 0:u.scrollWidth)||0;if(!a||!m(g,V))return;let i=n+(t-1),l=i*a;f.log("onNavNext",["pos",n,i,o==null?void 0:o.offsetWidth,l,s]),l>=s&&(i=Math.floor(s/a)),g.setNavPosition(i)}),b(g,"getItemsPerPage",async()=>{var e,t;try{f.log("getItemsPerPage",["Starting"]),g.resetLocalVars();const n=0,o=0,a=((e=m(g,it))==null?void 0:e.offsetWidth)||0,s=(t=m(g,V))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!m(g,V))return f.log("getItemsPerPage",["No scene items found"]),0;const i=s.offsetWidth,l=m(g,V).offsetWidth;if(!l)return f.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((l-a*2)/i);return f.log("getItemsPerPage",["Calculated:",c,l,i]),c||0}catch(n){return f.log("getItemsPerPage",["Error:",n]),f.error("Error in getItemsPerPage:",n),0}}),b(g,"preloadTemplates",async()=>{try{const e=[`modules/${U}/templates/scene-nav-buttons.hbs`,`modules/${U}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),b(g,"getCurrScenePosition",async e=>{try{if(!m(g,V)||!e)return 0;const t=await g.getItemsPerPage()||1,n=m(g,V).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(a===-1)return 0;const s=a>=g.navPos&&a<=g.navPos+t,i=s?g.navPos:a;return f.log("getCurrScenePosition",["Final position:",i,"isVisible:",s]),i}catch(t){return f.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),b(g,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);f.log("onActivateScene",[o,a]),a.activate(),m(g,he)&&(clearTimeout(m(g,he)),A(g,he,null))}),b(g,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(A(g,xe,""),f.log("onSelectScene",[a,t,n]),a&&a.sheet){const s=a.sheet.render;f.log("onSelectScene - originalRender",[s]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=s},250)}m(g,he)&&(clearTimeout(m(g,he)),A(g,he,null)),A(g,he,setTimeout(()=>{a.view(),A(g,he,null)},250))}),b(g,"onScenePreviewOn",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.dataset;A(g,xe,n.sceneId),f.log("onScenePreviewOn",[m(g,xe)]),t.querySelector(".scene-preview").classList.add("open")}),b(g,"onScenePreviewOff",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget;A(g,xe,""),f.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),b(g,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",g.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",g.onActivateScene),n.addEventListener("mouseenter",g.onScenePreviewOn),n.addEventListener("mouseleave",g.onScenePreviewOff)})}),b(g,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!u}),f.log("Toggled global illumination",[!u])});const s=o.querySelector(".token-vision");s&&s.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.tokenVision;await n.update({tokenVision:!u}),f.log("Toggled token vision",[!u])});const i=o.querySelector(".sound");i&&n.playlistSound&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.playlistSound;if(u){const p=u.sound.playing;p?await u.sound.pause():await u.sound.play(),ui.nav.render(),f.log("Toggled playlist sound",[!p])}});const l=o.querySelector(".config");l&&l.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),f.log("Opened scene configuration")})});let F=g;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function fo(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function we(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fo(Object(t),!0).forEach(function(n){va(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):fo(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function an(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?an=function(e){return typeof e}:an=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(r)}function va(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Re(){return Re=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Re.apply(this,arguments)}function ba(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}function Ca(r,e){if(r==null)return{};var t=ba(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}var Ea="1.15.6";function ke(r){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(r)}var Me=ke(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Kt=ke(/Edge/i),po=ke(/firefox/i),wt=ke(/safari/i)&&!ke(/chrome/i)&&!ke(/android/i),io=ke(/iP(ad|od|hone)/i),Fo=ke(/chrome/i)&&ke(/android/i),Uo={capture:!1,passive:!1};function O(r,e,t){r.addEventListener(e,t,!Me&&Uo)}function P(r,e,t){r.removeEventListener(e,t,!Me&&Uo)}function dn(r,e){if(e){if(e[0]===">"&&(e=e.substring(1)),r)try{if(r.matches)return r.matches(e);if(r.msMatchesSelector)return r.msMatchesSelector(e);if(r.webkitMatchesSelector)return r.webkitMatchesSelector(e)}catch{return!1}return!1}}function qo(r){return r.host&&r!==document&&r.host.nodeType?r.host:r.parentNode}function ye(r,e,t,n){if(r){t=t||document;do{if(e!=null&&(e[0]===">"?r.parentNode===t&&dn(r,e):dn(r,e))||n&&r===t)return r;if(r===t)break}while(r=qo(r))}return null}var ho=/\s+/g;function le(r,e,t){if(r&&e)if(r.classList)r.classList[t?"add":"remove"](e);else{var n=(" "+r.className+" ").replace(ho," ").replace(" "+e+" "," ");r.className=(n+(t?" "+e:"")).replace(ho," ")}}function I(r,e,t){var n=r&&r.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(r,""):r.currentStyle&&(t=r.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function st(r,e){var t="";if(typeof r=="string")t=r;else do{var n=I(r,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(r=r.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Bo(r,e,t){if(r){var n=r.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Le(){var r=document.scrollingElement;return r||document.documentElement}function J(r,e,t,n,o){if(!(!r.getBoundingClientRect&&r!==window)){var a,s,i,l,c,u,p;if(r!==window&&r.parentNode&&r!==Le()?(a=r.getBoundingClientRect(),s=a.top,i=a.left,l=a.bottom,c=a.right,u=a.height,p=a.width):(s=0,i=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,p=window.innerWidth),(e||t)&&r!==window&&(o=o||r.parentNode,!Me))do if(o&&o.getBoundingClientRect&&(I(o,"transform")!=="none"||t&&I(o,"position")!=="static")){var h=o.getBoundingClientRect();s-=h.top+parseInt(I(o,"border-top-width")),i-=h.left+parseInt(I(o,"border-left-width")),l=s+a.height,c=i+a.width;break}while(o=o.parentNode);if(n&&r!==window){var E=st(o||r),C=E&&E.a,w=E&&E.d;E&&(s/=w,i/=C,p/=C,u/=w,l=s+u,c=i+p)}return{top:s,left:i,bottom:l,right:c,width:p,height:u}}}function mo(r,e,t){for(var n=qe(r,!0),o=J(r)[e];n;){var a=J(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Le())break;n=qe(n,!1)}return!1}function ut(r,e,t,n){for(var o=0,a=0,s=r.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==k.ghost&&(n||s[a]!==k.dragged)&&ye(s[a],t.draggable,r,!1)){if(o===e)return s[a];o++}a++}return null}function ro(r,e){for(var t=r.lastElementChild;t&&(t===k.ghost||I(t,"display")==="none"||e&&!dn(t,e));)t=t.previousElementSibling;return t||null}function ue(r,e){var t=0;if(!r||!r.parentNode)return-1;for(;r=r.previousElementSibling;)r.nodeName.toUpperCase()!=="TEMPLATE"&&r!==k.clone&&(!e||dn(r,e))&&t++;return t}function yo(r){var e=0,t=0,n=Le();if(r)do{var o=st(r),a=o.a,s=o.d;e+=r.scrollLeft*a,t+=r.scrollTop*s}while(r!==n&&(r=r.parentNode));return[e,t]}function Na(r,e){for(var t in r)if(r.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===r[t][n])return Number(t)}return-1}function qe(r,e){if(!r||!r.getBoundingClientRect)return Le();var t=r,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=I(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Le();if(n||e)return t;n=!0}}while(t=t.parentNode);return Le()}function Ta(r,e){if(r&&e)for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function Ln(r,e){return Math.round(r.top)===Math.round(e.top)&&Math.round(r.left)===Math.round(e.left)&&Math.round(r.height)===Math.round(e.height)&&Math.round(r.width)===Math.round(e.width)}var It;function Ho(r,e){return function(){if(!It){var t=arguments,n=this;t.length===1?r.call(n,t[0]):r.apply(n,t),It=setTimeout(function(){It=void 0},e)}}}function La(){clearTimeout(It),It=void 0}function Wo(r,e,t){r.scrollLeft+=e,r.scrollTop+=t}function Vo(r){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(r).cloneNode(!0):t?t(r).clone(!0)[0]:r.cloneNode(!0)}function jo(r,e,t){var n={};return Array.from(r.children).forEach(function(o){var a,s,i,l;if(!(!ye(o,e.draggable,r,!1)||o.animated||o===t)){var c=J(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((i=n.right)!==null&&i!==void 0?i:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var se="Sortable"+new Date().getTime();function wa(){var r=[],e;return{captureAnimationState:function(){if(r=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(I(o,"display")==="none"||o===k.ghost)){r.push({target:o,rect:J(o)});var a=we({},r[r.length-1].rect);if(o.thisAnimationDuration){var s=st(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){r.push(n)},removeAnimationState:function(n){r.splice(Na(r,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;r.forEach(function(i){var l=0,c=i.target,u=c.fromRect,p=J(c),h=c.prevFromRect,E=c.prevToRect,C=i.rect,w=st(c,!0);w&&(p.top-=w.f,p.left-=w.e),c.toRect=p,c.thisAnimationDuration&&Ln(h,p)&&!Ln(u,p)&&(C.top-p.top)/(C.left-p.left)===(u.top-p.top)/(u.left-p.left)&&(l=ka(C,h,E,o.options)),Ln(p,u)||(c.prevFromRect=u,c.prevToRect=p,l||(l=o.options.animation),o.animate(c,C,p,l)),l&&(a=!0,s=Math.max(s,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),r=[]},animate:function(n,o,a,s){if(s){I(n,"transition",""),I(n,"transform","");var i=st(this.el),l=i&&i.a,c=i&&i.d,u=(o.left-a.left)/(l||1),p=(o.top-a.top)/(c||1);n.animatingX=!!u,n.animatingY=!!p,I(n,"transform","translate3d("+u+"px,"+p+"px,0)"),this.forRepaintDummy=Ia(n),I(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),I(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){I(n,"transition",""),I(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function Ia(r){return r.offsetWidth}function ka(r,e,t,n){return Math.sqrt(Math.pow(e.top-r.top,2)+Math.pow(e.left-r.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var et=[],wn={initializeByDefault:!0},Zt={mount:function(e){for(var t in wn)wn.hasOwnProperty(t)&&!(t in e)&&(e[t]=wn[t]);et.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),et.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";et.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](we({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](we({sortable:t},n)))})},initializePlugins:function(e,t,n,o){et.forEach(function(i){var l=i.pluginName;if(!(!e.options[l]&&!i.initializeByDefault)){var c=new i(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,Re(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return et.forEach(function(o){typeof o.eventProperties=="function"&&Re(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return et.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function Ra(r){var e=r.sortable,t=r.rootEl,n=r.name,o=r.targetEl,a=r.cloneEl,s=r.toEl,i=r.fromEl,l=r.oldIndex,c=r.newIndex,u=r.oldDraggableIndex,p=r.newDraggableIndex,h=r.originalEvent,E=r.putSortable,C=r.extraEventProperties;if(e=e||t&&t[se],!!e){var w,x=e.options,q="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Me&&!Kt?w=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(w=document.createEvent("Event"),w.initEvent(n,!0,!0)),w.to=s||t,w.from=i||t,w.item=o||t,w.clone=a,w.oldIndex=l,w.newIndex=c,w.oldDraggableIndex=u,w.newDraggableIndex=p,w.originalEvent=h,w.pullMode=E?E.lastPutMode:void 0;var K=we(we({},C),Zt.getEventProperties(n,e));for(var ge in K)w[ge]=K[ge];t&&t.dispatchEvent(w),x[q]&&x[q].call(e,w)}}var Ma=["evt"],ne=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=Ca(n,Ma);Zt.pluginEvent.bind(k)(e,t,we({dragEl:y,parentEl:$,ghostEl:M,rootEl:B,nextEl:Xe,lastDownEl:sn,cloneEl:H,cloneHidden:Oe,dragStarted:Nt,putSortable:Q,activeSortable:k.active,originalEvent:o,oldIndex:ot,oldDraggableIndex:kt,newIndex:ce,newDraggableIndex:ze,hideGhostForTarget:Jo,unhideGhostForTarget:Ko,cloneNowHidden:function(){Oe=!0},cloneNowShown:function(){Oe=!1},dispatchSortableEvent:function(i){te({sortable:t,name:i,originalEvent:o})}},a))};function te(r){Ra(we({putSortable:Q,cloneEl:H,targetEl:y,rootEl:B,oldIndex:ot,oldDraggableIndex:kt,newIndex:ce,newDraggableIndex:ze},r))}var y,$,M,B,Xe,sn,H,Oe,ot,ce,kt,ze,en,Q,nt=!1,un=!1,gn=[],$e,fe,In,kn,So,vo,Nt,tt,Rt,Mt=!1,tn=!1,rn,_,Rn=[],Vn=!1,fn=[],En=typeof document<"u",nn=io,bo=Kt||Me?"cssFloat":"float",Da=En&&!Fo&&!io&&"draggable"in document.createElement("div"),$o=function(){if(En){if(Me)return!1;var r=document.createElement("x");return r.style.cssText="pointer-events:auto",r.style.pointerEvents==="auto"}}(),Yo=function(e,t){var n=I(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=ut(e,0,t),s=ut(e,1,t),i=a&&I(a),l=s&&I(s),c=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+J(a).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+J(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&i.float&&i.float!=="none"){var p=i.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return a&&(i.display==="block"||i.display==="flex"||i.display==="table"||i.display==="grid"||c>=o&&n[bo]==="none"||s&&n[bo]==="none"&&c+u>o)?"vertical":"horizontal"},Aa=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,i=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===i||a===l||o+s/2===i+c/2},Pa=function(e,t){var n;return gn.some(function(o){var a=o[se].options.emptyInsertThreshold;if(!(!a||ro(o))){var s=J(o),i=e>=s.left-a&&e<=s.right+a,l=t>=s.top-a&&t<=s.bottom+a;if(i&&l)return n=o}}),n},Xo=function(e){function t(a,s){return function(i,l,c,u){var p=i.options.group.name&&l.options.group.name&&i.options.group.name===l.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(i,l,c,u),s)(i,l,c,u);var h=(s?i:l).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},o=e.group;(!o||an(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Jo=function(){!$o&&M&&I(M,"display","none")},Ko=function(){!$o&&M&&I(M,"display","")};En&&!Fo&&document.addEventListener("click",function(r){if(un)return r.preventDefault(),r.stopPropagation&&r.stopPropagation(),r.stopImmediatePropagation&&r.stopImmediatePropagation(),un=!1,!1},!0);var Ye=function(e){if(y){e=e.touches?e.touches[0]:e;var t=Pa(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[se]._onDragOver(n)}}},za=function(e){y&&y.parentNode[se]._isOutsideThisEl(e.target)};function k(r,e){if(!(r&&r.nodeType&&r.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(r));this.el=r,this.options=e=Re({},e),r[se]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(r.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Yo(r,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,i){s.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!wt||io),emptyInsertThreshold:5};Zt.initializePlugins(this,r,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Xo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Da,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?O(r,"pointerdown",this._onTapStart):(O(r,"mousedown",this._onTapStart),O(r,"touchstart",this._onTapStart)),this.nativeDraggable&&(O(r,"dragover",this),O(r,"dragenter",this)),gn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Re(this,wa())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(tt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,y):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,i=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(i||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(Ha(n),!y&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&wt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=ye(l,o.draggable,n,!1),!(l&&l.animated)&&sn!==l)){if(ot=ue(l),kt=ue(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){te({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),ne("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(p){if(p=ye(c,p.trim(),n,!1),p)return te({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),ne("filter",t,{evt:e}),!0}),u)){a&&e.preventDefault();return}o.handle&&!ye(c,o.handle,n,!1)||this._prepareDragStart(e,i,l)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,i=a.ownerDocument,l;if(n&&!y&&n.parentNode===a){var c=J(n);if(B=a,y=n,$=y.parentNode,Xe=y.nextSibling,sn=n,en=s.group,k.dragged=y,$e={target:y,clientX:(t||e).clientX,clientY:(t||e).clientY},So=$e.clientX-c.left,vo=$e.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,y.style["will-change"]="all",l=function(){if(ne("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!po&&o.nativeDraggable&&(y.draggable=!0),o._triggerDragStart(e,t),te({sortable:o,name:"choose",originalEvent:e}),le(y,s.chosenClass,!0)},s.ignore.split(",").forEach(function(u){Bo(y,u.trim(),Mn)}),O(i,"dragover",Ye),O(i,"mousemove",Ye),O(i,"touchmove",Ye),s.supportPointer?(O(i,"pointerup",o._onDrop),!this.nativeDraggable&&O(i,"pointercancel",o._onDrop)):(O(i,"mouseup",o._onDrop),O(i,"touchend",o._onDrop),O(i,"touchcancel",o._onDrop)),po&&this.nativeDraggable&&(this.options.touchStartThreshold=4,y.draggable=!0),ne("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Kt||Me))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(O(i,"pointerup",o._disableDelayedDrag),O(i,"pointercancel",o._disableDelayedDrag)):(O(i,"mouseup",o._disableDelayedDrag),O(i,"touchend",o._disableDelayedDrag),O(i,"touchcancel",o._disableDelayedDrag)),O(i,"mousemove",o._delayedDragTouchMoveHandler),O(i,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&O(i,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,s.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){y&&Mn(y),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._disableDelayedDrag),P(e,"touchend",this._disableDelayedDrag),P(e,"touchcancel",this._disableDelayedDrag),P(e,"pointerup",this._disableDelayedDrag),P(e,"pointercancel",this._disableDelayedDrag),P(e,"mousemove",this._delayedDragTouchMoveHandler),P(e,"touchmove",this._delayedDragTouchMoveHandler),P(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?O(document,"pointermove",this._onTouchMove):t?O(document,"touchmove",this._onTouchMove):O(document,"mousemove",this._onTouchMove):(O(y,"dragend",this),O(B,"dragstart",this._onDragStart));try{document.selection?ln(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(nt=!1,B&&y){ne("dragStarted",this,{evt:t}),this.nativeDraggable&&O(document,"dragover",za);var n=this.options;!e&&le(y,n.dragClass,!1),le(y,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),te({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(fe){this._lastX=fe.clientX,this._lastY=fe.clientY,Jo();for(var e=document.elementFromPoint(fe.clientX,fe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(fe.clientX,fe.clientY),e!==t);)t=e;if(y.parentNode[se]._isOutsideThisEl(e),t)do{if(t[se]){var n=void 0;if(n=t[se]._onDragOver({clientX:fe.clientX,clientY:fe.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=qo(t));Ko()}},_onTouchMove:function(e){if($e){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=M&&st(M,!0),i=M&&s&&s.a,l=M&&s&&s.d,c=nn&&_&&yo(_),u=(a.clientX-$e.clientX+o.x)/(i||1)+(c?c[0]-Rn[0]:0)/(i||1),p=(a.clientY-$e.clientY+o.y)/(l||1)+(c?c[1]-Rn[1]:0)/(l||1);if(!k.active&&!nt){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(M){s?(s.e+=u-(In||0),s.f+=p-(kn||0)):s={a:1,b:0,c:0,d:1,e:u,f:p};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");I(M,"webkitTransform",h),I(M,"mozTransform",h),I(M,"msTransform",h),I(M,"transform",h),In=u,kn=p,fe=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!M){var e=this.options.fallbackOnBody?document.body:B,t=J(y,!0,nn,!0,e),n=this.options;if(nn){for(_=e;I(_,"position")==="static"&&I(_,"transform")==="none"&&_!==document;)_=_.parentNode;_!==document.body&&_!==document.documentElement?(_===document&&(_=Le()),t.top+=_.scrollTop,t.left+=_.scrollLeft):_=Le(),Rn=yo(_)}M=y.cloneNode(!0),le(M,n.ghostClass,!1),le(M,n.fallbackClass,!0),le(M,n.dragClass,!0),I(M,"transition",""),I(M,"transform",""),I(M,"box-sizing","border-box"),I(M,"margin",0),I(M,"top",t.top),I(M,"left",t.left),I(M,"width",t.width),I(M,"height",t.height),I(M,"opacity","0.8"),I(M,"position",nn?"absolute":"fixed"),I(M,"zIndex","100000"),I(M,"pointerEvents","none"),k.ghost=M,e.appendChild(M),I(M,"transform-origin",So/parseInt(M.style.width)*100+"% "+vo/parseInt(M.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(ne("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}ne("setupClone",this),k.eventCanceled||(H=Vo(y),H.removeAttribute("id"),H.draggable=!1,H.style["will-change"]="",this._hideClone(),le(H,this.options.chosenClass,!1),k.clone=H),n.cloneId=ln(function(){ne("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||B.insertBefore(H,y),n._hideClone(),te({sortable:n,name:"clone"}))}),!t&&le(y,a.dragClass,!0),t?(un=!0,n._loopId=setInterval(n._emulateDragOver,50)):(P(document,"mouseup",n._onDrop),P(document,"touchend",n._onDrop),P(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,y)),O(document,"drop",n),I(y,"transform","translateZ(0)")),nt=!0,n._dragStartId=ln(n._dragStarted.bind(n,t,e)),O(document,"selectstart",n),Nt=!0,window.getSelection().removeAllRanges(),wt&&I(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,i=this.options,l=i.group,c=k.active,u=en===l,p=i.sort,h=Q||c,E,C=this,w=!1;if(Vn)return;function x(Ct,ea){ne(Ct,C,we({evt:e,isOwner:u,axis:E?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:h,target:n,completed:K,onMove:function(uo,ta){return on(B,t,y,o,uo,J(uo),e,ta)},changed:ge},ea))}function q(){x("dragOverAnimationCapture"),C.captureAnimationState(),C!==h&&h.captureAnimationState()}function K(Ct){return x("dragOverCompleted",{insertion:Ct}),Ct&&(u?c._hideClone():c._showClone(C),C!==h&&(le(y,Q?Q.options.ghostClass:c.options.ghostClass,!1),le(y,i.ghostClass,!0)),Q!==C&&C!==k.active?Q=C:C===k.active&&Q&&(Q=null),h===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){x("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===y&&!y.animated||n===t&&!n.animated)&&(tt=null),!i.dragoverBubble&&!e.rootEl&&n!==document&&(y.parentNode[se]._isOutsideThisEl(e.target),!Ct&&Ye(e)),!i.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),w=!0}function ge(){ce=ue(y),ze=ue(y,i.draggable),te({sortable:C,name:"change",toEl:t,newIndex:ce,newDraggableIndex:ze,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=ye(n,i.draggable,t,!0),x("dragOver"),k.eventCanceled)return w;if(y.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return K(!1);if(un=!1,c&&!i.disabled&&(u?p||(s=$!==B):Q===this||(this.lastPutMode=en.checkPull(this,c,y,e))&&l.checkPut(this,c,y,e))){if(E=this._getDirection(e,n)==="vertical",o=J(y),x("dragOverValid"),k.eventCanceled)return w;if(s)return $=B,q(),this._hideClone(),x("revert"),k.eventCanceled||(Xe?B.insertBefore(y,Xe):B.appendChild(y)),K(!0);var ie=ro(t,i.draggable);if(!ie||Fa(e,E,this)&&!ie.animated){if(ie===y)return K(!1);if(ie&&t===e.target&&(n=ie),n&&(a=J(n)),on(B,t,y,o,n,a,e,!!n)!==!1)return q(),ie&&ie.nextSibling?t.insertBefore(y,ie.nextSibling):t.appendChild(y),$=t,ge(),K(!0)}else if(ie&&xa(e,E,this)){var We=ut(t,0,i,!0);if(We===y)return K(!1);if(n=We,a=J(n),on(B,t,y,o,n,a,e,!1)!==!1)return q(),t.insertBefore(y,We),$=t,ge(),K(!0)}else if(n.parentNode===t){a=J(n);var Se=0,Ve,yt=y.parentNode!==t,re=!Aa(y.animated&&y.toRect||o,n.animated&&n.toRect||a,E),St=E?"top":"left",De=mo(n,"top","top")||mo(y,"top","top"),vt=De?De.scrollTop:void 0;tt!==n&&(Ve=a[St],Mt=!1,tn=!re&&i.invertSwap||yt),Se=Ua(e,n,a,E,re?1:i.swapThreshold,i.invertedSwapThreshold==null?i.swapThreshold:i.invertedSwapThreshold,tn,tt===n);var Ie;if(Se!==0){var je=ue(y);do je-=Se,Ie=$.children[je];while(Ie&&(I(Ie,"display")==="none"||Ie===M))}if(Se===0||Ie===n)return K(!1);tt=n,Rt=Se;var bt=n.nextElementSibling,Ae=!1;Ae=Se===1;var Qt=on(B,t,y,o,n,a,e,Ae);if(Qt!==!1)return(Qt===1||Qt===-1)&&(Ae=Qt===1),Vn=!0,setTimeout(Ga,30),q(),Ae&&!bt?t.appendChild(y):n.parentNode.insertBefore(y,Ae?bt:n),De&&Wo(De,0,vt-De.scrollTop),$=y.parentNode,Ve!==void 0&&!tn&&(rn=Math.abs(Ve-J(n)[St])),ge(),K(!0)}if(t.contains(y))return K(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){P(document,"mousemove",this._onTouchMove),P(document,"touchmove",this._onTouchMove),P(document,"pointermove",this._onTouchMove),P(document,"dragover",Ye),P(document,"mousemove",Ye),P(document,"touchmove",Ye)},_offUpEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._onDrop),P(e,"touchend",this._onDrop),P(e,"pointerup",this._onDrop),P(e,"pointercancel",this._onDrop),P(e,"touchcancel",this._onDrop),P(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(ce=ue(y),ze=ue(y,n.draggable),ne("drop",this,{evt:e}),$=y&&y.parentNode,ce=ue(y),ze=ue(y,n.draggable),k.eventCanceled){this._nulling();return}nt=!1,tn=!1,Mt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),jn(this.cloneId),jn(this._dragStartId),this.nativeDraggable&&(P(document,"drop",this),P(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),wt&&I(document.body,"user-select",""),I(y,"transform",""),e&&(Nt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),M&&M.parentNode&&M.parentNode.removeChild(M),(B===$||Q&&Q.lastPutMode!=="clone")&&H&&H.parentNode&&H.parentNode.removeChild(H),y&&(this.nativeDraggable&&P(y,"dragend",this),Mn(y),y.style["will-change"]="",Nt&&!nt&&le(y,Q?Q.options.ghostClass:this.options.ghostClass,!1),le(y,this.options.chosenClass,!1),te({sortable:this,name:"unchoose",toEl:$,newIndex:null,newDraggableIndex:null,originalEvent:e}),B!==$?(ce>=0&&(te({rootEl:$,name:"add",toEl:$,fromEl:B,originalEvent:e}),te({sortable:this,name:"remove",toEl:$,originalEvent:e}),te({rootEl:$,name:"sort",toEl:$,fromEl:B,originalEvent:e}),te({sortable:this,name:"sort",toEl:$,originalEvent:e})),Q&&Q.save()):ce!==ot&&ce>=0&&(te({sortable:this,name:"update",toEl:$,originalEvent:e}),te({sortable:this,name:"sort",toEl:$,originalEvent:e})),k.active&&((ce==null||ce===-1)&&(ce=ot,ze=kt),te({sortable:this,name:"end",toEl:$,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ne("nulling",this),B=y=$=M=Xe=H=sn=Oe=$e=fe=Nt=ce=ze=ot=kt=tt=Rt=Q=en=k.dragged=k.ghost=k.clone=k.active=null,fn.forEach(function(e){e.checked=!0}),fn.length=In=kn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":y&&(this._onDragOver(e),Oa(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],ye(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Ba(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var i=o.children[s];ye(i,this.options.draggable,o,!1)&&(n[a]=i)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ye(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=Zt.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Xo(n)},destroy:function(){ne("destroy",this);var e=this.el;e[se]=null,P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart),P(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),gn.splice(gn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Oe){if(ne("hideClone",this),k.eventCanceled)return;I(H,"display","none"),this.options.removeCloneOnHide&&H.parentNode&&H.parentNode.removeChild(H),Oe=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Oe){if(ne("showClone",this),k.eventCanceled)return;y.parentNode==B&&!this.options.group.revertClone?B.insertBefore(H,y):Xe?B.insertBefore(H,Xe):B.appendChild(H),this.options.group.revertClone&&this.animate(y,H),I(H,"display",""),Oe=!1}}};function Oa(r){r.dataTransfer&&(r.dataTransfer.dropEffect="move"),r.cancelable&&r.preventDefault()}function on(r,e,t,n,o,a,s,i){var l,c=r[se],u=c.options.onMove,p;return window.CustomEvent&&!Me&&!Kt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=r,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=a||J(e),l.willInsertAfter=i,l.originalEvent=s,r.dispatchEvent(l),u&&(p=u.call(c,l,s)),p}function Mn(r){r.draggable=!1}function Ga(){Vn=!1}function xa(r,e,t){var n=J(ut(t.el,0,t.options,!0)),o=jo(t.el,t.options,M),a=10;return e?r.clientX<o.left-a||r.clientY<n.top&&r.clientX<n.right:r.clientY<o.top-a||r.clientY<n.bottom&&r.clientX<n.left}function Fa(r,e,t){var n=J(ro(t.el,t.options.draggable)),o=jo(t.el,t.options,M),a=10;return e?r.clientX>o.right+a||r.clientY>n.bottom&&r.clientX>n.left:r.clientY>o.bottom+a||r.clientX>n.right&&r.clientY>n.top}function Ua(r,e,t,n,o,a,s,i){var l=n?r.clientY:r.clientX,c=n?t.height:t.width,u=n?t.top:t.left,p=n?t.bottom:t.right,h=!1;if(!s){if(i&&rn<c*o){if(!Mt&&(Rt===1?l>u+c*a/2:l<p-c*a/2)&&(Mt=!0),Mt)h=!0;else if(Rt===1?l<u+rn:l>p-rn)return-Rt}else if(l>u+c*(1-o)/2&&l<p-c*(1-o)/2)return qa(e)}return h=h||s,h&&(l<u+c*a/2||l>p-c*a/2)?l>u+c/2?1:-1:0}function qa(r){return ue(y)<ue(r)?1:-1}function Ba(r){for(var e=r.tagName+r.className+r.src+r.href+r.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Ha(r){fn.length=0;for(var e=r.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&fn.push(n)}}function ln(r){return setTimeout(r,0)}function jn(r){return clearTimeout(r)}En&&O(document,"touchmove",function(r){(k.active||nt)&&r.cancelable&&r.preventDefault()});k.utils={on:O,off:P,css:I,find:Bo,is:function(e,t){return!!ye(e,t,e,!1)},extend:Ta,throttle:Ho,closest:ye,toggleClass:le,clone:Vo,index:ue,nextTick:ln,cancelNextTick:jn,detectDirection:Yo,getChild:ut,expando:se};k.get=function(r){return r[se]};k.mount=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=we(we({},k.utils),n.utils)),Zt.mount(n)})};k.create=function(r,e){return new k(r,e)};k.version=Ea;var Y=[],Tt,$n,Yn=!1,Dn,An,pn,Lt;function Wa(){function r(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return r.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?O(document,"dragover",this._handleAutoScroll):this.options.supportPointer?O(document,"pointermove",this._handleFallbackAutoScroll):n.touches?O(document,"touchmove",this._handleFallbackAutoScroll):O(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):(P(document,"pointermove",this._handleFallbackAutoScroll),P(document,"touchmove",this._handleFallbackAutoScroll),P(document,"mousemove",this._handleFallbackAutoScroll)),Co(),cn(),La()},nulling:function(){pn=$n=Tt=Yn=Lt=Dn=An=null,Y.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,i=document.elementFromPoint(a,s);if(pn=t,n||this.options.forceAutoScrollFallback||Kt||Me||wt){Pn(t,this.options,i,n);var l=qe(i,!0);Yn&&(!Lt||a!==Dn||s!==An)&&(Lt&&Co(),Lt=setInterval(function(){var c=qe(document.elementFromPoint(a,s),!0);c!==l&&(l=c,cn()),Pn(t,o.options,c,n)},10),Dn=a,An=s)}else{if(!this.options.bubbleScroll||qe(i,!0)===Le()){cn();return}Pn(t,this.options,qe(i,!1),!1)}}},Re(r,{pluginName:"scroll",initializeByDefault:!0})}function cn(){Y.forEach(function(r){clearInterval(r.pid)}),Y=[]}function Co(){clearInterval(Lt)}var Pn=Ho(function(r,e,t,n){if(e.scroll){var o=(r.touches?r.touches[0]:r).clientX,a=(r.touches?r.touches[0]:r).clientY,s=e.scrollSensitivity,i=e.scrollSpeed,l=Le(),c=!1,u;$n!==t&&($n=t,cn(),Tt=e.scroll,u=e.scrollFn,Tt===!0&&(Tt=qe(t,!0)));var p=0,h=Tt;do{var E=h,C=J(E),w=C.top,x=C.bottom,q=C.left,K=C.right,ge=C.width,ie=C.height,We=void 0,Se=void 0,Ve=E.scrollWidth,yt=E.scrollHeight,re=I(E),St=E.scrollLeft,De=E.scrollTop;E===l?(We=ge<Ve&&(re.overflowX==="auto"||re.overflowX==="scroll"||re.overflowX==="visible"),Se=ie<yt&&(re.overflowY==="auto"||re.overflowY==="scroll"||re.overflowY==="visible")):(We=ge<Ve&&(re.overflowX==="auto"||re.overflowX==="scroll"),Se=ie<yt&&(re.overflowY==="auto"||re.overflowY==="scroll"));var vt=We&&(Math.abs(K-o)<=s&&St+ge<Ve)-(Math.abs(q-o)<=s&&!!St),Ie=Se&&(Math.abs(x-a)<=s&&De+ie<yt)-(Math.abs(w-a)<=s&&!!De);if(!Y[p])for(var je=0;je<=p;je++)Y[je]||(Y[je]={});(Y[p].vx!=vt||Y[p].vy!=Ie||Y[p].el!==E)&&(Y[p].el=E,Y[p].vx=vt,Y[p].vy=Ie,clearInterval(Y[p].pid),(vt!=0||Ie!=0)&&(c=!0,Y[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(pn);var bt=Y[this.layer].vy?Y[this.layer].vy*i:0,Ae=Y[this.layer].vx?Y[this.layer].vx*i:0;typeof u=="function"&&u.call(k.dragged.parentNode[se],Ae,bt,r,pn,Y[this.layer].el)!=="continue"||Wo(Y[this.layer].el,Ae,bt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&h!==l&&(h=qe(h,!1)));Yn=c}},30),Zo=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,i=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||a;i();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function lo(){}lo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=ut(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Zo};Re(lo,{pluginName:"revertOnSpill"});function co(){}co.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Zo};Re(co,{pluginName:"removeOnSpill"});k.mount(new Wa);k.mount(co,lo);const zn="root";var Fe,X,vn,bn,Qo;const T=class T{static init(){if(T.noFolderView()||!ui.scenes)return;T.preloadTemplates(),game.user.getFlag(U,"activeSceneFolders")||game.user.setFlag(U,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(z.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;j(a=T,bn,Qo).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){const o=v(),a=t.querySelector("#scene-navigation-active"),s=a.querySelector("li.scene:first-of-type"),i=document.createElement("div"),l=document.createElement("div");i.id="crlngn-scene-lookup",i.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,l.dataset.tooltip=F.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",l.id="crlngn-folder-toggle",l.innerHTML="<i class='fa-solid icon'></i>",F.navShowRootFolders?a.classList.add("with-folders"):a.classList.remove("with-folders"),i.querySelector(".folder-expand").addEventListener("click",T.toggleFolderLookup),l.addEventListener("click",()=>{F.setNavPosition(0),N.set(o.navShowRootFolders.tag,!F.navShowRootFolders),F.placeNavButtons()}),a.insertBefore(i,s),a.append(l),T.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),A(T,Fe,game.scenes.sortingMode),f.log("buildFolderData A",[e.name,e]),e.id===zn?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=T.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},f.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),m(T,Fe)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Fe=new WeakMap,X=new WeakMap,vn=new WeakMap,bn=new WeakSet,Qo=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){A(T,Fe,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}A(T,Fe,"a"),f.log("updateSortMode fallback",[m(T,Fe)])},L(T,bn),b(T,"selectedFolder",zn),L(T,Fe,"a"),L(T,X,[]),b(T,"searchValue",""),b(T,"renderFolderList",async e=>{A(T,X,game.user.getFlag(U,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:zn},a=T.buildTemplateData(o),s=await renderTemplate(`modules/${U}/templates/scene-nav-folders.hbs`,a);f.log("renderFolderList",[o,m(T,X),s]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const i=t.querySelectorAll("li.folder");T.addFolderListeners(i),F.placeNavButtons()}),b(T,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${U}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",T.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),b(T,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",m(T,vn));const o=n.dataset.folderId,a=t.get(o),s=m(T,X).includes(o);f.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),T.injectSubfolders(a,n))})}),L(T,vn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await T.injectSubfolders(a,t.parentNode),F.addSceneListeners(t.parentNode),f.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?T.updateActiveFolders(n,!0):T.updateActiveFolders(n,!1)}),b(T,"injectSubfolders",async(e,t)=>{const n=T.buildTemplateData(e),o=await renderTemplate(`modules/${U}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");T.addFolderListeners(s),F.addSceneListeners(t.querySelector(".contents"))}),b(T,"updateActiveFolders",async(e,t=!1)=>{const o=document.querySelector("#scene-navigation-inactive").querySelector(`li.folder[data-folder-id=${e}]`),a=m(T,X).indexOf(e);f.log("updateActiveFolders A",[a,e,game.user.getFlag(U,"activeSceneFolders"),m(T,X)]),t?(A(T,X,m(T,X).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):m(T,X).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(i=>{i!==o&&(A(T,X,m(T,X).filter(l=>l!==i.dataset.folderId)),i.classList.remove("crlngn-folder-active"))}),m(T,X).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(U,"activeSceneFolders",m(T,X)),f.log("updateActiveFolders B",[t,e,game.user.getFlag(U,"activeSceneFolders"),m(T,X)])}),b(T,"selectFolder",e=>T.getFolderById(e)||null),b(T,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!F.navFoldersForPlayers||!F.navFoldersEnabled||!F.sceneNavEnabled}),b(T,"preloadTemplates",async()=>{const e=[`modules/${U}/templates/scene-nav-folders.hbs`,`modules/${U}/templates/scene-nav-subfolders.hbs`,`modules/${U}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),b(T,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;T.searchValue=n,T.updateSearchResults(n)}),b(T,"updateSearchResults",e=>{var a,s;if(T.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())&&i.permission>=2))||[];n.sort((i,l)=>i.name.toLowerCase().localeCompare(l.name.toLowerCase()));const o=((s=game.scenes)==null?void 0:s.folders.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((i,l)=>i.name.toLowerCase().localeCompare(l.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(i=>{const l=document.createElement("li");l.className="search-folder",l.dataset.folderId=i.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${i.name}</a>`,l.addEventListener("click",T.onSelectSearchedFolder),t.appendChild(l)}),n.forEach(i=>{const l=document.createElement("li");l.className="search-scene",l.dataset.sceneId=i.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${i.name}</a>`,l.querySelector(".scene-name").addEventListener("dblclick",F.onActivateScene),l.querySelector(".scene-name").addEventListener("click",F.onSelectScene),t.appendChild(l)}),o.length===0&&n.length===0){const i=document.createElement("li");i.className="no-results",i.textContent="No matching results found",t.appendChild(i)}}),b(T,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(F.navShowRootFolders||o.click(),!n)return;const i=[...ui.scenes.collection.folders.get(n).ancestors];A(T,X,[]);for(const l of i)m(T,X).push(l.id);m(T,X).push(n),await game.user.setFlag(U,"activeSceneFolders",m(T,X)),setTimeout(async()=>{ui.nav.render()},200)});let at=T;var lt;const S=class S{static registerSettings(){const e=v();f.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{const c=l[1];f.log("Registering... ",[l],!0);const u={name:c.label,hint:c.hint,default:c.default,type:c.propType,scope:c.scope,config:c.config,requiresReload:c.requiresReload||!1,onChange:p=>S.apply(c.tag,p)};(c.choices||c.options)&&(u.choices=c.choices||c.options),await game.settings.register(U,c.tag,u),S.get(c.tag)===void 0&&(f.log("resetting...",[c.tag]),S.set(c.tag,c.default))}),game.keybindings.register(U,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{S.hideInterface()},restricted:!1}),S.applyThemeSettings(),S.applyCustomCSS(),S.applyModuleAdjustments(),Object.entries(Sa()).forEach(async l=>{const c=l[1],u={name:c.tag,label:c.label,hint:c.hint,icon:c.icon,type:c.propType,restricted:c.restricted};await game.settings.registerMenu(U,c.tag,u)}),Hooks.on(z.RENDER_SCENE_CONTROLS,S.applyLeftControlsSettings),Hooks.on(z.RENDER_PLAYERS_LIST,Te.applyPlayersListSettings),Hooks.on(z.RENDER_HOTBAR,()=>{S.firstLoad&&(S.firstLoad=!1,S.applyHotBarCollapse()),S.applyHotBarSettings()}),S.applyDebugSettings(),S.applyChatStyles(),S.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{S.apply(e[l].tag)}),e.cameraDockMenu.fields.forEach(l=>{S.apply(e[l].tag)}),e.customFontsMenu.fields.forEach(l=>{S.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{S.applyLeftControlsSettings(e[l].tag)}),f.log("game settings",[game.settings])}static get(e,t=U){if(!e)return null;let n=!1;if(t===U)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,f.log("GET Setting",[a,n])}return n}static set(e,t,n=U){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),f.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s,i,l,c,u,p,h;const n=v();switch(t===void 0&&(t=S.get(e)),f.log("SettingsUtil.apply",[e,t,S.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:S.applyHotBarSettings();break;case n.collapseMacroBar.tag:S.applyHotBarCollapse();break;case n.playerListAvatars.tag:Te.applyAvatars();break;case n.autoHidePlayerList.tag:Te.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:S.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:S.applyLeftControlsSettings(e,t);break;case n.enableFloatingDock.tag:ee.currSettings.enableFloatingDock=t;break;case n.dockHeight.tag:ee.currSettings.dockHeight=t,S.applyCameraHeight(t);break;case n.dockWidth.tag:ee.currSettings.dockWidth=t,S.applyCameraWidth(t);break;case n.dockPosX.tag:ee.currSettings.dockPosX=t,S.applyCameraPosX(t);break;case n.dockPosY.tag:ee.currSettings.dockPosY=t,S.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:ee.currSettings.defaultVideoWidth=t,ee.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:ee.currSettings.dockResizeOnUserJoin=t,ee.applyDockResize(t);break;case n.chatBorderColor.tag:dt.chatBorderColor=S.get(n.chatBorderColor.tag),S.applyBorderColors();break;case n.enableChatStyles.tag:dt.enableChatStyles=S.get(n.enableChatStyles.tag),S.applyChatStyles();break;case n.enforceDarkMode.tag:S.resetFoundryThemeSettings();break;case n.debugMode.tag:S.applyDebugSettings();break;case n.sceneNavEnabled.tag:F.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:F.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:F.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:F.sceneClickToView=t,(a=ui.nav)==null||a.render(),(i=(s=game.scenes)==null?void 0:s.directory)==null||i.render();break;case n.useSceneIcons.tag:F.useSceneIcons=t,(l=ui.nav)==null||l.render(),(u=(c=game.scenes)==null?void 0:c.directory)==null||u.render();break;case n.useSceneBackButton.tag:F.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:F.useScenePreview=t,(h=ui.nav)==null||h.render();break;case n.navStartCollapsed.tag:F.navStartCollapsed=t;break;case n.showNavOnHover.tag:F.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:F.isCollapsed=S.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:S.applyThemeSettings();break;case n.customStyles.tag:S.applyCustomCSS();break;case n.adjustOtherModules.tag:S.applyModuleAdjustments();break;case n.otherModulesList.tag:S.applyOtherModulesList();break}}static applyBorderColors(){const e=v(),t=S.get(e.chatBorderColor.tag),n=document.querySelector("body");t===ct.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===ct.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=v(),t=S.get(e.enableChatStyles.tag),n=document.querySelector("body");f.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=v(),t=S.get(e.enableMacroLayout.tag);document.querySelector("body.crlngn-ui");const n=document.querySelector("#hotbar");n&&(t?n.classList.add("crlngn-macro"):n.classList.remove("crlngn-macro"))}static applyHotBarCollapse(){const e=v();S.get(e.collapseMacroBar.tag)}static applyLeftControlsSettings(e,t){const n=v();S.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),f.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:S.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=v(),t=S.get(e.controlsIconSize.tag);document.querySelector("body");const n=Et[t]?Et[t].size:Et.regular.size;function o(a){switch(a){case Et.large.name:return"var(--font-size-18);";case Et.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[n]),G.addCSSVars("--icon-font-size",o(t)),G.addCSSVars("--control-item-size",n),S.applyLeftControlsSettings()}static applySceneNavPos(e){const t=v();F.navPos=e||S.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=v(),n=S.get(t.dockPosX.tag),o=e||n;ee.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=v(),n=S.get(t.dockPosY.tag),o=e||n;ee.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=v(),n=S.get(t.dockWidth.tag),o=e||n;ee.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=v(),n=S.get(t.dockHeight.tag),o=e||n;ee.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=v(),o=n.customFontsMenu.fields,a={};switch(f.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=S.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:G.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:G.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:G.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:G.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var s,i;const e=v(),t=G.isModuleOn("monks-player-settings"),n=G.isModuleOn("force-client-settings"),o=S.get(e.enforceDarkMode.tag);if(o&&t){(s=game.user)!=null&&s.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),S.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),S.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","uiConfig")||null;if(f.log("resetFoundryThemeSettings",[a,game.settings]),o){const l={...a,colorScheme:{application:a.colorScheme.applications===""?"dark":a.colorScheme.applications,interface:a.colorScheme.interface===""?"dark":a.colorScheme.interface}};game.settings.set("core","uiConfig",l)}}static applyDebugSettings(e){const t=v();f.debugOn=e||S.get(t.debugMode.tag)}};lt=new WeakMap,L(S,lt,!1),b(S,"firstLoad",!0),b(S,"applyThemeSettings",e=>{const t=v(),n=e||S.get(t.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,n,S.get(t.colorTheme.tag)]),Pe.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),b(S,"applyCustomCSS",e=>{const t=v(),n=e||S.get(t.customStyles.tag)||"";G.addCustomCSS(n)}),b(S,"applyModuleAdjustments",e=>{const t=v();(e||S.get(t.adjustOtherModules.tag)||!1)&&_e.addModuleClasses()}),b(S,"applyOtherModulesList",e=>{const t=v(),n=e||S.get(t.otherModulesList.tag);f.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?S.set(t.adjustOtherModules.tag,!1):S.set(t.adjustOtherModules.tag,!0),_e.addModuleClasses()}),b(S,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");m(S,lt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),A(S,lt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),A(S,lt,!0))});let N=S;var Ue,Xt,Jt;const W=class W{static init(){f.log("LeftControls - init",[]),Hooks.on(z.RENDER_SCENE_CONTROLS,W.initSceneControls),Hooks.on(z.ACTIVATE_SCENE_CONTROLS,W.onActivateSceneControls),window.addEventListener("resize",W.onActivateSceneControls),W.initSceneControls()}static resetLocalVars(){A(W,Ue,document.querySelector("#ui-left #controls")),A(W,Xt,document.querySelector("#ui-left"))}static initSceneControls(){f.log("initSceneControls",[]),W.resetLocalVars(),W.observeControlsWidth()}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!m(W,Ue))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};A(W,Jt,new ResizeObserver(n=>{t(()=>W.updateCSSVars(),250)})),m(W,Jt).observe(m(W,Ue),{box:"border-box"}),W.updateCSSVars()}static updateCSSVars(){if(!m(W,Ue))return;let e=parseInt(m(W,Xt).offsetWidth),t=parseInt(m(W,Ue).offsetWidth),n=-e+t;f.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&G.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),f.log("onActivateSceneControls",[a,o.length,n.length])}};Ue=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,L(W,Ue),L(W,Xt),L(W,Jt),b(W,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return f.log("Error loading navigation button templates:",[e]),!1}});let Xn=W;class _o{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=v();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){f.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=N.get(e.lastUpdateId.tag);if(f.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),N.set(e.lastUpdateId.tag,n.id),f.log("checkForUpdates SUCCESS",[n.id])}catch(t){f.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}b(_o,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());class Va{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return f.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Cn;const At=class At{static init(){Hooks.once(z.INIT,()=>{var n,o;document.querySelector("body").classList.add(U),(n=document.querySelector("#ui-middle"))==null||n.classList.add(U),f.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},N.registerSettings();const e=v(),t=N.get(e.disableUI.tag);if(f.log(z.INIT,[t]),t){document.querySelector("body").classList.remove(U),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(U);return}F.init(),ee.init(),Xn.init(),dt.init(),Te.init(),Hooks.on(z.RENDER_CHAT_MESSAGE,m(At,Cn))}),Hooks.once(z.READY,()=>{f.log("Core Ready",[]);const e=v();var t=N.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Va.init(),Te.applyPlayersListSettings(),_e.init(),_o.init(),N.get(e.enableChatStyles.tag)&&At.addCSSLocalization(),N.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";G.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),G.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),G.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),G.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),G.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),G.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),G.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),G.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),G.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),G.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Cn=new WeakMap,L(At,Cn,(e,t)=>{f.log(z.RENDER_CHAT_MESSAGE,[e,t]),dt.enrichCard(e,t)});let Jn=At;Jn.init();
//# sourceMappingURL=crlngn-ui.js.map
