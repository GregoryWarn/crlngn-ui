var pa=Object.defineProperty;var Eo=r=>{throw TypeError(r)};var ha=(r,e,t)=>e in r?pa(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var m=(r,e,t)=>ha(r,typeof e!="symbol"?e+"":e,t),Dn=(r,e,t)=>e.has(r)||Eo("Cannot "+t);var h=(r,e,t)=>(Dn(r,e,"read from private field"),t?t.call(r):e.get(r)),I=(r,e,t)=>e.has(r)?Eo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),O=(r,e,t,n)=>(Dn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),q=(r,e,t)=>(Dn(r,e,"access private method"),t);const D={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged"},U="crlngn-ui",cn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Ln=class Ln{static log(e="",t=[],n=!1){try{const o=Ln.debugOn;if(!(n||o))return;console.log(...cn,e,...t)}catch{console.log(...cn,e,...t)}}static warn(e="",t=[]){console.warn(...cn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...cn,e)}};m(Ln,"debugOn",!1);let f=Ln;const N={client:"client",world:"world"},Rt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},pt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Me={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},An=140,ze=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function b(){return{interfaceOptionsMenu:{tag:"interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList"],default:{sceneControlsFadeOut:!0,sidebarTabsFadeOut:!0,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!0,macroHotbarFadeOut:!0,sceneNavFadeOut:!0,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0},scope:N.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:N.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:N.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:pt.playerColor.name},scope:N.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:N.client,config:!1,requiresReload:!1},playersListMenu:{tag:"players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:N.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:Me.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:N.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["sceneNavEnabled","navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:N.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:N.client,config:!0,default:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavItemWidth:{tag:"scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,default:"",scope:N.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},useSceneBackButton:{tag:"use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:String,default:!0,scope:N.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:N.client,config:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:N.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,default:!0,scope:N.world,config:!0},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:N.client,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},playerListAvatars:{tag:"player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"",scope:N.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!1,scope:N.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:N.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:N.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:pt.playerColor.name,scope:N.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:N.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:N.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:N.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:N.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:Me.horizontal.name,scope:N.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:N.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:N.world,config:!1,default:""},sceneControlsFadeOut:{tag:"scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:N.client,config:!1},sidebarTabsFadeOut:{tag:"sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:N.client,config:!1},chatLogControlsFadeOut:{tag:"chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:N.client,config:!1},playerListFadeOut:{tag:"player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:N.client,config:!1},cameraDockFadeOut:{tag:"camera-dock-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!0,scope:N.client,config:!1},macroHotbarFadeOut:{tag:"macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneNavFadeOut:{tag:"scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneControlsHide:{tag:"scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:N.client,config:!1},sidebarTabsHide:{tag:"sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:N.client,config:!1},chatLogControlsHide:{tag:"chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:N.client,config:!1},playerListHide:{tag:"player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:N.client,config:!1},cameraDockHide:{tag:"camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:N.client,config:!1},macroHotbarHide:{tag:"macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavHide:{tag:"scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},enableSceneControls:{tag:"enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:N.client,config:!1},enableSidebarTabs:{tag:"enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:N.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:N.client,config:!1}}}const{ApplicationV2:ma,HandlebarsApplicationMixin:ya}=foundry.applications.api;var so,yt,Do,Ao;const ve=class ve extends ya(ma){static get DEFAULT_OPTIONS(){return{id:b().playersListMenu.tag,actions:{redefine:q(ve,yt,Ao)},form:{handler:q(ve,yt,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=b(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=E.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}}),f.log("_prepareContext A",[o,n,a,s]);const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.playersListMenu.tag);f.log("_onRender",[e,t,a])}};so=new WeakMap,yt=new WeakSet,Do=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ao=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.playersListMenu.default])},I(ve,yt),I(ve,so),m(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Wn=ve;const{ApplicationV2:Sa,HandlebarsApplicationMixin:ba}=foundry.applications.api;var St,Po,Fo,Vt,$n;const Ce=class Ce extends ba(Sa){constructor(){super(...arguments);I(this,Vt)}static get DEFAULT_OPTIONS(){return{id:b().cameraDockMenu.tag,actions:{redefine:q(Ce,St,Fo)},form:{handler:q(Ce,St,Po),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=b(),o=n.cameraDockMenu.fields,a={},s={},i={};o.forEach(d=>{if(f.log("_prepareContext",[n[d].oldName]),n[d]){const p=E.get(n[d].tag);a[d]=n[d],s[d]=p!==void 0?p:n[d].default,i[d]=n[d].default}});const l={...s,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),Ce.element=this.element,Ce.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ce.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",q(this,Vt,$n).bind(this)),q(this,Vt,$n).call(this,{target:a}))}};St=new WeakSet,Po=async function(t,n,o){const a=b();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,i=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!i.hasOwnProperty(p)&&(i[p]=!1)});const l=foundry.utils.expandObject(i),c=E.get(a.enableFloatingDock.tag);f.log("Compared settings:",[l.enableFloatingDock,c]),s.forEach(p=>{f.log("Saving setting >>",[a[p].tag,l[p]]),l[p]!==void 0&&E.set(a[p].tag,l[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==c&&location.reload()},Fo=async function(t,n){const o=b(),s=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.fields,l={};i.forEach(c=>{o[c]&&(o[c],l[c]=o[c].default)}),s.forEach(c=>{c.value=l[c.name]}),f.log("#onReset",[t,n,o.cameraDockMenu.default])},Vt=new WeakSet,$n=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(i=>i.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(i=>i.disabled=!t.target.checked),f.log("onDockEnabledChange",[this.element,n,o])},I(Ce,St),m(Ce,"element"),m(Ce,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let jn=Ce;const{ApplicationV2:va,HandlebarsApplicationMixin:Ca}=foundry.applications.api;var io,bt,Go,zo;const Ee=class Ee extends Ca(va){static get DEFAULT_OPTIONS(){return{id:b().chatMessagesMenu.tag,actions:{redefine:q(Ee,bt,zo)},form:{handler:q(Ee,bt,Go),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=b(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(f.log("_prepareContext",[t[c].oldName]),t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),f.log("_prepareContext",[a,s]);const i={...a,default:{...s},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();Ee.element=this.element,Ee.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ee.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.chatMessagesMenu.tag);f.log("_onRender",[e,t,a])}};io=new WeakMap,bt=new WeakSet,Go=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(d=>{o[d].inputType==="checkbox"&&!s.hasOwnProperty(d)&&(s[d]=!1)});const i=foundry.utils.expandObject(s),l=E.get(o.chatBorderColor.tag);f.log("Compared settings:",[i.chatBorderColor,l]),a.forEach(d=>{f.log("Saving setting >>",[o[d].tag,i[d]]),i[d]!==void 0&&E.set(o[d].tag,i[d])}),i.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},zo=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(l=>{n[l]&&(n[l],i[l]=n[l].default)}),a.forEach(l=>{l.value=i[l.name]})},I(Ee,bt),I(Ee,io),m(Ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Yn=Ee;const zt=class zt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family");i&&(t.add(i),f.log("Found font-face rule:",[i]))}else if(s instanceof CSSImportRule){if(f.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const l=await(await fetch(s.href)).text();this.extractFontsFromCSSText(l,t)}catch(i){f.warn("Error fetching imported CSS:",[i])}}}}catch(o){if(o.name==="SecurityError"&&e.href){f.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){f.warn("Error fetching cross-origin stylesheet:",[a])}}else f.warn("Error accessing CSS rules:",[o])}}catch(o){f.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];f.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,i=a.match(s);if(i&&i[2]){const l=i[2].trim();t.add(l),f.log("Found font-face in CSS text:",[l])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return f.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const y=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,y.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const l=o.substring(a+16,s).split(";").map(y=>y.trim()).filter(y=>y!==""),c={};l.forEach(y=>{const L=y.split(":");if(L.length>=2){const C=L[0].trim(),w=L.slice(1).join(":").trim();C&&(c[C]=w)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const d=Object.entries(c).map(([y,L])=>`  ${y}: ${L};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+d+`
}`+o.substring(s+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const i=n==="horizontal",l=i?e.scrollLeft:e.scrollTop,c=t-l;if(c===0)return a&&a(),null;const d=performance.now(),p=L=>{const C=L-d;if(C>=o){i?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const w=C/o,z=w<.5?2*w*w:1-Math.pow(-2*w+2,2)/2;i?e.scrollLeft=l+c*z:e.scrollTop=l+c*z;const H=requestAnimationFrame(p);return e.dataset.scrollAnimationId=H,H},y=requestAnimationFrame(p);return e.dataset.scrollAnimationId=y,y}};m(zt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));f.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);f.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const i=s.href||"",l=i.includes("css/")||i.includes("styles/"),c=i.includes("modules/crlngn-ui/"),d=i.includes("systems/");if(i&&!l&&!c&&!d){f.log("Skipping stylesheet:",[i]);continue}f.log("Processing stylesheet:",[s,i]),await zt.processStyleSheetRules(s,o)}}catch(i){f.warn("Error processing stylesheet:",[i])}return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))}),m(zt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let P=zt;const{ApplicationV2:Ea,HandlebarsApplicationMixin:Na}=foundry.applications.api;var ro,je,xo,Uo,Ho;const ae=class ae extends Na(Ea){static get DEFAULT_OPTIONS(){return{id:b().customFontsMenu.tag,actions:{redefine:q(ae,je,Ho)},form:{handler:q(ae,je,xo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=b(),n=t.customFontsMenu.fields,o={},a={},s={},i=await P.getAllFonts();return n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:i,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){ae.element=this.element,ae.element.querySelector(".toggle-hint").addEventListener("click",()=>{ae.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),ae.element.querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),l=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!l)return;const c=()=>{var d;q(d=ae,je,Uo).call(d),l.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",d=>{const p=l.classList.contains("active"),y=Array.from(l.querySelectorAll(".dropdown-option"));let L=y.findIndex(C=>C.classList.contains("highlighted"));d.key==="ArrowDown"||d.key==="ArrowUp"?(d.preventDefault(),p||l.classList.add("active"),y.forEach(C=>C.classList.remove("highlighted")),L===-1?L=d.key==="ArrowDown"?0:y.length-1:L=d.key==="ArrowDown"?(L+1)%y.length:(L-1+y.length)%y.length,y[L]&&(y[L].classList.add("highlighted"),y[L].scrollIntoView({block:"nearest"}))):d.key==="Enter"?(d.preventDefault(),p&&L!==-1&&y[L]&&y[L].click()):d.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",d=>{i.contains(d.target)||l.classList.remove("active")})}),ae.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const l=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};ro=new WeakMap,je=new WeakSet,xo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Uo=function(){ae.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Ho=async function(e,t){const n=b(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(l=>{n[l]&&(n[l],i[l]=n[l].default)}),a.forEach(l=>{l.value=i[l.name]})},I(ae,je),I(ae,ro),m(ae,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Xn=ae;const{ApplicationV2:La,HandlebarsApplicationMixin:Ta}=foundry.applications.api;var lo,vt,qo,Bo;const Ne=class Ne extends Ta(La){static get DEFAULT_OPTIONS(){return{id:b().leftControlsMenu.tag,actions:{redefine:q(Ne,vt,Bo)},form:{handler:q(Ne,vt,qo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=b(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=E.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();Ne.element=this.element,Ne.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ne.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.leftControlsMenu.tag);f.log("_onRender",[e,t,a])}};lo=new WeakMap,vt=new WeakSet,qo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Bo=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.leftControlsMenu.default])},I(Ne,vt),I(Ne,lo),m(Ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Jn=Ne;const{ApplicationV2:Ia,HandlebarsApplicationMixin:wa}=foundry.applications.api;var co,Ct,Vo,Wo,Wt,Zn;const Le=class Le extends wa(Ia){constructor(){super(...arguments);I(this,Wt)}static get DEFAULT_OPTIONS(){return{id:b().sceneNavMenu.tag,actions:{redefine:q(Le,Ct,Wo)},form:{handler:q(Le,Ct,Vo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=b(),o=n.sceneNavMenu.fields,a={},s={},i={};o.forEach(c=>{if(n[c]){const d=E.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}});const l={...s,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),Le.element=this.element,Le.element.querySelector(".toggle-hint").addEventListener("click",()=>{Le.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",q(this,Wt,Zn).bind(this)),q(this,Wt,Zn).call(this,{target:a}))}};co=new WeakMap,Ct=new WeakSet,Vo=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=b(),s=a.sceneNavMenu.fields;let i=E.get(a.sceneNavEnabled.tag);const l=foundry.utils.expandObject(o.object);s.forEach(d=>{l[d]!==void 0&&(f.log("Saving setting:",[l[d]]),E.set(a[d].tag,l[d]))});let c=E.get(a.sceneNavEnabled.tag);f.log("Saving settings...",[i,c]),await E.set(a.sceneNavMenu.tag,l),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i!==c&&location.reload()},Wo=async function(t,n){const o=b(),s=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;s.forEach(l=>{l.value=i[l.name],l.type==="checkbox"&&(l.checked=i[l.name])}),f.log("#onReset",[t,n,o.sceneNavMenu.default])},Wt=new WeakSet,Zn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),f.log("onSceneNavEnabledChange",[this.element,n])},I(Le,Ct),I(Le,co),m(Le,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Kn=Le;const{ApplicationV2:Ra,HandlebarsApplicationMixin:ka}=foundry.applications.api;var uo,go,$e,jo,$o,Yo;const K=class K extends ka(Ra){static get DEFAULT_OPTIONS(){return{id:b().themeAndStylesMenu.tag,actions:{redefine:q(K,$e,Yo)},form:{handler:q(K,$e,jo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=b(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}});const i=ze.find(c=>c.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||ze[0].label;const l={...a,default:{...s},fields:{...o},selectedTheme:i,themes:ze,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){K.element=this.element,K.element.querySelector(".toggle-hint").addEventListener("click",()=>{K.element.querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))}),this._themes=ze,K.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(d=>{const p=d.closest(".dropdown-wrapper"),y=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!y)return;const L=()=>{var C;q(C=K,$e,$o).call(C),y.classList.add("active")};d.addEventListener("focus",L),d.addEventListener("click",L),d.addEventListener("keydown",C=>{const w=y.classList.contains("active"),z=Array.from(y.querySelectorAll(".dropdown-option"));let H=z.findIndex(J=>J.classList.contains("highlighted"));C.key==="ArrowDown"||C.key==="ArrowUp"?(C.preventDefault(),w||y.classList.add("active"),z.forEach(J=>J.classList.remove("highlighted")),H===-1?H=C.key==="ArrowDown"?0:z.length-1:H=C.key==="ArrowDown"?(H+1)%z.length:(H-1+z.length)%z.length,z[H]&&(z[H].classList.add("highlighted"),z[H].scrollIntoView({block:"nearest"}))):C.key==="Enter"?(C.preventDefault(),w&&H!==-1&&z[H]&&z[H].click()):C.key==="Escape"&&y.classList.remove("active")}),document.addEventListener("click",C=>{p.contains(C.target)||y.classList.remove("active")})});const a=K.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(d=>{d.addEventListener("mouseenter",()=>{d.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(y=>y.classList.remove("highlighted")),d.classList.add("highlighted")}),d.addEventListener("click",function(p){f.log("option",[d,d.querySelector(".theme-name")]);const y=d.closest(".dropdown-wrapper").querySelector("input");let L=d.querySelector(".theme-name").innerHTML.toString();if(y.value=L,y.name==="colorTheme"){const w=s._themes.find(z=>z.label===L);s._selectedTheme=w,s._updateThemePreview(w)}d.closest(".dropdown-options").classList.remove("active")})});const i=K.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=K.element.querySelector("input.otherModulesList");i.forEach(d=>{d.addEventListener("change",p=>{const y=p.currentTarget;let C=`${l.value}`.split(",")||[],w=C.indexOf(y.value);!p.currentTarget.checked&&w>-1?C.splice(w,1):p.currentTarget.checked&&w===-1&&C.push(y.value),l.value=C.join(","),f.log("checkbox changed",[C,l.value])})}),K.element.querySelector("input.adjustOtherModules").addEventListener("change",d=>{K.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(y=>{y.checked=d.currentTarget.checked;const L=new Event("change",{bubbles:!0});y.dispatchEvent(L)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};uo=new WeakMap,go=new WeakMap,$e=new WeakSet,jo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),i=ze.find(l=>l.label===s.colorTheme);s.colorTheme=i?i.className:"",a.forEach(l=>{s[l]!==void 0&&(f.log("Saving setting:",[s[l]]),E.set(o[l].tag,s[l]))}),E.set(o.themeAndStylesMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},$o=function(){K.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Yo=async function(e,t){const n=b(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)});const l=ze.find(c=>c.label===n.colorTheme.default);i.colorTheme=(l==null?void 0:l.label)||ze[0].label,a.forEach(c=>{c.value=i[c.name]})},I(K,$e),I(K,uo),I(K,go,!1),m(K,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Qn=K;const{ApplicationV2:Ma,HandlebarsApplicationMixin:Oa}=foundry.applications.api;var fo,Et,Xo,Jo;const Te=class Te extends Oa(Ma){static get DEFAULT_OPTIONS(){return{id:b().interfaceOptionsMenu.tag,actions:{redefine:q(Te,Et,Jo)},form:{handler:q(Te,Et,Xo),closeOnSubmit:!0},position:{width:540,height:"auto"},tag:"form",window:{icon:"fas fa-table",title:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title")}_prepareContext(e){const t=b(),n=t.interfaceOptionsMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=E.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();Te.element=this.element,Te.element.querySelector(".toggle-hint").addEventListener("click",()=>{Te.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.interfaceOptionsMenu.tag);f.log("_onRender",[e,t,a])}};fo=new WeakMap,Et=new WeakSet,Xo=async function(e,t,n){e.preventDefault(),e.stopPropagation();const o=b(),a=o.interfaceOptionsMenu.fields;let s=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag);const i=foundry.utils.expandObject(n.object);a.forEach(c=>{i[c]!==void 0&&(f.log("Saving setting:",[i[c]]),E.set(o[c].tag,i[c]))});let l=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag),f.log("Saving settings...",[s,l]),await E.set(o.sceneNavMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s!==l&&location.reload()},Jo=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),s=n.interfaceOptionsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.interfaceOptionsMenu.default])},I(Te,Et),I(Te,fo),m(Te,"PARTS",{content:{template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let _n=Te;function Da(){return{interfaceOptionsMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),icon:"fa-solid fa-table-layout",propType:_n,restricted:!1},customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Xn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Qn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Yn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:Jn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:Kn,restricted:!1},playersListMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-camera",propType:Wn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:jn,restricted:!1}}}var _e,He,jt,$t,Yt,Xt,Jt,Kt,Zt,Qt,et,_t,en;const g=class g{static applyFadeOut(e){g.useFadeOut=e}static applyCustomStyle(e){var t;g.enableFloatingDock=e,f.log("applyCustomStyle",[g.enableFloatingDock,ui,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=b();g.enableFloatingDock=E.get(e.enableFloatingDock.tag),g.currSettings={enableFloatingDock:g.enableFloatingDock,defaultVideoWidth:E.get(e.defaultVideoWidth.tag),dockHeight:E.get(e.dockHeight.tag),dockWidth:E.get(e.dockWidth.tag),dockPosX:E.get(e.dockPosX.tag),dockPosY:E.get(e.dockPosY.tag),dockResizeOnUserJoin:E.get(e.dockResizeOnUserJoin.tag)},g.enableFloatingDock?(g.positionIntervalId&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null),Hooks.on(D.RENDER_CAMERA_VIEWS,g.onRenderFloating),Hooks.on(D.RENDER_PLAYERS_LIST,g.onRenderPlayersList),Hooks.on(D.CLIENT_SETTING_CHANGED,t=>{f.log("Setting updated",[t]),t.includes("rtcClientSettings")&&g.checkMinimizedState()})):(Hooks.on(D.RENDER_CAMERA_VIEWS,g.onRenderPlain),g.onRenderPlain())}static onRenderPlain(e,t){var n;g.cameraContainer||(g.cameraContainer=document.querySelector("#av-holder")),(n=g.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){b();const o=g.currSettings,a=document.querySelector("#camera-views");if(g.cameraContainer=document.querySelector("#av-holder"),g.cameraContainer)g.cameraContainer.appendChild(a);else{const c=document.createElement("div");g.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}g.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const d=game.users.get(c.dataset.user),p=(d==null?void 0:d.color)||"";f.log("player color",[d,p]),c.style.setProperty("--player-color",p)}),f.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const l=game.settings.get("core","rtcClientSettings");(l==null?void 0:l.hideDock)!==!0?(g.checkMinimizedState(),g.applyDockResize(o.dockResizeOnUserJoin),g.makeDraggable(),g.makeResizeable(),g.applyVideoWidth(),g.resetPositionAndSize()):g.checkMinimizedState()}static onRenderPlayersList(){f.log("onRenderPlayersList")}static applyPositionWithDelay(){g.positionIntervalId&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null),g.resetPositionAndSize();let e=0;g.positionIntervalId=setInterval(()=>{g.resetPositionAndSize(),e++,e>=g.positionAttempts&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=b(),n=E.get(t.defaultVideoWidth.tag);let o=e||n;if(o<An)o=An,E.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){g.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",o+"px"),s.style.setProperty("--av-width",o+"px")),g.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){b();const a=g.currSettings;if(!g.enableFloatingDock||!g.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){g.checkMinimizedState();return}if(f.log("CameraDock",[a]),!e&&!t&&!n&&!o){const i=a.dockPosX||0,l=a.dockPosY||0;if(g.cameraContainer.style.left=`${i}px`,g.cameraContainer.style.bottom=`${l}px`,g.currSettings.dockResizeOnUserJoin===Me.off.name){const c=a.dockWidth||0,d=a.dockHeight||0;g.cameraContainer.style.width=`${c}px`,g.cameraContainer.style.height=`${d}px`}}else e!==null&&(g.cameraContainer.style.left=`${e}px`),t!==null&&(g.cameraContainer.style.bottom=`${t}px`),g.currSettings.dockResizeOnUserJoin===Me.horizontal.name?n!==null&&(g.cameraContainer.style.width=`${n}px`):g.currSettings.dockResizeOnUserJoin===Me.vertical.name&&o!==null&&(g.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=g.cameraContainer)==null||e.addEventListener("mousedown",n=>{var l,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(f.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(l=n.target.parentNode)!=null&&l.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",h(g,Kt)),a==null||a.addEventListener("mouseup",h(g,Zt)),o))return;const s=P.getOffsetBottom(g.cameraContainer);let i=((c=g.cameraContainer)==null?void 0:c.offsetLeft)||0;g.isDragging=!0,O(g,_e,n.clientX-i),O(g,He,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=g.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,d;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",h(g,Qt)),a.addEventListener("touchend",h(g,et)),a.addEventListener("touchcancel",h(g,et)),o))return;const s=n.touches[0],i=P.getOffsetBottom(g.cameraContainer);let l=((d=g.cameraContainer)==null?void 0:d.offsetLeft)||0;g.isDragging=!0,O(g,_e,s.clientX-l),O(g,He,window.innerHeight-s.clientY-i),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var l,c;if(!g.cameraContainer)return;const e=b(),t=g.currSettings.dockResizeOnUserJoin,n=g.currSettings.defaultVideoWidth||An,a=(((c=(l=game.webrtc)==null?void 0:l.users)==null?void 0:c.filter(d=>d.active&&d.canBroadcastVideo))||[]).length;if(a===0)return;if(t===Me.horizontal.name){const d=n*a+16;g.cameraContainer.style.width=`${d}px`}else if(t===Me.vertical.name){const d=n*a+16;g.cameraContainer.style.height=`${d}px`}const s=parseInt(g.cameraContainer.style.width||0),i=parseInt(g.cameraContainer.style.height||0);s>0&&E.set(e.dockWidth.tag,s),i>0&&E.set(e.dockHeight.tag,i)}static applyDockResize(e=null){if(!g.cameraContainer)return;e?g.currSettings.dockResizeOnUserJoin=e:e=g.currSettings.dockResizeOnUserJoin,g.cameraContainer.classList.remove("horizontal"),g.cameraContainer.classList.remove("vertical");const t=g.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===Me.horizontal.name?g.cameraContainer.classList.add("horizontal"):e===Me.vertical.name&&g.cameraContainer.classList.add("vertical"),g.updateDockSize()}static makeResizeable(){if(g.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=g.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),g.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),g.isResizing=!0,O(g,jt,o.clientX),O(g,$t,o.clientY),O(g,Jt,parseInt(getComputedStyle(g.cameraContainer).bottom)||0),O(g,Yt,g.cameraContainer.offsetWidth),O(g,Xt,g.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",h(g,_t)),e==null||e.addEventListener("mouseup",h(g,en))})}}static checkMinimizedState(){if(!g.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),f.log("Checking minimized state",[e,t]),g.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=g.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!g.cameraContainer)return;if(f.log("handleMinimizedState",[e]),e)g.cameraContainer.parentNode!==t&&(g.originalParent=g.cameraContainer.parentNode,t.prepend(g.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!g.originalParent)return;g.originalParent.prepend(g.cameraContainer),g.makeDraggable(),g.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),f.log("Restored camera position from settings",[g.currSettings])}const o=(a=g.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};_e=new WeakMap,He=new WeakMap,jt=new WeakMap,$t=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,et=new WeakMap,_t=new WeakMap,en=new WeakMap,I(g,_e,0),I(g,He,0),m(g,"isDragging",!1),m(g,"cameraContainer"),m(g,"isResizing",!1),I(g,jt,0),I(g,$t,0),I(g,Yt,0),I(g,Xt,0),I(g,Jt,0),m(g,"currSettings",{}),m(g,"positionIntervalId",null),m(g,"positionAttempts",5),m(g,"useFadeOut",!0),m(g,"enableFloatingDock",!0),I(g,Kt,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!g.isDragging||t)){if(f.log("mousemove",[window.innerHeight,e.clientY,h(g,He)]),g.cameraContainer){let n=e.clientX-h(g,_e),o=window.innerHeight-e.clientY-h(g,He);n+g.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-g.cameraContainer.offsetWidth),n<0&&(n=0),g.cameraContainer.style.left=`${n}px`,o+g.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-g.cameraContainer.offsetHeight),g.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),I(g,Zt,e=>{var a,s;const t=b(),n={...g.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(g.isDragging&&!o){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=g.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=g.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",h(g,Kt)),i==null||i.removeEventListener("mouseup",h(g,Zt)),g.isDragging=!1,e.stopPropagation()}}),I(g,Qt,e=>{if(!(!g.isDragging||!e.touches[0])){if(g.cameraContainer){const t=e.touches[0];let n=t.clientX-h(g,_e),o=window.innerHeight-t.clientY-h(g,He);n+g.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-g.cameraContainer.offsetWidth),n<0&&(n=0),g.cameraContainer.style.left=`${n}px`,o+g.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-g.cameraContainer.offsetHeight),g.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),I(g,et,e=>{var o,a;const t=b(),n={...g.currSettings};if(g.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=g.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=g.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",h(g,Qt)),s==null||s.removeEventListener("touchend",h(g,et)),s==null||s.removeEventListener("touchcancel",h(g,et)),g.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),I(g,_t,e=>{if(!g.isResizing)return;const t=h(g,Yt)+(e.clientX-h(g,jt)),n=e.clientY-h(g,$t),o=h(g,Xt)+n,a=h(g,Jt)-n;g.cameraContainer.style.width=`${t}px`,g.cameraContainer.style.height=`${o}px`,g.cameraContainer.style.bottom=`${a}px`}),I(g,en,()=>{var o,a,s,i,l,c,d;const e=b(),t={...g.currSettings},n=document.querySelector("body.crlngn-ui");g.isResizing=!1,n==null||n.removeEventListener("mousemove",h(g,_t)),n==null||n.removeEventListener("mouseup",h(g,en)),f.log("onStopResize",[(o=g.cameraContainer)==null?void 0:o.style.width,(a=g.cameraContainer)==null?void 0:a.style.height,(s=g.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((i=g.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((l=g.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=g.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((d=g.cameraContainer)==null?void 0:d.style.left)||0),E.set(e.dockWidth.tag,t.dockWidth),E.set(e.dockHeight.tag,t.dockHeight),E.set(e.dockPosY.tag,t.dockPosY),E.set(e.dockPosX.tag,t.dockPosX)});let _=g;const Z=class Z{static init(){Hooks.on(D.RENDER_SIDE_BAR,Z.onRender),Hooks.on(D.COLLAPSE_SIDE_BAR,Z.onRender),Hooks.on(D.READY,Z.onRender)}static applyFadeOut(e){Z.useFadeOut=e,Z.handleFadeOut()}static applyCustomStyle(e){var t;Z.customStylesEnabled=e,f.log("applyCustomStyle",[Z.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||Z.addChatToggle(o),Z.handleFadeOut(e,o,n)}static handleFadeOut(e,t,n){f.log("handle FadeOut, ChatLogControls",[Z.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");t?t.querySelector("#roll-privacy"):document.querySelector("#ui-right #roll-privacy"),Z.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}};m(Z,"useFadeOut",!0),m(Z,"customStylesEnabled",!0),m(Z,"addChatToggle",async e=>{const t=await renderTemplate(`modules/${U}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t),n.querySelector("button[data-action=toggleChat]").addEventListener("click",Z.onToggleChatBox)}),m(Z,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),P.addCSSVars("--chat-input-height","0px")):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),P.addCSSVars("--chat-input-height","100px"))});let Ut=Z;const Ie=class Ie{static init(){const e=b();Ie.enableChatStyles=E.get(e.enableChatStyles.tag),Ie.chatBorderColor=E.get(e.chatBorderColor.tag)}};m(Ie,"chatBorderColor"),m(Ie,"enableChatStyles"),m(Ie,"enrichCard",async(e,t)=>{var s,i,l,c,d,p,y,L;f.log("renderChatMessage",[Ie.chatBorderColor,Ie.enableChatStyles,pt.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(l=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((y=(p=(d=e.flags)==null?void 0:d.dnd5e)==null?void 0:p.roll)==null?void 0:y.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(C=>{const w=C.querySelector(".visible-dc"),z=C.querySelector(".hidden-dc");f.log("enrichCard",[w,z]),w.setAttribute("data-ability",C.getAttribute("data-ability")||""),w.setAttribute("data-dc",C.getAttribute("data-dc")||""),z.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),Ie.chatBorderColor===pt.playerColor.name&&((L=e.author)!=null&&L.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let ht=Ie;var qe,tt,tn;const F=class F{static init(){f.log("LeftControls - init",[]),Hooks.on(D.RENDER_SCENE_CONTROLS,F.initSceneControls),Hooks.on(D.ACTIVATE_SCENE_CONTROLS,F.onActivateSceneControls),window.addEventListener("resize",F.onActivateSceneControls),F.initSceneControls()}static applyFadeOut(e){F.useFadeOut=e,f.log("applyFadeOut",[e]),F.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls");F.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("handle FadeOut",[F.customStylesEnabled,F.useFadeOut])}static applyCustomStyle(e){var t;F.customStylesEnabled=e,f.log("applyCustomStyle",[F.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){O(F,qe,document.querySelector("#ui-left #controls")),O(F,tt,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){f.log("initSceneControls",[]),F.resetLocalVars(),F.customStylesEnabled?h(F,tt).classList.add("crlngn-controls"):h(F,tt).classList.remove("crlngn-controls"),F.handleFadeOut(e,t,n)}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!h(F,qe))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};O(F,tn,new ResizeObserver(n=>{t(()=>F.updateCSSVars(),250)})),h(F,tn).observe(h(F,qe),{box:"border-box"}),F.updateCSSVars()}static updateCSSVars(){if(!h(F,qe))return;let e=parseInt(h(F,tt).offsetWidth),t=parseInt(h(F,qe).offsetWidth),n=-e+t;f.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&P.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),f.log("onActivateSceneControls",[a,o.length,n.length])}};qe=new WeakMap,tt=new WeakMap,tn=new WeakMap,I(F,qe),I(F,tt),I(F,tn),m(F,"useFadeOut",!0),m(F,"customStylesEnabled",!0),m(F,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return f.log("Error loading navigation button templates:",[e]),!1}});let Ht=F;const he=class he{static init(){Hooks.on(D.RENDER_HOTBAR,he.handleFadeOut)}static applyFadeOut(e){he.useFadeOut=e,he.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");he.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("MacroHotbat handle fade out",[he.useFadeOut])}static applyCustomStyle(e){he.customStylesEnabled=e,f.log("applyCustomStyle",[he.customStylesEnabled])}};m(he,"useFadeOut",!0),m(he,"customStylesEnabled",!0);let qt=he;var po;const ue=class ue{static init(){Hooks.on(D.RENDER_PLAYERS_LIST,ue.checkPlayersList),Hooks.on(D.RENDER_HOTBAR,ue.checkPlayersList),P.isModuleOn("foundry-taskbar")&&Hooks.on(D.UPDATE_USER,ue.checkTaskbarLock),ue.checkTaskbarLock(),ue.addModuleClasses(),P.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})}};po=new WeakMap,I(ue,po),m(ue,"addModuleClasses",()=>{const e=b(),t=E.get(e.otherModulesList.tag)||"",n=t.split(",");f.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),m(ue,"checkTaskbarLock",()=>{var a,s,i;const e=P.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(f.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(s=t.taskbarSettings)!=null&&s.locked?P.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):P.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?P.addCSSVars("--crlngn-taskbar-height","50px"):P.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),ue.checkPlayersList()}),m(ue,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=P.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,n,a,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.minimized")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let st=ue;const te=class te{static init(){Hooks.on(D.RENDER_PLAYERS_LIST,te.onRender),te.applyPlayersListSettings(),te.handleFadeOut(),f.log("PlayersList init")}static applyFadeOut(e){te.useFadeOut=e,te.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");te.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("PlayersList handle fade out",[te.useFadeOut])}static applyCustomStyle(e){te.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){if(b(),te.customStylesEnabled)t.classList.add("crlngn-ui");else{t.classList.remove("crlngn-ui");return}te.applyPlayersListSettings(),te.applyAvatars(),te.handleFadeOut(e,t,n)}static applyPlayersListSettings(){var t,n;const e=b();f.log("applyPlayersListSettings",[E.get(e.autoHidePlayerList.tag)]),E.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized"),st.checkPlayersList()}static applyAvatars(){const e=b();f.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];E.get(e.playerListAvatars.tag)?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const i=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),l=game.users.get(s.id),c=((p=l.character)==null?void 0:p.img)||"";f.log("player",[l]);const d=document.createElement("img");d.src=c||l.avatar||"",d.alt="*",d.classList.add("avatar"),i&&i.prepend(d)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(i=>{const l=i.querySelector("img.avatar");l==null||l.remove()}),t==null||t.classList.remove("crlngn-avatars")),st.checkPlayersList()}};m(te,"useFadeOut",!0),m(te,"customStylesEnabled",!0);let Oe=te;var W,nn,nt,ho,gt,ot,at,on,mo,an,me,Be,ye,Tn,In,wn;const u=class u{static applyFadeOut(e){u.useFadeOut=e,f.log("applyFadeOut",[e]),u.handleSceneFadeOut()}static applyCustomStyle(e){u.sceneNavEnabled=e,f.log("applyCustomStyle - TopNavigation",[u.sceneNavEnabled,ui.nav])}static resetLocalVars(){O(u,W,document.querySelector("#scene-navigation")),O(u,gt,document.querySelector("#scene-navigation-expand")),O(u,ot,document.querySelector("#ui-left")),O(u,nn,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;f.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),u.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),u.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):u.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleBackButton(e,t,n){if(b(),f.log("handleBackButton",[e,t,n]),!u.useSceneBackButton)return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",h(u,Tn)),o.prepend(a)}static handleFolderList(e,t,n){b(),u.navFoldersEnabled&&dt.addFolderButtons(e,t,n)}static handleNavState(){b(),h(u,an)&&(O(u,an,!1),u.toggleNav(u.navStartCollapsed))}static toggleNav(e){clearTimeout(h(u,on)),O(u,on,setTimeout(()=>{u.resetLocalVars(),e===!0?(ui.nav.collapse(),u.isCollapsed=!0,f.log("toggleNav collapse",[e,u.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove())):e===!1&&(u.isCollapsed=!1,ui.nav.expand(),f.log("toggleNav expand",[e,u.navStartCollapsed]))},300))}static checkSceneNavCompat(){b(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=h(u,W))==null||e.addEventListener("mouseenter",n=>{if(f.log("TopNavigation mouseenter",[u.isCollapsed,u.showNavOnHover]),!u.isCollapsed||!u.showNavOnHover)return;n.stopPropagation(),clearTimeout(h(u,nt)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=h(u,W))==null||t.addEventListener("mouseleave",n=>{f.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!u.showNavOnHover)&&(n.stopPropagation(),O(u,nt,setTimeout(()=>{clearTimeout(h(u,nt)),O(u,nt,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=b();if(!h(u,W))return;const i=((o=h(u,W))==null?void 0:o.querySelectorAll("li.nav-item"))||[],l=0,c=e!==null?e:u.navPos||0,d=(a=h(u,W))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!d)return;const p=i[c],y=d.offsetWidth||0,L=parseInt(y)*c;f.log("setNavPosition",["position",c,L,h(u,W).scrollWidth]);const C=L-l;if(C>h(u,W).scrollWidth)return;u.navPos=c,E.set(s.sceneNavPos.tag,c),t?P.smoothScrollTo(h(u,W),C,"horizontal",n):h(u,W).scrollTo({left:C,behavior:"instant"})}catch(s){f.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}};W=new WeakMap,nn=new WeakMap,nt=new WeakMap,ho=new WeakMap,gt=new WeakMap,ot=new WeakMap,at=new WeakMap,on=new WeakMap,mo=new WeakMap,an=new WeakMap,me=new WeakMap,Be=new WeakMap,ye=new WeakMap,Tn=new WeakMap,In=new WeakMap,wn=new WeakMap,I(u,W),I(u,nn),I(u,nt),I(u,ho),I(u,gt),I(u,ot),m(u,"sceneFoldersTemplate"),m(u,"navButtonsTemplate"),I(u,at),I(u,on),I(u,mo),I(u,an,!0),I(u,me,null),I(u,Be,""),I(u,ye,[]),m(u,"useFadeOut",!0),m(u,"sceneNavEnabled"),m(u,"navFoldersEnabled"),m(u,"navFoldersForPlayers"),m(u,"navShowRootFolders"),m(u,"navStartCollapsed"),m(u,"showNavOnHover"),m(u,"useSceneIcons"),m(u,"useScenePreview"),m(u,"useSceneBackButton"),m(u,"sceneClickToView"),m(u,"isCollapsed"),m(u,"navPos"),m(u,"init",()=>{const e=b();u.checkSceneNavCompat(),u.preloadTemplates(),u.navStartCollapsed=E.get(e.navStartCollapsed.tag),u.showNavOnHover=E.get(e.showNavOnHover.tag),u.sceneNavEnabled=E.get(e.sceneNavEnabled.tag),u.useScenePreview=E.get(e.useScenePreview.tag),u.navFoldersEnabled=E.get(e.navFoldersEnabled.tag),u.navFoldersForPlayers=E.get(e.navFoldersForPlayers.tag),u.isCollapsed=u.navStartCollapsed,dt.init(),f.log("SCENE NAV INIT",[u.sceneNavEnabled]);const t=document.querySelector("#ui-left");if(u.sceneNavEnabled&&t)t.classList.add("crlngn-nav");else if(t){t.classList.remove("crlngn-nav");return}Hooks.on(D.READY,()=>{u.handleSceneFadeOut()}),Hooks.on(D.RENDER_SCENE_NAV,u.onRender),Hooks.on(D.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==h(u,ye)[h(u,ye).length-1]&&h(u,ye).push(n),u.handleSceneFadeOut()}),Hooks.on(D.COLLAPSE_SIDE_BAR,n=>{f.log(D.COLLAPSE_SIDE_BAR,[n]),n&&u.checkSideBar(n.expanded),u.placeNavButtons()}),Hooks.on(D.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(h(u,at)),u.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(s=>s.remove()),O(u,at,setTimeout(()=>{u.setCollapsedClass(o)},250))}),Hooks.on(D.RENDER_SCENE_DIRECTORY,n=>{f.log(D.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var l,c;const i=game.scenes.get(s.dataset.entryId);if(f.log(D.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,u.sceneClickToView]),u.sceneClickToView&&(s.addEventListener("dblclick",u.onActivateScene),s.addEventListener("click",u.onSelectScene)),u.useSceneIcons&&i&&((l=game.user)!=null&&l.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),i.ownership.default!==0?(i.active&&(d.classList.add("fa-bullseye"),s.prepend(d)),((c=game.scenes.current)==null?void 0:c.id)===i.id&&(d.classList.add("fa-star"),s.prepend(d))):(d.classList.add("fa-eye-slash"),s.prepend(d))}})}),ui.sidebar&&u.checkSideBar(ui.sidebar.expanded),u.placeNavButtons()}),m(u,"onRender",(e,t,n)=>{const o=b(),a=E.get(o.sceneNavPos.tag);f.log(D.RENDER_SCENE_NAV,[t]),u.resetLocalVars(),u.handleSceneFadeOut(e,t,n),u.sceneNavEnabled&&(u.handleBackButton(e,t,n),u.handleSceneList(e,t,n),u.handleFolderList(e,t,n),u.setNavPosition(a,!1),u.handleNavState()),u.addSceneListeners(t),u.addListeners(),u.resetLocalVars(),u.sceneNavEnabled&&u.navShowRootFolders&&(dt.init(),dt.renderFolderList()),f.log(D.RENDER_SCENE_NAV),u.sceneNavEnabled&&(clearTimeout(h(u,at)),O(u,at,setTimeout(()=>{f.log("NAV no transition remove"),u.placeNavButtons()},500)))}),m(u,"setCollapsedClass",e=>{e?h(u,ot).classList.add("navigation-collapsed"):(h(u,ot).classList.remove("navigation-collapsed"),u.placeNavButtons())}),m(u,"checkSideBar",e=>{u.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),m(u,"handleSceneList",async(e,t,n)=>{var o,a;if(u.sceneNavEnabled){f.log("handleSceneList",[e,t,n]);const s=t.querySelectorAll(".scene-navigation-menu li.scene");for(const i of s){const l=i.dataset.sceneId;if(u.useScenePreview){const c=game.scenes.find(p=>p.id===l);c.isGM=(o=game.user)==null?void 0:o.isGM;const d=await renderTemplate(`modules/${U}/templates/scene-nav-preview.hbs`,c);if(f.log("sceneData",[c]),i.classList.add("nav-item"),i.insertAdjacentHTML("beforeend",d),c.isGM&&h(u,Be)===l){const p=new MouseEvent("mouseenter");i.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&u.addPreviewIconListeners(i,c)}u.useSceneIcons&&(i.classList.contains("active")||i.classList.contains("view"))&&i.classList.add("crlngn")}}if(u.sceneNavEnabled){const s=t.querySelector("#scene-navigation-expand"),i=document.querySelector("#ui-left-column-2"),l=document.querySelector("#crlngn-scene-navigation-expand");l&&l.remove();const c=s==null?void 0:s.cloneNode(!0);c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{s.click()}),f.log("toggle events",[e,c]),i.prepend(c)}}),I(u,Tn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=h(u,ye).length,n=h(u,ye)[t-2];let o;f.log("#onBackButton before",[t,n,h(u,ye)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),h(u,ye).pop()),f.log("#onBackButton after",[h(u,ye)])}),m(u,"placeNavButtons",async()=>{var l;const e=document.querySelector("#scene-navigation");e.querySelector("#scene-navigation-inactive");const t=document.querySelectorAll("#ui-left .crlngn-btn");if(!e)return;const n=((l=h(u,gt))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(f.log("placeNavButtons *",[u.isCollapsed,o,t]),t.forEach(c=>c.remove()),!o||u.isCollapsed||h(u,ot).classList.contains("navigation-collapsed"))return;const a=await renderTemplate(`modules/${U}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=e.parentNode.querySelector("button.crlngn-btn.ui-nav-left"),i=e.parentNode.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",h(u,In)),i&&i.addEventListener("click",h(u,wn))}),I(u,In,async e=>{const t=await u.getItemsPerPage(),n=u.navPos||0;if(!h(u,nn)||!h(u,W))return;let o=n-(t-1);f.log("onNavLast",["pos",o,h(u,W).scrollWidth]),o=o<0?0:o,u.setNavPosition(o)}),I(u,wn,async e=>{var c,d;const t=await u.getItemsPerPage(),n=u.navPos||0,o=(c=h(u,W))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((d=h(u,W))==null?void 0:d.scrollWidth)||0;if(!a||!h(u,W))return;let i=n+(t-1),l=i*a;f.log("onNavNext",["pos",n,i,o==null?void 0:o.offsetWidth,l,s]),l>=s&&(i=Math.floor(s/a)),u.setNavPosition(i)}),m(u,"getItemsPerPage",async()=>{var e,t;try{f.log("getItemsPerPage",["Starting"]),u.resetLocalVars();const n=0,o=0,a=((e=h(u,gt))==null?void 0:e.offsetWidth)||0,s=(t=h(u,W))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!h(u,W))return f.log("getItemsPerPage",["No scene items found"]),0;const i=s.offsetWidth,l=h(u,W).offsetWidth;if(!l)return f.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((l-a*2)/i);return f.log("getItemsPerPage",["Calculated:",c,l,i]),c||0}catch(n){return f.log("getItemsPerPage",["Error:",n]),f.error("Error in getItemsPerPage:",n),0}}),m(u,"preloadTemplates",async()=>{try{const e=[`modules/${U}/templates/scene-nav-buttons.hbs`,`modules/${U}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),m(u,"getCurrScenePosition",async e=>{try{if(!h(u,W)||!e)return 0;const t=await u.getItemsPerPage()||1,n=h(u,W).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(a===-1)return 0;const s=a>=u.navPos&&a<=u.navPos+t,i=s?u.navPos:a;return f.log("getCurrScenePosition",["Final position:",i,"isVisible:",s]),i}catch(t){return f.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),m(u,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);f.log("onActivateScene",[o,a]),a.activate(),h(u,me)&&(clearTimeout(h(u,me)),O(u,me,null))}),m(u,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(O(u,Be,""),f.log("onSelectScene",[a,t,n]),a&&a.sheet){const s=a.sheet.render;f.log("onSelectScene - originalRender",[s]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=s},250)}h(u,me)&&(clearTimeout(h(u,me)),O(u,me,null)),O(u,me,setTimeout(()=>{a.view(),O(u,me,null)},250))}),m(u,"onScenePreviewOn",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.dataset;O(u,Be,n.sceneId),f.log("onScenePreviewOn",[h(u,Be)]),t.querySelector(".scene-preview").classList.add("open")}),m(u,"onScenePreviewOff",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget;O(u,Be,""),f.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),m(u,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",u.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",u.onActivateScene),n.addEventListener("mouseenter",u.onScenePreviewOn),n.addEventListener("mouseleave",u.onScenePreviewOff)})}),m(u,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!d}),f.log("Toggled global illumination",[!d])});const s=o.querySelector(".token-vision");s&&s.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.tokenVision;await n.update({tokenVision:!d}),f.log("Toggled token vision",[!d])});const i=o.querySelector(".sound");i&&n.playlistSound&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.playlistSound;if(d){const p=d.sound.playing;p?await d.sound.pause():await d.sound.play(),ui.nav.render(),f.log("Toggled playlist sound",[!p])}});const l=o.querySelector(".config");l&&l.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),f.log("Opened scene configuration")})});let x=u;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function No(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function Re(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?No(Object(t),!0).forEach(function(n){Aa(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):No(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function pn(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pn=function(e){return typeof e}:pn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn(r)}function Aa(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ae(){return Ae=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ae.apply(this,arguments)}function Pa(r,e){if(r==null)return{};var t={},n=Object.keys(r),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=r[o]);return t}function Fa(r,e){if(r==null)return{};var t=Pa(r,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}var Ga="1.15.6";function De(r){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(r)}var Pe=De(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),sn=De(/Edge/i),Lo=De(/firefox/i),Dt=De(/safari/i)&&!De(/chrome/i)&&!De(/android/i),yo=De(/iP(ad|od|hone)/i),Ko=De(/chrome/i)&&De(/android/i),Zo={capture:!1,passive:!1};function G(r,e,t){r.addEventListener(e,t,!Pe&&Zo)}function A(r,e,t){r.removeEventListener(e,t,!Pe&&Zo)}function bn(r,e){if(e){if(e[0]===">"&&(e=e.substring(1)),r)try{if(r.matches)return r.matches(e);if(r.msMatchesSelector)return r.msMatchesSelector(e);if(r.webkitMatchesSelector)return r.webkitMatchesSelector(e)}catch{return!1}return!1}}function Qo(r){return r.host&&r!==document&&r.host.nodeType?r.host:r.parentNode}function Se(r,e,t,n){if(r){t=t||document;do{if(e!=null&&(e[0]===">"?r.parentNode===t&&bn(r,e):bn(r,e))||n&&r===t)return r;if(r===t)break}while(r=Qo(r))}return null}var To=/\s+/g;function le(r,e,t){if(r&&e)if(r.classList)r.classList[t?"add":"remove"](e);else{var n=(" "+r.className+" ").replace(To," ").replace(" "+e+" "," ");r.className=(n+(t?" "+e:"")).replace(To," ")}}function R(r,e,t){var n=r&&r.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(r,""):r.currentStyle&&(t=r.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function ut(r,e){var t="";if(typeof r=="string")t=r;else do{var n=R(r,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(r=r.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function _o(r,e,t){if(r){var n=r.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function we(){var r=document.scrollingElement;return r||document.documentElement}function X(r,e,t,n,o){if(!(!r.getBoundingClientRect&&r!==window)){var a,s,i,l,c,d,p;if(r!==window&&r.parentNode&&r!==we()?(a=r.getBoundingClientRect(),s=a.top,i=a.left,l=a.bottom,c=a.right,d=a.height,p=a.width):(s=0,i=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,p=window.innerWidth),(e||t)&&r!==window&&(o=o||r.parentNode,!Pe))do if(o&&o.getBoundingClientRect&&(R(o,"transform")!=="none"||t&&R(o,"position")!=="static")){var y=o.getBoundingClientRect();s-=y.top+parseInt(R(o,"border-top-width")),i-=y.left+parseInt(R(o,"border-left-width")),l=s+a.height,c=i+a.width;break}while(o=o.parentNode);if(n&&r!==window){var L=ut(o||r),C=L&&L.a,w=L&&L.d;L&&(s/=w,i/=C,p/=C,d/=w,l=s+d,c=i+p)}return{top:s,left:i,bottom:l,right:c,width:p,height:d}}}function Io(r,e,t){for(var n=We(r,!0),o=X(r)[e];n;){var a=X(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===we())break;n=We(n,!1)}return!1}function mt(r,e,t,n){for(var o=0,a=0,s=r.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==k.ghost&&(n||s[a]!==k.dragged)&&Se(s[a],t.draggable,r,!1)){if(o===e)return s[a];o++}a++}return null}function So(r,e){for(var t=r.lastElementChild;t&&(t===k.ghost||R(t,"display")==="none"||e&&!bn(t,e));)t=t.previousElementSibling;return t||null}function ge(r,e){var t=0;if(!r||!r.parentNode)return-1;for(;r=r.previousElementSibling;)r.nodeName.toUpperCase()!=="TEMPLATE"&&r!==k.clone&&(!e||bn(r,e))&&t++;return t}function wo(r){var e=0,t=0,n=we();if(r)do{var o=ut(r),a=o.a,s=o.d;e+=r.scrollLeft*a,t+=r.scrollTop*s}while(r!==n&&(r=r.parentNode));return[e,t]}function za(r,e){for(var t in r)if(r.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===r[t][n])return Number(t)}return-1}function We(r,e){if(!r||!r.getBoundingClientRect)return we();var t=r,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=R(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return we();if(n||e)return t;n=!0}}while(t=t.parentNode);return we()}function xa(r,e){if(r&&e)for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function Pn(r,e){return Math.round(r.top)===Math.round(e.top)&&Math.round(r.left)===Math.round(e.left)&&Math.round(r.height)===Math.round(e.height)&&Math.round(r.width)===Math.round(e.width)}var At;function ea(r,e){return function(){if(!At){var t=arguments,n=this;t.length===1?r.call(n,t[0]):r.apply(n,t),At=setTimeout(function(){At=void 0},e)}}}function Ua(){clearTimeout(At),At=void 0}function ta(r,e,t){r.scrollLeft+=e,r.scrollTop+=t}function na(r){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(r).cloneNode(!0):t?t(r).clone(!0)[0]:r.cloneNode(!0)}function oa(r,e,t){var n={};return Array.from(r.children).forEach(function(o){var a,s,i,l;if(!(!Se(o,e.draggable,r,!1)||o.animated||o===t)){var c=X(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((i=n.right)!==null&&i!==void 0?i:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var se="Sortable"+new Date().getTime();function Ha(){var r=[],e;return{captureAnimationState:function(){if(r=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(R(o,"display")==="none"||o===k.ghost)){r.push({target:o,rect:X(o)});var a=Re({},r[r.length-1].rect);if(o.thisAnimationDuration){var s=ut(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){r.push(n)},removeAnimationState:function(n){r.splice(za(r,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;r.forEach(function(i){var l=0,c=i.target,d=c.fromRect,p=X(c),y=c.prevFromRect,L=c.prevToRect,C=i.rect,w=ut(c,!0);w&&(p.top-=w.f,p.left-=w.e),c.toRect=p,c.thisAnimationDuration&&Pn(y,p)&&!Pn(d,p)&&(C.top-p.top)/(C.left-p.left)===(d.top-p.top)/(d.left-p.left)&&(l=Ba(C,y,L,o.options)),Pn(p,d)||(c.prevFromRect=d,c.prevToRect=p,l||(l=o.options.animation),o.animate(c,C,p,l)),l&&(a=!0,s=Math.max(s,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),r=[]},animate:function(n,o,a,s){if(s){R(n,"transition",""),R(n,"transform","");var i=ut(this.el),l=i&&i.a,c=i&&i.d,d=(o.left-a.left)/(l||1),p=(o.top-a.top)/(c||1);n.animatingX=!!d,n.animatingY=!!p,R(n,"transform","translate3d("+d+"px,"+p+"px,0)"),this.forRepaintDummy=qa(n),R(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),R(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){R(n,"transition",""),R(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function qa(r){return r.offsetWidth}function Ba(r,e,t,n){return Math.sqrt(Math.pow(e.top-r.top,2)+Math.pow(e.left-r.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var it=[],Fn={initializeByDefault:!0},rn={mount:function(e){for(var t in Fn)Fn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Fn[t]);it.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),it.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";it.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Re({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Re({sortable:t},n)))})},initializePlugins:function(e,t,n,o){it.forEach(function(i){var l=i.pluginName;if(!(!e.options[l]&&!i.initializeByDefault)){var c=new i(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,Ae(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return it.forEach(function(o){typeof o.eventProperties=="function"&&Ae(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return it.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function Va(r){var e=r.sortable,t=r.rootEl,n=r.name,o=r.targetEl,a=r.cloneEl,s=r.toEl,i=r.fromEl,l=r.oldIndex,c=r.newIndex,d=r.oldDraggableIndex,p=r.newDraggableIndex,y=r.originalEvent,L=r.putSortable,C=r.extraEventProperties;if(e=e||t&&t[se],!!e){var w,z=e.options,H="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Pe&&!sn?w=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(w=document.createEvent("Event"),w.initEvent(n,!0,!0)),w.to=s||t,w.from=i||t,w.item=o||t,w.clone=a,w.oldIndex=l,w.newIndex=c,w.oldDraggableIndex=d,w.newDraggableIndex=p,w.originalEvent=y,w.pullMode=L?L.lastPutMode:void 0;var J=Re(Re({},C),rn.getEventProperties(n,e));for(var fe in J)w[fe]=J[fe];t&&t.dispatchEvent(w),z[H]&&z[H].call(e,w)}}var Wa=["evt"],oe=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=Fa(n,Wa);rn.pluginEvent.bind(k)(e,t,Re({dragEl:S,parentEl:j,ghostEl:M,rootEl:B,nextEl:Qe,lastDownEl:hn,cloneEl:V,cloneHidden:Ue,dragStarted:kt,putSortable:Q,activeSortable:k.active,originalEvent:o,oldIndex:ct,oldDraggableIndex:Pt,newIndex:ce,newDraggableIndex:xe,hideGhostForTarget:ra,unhideGhostForTarget:la,cloneNowHidden:function(){Ue=!0},cloneNowShown:function(){Ue=!1},dispatchSortableEvent:function(i){ne({sortable:t,name:i,originalEvent:o})}},a))};function ne(r){Va(Re({putSortable:Q,cloneEl:V,targetEl:S,rootEl:B,oldIndex:ct,oldDraggableIndex:Pt,newIndex:ce,newDraggableIndex:xe},r))}var S,j,M,B,Qe,hn,V,Ue,ct,ce,Pt,xe,dn,Q,lt=!1,vn=!1,Cn=[],Ke,pe,Gn,zn,Ro,ko,kt,rt,Ft,Gt=!1,un=!1,mn,ee,xn=[],eo=!1,En=[],On=typeof document<"u",gn=yo,Mo=sn||Pe?"cssFloat":"float",ja=On&&!Ko&&!yo&&"draggable"in document.createElement("div"),aa=function(){if(On){if(Pe)return!1;var r=document.createElement("x");return r.style.cssText="pointer-events:auto",r.style.pointerEvents==="auto"}}(),sa=function(e,t){var n=R(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=mt(e,0,t),s=mt(e,1,t),i=a&&R(a),l=s&&R(s),c=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+X(a).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+X(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&i.float&&i.float!=="none"){var p=i.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return a&&(i.display==="block"||i.display==="flex"||i.display==="table"||i.display==="grid"||c>=o&&n[Mo]==="none"||s&&n[Mo]==="none"&&c+d>o)?"vertical":"horizontal"},$a=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,i=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===i||a===l||o+s/2===i+c/2},Ya=function(e,t){var n;return Cn.some(function(o){var a=o[se].options.emptyInsertThreshold;if(!(!a||So(o))){var s=X(o),i=e>=s.left-a&&e<=s.right+a,l=t>=s.top-a&&t<=s.bottom+a;if(i&&l)return n=o}}),n},ia=function(e){function t(a,s){return function(i,l,c,d){var p=i.options.group.name&&l.options.group.name&&i.options.group.name===l.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(i,l,c,d),s)(i,l,c,d);var y=(s?i:l).options.group.name;return a===!0||typeof a=="string"&&a===y||a.join&&a.indexOf(y)>-1}}var n={},o=e.group;(!o||pn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},ra=function(){!aa&&M&&R(M,"display","none")},la=function(){!aa&&M&&R(M,"display","")};On&&!Ko&&document.addEventListener("click",function(r){if(vn)return r.preventDefault(),r.stopPropagation&&r.stopPropagation(),r.stopImmediatePropagation&&r.stopImmediatePropagation(),vn=!1,!1},!0);var Ze=function(e){if(S){e=e.touches?e.touches[0]:e;var t=Ya(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[se]._onDragOver(n)}}},Xa=function(e){S&&S.parentNode[se]._isOutsideThisEl(e.target)};function k(r,e){if(!(r&&r.nodeType&&r.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(r));this.el=r,this.options=e=Ae({},e),r[se]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(r.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return sa(r,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,i){s.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!Dt||yo),emptyInsertThreshold:5};rn.initializePlugins(this,r,t);for(var n in t)!(n in e)&&(e[n]=t[n]);ia(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:ja,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?G(r,"pointerdown",this._onTapStart):(G(r,"mousedown",this._onTapStart),G(r,"touchstart",this._onTapStart)),this.nativeDraggable&&(G(r,"dragover",this),G(r,"dragenter",this)),Cn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ae(this,Ha())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(rt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,S):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,i=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(i||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,d=o.filter;if(ns(n),!S&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Dt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Se(l,o.draggable,n,!1),!(l&&l.animated)&&hn!==l)){if(ct=ge(l),Pt=ge(l,o.draggable),typeof d=="function"){if(d.call(this,e,l,this)){ne({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),oe("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(p){if(p=Se(c,p.trim(),n,!1),p)return ne({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),oe("filter",t,{evt:e}),!0}),d)){a&&e.preventDefault();return}o.handle&&!Se(c,o.handle,n,!1)||this._prepareDragStart(e,i,l)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,i=a.ownerDocument,l;if(n&&!S&&n.parentNode===a){var c=X(n);if(B=a,S=n,j=S.parentNode,Qe=S.nextSibling,hn=n,dn=s.group,k.dragged=S,Ke={target:S,clientX:(t||e).clientX,clientY:(t||e).clientY},Ro=Ke.clientX-c.left,ko=Ke.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,S.style["will-change"]="all",l=function(){if(oe("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Lo&&o.nativeDraggable&&(S.draggable=!0),o._triggerDragStart(e,t),ne({sortable:o,name:"choose",originalEvent:e}),le(S,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){_o(S,d.trim(),Un)}),G(i,"dragover",Ze),G(i,"mousemove",Ze),G(i,"touchmove",Ze),s.supportPointer?(G(i,"pointerup",o._onDrop),!this.nativeDraggable&&G(i,"pointercancel",o._onDrop)):(G(i,"mouseup",o._onDrop),G(i,"touchend",o._onDrop),G(i,"touchcancel",o._onDrop)),Lo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,S.draggable=!0),oe("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(sn||Pe))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(G(i,"pointerup",o._disableDelayedDrag),G(i,"pointercancel",o._disableDelayedDrag)):(G(i,"mouseup",o._disableDelayedDrag),G(i,"touchend",o._disableDelayedDrag),G(i,"touchcancel",o._disableDelayedDrag)),G(i,"mousemove",o._delayedDragTouchMoveHandler),G(i,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&G(i,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,s.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){S&&Un(S),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;A(e,"mouseup",this._disableDelayedDrag),A(e,"touchend",this._disableDelayedDrag),A(e,"touchcancel",this._disableDelayedDrag),A(e,"pointerup",this._disableDelayedDrag),A(e,"pointercancel",this._disableDelayedDrag),A(e,"mousemove",this._delayedDragTouchMoveHandler),A(e,"touchmove",this._delayedDragTouchMoveHandler),A(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?G(document,"pointermove",this._onTouchMove):t?G(document,"touchmove",this._onTouchMove):G(document,"mousemove",this._onTouchMove):(G(S,"dragend",this),G(B,"dragstart",this._onDragStart));try{document.selection?yn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(lt=!1,B&&S){oe("dragStarted",this,{evt:t}),this.nativeDraggable&&G(document,"dragover",Xa);var n=this.options;!e&&le(S,n.dragClass,!1),le(S,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),ne({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(pe){this._lastX=pe.clientX,this._lastY=pe.clientY,ra();for(var e=document.elementFromPoint(pe.clientX,pe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(pe.clientX,pe.clientY),e!==t);)t=e;if(S.parentNode[se]._isOutsideThisEl(e),t)do{if(t[se]){var n=void 0;if(n=t[se]._onDragOver({clientX:pe.clientX,clientY:pe.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Qo(t));la()}},_onTouchMove:function(e){if(Ke){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=M&&ut(M,!0),i=M&&s&&s.a,l=M&&s&&s.d,c=gn&&ee&&wo(ee),d=(a.clientX-Ke.clientX+o.x)/(i||1)+(c?c[0]-xn[0]:0)/(i||1),p=(a.clientY-Ke.clientY+o.y)/(l||1)+(c?c[1]-xn[1]:0)/(l||1);if(!k.active&&!lt){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(M){s?(s.e+=d-(Gn||0),s.f+=p-(zn||0)):s={a:1,b:0,c:0,d:1,e:d,f:p};var y="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");R(M,"webkitTransform",y),R(M,"mozTransform",y),R(M,"msTransform",y),R(M,"transform",y),Gn=d,zn=p,pe=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!M){var e=this.options.fallbackOnBody?document.body:B,t=X(S,!0,gn,!0,e),n=this.options;if(gn){for(ee=e;R(ee,"position")==="static"&&R(ee,"transform")==="none"&&ee!==document;)ee=ee.parentNode;ee!==document.body&&ee!==document.documentElement?(ee===document&&(ee=we()),t.top+=ee.scrollTop,t.left+=ee.scrollLeft):ee=we(),xn=wo(ee)}M=S.cloneNode(!0),le(M,n.ghostClass,!1),le(M,n.fallbackClass,!0),le(M,n.dragClass,!0),R(M,"transition",""),R(M,"transform",""),R(M,"box-sizing","border-box"),R(M,"margin",0),R(M,"top",t.top),R(M,"left",t.left),R(M,"width",t.width),R(M,"height",t.height),R(M,"opacity","0.8"),R(M,"position",gn?"absolute":"fixed"),R(M,"zIndex","100000"),R(M,"pointerEvents","none"),k.ghost=M,e.appendChild(M),R(M,"transform-origin",Ro/parseInt(M.style.width)*100+"% "+ko/parseInt(M.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(oe("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}oe("setupClone",this),k.eventCanceled||(V=na(S),V.removeAttribute("id"),V.draggable=!1,V.style["will-change"]="",this._hideClone(),le(V,this.options.chosenClass,!1),k.clone=V),n.cloneId=yn(function(){oe("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||B.insertBefore(V,S),n._hideClone(),ne({sortable:n,name:"clone"}))}),!t&&le(S,a.dragClass,!0),t?(vn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(A(document,"mouseup",n._onDrop),A(document,"touchend",n._onDrop),A(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,S)),G(document,"drop",n),R(S,"transform","translateZ(0)")),lt=!0,n._dragStartId=yn(n._dragStarted.bind(n,t,e)),G(document,"selectstart",n),kt=!0,window.getSelection().removeAllRanges(),Dt&&R(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,i=this.options,l=i.group,c=k.active,d=dn===l,p=i.sort,y=Q||c,L,C=this,w=!1;if(eo)return;function z(wt,ga){oe(wt,C,Re({evt:e,isOwner:d,axis:L?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:y,target:n,completed:J,onMove:function(Co,fa){return fn(B,t,S,o,Co,X(Co),e,fa)},changed:fe},ga))}function H(){z("dragOverAnimationCapture"),C.captureAnimationState(),C!==y&&y.captureAnimationState()}function J(wt){return z("dragOverCompleted",{insertion:wt}),wt&&(d?c._hideClone():c._showClone(C),C!==y&&(le(S,Q?Q.options.ghostClass:c.options.ghostClass,!1),le(S,i.ghostClass,!0)),Q!==C&&C!==k.active?Q=C:C===k.active&&Q&&(Q=null),y===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){z("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==y&&(y.animateAll(),y._ignoreWhileAnimating=null)),(n===S&&!S.animated||n===t&&!n.animated)&&(rt=null),!i.dragoverBubble&&!e.rootEl&&n!==document&&(S.parentNode[se]._isOutsideThisEl(e.target),!wt&&Ze(e)),!i.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),w=!0}function fe(){ce=ge(S),xe=ge(S,i.draggable),ne({sortable:C,name:"change",toEl:t,newIndex:ce,newDraggableIndex:xe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Se(n,i.draggable,t,!0),z("dragOver"),k.eventCanceled)return w;if(S.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return J(!1);if(vn=!1,c&&!i.disabled&&(d?p||(s=j!==B):Q===this||(this.lastPutMode=dn.checkPull(this,c,S,e))&&l.checkPut(this,c,S,e))){if(L=this._getDirection(e,n)==="vertical",o=X(S),z("dragOverValid"),k.eventCanceled)return w;if(s)return j=B,H(),this._hideClone(),z("revert"),k.eventCanceled||(Qe?B.insertBefore(S,Qe):B.appendChild(S)),J(!0);var ie=So(t,i.draggable);if(!ie||Qa(e,L,this)&&!ie.animated){if(ie===S)return J(!1);if(ie&&t===e.target&&(n=ie),n&&(a=X(n)),fn(B,t,S,o,n,a,e,!!n)!==!1)return H(),ie&&ie.nextSibling?t.insertBefore(S,ie.nextSibling):t.appendChild(S),j=t,fe(),J(!0)}else if(ie&&Za(e,L,this)){var Ye=mt(t,0,i,!0);if(Ye===S)return J(!1);if(n=Ye,a=X(n),fn(B,t,S,o,n,a,e,!1)!==!1)return H(),t.insertBefore(S,Ye),j=t,fe(),J(!0)}else if(n.parentNode===t){a=X(n);var be=0,Xe,Nt=S.parentNode!==t,re=!$a(S.animated&&S.toRect||o,n.animated&&n.toRect||a,L),Lt=L?"top":"left",Fe=Io(n,"top","top")||Io(S,"top","top"),Tt=Fe?Fe.scrollTop:void 0;rt!==n&&(Xe=a[Lt],Gt=!1,un=!re&&i.invertSwap||Nt),be=_a(e,n,a,L,re?1:i.swapThreshold,i.invertedSwapThreshold==null?i.swapThreshold:i.invertedSwapThreshold,un,rt===n);var ke;if(be!==0){var Je=ge(S);do Je-=be,ke=j.children[Je];while(ke&&(R(ke,"display")==="none"||ke===M))}if(be===0||ke===n)return J(!1);rt=n,Ft=be;var It=n.nextElementSibling,Ge=!1;Ge=be===1;var ln=fn(B,t,S,o,n,a,e,Ge);if(ln!==!1)return(ln===1||ln===-1)&&(Ge=ln===1),eo=!0,setTimeout(Ka,30),H(),Ge&&!It?t.appendChild(S):n.parentNode.insertBefore(S,Ge?It:n),Fe&&ta(Fe,0,Tt-Fe.scrollTop),j=S.parentNode,Xe!==void 0&&!un&&(mn=Math.abs(Xe-X(n)[Lt])),fe(),J(!0)}if(t.contains(S))return J(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){A(document,"mousemove",this._onTouchMove),A(document,"touchmove",this._onTouchMove),A(document,"pointermove",this._onTouchMove),A(document,"dragover",Ze),A(document,"mousemove",Ze),A(document,"touchmove",Ze)},_offUpEvents:function(){var e=this.el.ownerDocument;A(e,"mouseup",this._onDrop),A(e,"touchend",this._onDrop),A(e,"pointerup",this._onDrop),A(e,"pointercancel",this._onDrop),A(e,"touchcancel",this._onDrop),A(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(ce=ge(S),xe=ge(S,n.draggable),oe("drop",this,{evt:e}),j=S&&S.parentNode,ce=ge(S),xe=ge(S,n.draggable),k.eventCanceled){this._nulling();return}lt=!1,un=!1,Gt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),to(this.cloneId),to(this._dragStartId),this.nativeDraggable&&(A(document,"drop",this),A(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Dt&&R(document.body,"user-select",""),R(S,"transform",""),e&&(kt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),M&&M.parentNode&&M.parentNode.removeChild(M),(B===j||Q&&Q.lastPutMode!=="clone")&&V&&V.parentNode&&V.parentNode.removeChild(V),S&&(this.nativeDraggable&&A(S,"dragend",this),Un(S),S.style["will-change"]="",kt&&!lt&&le(S,Q?Q.options.ghostClass:this.options.ghostClass,!1),le(S,this.options.chosenClass,!1),ne({sortable:this,name:"unchoose",toEl:j,newIndex:null,newDraggableIndex:null,originalEvent:e}),B!==j?(ce>=0&&(ne({rootEl:j,name:"add",toEl:j,fromEl:B,originalEvent:e}),ne({sortable:this,name:"remove",toEl:j,originalEvent:e}),ne({rootEl:j,name:"sort",toEl:j,fromEl:B,originalEvent:e}),ne({sortable:this,name:"sort",toEl:j,originalEvent:e})),Q&&Q.save()):ce!==ct&&ce>=0&&(ne({sortable:this,name:"update",toEl:j,originalEvent:e}),ne({sortable:this,name:"sort",toEl:j,originalEvent:e})),k.active&&((ce==null||ce===-1)&&(ce=ct,xe=Pt),ne({sortable:this,name:"end",toEl:j,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){oe("nulling",this),B=S=j=M=Qe=V=hn=Ue=Ke=pe=kt=ce=xe=ct=Pt=rt=Ft=Q=dn=k.dragged=k.ghost=k.clone=k.active=null,En.forEach(function(e){e.checked=!0}),En.length=Gn=zn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":S&&(this._onDragOver(e),Ja(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],Se(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||ts(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var i=o.children[s];Se(i,this.options.draggable,o,!1)&&(n[a]=i)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Se(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=rn.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&ia(n)},destroy:function(){oe("destroy",this);var e=this.el;e[se]=null,A(e,"mousedown",this._onTapStart),A(e,"touchstart",this._onTapStart),A(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(A(e,"dragover",this),A(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Cn.splice(Cn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ue){if(oe("hideClone",this),k.eventCanceled)return;R(V,"display","none"),this.options.removeCloneOnHide&&V.parentNode&&V.parentNode.removeChild(V),Ue=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ue){if(oe("showClone",this),k.eventCanceled)return;S.parentNode==B&&!this.options.group.revertClone?B.insertBefore(V,S):Qe?B.insertBefore(V,Qe):B.appendChild(V),this.options.group.revertClone&&this.animate(S,V),R(V,"display",""),Ue=!1}}};function Ja(r){r.dataTransfer&&(r.dataTransfer.dropEffect="move"),r.cancelable&&r.preventDefault()}function fn(r,e,t,n,o,a,s,i){var l,c=r[se],d=c.options.onMove,p;return window.CustomEvent&&!Pe&&!sn?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=r,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=a||X(e),l.willInsertAfter=i,l.originalEvent=s,r.dispatchEvent(l),d&&(p=d.call(c,l,s)),p}function Un(r){r.draggable=!1}function Ka(){eo=!1}function Za(r,e,t){var n=X(mt(t.el,0,t.options,!0)),o=oa(t.el,t.options,M),a=10;return e?r.clientX<o.left-a||r.clientY<n.top&&r.clientX<n.right:r.clientY<o.top-a||r.clientY<n.bottom&&r.clientX<n.left}function Qa(r,e,t){var n=X(So(t.el,t.options.draggable)),o=oa(t.el,t.options,M),a=10;return e?r.clientX>o.right+a||r.clientY>n.bottom&&r.clientX>n.left:r.clientY>o.bottom+a||r.clientX>n.right&&r.clientY>n.top}function _a(r,e,t,n,o,a,s,i){var l=n?r.clientY:r.clientX,c=n?t.height:t.width,d=n?t.top:t.left,p=n?t.bottom:t.right,y=!1;if(!s){if(i&&mn<c*o){if(!Gt&&(Ft===1?l>d+c*a/2:l<p-c*a/2)&&(Gt=!0),Gt)y=!0;else if(Ft===1?l<d+mn:l>p-mn)return-Ft}else if(l>d+c*(1-o)/2&&l<p-c*(1-o)/2)return es(e)}return y=y||s,y&&(l<d+c*a/2||l>p-c*a/2)?l>d+c/2?1:-1:0}function es(r){return ge(S)<ge(r)?1:-1}function ts(r){for(var e=r.tagName+r.className+r.src+r.href+r.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function ns(r){En.length=0;for(var e=r.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&En.push(n)}}function yn(r){return setTimeout(r,0)}function to(r){return clearTimeout(r)}On&&G(document,"touchmove",function(r){(k.active||lt)&&r.cancelable&&r.preventDefault()});k.utils={on:G,off:A,css:R,find:_o,is:function(e,t){return!!Se(e,t,e,!1)},extend:xa,throttle:ea,closest:Se,toggleClass:le,clone:na,index:ge,nextTick:yn,cancelNextTick:to,detectDirection:sa,getChild:mt,expando:se};k.get=function(r){return r[se]};k.mount=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Re(Re({},k.utils),n.utils)),rn.mount(n)})};k.create=function(r,e){return new k(r,e)};k.version=Ga;var $=[],Mt,no,oo=!1,Hn,qn,Nn,Ot;function os(){function r(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return r.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?G(document,"dragover",this._handleAutoScroll):this.options.supportPointer?G(document,"pointermove",this._handleFallbackAutoScroll):n.touches?G(document,"touchmove",this._handleFallbackAutoScroll):G(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?A(document,"dragover",this._handleAutoScroll):(A(document,"pointermove",this._handleFallbackAutoScroll),A(document,"touchmove",this._handleFallbackAutoScroll),A(document,"mousemove",this._handleFallbackAutoScroll)),Oo(),Sn(),Ua()},nulling:function(){Nn=no=Mt=oo=Ot=Hn=qn=null,$.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,i=document.elementFromPoint(a,s);if(Nn=t,n||this.options.forceAutoScrollFallback||sn||Pe||Dt){Bn(t,this.options,i,n);var l=We(i,!0);oo&&(!Ot||a!==Hn||s!==qn)&&(Ot&&Oo(),Ot=setInterval(function(){var c=We(document.elementFromPoint(a,s),!0);c!==l&&(l=c,Sn()),Bn(t,o.options,c,n)},10),Hn=a,qn=s)}else{if(!this.options.bubbleScroll||We(i,!0)===we()){Sn();return}Bn(t,this.options,We(i,!1),!1)}}},Ae(r,{pluginName:"scroll",initializeByDefault:!0})}function Sn(){$.forEach(function(r){clearInterval(r.pid)}),$=[]}function Oo(){clearInterval(Ot)}var Bn=ea(function(r,e,t,n){if(e.scroll){var o=(r.touches?r.touches[0]:r).clientX,a=(r.touches?r.touches[0]:r).clientY,s=e.scrollSensitivity,i=e.scrollSpeed,l=we(),c=!1,d;no!==t&&(no=t,Sn(),Mt=e.scroll,d=e.scrollFn,Mt===!0&&(Mt=We(t,!0)));var p=0,y=Mt;do{var L=y,C=X(L),w=C.top,z=C.bottom,H=C.left,J=C.right,fe=C.width,ie=C.height,Ye=void 0,be=void 0,Xe=L.scrollWidth,Nt=L.scrollHeight,re=R(L),Lt=L.scrollLeft,Fe=L.scrollTop;L===l?(Ye=fe<Xe&&(re.overflowX==="auto"||re.overflowX==="scroll"||re.overflowX==="visible"),be=ie<Nt&&(re.overflowY==="auto"||re.overflowY==="scroll"||re.overflowY==="visible")):(Ye=fe<Xe&&(re.overflowX==="auto"||re.overflowX==="scroll"),be=ie<Nt&&(re.overflowY==="auto"||re.overflowY==="scroll"));var Tt=Ye&&(Math.abs(J-o)<=s&&Lt+fe<Xe)-(Math.abs(H-o)<=s&&!!Lt),ke=be&&(Math.abs(z-a)<=s&&Fe+ie<Nt)-(Math.abs(w-a)<=s&&!!Fe);if(!$[p])for(var Je=0;Je<=p;Je++)$[Je]||($[Je]={});($[p].vx!=Tt||$[p].vy!=ke||$[p].el!==L)&&($[p].el=L,$[p].vx=Tt,$[p].vy=ke,clearInterval($[p].pid),(Tt!=0||ke!=0)&&(c=!0,$[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(Nn);var It=$[this.layer].vy?$[this.layer].vy*i:0,Ge=$[this.layer].vx?$[this.layer].vx*i:0;typeof d=="function"&&d.call(k.dragged.parentNode[se],Ge,It,r,Nn,$[this.layer].el)!=="continue"||ta($[this.layer].el,Ge,It)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&y!==l&&(y=We(y,!1)));oo=c}},30),ca=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,i=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||a;i();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function bo(){}bo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=mt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:ca};Ae(bo,{pluginName:"revertOnSpill"});function vo(){}vo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:ca};Ae(vo,{pluginName:"removeOnSpill"});k.mount(new os);k.mount(vo,bo);const Vn="root";var Ve,Y,Rn,kn,da;const T=class T{static init(){if(T.noFolderView()||!ui.scenes)return;T.preloadTemplates(),game.user.getFlag(U,"activeSceneFolders")||game.user.setFlag(U,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(D.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;q(a=T,kn,da).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){const o=b(),a=document.querySelector("#crlngn-scene-lookup"),s=document.querySelector("#crlngn-folder-toggle");if(a||s)return;const i=t.querySelector("#scene-navigation-active"),l=i.querySelector("li.scene:first-of-type"),c=document.createElement("div"),d=document.createElement("div");c.id="crlngn-scene-lookup",c.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,d.dataset.tooltip=x.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",d.id="crlngn-folder-toggle",d.innerHTML="<i class='fa-solid icon'></i>",x.navShowRootFolders?i.classList.add("with-folders"):i.classList.remove("with-folders"),c.querySelector(".folder-expand").addEventListener("click",T.toggleFolderLookup),d.addEventListener("click",()=>{x.setNavPosition(0),E.set(o.navShowRootFolders.tag,!x.navShowRootFolders),x.placeNavButtons()}),i.insertBefore(c,l),i.append(d),T.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),O(T,Ve,game.scenes.sortingMode),f.log("buildFolderData A",[e.name,e]),e.id===Vn?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=T.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},f.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),h(T,Ve)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Ve=new WeakMap,Y=new WeakMap,Rn=new WeakMap,kn=new WeakSet,da=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){O(T,Ve,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}O(T,Ve,"a"),f.log("updateSortMode fallback",[h(T,Ve)])},I(T,kn),m(T,"selectedFolder",Vn),I(T,Ve,"a"),I(T,Y,[]),m(T,"searchValue",""),m(T,"renderFolderList",async e=>{O(T,Y,game.user.getFlag(U,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:Vn},a=T.buildTemplateData(o),s=await renderTemplate(`modules/${U}/templates/scene-nav-folders.hbs`,a);f.log("renderFolderList",[o,h(T,Y),s]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const i=t.querySelectorAll("li.folder");T.addFolderListeners(i),x.placeNavButtons()}),m(T,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${U}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",T.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),m(T,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",h(T,Rn));const o=n.dataset.folderId,a=t.get(o),s=h(T,Y).includes(o);f.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),T.injectSubfolders(a,n))})}),I(T,Rn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await T.injectSubfolders(a,t.parentNode),x.addSceneListeners(t.parentNode),f.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?T.updateActiveFolders(n,!0):T.updateActiveFolders(n,!1)}),m(T,"injectSubfolders",async(e,t)=>{const n=T.buildTemplateData(e),o=await renderTemplate(`modules/${U}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");T.addFolderListeners(s),x.addSceneListeners(t.querySelector(".contents"))}),m(T,"updateActiveFolders",async(e,t=!1)=>{const o=document.querySelector("#scene-navigation-inactive").querySelector(`li.folder[data-folder-id=${e}]`),a=h(T,Y).indexOf(e);f.log("updateActiveFolders A",[a,e,game.user.getFlag(U,"activeSceneFolders"),h(T,Y)]),t?(O(T,Y,h(T,Y).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):h(T,Y).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(i=>{i!==o&&(O(T,Y,h(T,Y).filter(l=>l!==i.dataset.folderId)),i.classList.remove("crlngn-folder-active"))}),h(T,Y).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(U,"activeSceneFolders",h(T,Y)),f.log("updateActiveFolders B",[t,e,game.user.getFlag(U,"activeSceneFolders"),h(T,Y)])}),m(T,"selectFolder",e=>T.getFolderById(e)||null),m(T,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!x.navFoldersForPlayers||!x.navFoldersEnabled||!x.sceneNavEnabled}),m(T,"preloadTemplates",async()=>{const e=[`modules/${U}/templates/scene-nav-folders.hbs`,`modules/${U}/templates/scene-nav-subfolders.hbs`,`modules/${U}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),m(T,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;T.searchValue=n,T.updateSearchResults(n)}),m(T,"updateSearchResults",e=>{var a,s;if(T.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())&&i.permission>=2))||[];n.sort((i,l)=>i.name.toLowerCase().localeCompare(l.name.toLowerCase()));const o=((s=game.scenes)==null?void 0:s.folders.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((i,l)=>i.name.toLowerCase().localeCompare(l.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(i=>{const l=document.createElement("li");l.className="search-folder",l.dataset.folderId=i.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${i.name}</a>`,l.addEventListener("click",T.onSelectSearchedFolder),t.appendChild(l)}),n.forEach(i=>{const l=document.createElement("li");l.className="search-scene",l.dataset.sceneId=i.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${i.name}</a>`,l.querySelector(".scene-name").addEventListener("dblclick",x.onActivateScene),l.querySelector(".scene-name").addEventListener("click",x.onSelectScene),t.appendChild(l)}),o.length===0&&n.length===0){const i=document.createElement("li");i.className="no-results",i.textContent="No matching results found",t.appendChild(i)}}),m(T,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(x.navShowRootFolders||o.click(),!n)return;const i=[...ui.scenes.collection.folders.get(n).ancestors];O(T,Y,[]);for(const l of i)h(T,Y).push(l.id);h(T,Y).push(n),await game.user.setFlag(U,"activeSceneFolders",h(T,Y)),setTimeout(async()=>{ui.nav.render()},200)});let dt=T;const de=class de{static init(){Hooks.on(D.RENDER_SIDE_BAR,de.onRender)}static applyFadeOut(e){de.useFadeOut=e,de.handleFadeOut()}static applyCustomStyle(e){var t;de.customStylesEnabled=e,f.log("applyCustomStyle",[de.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=document.querySelector("#ui-right");de.customStylesEnabled?o.classList.add("crlngn-tabs"):o.classList.remove("crlngn-tabs"),de.handleFadeOut(e,t,n)}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");de.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("SidebarTabs handle fade out",[de.useFadeOut])}};m(de,"useFadeOut",!0),m(de,"customStylesEnabled",!0);let Bt=de;var ft;const v=class v{static registerSettings(){const e=b(),t=Object.entries(e);f.log("registerSettings - test",[t],!0),t.forEach(async c=>{const d=c[1];f.log("Registering... ",[c],!0);const p={name:d.label,hint:d.hint,default:d.default,type:d.propType,scope:d.scope,config:d.config,requiresReload:d.requiresReload||!1,onChange:y=>v.apply(d.tag,y)};(d.choices||d.options)&&(p.choices=d.choices||d.options),await game.settings.register(U,d.tag,p),v.get(d.tag)===void 0&&(f.log("resetting...",[d.tag]),v.set(d.tag,d.default))}),game.keybindings.register(U,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{v.hideInterface()},restricted:!1}),v.applyThemeSettings(),v.applyCustomCSS(),v.applyModuleAdjustments(),Object.entries(Da()).forEach(async c=>{const d=c[1],p={name:d.tag,label:d.label,hint:d.hint,icon:d.icon,type:d.propType,restricted:d.restricted};await game.settings.registerMenu(U,d.tag,p)}),Hooks.on(D.RENDER_SCENE_CONTROLS,v.applyLeftControlsSettings),Hooks.on(D.RENDER_PLAYERS_LIST,Oe.applyPlayersListSettings),Hooks.on(D.RENDER_HOTBAR,()=>{v.firstLoad&&(v.firstLoad=!1,v.applyHotBarCollapse()),v.applyHotBarSettings()}),v.applyDebugSettings(),v.applyChatStyles(),v.applyBorderColors(),e.sceneNavMenu.fields.forEach(c=>{v.apply(e[c].tag)}),e.cameraDockMenu.fields.forEach(c=>{v.apply(e[c].tag)}),e.customFontsMenu.fields.forEach(c=>{v.applyCustomFonts(e[c].tag)}),e.leftControlsMenu.fields.forEach(c=>{v.applyLeftControlsSettings(e[c].tag)}),e.interfaceOptionsMenu.fields.forEach(c=>{f.log("TEST",[c,e]),v.apply(e[c].tag)})}static get(e,t=U){if(!e)return null;let n=!1;if(t===U)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,f.log("GET Setting",[a,n])}return n}static set(e,t,n=U){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),f.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s,i,l,c,d,p,y;const n=b();switch(t===void 0&&(t=v.get(e)),f.log("SettingsUtil.apply",[e,t,v.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:v.applyHotBarSettings();break;case n.collapseMacroBar.tag:v.applyHotBarCollapse();break;case n.playerListAvatars.tag:Oe.applyAvatars();break;case n.autoHidePlayerList.tag:Oe.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:v.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:v.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:_.currSettings.dockHeight=t,v.applyCameraHeight(t);break;case n.dockWidth.tag:_.currSettings.dockWidth=t,v.applyCameraWidth(t);break;case n.dockPosX.tag:_.currSettings.dockPosX=t,v.applyCameraPosX(t);break;case n.dockPosY.tag:_.currSettings.dockPosY=t,v.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:_.currSettings.defaultVideoWidth=t,_.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:_.currSettings.dockResizeOnUserJoin=t,_.applyDockResize(t);break;case n.chatBorderColor.tag:ht.chatBorderColor=v.get(n.chatBorderColor.tag),v.applyBorderColors();break;case n.enableChatStyles.tag:ht.enableChatStyles=v.get(n.enableChatStyles.tag),v.applyChatStyles();break;case n.enforceDarkMode.tag:v.resetFoundryThemeSettings();break;case n.debugMode.tag:v.applyDebugSettings();break;case n.navFoldersEnabled.tag:x.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:x.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:x.sceneClickToView=t,(a=ui.nav)==null||a.render(),(i=(s=game.scenes)==null?void 0:s.directory)==null||i.render();break;case n.useSceneIcons.tag:x.useSceneIcons=t,(l=ui.nav)==null||l.render(),(d=(c=game.scenes)==null?void 0:c.directory)==null||d.render();break;case n.useSceneBackButton.tag:x.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:x.useScenePreview=t,(y=ui.nav)==null||y.render();break;case n.navStartCollapsed.tag:x.navStartCollapsed=t;break;case n.showNavOnHover.tag:x.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:x.isCollapsed=v.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:v.applyThemeSettings();break;case n.customStyles.tag:v.applyCustomCSS();break;case n.adjustOtherModules.tag:v.applyModuleAdjustments();break;case n.otherModulesList.tag:v.applyOtherModulesList();break;case n.enablePlayerList.tag:Oe.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:x.applyCustomStyle(t);break;case n.enableMacroLayout.tag:qt.applyCustomStyle(t);break;case n.enableFloatingDock.tag:_.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:Bt.applyCustomStyle(t);break;case n.enableChatLogControls.tag:Ut.applyCustomStyle(t);break;case n.enableSceneControls.tag:Ht.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:Ht.applyFadeOut(t);break;case n.playerListFadeOut.tag:Oe.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:Bt.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:_.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:qt.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:Ut.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:x.applyFadeOut(t);break}}static applyBorderColors(){const e=b(),t=v.get(e.chatBorderColor.tag),n=document.querySelector("body");t===pt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===pt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=b(),t=v.get(e.enableChatStyles.tag),n=document.querySelector("body");f.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=b(),t=v.get(e.enableMacroLayout.tag);document.querySelector("body.crlngn-ui");const n=document.querySelector("#hotbar");n&&(t?n.classList.add("crlngn-macro"):n.classList.remove("crlngn-macro"))}static applyHotBarCollapse(){const e=b();v.get(e.collapseMacroBar.tag)}static applyLeftControlsSettings(e,t){const n=b();v.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),f.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:v.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=b(),t=v.get(e.controlsIconSize.tag);document.querySelector("body");const n=Rt[t]?Rt[t].size:Rt.regular.size;function o(a){switch(a){case Rt.large.name:return"var(--font-size-18);";case Rt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[n]),P.addCSSVars("--icon-font-size",o(t)),P.addCSSVars("--control-item-size",n),v.applyLeftControlsSettings()}static applySceneNavPos(e){const t=b();x.navPos=e||v.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=b(),n=v.get(t.dockPosX.tag),o=e||n;_.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=b(),n=v.get(t.dockPosY.tag),o=e||n;_.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=b(),n=v.get(t.dockWidth.tag),o=e||n;_.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=b(),n=v.get(t.dockHeight.tag),o=e||n;_.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=b(),o=n.customFontsMenu.fields,a={};switch(f.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=v.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:P.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:P.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:P.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:P.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var s,i;const e=b(),t=P.isModuleOn("monks-player-settings"),n=P.isModuleOn("force-client-settings"),o=v.get(e.enforceDarkMode.tag);if(o&&t){(s=game.user)!=null&&s.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),v.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),v.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","uiConfig")||null;if(f.log("resetFoundryThemeSettings",[a,game.settings]),o){const l={...a,colorScheme:{application:a.colorScheme.applications===""?"dark":a.colorScheme.applications,interface:a.colorScheme.interface===""?"dark":a.colorScheme.interface}};game.settings.set("core","uiConfig",l)}}static applyDebugSettings(e){const t=b();f.debugOn=e||v.get(t.debugMode.tag)}};ft=new WeakMap,I(v,ft,!1),m(v,"firstLoad",!0),m(v,"applyThemeSettings",e=>{const t=b(),n=e||v.get(t.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,n,v.get(t.colorTheme.tag)]),ze.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),m(v,"applyCustomCSS",e=>{const t=b(),n=e||v.get(t.customStyles.tag)||"";P.addCustomCSS(n)}),m(v,"applyModuleAdjustments",e=>{const t=b();(e||v.get(t.adjustOtherModules.tag)||!1)&&st.addModuleClasses()}),m(v,"applyOtherModulesList",e=>{const t=b(),n=e||v.get(t.otherModulesList.tag);f.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?v.set(t.adjustOtherModules.tag,!1):v.set(t.adjustOtherModules.tag,!0),st.addModuleClasses()}),m(v,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");h(v,ft)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),O(v,ft,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),O(v,ft,!0))});let E=v;class ua{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=b();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){f.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=E.get(e.lastUpdateId.tag);if(f.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),E.set(e.lastUpdateId.tag,n.id),f.log("checkForUpdates SUCCESS",[n.id])}catch(t){f.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}m(ua,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());class as{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return f.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Mn;const xt=class xt{static init(){Hooks.once(D.INIT,()=>{var n,o;document.querySelector("body").classList.add(U),(n=document.querySelector("#ui-middle"))==null||n.classList.add(U),f.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},E.registerSettings();const e=b(),t=E.get(e.disableUI.tag);if(f.log(D.INIT,[t]),t){document.querySelector("body").classList.remove(U),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(U);return}x.init(),_.init(),Ht.init(),Ut.init(),ht.init(),Bt.init(),Oe.init(),qt.init(),Hooks.on(D.RENDER_CHAT_MESSAGE,h(xt,Mn))}),Hooks.once(D.READY,()=>{f.log("Core Ready",[]);const e=b();var t=E.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),as.init(),Oe.applyPlayersListSettings(),st.init(),ua.init(),E.get(e.enableChatStyles.tag)&&xt.addCSSLocalization(),E.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";P.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),P.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),P.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),P.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),P.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),P.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),P.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),P.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),P.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),P.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Mn=new WeakMap,I(xt,Mn,(e,t)=>{f.log(D.RENDER_CHAT_MESSAGE,[e,t]),ht.enrichCard(e,t)});let ao=xt;ao.init();
//# sourceMappingURL=crlngn-ui.js.map
