var Mo=Object.defineProperty;var eo=s=>{throw TypeError(s)};var Ao=(s,e,t)=>e in s?Mo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>Ao(s,typeof e!="symbol"?e+"":e,t),Nn=(s,e,t)=>e.has(s)||eo("Cannot "+t);var m=(s,e,t)=>(Nn(s,e,"read from private field"),t?t.call(s):e.get(s)),T=(s,e,t)=>e.has(s)?eo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),I=(s,e,t,n)=>(Nn(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),Ee=(s,e,t)=>(Nn(s,e,"access private method"),t);var to=(s,e,t,n)=>({set _(o){I(s,e,o,t)},get _(){return m(s,e,n)}});const A={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_TOKEN_HUD:"renderTokenHUD"},q="crlngn-ui",Qt=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],pn=class pn{static log(e="",t=[],n=!1){try{const o=pn.debugOn;if(!(n||o))return;console.log(...Qt,e,...t)}catch{console.log(...Qt,e,...t)}}static warn(e="",t=[]){console.warn(...Qt,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Qt,e)}};h(pn,"debugOn",!1);let g=pn;const zo={select:"select",checkbox:"checkbox",text:"text",number:"number"},b={client:"client",world:"world"},vt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},ut={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Te={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},Ln=140,Ye=[{label:"Carolingian Teal",className:"crlngn-theme",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(130, 110, 160)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function L(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:b.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!1,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1},scope:b.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:b.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"crlngn-theme",adjustOtherModules:!0,otherModulesList:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player'",customStyles:""},scope:b.world,config:!1,requiresReload:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:ut.playerColor.name,useLeftChatBorder:!0},scope:b.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:b.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:b.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{dockResizeOnUserJoin:Te.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:b.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:b.client,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:b.client,config:!0,default:!1,requiresReload:!1},navFoldersEnabled:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},sceneNavItemWidth:{tag:"v2-scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,default:"",scope:b.client,config:!1,requiresReload:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:b.world,config:!1,requiresReload:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:b.world,config:!1,requiresReload:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,default:!0,scope:b.world,config:!1,requiresReload:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:b.world,config:!1,requiresReload:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:b.client,config:!1,requiresReload:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:b.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:b.world,config:!1,requiresReload:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:b.world,config:!1,requiresReload:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:b.world,config:!1,requiresReload:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:b.world,config:!1,requiresReload:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"crlngn-theme",scope:b.world,config:!1,requiresReload:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!0,scope:b.world,config:!1,requiresReload:!1},otherModulesList:{tag:"v2-other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Youtube Player":"'fvtt-youtube-player'"},scope:b.world,config:!1,requiresReload:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:b.world,config:!1,requiresReload:!1},chatBorderColor:{tag:"v2-chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:ut.playerColor.name,scope:b.client,config:!1,requiresReload:!0},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:zo.checkbox,default:!0,scope:b.client,config:!1,requiresReload:!1},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:b.client,config:!1,requiresReload:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:b.client,config:!1,requiresReload:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:b.client,config:!1,requiresReload:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:b.client,config:!1,requiresReload:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:Te.horizontal.name,scope:b.client,config:!1,requiresReload:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:b.client,config:!1,requiresReload:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:b.world,config:!1,default:"",requiresReload:!1},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},cameraDockFadeOut:{tag:"v2-camera-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:b.client,config:!1,requiresReload:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:b.client,config:!1,requiresReload:!0}}}const It=class It{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const i=o[a];if(i instanceof CSSFontFaceRule){const r=i.style.getPropertyValue("font-family");r&&(t.add(r),g.log("Found font-face rule:",[r]))}else if(i instanceof CSSImportRule){if(g.log("Found import rule:",[i.href]),i.styleSheet)await this.processStyleSheetRules(i.styleSheet,t);else if(i.href)try{const l=await(await fetch(i.href)).text();this.extractFontsFromCSSText(l,t)}catch(r){g.warn("Error fetching imported CSS:",[r])}}}}catch(o){if(o.name==="SecurityError"&&e.href){g.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const i=await(await fetch(e.href)).text();this.extractFontsFromCSSText(i,t)}catch(a){g.warn("Error fetching cross-origin stylesheet:",[a])}}else g.warn("Error accessing CSS rules:",[o])}}catch(o){g.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];g.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const i=/font-family\s*:\s*(['"])(.+?)\1/,r=a.match(i);if(r&&r[2]){const l=r[2].trim();t.add(l),g.log("Found font-face in CSS text:",[l])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return g.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!/FontAwesome|Font Awesome|FoundryVTT/.test(i)).map(i=>i.replace(/['"]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const S=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,S.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),i=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,i=o.indexOf("}"));const l=o.substring(a+16,i).split(";").map(S=>S.trim()).filter(S=>S!==""),c={};l.forEach(S=>{const E=S.split(":");if(E.length>=2){const N=E[0].trim(),D=E.slice(1).join(":").trim();N&&(c[N]=D)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const f=Object.entries(c).map(([S,E])=>`  ${S}: ${E};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+f+`
}`+o.substring(i+1);n.textContent=p,g.log("addCSSVars",[e,t,n.textContent])}static addCustomCSS(e,t=!0){let n=document.querySelector("#crlngn-ui-custom-css");if(!n){const o=document.querySelector("body");n=document.createElement("style"),n.id="crlngn-ui-custom-css",n.textContent="",o.appendChild(n)}if(!t){n.textContent+=e;return}n.textContent.includes(e)||(n.textContent+=e)}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const i=e.dataset.scrollAnimationId;i&&cancelAnimationFrame(Number(i));const r=n==="horizontal",l=r?e.scrollLeft:e.scrollTop,c=t-l;if(c===0)return a&&a(),null;const f=performance.now(),p=E=>{const N=E-f;if(N>=o){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const D=N/o,X=D<.5?2*D*D:1-Math.pow(-2*D+2,2)/2;r?e.scrollLeft=l+c*X:e.scrollTop=l+c*X;const se=requestAnimationFrame(p);return e.dataset.scrollAnimationId=se,se},S=requestAnimationFrame(p);return e.dataset.scrollAnimationId=S,S}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const o={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(g.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(o,n),foundry.applications.api.DialogV2.confirm(o)}};h(It,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));g.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i);g.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){const r=i.href||"",l=r.includes("css/")||r.includes("styles/"),c=r.includes("modules/crlngn-ui/"),f=r.includes("systems/");if(r&&!l&&!c&&!f){g.log("Skipping stylesheet:",[r]);continue}g.log("Processing stylesheet:",[i,r]),await It.processStyleSheetRules(i,o)}}catch(r){g.warn("Error processing stylesheet:",[r])}return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!/FontAwesome|Font Awesome|FoundryVTT/.test(i)).map(i=>i.replace(/['"]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))}),h(It,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let P=It;var ze,Pt,Mt;const G=class G{static init(){g.log("LeftControls - init",[]),Hooks.on(A.RENDER_SCENE_CONTROLS,G.initSceneControls),Hooks.on(A.ACTIVATE_SCENE_CONTROLS,G.onActivateSceneControls),window.addEventListener("resize",G.onActivateSceneControls),G.initSceneControls()}static applyFadeOut(e){G.useFadeOut=e,g.log("applyFadeOut",[e]),G.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls");G.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),g.log("handle FadeOut",[G.customStylesEnabled,G.useFadeOut])}static applyCustomStyle(e){var t;G.customStylesEnabled=e,g.log("applyCustomStyle",[G.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){I(G,ze,document.querySelector("#ui-left #controls")),I(G,Pt,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){g.log("initSceneControls",[]),G.resetLocalVars();const o=document.querySelector("#interface");G.customStylesEnabled?o==null||o.classList.add("crlngn-controls"):o==null||o.classList.remove("crlngn-controls"),G.handleFadeOut(e,t,n)}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!m(G,ze))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};I(G,Mt,new ResizeObserver(n=>{t(()=>G.updateCSSVars(),250)})),m(G,Mt).observe(m(G,ze),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!m(G,ze))return;let e=parseInt(m(G,Pt).offsetWidth),t=parseInt(m(G,ze).offsetWidth),n=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&P.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),g.log("onActivateSceneControls",[a,o.length,n.length])}};ze=new WeakMap,Pt=new WeakMap,Mt=new WeakMap,T(G,ze),T(G,Pt),T(G,Mt),h(G,"useFadeOut",!0),h(G,"customStylesEnabled",!0),h(G,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return g.log("Error loading navigation button templates:",[e]),!1}});let Ot=G;foundry.utils;const{ApplicationV2:qo,HandlebarsApplicationMixin:Go}=foundry.applications.api;var fo,ee,it,jn,ne,go,po,mo,zn,qn,ho;const O=class O extends Go(qo){constructor(){super(...arguments);h(this,"_onRender",(t,n)=>{L(),I(O,ee,this.element);const o=m(O,ee).querySelectorAll(".toggle-hint");g.log("_onRender",[t,n,this.element]),o.forEach(a=>{a.addEventListener("click",()=>{m(O,ee).querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))})}),O.handleCustomFontFields(),O.handleThemeAndStyleFields(),g.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),o=O.getRestrictedTabs();return game.user.isGM||o.forEach(a=>{delete n[a]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0],L(),n.themes=Ye;const o=await P.getAllFonts();return n.fontList=o,n}async _preparePartContext(t,n,o){var r;const a=await super._preparePartContext(t,n,o);t in n.tabs&&(a.tab=a.tabs[t]),L(),Gn();const i=O.getRestrictedTabs();switch(game.user.isGM||i.forEach(l=>{delete a.tabs[l]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const l=((r=O.PARTS[t])==null?void 0:r.menuKey)||null;if(l){const c=O.getMenuContext(l);if(c.fields&&(a.fields={...a.fields,...c.fields}),c.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...c.fieldDefaults}),c.fieldValues){if(t==="themes"){const f=Ye.find(p=>p.className===c.fieldValues.colorTheme);c.fieldValues.colorTheme=(f==null?void 0:f.label)||Ye[0].label}Object.assign(a,c.fieldValues)}}break}}return g.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var l;const n=L(),o=((l=n[t])==null?void 0:l.fields)||null;if(!o)return{};const a={},i={},r={};return o.forEach(c=>{if(n[c]){const f=w.get(n[c].tag);a[c]=n[c],i[c]=f!==void 0?f:n[c].default,r[c]=n[c].default}}),{fields:a,fieldValues:i,fieldDefaults:r}}static getRestrictedTabs(){const t=Gn(),n=[];return Object.entries(t).forEach((o,a)=>{o[0]!=="moduleSettingsMenu"&&o[1].restricted&&n.push(o[0])}),n}static updateSettings(t){let n=!1;const o=L(),r=m(O,ee).querySelector(".form-content.active").dataset.tab;if(I(O,it,r),!t)return;let l;t.object&&(l=foundry.utils.expandObject(t.object));const c=Ye.find(f=>f.label===l.colorTheme);return l.colorTheme=c?c.className:Ye[0].className,Object.entries(l).forEach(([f,p])=>{var S;if(l[f]!==void 0){const E=w.get(o[f].tag);w.set(o[f].tag,l[f]),(S=o[f])!=null&&S.requiresReload&&E!==l[f]&&(n=!0)}}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),n}changeTab(t,n,o){super.changeTab(t,n,o),I(O,it,t)}static handleCustomFontFields(){const t=m(O,ee).querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const i=a.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const l=()=>{var c;Ee(c=O,ne,zn).call(c),r.classList.add("active")};a.addEventListener("focus",l),a.addEventListener("click",l),a.addEventListener("keydown",Ee(O,ne,qn)),document.addEventListener("click",c=>{i.contains(c.target)||r.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",i=>{const r=a.closest(".dropdown-wrapper").querySelector("input");let l=a.dataset.value;l.includes(" ")&&!l.startsWith('"')?l=`"${l}"`:l.startsWith("&quot;")&&(l=l.replace(/&quot;/g,'"')),r.value=l;const c=a.closest(".dropdown-options");c.classList.remove("active"),g.log("handleCustomFontFields",[l,r,c])})})}static handleThemeAndStyleFields(){const t=m(O,ee).querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll('input[type="text"]:not([hidden])').forEach(l=>{const c=l.closest(".dropdown-wrapper"),f=c==null?void 0:c.querySelector(".dropdown-options");if(!c||!f)return;const p=()=>{var S;Ee(S=O,ne,zn).call(S),f.classList.add("active")};l.addEventListener("focus",p),l.addEventListener("click",p),l.addEventListener("keydown",Ee(O,ne,qn)),document.addEventListener("click",S=>{c.contains(S.target)||f.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(l=>{l.addEventListener("mouseenter",()=>{l.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(f=>f.classList.remove("highlighted")),l.classList.add("highlighted")}),l.addEventListener("click",function(c){var E,N,D;g.log("theme option",[l,l.querySelector(".theme-name")]);const f=(E=l.closest(".dropdown-wrapper"))==null?void 0:E.querySelector("input");let p=(N=l.querySelector(".theme-name"))==null?void 0:N.innerHTML.toString();if(f.value=p,f.name==="colorTheme"){const X=Ye.find(se=>se.label===p);Ee(D=O,ne,ho).call(D,X)}l.closest(".dropdown-options").classList.remove("active")})});const a=m(O,ee).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),i=m(O,ee).querySelector('input.otherModulesList[type="hidden"]');a.forEach(l=>{l.addEventListener("change",c=>{const f=c.currentTarget;let S=`${i.value}`.split(",")||[],E=S.indexOf(f.value);!c.currentTarget.checked&&E>-1?S.splice(E,1):c.currentTarget.checked&&E===-1&&S.push(f.value),i.value=S.join(","),g.log("checkbox changed",[S,i.value])})});const r=m(O,ee).querySelector("input.adjustOtherModules");r.addEventListener("change",l=>{const c=m(O,ee).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]');c.forEach(S=>{S.checked=l.currentTarget.checked;const E=new Event("change",{bubbles:!0});S.dispatchEvent(E)});const f=[],p=m(O,ee).querySelector('input.otherModulesList[type="hidden"]');c.forEach(S=>{S.checked&&f.push(S.value)}),p.value=f.join(","),f.length===0&&(r.checked=!1)})}};ee=new WeakMap,it=new WeakMap,jn=new WeakMap,ne=new WeakSet,go=async function(t,n,o){t.preventDefault(),t.stopPropagation(),O.updateSettings(o)&&P.confirmReload()},po=async function(t,n){const o=L(),i=m(O,ee).querySelector(".form-content.active"),r=i.dataset.tab,l=O.PARTS[r].menuKey,c=o[l].default;i.querySelectorAll("input, select").forEach(p=>{p.value=c[p.name],p.type==="checkbox"&&(p.checked=c[p.name])}),g.log("#onReset",[m(O,it),r,t,n])},mo=function(){const t=[];return Object.entries(O.PARTS).forEach(([n,o])=>{o.menuKey&&t.push({id:n,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${n}`})}),t},zn=function(){m(O,ee).querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},qn=function(t){const n=t.target.closest(".dropdown-wrapper"),o=n==null?void 0:n.querySelector(".dropdown-options"),a=o.classList.contains("active"),i=Array.from(o.querySelectorAll(".dropdown-option"));let r=i.findIndex(l=>l.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||o.classList.add("active"),i.forEach(l=>l.classList.remove("highlighted")),r===-1?r=t.key==="ArrowDown"?0:i.length-1:r=t.key==="ArrowDown"?(r+1)%i.length:(r-1+i.length)%i.length,i[r]&&(i[r].classList.add("highlighted"),i[r].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&r!==-1&&i[r]&&i[r].click()):t.key==="Escape"&&o.classList.remove("active")},ho=function(t){if(g.log("Selected theme updated:",[t]),!t)return;m(O,ee).querySelectorAll("span.selected-theme").forEach((o,a)=>{o.style.setProperty("background-color",t.colorPreview[a])})},T(O,ne),T(O,ee),T(O,it),T(O,jn),h(O,"selectedTheme"),h(O,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:700,height:"auto"},actions:{redefine:Ee(O,ne,po)},form:{handler:Ee(O,ne,go),closeOnSubmit:!0}}),h(O,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs"},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs"},controls:{menuKey:"leftControlsMenu",template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}}),h(O,"TABS",{primary:{initial:"interface",tabs:Ee(fo=O,ne,mo).call(fo),labelPrefix:""}});let An=O;function Gn(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:An,restricted:!1}}}var Xe,qe,At,zt,qt,Gt,Bt,xt,Ht,Ut,Je,Vt,Wt;const u=class u{static applyFadeOut(e){u.useFadeOut=e,u.cameraContainer&&u.cameraContainer.classList.toggle("faded-ui",e)}static applyCustomStyle(e){var t;u.enableFloatingDock=e,g.log("applyCustomStyle",["enableFloatingDock",e,u.enableFloatingDock,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=L();u.enableFloatingDock=w.get(e.enableFloatingDock.tag),u.currSettings={enableFloatingDock:u.enableFloatingDock,defaultVideoWidth:w.get(e.defaultVideoWidth.tag),dockHeight:w.get(e.dockHeight.tag),dockWidth:w.get(e.dockWidth.tag),dockPosX:w.get(e.dockPosX.tag),dockPosY:w.get(e.dockPosY.tag),dockResizeOnUserJoin:w.get(e.dockResizeOnUserJoin.tag)},u.enableFloatingDock?(u.positionIntervalId&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null),Hooks.on(A.RENDER_CAMERA_VIEWS,u.onRenderFloating),Hooks.on(A.RENDER_PLAYERS_LIST,u.onRenderPlayersList),Hooks.on(A.CLIENT_SETTING_CHANGED,t=>{g.log("Setting updated",[t]),t.includes("rtcClientSettings")&&u.checkMinimizedState()})):(Hooks.on(A.RENDER_CAMERA_VIEWS,u.onRenderPlain),u.onRenderPlain())}static onRenderPlain(e,t){var n;u.cameraContainer||(u.cameraContainer=document.querySelector("#av-holder")),(n=u.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){L();const o=u.currSettings,a=document.querySelector("#camera-views");if(u.cameraContainer=document.querySelector("#av-holder"),u.cameraContainer)u.cameraContainer.appendChild(a);else{const c=document.createElement("div");u.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}u.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const f=game.users.get(c.dataset.user),p=(f==null?void 0:f.color)||"";g.log("player color",[f,p]),c.style.setProperty("--player-color",p)}),g.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const l=game.settings.get("core","rtcClientSettings");(l==null?void 0:l.hideDock)!==!0?(u.checkMinimizedState(),u.applyDockResize(o.dockResizeOnUserJoin),u.makeDraggable(),u.makeResizeable(),u.applyVideoWidth(),u.resetPositionAndSize()):u.checkMinimizedState(),u.applyFadeOut(u.useFadeOut)}static onRenderPlayersList(){g.log("onRenderPlayersList")}static applyPositionWithDelay(){u.positionIntervalId&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null),u.resetPositionAndSize();let e=0;u.positionIntervalId=setInterval(()=>{u.resetPositionAndSize(),e++,e>=u.positionAttempts&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=L(),n=w.get(t.defaultVideoWidth.tag);let o=e||n;if(o<Ln)o=Ln,w.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){u.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),i=document.querySelector("#camera-views");!a&&i&&(i.parentNode.style.setProperty("--av-width",o+"px"),i.style.setProperty("--av-width",o+"px")),u.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){L();const a=u.currSettings;if(!u.enableFloatingDock||!u.cameraContainer)return;const i=game.settings.get("core","rtcClientSettings");if((i==null?void 0:i.hideDock)===!0){u.checkMinimizedState();return}if(g.log("CameraDock",[a]),!e&&!t&&!n&&!o){const r=a.dockPosX||0,l=a.dockPosY||0;if(u.cameraContainer.style.left=`${r}px`,u.cameraContainer.style.bottom=`${l}px`,u.currSettings.dockResizeOnUserJoin===Te.off.name){const c=a.dockWidth||0,f=a.dockHeight||0;u.cameraContainer.style.width=`${c}px`,u.cameraContainer.style.height=`${f}px`}}else e!==null&&(u.cameraContainer.style.left=`${e}px`),t!==null&&(u.cameraContainer.style.bottom=`${t}px`),u.currSettings.dockResizeOnUserJoin===Te.horizontal.name?n!==null&&(u.cameraContainer.style.width=`${n}px`):u.currSettings.dockResizeOnUserJoin===Te.vertical.name&&o!==null&&(u.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=u.cameraContainer)==null||e.addEventListener("mousedown",n=>{var l,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(g.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(l=n.target.parentNode)!=null&&l.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",m(u,xt)),a==null||a.addEventListener("mouseup",m(u,Ht)),o))return;const i=P.getOffsetBottom(u.cameraContainer);let r=((c=u.cameraContainer)==null?void 0:c.offsetLeft)||0;u.isDragging=!0,I(u,Xe,n.clientX-r),I(u,qe,window.innerHeight-n.clientY-i),n.preventDefault(),n.stopPropagation()}),(t=u.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,f;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",m(u,Ut)),a.addEventListener("touchend",m(u,Je)),a.addEventListener("touchcancel",m(u,Je)),o))return;const i=n.touches[0],r=P.getOffsetBottom(u.cameraContainer);let l=((f=u.cameraContainer)==null?void 0:f.offsetLeft)||0;u.isDragging=!0,I(u,Xe,i.clientX-l),I(u,qe,window.innerHeight-i.clientY-r),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var l,c;if(!u.cameraContainer)return;const e=L(),t=u.currSettings.dockResizeOnUserJoin,n=u.currSettings.defaultVideoWidth||Ln,a=(((c=(l=game.webrtc)==null?void 0:l.users)==null?void 0:c.filter(f=>f.active&&f.canBroadcastVideo))||[]).length;if(a===0)return;if(t===Te.horizontal.name){const f=n*a+16;u.cameraContainer.style.width=`${f}px`}else if(t===Te.vertical.name){const f=n*a+16;u.cameraContainer.style.height=`${f}px`}const i=parseInt(u.cameraContainer.style.width||0),r=parseInt(u.cameraContainer.style.height||0);i>0&&w.set(e.dockWidth.tag,i),r>0&&w.set(e.dockHeight.tag,r)}static applyDockResize(e=null){if(!u.cameraContainer)return;e?u.currSettings.dockResizeOnUserJoin=e:e=u.currSettings.dockResizeOnUserJoin,u.cameraContainer.classList.remove("horizontal"),u.cameraContainer.classList.remove("vertical");const t=u.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===Te.horizontal.name?u.cameraContainer.classList.add("horizontal"):e===Te.vertical.name&&u.cameraContainer.classList.add("vertical"),u.updateDockSize()}static makeResizeable(){if(u.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=u.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),u.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),u.isResizing=!0,I(u,At,o.clientX),I(u,zt,o.clientY),I(u,Bt,parseInt(getComputedStyle(u.cameraContainer).bottom)||0),I(u,qt,u.cameraContainer.offsetWidth),I(u,Gt,u.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(u,Vt)),e==null||e.addEventListener("mouseup",m(u,Wt))})}}static checkMinimizedState(){if(!u.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),g.log("Checking minimized state",[e,t]),u.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=u.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!u.cameraContainer)return;if(g.log("handleMinimizedState",[e]),e)u.cameraContainer.parentNode!==t&&(u.originalParent=u.cameraContainer.parentNode,t.prepend(u.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!u.originalParent)return;u.originalParent.prepend(u.cameraContainer),u.makeDraggable(),u.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),g.log("Restored camera position from settings",[u.currSettings])}const o=(a=u.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};Xe=new WeakMap,qe=new WeakMap,At=new WeakMap,zt=new WeakMap,qt=new WeakMap,Gt=new WeakMap,Bt=new WeakMap,xt=new WeakMap,Ht=new WeakMap,Ut=new WeakMap,Je=new WeakMap,Vt=new WeakMap,Wt=new WeakMap,T(u,Xe,0),T(u,qe,0),h(u,"isDragging",!1),h(u,"cameraContainer"),h(u,"isResizing",!1),T(u,At,0),T(u,zt,0),T(u,qt,0),T(u,Gt,0),T(u,Bt,0),h(u,"currSettings",{}),h(u,"positionIntervalId",null),h(u,"positionAttempts",5),h(u,"useFadeOut",!0),h(u,"enableFloatingDock",!0),T(u,xt,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!u.isDragging||t)){if(g.log("mousemove",[window.innerHeight,e.clientY,m(u,qe)]),u.cameraContainer){let n=e.clientX-m(u,Xe),o=window.innerHeight-e.clientY-m(u,qe);n+u.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-u.cameraContainer.offsetWidth),n<0&&(n=0),u.cameraContainer.style.left=`${n}px`,o+u.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-u.cameraContainer.offsetHeight),u.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(u,Ht,e=>{var a,i;const t=L(),n={...u.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(u.isDragging&&!o){const r=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=u.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((i=u.cameraContainer)==null?void 0:i.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),w.set(t.dockPosX.tag,n.dockPosX),w.set(t.dockPosY.tag,n.dockPosY),r==null||r.removeEventListener("mousemove",m(u,xt)),r==null||r.removeEventListener("mouseup",m(u,Ht)),u.isDragging=!1,e.stopPropagation()}}),T(u,Ut,e=>{if(!(!u.isDragging||!e.touches[0])){if(u.cameraContainer){const t=e.touches[0];let n=t.clientX-m(u,Xe),o=window.innerHeight-t.clientY-m(u,qe);n+u.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-u.cameraContainer.offsetWidth),n<0&&(n=0),u.cameraContainer.style.left=`${n}px`,o+u.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-u.cameraContainer.offsetHeight),u.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(u,Je,e=>{var o,a;const t=L(),n={...u.currSettings};if(u.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=u.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=u.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),w.set(t.dockPosX.tag,n.dockPosX),w.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("touchmove",m(u,Ut)),i==null||i.removeEventListener("touchend",m(u,Je)),i==null||i.removeEventListener("touchcancel",m(u,Je)),u.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),T(u,Vt,e=>{if(!u.isResizing)return;const t=m(u,qt)+(e.clientX-m(u,At)),n=e.clientY-m(u,zt),o=m(u,Gt)+n,a=m(u,Bt)-n;u.cameraContainer.style.width=`${t}px`,u.cameraContainer.style.height=`${o}px`,u.cameraContainer.style.bottom=`${a}px`}),T(u,Wt,()=>{var o,a,i,r,l,c,f;const e=L(),t={...u.currSettings},n=document.querySelector("body.crlngn-ui");u.isResizing=!1,n==null||n.removeEventListener("mousemove",m(u,Vt)),n==null||n.removeEventListener("mouseup",m(u,Wt)),g.log("onStopResize",[(o=u.cameraContainer)==null?void 0:o.style.width,(a=u.cameraContainer)==null?void 0:a.style.height,(i=u.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((r=u.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=u.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=u.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((f=u.cameraContainer)==null?void 0:f.style.left)||0),w.set(e.dockWidth.tag,t.dockWidth),w.set(e.dockHeight.tag,t.dockHeight),w.set(e.dockPosY.tag,t.dockPosY),w.set(e.dockPosX.tag,t.dockPosX)});let _=u;const J=class J{static init(){Hooks.on(A.RENDER_SIDE_BAR,J.onRender),Hooks.on(A.COLLAPSE_SIDE_BAR,J.onRender),Hooks.on(A.READY,J.onRender)}static applyFadeOut(e){J.useFadeOut=e,J.handleFadeOut()}static applyCustomStyle(e){var t;J.customStylesEnabled=e,g.log("applyCustomStyle",[J.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||J.addChatToggle(o),J.handleFadeOut(e,o,n)}static handleFadeOut(e,t,n){g.log("handle FadeOut, ChatLogControls",[J.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");t?t.querySelector("#roll-privacy"):document.querySelector("#ui-right #roll-privacy"),J.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}};h(J,"useFadeOut",!0),h(J,"customStylesEnabled",!0),h(J,"addChatToggle",async e=>{if(!J.customStylesEnabled)return;const t=await renderTemplate(`modules/${q}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t);const o=n.querySelector("button[data-action=toggleChat]");o.addEventListener("click",J.onToggleChatBox);const a=game.user.getFlag(q,"chatBoxHidden");if(a!==void 0){g.log("Applying saved chat box state",[a]);const i=document.querySelector("#chat-notifications");a?(o.classList.remove("fa-comment-slash"),o.classList.add("fa-comment"),i.classList.add("input-hidden"),P.addCSSVars("--chat-input-height","0px")):(o.classList.add("fa-comment-slash"),o.classList.remove("fa-comment"),i.classList.remove("input-hidden"),P.addCSSVars("--chat-input-height","100px"))}}),h(J,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");let o=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),P.addCSSVars("--chat-input-height","0px"),o=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),P.addCSSVars("--chat-input-height","100px"),o=!1),game.user.setFlag(q,"chatBoxHidden",o),g.log("Chat box state saved to flag",[o])});let Ft=J;const ge=class ge{static init(){const e=L();ge.enableChatStyles=w.get(e.enableChatStyles.tag),ge.chatBorderColor=w.get(e.chatBorderColor.tag),ge.useLeftChatBorder=w.get(e.useLeftChatBorder.tag)}};h(ge,"chatBorderColor"),h(ge,"enableChatStyles"),h(ge,"useLeftChatBorder"),h(ge,"enrichCard",async(e,t)=>{var i,r,l,c,f,p,S,E;g.log("renderChatMessage",[ge.chatBorderColor,ge.enableChatStyles,ut.playerColor.name,(i=e.author)==null?void 0:i.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((S=(p=(f=e.flags)==null?void 0:f.dnd5e)==null?void 0:p.roll)==null?void 0:S.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn"),ge.useLeftChatBorder&&o.classList.add("left-border");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(N=>{const D=N.querySelector(".visible-dc"),X=N.querySelector(".hidden-dc");g.log("enrichCard",[D,X]),D.setAttribute("data-ability",N.getAttribute("data-ability")||""),D.setAttribute("data-dc",N.getAttribute("data-dc")||""),X.setAttribute("data-ability",N.getAttribute("data-ability")||"")}),ge.chatBorderColor===ut.playerColor.name&&((E=e.author)!=null&&E.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let _e=ge;const x=class x{static init(){this.preloadTemplates(),Hooks.on(A.RENDER_HOTBAR,x.onRender)}static applyFadeOut(e){x.useFadeOut=e,x.handleFadeOut()}static onRender(e,t,n){g.log("MacroHotbar onRender",[x.customStylesEnabled]),x.applyCustomStyle(x.customStylesEnabled),x.handleFadeOut(e,t,n),x.addCollapseButton(),x.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(q,"hotbarCollapsed");x.applyHotBarCollapse(!t)}static handleOpenDirectory(e){g.log("open directory")}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");x.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static applyCustomStyle(e){const t=L();x.customStylesEnabled=e!==void 0?e:w.get(t.enableMacroLayout.tag),g.log("applyCustomStyle",[x.customStylesEnabled]),x.applyHotBarLayout()}static applyHotBarLayout(){const e=document.querySelector("#hotbar");e&&(x.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};h(x,"useFadeOut",!0),h(x,"customStylesEnabled",!0),h(x,"macroStartCollapsed",!1),h(x,"preloadTemplates",async()=>{try{const e=[`modules/${q}/templates/macro-buttons.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),h(x,"addCollapseButton",async()=>{const e=document.querySelector("#hotbar #hotbar-controls-right");if(!e)return;game.user.getFlag(q,"hotbarCollapsed");const t=await renderTemplate(`modules/${q}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const n=e.querySelector("button[data-action=collapse]"),o=e.querySelector("button[data-action=openDirectory]");n==null||n.addEventListener("click",x.handleCollapse),o==null||o.addEventListener("click",x.handleOpenDirectory)}),h(x,"applyHotBarCollapse",async e=>{const t=L();x.macroStartCollapsed=e!==void 0?e:w.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(q,"hotbarCollapsed",x.macroStartCollapsed);const n=document.querySelector("#hotbar #hotbar-controls-right"),o=n==null?void 0:n.querySelector("button[data-action=collapse]"),a=document.querySelector("#hotbar");x.macroStartCollapsed&&a?(a.classList.add("collapsed"),o&&(o.classList.remove("fa-angle-down"),o.classList.add("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipKeepOpen"))):(a==null||a.classList.remove("collapsed"),o&&(o.classList.add("fa-angle-down"),o.classList.remove("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipAutoHide")))});let Re=x;var mn;const K=class K{static init(){g.log("PlayersList init",[],!0),Hooks.on(A.RENDER_PLAYERS_LIST,K.onRender)}static applyFadeOut(e){K.useFadeOut=e,K.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");I(K,mn,setTimeout(()=>{g.log("handleFadeOut - PlayersList",[o,K.useFadeOut]),K.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),ft.handleYTPlayerFadeOut()},500))}static applyCustomStyle(e){K.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){g.log("PlayersList onRender",[e,t,n]),L();const o=t||document.querySelector("#players");K.customStylesEnabled?o==null||o.classList.add("crlngn-ui"):o==null||o.classList.remove("crlngn-ui"),K.applyPlayersListSettings(),K.applyAvatars(),K.handleFadeOut(e,o,n)}static applyPlayersListSettings(){var t,n;const e=L();g.log("applyPlayersListSettings",[w.get(e.autoHidePlayerList.tag)]),w.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized")}static applyAvatars(){const e=L();g.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(i=>i.active===!0),o=game.users.filter(i=>i.active===!1),a=[...n,...o];w.get(e.playerListAvatars.tag)&&K.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),a.forEach(i=>{var p;const r=t==null?void 0:t.querySelector(`li[data-user-id='${i.id}']`),l=game.users.get(i.id),c=((p=l.character)==null?void 0:p.img)||"";g.log("player",[l]);const f=document.createElement("img");f.src=c||l.avatar||"",f.alt="*",f.classList.add("crlngn-avatar"),r&&r.prepend(f)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const l=r.querySelector("img.crlngn-avatar");l==null||l.remove()}),t==null||t.classList.remove("crlngn-avatars"))}};mn=new WeakMap,T(K,mn),h(K,"useFadeOut",!0),h(K,"customStylesEnabled",!0),h(K,"playerListAvatars",!0);let be=K;var Yn,jt,rt;const Q=class Q{static init(){P.isModuleOn("foundry-taskbar")&&Hooks.on(A.UPDATE_USER,Q.checkTaskbarLock),Q.checkTaskbarLock(),Q.addModuleClasses(),P.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),Hooks.on(A.CLIENT_SETTING_CHANGED,n=>{n.includes("fvtt-youtube-player.windowPosition")&&Q.handleYTPlayerFadeOut()}),I(Q,rt,0),I(Q,jt,setInterval(()=>{(document.querySelector("#sidebar-video-player")||m(Q,rt)>=10)&&(clearInterval(m(Q,jt)),Q.handleYTPlayerFadeOut()),to(Q,rt)._++},200))}static handleYTPlayerFadeOut(){var n,o;const e=P.isModuleOn("fvtt-youtube-player"),t=document.querySelector("#sidebar-video-player.tyw-docked");g.log("handleYTPlayerFadeOut",[e,be.useFadeOut,t],!0),e&&t&&be.useFadeOut?(n=document.querySelector("#sidebar-video-player.tyw-docked"))==null||n.classList.add("faded-ui"):e&&((o=document.querySelector("#sidebar-video-player"))==null||o.classList.remove("faded-ui"))}};Yn=new WeakMap,jt=new WeakMap,rt=new WeakMap,T(Q,Yn),T(Q,jt),T(Q,rt,0),h(Q,"addModuleClasses",()=>{const e=L(),t=w.get(e.otherModulesList.tag)||"",n=t.split(",");g.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),h(Q,"checkTaskbarLock",()=>{var a,i,r;const e=P.isModuleOn("foundry-taskbar");g.log("checkTaskbarLock #1",[e]);const t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");g.log("checkTaskbarLock #2",[t,n]),(i=t.taskbarSettings)!=null&&i.locked?P.addCSSVars("--crlngn-margin-bottom",n?"50px":"0px"):P.addCSSVars("--crlngn-margin-bottom",n?"10px":"0px"),(r=t.taskbarSettings)!=null&&r.locked?P.addCSSVars("--crlngn-taskbar-height","50px"):P.addCSSVars("--crlngn-taskbar-height","10px"),P.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML="")});let ft=Q;var V,Yt,Ke,$n,lt,Ze,Qe,$t,Xn,Xt,ye,ct,Ge,Se,hn,yn,Sn;const d=class d{static applyFadeOut(e){d.useFadeOut=e,g.log("applyFadeOut",[e]),d.handleSceneFadeOut()}static applyCustomStyle(e){d.sceneNavEnabled=e,g.log("applyCustomStyle - TopNavigation",[d.sceneNavEnabled,ui.nav])}static resetLocalVars(){I(d,V,document.querySelector("#scene-navigation")),I(d,lt,document.querySelector("#scene-navigation-expand")),I(d,Ze,document.querySelector("#ui-left")),I(d,Yt,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;g.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),d.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),d.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):d.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleBackButton(e,t,n){if(L(),g.log("handleBackButton",[e,t,n]),d.useSceneBackButton){if(game.scenes.size<2)return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",m(d,hn)),o.prepend(a)}else{const o=document.querySelector("#crlngn-back-button");t.classList.add("no-back-button"),o&&o.remove()}}static handleFolderList(e,t,n){L(),d.navFoldersEnabled&&at.addFolderButtons(e,t,n)}static handleNavState(){L(),m(d,Xt)&&(I(d,Xt,!1),d.toggleNav(d.navStartCollapsed))}static toggleNav(e){clearTimeout(m(d,$t)),I(d,$t,setTimeout(()=>{d.resetLocalVars(),e===!0?(ui.nav.collapse(),d.isCollapsed=!0,g.log("toggleNav collapse",[ui.nav.collapse,e,d.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove())):e===!1&&(d.isCollapsed=!1,ui.nav.expand(),g.log("toggleNav expand",[e,d.navStartCollapsed]))},300))}static checkSceneNavCompat(){L(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=m(d,V))==null||e.addEventListener("mouseenter",n=>{if(g.log("TopNavigation mouseenter",[d.isCollapsed,d.showNavOnHover]),!d.isCollapsed||!d.showNavOnHover)return;n.stopPropagation(),clearTimeout(m(d,Ke)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=m(d,V))==null||t.addEventListener("mouseleave",n=>{g.log("TopNavigation mouseleave",[]),!(!d.isCollapsed||!d.showNavOnHover)&&(n.stopPropagation(),I(d,Ke,setTimeout(()=>{clearTimeout(m(d,Ke)),I(d,Ke,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const i=L();if(!m(d,V))return;const r=((o=m(d,V))==null?void 0:o.querySelectorAll("li.nav-item"))||[],l=0,c=e!==null?e:d.navPos||0,f=(a=m(d,V))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!f)return;const p=r[c],S=f.offsetWidth||0,E=parseInt(S)*c;g.log("setNavPosition",["position",c,E,m(d,V).scrollWidth]);const N=E-l;if(N>m(d,V).scrollWidth)return;d.navPos=c,w.set(i.sceneNavPos.tag,c),t?P.smoothScrollTo(m(d,V),N,"horizontal",n):m(d,V).scrollTo({left:N,behavior:"instant"})}catch(i){g.log("setNavPosition",["Error:",i]),console.error("Error in setNavPosition:",i)}}};V=new WeakMap,Yt=new WeakMap,Ke=new WeakMap,$n=new WeakMap,lt=new WeakMap,Ze=new WeakMap,Qe=new WeakMap,$t=new WeakMap,Xn=new WeakMap,Xt=new WeakMap,ye=new WeakMap,ct=new WeakMap,Ge=new WeakMap,Se=new WeakMap,hn=new WeakMap,yn=new WeakMap,Sn=new WeakMap,T(d,V),T(d,Yt),T(d,Ke),T(d,$n),T(d,lt),T(d,Ze),h(d,"sceneFoldersTemplate"),h(d,"navButtonsTemplate"),T(d,Qe),T(d,$t),T(d,Xn),T(d,Xt,!0),T(d,ye,null),T(d,ct,null),T(d,Ge,""),T(d,Se,[]),h(d,"useFadeOut",!0),h(d,"sceneNavEnabled"),h(d,"navFoldersEnabled"),h(d,"navFoldersForPlayers"),h(d,"navShowRootFolders"),h(d,"navStartCollapsed"),h(d,"showNavOnHover"),h(d,"useSceneIcons"),h(d,"useScenePreview"),h(d,"useSceneBackButton"),h(d,"sceneClickToView"),h(d,"isCollapsed"),h(d,"navPos"),h(d,"init",()=>{const e=L();Hooks.on(A.RENDER_SCENE_NAV,d.onRender),d.navStartCollapsed=w.get(e.navStartCollapsed.tag),d.showNavOnHover=w.get(e.showNavOnHover.tag),d.sceneNavEnabled=w.get(e.sceneNavEnabled.tag),d.useScenePreview=w.get(e.useScenePreview.tag),d.navFoldersEnabled=w.get(e.navFoldersEnabled.tag),d.navFoldersForPlayers=w.get(e.navFoldersForPlayers.tag),d.isCollapsed=d.navStartCollapsed,g.log("SCENE NAV INIT",[d.sceneNavEnabled],!0);const t=document.querySelector("body");d.sceneNavEnabled?t.classList.add("crlngn-scene-nav"):t.classList.remove("crlngn-scene-nav"),d.sceneNavEnabled&&(d.checkSceneNavCompat(),d.preloadTemplates(),at.init(),Hooks.on(A.READY,()=>{d.handleSceneFadeOut(),P.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42)}),Hooks.on(A.COLLAPSE_SIDE_BAR,n=>{g.log(A.COLLAPSE_SIDE_BAR,[n]),n&&d.checkSideBar(n.expanded),d.placeNavButtons()}),Hooks.on(A.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(m(d,Qe)),d.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(i=>i.remove()),I(d,Qe,setTimeout(()=>{d.setCollapsedClass(o)},250))}),ui.sidebar&&d.checkSideBar(ui.sidebar.expanded),d.placeNavButtons()),Hooks.on(A.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(A.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(A.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(A.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==m(d,Se)[m(d,Se).length-1]&&m(d,Se).push(n),d.handleSceneFadeOut()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,n=>{g.log(A.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(i=>{var l,c;const r=game.scenes.get(i.dataset.entryId);if(g.log(A.RENDER_SCENE_DIRECTORY,["directoryScenes",i.dataset.entryId,d.sceneClickToView]),d.sceneClickToView&&(i.addEventListener("dblclick",d.onActivateScene),i.addEventListener("click",d.onSelectScene)),d.useSceneIcons&&r&&((l=game.user)!=null&&l.isGM)){let f=document.createElement("i");f.classList.add("fas"),f.classList.add("icon"),r.ownership.default!==0?(r.active&&(f.classList.add("fa-bullseye"),i.prepend(f)),((c=game.scenes.current)==null?void 0:c.id)===r.id&&(f.classList.add("fa-star"),i.prepend(f))):(f.classList.add("fa-eye-slash"),i.prepend(f))}})})}),h(d,"onRender",(e,t,n)=>{const o=L(),a=w.get(o.sceneNavPos.tag);g.log("onRender - "+A.RENDER_SCENE_NAV,[t],!0),d.resetLocalVars(),d.sceneNavEnabled&&(d.handleBackButton(e,t,n),d.handleSceneList(e,t,n),d.handleFolderList(e,t,n),d.setNavPosition(a,!1),d.handleNavState()),d.addSceneListeners(t),d.addListeners(),d.resetLocalVars(),d.sceneNavEnabled&&d.navShowRootFolders&&(at.init(),at.renderFolderList()),d.sceneNavEnabled&&(clearTimeout(m(d,Qe)),I(d,Qe,setTimeout(()=>{g.log("NAV no transition remove"),d.placeNavButtons()},500))),d.handleSceneFadeOut(e,t,n)}),h(d,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(m(d,Ze).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),P.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(m(d,Ze).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),d.placeNavButtons(),P.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),h(d,"checkSideBar",e=>{d.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),h(d,"handleSceneList",async(e,t,n)=>{var o,a;if(d.sceneNavEnabled){g.log("handleSceneList",[e,t,n]);const i=t.querySelectorAll(".scene-navigation-menu li.scene");for(const r of i){const l=r.dataset.sceneId;if(d.useScenePreview){const c=game.scenes.find(p=>p.id===l);c.isGM=(o=game.user)==null?void 0:o.isGM;const f=await renderTemplate(`modules/${q}/templates/scene-nav-preview.hbs`,c);if(g.log("sceneData",[c]),r.classList.add("nav-item"),r.insertAdjacentHTML("beforeend",f),c.isGM&&m(d,Ge)===l){const p=new MouseEvent("mouseenter");r.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&d.addPreviewIconListeners(r,c)}d.useSceneIcons&&(r.classList.contains("active")||r.classList.contains("view"))&&r.classList.add("crlngn")}}if(d.sceneNavEnabled&&game.scenes.size>1){const i=t.querySelector("#scene-navigation-expand"),r=document.querySelector("#ui-left-column-2"),l=document.querySelector("#crlngn-scene-navigation-expand");l&&l.remove();let c=i==null?void 0:i.cloneNode(!0);c&&(c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{i.click()})),g.log("toggle events",[e,c]),r.prepend(c)}}),T(d,hn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=m(d,Se).length,n=m(d,Se)[t-2];let o;g.log("#onBackButton before",[t,n,m(d,Se)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),m(d,Se).pop()),g.log("#onBackButton after",[m(d,Se)])}),h(d,"placeNavButtons",async()=>{var l;const e=document.querySelector("#scene-navigation");if(!e)return;e.querySelector("#scene-navigation-inactive");let t=document.querySelectorAll("button.crlngn-btn");const n=((l=m(d,lt))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(g.log("placeNavButtons *",[d.isCollapsed,o,t]),!o||d.isCollapsed||m(d,Ze).classList.contains("navigation-collapsed")){t.forEach(c=>{g.log("placeNavButtons remove",[c.remove,c]),c.remove()}),t=[];return}if(t.length>0)return;const a=await renderTemplate(`modules/${q}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const i=document.querySelector("#ui-left button.crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-left button.crlngn-btn.ui-nav-right");i&&i.addEventListener("click",m(d,yn)),r&&r.addEventListener("click",m(d,Sn))}),T(d,yn,async e=>{const t=await d.getItemsPerPage(),n=d.navPos||0;if(!m(d,Yt)||!m(d,V))return;let o=n-(t-1);g.log("onNavLast",["pos",o,m(d,V).scrollWidth]),o=o<0?0:o,d.setNavPosition(o)}),T(d,Sn,async e=>{var c,f;const t=await d.getItemsPerPage(),n=d.navPos||0,o=(c=m(d,V))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,i=((f=m(d,V))==null?void 0:f.scrollWidth)||0;if(!a||!m(d,V))return;let r=n+(t-1),l=r*a;g.log("onNavNext",["pos",n,r,o==null?void 0:o.offsetWidth,l,i]),l>=i&&(r=Math.floor(i/a)),d.setNavPosition(r)}),h(d,"getItemsPerPage",async()=>{var e,t;try{g.log("getItemsPerPage",["Starting"]),d.resetLocalVars();const n=0,o=0,a=((e=m(d,lt))==null?void 0:e.offsetWidth)||0,i=(t=m(d,V))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!i||!m(d,V))return g.log("getItemsPerPage",["No scene items found"]),0;const r=i.offsetWidth,l=m(d,V).offsetWidth;if(!l)return g.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((l-a*2)/r);return g.log("getItemsPerPage",["Calculated:",c,l,r]),c||0}catch(n){return g.log("getItemsPerPage",["Error:",n]),g.error("Error in getItemsPerPage:",n),0}}),h(d,"preloadTemplates",async()=>{try{const e=[`modules/${q}/templates/scene-nav-buttons.hbs`,`modules/${q}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),h(d,"getCurrScenePosition",async e=>{try{if(!m(d,V)||!e)return 0;const t=await d.getItemsPerPage()||1,n=m(d,V).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(a===-1)return 0;const i=a>=d.navPos&&a<=d.navPos+t,r=i?d.navPos:a;return g.log("getCurrScenePosition",["Final position:",r,"isVisible:",i]),r}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),h(d,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);g.log("onActivateScene",[o,a]),a.activate(),m(d,ye)&&(clearTimeout(m(d,ye)),I(d,ye,null))}),h(d,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(I(d,Ge,""),g.log("onSelectScene",[a,t,n]),a&&a.sheet){const i=a.sheet.render;g.log("onSelectScene - originalRender",[i]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=i},250)}m(d,ye)&&(clearTimeout(m(d,ye)),I(d,ye,null)),I(d,ye,setTimeout(()=>{a.view(),I(d,ye,null)},250))}),h(d,"onScenePreviewOn",e=>{if(e.stopPropagation(),e.preventDefault(),!d.showNavOnHover)return;const t=e.currentTarget,n=t.dataset;I(d,Ge,n.sceneId),I(d,ct,setTimeout(()=>{clearTimeout(m(d,ct)),t.querySelector(".scene-preview").classList.add("open")},200)),g.log("onScenePreviewOn",[m(d,Ge)])}),h(d,"onScenePreviewOff",e=>{if(e.stopPropagation(),e.preventDefault(),clearTimeout(m(d,ct)),!d.showNavOnHover)return;const t=e.currentTarget;I(d,Ge,""),g.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),h(d,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",d.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",d.onActivateScene),d.useScenePreview?(n.addEventListener("mouseenter",d.onScenePreviewOn),n.addEventListener("mouseleave",d.onScenePreviewOff)):(n.removeEventListener("mouseenter",d.onScenePreviewOn),n.removeEventListener("mouseleave",d.onScenePreviewOff))})}),h(d,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const f=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!f}),g.log("Toggled global illumination",[!f])});const i=o.querySelector(".token-vision");i&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const f=n.tokenVision;await n.update({tokenVision:!f}),g.log("Toggled token vision",[!f])});const r=o.querySelector(".sound");r&&n.playlistSound&&r.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const f=n.playlistSound;if(f){const p=f.sound.playing;p?await f.sound.pause():await f.sound.play(),ui.nav.render(),g.log("Toggled playlist sound",[!p])}});const l=o.querySelector(".config");l&&l.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),g.log("Opened scene configuration")})});let B=d;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function no(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable})),t.push.apply(t,n)}return t}function Le(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?no(Object(t),!0).forEach(function(n){Bo(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):no(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}function on(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?on=function(e){return typeof e}:on=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(s)}function Bo(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function ke(){return ke=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},ke.apply(this,arguments)}function xo(s,e){if(s==null)return{};var t={},n=Object.keys(s),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=s[o]);return t}function Ho(s,e){if(s==null)return{};var t=xo(s,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(s,n)&&(t[n]=s[n])}return t}var Uo="1.15.6";function Ie(s){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(s)}var Oe=Ie(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Jt=Ie(/Edge/i),oo=Ie(/firefox/i),Nt=Ie(/safari/i)&&!Ie(/chrome/i)&&!Ie(/android/i),Jn=Ie(/iP(ad|od|hone)/i),yo=Ie(/chrome/i)&&Ie(/android/i),So={capture:!1,passive:!1};function z(s,e,t){s.addEventListener(e,t,!Oe&&So)}function M(s,e,t){s.removeEventListener(e,t,!Oe&&So)}function cn(s,e){if(e){if(e[0]===">"&&(e=e.substring(1)),s)try{if(s.matches)return s.matches(e);if(s.msMatchesSelector)return s.msMatchesSelector(e);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(e)}catch{return!1}return!1}}function vo(s){return s.host&&s!==document&&s.host.nodeType?s.host:s.parentNode}function ve(s,e,t,n){if(s){t=t||document;do{if(e!=null&&(e[0]===">"?s.parentNode===t&&cn(s,e):cn(s,e))||n&&s===t)return s;if(s===t)break}while(s=vo(s))}return null}var ao=/\s+/g;function ue(s,e,t){if(s&&e)if(s.classList)s.classList[t?"add":"remove"](e);else{var n=(" "+s.className+" ").replace(ao," ").replace(" "+e+" "," ");s.className=(n+(t?" "+e:"")).replace(ao," ")}}function R(s,e,t){var n=s&&s.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(s,""):s.currentStyle&&(t=s.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function st(s,e){var t="";if(typeof s=="string")t=s;else do{var n=R(s,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(s=s.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function bo(s,e,t){if(s){var n=s.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Ne(){var s=document.scrollingElement;return s||document.documentElement}function $(s,e,t,n,o){if(!(!s.getBoundingClientRect&&s!==window)){var a,i,r,l,c,f,p;if(s!==window&&s.parentNode&&s!==Ne()?(a=s.getBoundingClientRect(),i=a.top,r=a.left,l=a.bottom,c=a.right,f=a.height,p=a.width):(i=0,r=0,l=window.innerHeight,c=window.innerWidth,f=window.innerHeight,p=window.innerWidth),(e||t)&&s!==window&&(o=o||s.parentNode,!Oe))do if(o&&o.getBoundingClientRect&&(R(o,"transform")!=="none"||t&&R(o,"position")!=="static")){var S=o.getBoundingClientRect();i-=S.top+parseInt(R(o,"border-top-width")),r-=S.left+parseInt(R(o,"border-left-width")),l=i+a.height,c=r+a.width;break}while(o=o.parentNode);if(n&&s!==window){var E=st(o||s),N=E&&E.a,D=E&&E.d;E&&(i/=D,r/=N,p/=N,f/=D,l=i+f,c=r+p)}return{top:i,left:r,bottom:l,right:c,width:p,height:f}}}function so(s,e,t){for(var n=xe(s,!0),o=$(s)[e];n;){var a=$(n)[t],i=void 0;if(i=o>=a,!i)return n;if(n===Ne())break;n=xe(n,!1)}return!1}function gt(s,e,t,n){for(var o=0,a=0,i=s.children;a<i.length;){if(i[a].style.display!=="none"&&i[a]!==k.ghost&&(n||i[a]!==k.dragged)&&ve(i[a],t.draggable,s,!1)){if(o===e)return i[a];o++}a++}return null}function Kn(s,e){for(var t=s.lastElementChild;t&&(t===k.ghost||R(t,"display")==="none"||e&&!cn(t,e));)t=t.previousElementSibling;return t||null}function pe(s,e){var t=0;if(!s||!s.parentNode)return-1;for(;s=s.previousElementSibling;)s.nodeName.toUpperCase()!=="TEMPLATE"&&s!==k.clone&&(!e||cn(s,e))&&t++;return t}function io(s){var e=0,t=0,n=Ne();if(s)do{var o=st(s),a=o.a,i=o.d;e+=s.scrollLeft*a,t+=s.scrollTop*i}while(s!==n&&(s=s.parentNode));return[e,t]}function Vo(s,e){for(var t in s)if(s.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===s[t][n])return Number(t)}return-1}function xe(s,e){if(!s||!s.getBoundingClientRect)return Ne();var t=s,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=R(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ne();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ne()}function Wo(s,e){if(s&&e)for(var t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);return s}function wn(s,e){return Math.round(s.top)===Math.round(e.top)&&Math.round(s.left)===Math.round(e.left)&&Math.round(s.height)===Math.round(e.height)&&Math.round(s.width)===Math.round(e.width)}var Lt;function Co(s,e){return function(){if(!Lt){var t=arguments,n=this;t.length===1?s.call(n,t[0]):s.apply(n,t),Lt=setTimeout(function(){Lt=void 0},e)}}}function jo(){clearTimeout(Lt),Lt=void 0}function Eo(s,e,t){s.scrollLeft+=e,s.scrollTop+=t}function No(s){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(s).cloneNode(!0):t?t(s).clone(!0)[0]:s.cloneNode(!0)}function Lo(s,e,t){var n={};return Array.from(s.children).forEach(function(o){var a,i,r,l;if(!(!ve(o,e.draggable,s,!1)||o.animated||o===t)){var c=$(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((i=n.top)!==null&&i!==void 0?i:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var le="Sortable"+new Date().getTime();function Yo(){var s=[],e;return{captureAnimationState:function(){if(s=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(R(o,"display")==="none"||o===k.ghost)){s.push({target:o,rect:$(o)});var a=Le({},s[s.length-1].rect);if(o.thisAnimationDuration){var i=st(o,!0);i&&(a.top-=i.f,a.left-=i.e)}o.fromRect=a}})}},addAnimationState:function(n){s.push(n)},removeAnimationState:function(n){s.splice(Vo(s,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,i=0;s.forEach(function(r){var l=0,c=r.target,f=c.fromRect,p=$(c),S=c.prevFromRect,E=c.prevToRect,N=r.rect,D=st(c,!0);D&&(p.top-=D.f,p.left-=D.e),c.toRect=p,c.thisAnimationDuration&&wn(S,p)&&!wn(f,p)&&(N.top-p.top)/(N.left-p.left)===(f.top-p.top)/(f.left-p.left)&&(l=Xo(N,S,E,o.options)),wn(p,f)||(c.prevFromRect=f,c.prevToRect=p,l||(l=o.options.animation),o.animate(c,N,p,l)),l&&(a=!0,i=Math.max(i,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},i):typeof n=="function"&&n(),s=[]},animate:function(n,o,a,i){if(i){R(n,"transition",""),R(n,"transform","");var r=st(this.el),l=r&&r.a,c=r&&r.d,f=(o.left-a.left)/(l||1),p=(o.top-a.top)/(c||1);n.animatingX=!!f,n.animatingY=!!p,R(n,"transform","translate3d("+f+"px,"+p+"px,0)"),this.forRepaintDummy=$o(n),R(n,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),R(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){R(n,"transition",""),R(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},i)}}}}function $o(s){return s.offsetWidth}function Xo(s,e,t,n){return Math.sqrt(Math.pow(e.top-s.top,2)+Math.pow(e.left-s.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var et=[],Tn={initializeByDefault:!0},Kt={mount:function(e){for(var t in Tn)Tn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Tn[t]);et.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),et.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";et.forEach(function(i){t[i.pluginName]&&(t[i.pluginName][a]&&t[i.pluginName][a](Le({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](Le({sortable:t},n)))})},initializePlugins:function(e,t,n,o){et.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,ke(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var i=this.modifyOption(e,a,e.options[a]);typeof i<"u"&&(e.options[a]=i)}},getEventProperties:function(e,t){var n={};return et.forEach(function(o){typeof o.eventProperties=="function"&&ke(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return et.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function Jo(s){var e=s.sortable,t=s.rootEl,n=s.name,o=s.targetEl,a=s.cloneEl,i=s.toEl,r=s.fromEl,l=s.oldIndex,c=s.newIndex,f=s.oldDraggableIndex,p=s.newDraggableIndex,S=s.originalEvent,E=s.putSortable,N=s.extraEventProperties;if(e=e||t&&t[le],!!e){var D,X=e.options,se="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Oe&&!Jt?D=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(D=document.createEvent("Event"),D.initEvent(n,!0,!0)),D.to=i||t,D.from=r||t,D.item=o||t,D.clone=a,D.oldIndex=l,D.newIndex=c,D.oldDraggableIndex=f,D.newDraggableIndex=p,D.originalEvent=S,D.pullMode=E?E.lastPutMode:void 0;var oe=Le(Le({},N),Kt.getEventProperties(n,e));for(var me in oe)D[me]=oe[me];t&&t.dispatchEvent(D),X[se]&&X[se].call(e,D)}}var Ko=["evt"],ie=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=Ho(n,Ko);Kt.pluginEvent.bind(k)(e,t,Le({dragEl:y,parentEl:W,ghostEl:F,rootEl:H,nextEl:$e,lastDownEl:an,cloneEl:U,cloneHidden:Ae,dragStarted:bt,putSortable:Z,activeSortable:k.active,originalEvent:o,oldIndex:ot,oldDraggableIndex:wt,newIndex:fe,newDraggableIndex:Pe,hideGhostForTarget:Io,unhideGhostForTarget:ko,cloneNowHidden:function(){Ae=!0},cloneNowShown:function(){Ae=!1},dispatchSortableEvent:function(r){ae({sortable:t,name:r,originalEvent:o})}},a))};function ae(s){Jo(Le({putSortable:Z,cloneEl:U,targetEl:y,rootEl:H,oldIndex:ot,oldDraggableIndex:wt,newIndex:fe,newDraggableIndex:Pe},s))}var y,W,F,H,$e,an,U,Ae,ot,fe,wt,Pe,_t,Z,nt=!1,dn=!1,un=[],We,he,Rn,In,ro,lo,bt,tt,Tt,Rt=!1,en=!1,sn,te,kn=[],Bn=!1,fn=[],En=typeof document<"u",tn=Jn,co=Jt||Oe?"cssFloat":"float",Zo=En&&!yo&&!Jn&&"draggable"in document.createElement("div"),wo=function(){if(En){if(Oe)return!1;var s=document.createElement("x");return s.style.cssText="pointer-events:auto",s.style.pointerEvents==="auto"}}(),To=function(e,t){var n=R(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=gt(e,0,t),i=gt(e,1,t),r=a&&R(a),l=i&&R(i),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+$(a).width,f=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+$(i).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&r.float!=="none"){var p=r.float==="left"?"left":"right";return i&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return a&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[co]==="none"||i&&n[co]==="none"&&c+f>o)?"vertical":"horizontal"},Qo=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,i=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||a===l||o+i/2===r+c/2},_o=function(e,t){var n;return un.some(function(o){var a=o[le].options.emptyInsertThreshold;if(!(!a||Kn(o))){var i=$(o),r=e>=i.left-a&&e<=i.right+a,l=t>=i.top-a&&t<=i.bottom+a;if(r&&l)return n=o}}),n},Ro=function(e){function t(a,i){return function(r,l,c,f){var p=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(a==null&&(i||p))return!0;if(a==null||a===!1)return!1;if(i&&a==="clone")return a;if(typeof a=="function")return t(a(r,l,c,f),i)(r,l,c,f);var S=(i?r:l).options.group.name;return a===!0||typeof a=="string"&&a===S||a.join&&a.indexOf(S)>-1}}var n={},o=e.group;(!o||on(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Io=function(){!wo&&F&&R(F,"display","none")},ko=function(){!wo&&F&&R(F,"display","")};En&&!yo&&document.addEventListener("click",function(s){if(dn)return s.preventDefault(),s.stopPropagation&&s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation(),dn=!1,!1},!0);var je=function(e){if(y){e=e.touches?e.touches[0]:e;var t=_o(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[le]._onDragOver(n)}}},ea=function(e){y&&y.parentNode[le]._isOutsideThisEl(e.target)};function k(s,e){if(!(s&&s.nodeType&&s.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(s));this.el=s,this.options=e=ke({},e),s[le]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(s.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return To(s,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(i,r){i.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!Nt||Jn),emptyInsertThreshold:5};Kt.initializePlugins(this,s,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Ro(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Zo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(s,"pointerdown",this._onTapStart):(z(s,"mousedown",this._onTapStart),z(s,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(s,"dragover",this),z(s,"dragenter",this)),un.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ke(this,Yo())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(tt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,y):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,f=o.filter;if(la(n),!y&&!(/mousedown|pointerdown/.test(i)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Nt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=ve(l,o.draggable,n,!1),!(l&&l.animated)&&an!==l)){if(ot=pe(l),wt=pe(l,o.draggable),typeof f=="function"){if(f.call(this,e,l,this)){ae({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),ie("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(f&&(f=f.split(",").some(function(p){if(p=ve(c,p.trim(),n,!1),p)return ae({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),ie("filter",t,{evt:e}),!0}),f)){a&&e.preventDefault();return}o.handle&&!ve(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,i=o.options,r=a.ownerDocument,l;if(n&&!y&&n.parentNode===a){var c=$(n);if(H=a,y=n,W=y.parentNode,$e=y.nextSibling,an=n,_t=i.group,k.dragged=y,We={target:y,clientX:(t||e).clientX,clientY:(t||e).clientY},ro=We.clientX-c.left,lo=We.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,y.style["will-change"]="all",l=function(){if(ie("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!oo&&o.nativeDraggable&&(y.draggable=!0),o._triggerDragStart(e,t),ae({sortable:o,name:"choose",originalEvent:e}),ue(y,i.chosenClass,!0)},i.ignore.split(",").forEach(function(f){bo(y,f.trim(),On)}),z(r,"dragover",je),z(r,"mousemove",je),z(r,"touchmove",je),i.supportPointer?(z(r,"pointerup",o._onDrop),!this.nativeDraggable&&z(r,"pointercancel",o._onDrop)):(z(r,"mouseup",o._onDrop),z(r,"touchend",o._onDrop),z(r,"touchcancel",o._onDrop)),oo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,y.draggable=!0),ie("delayStart",this,{evt:e}),i.delay&&(!i.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Jt||Oe))){if(k.eventCanceled){this._onDrop();return}i.supportPointer?(z(r,"pointerup",o._disableDelayedDrag),z(r,"pointercancel",o._disableDelayedDrag)):(z(r,"mouseup",o._disableDelayedDrag),z(r,"touchend",o._disableDelayedDrag),z(r,"touchcancel",o._disableDelayedDrag)),z(r,"mousemove",o._delayedDragTouchMoveHandler),z(r,"touchmove",o._delayedDragTouchMoveHandler),i.supportPointer&&z(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,i.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){y&&On(y),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;M(e,"mouseup",this._disableDelayedDrag),M(e,"touchend",this._disableDelayedDrag),M(e,"touchcancel",this._disableDelayedDrag),M(e,"pointerup",this._disableDelayedDrag),M(e,"pointercancel",this._disableDelayedDrag),M(e,"mousemove",this._delayedDragTouchMoveHandler),M(e,"touchmove",this._delayedDragTouchMoveHandler),M(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):t?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(y,"dragend",this),z(H,"dragstart",this._onDragStart));try{document.selection?rn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(nt=!1,H&&y){ie("dragStarted",this,{evt:t}),this.nativeDraggable&&z(document,"dragover",ea);var n=this.options;!e&&ue(y,n.dragClass,!1),ue(y,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),ae({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(he){this._lastX=he.clientX,this._lastY=he.clientY,Io();for(var e=document.elementFromPoint(he.clientX,he.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(he.clientX,he.clientY),e!==t);)t=e;if(y.parentNode[le]._isOutsideThisEl(e),t)do{if(t[le]){var n=void 0;if(n=t[le]._onDragOver({clientX:he.clientX,clientY:he.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=vo(t));ko()}},_onTouchMove:function(e){if(We){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,i=F&&st(F,!0),r=F&&i&&i.a,l=F&&i&&i.d,c=tn&&te&&io(te),f=(a.clientX-We.clientX+o.x)/(r||1)+(c?c[0]-kn[0]:0)/(r||1),p=(a.clientY-We.clientY+o.y)/(l||1)+(c?c[1]-kn[1]:0)/(l||1);if(!k.active&&!nt){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(F){i?(i.e+=f-(Rn||0),i.f+=p-(In||0)):i={a:1,b:0,c:0,d:1,e:f,f:p};var S="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");R(F,"webkitTransform",S),R(F,"mozTransform",S),R(F,"msTransform",S),R(F,"transform",S),Rn=f,In=p,he=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!F){var e=this.options.fallbackOnBody?document.body:H,t=$(y,!0,tn,!0,e),n=this.options;if(tn){for(te=e;R(te,"position")==="static"&&R(te,"transform")==="none"&&te!==document;)te=te.parentNode;te!==document.body&&te!==document.documentElement?(te===document&&(te=Ne()),t.top+=te.scrollTop,t.left+=te.scrollLeft):te=Ne(),kn=io(te)}F=y.cloneNode(!0),ue(F,n.ghostClass,!1),ue(F,n.fallbackClass,!0),ue(F,n.dragClass,!0),R(F,"transition",""),R(F,"transform",""),R(F,"box-sizing","border-box"),R(F,"margin",0),R(F,"top",t.top),R(F,"left",t.left),R(F,"width",t.width),R(F,"height",t.height),R(F,"opacity","0.8"),R(F,"position",tn?"absolute":"fixed"),R(F,"zIndex","100000"),R(F,"pointerEvents","none"),k.ghost=F,e.appendChild(F),R(F,"transform-origin",ro/parseInt(F.style.width)*100+"% "+lo/parseInt(F.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(ie("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}ie("setupClone",this),k.eventCanceled||(U=No(y),U.removeAttribute("id"),U.draggable=!1,U.style["will-change"]="",this._hideClone(),ue(U,this.options.chosenClass,!1),k.clone=U),n.cloneId=rn(function(){ie("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||H.insertBefore(U,y),n._hideClone(),ae({sortable:n,name:"clone"}))}),!t&&ue(y,a.dragClass,!0),t?(dn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(M(document,"mouseup",n._onDrop),M(document,"touchend",n._onDrop),M(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,y)),z(document,"drop",n),R(y,"transform","translateZ(0)")),nt=!0,n._dragStartId=rn(n._dragStarted.bind(n,t,e)),z(document,"selectstart",n),bt=!0,window.getSelection().removeAllRanges(),Nt&&R(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,i,r=this.options,l=r.group,c=k.active,f=_t===l,p=r.sort,S=Z||c,E,N=this,D=!1;if(Bn)return;function X(St,Do){ie(St,N,Le({evt:e,isOwner:f,axis:E?"vertical":"horizontal",revert:i,dragRect:o,targetRect:a,canSort:p,fromSortable:S,target:n,completed:oe,onMove:function(_n,Po){return nn(H,t,y,o,_n,$(_n),e,Po)},changed:me},Do))}function se(){X("dragOverAnimationCapture"),N.captureAnimationState(),N!==S&&S.captureAnimationState()}function oe(St){return X("dragOverCompleted",{insertion:St}),St&&(f?c._hideClone():c._showClone(N),N!==S&&(ue(y,Z?Z.options.ghostClass:c.options.ghostClass,!1),ue(y,r.ghostClass,!0)),Z!==N&&N!==k.active?Z=N:N===k.active&&Z&&(Z=null),S===N&&(N._ignoreWhileAnimating=n),N.animateAll(function(){X("dragOverAnimationComplete"),N._ignoreWhileAnimating=null}),N!==S&&(S.animateAll(),S._ignoreWhileAnimating=null)),(n===y&&!y.animated||n===t&&!n.animated)&&(tt=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(y.parentNode[le]._isOutsideThisEl(e.target),!St&&je(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),D=!0}function me(){fe=pe(y),Pe=pe(y,r.draggable),ae({sortable:N,name:"change",toEl:t,newIndex:fe,newDraggableIndex:Pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=ve(n,r.draggable,t,!0),X("dragOver"),k.eventCanceled)return D;if(y.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||N._ignoreWhileAnimating===n)return oe(!1);if(dn=!1,c&&!r.disabled&&(f?p||(i=W!==H):Z===this||(this.lastPutMode=_t.checkPull(this,c,y,e))&&l.checkPut(this,c,y,e))){if(E=this._getDirection(e,n)==="vertical",o=$(y),X("dragOverValid"),k.eventCanceled)return D;if(i)return W=H,se(),this._hideClone(),X("revert"),k.eventCanceled||($e?H.insertBefore(y,$e):H.appendChild(y)),oe(!0);var ce=Kn(t,r.draggable);if(!ce||aa(e,E,this)&&!ce.animated){if(ce===y)return oe(!1);if(ce&&t===e.target&&(n=ce),n&&(a=$(n)),nn(H,t,y,o,n,a,e,!!n)!==!1)return se(),ce&&ce.nextSibling?t.insertBefore(y,ce.nextSibling):t.appendChild(y),W=t,me(),oe(!0)}else if(ce&&oa(e,E,this)){var He=gt(t,0,r,!0);if(He===y)return oe(!1);if(n=He,a=$(n),nn(H,t,y,o,n,a,e,!1)!==!1)return se(),t.insertBefore(y,He),W=t,me(),oe(!0)}else if(n.parentNode===t){a=$(n);var Ce=0,Ue,pt=y.parentNode!==t,de=!Qo(y.animated&&y.toRect||o,n.animated&&n.toRect||a,E),mt=E?"top":"left",Fe=so(n,"top","top")||so(y,"top","top"),ht=Fe?Fe.scrollTop:void 0;tt!==n&&(Ue=a[mt],Rt=!1,en=!de&&r.invertSwap||pt),Ce=sa(e,n,a,E,de?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,en,tt===n);var we;if(Ce!==0){var Ve=pe(y);do Ve-=Ce,we=W.children[Ve];while(we&&(R(we,"display")==="none"||we===F))}if(Ce===0||we===n)return oe(!1);tt=n,Tt=Ce;var yt=n.nextElementSibling,De=!1;De=Ce===1;var Zt=nn(H,t,y,o,n,a,e,De);if(Zt!==!1)return(Zt===1||Zt===-1)&&(De=Zt===1),Bn=!0,setTimeout(na,30),se(),De&&!yt?t.appendChild(y):n.parentNode.insertBefore(y,De?yt:n),Fe&&Eo(Fe,0,ht-Fe.scrollTop),W=y.parentNode,Ue!==void 0&&!en&&(sn=Math.abs(Ue-$(n)[mt])),me(),oe(!0)}if(t.contains(y))return oe(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){M(document,"mousemove",this._onTouchMove),M(document,"touchmove",this._onTouchMove),M(document,"pointermove",this._onTouchMove),M(document,"dragover",je),M(document,"mousemove",je),M(document,"touchmove",je)},_offUpEvents:function(){var e=this.el.ownerDocument;M(e,"mouseup",this._onDrop),M(e,"touchend",this._onDrop),M(e,"pointerup",this._onDrop),M(e,"pointercancel",this._onDrop),M(e,"touchcancel",this._onDrop),M(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(fe=pe(y),Pe=pe(y,n.draggable),ie("drop",this,{evt:e}),W=y&&y.parentNode,fe=pe(y),Pe=pe(y,n.draggable),k.eventCanceled){this._nulling();return}nt=!1,en=!1,Rt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),xn(this.cloneId),xn(this._dragStartId),this.nativeDraggable&&(M(document,"drop",this),M(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Nt&&R(document.body,"user-select",""),R(y,"transform",""),e&&(bt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),F&&F.parentNode&&F.parentNode.removeChild(F),(H===W||Z&&Z.lastPutMode!=="clone")&&U&&U.parentNode&&U.parentNode.removeChild(U),y&&(this.nativeDraggable&&M(y,"dragend",this),On(y),y.style["will-change"]="",bt&&!nt&&ue(y,Z?Z.options.ghostClass:this.options.ghostClass,!1),ue(y,this.options.chosenClass,!1),ae({sortable:this,name:"unchoose",toEl:W,newIndex:null,newDraggableIndex:null,originalEvent:e}),H!==W?(fe>=0&&(ae({rootEl:W,name:"add",toEl:W,fromEl:H,originalEvent:e}),ae({sortable:this,name:"remove",toEl:W,originalEvent:e}),ae({rootEl:W,name:"sort",toEl:W,fromEl:H,originalEvent:e}),ae({sortable:this,name:"sort",toEl:W,originalEvent:e})),Z&&Z.save()):fe!==ot&&fe>=0&&(ae({sortable:this,name:"update",toEl:W,originalEvent:e}),ae({sortable:this,name:"sort",toEl:W,originalEvent:e})),k.active&&((fe==null||fe===-1)&&(fe=ot,Pe=wt),ae({sortable:this,name:"end",toEl:W,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ie("nulling",this),H=y=W=F=$e=U=an=Ae=We=he=bt=fe=Pe=ot=wt=tt=Tt=Z=_t=k.dragged=k.ghost=k.clone=k.active=null,fn.forEach(function(e){e.checked=!0}),fn.length=Rn=In=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":y&&(this._onDragOver(e),ta(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,i=this.options;o<a;o++)t=n[o],ve(t,i.draggable,this.el,!1)&&e.push(t.getAttribute(i.dataIdAttr)||ra(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,i){var r=o.children[i];ve(r,this.options.draggable,o,!1)&&(n[a]=r)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ve(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=Kt.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Ro(n)},destroy:function(){ie("destroy",this);var e=this.el;e[le]=null,M(e,"mousedown",this._onTapStart),M(e,"touchstart",this._onTapStart),M(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(M(e,"dragover",this),M(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),un.splice(un.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ae){if(ie("hideClone",this),k.eventCanceled)return;R(U,"display","none"),this.options.removeCloneOnHide&&U.parentNode&&U.parentNode.removeChild(U),Ae=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ae){if(ie("showClone",this),k.eventCanceled)return;y.parentNode==H&&!this.options.group.revertClone?H.insertBefore(U,y):$e?H.insertBefore(U,$e):H.appendChild(U),this.options.group.revertClone&&this.animate(y,U),R(U,"display",""),Ae=!1}}};function ta(s){s.dataTransfer&&(s.dataTransfer.dropEffect="move"),s.cancelable&&s.preventDefault()}function nn(s,e,t,n,o,a,i,r){var l,c=s[le],f=c.options.onMove,p;return window.CustomEvent&&!Oe&&!Jt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=s,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=a||$(e),l.willInsertAfter=r,l.originalEvent=i,s.dispatchEvent(l),f&&(p=f.call(c,l,i)),p}function On(s){s.draggable=!1}function na(){Bn=!1}function oa(s,e,t){var n=$(gt(t.el,0,t.options,!0)),o=Lo(t.el,t.options,F),a=10;return e?s.clientX<o.left-a||s.clientY<n.top&&s.clientX<n.right:s.clientY<o.top-a||s.clientY<n.bottom&&s.clientX<n.left}function aa(s,e,t){var n=$(Kn(t.el,t.options.draggable)),o=Lo(t.el,t.options,F),a=10;return e?s.clientX>o.right+a||s.clientY>n.bottom&&s.clientX>n.left:s.clientY>o.bottom+a||s.clientX>n.right&&s.clientY>n.top}function sa(s,e,t,n,o,a,i,r){var l=n?s.clientY:s.clientX,c=n?t.height:t.width,f=n?t.top:t.left,p=n?t.bottom:t.right,S=!1;if(!i){if(r&&sn<c*o){if(!Rt&&(Tt===1?l>f+c*a/2:l<p-c*a/2)&&(Rt=!0),Rt)S=!0;else if(Tt===1?l<f+sn:l>p-sn)return-Tt}else if(l>f+c*(1-o)/2&&l<p-c*(1-o)/2)return ia(e)}return S=S||i,S&&(l<f+c*a/2||l>p-c*a/2)?l>f+c/2?1:-1:0}function ia(s){return pe(y)<pe(s)?1:-1}function ra(s){for(var e=s.tagName+s.className+s.src+s.href+s.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function la(s){fn.length=0;for(var e=s.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&fn.push(n)}}function rn(s){return setTimeout(s,0)}function xn(s){return clearTimeout(s)}En&&z(document,"touchmove",function(s){(k.active||nt)&&s.cancelable&&s.preventDefault()});k.utils={on:z,off:M,css:R,find:bo,is:function(e,t){return!!ve(e,t,e,!1)},extend:Wo,throttle:Co,closest:ve,toggleClass:ue,clone:No,index:pe,nextTick:rn,cancelNextTick:xn,detectDirection:To,getChild:gt,expando:le};k.get=function(s){return s[le]};k.mount=function(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Le(Le({},k.utils),n.utils)),Kt.mount(n)})};k.create=function(s,e){return new k(s,e)};k.version=Uo;var j=[],Ct,Hn,Un=!1,Fn,Dn,gn,Et;function ca(){function s(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return s.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):n.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?M(document,"dragover",this._handleAutoScroll):(M(document,"pointermove",this._handleFallbackAutoScroll),M(document,"touchmove",this._handleFallbackAutoScroll),M(document,"mousemove",this._handleFallbackAutoScroll)),uo(),ln(),jo()},nulling:function(){gn=Hn=Ct=Un=Et=Fn=Dn=null,j.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(a,i);if(gn=t,n||this.options.forceAutoScrollFallback||Jt||Oe||Nt){Pn(t,this.options,r,n);var l=xe(r,!0);Un&&(!Et||a!==Fn||i!==Dn)&&(Et&&uo(),Et=setInterval(function(){var c=xe(document.elementFromPoint(a,i),!0);c!==l&&(l=c,ln()),Pn(t,o.options,c,n)},10),Fn=a,Dn=i)}else{if(!this.options.bubbleScroll||xe(r,!0)===Ne()){ln();return}Pn(t,this.options,xe(r,!1),!1)}}},ke(s,{pluginName:"scroll",initializeByDefault:!0})}function ln(){j.forEach(function(s){clearInterval(s.pid)}),j=[]}function uo(){clearInterval(Et)}var Pn=Co(function(s,e,t,n){if(e.scroll){var o=(s.touches?s.touches[0]:s).clientX,a=(s.touches?s.touches[0]:s).clientY,i=e.scrollSensitivity,r=e.scrollSpeed,l=Ne(),c=!1,f;Hn!==t&&(Hn=t,ln(),Ct=e.scroll,f=e.scrollFn,Ct===!0&&(Ct=xe(t,!0)));var p=0,S=Ct;do{var E=S,N=$(E),D=N.top,X=N.bottom,se=N.left,oe=N.right,me=N.width,ce=N.height,He=void 0,Ce=void 0,Ue=E.scrollWidth,pt=E.scrollHeight,de=R(E),mt=E.scrollLeft,Fe=E.scrollTop;E===l?(He=me<Ue&&(de.overflowX==="auto"||de.overflowX==="scroll"||de.overflowX==="visible"),Ce=ce<pt&&(de.overflowY==="auto"||de.overflowY==="scroll"||de.overflowY==="visible")):(He=me<Ue&&(de.overflowX==="auto"||de.overflowX==="scroll"),Ce=ce<pt&&(de.overflowY==="auto"||de.overflowY==="scroll"));var ht=He&&(Math.abs(oe-o)<=i&&mt+me<Ue)-(Math.abs(se-o)<=i&&!!mt),we=Ce&&(Math.abs(X-a)<=i&&Fe+ce<pt)-(Math.abs(D-a)<=i&&!!Fe);if(!j[p])for(var Ve=0;Ve<=p;Ve++)j[Ve]||(j[Ve]={});(j[p].vx!=ht||j[p].vy!=we||j[p].el!==E)&&(j[p].el=E,j[p].vx=ht,j[p].vy=we,clearInterval(j[p].pid),(ht!=0||we!=0)&&(c=!0,j[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(gn);var yt=j[this.layer].vy?j[this.layer].vy*r:0,De=j[this.layer].vx?j[this.layer].vx*r:0;typeof f=="function"&&f.call(k.dragged.parentNode[le],De,yt,s,gn,j[this.layer].el)!=="continue"||Eo(j[this.layer].el,De,yt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&S!==l&&(S=xe(S,!1)));Un=c}},30),Oo=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||a;r();var f=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(f.clientX,f.clientY);l(),c&&!c.el.contains(p)&&(i("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Zn(){}Zn.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=gt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Oo};ke(Zn,{pluginName:"revertOnSpill"});function Qn(){}Qn.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Oo};ke(Qn,{pluginName:"removeOnSpill"});k.mount(new ca);k.mount(Qn,Zn);const Mn="root";var Be,Y,vn,bn,Fo;const C=class C{static init(){if(C.noFolderView()||!ui.scenes)return;C.preloadTemplates(),game.user.getFlag(q,"activeSceneFolders")||game.user.setFlag(q,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;Ee(a=C,bn,Fo).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){if(!B.navFoldersEnabled||game.scenes.size<2||game.scenes.folders.size<1)return;const o=L(),a=document.querySelector("#crlngn-scene-lookup"),i=document.querySelector("#crlngn-folder-toggle");if(a||i)return;const r=t.querySelector("#scene-navigation-active"),l=r.querySelector("li.scene:first-of-type"),c=document.createElement("div"),f=document.createElement("div");c.id="crlngn-scene-lookup",c.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,f.dataset.tooltip=B.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",f.id="crlngn-folder-toggle",f.innerHTML="<i class='fa-solid icon'></i>",B.navShowRootFolders?r.classList.add("with-folders"):r.classList.remove("with-folders"),c.querySelector(".folder-expand").addEventListener("click",C.toggleFolderLookup),f.addEventListener("click",()=>{B.setNavPosition(0),w.set(o.navShowRootFolders.tag,!B.navShowRootFolders),B.placeNavButtons()}),r.insertBefore(c,l),r.append(f),C.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(i=>i.permission>=2),I(C,Be,game.scenes.sortingMode),g.log("buildFolderData A",[e.name,e]),e.id===Mn?o=t.filter(i=>i.folder===null)||[]:o=e.children,o=C.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},g.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),m(C,Be)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Be=new WeakMap,Y=new WeakMap,vn=new WeakMap,bn=new WeakSet,Fo=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){I(C,Be,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}I(C,Be,"a"),g.log("updateSortMode fallback",[m(C,Be)])},T(C,bn),h(C,"selectedFolder",Mn),T(C,Be,"a"),T(C,Y,[]),h(C,"searchValue",""),h(C,"renderFolderList",async e=>{I(C,Y,game.user.getFlag(q,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:Mn},a=C.buildTemplateData(o),i=await renderTemplate(`modules/${q}/templates/scene-nav-folders.hbs`,a);g.log("renderFolderList",[o,m(C,Y),i]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",i);const r=t.querySelectorAll("li.folder");C.addFolderListeners(r),B.placeNavButtons()}),h(C,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${q}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",C.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),h(C,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",m(C,vn));const o=n.dataset.folderId,a=t.get(o),i=m(C,Y).includes(o);g.log("addFolderListeners isActive",[i,o,a.name]),i&&(n.classList.add("crlngn-folder-active"),C.injectSubfolders(a,n))})}),T(C,vn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await C.injectSubfolders(a,t.parentNode),B.addSceneListeners(t.parentNode),g.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?C.updateActiveFolders(n,!0):C.updateActiveFolders(n,!1)}),h(C,"injectSubfolders",async(e,t)=>{const n=C.buildTemplateData(e),o=await renderTemplate(`modules/${q}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const i=t.querySelectorAll("li.folder");C.addFolderListeners(i),B.addSceneListeners(t.querySelector(".contents"))}),h(C,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-navigation-inactive"),o=n==null?void 0:n.querySelector(`li.folder[data-folder-id="${e}"]`),a=m(C,Y).indexOf(e);g.log("updateActiveFolders A",[a,e,game.user.getFlag(q,"activeSceneFolders"),m(C,Y)]),t?(I(C,Y,m(C,Y).filter(i=>i!==e)),o.classList.remove("crlngn-folder-active")):m(C,Y).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(r=>{r!==o&&(I(C,Y,m(C,Y).filter(l=>l!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),m(C,Y).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(q,"activeSceneFolders",m(C,Y)),g.log("updateActiveFolders B",[t,e,game.user.getFlag(q,"activeSceneFolders"),m(C,Y)])}),h(C,"selectFolder",e=>C.getFolderById(e)||null),h(C,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!B.navFoldersForPlayers||!B.navFoldersEnabled||!B.sceneNavEnabled}),h(C,"preloadTemplates",async()=>{const e=[`modules/${q}/templates/scene-nav-folders.hbs`,`modules/${q}/templates/scene-nav-subfolders.hbs`,`modules/${q}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),h(C,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;C.searchValue=n,C.updateSearchResults(n)}),h(C,"updateSearchResults",e=>{var a,i;if(C.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];n.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase()));const o=((i=game.scenes)==null?void 0:i.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(r=>{const l=document.createElement("li");l.className="search-folder",l.dataset.folderId=r.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,l.addEventListener("click",C.onSelectSearchedFolder),t.appendChild(l)}),n.forEach(r=>{const l=document.createElement("li");l.className="search-scene",l.dataset.sceneId=r.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,l.addEventListener("dblclick",B.onActivateScene),l.addEventListener("click",B.onSelectScene),t.appendChild(l)}),o.length===0&&n.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}}),h(C,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(B.navShowRootFolders||o.click(),!n)return;const r=[...ui.scenes.collection.folders.get(n).ancestors];I(C,Y,[]);for(const l of r)m(C,Y).push(l.id);m(C,Y).push(n),await game.user.setFlag(q,"activeSceneFolders",m(C,Y)),setTimeout(async()=>{ui.nav.render()},200)});let at=C;const re=class re{static init(){Hooks.on(A.RENDER_SIDE_BAR,re.onRender)}static applyFadeOut(e){re.useFadeOut=e,re.handleFadeOut()}static applyCustomStyle(e){var t;re.customStylesEnabled=e,g.log("applyCustomStyle",[re.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){re.handleClassApplication(),re.handleFadeOut(e,t,n)}static handleClassApplication(){re.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs")}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");re.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),g.log("SidebarTabs handle fade out",[re.useFadeOut])}};h(re,"useFadeOut",!0),h(re,"customStylesEnabled",!0);let Dt=re;var dt;const v=class v{static get(e,t=q){if(!e)return null;let n=!1;if(t===q)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,g.log("GET Setting",[a,n])}return n}static set(e,t,n=q){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),g.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{g.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,i,r,l,c,f,p,S,E;const n=L();switch(t===void 0&&(t=v.get(e)),g.log("SettingsUtil.apply",[e,t,v.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:Re.applyCustomStyle(t);break;case n.collapseMacroBar.tag:Re.applyHotBarCollapse();break;case n.playerListAvatars.tag:be.applyAvatars();break;case n.autoHidePlayerList.tag:be.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:v.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:v.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:_.currSettings.dockHeight=t,v.applyCameraHeight(t);break;case n.dockWidth.tag:_.currSettings.dockWidth=t,v.applyCameraWidth(t);break;case n.dockPosX.tag:_.currSettings.dockPosX=t,v.applyCameraPosX(t);break;case n.dockPosY.tag:_.currSettings.dockPosY=t,v.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:_.currSettings.defaultVideoWidth=t,_.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:_.currSettings.dockResizeOnUserJoin=t,_.applyDockResize(t);break;case n.chatBorderColor.tag:_e.chatBorderColor=t,v.applyBorderColors();break;case n.useLeftChatBorder.tag:_e.useLeftChatBorder=t;case n.enableChatStyles.tag:_e.enableChatStyles=t,v.applyChatStyles();break;case n.debugMode.tag:v.applyDebugSettings();break;case n.navFoldersEnabled.tag:B.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:B.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:B.sceneClickToView=t,(a=ui.nav)==null||a.render(),(r=(i=game.scenes)==null?void 0:i.directory)==null||r.render();break;case n.useSceneIcons.tag:B.useSceneIcons=t,(l=ui.nav)==null||l.render(),(f=(c=game.scenes)==null?void 0:c.directory)==null||f.render();break;case n.useSceneBackButton.tag:g.log("useSceneBackButton",[t]),B.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:B.useScenePreview=t,(S=ui.nav)==null||S.render();break;case n.navStartCollapsed.tag:B.navStartCollapsed=t,(E=ui.nav)==null||E.render();break;case n.showNavOnHover.tag:B.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:B.isCollapsed=v.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:v.applyThemeSettings();break;case n.customStyles.tag:v.applyCustomCSS(t);break;case n.adjustOtherModules.tag:v.applyModuleAdjustments(t);break;case n.otherModulesList.tag:v.applyOtherModulesList(t);break;case n.enablePlayerList.tag:be.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:B.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Re.applyCustomStyle(t);break;case n.enableFloatingDock.tag:_.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:Dt.applyCustomStyle(t);break;case n.enableChatLogControls.tag:Ft.applyCustomStyle(t);break;case n.enableSceneControls.tag:Ot.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:Ot.applyFadeOut(t);break;case n.playerListFadeOut.tag:be.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:Dt.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:_.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Re.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:Ft.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:B.applyFadeOut(t);break}}static applyBorderColors(){const e=L(),t=v.get(e.chatBorderColor.tag),n=document.querySelector("body");t===ut.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===ut.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=L(),t=v.get(e.enableChatStyles.tag),n=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const n=L();v.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:v.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=L(),t=v.get(e.controlsIconSize.tag);document.querySelector("body");const n=vt[t]?vt[t].size:vt.regular.size;function o(a){switch(a){case vt.large.name:return"var(--font-size-18);";case vt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[n]),P.addCSSVars("--icon-font-size",o(t)),P.addCSSVars("--control-item-size",n),v.applyLeftControlsSettings()}static applySceneNavPos(e){const t=L();B.navPos=e||v.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=L(),n=v.get(t.dockPosX.tag),o=e||n;_.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=L(),n=v.get(t.dockPosY.tag),o=e||n;_.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=L(),n=v.get(t.dockWidth.tag),o=e||n;_.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=L(),n=v.get(t.dockHeight.tag),o=e||n;_.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=L(),o=n.customFontsMenu.fields,a={};switch(g.log("applyCustomFonts",[e,t]),o.forEach(i=>{a[i]=v.get(n[i].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:P.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:P.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:P.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:P.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=L();g.debugOn=e||v.get(t.debugMode.tag)}};dt=new WeakMap,T(v,dt,!1),h(v,"firstLoad",!0),h(v,"registerSettings",async()=>{const e=L(),t=Object.entries(e);g.log("registerSettings - test",[t],!0),t.forEach(async f=>{const p=f[1];if(g.log("Registering... ",[f],!0),p.showOnRoot&&p.isMenu||!p.isMenu){const S={name:p.label,hint:p.hint,default:p.default,type:p.propType,scope:p.scope,config:p.config,requiresReload:p.requiresReload||!1,onChange:E=>v.apply(p.tag,E)};(p.choices||p.options)&&(S.choices=p.choices||p.options),await game.settings.register(q,p.tag,S),v.get(p.tag)===void 0&&(g.log("resetting...",[p.tag]),v.set(p.tag,p.default))}}),game.keybindings.register(q,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{v.hideInterface()},restricted:!1}),v.applyThemeSettings(),v.applyCustomCSS(),v.applyModuleAdjustments();const o=Object.entries(Gn()).find(f=>f[0]==="moduleSettingsMenu");if(o){const f=o[1],p={name:f.tag,label:f.label,hint:f.hint,icon:f.icon,type:f.propType,restricted:f.restricted};await game.settings.registerMenu(q,f.tag,p)}Hooks.on(A.RENDER_SCENE_CONTROLS,v.applyLeftControlsSettings),Hooks.on(A.RENDER_PLAYERS_LIST,be.applyPlayersListSettings),Hooks.on(A.RENDER_HOTBAR,()=>{Re.applyCustomStyle(),v.firstLoad&&(v.firstLoad=!1,Re.applyHotBarCollapse())}),v.applyDebugSettings(),v.applyChatStyles(),v.applyBorderColors(),e.sceneNavMenu.fields.forEach(f=>{v.apply(e[f].tag)}),e.cameraDockMenu.fields.forEach(f=>{v.apply(e[f].tag)}),e.customFontsMenu.fields.forEach(f=>{v.applyCustomFonts(e[f].tag)}),e.leftControlsMenu.fields.forEach(f=>{v.applyLeftControlsSettings(e[f].tag)}),e.interfaceOptionsMenu.fields.forEach(f=>{g.log("TEST",[f,e]),v.apply(e[f].tag)})}),h(v,"applyThemeSettings",e=>{const t=L(),n=e||v.get(t.colorTheme.tag)||"",o=document.querySelector("body");g.log("applyThemeSettings",[e,n,v.get(t.colorTheme.tag)]),Ye.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),h(v,"applyCustomCSS",e=>{const t=L(),n=e||v.get(t.customStyles.tag)||"";P.addCustomCSS(n)}),h(v,"applyModuleAdjustments",e=>{const t=L();(e||v.get(t.adjustOtherModules.tag)||!1)&&ft.addModuleClasses()}),h(v,"applyOtherModulesList",e=>{const t=L(),n=e||v.get(t.otherModulesList.tag);g.log("applyOtherModulesList",[n]),n.split(",").length===0?(v.set(t.adjustOtherModules.tag,!1),v.set(t.otherModulesList.tag,"")):v.set(t.adjustOtherModules.tag,!0),ft.addModuleClasses()}),h(v,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");m(v,dt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),I(v,dt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),I(v,dt,!0))});let w=v;const kt=class kt{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"https://github.com/crlngn/crlngn-ui/releases/latest/download/module-updates.json";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=L();w.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=L();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const o=await w.get(e.lastUpdateId.tag),a=await kt.getIdFromRawJson();if(g.log("checkForUpdates...",[a,o]),o===a)return;const i=await fetch(kt.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!i.ok){g.warn("checkForUpdates | Failed to fetch update news",[i.status,i.statusText]);return}const r=await i.json();await this.displayUpdateNews(r),w.set(e.lastUpdateId.tag,r.id),g.log("checkForUpdates | SUCCESS",[r.id])}catch(o){clearTimeout(n),o.name==="AbortError"?g.warn("checkForUpdates | Request timed out",[o]):g.warn("checkForUpdates | Fetch error",[o.message])}}catch(t){g.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;g.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});g.error("displayUpdateNews | Chat message created",[n,e])}catch(t){g.error("displayUpdateNews | Error creating chat message",[t])}}};h(kt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let Vn=kt;class da{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Cn;const Me=class Me{static init(){Hooks.once(A.INIT,()=>{var a,i;if(document.querySelector("body").classList.add(q),(a=document.querySelector("#ui-middle"))==null||a.classList.add(q),game.data.version<"13.339"){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion")),Me.isIncompatible=!0;return}g.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},w.registerSettings();const n=L(),o=w.get(n.disableUI.tag);if(g.log(A.INIT,[o]),o){document.querySelector("body").classList.remove(q),(i=document.querySelector("#ui-middle"))==null||i.classList.remove(q);return}be.init(),B.init(),_.init(),Ot.init(),Ft.init(),_e.init(),Dt.init(),Re.init(),Hooks.on(A.RENDER_CHAT_MESSAGE,m(Me,Cn))}),Hooks.once(A.READY,()=>{if(g.log("Core Ready",[]),Me.isIncompatible)return;const e=L();var t=w.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),da.init(),be.applyPlayersListSettings(),ft.init(),Vn.init(),w.get(e.enableChatStyles.tag)&&Me.addCSSLocalization()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";P.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),P.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),P.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),P.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),P.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),P.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),P.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),P.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),P.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),P.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Cn=new WeakMap,h(Me,"isIncompatible",!1),T(Me,Cn,(e,t)=>{g.log(A.RENDER_CHAT_MESSAGE,[e,t]),_e.enrichCard(e,t)});let Wn=Me;Wn.init();
//# sourceMappingURL=crlngn-ui.js.map
