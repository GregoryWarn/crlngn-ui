var jo=Object.defineProperty;var oo=s=>{throw TypeError(s)};var Yo=(s,e,t)=>e in s?jo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var E=(s,e,t)=>Yo(s,typeof e!="symbol"?e+"":e,t),un=(s,e,t)=>e.has(s)||oo("Cannot "+t);var C=(s,e,t)=>(un(s,e,"read from private field"),t?t.call(s):e.get(s)),R=(s,e,t)=>e.has(s)?oo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),O=(s,e,t,n)=>(un(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),G=(s,e,t)=>(un(s,e,"access private method"),t);const x={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",COMBAT_START:"combatStart",COMBAT_ROUND_START:"combatRound",COMBAT_TURN_START:"combatTurn"},ne="crlngn-ui",Wt=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],an=class an{static log(e="",t=[],n=!1){try{const o=an.debugOn;if(!(n||o))return;console.log(...Wt,e,...t)}catch{console.log(...Wt,e,...t)}}static warn(e="",t=[]){console.warn(...Wt,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Wt,e)}};E(an,"debugOn",!1);let g=an;const L={select:"select",checkbox:"checkbox",text:"text",number:"number"},w={client:"client",world:"world"},We={small:{name:"small",size:"38px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Cn={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},it={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},$o={noButton:{name:"noButton"},lastScene:{name:"lastScene"},defaultScenes:{name:"defaultScenes"}},_e={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},ao=140,Re=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(49, 140, 231)"]}];function b(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:L.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:w.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock'",customStyles:""},scope:w.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:L.button,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:it.playerColor.name,useLeftChatBorder:!1},scope:w.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:L.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:We.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:w.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:L.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth","dockWasResized"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:_e.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140,dockWasResized:!1},scope:w.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:L.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navShowRootFolders","sceneClickToView","useSceneIcons","sceneNavAlias","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,sceneNavAlias:"",showFolderListOnClick:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:$o.lastScene.name},scope:w.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:w.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:L.select,propType:String,default:Cn.small.name,scope:w.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.world,config:!1},useSceneBackButton:{tag:"use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:L.text,default:"",scope:w.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:L.number,default:0,scope:w.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:L.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:w.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:L.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:w.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:L.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:w.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:L.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:w.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:L.text,propType:String,default:"",scope:w.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:L.checkbox,propType:Boolean,default:!1,scope:w.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:L.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'","Party HUD":"'party-monitor-dock'"},scope:w.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:L.text,propType:String,default:"",scope:w.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:L.text,default:it.playerColor.name,scope:w.client,config:!1},useLeftChatBorder:{tag:"use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:w.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:w.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:L.number,default:200,scope:w.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:L.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:We.small.name,scope:w.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:L.checkbox,propType:Boolean,default:!1,scope:w.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:L.checkbox,propType:Boolean,default:!0,scope:w.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:L.checkbox,propType:Boolean,default:!0,scope:w.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:L.number,propType:Number,default:0,scope:w.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:L.number,propType:Number,default:120,scope:w.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:L.number,propType:Number,default:160,scope:w.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:L.number,propType:Number,default:145,scope:w.client,config:!1},dockWasResized:{tag:"dock-was-resized",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.hint"),inputType:L.checkbox,propType:Boolean,default:!1,scope:w.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:L.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:_e.off.name,scope:w.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:L.number,propType:Number,default:160,scope:w.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:w.world,config:!1,default:""}}}const{ApplicationV2:Xo,HandlebarsApplicationMixin:Jo}=foundry.applications.api;var ct,ho,mo,Rt,En;const ye=class ye extends Jo(Xo){constructor(){super(...arguments);R(this,Rt)}static get DEFAULT_OPTIONS(){return{id:b().cameraDockMenu.tag,actions:{redefine:G(ye,ct,mo)},form:{handler:G(ye,ct,ho),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=b(),o=n.cameraDockMenu.fields,a={},i={},r={};o.forEach(u=>{if(g.log("_prepareContext",[n[u].oldName]),n[u]){const p=N.get(n[u].tag);a[u]=n[u],i[u]=p!==void 0?p:n[u].default,r[u]=n[u].default}});const l={...i,default:{...r},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var i;g.log("_onRender",[t,n]),ye.element=this.element,ye.element.querySelector(".toggle-hint").addEventListener("click",()=>{ye.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const a=(i=this.element)==null?void 0:i.querySelector('input[name="enableFloatingDock"]');g.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",G(this,Rt,En).bind(this)),G(this,Rt,En).call(this,{target:a}))}};ct=new WeakSet,ho=async function(t,n,o){const a=b();t.preventDefault(),t.stopPropagation();const i=a.cameraDockMenu.fields,r=o.object;i.forEach(p=>{a[p].inputType==="checkbox"&&!r.hasOwnProperty(p)&&(r[p]=!1)});const l=foundry.utils.expandObject(r),c=N.get(a.enableFloatingDock.tag);g.log("Compared settings:",[l.enableFloatingDock,c]),i.forEach(p=>{g.log("Saving setting >>",[a[p].tag,l[p]]),l[p]!==void 0&&N.set(a[p].tag,l[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==c&&location.reload()},mo=async function(t,n){const o=b(),i=this.element.querySelectorAll("input, select"),r=o.cameraDockMenu.fields,l={};r.forEach(c=>{o[c]&&(o[c],l[c]=o[c].default)}),i.forEach(c=>{c.value=l[c.name]}),g.log("#onReset",[t,n,o.cameraDockMenu.default])},Rt=new WeakSet,En=function(t){var a,i;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(r=>r.disabled=!t.target.checked);const o=(i=this.element)==null?void 0:i.querySelectorAll("select");o.forEach(r=>r.disabled=!t.target.checked),g.log("onDockEnabledChange",[this.element,n,o])},R(ye,ct),E(ye,"element"),E(ye,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Nn=ye;const{ApplicationV2:Ko,HandlebarsApplicationMixin:Zo}=foundry.applications.api;var Hn,dt,yo,So;const Se=class Se extends Zo(Ko){static get DEFAULT_OPTIONS(){return{id:b().chatMessagesMenu.tag,actions:{redefine:G(Se,dt,So)},form:{handler:G(Se,dt,yo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=b(),n=t.chatMessagesMenu.fields,o={},a={},i={};n.forEach(c=>{if(g.log("_prepareContext",[t[c].oldName]),t[c]){const u=N.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}}),g.log("_prepareContext",[a,i]);const r={...a,default:{...i},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();Se.element=this.element,Se.element.querySelector(".toggle-hint").addEventListener("click",()=>{Se.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=N.get(n.chatMessagesMenu.tag);g.log("_onRender",[e,t,a])}};Hn=new WeakMap,dt=new WeakSet,yo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,i=n.object;a.forEach(u=>{o[u].inputType==="checkbox"&&!i.hasOwnProperty(u)&&(i[u]=!1)});const r=foundry.utils.expandObject(i),l=N.get(o.chatBorderColor.tag);g.log("Compared settings:",[r.chatBorderColor,l]),a.forEach(u=>{g.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&N.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},So=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),i=n.chatMessagesMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),a.forEach(l=>{l.value=r[l.name]})},R(Se,dt),R(Se,Hn),E(Se,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Tn=Se;class M{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!/FontAwesome|Font Awesome|FoundryVTT/.test(i)).map(i=>i.replace(/['"]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),i=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,i=o.indexOf("}"));const l=o.substring(a+16,i).split(";").map(h=>h.trim()).filter(h=>h!==""),c={};l.forEach(h=>{const v=h.split(":");if(v.length>=2){const S=v[0].trim(),T=v.slice(1).join(":").trim();S&&(c[S]=T)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([h,v])=>`  ${h}: ${v};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+u+`
}`+o.substring(i+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const i=e.dataset.scrollAnimationId;i&&cancelAnimationFrame(Number(i));const r=n==="horizontal",l=r?e.scrollLeft:e.scrollTop,c=t-l;if(c===0)return a&&a(),null;const u=performance.now(),p=v=>{const S=v-u;if(S>=o){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const T=S/o,A=T<.5?2*T*T:1-Math.pow(-2*T+2,2)/2;r?e.scrollLeft=l+c*A:e.scrollTop=l+c*A;const U=requestAnimationFrame(p);return e.dataset.scrollAnimationId=U,U},h=requestAnimationFrame(p);return e.dataset.scrollAnimationId=h,h}}E(M,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([n])=>n);const t=new Set;for(const n of document.styleSheets)try{if(n.ownerNode){const o=n.href||"",a=o.includes("/css/")||o.includes("/styles/"),i=o.includes("/modules/crlngn-ui/");if(o&&!a&&!i){g.log("Skipping non-core/module stylesheet:",[o]);continue}let r="";if(n.ownerNode instanceof Element){if(n.ownerNode.tagName==="STYLE")r=n.ownerNode.textContent;else if(n.ownerNode.tagName==="LINK")try{const u=n.cssRules||n.rules;r=Array.from(u).map(p=>p.cssText).join(`
`)}catch(u){g.warn("Could not read stylesheet rules:",[u])}}g.log("Processing stylesheet:",[o||"inline style"]);const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let c;for(;(c=l.exec(r))!==null;){let u=c[1];if(u.includes("fonts.googleapis.com")){const p=u.match(/family=([^&]+)/);p&&decodeURIComponent(p[1]).split("|").map(v=>v.split(":")[0].replace(/\+/g," ")).forEach(v=>{t.add(v)})}else{if(u.startsWith("./")||u.startsWith("../")){g.log("Skipping relative import:",[u]);continue}let p=u;try{const h=await fetch(p);if(!h.ok){g.warn("Error loading imported CSS:",[h.status]);continue}const S=(await h.text()).match(/@font-face\s*{[^}]+}/g);if(!S)continue;S.forEach(T=>{const A=T.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(A&&A[1]){const U=A[1].trim();t.add(U)}})}catch(h){g.warn("Error processing imported CSS:",[h])}}}}if(!n.href||n.href.startsWith(window.location.origin))try{const o=n.cssRules||n.rules;for(const a of o)if(a instanceof CSSFontFaceRule){const i=a.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(i)}}catch(o){g.warn("Could not read stylesheet rules:",[o])}}catch(o){g.warn("Error processing stylesheet:",[o])}return t}),E(M,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Qo,HandlebarsApplicationMixin:_o}=foundry.applications.api;var Wn,Oe,bo,vo,Co;const te=class te extends _o(Qo){static get DEFAULT_OPTIONS(){return{id:b().customFontsMenu.tag,actions:{redefine:G(te,Oe,Co)},form:{handler:G(te,Oe,bo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=b(),n=t.customFontsMenu.fields,o={},a={},i={};return n.forEach(l=>{if(t[l]){const c=N.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}}),{...a,default:{...i},fontList:await M.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){te.element=this.element,te.element.querySelector(".toggle-hint").addEventListener("click",()=>{te.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))}),te.element.querySelectorAll('input[type="text"]').forEach(i=>{const r=i.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const c=()=>{var u;G(u=te,Oe,vo).call(u),l.classList.add("active")};i.addEventListener("focus",c),i.addEventListener("click",c),i.addEventListener("keydown",u=>{const p=l.classList.contains("active"),h=Array.from(l.querySelectorAll(".dropdown-option"));let v=h.findIndex(S=>S.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),p||l.classList.add("active"),h.forEach(S=>S.classList.remove("highlighted")),v===-1?v=u.key==="ArrowDown"?0:h.length-1:v=u.key==="ArrowDown"?(v+1)%h.length:(v-1+h.length)%h.length,h[v]&&(h[v].classList.add("highlighted"),h[v].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),p&&v!==-1&&h[v]&&h[v].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),te.element.querySelectorAll(".dropdown-option").forEach(i=>{i.addEventListener("mouseenter",()=>{i.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),i.classList.add("highlighted")}),i.addEventListener("click",r=>{const l=i.closest(".dropdown-wrapper").querySelector("input");let c=i.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,i.closest(".dropdown-options").classList.remove("active")})})}};Wn=new WeakMap,Oe=new WeakSet,bo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,i=foundry.utils.expandObject(n.object);a.forEach(r=>{i[r]!==void 0&&(g.log("Saving setting:",[i[r]]),N.set(o[r].tag,i[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},vo=function(){te.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Co=async function(e,t){const n=b(),a=this.element.querySelectorAll("input[type=text]"),i=n.customFontsMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),a.forEach(l=>{l.value=r[l.name]})},R(te,Oe),R(te,Wn),E(te,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let wn=te;const{ApplicationV2:ea,HandlebarsApplicationMixin:ta}=foundry.applications.api;var Vn,ut,No,Eo;const be=class be extends ta(ea){static get DEFAULT_OPTIONS(){return{id:b().leftControlsMenu.tag,actions:{redefine:G(be,ut,Eo)},form:{handler:G(be,ut,No),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=b(),n=t.leftControlsMenu.fields,o={},a={},i={};n.forEach(l=>{if(t[l]){const c=N.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}});const r={...a,default:{...i},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=b();be.element=this.element,be.element.querySelector(".toggle-hint").addEventListener("click",()=>{be.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=N.get(n.leftControlsMenu.tag);g.log("_onRender",[e,t,a])}};Vn=new WeakMap,ut=new WeakSet,No=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,i=foundry.utils.expandObject(n.object);a.forEach(r=>{i[r]!==void 0&&(g.log("Saving setting:",[i[r]]),N.set(o[r].tag,i[r]))}),await N.set(o.leftControlsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Eo=async function(e,t){const n=b(),a=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;a.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),g.log("#onReset",[e,t,n.leftControlsMenu.default])},R(be,ut),R(be,Vn),E(be,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ln=be;const{ApplicationV2:na,HandlebarsApplicationMixin:oa}=foundry.applications.api;var jn,gt,To,wo,Mt,kn;const ve=class ve extends oa(na){constructor(){super(...arguments);R(this,Mt)}static get DEFAULT_OPTIONS(){return{id:b().sceneNavMenu.tag,actions:{redefine:G(ve,gt,wo)},form:{handler:G(ve,gt,To),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=b(),o=n.sceneNavMenu.fields,a={},i={},r={};o.forEach(c=>{if(n[c]){const u=N.get(n[c].tag);a[c]=n[c],i[c]=u!==void 0?u:n[c].default,r[c]=n[c].default}});const l={...i,default:{...r},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var i;g.log("_onRender",[t,n]),ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const a=(i=this.element)==null?void 0:i.querySelector('input[name="sceneNavEnabled"]');g.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",G(this,Mt,kn).bind(this)),G(this,Mt,kn).call(this,{target:a}))}};jn=new WeakMap,gt=new WeakSet,To=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=b(),i=a.sceneNavMenu.fields;let r=N.get(a.sceneNavEnabled.tag),l=N.get(a.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);i.forEach(h=>{c[h]!==void 0&&(g.log("Saving setting:",[c[h]]),N.set(a[h].tag,c[h]))});let u=N.get(a.sceneNavEnabled.tag),p=N.get(a.navFoldersEnabled.tag);g.log("Saving settings...",[r,u]),await N.set(a.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==p)&&location.reload()},wo=async function(t,n){const o=b(),i=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;i.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),g.log("#onReset",[t,n,o.sceneNavMenu.default])},Mt=new WeakSet,kn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),g.log("onSceneNavEnabledChange",[this.element,n])},R(ve,gt),R(ve,jn),E(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let In=ve;const{ApplicationV2:aa,HandlebarsApplicationMixin:sa}=foundry.applications.api;var Yn,$n,Ge,Lo,Io,ko;const X=class X extends sa(aa){static get DEFAULT_OPTIONS(){return{id:b().themeAndStylesMenu.tag,actions:{redefine:G(X,Ge,ko)},form:{handler:G(X,Ge,Lo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=b(),n=t.themeAndStylesMenu.fields,o={},a={},i={};n.forEach(c=>{if(t[c]){const u=N.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}});const r=Re.find(c=>c.className===a.colorTheme);a.colorTheme=(r==null?void 0:r.label)||Re[0].label;const l={...a,default:{...i},fields:{...o},selectedTheme:r,themes:Re,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){X.element=this.element,X.element.querySelector(".toggle-hint").addEventListener("click",()=>{X.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=Re,X.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const p=u.closest(".dropdown-wrapper"),h=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!h)return;const v=()=>{var S;G(S=X,Ge,Io).call(S),h.classList.add("active")};u.addEventListener("focus",v),u.addEventListener("click",v),u.addEventListener("keydown",S=>{const T=h.classList.contains("active"),A=Array.from(h.querySelectorAll(".dropdown-option"));let U=A.findIndex($=>$.classList.contains("highlighted"));S.key==="ArrowDown"||S.key==="ArrowUp"?(S.preventDefault(),T||h.classList.add("active"),A.forEach($=>$.classList.remove("highlighted")),U===-1?U=S.key==="ArrowDown"?0:A.length-1:U=S.key==="ArrowDown"?(U+1)%A.length:(U-1+A.length)%A.length,A[U]&&(A[U].classList.add("highlighted"),A[U].scrollIntoView({block:"nearest"}))):S.key==="Enter"?(S.preventDefault(),T&&U!==-1&&A[U]&&A[U].click()):S.key==="Escape"&&h.classList.remove("active")}),document.addEventListener("click",S=>{p.contains(S.target)||h.classList.remove("active")})});const a=X.element.querySelectorAll(".dropdown-option"),i=this;a.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(p){g.log("option",[u,u.querySelector(".theme-name")]);const h=u.closest(".dropdown-wrapper").querySelector("input");let v=u.querySelector(".theme-name").innerHTML.toString();if(h.value=v,h.name==="colorTheme"){const T=i._themes.find(A=>A.label===v);i._selectedTheme=T,i._updateThemePreview(T)}u.closest(".dropdown-options").classList.remove("active")})});const r=X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=X.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",p=>{const h=p.currentTarget;let S=`${l.value}`.split(",")||[],T=S.indexOf(h.value);!p.currentTarget.checked&&T>-1?S.splice(T,1):p.currentTarget.checked&&T===-1&&S.push(h.value),l.value=S.join(","),g.log("checkbox changed",[S,l.value])})}),X.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(h=>{h.checked=u.currentTarget.checked;const v=new Event("change",{bubbles:!0});h.dispatchEvent(v)})})}_updateThemePreview(e){if(g.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};Yn=new WeakMap,$n=new WeakMap,Ge=new WeakSet,Lo=async function(e,t,n){const o=b();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,i=foundry.utils.expandObject(n.object),r=Re.find(l=>l.label===i.colorTheme);i.colorTheme=r?r.className:"",a.forEach(l=>{i[l]!==void 0&&(g.log("Saving setting:",[i[l]]),N.set(o[l].tag,i[l]))}),N.set(o.themeAndStylesMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Io=function(){X.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ko=async function(e,t){const n=b(),a=this.element.querySelectorAll("input[type=text]"),i=n.themeAndStylesMenu.fields,r={};i.forEach(c=>{n[c]&&(n[c],r[c]=n[c].default)});const l=Re.find(c=>c.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||Re[0].label,a.forEach(c=>{c.value=r[c.name]})},R(X,Ge),R(X,Yn),R(X,$n,!1),E(X,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Rn=X;function ia(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:wn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Rn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Tn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:Ln,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Nn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:In,restricted:!1}}}var Ve,je,Dt,Pt,At,zt,Ot,H,Mn,St,Dn,Pn,An,zn;const f=class f{static init(){const e=b();f.currSettings={enableFloatingDock:N.get(e.enableFloatingDock.tag),defaultVideoWidth:N.get(e.defaultVideoWidth.tag),dockHeight:N.get(e.dockHeight.tag),dockWidth:N.get(e.dockWidth.tag),dockPosX:N.get(e.dockPosX.tag),dockPosY:N.get(e.dockPosY.tag),dockWasResized:N.get(e.dockWasResized.tag),dockResizeOnUserJoin:N.get(e.dockResizeOnUserJoin.tag)},f.currSettings.enableFloatingDock?(Hooks.on(x.RENDER_CAMERA_VIEWS,f.onRenderFloating),g.log("CameraUtil settings",[f.currSettings]),f.onRenderFloating()):(Hooks.on(x.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,a,i;b();const e=f.currSettings;(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),f.cameraContainer=document.querySelector("#camera-views .camera-container");const t=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");g.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),f.cameraContainer&&n&&t&&((a=f.cameraContainer)==null||a.insertBefore(t,n),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),f.makeDraggable(),f.makeResizeable(),f.resetPositionAndSize(),f.placeControlsToggle(),f.applyDockResize(),f.applyVideoWidth()}static applyDockResize(e){var n,o,a,i,r,l;const t=e||f.currSettings.dockResizeOnUserJoin;t===_e.horizontal.name?((n=document.querySelector("#camera-views"))==null||n.classList.add("crlngn-horizontal"),(o=document.querySelector("#camera-views"))==null||o.classList.remove("crlngn-vertical")):t===_e.vertical.name?((a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-vertical"),(i=document.querySelector("#camera-views"))==null||i.classList.remove("crlngn-horizontal")):((r=document.querySelector("#camera-views"))==null||r.classList.remove("crlngn-vertical"),(l=document.querySelector("#camera-views"))==null||l.classList.remove("crlngn-horizontal"))}static applyVideoWidth(e){const t=b(),n=N.get(t.defaultVideoWidth.tag);let o=e||n;if(o<ao)o=ao,N.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){f.currSettings.defaultVideoWidth=o;const a=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),i=document.querySelector("#camera-views.crlngn-ui");!a&&i?i.style.setProperty("--av-width",o+"px"):i&&i.style.removeProperty("--av-width"),f.resizeDock()}}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(g.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",n=>{var i,r;if(n.button!==0)return;const o=document.querySelector("body.crlngn-ui");if((i=n.target.parentNode)!=null&&i.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",G(f,H,Dn)),o==null||o.addEventListener("mouseup",G(f,H,Mn));const a=M.getOffsetBottom(f.cameraContainer);f.isDragging=!0,O(f,Ve,n.clientX-((r=f.cameraContainer)==null?void 0:r.offsetLeft)),O(f,je,window.innerHeight-n.clientY-a),n.preventDefault(),n.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",n=>{var r,l;if(n.touches.length>1)return;const o=document.querySelector("body.crlngn-ui");if((r=n.target.parentNode)!=null&&r.classList.contains("volume-bar"))return;o==null||o.addEventListener("touchmove",G(f,H,Pn)),o==null||o.addEventListener("touchend",G(f,H,St)),o==null||o.addEventListener("touchcancel",G(f,H,St));const a=n.touches[0],i=M.getOffsetBottom(f.cameraContainer);f.isDragging=!0,O(f,Ve,a.clientX-((l=f.cameraContainer)==null?void 0:l.offsetLeft)),O(f,je,window.innerHeight-a.clientY-i),n.preventDefault(),n.stopPropagation()})}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),f.isResizing=!0,O(f,Dt,n.clientX),O(f,Pt,n.clientY),O(f,Ot,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),O(f,At,f.cameraContainer.offsetWidth),O(f,zt,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",G(f,H,An)),e==null||e.addEventListener("mouseup",G(f,H,zn))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){b();const a=f.currSettings;if(!(!a.enableFloatingDock||!f.cameraContainer))if(!e&&!t&&!n&&!o){const i=a.dockPosX||0,r=a.dockPosY||0;if(f.cameraContainer.style.left=`${i}px`,f.cameraContainer.style.bottom=`${r}px`,f.currSettings.dockResizeOnUserJoin===_e.off.name){const l=a.dockWidth||0,c=a.dockHeight||0;f.cameraContainer.style.width=`${l}px`,f.cameraContainer.style.height=`${c}px`}}else e&&(f.cameraContainer.style.left=`${e}px`),t&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===_e.horizontal.name&&(n&&(f.cameraContainer.style.width=`${n}px`),o&&(f.cameraContainer.style.height=`${o}px`))}};Ve=new WeakMap,je=new WeakMap,Dt=new WeakMap,Pt=new WeakMap,At=new WeakMap,zt=new WeakMap,Ot=new WeakMap,H=new WeakSet,Mn=function(e){var o,a;const t=b(),n={...f.currSettings};if(f.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),N.set(t.dockPosX.tag,n.dockPosX),N.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",G(f,H,Dn)),i==null||i.removeEventListener("mouseup",G(f,H,Mn)),f.isDragging=!1,e.stopPropagation()}},St=function(e){var o,a;const t=b(),n={...f.currSettings};if(f.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),N.set(t.dockPosX.tag,n.dockPosX),N.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("touchmove",G(f,H,Pn)),i==null||i.removeEventListener("touchend",G(f,H,St)),i==null||i.removeEventListener("touchcancel",G(f,H,St)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}},Dn=function(e){if(f.isDragging){if(g.log("mousemove",[e.target.parentNode]),f.cameraContainer){let t=e.clientX-C(f,Ve),n=window.innerHeight-e.clientY-C(f,je);t+f.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-f.cameraContainer.offsetWidth),f.cameraContainer.style.left=`${t}px`,n+f.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${n}px`}e.preventDefault(),e.stopPropagation()}},Pn=function(e){if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let n=t.clientX-C(f,Ve),o=window.innerHeight-t.clientY-C(f,je);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}},An=function(e){if(!f.isResizing)return;const t=C(f,At)+(e.clientX-C(f,Dt)),n=e.clientY-C(f,Pt),o=C(f,zt)+n,a=C(f,Ot)-n;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${o}px`,f.cameraContainer.style.bottom=`${a}px`},zn=function(){var o,a,i,r,l,c;const e=b(),t={...f.currSettings},n=document.querySelector("body.crlngn-ui");f.isResizing=!1,n==null||n.removeEventListener("mousemove",G(f,H,An)),n==null||n.removeEventListener("mouseup",G(f,H,zn)),g.log("onStopResize",[(o=f.cameraContainer)==null?void 0:o.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(i=f.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((r=f.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=f.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=f.cameraContainer)==null?void 0:c.style.bottom)||0),N.set(e.dockWidth.tag,t.dockWidth),N.set(e.dockHeight.tag,t.dockHeight),N.set(e.dockPosY.tag,t.dockPosY),N.set(e.dockWasResized.tag,!0)},R(f,H),R(f,Ve,0),R(f,je,0),E(f,"isDragging",!1),E(f,"cameraContainer"),E(f,"isResizing",!1),R(f,Dt,0),R(f,Pt,0),R(f,At,0),R(f,zt,0),R(f,Ot,0),E(f,"currSettings",{}),E(f,"resizeDock",()=>{b(),!f.currSettings.enableFloatingDock||f.cameraContainer});let Z=f;const le=class le{static init(){const e=b();le.enableChatStyles=N.get(e.enableChatStyles.tag),le.chatBorderColor=N.get(e.chatBorderColor.tag),le.useLeftChatBorder=N.get(e.useLeftChatBorder.tag)}};E(le,"chatBorderColor"),E(le,"enableChatStyles"),E(le,"useLeftChatBorder"),E(le,"enrichCard",async(e,t)=>{var i,r,l,c,u,p,h,v;g.log("renderChatMessage",[le.chatBorderColor,le.enableChatStyles,it.playerColor.name,(i=e.author)==null?void 0:i.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((h=(p=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:p.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn"),le.useLeftChatBorder&&o.classList.add("left-border");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(S=>{const T=S.querySelector(".visible-dc"),A=S.querySelector(".hidden-dc");g.log("enrichCard",[T,A]),T.setAttribute("data-ability",S.getAttribute("data-ability")||""),T.setAttribute("data-dc",S.getAttribute("data-dc")||""),A.setAttribute("data-ability",S.getAttribute("data-ability")||"")}),le.chatBorderColor===it.playerColor.name&&((v=e.author)!=null&&v.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let rt=le;var Xn;const ce=class ce{static init(){Hooks.on(x.RENDER_PLAYERS_LIST,ce.checkPlayersList),Hooks.on(x.RENDER_HOTBAR,ce.checkPlayersList),M.isModuleOn("foundry-taskbar")&&Hooks.on(x.UPDATE_USER,ce.checkTaskbarLock),ce.checkTaskbarLock(),ce.addModuleClasses()}};Xn=new WeakMap,R(ce,Xn),E(ce,"addModuleClasses",()=>{const e=b(),t=N.get(e.otherModulesList.tag)||"",n=t.split(",");g.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),E(ce,"checkTaskbarLock",()=>{var a,i,r;const e=M.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(g.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(i=t.taskbarSettings)!=null&&i.locked?M.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):M.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?M.addCSSVars("--crlngn-taskbar-height","50px"):M.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),ce.checkPlayersList()}),E(ce,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=M.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;g.log("checkPlayersList",[o,n,a,game.settings]),document.querySelector("#hotbar"),o?(g.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let tt=ce;var W,Ye,$e,Jn,ot,Xe,Je,Gt,Kn,xt,fe,at,Pe,pe,sn,rn,ln;const d=class d{static applyCustomStyle(e){d.sceneNavEnabled=e,g.log("applyCustomStyle - TopNavigation",[d.sceneNavEnabled,ui.nav])}static resetLocalVars(){O(d,W,document.querySelector("#navigation")),O(d,ot,document.querySelector("#nav-toggle")),O(d,Xe,document.querySelector("#ui-left")),O(d,Ye,document.querySelector("#scene-list"))}static handleBackButton(e,t,n){if(b(),t=t[0]||t,g.log("handleBackButton",[e,t,n]),d.useSceneBackButton){if(game.scenes.size<2)return;const o=t.querySelector("#scene-list"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",C(d,sn)),t.insertBefore(a,o)}else{const o=document.querySelector("#crlngn-back-button");t.classList.add("no-back-button"),o&&o.remove()}}static handleFolderList(e,t,n){b(),d.navFoldersEnabled}static handleNavState(){b(),C(d,xt)&&(O(d,xt,!1),d.toggleNav(d.navStartCollapsed))}static toggleNav(e){clearTimeout(C(d,Gt)),O(d,Gt,setTimeout(()=>{d.resetLocalVars(),e===!0?(ui.nav.collapse(),d.isCollapsed=!0,g.log("toggleNav collapse",[ui.nav.collapse,e,d.navStartCollapsed]),document.querySelectorAll("#ui-top .crlngn-btn").forEach(n=>n.remove())):e===!1&&(d.isCollapsed=!1,ui.nav.expand(),g.log("toggleNav expand",[e,d.navStartCollapsed]))},300))}static checkSceneNavCompat(){}static addListeners(){var e,t;(e=C(d,W))==null||e.addEventListener("mouseenter",n=>{if(g.log("TopNavigation mouseenter",[d.isCollapsed,d.showNavOnHover]),!d.isCollapsed||!d.showNavOnHover)return;n.stopPropagation(),clearTimeout(C(d,$e)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=C(d,W))==null||t.addEventListener("mouseleave",n=>{g.log("TopNavigation mouseleave",[]),!(!d.isCollapsed||!d.showNavOnHover)&&(n.stopPropagation(),O(d,$e,setTimeout(()=>{clearTimeout(C(d,$e)),O(d,$e,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const i=b();if(!C(d,W))return;const r=((o=C(d,W))==null?void 0:o.querySelectorAll("li.nav-item"))||[],l=0,c=e!==null?e:d.navPos||0,u=(a=C(d,W))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!u)return;const p=r[c],h=u.offsetWidth||0,v=parseInt(h)*c;g.log("setNavPosition",["position",c,v,C(d,W).scrollWidth]);const S=v-l;if(S>C(d,W).scrollWidth)return;d.navPos=c,N.set(i.sceneNavPos.tag,c),t?M.smoothScrollTo(C(d,Ye),S,"horizontal",n):C(d,Ye).scrollTo({left:S,behavior:"instant"})}catch(i){g.log("setNavPosition",["Error:",i]),console.error("Error in setNavPosition:",i)}}};W=new WeakMap,Ye=new WeakMap,$e=new WeakMap,Jn=new WeakMap,ot=new WeakMap,Xe=new WeakMap,Je=new WeakMap,Gt=new WeakMap,Kn=new WeakMap,xt=new WeakMap,fe=new WeakMap,at=new WeakMap,Pe=new WeakMap,pe=new WeakMap,sn=new WeakMap,rn=new WeakMap,ln=new WeakMap,R(d,W),R(d,Ye),R(d,$e),R(d,Jn),R(d,ot),R(d,Xe),E(d,"sceneFoldersTemplate"),E(d,"navButtonsTemplate"),R(d,Je),R(d,Gt),R(d,Kn),R(d,xt,!0),R(d,fe,null),R(d,at,null),R(d,Pe,""),R(d,pe,[]),E(d,"sceneNavEnabled"),E(d,"navFoldersEnabled"),E(d,"navFoldersForPlayers"),E(d,"navShowRootFolders"),E(d,"navStartCollapsed"),E(d,"showNavOnHover"),E(d,"useSceneIcons"),E(d,"useScenePreview"),E(d,"useSceneBackButton"),E(d,"sceneClickToView"),E(d,"isCollapsed"),E(d,"navPos"),E(d,"init",()=>{const e=b();Hooks.on(x.RENDER_SCENE_NAV,d.onRender),d.navStartCollapsed=N.get(e.navStartCollapsed.tag),d.showNavOnHover=N.get(e.showNavOnHover.tag),d.sceneNavEnabled=N.get(e.sceneNavEnabled.tag),d.useScenePreview=N.get(e.useScenePreview.tag),d.navFoldersEnabled=N.get(e.navFoldersEnabled.tag),d.navFoldersForPlayers=N.get(e.navFoldersForPlayers.tag),d.isCollapsed=d.navStartCollapsed,g.log("SCENE NAV INIT",[d.sceneNavEnabled],!0);const t=document.querySelector("body");d.sceneNavEnabled?t.classList.add("crlngn-scene-nav"):t.classList.remove("crlngn-scene-nav"),d.sceneNavEnabled&&(d.preloadTemplates(),Hooks.on(x.READY,()=>{M.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42)}),Hooks.on(x.COLLAPSE_SIDE_BAR,n=>{g.log(x.COLLAPSE_SIDE_BAR,[n]),n&&d.checkSideBar(n.expanded),d.placeNavButtons()}),Hooks.on(x.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(C(d,Je)),d.isCollapsed=o,o&&document.querySelectorAll("#ui-top .crlngn-btn").forEach(i=>i.remove()),O(d,Je,setTimeout(()=>{d.setCollapsedClass(o)},250))}),ui.sidebar&&d.checkSideBar(ui.sidebar.expanded),d.placeNavButtons()),Hooks.on(x.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(x.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(x.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(x.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==C(d,pe)[C(d,pe).length-1]&&C(d,pe).push(n)}),Hooks.on(x.RENDER_SCENE_DIRECTORY,n=>{g.log(x.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(i=>{var l,c;const r=game.scenes.get(i.dataset.entryId);if(g.log(x.RENDER_SCENE_DIRECTORY,["directoryScenes",i.dataset.entryId,d.sceneClickToView]),d.sceneClickToView&&(i.addEventListener("dblclick",d.onActivateScene),i.addEventListener("click",d.onSelectScene)),d.useSceneIcons&&r&&((l=game.user)!=null&&l.isGM)){let u=document.createElement("i");u.classList.add("fas"),u.classList.add("icon"),r.ownership.default!==0?(r.active&&(u.classList.add("fa-bullseye"),i.prepend(u)),((c=game.scenes.current)==null?void 0:c.id)===r.id&&(u.classList.add("fa-star"),i.prepend(u))):(u.classList.add("fa-eye-slash"),i.prepend(u))}})})}),E(d,"onRender",(e,t,n)=>{const o=b(),a=N.get(o.sceneNavPos.tag);g.log("onRender - "+x.RENDER_SCENE_NAV,[t],!0),d.resetLocalVars(),d.sceneNavEnabled&&(d.handleBackButton(e,t,n),d.handleSceneList(e,t,n),d.handleFolderList(e,t,n),d.setNavPosition(a,!1),d.handleNavState()),d.addSceneListeners(t),d.addListeners(),d.resetLocalVars(),d.sceneNavEnabled&&(clearTimeout(C(d,Je)),O(d,Je,setTimeout(()=>{g.log("NAV no transition remove"),d.placeNavButtons()},500)))}),E(d,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(C(d,Xe).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),M.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(C(d,Xe).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),d.placeNavButtons(),M.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),E(d,"checkSideBar",e=>{d.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),E(d,"handleSceneList",async(e,t,n)=>{var o,a;if(t=t[0]||t,d.sceneNavEnabled){g.log("handleSceneList",[e,t,n]);const i=t.querySelectorAll("#scene-list li.scene");for(const r of i){const l=r.dataset.sceneId;if(d.useScenePreview){const c=game.scenes.find(p=>p.id===l);c.isGM=(o=game.user)==null?void 0:o.isGM;const u=await renderTemplate(`modules/${ne}/templates/scene-nav-preview.hbs`,c);if(g.log("sceneData",[c]),r.classList.add("nav-item"),r.insertAdjacentHTML("beforeend",u),c.isGM&&C(d,Pe)===l){const p=new MouseEvent("mouseenter");r.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&d.addPreviewIconListeners(r,c)}d.useSceneIcons&&(r.classList.contains("active")||r.classList.contains("view"))&&r.classList.add("crlngn")}}}),R(d,sn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=C(d,pe).length,n=C(d,pe)[t-2];let o;g.log("#onBackButton before",[t,n,C(d,pe)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),C(d,pe).pop()),g.log("#onBackButton after",[C(d,pe)])}),E(d,"placeNavButtons",async()=>{var l,c;const e=document.querySelector("#navigation");if(g.log("placeNavButtons #1",[e]),!e||e.nodeName=="TEMPLATE")return;d.resetLocalVars(),e.querySelector("#scene-list");let t=document.querySelectorAll("button.crlngn-btn");const n=((l=C(d,ot))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(g.log("placeNavButtons *",[e.offsetWidth,n,e.scrollWidth]),!o||d.isCollapsed||(c=C(d,Xe))!=null&&c.classList.contains("navigation-collapsed")){t.forEach(u=>{g.log("placeNavButtons remove",[u.remove,u]),u.remove()}),t=[];return}if(t.length>0)return;const a=await renderTemplate(`modules/${ne}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",a);const i=document.querySelector("#ui-top button.crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-top button.crlngn-btn.ui-nav-right");i&&i.addEventListener("click",C(d,rn)),r&&r.addEventListener("click",C(d,ln))}),R(d,rn,async e=>{const t=await d.getItemsPerPage(),n=d.navPos||0;if(!C(d,Ye)||!C(d,W))return;let o=n-(t-1);g.log("onNavLast",["pos",o,C(d,W).scrollWidth]),o=o<0?0:o,d.setNavPosition(o)}),R(d,ln,async e=>{var c,u;const t=await d.getItemsPerPage(),n=d.navPos||0,o=(c=C(d,W))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,i=((u=C(d,W))==null?void 0:u.scrollWidth)||0;if(!a||!C(d,W))return;let r=n+(t-1),l=r*a;g.log("onNavNext",["pos",n,r,o==null?void 0:o.offsetWidth,l,i]),l>=i&&(r=Math.floor(i/a)),d.setNavPosition(r)}),E(d,"getItemsPerPage",async()=>{var e,t;try{g.log("getItemsPerPage",["Starting"]),d.resetLocalVars();const n=0,o=0,a=((e=C(d,ot))==null?void 0:e.offsetWidth)||0,i=(t=C(d,W))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!i||!C(d,W))return g.log("getItemsPerPage",["No scene items found"]),0;const r=i.offsetWidth,l=C(d,W).offsetWidth;if(!l)return g.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((l-a*2)/r);return g.log("getItemsPerPage",["Calculated:",c,l,r]),c||0}catch(n){return g.log("getItemsPerPage",["Error:",n]),g.error("Error in getItemsPerPage:",n),0}}),E(d,"preloadTemplates",async()=>{try{const e=[`modules/${ne}/templates/scene-nav-buttons.hbs`,`modules/${ne}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),E(d,"getCurrScenePosition",async e=>{try{if(!C(d,W)||!e)return 0;const t=await d.getItemsPerPage()||1,n=C(d,W).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(a===-1)return 0;const i=a>=d.navPos&&a<=d.navPos+t,r=i?d.navPos:a;return g.log("getCurrScenePosition",["Final position:",r,"isVisible:",i]),r}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),E(d,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);g.log("onActivateScene",[o,a]),a.activate(),C(d,fe)&&(clearTimeout(C(d,fe)),O(d,fe,null))}),E(d,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(O(d,Pe,""),g.log("onSelectScene",[a,t,n]),a&&a.sheet){const i=a.sheet.render;g.log("onSelectScene - originalRender",[i]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=i},250)}C(d,fe)&&(clearTimeout(C(d,fe)),O(d,fe,null)),O(d,fe,setTimeout(()=>{a.view(),O(d,fe,null)},250))}),E(d,"onScenePreviewOn",e=>{if(e.stopPropagation(),e.preventDefault(),!d.showNavOnHover)return;const t=e.currentTarget,n=t.dataset;O(d,Pe,n.sceneId),O(d,at,setTimeout(()=>{clearTimeout(C(d,at)),t.querySelector(".scene-preview").classList.add("open")},200)),g.log("onScenePreviewOn",[C(d,Pe)])}),E(d,"onScenePreviewOff",e=>{if(e.stopPropagation(),e.preventDefault(),clearTimeout(C(d,at)),!d.showNavOnHover)return;const t=e.currentTarget;O(d,Pe,""),g.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),E(d,"addSceneListeners",e=>{e=e[0]||e,e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",d.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",d.onActivateScene),d.useScenePreview?(n.addEventListener("mouseenter",d.onScenePreviewOn),n.addEventListener("mouseleave",d.onScenePreviewOff)):(n.removeEventListener("mouseenter",d.onScenePreviewOn),n.removeEventListener("mouseleave",d.onScenePreviewOff))})}),E(d,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!u}),g.log("Toggled global illumination",[!u])});const i=o.querySelector(".token-vision");i&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.tokenVision;await n.update({tokenVision:!u}),g.log("Toggled token vision",[!u])});const r=o.querySelector(".sound");r&&n.playlistSound&&r.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const u=n.playlistSound;if(u){const p=u.sound.playing;p?await u.sound.pause():await u.sound.play(),ui.nav.render(),g.log("Toggled playlist sound",[!p])}});const l=o.querySelector(".config");l&&l.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),g.log("Opened scene configuration")})});let Q=d;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function so(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable})),t.push.apply(t,n)}return t}function Ne(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?so(Object(t),!0).forEach(function(n){ra(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):so(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}function Xt(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xt=function(e){return typeof e}:Xt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(s)}function ra(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function we(){return we=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},we.apply(this,arguments)}function la(s,e){if(s==null)return{};var t={},n=Object.keys(s),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=s[o]);return t}function ca(s,e){if(s==null)return{};var t=la(s,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(s,n)&&(t[n]=s[n])}return t}var da="1.15.6";function Te(s){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(s)}var Le=Te(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Bt=Te(/Edge/i),io=Te(/firefox/i),Nt=Te(/safari/i)&&!Te(/chrome/i)&&!Te(/android/i),Zn=Te(/iP(ad|od|hone)/i),Ro=Te(/chrome/i)&&Te(/android/i),Mo={capture:!1,passive:!1};function z(s,e,t){s.addEventListener(e,t,!Le&&Mo)}function P(s,e,t){s.removeEventListener(e,t,!Le&&Mo)}function _t(s,e){if(e){if(e[0]===">"&&(e=e.substring(1)),s)try{if(s.matches)return s.matches(e);if(s.msMatchesSelector)return s.msMatchesSelector(e);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(e)}catch{return!1}return!1}}function Do(s){return s.host&&s!==document&&s.host.nodeType?s.host:s.parentNode}function he(s,e,t,n){if(s){t=t||document;do{if(e!=null&&(e[0]===">"?s.parentNode===t&&_t(s,e):_t(s,e))||n&&s===t)return s;if(s===t)break}while(s=Do(s))}return null}var ro=/\s+/g;function ie(s,e,t){if(s&&e)if(s.classList)s.classList[t?"add":"remove"](e);else{var n=(" "+s.className+" ").replace(ro," ").replace(" "+e+" "," ");s.className=(n+(t?" "+e:"")).replace(ro," ")}}function I(s,e,t){var n=s&&s.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(s,""):s.currentStyle&&(t=s.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function nt(s,e){var t="";if(typeof s=="string")t=s;else do{var n=I(s,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(s=s.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Po(s,e,t){if(s){var n=s.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Ce(){var s=document.scrollingElement;return s||document.documentElement}function Y(s,e,t,n,o){if(!(!s.getBoundingClientRect&&s!==window)){var a,i,r,l,c,u,p;if(s!==window&&s.parentNode&&s!==Ce()?(a=s.getBoundingClientRect(),i=a.top,r=a.left,l=a.bottom,c=a.right,u=a.height,p=a.width):(i=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,p=window.innerWidth),(e||t)&&s!==window&&(o=o||s.parentNode,!Le))do if(o&&o.getBoundingClientRect&&(I(o,"transform")!=="none"||t&&I(o,"position")!=="static")){var h=o.getBoundingClientRect();i-=h.top+parseInt(I(o,"border-top-width")),r-=h.left+parseInt(I(o,"border-left-width")),l=i+a.height,c=r+a.width;break}while(o=o.parentNode);if(n&&s!==window){var v=nt(o||s),S=v&&v.a,T=v&&v.d;v&&(i/=T,r/=S,p/=S,u/=T,l=i+u,c=r+p)}return{top:i,left:r,bottom:l,right:c,width:p,height:u}}}function lo(s,e,t){for(var n=ze(s,!0),o=Y(s)[e];n;){var a=Y(n)[t],i=void 0;if(i=o>=a,!i)return n;if(n===Ce())break;n=ze(n,!1)}return!1}function lt(s,e,t,n){for(var o=0,a=0,i=s.children;a<i.length;){if(i[a].style.display!=="none"&&i[a]!==k.ghost&&(n||i[a]!==k.dragged)&&he(i[a],t.draggable,s,!1)){if(o===e)return i[a];o++}a++}return null}function Qn(s,e){for(var t=s.lastElementChild;t&&(t===k.ghost||I(t,"display")==="none"||e&&!_t(t,e));)t=t.previousElementSibling;return t||null}function de(s,e){var t=0;if(!s||!s.parentNode)return-1;for(;s=s.previousElementSibling;)s.nodeName.toUpperCase()!=="TEMPLATE"&&s!==k.clone&&(!e||_t(s,e))&&t++;return t}function co(s){var e=0,t=0,n=Ce();if(s)do{var o=nt(s),a=o.a,i=o.d;e+=s.scrollLeft*a,t+=s.scrollTop*i}while(s!==n&&(s=s.parentNode));return[e,t]}function ua(s,e){for(var t in s)if(s.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===s[t][n])return Number(t)}return-1}function ze(s,e){if(!s||!s.getBoundingClientRect)return Ce();var t=s,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=I(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ce();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ce()}function ga(s,e){if(s&&e)for(var t in e)e.hasOwnProperty(t)&&(s[t]=e[t]);return s}function gn(s,e){return Math.round(s.top)===Math.round(e.top)&&Math.round(s.left)===Math.round(e.left)&&Math.round(s.height)===Math.round(e.height)&&Math.round(s.width)===Math.round(e.width)}var Et;function Ao(s,e){return function(){if(!Et){var t=arguments,n=this;t.length===1?s.call(n,t[0]):s.apply(n,t),Et=setTimeout(function(){Et=void 0},e)}}}function fa(){clearTimeout(Et),Et=void 0}function zo(s,e,t){s.scrollLeft+=e,s.scrollTop+=t}function Oo(s){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(s).cloneNode(!0):t?t(s).clone(!0)[0]:s.cloneNode(!0)}function Go(s,e,t){var n={};return Array.from(s.children).forEach(function(o){var a,i,r,l;if(!(!he(o,e.draggable,s,!1)||o.animated||o===t)){var c=Y(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((i=n.top)!==null&&i!==void 0?i:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var oe="Sortable"+new Date().getTime();function pa(){var s=[],e;return{captureAnimationState:function(){if(s=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(I(o,"display")==="none"||o===k.ghost)){s.push({target:o,rect:Y(o)});var a=Ne({},s[s.length-1].rect);if(o.thisAnimationDuration){var i=nt(o,!0);i&&(a.top-=i.f,a.left-=i.e)}o.fromRect=a}})}},addAnimationState:function(n){s.push(n)},removeAnimationState:function(n){s.splice(ua(s,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,i=0;s.forEach(function(r){var l=0,c=r.target,u=c.fromRect,p=Y(c),h=c.prevFromRect,v=c.prevToRect,S=r.rect,T=nt(c,!0);T&&(p.top-=T.f,p.left-=T.e),c.toRect=p,c.thisAnimationDuration&&gn(h,p)&&!gn(u,p)&&(S.top-p.top)/(S.left-p.left)===(u.top-p.top)/(u.left-p.left)&&(l=ma(S,h,v,o.options)),gn(p,u)||(c.prevFromRect=u,c.prevToRect=p,l||(l=o.options.animation),o.animate(c,S,p,l)),l&&(a=!0,i=Math.max(i,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},i):typeof n=="function"&&n(),s=[]},animate:function(n,o,a,i){if(i){I(n,"transition",""),I(n,"transform","");var r=nt(this.el),l=r&&r.a,c=r&&r.d,u=(o.left-a.left)/(l||1),p=(o.top-a.top)/(c||1);n.animatingX=!!u,n.animatingY=!!p,I(n,"transform","translate3d("+u+"px,"+p+"px,0)"),this.forRepaintDummy=ha(n),I(n,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),I(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){I(n,"transition",""),I(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},i)}}}}function ha(s){return s.offsetWidth}function ma(s,e,t,n){return Math.sqrt(Math.pow(e.top-s.top,2)+Math.pow(e.left-s.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var Ke=[],fn={initializeByDefault:!0},qt={mount:function(e){for(var t in fn)fn.hasOwnProperty(t)&&!(t in e)&&(e[t]=fn[t]);Ke.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Ke.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";Ke.forEach(function(i){t[i.pluginName]&&(t[i.pluginName][a]&&t[i.pluginName][a](Ne({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](Ne({sortable:t},n)))})},initializePlugins:function(e,t,n,o){Ke.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,we(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var i=this.modifyOption(e,a,e.options[a]);typeof i<"u"&&(e.options[a]=i)}},getEventProperties:function(e,t){var n={};return Ke.forEach(function(o){typeof o.eventProperties=="function"&&we(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return Ke.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function ya(s){var e=s.sortable,t=s.rootEl,n=s.name,o=s.targetEl,a=s.cloneEl,i=s.toEl,r=s.fromEl,l=s.oldIndex,c=s.newIndex,u=s.oldDraggableIndex,p=s.newDraggableIndex,h=s.originalEvent,v=s.putSortable,S=s.extraEventProperties;if(e=e||t&&t[oe],!!e){var T,A=e.options,U="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Le&&!Bt?T=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(T=document.createEvent("Event"),T.initEvent(n,!0,!0)),T.to=i||t,T.from=r||t,T.item=o||t,T.clone=a,T.oldIndex=l,T.newIndex=c,T.oldDraggableIndex=u,T.newDraggableIndex=p,T.originalEvent=h,T.pullMode=v?v.lastPutMode:void 0;var $=Ne(Ne({},S),qt.getEventProperties(n,e));for(var ue in $)T[ue]=$[ue];t&&t.dispatchEvent(T),A[U]&&A[U].call(e,T)}}var Sa=["evt"],ee=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=ca(n,Sa);qt.pluginEvent.bind(k)(e,t,Ne({dragEl:y,parentEl:q,ghostEl:D,rootEl:F,nextEl:He,lastDownEl:Jt,cloneEl:B,cloneHidden:De,dragStarted:bt,putSortable:J,activeSortable:k.active,originalEvent:o,oldIndex:et,oldDraggableIndex:Tt,newIndex:re,newDraggableIndex:Me,hideGhostForTarget:Bo,unhideGhostForTarget:qo,cloneNowHidden:function(){De=!0},cloneNowShown:function(){De=!1},dispatchSortableEvent:function(r){_({sortable:t,name:r,originalEvent:o})}},a))};function _(s){ya(Ne({putSortable:J,cloneEl:B,targetEl:y,rootEl:F,oldIndex:et,oldDraggableIndex:Tt,newIndex:re,newDraggableIndex:Me},s))}var y,q,D,F,He,Jt,B,De,et,re,Tt,Me,Vt,J,Qe=!1,en=!1,tn=[],Be,ge,pn,hn,uo,go,bt,Ze,wt,Lt=!1,jt=!1,Kt,K,mn=[],On=!1,nn=[],dn=typeof document<"u",Yt=Zn,fo=Bt||Le?"cssFloat":"float",ba=dn&&!Ro&&!Zn&&"draggable"in document.createElement("div"),xo=function(){if(dn){if(Le)return!1;var s=document.createElement("x");return s.style.cssText="pointer-events:auto",s.style.pointerEvents==="auto"}}(),Uo=function(e,t){var n=I(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=lt(e,0,t),i=lt(e,1,t),r=a&&I(a),l=i&&I(i),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Y(a).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Y(i).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&r.float!=="none"){var p=r.float==="left"?"left":"right";return i&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return a&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[fo]==="none"||i&&n[fo]==="none"&&c+u>o)?"vertical":"horizontal"},va=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,i=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||a===l||o+i/2===r+c/2},Ca=function(e,t){var n;return tn.some(function(o){var a=o[oe].options.emptyInsertThreshold;if(!(!a||Qn(o))){var i=Y(o),r=e>=i.left-a&&e<=i.right+a,l=t>=i.top-a&&t<=i.bottom+a;if(r&&l)return n=o}}),n},Fo=function(e){function t(a,i){return function(r,l,c,u){var p=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(a==null&&(i||p))return!0;if(a==null||a===!1)return!1;if(i&&a==="clone")return a;if(typeof a=="function")return t(a(r,l,c,u),i)(r,l,c,u);var h=(i?r:l).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},o=e.group;(!o||Xt(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Bo=function(){!xo&&D&&I(D,"display","none")},qo=function(){!xo&&D&&I(D,"display","")};dn&&!Ro&&document.addEventListener("click",function(s){if(en)return s.preventDefault(),s.stopPropagation&&s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation(),en=!1,!1},!0);var qe=function(e){if(y){e=e.touches?e.touches[0]:e;var t=Ca(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[oe]._onDragOver(n)}}},Na=function(e){y&&y.parentNode[oe]._isOutsideThisEl(e.target)};function k(s,e){if(!(s&&s.nodeType&&s.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(s));this.el=s,this.options=e=we({},e),s[oe]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(s.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Uo(s,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(i,r){i.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!Nt||Zn),emptyInsertThreshold:5};qt.initializePlugins(this,s,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Fo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:ba,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(s,"pointerdown",this._onTapStart):(z(s,"mousedown",this._onTapStart),z(s,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(s,"dragover",this),z(s,"dragenter",this)),tn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),we(this,pa())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Ze=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,y):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(Ma(n),!y&&!(/mousedown|pointerdown/.test(i)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Nt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=he(l,o.draggable,n,!1),!(l&&l.animated)&&Jt!==l)){if(et=de(l),Tt=de(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){_({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),ee("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(p){if(p=he(c,p.trim(),n,!1),p)return _({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),ee("filter",t,{evt:e}),!0}),u)){a&&e.preventDefault();return}o.handle&&!he(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,i=o.options,r=a.ownerDocument,l;if(n&&!y&&n.parentNode===a){var c=Y(n);if(F=a,y=n,q=y.parentNode,He=y.nextSibling,Jt=n,Vt=i.group,k.dragged=y,Be={target:y,clientX:(t||e).clientX,clientY:(t||e).clientY},uo=Be.clientX-c.left,go=Be.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,y.style["will-change"]="all",l=function(){if(ee("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!io&&o.nativeDraggable&&(y.draggable=!0),o._triggerDragStart(e,t),_({sortable:o,name:"choose",originalEvent:e}),ie(y,i.chosenClass,!0)},i.ignore.split(",").forEach(function(u){Po(y,u.trim(),yn)}),z(r,"dragover",qe),z(r,"mousemove",qe),z(r,"touchmove",qe),i.supportPointer?(z(r,"pointerup",o._onDrop),!this.nativeDraggable&&z(r,"pointercancel",o._onDrop)):(z(r,"mouseup",o._onDrop),z(r,"touchend",o._onDrop),z(r,"touchcancel",o._onDrop)),io&&this.nativeDraggable&&(this.options.touchStartThreshold=4,y.draggable=!0),ee("delayStart",this,{evt:e}),i.delay&&(!i.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Bt||Le))){if(k.eventCanceled){this._onDrop();return}i.supportPointer?(z(r,"pointerup",o._disableDelayedDrag),z(r,"pointercancel",o._disableDelayedDrag)):(z(r,"mouseup",o._disableDelayedDrag),z(r,"touchend",o._disableDelayedDrag),z(r,"touchcancel",o._disableDelayedDrag)),z(r,"mousemove",o._delayedDragTouchMoveHandler),z(r,"touchmove",o._delayedDragTouchMoveHandler),i.supportPointer&&z(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,i.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){y&&yn(y),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._disableDelayedDrag),P(e,"touchend",this._disableDelayedDrag),P(e,"touchcancel",this._disableDelayedDrag),P(e,"pointerup",this._disableDelayedDrag),P(e,"pointercancel",this._disableDelayedDrag),P(e,"mousemove",this._delayedDragTouchMoveHandler),P(e,"touchmove",this._delayedDragTouchMoveHandler),P(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):t?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(y,"dragend",this),z(F,"dragstart",this._onDragStart));try{document.selection?Zt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(Qe=!1,F&&y){ee("dragStarted",this,{evt:t}),this.nativeDraggable&&z(document,"dragover",Na);var n=this.options;!e&&ie(y,n.dragClass,!1),ie(y,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),_({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ge){this._lastX=ge.clientX,this._lastY=ge.clientY,Bo();for(var e=document.elementFromPoint(ge.clientX,ge.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ge.clientX,ge.clientY),e!==t);)t=e;if(y.parentNode[oe]._isOutsideThisEl(e),t)do{if(t[oe]){var n=void 0;if(n=t[oe]._onDragOver({clientX:ge.clientX,clientY:ge.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Do(t));qo()}},_onTouchMove:function(e){if(Be){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,i=D&&nt(D,!0),r=D&&i&&i.a,l=D&&i&&i.d,c=Yt&&K&&co(K),u=(a.clientX-Be.clientX+o.x)/(r||1)+(c?c[0]-mn[0]:0)/(r||1),p=(a.clientY-Be.clientY+o.y)/(l||1)+(c?c[1]-mn[1]:0)/(l||1);if(!k.active&&!Qe){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(D){i?(i.e+=u-(pn||0),i.f+=p-(hn||0)):i={a:1,b:0,c:0,d:1,e:u,f:p};var h="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");I(D,"webkitTransform",h),I(D,"mozTransform",h),I(D,"msTransform",h),I(D,"transform",h),pn=u,hn=p,ge=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!D){var e=this.options.fallbackOnBody?document.body:F,t=Y(y,!0,Yt,!0,e),n=this.options;if(Yt){for(K=e;I(K,"position")==="static"&&I(K,"transform")==="none"&&K!==document;)K=K.parentNode;K!==document.body&&K!==document.documentElement?(K===document&&(K=Ce()),t.top+=K.scrollTop,t.left+=K.scrollLeft):K=Ce(),mn=co(K)}D=y.cloneNode(!0),ie(D,n.ghostClass,!1),ie(D,n.fallbackClass,!0),ie(D,n.dragClass,!0),I(D,"transition",""),I(D,"transform",""),I(D,"box-sizing","border-box"),I(D,"margin",0),I(D,"top",t.top),I(D,"left",t.left),I(D,"width",t.width),I(D,"height",t.height),I(D,"opacity","0.8"),I(D,"position",Yt?"absolute":"fixed"),I(D,"zIndex","100000"),I(D,"pointerEvents","none"),k.ghost=D,e.appendChild(D),I(D,"transform-origin",uo/parseInt(D.style.width)*100+"% "+go/parseInt(D.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(ee("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}ee("setupClone",this),k.eventCanceled||(B=Oo(y),B.removeAttribute("id"),B.draggable=!1,B.style["will-change"]="",this._hideClone(),ie(B,this.options.chosenClass,!1),k.clone=B),n.cloneId=Zt(function(){ee("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||F.insertBefore(B,y),n._hideClone(),_({sortable:n,name:"clone"}))}),!t&&ie(y,a.dragClass,!0),t?(en=!0,n._loopId=setInterval(n._emulateDragOver,50)):(P(document,"mouseup",n._onDrop),P(document,"touchend",n._onDrop),P(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,y)),z(document,"drop",n),I(y,"transform","translateZ(0)")),Qe=!0,n._dragStartId=Zt(n._dragStarted.bind(n,t,e)),z(document,"selectstart",n),bt=!0,window.getSelection().removeAllRanges(),Nt&&I(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,i,r=this.options,l=r.group,c=k.active,u=Vt===l,p=r.sort,h=J||c,v,S=this,T=!1;if(On)return;function A(yt,Wo){ee(yt,S,Ne({evt:e,isOwner:u,axis:v?"vertical":"horizontal",revert:i,dragRect:o,targetRect:a,canSort:p,fromSortable:h,target:n,completed:$,onMove:function(no,Vo){return $t(F,t,y,o,no,Y(no),e,Vo)},changed:ue},Wo))}function U(){A("dragOverAnimationCapture"),S.captureAnimationState(),S!==h&&h.captureAnimationState()}function $(yt){return A("dragOverCompleted",{insertion:yt}),yt&&(u?c._hideClone():c._showClone(S),S!==h&&(ie(y,J?J.options.ghostClass:c.options.ghostClass,!1),ie(y,r.ghostClass,!0)),J!==S&&S!==k.active?J=S:S===k.active&&J&&(J=null),h===S&&(S._ignoreWhileAnimating=n),S.animateAll(function(){A("dragOverAnimationComplete"),S._ignoreWhileAnimating=null}),S!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===y&&!y.animated||n===t&&!n.animated)&&(Ze=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(y.parentNode[oe]._isOutsideThisEl(e.target),!yt&&qe(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),T=!0}function ue(){re=de(y),Me=de(y,r.draggable),_({sortable:S,name:"change",toEl:t,newIndex:re,newDraggableIndex:Me,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=he(n,r.draggable,t,!0),A("dragOver"),k.eventCanceled)return T;if(y.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||S._ignoreWhileAnimating===n)return $(!1);if(en=!1,c&&!r.disabled&&(u?p||(i=q!==F):J===this||(this.lastPutMode=Vt.checkPull(this,c,y,e))&&l.checkPut(this,c,y,e))){if(v=this._getDirection(e,n)==="vertical",o=Y(y),A("dragOverValid"),k.eventCanceled)return T;if(i)return q=F,U(),this._hideClone(),A("revert"),k.eventCanceled||(He?F.insertBefore(y,He):F.appendChild(y)),$(!0);var ae=Qn(t,r.draggable);if(!ae||La(e,v,this)&&!ae.animated){if(ae===y)return $(!1);if(ae&&t===e.target&&(n=ae),n&&(a=Y(n)),$t(F,t,y,o,n,a,e,!!n)!==!1)return U(),ae&&ae.nextSibling?t.insertBefore(y,ae.nextSibling):t.appendChild(y),q=t,ue(),$(!0)}else if(ae&&wa(e,v,this)){var xe=lt(t,0,r,!0);if(xe===y)return $(!1);if(n=xe,a=Y(n),$t(F,t,y,o,n,a,e,!1)!==!1)return U(),t.insertBefore(y,xe),q=t,ue(),$(!0)}else if(n.parentNode===t){a=Y(n);var me=0,Ue,ft=y.parentNode!==t,se=!va(y.animated&&y.toRect||o,n.animated&&n.toRect||a,v),pt=v?"top":"left",Ie=lo(n,"top","top")||lo(y,"top","top"),ht=Ie?Ie.scrollTop:void 0;Ze!==n&&(Ue=a[pt],Lt=!1,jt=!se&&r.invertSwap||ft),me=Ia(e,n,a,v,se?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,jt,Ze===n);var Ee;if(me!==0){var Fe=de(y);do Fe-=me,Ee=q.children[Fe];while(Ee&&(I(Ee,"display")==="none"||Ee===D))}if(me===0||Ee===n)return $(!1);Ze=n,wt=me;var mt=n.nextElementSibling,ke=!1;ke=me===1;var Ht=$t(F,t,y,o,n,a,e,ke);if(Ht!==!1)return(Ht===1||Ht===-1)&&(ke=Ht===1),On=!0,setTimeout(Ta,30),U(),ke&&!mt?t.appendChild(y):n.parentNode.insertBefore(y,ke?mt:n),Ie&&zo(Ie,0,ht-Ie.scrollTop),q=y.parentNode,Ue!==void 0&&!jt&&(Kt=Math.abs(Ue-Y(n)[pt])),ue(),$(!0)}if(t.contains(y))return $(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){P(document,"mousemove",this._onTouchMove),P(document,"touchmove",this._onTouchMove),P(document,"pointermove",this._onTouchMove),P(document,"dragover",qe),P(document,"mousemove",qe),P(document,"touchmove",qe)},_offUpEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._onDrop),P(e,"touchend",this._onDrop),P(e,"pointerup",this._onDrop),P(e,"pointercancel",this._onDrop),P(e,"touchcancel",this._onDrop),P(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(re=de(y),Me=de(y,n.draggable),ee("drop",this,{evt:e}),q=y&&y.parentNode,re=de(y),Me=de(y,n.draggable),k.eventCanceled){this._nulling();return}Qe=!1,jt=!1,Lt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Gn(this.cloneId),Gn(this._dragStartId),this.nativeDraggable&&(P(document,"drop",this),P(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Nt&&I(document.body,"user-select",""),I(y,"transform",""),e&&(bt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),D&&D.parentNode&&D.parentNode.removeChild(D),(F===q||J&&J.lastPutMode!=="clone")&&B&&B.parentNode&&B.parentNode.removeChild(B),y&&(this.nativeDraggable&&P(y,"dragend",this),yn(y),y.style["will-change"]="",bt&&!Qe&&ie(y,J?J.options.ghostClass:this.options.ghostClass,!1),ie(y,this.options.chosenClass,!1),_({sortable:this,name:"unchoose",toEl:q,newIndex:null,newDraggableIndex:null,originalEvent:e}),F!==q?(re>=0&&(_({rootEl:q,name:"add",toEl:q,fromEl:F,originalEvent:e}),_({sortable:this,name:"remove",toEl:q,originalEvent:e}),_({rootEl:q,name:"sort",toEl:q,fromEl:F,originalEvent:e}),_({sortable:this,name:"sort",toEl:q,originalEvent:e})),J&&J.save()):re!==et&&re>=0&&(_({sortable:this,name:"update",toEl:q,originalEvent:e}),_({sortable:this,name:"sort",toEl:q,originalEvent:e})),k.active&&((re==null||re===-1)&&(re=et,Me=Tt),_({sortable:this,name:"end",toEl:q,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ee("nulling",this),F=y=q=D=He=B=Jt=De=Be=ge=bt=re=Me=et=Tt=Ze=wt=J=Vt=k.dragged=k.ghost=k.clone=k.active=null,nn.forEach(function(e){e.checked=!0}),nn.length=pn=hn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":y&&(this._onDragOver(e),Ea(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,i=this.options;o<a;o++)t=n[o],he(t,i.draggable,this.el,!1)&&e.push(t.getAttribute(i.dataIdAttr)||Ra(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,i){var r=o.children[i];he(r,this.options.draggable,o,!1)&&(n[a]=r)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return he(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=qt.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Fo(n)},destroy:function(){ee("destroy",this);var e=this.el;e[oe]=null,P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart),P(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),tn.splice(tn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!De){if(ee("hideClone",this),k.eventCanceled)return;I(B,"display","none"),this.options.removeCloneOnHide&&B.parentNode&&B.parentNode.removeChild(B),De=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(De){if(ee("showClone",this),k.eventCanceled)return;y.parentNode==F&&!this.options.group.revertClone?F.insertBefore(B,y):He?F.insertBefore(B,He):F.appendChild(B),this.options.group.revertClone&&this.animate(y,B),I(B,"display",""),De=!1}}};function Ea(s){s.dataTransfer&&(s.dataTransfer.dropEffect="move"),s.cancelable&&s.preventDefault()}function $t(s,e,t,n,o,a,i,r){var l,c=s[oe],u=c.options.onMove,p;return window.CustomEvent&&!Le&&!Bt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=s,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=a||Y(e),l.willInsertAfter=r,l.originalEvent=i,s.dispatchEvent(l),u&&(p=u.call(c,l,i)),p}function yn(s){s.draggable=!1}function Ta(){On=!1}function wa(s,e,t){var n=Y(lt(t.el,0,t.options,!0)),o=Go(t.el,t.options,D),a=10;return e?s.clientX<o.left-a||s.clientY<n.top&&s.clientX<n.right:s.clientY<o.top-a||s.clientY<n.bottom&&s.clientX<n.left}function La(s,e,t){var n=Y(Qn(t.el,t.options.draggable)),o=Go(t.el,t.options,D),a=10;return e?s.clientX>o.right+a||s.clientY>n.bottom&&s.clientX>n.left:s.clientY>o.bottom+a||s.clientX>n.right&&s.clientY>n.top}function Ia(s,e,t,n,o,a,i,r){var l=n?s.clientY:s.clientX,c=n?t.height:t.width,u=n?t.top:t.left,p=n?t.bottom:t.right,h=!1;if(!i){if(r&&Kt<c*o){if(!Lt&&(wt===1?l>u+c*a/2:l<p-c*a/2)&&(Lt=!0),Lt)h=!0;else if(wt===1?l<u+Kt:l>p-Kt)return-wt}else if(l>u+c*(1-o)/2&&l<p-c*(1-o)/2)return ka(e)}return h=h||i,h&&(l<u+c*a/2||l>p-c*a/2)?l>u+c/2?1:-1:0}function ka(s){return de(y)<de(s)?1:-1}function Ra(s){for(var e=s.tagName+s.className+s.src+s.href+s.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Ma(s){nn.length=0;for(var e=s.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&nn.push(n)}}function Zt(s){return setTimeout(s,0)}function Gn(s){return clearTimeout(s)}dn&&z(document,"touchmove",function(s){(k.active||Qe)&&s.cancelable&&s.preventDefault()});k.utils={on:z,off:P,css:I,find:Po,is:function(e,t){return!!he(e,t,e,!1)},extend:ga,throttle:Ao,closest:he,toggleClass:ie,clone:Oo,index:de,nextTick:Zt,cancelNextTick:Gn,detectDirection:Uo,getChild:lt,expando:oe};k.get=function(s){return s[oe]};k.mount=function(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Ne(Ne({},k.utils),n.utils)),qt.mount(n)})};k.create=function(s,e){return new k(s,e)};k.version=da;var j=[],vt,xn,Un=!1,Sn,bn,on,Ct;function Da(){function s(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return s.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):n.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):(P(document,"pointermove",this._handleFallbackAutoScroll),P(document,"touchmove",this._handleFallbackAutoScroll),P(document,"mousemove",this._handleFallbackAutoScroll)),po(),Qt(),fa()},nulling:function(){on=xn=vt=Un=Ct=Sn=bn=null,j.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(a,i);if(on=t,n||this.options.forceAutoScrollFallback||Bt||Le||Nt){vn(t,this.options,r,n);var l=ze(r,!0);Un&&(!Ct||a!==Sn||i!==bn)&&(Ct&&po(),Ct=setInterval(function(){var c=ze(document.elementFromPoint(a,i),!0);c!==l&&(l=c,Qt()),vn(t,o.options,c,n)},10),Sn=a,bn=i)}else{if(!this.options.bubbleScroll||ze(r,!0)===Ce()){Qt();return}vn(t,this.options,ze(r,!1),!1)}}},we(s,{pluginName:"scroll",initializeByDefault:!0})}function Qt(){j.forEach(function(s){clearInterval(s.pid)}),j=[]}function po(){clearInterval(Ct)}var vn=Ao(function(s,e,t,n){if(e.scroll){var o=(s.touches?s.touches[0]:s).clientX,a=(s.touches?s.touches[0]:s).clientY,i=e.scrollSensitivity,r=e.scrollSpeed,l=Ce(),c=!1,u;xn!==t&&(xn=t,Qt(),vt=e.scroll,u=e.scrollFn,vt===!0&&(vt=ze(t,!0)));var p=0,h=vt;do{var v=h,S=Y(v),T=S.top,A=S.bottom,U=S.left,$=S.right,ue=S.width,ae=S.height,xe=void 0,me=void 0,Ue=v.scrollWidth,ft=v.scrollHeight,se=I(v),pt=v.scrollLeft,Ie=v.scrollTop;v===l?(xe=ue<Ue&&(se.overflowX==="auto"||se.overflowX==="scroll"||se.overflowX==="visible"),me=ae<ft&&(se.overflowY==="auto"||se.overflowY==="scroll"||se.overflowY==="visible")):(xe=ue<Ue&&(se.overflowX==="auto"||se.overflowX==="scroll"),me=ae<ft&&(se.overflowY==="auto"||se.overflowY==="scroll"));var ht=xe&&(Math.abs($-o)<=i&&pt+ue<Ue)-(Math.abs(U-o)<=i&&!!pt),Ee=me&&(Math.abs(A-a)<=i&&Ie+ae<ft)-(Math.abs(T-a)<=i&&!!Ie);if(!j[p])for(var Fe=0;Fe<=p;Fe++)j[Fe]||(j[Fe]={});(j[p].vx!=ht||j[p].vy!=Ee||j[p].el!==v)&&(j[p].el=v,j[p].vx=ht,j[p].vy=Ee,clearInterval(j[p].pid),(ht!=0||Ee!=0)&&(c=!0,j[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(on);var mt=j[this.layer].vy?j[this.layer].vy*r:0,ke=j[this.layer].vx?j[this.layer].vx*r:0;typeof u=="function"&&u.call(k.dragged.parentNode[oe],ke,mt,s,on,j[this.layer].el)!=="continue"||zo(j[this.layer].el,ke,mt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&h!==l&&(h=ze(h,!1)));Un=c}},30),Ho=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||a;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(p)&&(i("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function _n(){}_n.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=lt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Ho};we(_n,{pluginName:"revertOnSpill"});function eo(){}eo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Ho};we(eo,{pluginName:"removeOnSpill"});k.mount(new Da);k.mount(eo,_n);var st;const m=class m{static registerSettings(){const e=b();g.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{const c=l[1];g.log("Registering... ",[l],!0);const u={name:c.label,hint:c.hint,default:c.default,type:c.propType,scope:c.scope,config:c.config,requiresReload:c.requiresReload||!1,onChange:p=>m.apply(c.tag,p)};(c.choices||c.options)&&(u.choices=c.choices||c.options),await game.settings.register(ne,c.tag,u),m.get(c.tag)===void 0&&(g.log("resetting...",[c.tag]),m.set(c.tag,c.default))}),game.keybindings.register(ne,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{m.hideInterface()},restricted:!1}),m.applyThemeSettings(),m.applyCustomCSS(),m.applyModuleAdjustments(),Object.entries(ia()).forEach(async l=>{const c=l[1],u={name:c.tag,label:c.label,hint:c.hint,icon:c.icon,type:c.propType,restricted:c.restricted};await game.settings.registerMenu(ne,c.tag,u)}),Hooks.on(x.RENDER_SCENE_CONTROLS,m.applyLeftControlsSettings),Hooks.on(x.RENDER_PLAYERS_LIST,m.applyPlayersListSettings),Hooks.on(x.RENDER_HOTBAR,()=>{m.firstLoad&&(m.firstLoad=!1,m.applyHotBarCollapse()),m.applyHotBarSettings()}),m.applyDebugSettings(),m.applyChatStyles(),m.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.cameraDockMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.customFontsMenu.fields.forEach(l=>{m.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{m.applyLeftControlsSettings(e[l].tag)}),m.applyUiScale()}static get(e,t=ne){if(!e)return null;let n=!1;if(t===ne)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,g.log("GET Setting",[a,n])}return n}static set(e,t,n=ne){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),g.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{g.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,i,r;const n=b();switch(t===void 0&&(t=m.get(e)),g.log("SettingsUtil.apply",[e,t,m.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:m.applyHotBarSettings();break;case n.collapseMacroBar.tag:m.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:m.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:m.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:case n.hideFoundryLogo.tag:m.applyLeftControlsSettings(e,t);break;case n.enableFloatingDock.tag:Z.currSettings.enableFloatingDock=t;break;case n.dockHeight.tag:Z.currSettings.dockHeight=t,m.applyCameraHeight(t);break;case n.dockWidth.tag:Z.currSettings.dockWidth=t,m.applyCameraWidth(t);break;case n.dockPosX.tag:Z.currSettings.dockPosX=t,m.applyCameraPosX(t);break;case n.dockPosY.tag:Z.currSettings.dockPosY=t,m.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:Z.currSettings.defaultVideoWidth=t,Z.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:Z.currSettings.dockResizeOnUserJoin=t,Z.applyDockResize(t);break;case n.chatBorderColor.tag:rt.chatBorderColor=m.get(n.chatBorderColor.tag),m.applyBorderColors();break;case n.enableChatStyles.tag:rt.enableChatStyles=m.get(n.enableChatStyles.tag),m.applyChatStyles();break;case n.enforceDarkMode.tag:m.resetFoundryThemeSettings();break;case n.debugMode.tag:m.applyDebugSettings();break;case n.sceneNavEnabled.tag:Q.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:Q.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:Q.navShowRootFolders=t;break;case n.sceneClickToView.tag:Q.sceneClickToView=t,(o=game.scenes)==null||o.directory.render();break;case n.useSceneIcons.tag:Q.useSceneIcons=t,(a=game.scenes)==null||a.directory.render();break;case n.useSceneBackButton.tag:Q.useSceneBackButton=t,(i=ui.nav)==null||i.render();break;case n.useScenePreview.tag:Q.useScenePreview=t,(r=ui.nav)==null||r.render();break;case n.sceneNavAlias.tag:Q.sceneNavAlias=t;break;case n.navStartCollapsed.tag:Q.navStartCollapsed=t;break;case n.showFolderListOnClick.tag:Q.showFolderListOnClick=t;break;case n.showNavOnHover.tag:Q.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:Q.isCollapsed=m.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:m.applySceneNavPos();break;case n.colorTheme.tag:m.applyThemeSettings();break;case n.customStyles.tag:m.applyCustomCSS();break;case n.adjustOtherModules.tag:m.applyModuleAdjustments();break;case n.otherModulesList.tag:m.applyOtherModulesList();break;case n.uiScale.tag:m.applyUiScale(t);break}}static applyBorderColors(){const e=b(),t=m.get(e.chatBorderColor.tag),n=document.querySelector("body");t===it.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===it.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=b(),t=m.get(e.enableChatStyles.tag),n=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=b(),t=m.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=b();m.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const n=b(),o=m.get(n.sceneNavEnabled.tag),a=document.querySelector("#ui-left"),i=document.querySelector("#ui-left #logo"),r=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:m.get(n.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break;case n.hideFoundryLogo.tag:const c=window.getComputedStyle(r).getPropertyValue("--top-nav-height")||"0px",u=parseFloat(c)||0,p=m.get(n.hideFoundryLogo.tag);g.log("applyLeftControlsSettings",[e,u,c]),p===void 0||p===!0?(i.classList.remove("visible"),M.addCSSVars("--ui-top-padding",`${u}px`),document.querySelector("body").classList.remove("logo-visible")):(i.classList.add("visible"),o?(M.addCSSVars("--ui-top-padding",`${72+u}px`),document.querySelector("body").classList.add("logo-visible")):M.addCSSVars("--ui-top-padding","72px"));break;case n.controlsBottomBuffer.tag:m.applyControlsBuffer();break;case n.controlsIconSize.tag:m.applyControlIconSize();break}}static applyControlIconSize(){const e=b(),t=m.get(e.controlsIconSize.tag);document.querySelector("body");const n=We[t]?We[t].size:We.regular.size;function o(a){switch(a){case We.large.name:return"var(--font-size-18);";case We.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[n]),M.addCSSVars("--icon-font-size",o(t)),M.addCSSVars("--left-control-item-size",n),m.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyUiScale(e){var o,a,i,r,l,c;const t=b(),n=e||m.get(t.uiScale.tag);n===Cn.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(a=document.querySelector("#interface"))==null||a.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),M.addCSSVars("--macro-size","50px")):n===Cn.large.name?((i=document.querySelector("#interface"))==null||i.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),m.set(t.controlsIconSize.tag,n),M.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(c=document.querySelector("#interface"))==null||c.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),M.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=b(),t=m.get(e.controlsBottomBuffer.tag),n=isNaN(t)?e.controlsBottomBuffer.default:t;g.log("applyControlsBuffer",[n,t]),M.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,n;const e=b();g.log("applyPlayersListSettings",[document.querySelector("#players"),m.get(e.autoHidePlayerList.tag)]),m.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),tt.checkPlayersList()}static applySceneNavPos(e){const t=b();Q.navPos=e||m.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=b(),n=m.get(t.dockPosX.tag),o=e||n;Z.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=b(),n=m.get(t.dockPosY.tag),o=e||n;Z.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=b(),n=m.get(t.dockWidth.tag),o=e||n;Z.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=b(),n=m.get(t.dockHeight.tag),o=e||n;Z.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=b(),o=n.customFontsMenu.fields,a={};switch(g.log("applyCustomFonts",[e,t]),o.forEach(i=>{a[i]=m.get(n[i].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:M.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:M.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:M.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:M.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var i,r;const e=b(),t=M.isModuleOn("monks-player-settings"),n=M.isModuleOn("force-client-settings"),o=m.get(e.enforceDarkMode.tag);if(o&&t){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","colorScheme");g.log("resetFoundryThemeSettings",[a,o]),a===!1&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=b();g.debugOn=e||m.get(t.debugMode.tag)}};st=new WeakMap,R(m,st,!1),E(m,"firstLoad",!0),E(m,"applyThemeSettings",e=>{const t=b(),n=e||m.get(t.colorTheme.tag)||"",o=document.querySelector("body");g.log("applyThemeSettings",[e,n,m.get(t.colorTheme.tag)]),Re.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),E(m,"applyCustomCSS",e=>{const t=b(),n=e||m.get(t.customStyles.tag)||"";M.addCustomCSS(n)}),E(m,"applyModuleAdjustments",e=>{const t=b();(e||m.get(t.adjustOtherModules.tag)||!1)&&tt.addModuleClasses()}),E(m,"applyOtherModulesList",e=>{const t=b(),n=e||m.get(t.otherModulesList.tag);g.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?m.set(t.adjustOtherModules.tag,!1):m.set(t.adjustOtherModules.tag,!0),tt.addModuleClasses()}),E(m,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");C(m,st)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),O(m,st,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),O(m,st,!0))});let N=m;class to{static init(){Hooks.on(x.RENDER_PLAYERS_LIST,to.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const n=e.offsetHeight;M.addCSSVars("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var Ae,Ut,Ft;const V=class V{static init(){g.log("LeftControls - init",[]),Hooks.on(x.RENDER_SCENE_CONTROLS,V.initSceneControls),V.initSceneControls()}static resetLocalVars(){O(V,Ae,document.querySelector("#ui-left #controls")),O(V,Ut,document.querySelector("#ui-left"))}static initSceneControls(){g.log("initSceneControls",[]),V.resetLocalVars(),V.observeControlsWidth()}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!C(V,Ae))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};O(V,Ft,new ResizeObserver(n=>{t(()=>V.updateCSSVars(),250)})),C(V,Ft).observe(C(V,Ae),{box:"border-box"}),V.updateCSSVars()}static updateCSSVars(){if(!C(V,Ae))return;let e=parseInt(C(V,Ut).offsetWidth),t=parseInt(C(V,Ae).offsetWidth),n=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&M.addCSSVars("--ui-controls-margin-left",n+"px")}};Ae=new WeakMap,Ut=new WeakMap,Ft=new WeakMap,R(V,Ae),R(V,Ut),R(V,Ft);let Fn=V;const It=class It{static getUpdateNewsUrl(){var t;const e=(t=game.modules.get("crlngn-ui"))==null?void 0:t.version;if(g.log("getUpdateNewsUrl",[e]),e){const n=`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`;return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(n)}&v=${e}`}else return""}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=b();N.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=b();try{const t=It.getUpdateNewsUrl();if(!t)return;const n=new AbortController,o=setTimeout(()=>n.abort(),1e4);try{const a=await N.get(e.lastUpdateId.tag),i=await It.getIdFromRawJson();if(g.log("checkForUpdates...",[i,a]),a===i)return;const r=await fetch(t,{signal:n.signal,mode:"cors",credentials:"omit"});if(clearTimeout(o),!r.ok){g.warn("checkForUpdates | Failed to fetch update news",[r.status,r.statusText]);return}const l=await r.json();await this.displayUpdateNews(l),N.set(e.lastUpdateId.tag,l.id),g.log("checkForUpdates | SUCCESS",[l.id])}catch(a){clearTimeout(o),a.name==="AbortError"?g.warn("checkForUpdates | Request timed out",[a]):g.warn("checkForUpdates | Fetch error",[a.message])}}catch(t){g.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;g.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});g.error("displayUpdateNews | Chat message created",[n,e])}catch(t){g.error("displayUpdateNews | Error creating chat message",[t])}}};E(It,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/main/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let Bn=It;class Pa{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var cn;const kt=class kt{static init(){Hooks.once(x.INIT,()=>{var n,o;document.querySelector("body").classList.add(ne),(n=document.querySelector("#ui-middle"))==null||n.classList.add(ne),g.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},N.registerSettings();const e=b(),t=N.get(e.disableUI.tag);if(g.log(x.INIT,[t]),t){document.querySelector("body").classList.remove(ne),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(ne);return}Q.init(),Z.init(),to.init(),Fn.init(),rt.init(),Hooks.on(x.RENDER_CHAT_MESSAGE,C(kt,cn))}),Hooks.once(x.READY,()=>{g.log("Core Ready",[]);const e=b();var t=N.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Pa.init(),tt.init(),Bn.init(),N.get(e.enableChatStyles.tag)&&kt.addCSSLocalization(),N.resetFoundryThemeSettings(),N.applyOtherModulesList(),M.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";M.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),M.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),M.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),M.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),M.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),M.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),M.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),M.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),M.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),M.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};cn=new WeakMap,R(kt,cn,(e,t)=>{g.log(x.RENDER_CHAT_MESSAGE,[e,t]),rt.enrichCard(e,t)});let qn=kt;qn.init();
//# sourceMappingURL=crlngn-ui.js.map
