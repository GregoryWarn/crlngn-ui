var ss=Object.defineProperty;var yo=a=>{throw TypeError(a)};var as=(a,e,t)=>e in a?ss(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var w=(a,e,t)=>as(a,typeof e!="symbol"?e+"":e,t),kn=(a,e,t)=>e.has(a)||yo("Cannot "+t);var p=(a,e,t)=>(kn(a,e,"read from private field"),t?t.call(a):e.get(a)),L=(a,e,t)=>e.has(a)?yo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),O=(a,e,t,n)=>(kn(a,e,"write to private field"),n?n.call(a,t):e.set(a,t),t),H=(a,e,t)=>(kn(a,e,"access private method"),t);const U={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},me="crlngn-ui",sn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],bn=class bn{static log(e="",t=[],n=!1){try{const o=bn.debugOn;if(!(n||o))return;console.log(...sn,e,...t)}catch{console.log(...sn,e,...t)}}static warn(e="",t=[]){console.warn(...sn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...sn,e)}};w(bn,"debugOn",!1);let f=bn;const R={select:"select",checkbox:"checkbox",text:"text",number:"number"},P={client:"client",world:"world"},Ze={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},zn={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},vt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Qe={noButton:{name:"noButton"},lastScene:{name:"lastScene"},defaultScenes:{name:"defaultScenes"}},xe=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function E(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:R.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:P.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:P.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:R.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:vt.playerColor.name},scope:P.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:R.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:Ze.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:P.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:R.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:R.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:R.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:R.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:R.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:R.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:P.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:R.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navShowRootFolders","sceneClickToView","useSceneIcons","sceneNavAlias","navStartCollapsed","showNavOnHover","useNavBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,sceneNavAlias:"",showFolderListOnClick:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useNavBackButton:Qe.lastScene.name},scope:P.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:P.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:R.select,propType:String,default:zn.small.name,scope:P.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:P.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:P.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:P.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:P.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.world,config:!1},useNavBackButton:{tag:"use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.hint"),propType:String,inputType:R.select,options:{noButton:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.noButton"),lastScene:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.lastScene"),defaultScenes:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.defaultScenes")},default:Qe.lastScene.name,scope:P.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:R.text,default:"",scope:P.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:R.number,default:0,scope:P.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:P.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:P.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:P.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:P.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:P.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:R.text,propType:String,default:"",scope:P.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:P.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:R.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:P.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:R.text,propType:String,default:"",scope:P.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:R.text,default:vt.playerColor.name,scope:P.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:P.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:R.number,default:200,scope:P.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:R.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:Ze.small.name,scope:P.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:P.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:R.checkbox,propType:Boolean,default:!0,scope:P.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:P.world,config:!1,default:""}}}const{ApplicationV2:is,HandlebarsApplicationMixin:rs}=foundry.applications.api;var Nt,Io,ko;const Ce=class Ce extends rs(is){static get DEFAULT_OPTIONS(){return{id:E().cameraDockMenu.tag,actions:{redefine:H(Ce,Nt,ko)},form:{handler:H(Ce,Nt,Io),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=E(),n={...T.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){f.log("_onRender",[e,t]),Ce.element=this.element,Ce.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ce.element.querySelectorAll("p.hint").forEach(o=>o.classList.toggle("shown"))})}};Nt=new WeakSet,Io=async function(e,t,n){const o=E();let s=T.get(o.cameraDockMenu.tag),i=s.enableFloatingDock;e.preventDefault(),e.stopPropagation();const r=n.object;r.hasOwnProperty("enableFloatingDock")||(r.enableFloatingDock=!1);const l=foundry.utils.expandObject(r);await T.set(o.cameraDockMenu.tag,l),s=T.get(o.cameraDockMenu.tag),f.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,l,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.enableFloatingDock!=i&&location.reload()},ko=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.cameraDockMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),f.log("#onReset",[e,t,n.cameraDockMenu.default])},L(Ce,Nt),w(Ce,"element"),w(Ce,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Un=Ce;const{ApplicationV2:ls,HandlebarsApplicationMixin:cs}=foundry.applications.api;var no,Ct,Mo,Ro;const Ee=class Ee extends cs(ls){static get DEFAULT_OPTIONS(){return{id:E().chatMessagesMenu.tag,actions:{redefine:H(Ee,Ct,Ro)},form:{handler:H(Ee,Ct,Mo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=E(),n=t.chatMessagesMenu.fields,o={},s={},i={};n.forEach(c=>{if(f.log("_prepareContext",[t[c].oldName]),t[c]){const u=T.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}}),f.log("_prepareContext",[s,i]);const r={...s,default:{...i},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E();Ee.element=this.element,Ee.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ee.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const s=T.get(n.chatMessagesMenu.tag);f.log("_onRender",[e,t,s])}};no=new WeakMap,Ct=new WeakSet,Mo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.chatMessagesMenu.fields,i=n.object;s.forEach(u=>{o[u].inputType==="checkbox"&&!i.hasOwnProperty(u)&&(i[u]=!1)});const r=foundry.utils.expandObject(i),l=T.get(o.chatBorderColor.tag);f.log("Compared settings:",[r.chatBorderColor,l]),s.forEach(u=>{f.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&T.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ro=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.chatMessagesMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},L(Ee,Ct),L(Ee,no),w(Ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Bn=Ee;class A{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!/FontAwesome|Font Awesome|FoundryVTT/.test(i)).map(i=>i.replace(/['"]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const m=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,m.prepend(n)}let o=n.textContent,s=o.indexOf("body.crlngn-ui {"),i=o.indexOf("}",s);s===-1&&(o=`body.crlngn-ui {
}
`,s=0,i=o.indexOf("}"));const l=o.substring(s+16,i).split(";").map(m=>m.trim()).filter(m=>m!==""),c={};l.forEach(m=>{const N=m.split(":");if(N.length>=2){const b=N[0].trim(),v=N.slice(1).join(":").trim();b&&(c[b]=v)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([m,N])=>`  ${m}: ${N};`).join(`
`),h=o.substring(0,s)+`body.crlngn-ui {
`+u+`
}`+o.substring(i+1);n.textContent=h}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}}w(A,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([n])=>n);const t=new Set;for(const n of document.styleSheets)try{if(n.ownerNode){const o=n.href||"",s=o.includes("/css/")||o.includes("/styles/"),i=o.includes("/modules/crlngn-ui/");if(o&&!s&&!i){f.log("Skipping non-core/module stylesheet:",[o]);continue}let r="";if(n.ownerNode instanceof Element){if(n.ownerNode.tagName==="STYLE")r=n.ownerNode.textContent;else if(n.ownerNode.tagName==="LINK")try{const u=n.cssRules||n.rules;r=Array.from(u).map(h=>h.cssText).join(`
`)}catch(u){f.warn("Could not read stylesheet rules:",[u])}}f.log("Processing stylesheet:",[o||"inline style"]);const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let c;for(;(c=l.exec(r))!==null;){let u=c[1];if(u.includes("fonts.googleapis.com")){const h=u.match(/family=([^&]+)/);h&&decodeURIComponent(h[1]).split("|").map(N=>N.split(":")[0].replace(/\+/g," ")).forEach(N=>{t.add(N)})}else{if(u.startsWith("./")||u.startsWith("../")){f.log("Skipping relative import:",[u]);continue}let h=u;try{const m=await fetch(h);if(!m.ok){f.warn("Error loading imported CSS:",[m.status]);continue}const b=(await m.text()).match(/@font-face\s*{[^}]+}/g);if(!b)continue;b.forEach(v=>{const I=v.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(I&&I[1]){const z=I[1].trim();t.add(z)}})}catch(m){f.warn("Error processing imported CSS:",[m])}}}}if(!n.href||n.href.startsWith(window.location.origin))try{const o=n.cssRules||n.rules;for(const s of o)if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(i)}}catch(o){f.warn("Could not read stylesheet rules:",[o])}}catch(o){f.warn("Error processing stylesheet:",[o])}return t}),w(A,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:ds,HandlebarsApplicationMixin:us}=foundry.applications.api;var oo,je,Do,Po,Ao;const se=class se extends us(ds){static get DEFAULT_OPTIONS(){return{id:E().customFontsMenu.tag,actions:{redefine:H(se,je,Ao)},form:{handler:H(se,je,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=E(),n=t.customFontsMenu.fields,o={},s={},i={};return n.forEach(l=>{if(t[l]){const c=T.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}}),{...s,default:{...i},fontList:await A.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){se.element=this.element,se.element.querySelector(".toggle-hint").addEventListener("click",()=>{se.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))}),se.element.querySelectorAll('input[type="text"]').forEach(i=>{const r=i.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const c=()=>{var u;H(u=se,je,Po).call(u),l.classList.add("active")};i.addEventListener("focus",c),i.addEventListener("click",c),i.addEventListener("keydown",u=>{const h=l.classList.contains("active"),m=Array.from(l.querySelectorAll(".dropdown-option"));let N=m.findIndex(b=>b.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),h||l.classList.add("active"),m.forEach(b=>b.classList.remove("highlighted")),N===-1?N=u.key==="ArrowDown"?0:m.length-1:N=u.key==="ArrowDown"?(N+1)%m.length:(N-1+m.length)%m.length,m[N]&&(m[N].classList.add("highlighted"),m[N].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),h&&N!==-1&&m[N]&&m[N].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),se.element.querySelectorAll(".dropdown-option").forEach(i=>{i.addEventListener("mouseenter",()=>{i.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),i.classList.add("highlighted")}),i.addEventListener("click",r=>{const l=i.closest(".dropdown-wrapper").querySelector("input");let c=i.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,i.closest(".dropdown-options").classList.remove("active")})})}};oo=new WeakMap,je=new WeakSet,Do=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,i=foundry.utils.expandObject(n.object);s.forEach(r=>{i[r]!==void 0&&(f.log("Saving setting:",[i[r]]),T.set(o[r].tag,i[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Po=function(){se.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Ao=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),i=n.customFontsMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},L(se,je),L(se,oo),w(se,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Hn=se;const{ApplicationV2:gs,HandlebarsApplicationMixin:fs}=foundry.applications.api;var so,Et,Fo,Oo;const we=class we extends fs(gs){static get DEFAULT_OPTIONS(){return{id:E().leftControlsMenu.tag,actions:{redefine:H(we,Et,Oo)},form:{handler:H(we,Et,Fo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=E(),n=t.leftControlsMenu.fields,o={},s={},i={};n.forEach(l=>{if(t[l]){const c=T.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}});const r={...s,default:{...i},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E();we.element=this.element,we.element.querySelector(".toggle-hint").addEventListener("click",()=>{we.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const s=T.get(n.leftControlsMenu.tag);f.log("_onRender",[e,t,s])}};so=new WeakMap,Et=new WeakSet,Fo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.leftControlsMenu.fields,i=foundry.utils.expandObject(n.object);s.forEach(r=>{i[r]!==void 0&&(f.log("Saving setting:",[i[r]]),T.set(o[r].tag,i[r]))}),await T.set(o.leftControlsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),f.log("#onReset",[e,t,n.leftControlsMenu.default])},L(we,Et),L(we,so),w(we,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let qn=we;const{ApplicationV2:ps,HandlebarsApplicationMixin:hs}=foundry.applications.api;var ao,wt,Go,xo,Ut,jn;const Le=class Le extends hs(ps){constructor(){super(...arguments);L(this,Ut)}static get DEFAULT_OPTIONS(){return{id:E().sceneNavMenu.tag,actions:{redefine:H(Le,wt,xo)},form:{handler:H(Le,wt,Go),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=E(),o=n.sceneNavMenu.fields,s={},i={},r={};o.forEach(c=>{if(n[c]){const u=T.get(n[c].tag);s[c]=n[c],i[c]=u!==void 0?u:n[c].default,r[c]=n[c].default}});const l={...i,default:{...r},fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var i;f.log("_onRender",[t,n]),Le.element=this.element,Le.element.querySelector(".toggle-hint").addEventListener("click",()=>{Le.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(i=this.element)==null?void 0:i.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",H(this,Ut,jn).bind(this)),H(this,Ut,jn).call(this,{target:s}))}};ao=new WeakMap,wt=new WeakSet,Go=async function(t,n,o){t.preventDefault(),t.stopPropagation();const s=E(),i=s.sceneNavMenu.fields;let r=T.get(s.sceneNavEnabled.tag),l=T.get(s.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);i.forEach(m=>{c[m]!==void 0&&(f.log("Saving setting:",[c[m]]),T.set(s[m].tag,c[m]))});let u=T.get(s.sceneNavEnabled.tag),h=T.get(s.navFoldersEnabled.tag);f.log("Saving settings...",[r,u]),await T.set(s.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==h)&&location.reload()},xo=async function(t,n){const o=E(),i=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;i.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),f.log("#onReset",[t,n,o.sceneNavMenu.default])},Ut=new WeakSet,jn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(s=>s.disabled=!t.target.checked),f.log("onSceneNavEnabledChange",[this.element,n])},L(Le,wt),L(Le,ao),w(Le,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Vn=Le;const{ApplicationV2:ms,HandlebarsApplicationMixin:ys}=foundry.applications.api;var io,ro,$e,zo,Uo,Bo;const Q=class Q extends ys(ms){static get DEFAULT_OPTIONS(){return{id:E().themeAndStylesMenu.tag,actions:{redefine:H(Q,$e,Bo)},form:{handler:H(Q,$e,zo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=E(),n=t.themeAndStylesMenu.fields,o={},s={},i={};n.forEach(c=>{if(t[c]){const u=T.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}});const r=xe.find(c=>c.className===s.colorTheme);s.colorTheme=(r==null?void 0:r.label)||xe[0].label;const l={...s,default:{...i},fields:{...o},selectedTheme:r,themes:xe,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...s},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){Q.element=this.element,Q.element.querySelector(".toggle-hint").addEventListener("click",()=>{Q.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=xe,Q.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const h=u.closest(".dropdown-wrapper"),m=h==null?void 0:h.querySelector(".dropdown-options");if(!h||!m)return;const N=()=>{var b;H(b=Q,$e,Uo).call(b),m.classList.add("active")};u.addEventListener("focus",N),u.addEventListener("click",N),u.addEventListener("keydown",b=>{const v=m.classList.contains("active"),I=Array.from(m.querySelectorAll(".dropdown-option"));let z=I.findIndex(B=>B.classList.contains("highlighted"));b.key==="ArrowDown"||b.key==="ArrowUp"?(b.preventDefault(),v||m.classList.add("active"),I.forEach(B=>B.classList.remove("highlighted")),z===-1?z=b.key==="ArrowDown"?0:I.length-1:z=b.key==="ArrowDown"?(z+1)%I.length:(z-1+I.length)%I.length,I[z]&&(I[z].classList.add("highlighted"),I[z].scrollIntoView({block:"nearest"}))):b.key==="Enter"?(b.preventDefault(),v&&z!==-1&&I[z]&&I[z].click()):b.key==="Escape"&&m.classList.remove("active")}),document.addEventListener("click",b=>{h.contains(b.target)||m.classList.remove("active")})});const s=Q.element.querySelectorAll(".dropdown-option"),i=this;s.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(m=>m.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(h){f.log("option",[u,u.querySelector(".theme-name")]);const m=u.closest(".dropdown-wrapper").querySelector("input");let N=u.querySelector(".theme-name").innerHTML.toString();if(m.value=N,m.name==="colorTheme"){const v=i._themes.find(I=>I.label===N);i._selectedTheme=v,i._updateThemePreview(v)}u.closest(".dropdown-options").classList.remove("active")})});const r=Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=Q.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",h=>{const m=h.currentTarget;let b=`${l.value}`.split(",")||[],v=b.indexOf(m.value);!h.currentTarget.checked&&v>-1?b.splice(v,1):h.currentTarget.checked&&v===-1&&b.push(m.value),l.value=b.join(","),f.log("checkbox changed",[b,l.value])})}),Q.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(m=>{m.checked=u.currentTarget.checked;const N=new Event("change",{bubbles:!0});m.dispatchEvent(N)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};io=new WeakMap,ro=new WeakMap,$e=new WeakSet,zo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.themeAndStylesMenu.fields,i=foundry.utils.expandObject(n.object),r=xe.find(l=>l.label===i.colorTheme);i.colorTheme=r?r.className:"",s.forEach(l=>{i[l]!==void 0&&(f.log("Saving setting:",[i[l]]),T.set(o[l].tag,i[l]))}),T.set(o.themeAndStylesMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Uo=function(){Q.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Bo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),i=n.themeAndStylesMenu.fields,r={};i.forEach(c=>{n[c]&&(n[c],r[c]=n[c].default)});const l=xe.find(c=>c.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||xe[0].label,s.forEach(c=>{c.value=r[c.name]})},L(Q,$e),L(Q,io),L(Q,ro,!1),w(Q,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let $n=Q;function vs(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Hn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:$n,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Bn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:qn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Un,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:Vn,restricted:!1}}}var Bt,Ht,qt,Vt,jt,$t,Wt,ie,Wn,Yn,Xn,Kn;const S=class S{static init(){const e=E(),t=T.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(U.RENDER_CAMERA_VIEWS,S.onRenderFloating),f.log("CameraUtil",[t]),S.onRenderFloating()):(Hooks.on(U.RENDER_CAMERA_VIEWS,S.onRenderPlain),S.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var s,i,r;const e=E(),t=T.get(e.cameraDockMenu.tag);(s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-ui"),S.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");f.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),S.cameraContainer&&o&&n&&((i=S.cameraContainer)==null||i.insertBefore(n,o),(r=document.querySelector("#camera-views .camera-container"))==null||r.classList.add("visible")),S.makeDraggable(),S.makeResizeable(),S.resetPositionAndSize(),S.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(f.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=S.cameraContainer)==null||e.addEventListener("mousedown",t=>{var s,i;const n=document.querySelector("body.crlngn-ui");if((s=t.target.parentNode)!=null&&s.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",H(S,ie,Yn)),n==null||n.addEventListener("mouseup",H(S,ie,Wn));const o=A.getOffsetBottom(S.cameraContainer);S.isDragging=!0,O(S,Bt,t.clientX-((i=S.cameraContainer)==null?void 0:i.offsetLeft)),O(S,Ht,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(S.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),S.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),S.isResizing=!0,O(S,qt,n.clientX),O(S,Vt,n.clientY),O(S,Wt,parseInt(getComputedStyle(S.cameraContainer).bottom)||0),O(S,jt,S.cameraContainer.offsetWidth),O(S,$t,S.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",H(S,ie,Xn)),e==null||e.addEventListener("mouseup",H(S,ie,Kn))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const s=E(),i=T.get(s.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!S.cameraContainer))if(!e&&!t&&!n&&!o){const r=i.dockPosX||0,l=i.dockPosY||0,c=i.dockWidth||0,u=i.dockHeight||0;S.cameraContainer.style.left=`${r}px`,S.cameraContainer.style.bottom=`${l}px`,S.cameraContainer.style.width=`${c}px`,S.cameraContainer.style.height=`${u}px`}else e&&(S.cameraContainer.style.left=`${e}px`),t&&(S.cameraContainer.style.bottom=`${t}px`),n&&(S.cameraContainer.style.width=`${n}px`),o&&(S.cameraContainer.style.height=`${o}px`)}};Bt=new WeakMap,Ht=new WeakMap,qt=new WeakMap,Vt=new WeakMap,jt=new WeakMap,$t=new WeakMap,Wt=new WeakMap,ie=new WeakSet,Wn=function(e){var o,s;const t=E(),n={...T.get(t.cameraDockMenu.tag)};if(S.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=S.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=S.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.cameraDockMenu.tag,n),i==null||i.removeEventListener("mousemove",H(S,ie,Yn)),i==null||i.removeEventListener("mouseup",H(S,ie,Wn)),S.isDragging=!1,e.stopPropagation()}},Yn=function(e){if(S.isDragging&&(f.log("mousemove",[e.target.parentNode]),S.cameraContainer)){let t=e.clientX-p(S,Bt),n=window.innerHeight-e.clientY-p(S,Ht);t+S.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-S.cameraContainer.offsetWidt),S.cameraContainer.style.left=`${t}px`,n+S.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-S.cameraContainer.offsetHeight),S.cameraContainer.style.bottom=`${n}px`}},Xn=function(e){if(!S.isResizing)return;const t=p(S,jt)+(e.clientX-p(S,qt)),n=e.clientY-p(S,Vt),o=p(S,$t)+n,s=p(S,Wt)-n;S.cameraContainer.style.width=`${t}px`,S.cameraContainer.style.height=`${o}px`,S.cameraContainer.style.bottom=`${s}px`},Kn=function(){var o,s,i,r,l,c;const e=E(),t={...T.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");S.isResizing=!1,n==null||n.removeEventListener("mousemove",H(S,ie,Xn)),n==null||n.removeEventListener("mouseup",H(S,ie,Kn)),f.log("onStopResize",[(o=S.cameraContainer)==null?void 0:o.style.width,(s=S.cameraContainer)==null?void 0:s.style.height,(i=S.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((r=S.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=S.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=S.cameraContainer)==null?void 0:c.style.bottom)||0),T.set(e.cameraDockMenu.tag,t)},L(S,ie),L(S,Bt,0),L(S,Ht,0),w(S,"isDragging",!1),w(S,"cameraContainer"),w(S,"isResizing",!1),L(S,qt,0),L(S,Vt,0),L(S,jt,0),L(S,$t,0),L(S,Wt,0);let Je=S;const Te=class Te{static init(){const e=E();Te.enableChatStyles=T.get(e.enableChatStyles.tag),Te.chatBorderColor=T.get(e.chatBorderColor.tag)}};w(Te,"chatBorderColor"),w(Te,"enableChatStyles"),w(Te,"enrichCard",async(e,t)=>{var i,r,l,c,u,h,m,N;f.log("renderChatMessage",[Te.chatBorderColor,Te.enableChatStyles,vt.playerColor.name,(i=e.author)==null?void 0:i.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((m=(h=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:h.roll)==null?void 0:m.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const s=o.querySelectorAll(".card-buttons button[data-action=rollSave]");s.length>0&&s.forEach(b=>{const v=b.querySelector(".visible-dc"),I=b.querySelector(".hidden-dc");f.log("enrichCard",[v,I]),v.setAttribute("data-ability",b.getAttribute("data-ability")||""),v.setAttribute("data-dc",b.getAttribute("data-dc")||""),I.setAttribute("data-ability",b.getAttribute("data-ability")||"")}),Te.chatBorderColor===vt.playerColor.name&&((N=e.author)!=null&&N.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let St=Te;var lo;const pe=class pe{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,pe.checkPlayersList),Hooks.on(U.RENDER_HOTBAR,pe.checkPlayersList),A.isModuleOn("foundry-taskbar")&&Hooks.on(U.UPDATE_USER,pe.checkTaskbarLock),pe.checkTaskbarLock(),pe.addModuleClasses()}};lo=new WeakMap,L(pe,lo),w(pe,"addModuleClasses",()=>{const e=E(),t=T.get(e.otherModulesList.tag)||"",n=t.split(",");f.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const s=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+s)}),n.forEach(o=>{const s=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+s)})}),w(pe,"checkTaskbarLock",()=>{var s,i,r;const e=A.isModuleOn("foundry-taskbar"),t=(s=game.user.flags)==null?void 0:s["foundry-taskbar"];if(f.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(i=t.taskbarSettings)!=null&&i.locked?A.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):A.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?A.addCSSVars("--crlngn-taskbar-height","50px"):A.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),pe.checkPlayersList()}),w(pe,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=A.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,s=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,n,s,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let it=pe;var te,W,_e,lt,Yt,ct,Xt,Kt,dt,ut,ue,ve,Nn,Cn;const g=class g{static handleNavState(){const e=E();game.ready&&p(g,ut)?(O(g,ut,!1),g.toggleNav(g.navStartCollapsed)):g.toggleNav(T.get(e.sceneNavCollapsed.tag))}static toggleNav(e){clearTimeout(p(g,Kt)),O(g,Kt,setTimeout(()=>{if(!ui.nav){g.toggleNav(e);return}g.resetLocalVars(),e===!0?(ui.nav.collapse(),p(g,ct).classList.add("navigation-collapsed")):e===!1&&(ui.nav.expand(),p(g,ct).classList.remove("navigation-collapsed"))},500))}static checkSceneNavCompat(){var n,o;const e=E(),t=document.querySelector("#ui-middle");O(this,ue,A.isModuleOn("monks-scene-navigation")),O(this,ve,A.isModuleOn("compact-scene-navigation")),p(this,ve)&&g.navFoldersEnabled&&(n=game.user)!=null&&n.isGM&&p(this,ve)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),p(this,ue)&&g.sceneNavEnabled&&(t.classList.remove("crlngn-ui"),game.ready&&(T.set(e.sceneNavEnabled.tag,!1),g.sceneNavEnabled=!1),f.log("checkSceneNavCompat",[p(this,ue),p(this,ve)]),(o=game.user)!=null&&o.isGM&&p(this,ue)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static resetLocalVars(){O(g,te,document.querySelector("#navigation")),O(g,lt,document.querySelector("#navigation .nav-item.is-root")),O(g,Yt,document.querySelector("#nav-toggle")),O(g,ct,document.querySelector("#ui-middle")),g.navFoldersEnabled?(O(g,W,document.querySelector("#crlngn-scene-list")),f.log("TopNavigation resetLocalVars",[p(g,W)])):O(g,W,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=p(g,te))==null||e.addEventListener("mouseenter",n=>{if(f.log("TopNavigation mouseenter",[]),!g.isCollapsed||!g.showNavOnHover)return;n.stopPropagation(),clearTimeout(p(g,_e)),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,te))==null||t.addEventListener("mouseleave",n=>{f.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)&&(n.stopPropagation(),O(this,_e,setTimeout(()=>{clearTimeout(p(this,_e)),O(this,_e,null),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){clearTimeout(p(this,dt)),O(g,dt,setTimeout(()=>{var l,c,u,h,m,N,b;clearTimeout(p(this,dt)),g.resetLocalVars();const e=((c=(l=p(g,te))==null?void 0:l.querySelector("#crlngn-scene-folders"))==null?void 0:c.offsetWidth)||0,t=(u=p(g,te))==null?void 0:u.querySelectorAll("button.crlngn-nav"),n=((h=p(g,W))==null?void 0:h.scrollWidth)+e>=((m=p(this,te))==null?void 0:m.offsetWidth);if(f.log("placeNavButtons",[p(g,W),n]),!n)return;t.forEach(v=>v.remove());const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),o.addEventListener("click",p(this,Nn)),o.append(s);const i=document.createElement("button");i.classList.add("crlngn-nav"),i.classList.add("ui-nav-right");const r=document.createElement("i");r.classList.add("fa"),r.classList.add("fa-chevron-right"),i.append(r),i.addEventListener("click",p(this,Cn)),(N=p(this,te))==null||N.appendChild(o),(b=p(this,te))==null||b.appendChild(i),p(this,W)&&p(this,W).classList.remove("no-transition")},250))}static setNavPosition(e){var t,n;try{f.log("setNavPosition",["Starting with pos:",e]);const o=E();if(!p(this,W)){f.log("setNavPosition",["No scenes list found"]);return}const s=((t=p(this,W))==null?void 0:t.querySelectorAll("li.nav-item:not(.is-root)"))||[];if(s.length===0){f.log("setNavPosition",["No scene items found"]);return}const i=p(this,ve)&&((n=p(this,lt))==null?void 0:n.offsetWidth)||0,r=e!==void 0?e:g.navPos||0;if(r>=s.length){f.log("setNavPosition",["Position out of bounds:",r,"max:",s.length-1]);return}const l=s[r];if(!l){f.log("setNavPosition",["Target scene not found at position:",r]);return}const c=l.offsetLeft;if(typeof c!="number"){f.log("setNavPosition",["Invalid offsetLeft for scene:",c]);return}const u=(parseInt(c)-i)*-1;f.log("setNavPosition",["Calculated margin:",u]),p(this,W).style.marginLeft=u+"px",g.navPos=r,T.set(o.sceneNavPos.tag,r),f.log("setNavPosition",["Complete:",{pos:e,position:r,newMargin:u}])}catch(o){f.log("setNavPosition",["Error:",o]),console.error("Error in setNavPosition:",o)}}};te=new WeakMap,W=new WeakMap,_e=new WeakMap,lt=new WeakMap,Yt=new WeakMap,ct=new WeakMap,Xt=new WeakMap,Kt=new WeakMap,dt=new WeakMap,ut=new WeakMap,ue=new WeakMap,ve=new WeakMap,Nn=new WeakMap,Cn=new WeakMap,L(g,te),L(g,W),L(g,_e),L(g,lt),L(g,Yt),L(g,ct),w(g,"sceneFoldersTemplate"),L(g,Xt),L(g,Kt),L(g,dt),L(g,ut,!0),L(g,ue,!1),L(g,ve,!1),w(g,"sceneNavEnabled"),w(g,"navFoldersEnabled"),w(g,"navFoldersForPlayers"),w(g,"navShowRootFolders"),w(g,"navStartCollapsed"),w(g,"showFolderListOnClick"),w(g,"showNavOnHover"),w(g,"useSceneIcons"),w(g,"useScenePreview"),w(g,"useNavBackButton"),w(g,"sceneNavAlias",""),w(g,"sceneClickToView"),w(g,"isCollapsed"),w(g,"navPos"),w(g,"init",async()=>{const e=E();g.checkSceneNavCompat(),g.navStartCollapsed=T.get(e.navStartCollapsed.tag),g.showNavOnHover=T.get(e.showNavOnHover.tag),g.sceneNavEnabled=T.get(e.sceneNavEnabled.tag),g.navFoldersEnabled=T.get(e.navFoldersEnabled.tag),g.navFoldersForPlayers=T.get(e.navFoldersForPlayers.tag),g.showFolderListOnClick=T.get(e.showFolderListOnClick.tag),g.isCollapsed=p(g,ut)?g.navStartCollapsed:T.get(e.sceneNavCollapsed.tag),g.navPos=T.get(e.sceneNavPos.tag),g.resetLocalVars();const t=document.querySelector("#ui-middle");if(f.log("SCENE NAV INIT",[g.sceneNavEnabled]),g.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}if(p(g,ue))p(g,ue)&&t.classList.add("with-monks-scene");else{p(g,ve)||(ne.init(),ne.registerHooks(),ne.renderSceneFolders());const n=T.get(e.sceneNavPos.tag);g.setNavPosition(n),g.placeNavButtons(),g.addListeners(),g.handleNavState()}Hooks.on(U.RENDER_SCENE_NAV,async()=>{f.log("SCENE NAV",[g.navPos]),f.log("TopNavigation",[g.isCollapsed,g.navStartCollapsed]);const n=E();if(!p(g,ue)){f.log("NAV no transition add"),g.navPos=T.get(n.sceneNavPos.tag),p(g,ve)||(ne.init(),await ne.renderSceneFolders()),p(g,W)&&p(g,W).classList.add("no-transition");const o=g.navPos;g.setNavPosition(o),g.placeNavButtons(),g.addListeners(),g.handleNavState(),clearTimeout(p(g,Xt)),O(g,Xt,setTimeout(()=>{f.log("NAV no transition remove"),p(g,W)&&p(g,W).classList.remove("no-transition")},250))}}),Hooks.on(U.COLLAPSE_SIDE_BAR,n=>{f.log(U.COLLAPSE_SIDE_BAR,["isMonksSceneNavOn",p(g,ue)]),p(g,ue)||g.placeNavButtons()}),Hooks.on(U.COLLAPSE_SCENE_NAV,(n,o)=>{const s=E();T.set(s.sceneNavCollapsed.tag,o),f.log("NAV toggle",[n,o]),g.isCollapsed=o,g.toggleNav(o)}),Hooks.on(U.EXPAND_SCENE_NAV,(n,o)=>{f.log("NAV expand",[n,!1])}),Hooks.on(U.CANVAS_INIT,async()=>{try{const n=game.scenes.viewed;if(!n)return;const o=await g.getCurrScenePosition(n.id);await new Promise(s=>setTimeout(s,100)),g.setNavPosition(o)}catch(n){f.warn(U.CANVAS_INIT,["Error in canvas init:",n]),console.error("Error in canvas init:",n)}}),window.addEventListener("resize",()=>{p(g,ue)||g.placeNavButtons()}),f.log("TopNavigation - init",[g.sceneNavEnabled])}),L(g,Nn,async e=>{var s;const t=await g.getItemsPerPage();(s=p(g,W))!=null&&s.querySelectorAll("li.nav-item:not(.is-root)");const n=g.navPos||0;let o=n-(t-1);o=o<0?0:o,f.log("onNavLast",["currPos",n,"items",t,o]),g.setNavPosition(o)}),L(g,Cn,async e=>{var i;const t=await g.getItemsPerPage(),n=((i=p(g,W))==null?void 0:i.querySelectorAll("li.nav-item:not(.is-root)"))||[],o=g.navPos||0;let s=o+(t-1);s=s>n.length-1?n.length-1:s,f.log("onNavNext",["currPos",o,"items",t,s]),g.setNavPosition(s)}),w(g,"getItemsPerPage",async()=>{var e,t,n,o,s,i;try{if(f.log("getItemsPerPage",["Starting"]),p(g,te)||(f.log("getItemsPerPage",["No nav element, resetting vars"]),g.resetLocalVars(),await new Promise(v=>setTimeout(v,100))),!p(g,te))return f.log("getItemsPerPage",["Nav element still not found after reset"]),0;const r=((t=(e=p(g,te))==null?void 0:e.querySelector("#crlngn-scene-folders"))==null?void 0:t.offsetWidth)||0,l=p(g,ve)&&((n=p(g,lt))==null?void 0:n.offsetWidth)||0,c=((o=p(g,Yt))==null?void 0:o.offsetWidth)||0,u=(s=p(g,W))==null?void 0:s.querySelector("li.nav-item:not(.is-root)");if(!u)return f.log("getItemsPerPage",["No scene items found"]),0;const h=u.offsetWidth;if(!h)return f.log("getItemsPerPage",["Scene item has no width"]),0;const m=g.navPos||0,N=(i=p(g,te))==null?void 0:i.offsetWidth;if(!N)return f.log("getItemsPerPage",["Nav element has no width"]),0;const b=Math.floor((N-(m===0?l+r:0)-c*2)/h);return f.log("getItemsPerPage",["Calculated items per page:",b]),b||0}catch(r){return f.log("getItemsPerPage",["Error:",r]),console.error("Error in getItemsPerPage:",r),0}}),w(g,"getCurrScenePosition",async e=>{try{if(f.log("getCurrScenePosition",["Starting with id:",e]),!p(g,W))return f.log("getCurrScenePosition",["No scenes list found"]),0;const t=await g.getItemsPerPage()||1;f.log("getCurrScenePosition",["Items per page:",t]);const n=p(g,W).querySelectorAll("li.nav-item:not(.is-root)");if(!n||n.length===0)return f.log("getCurrScenePosition",["No scene items found"]),0;const o=Array.from(n);if(!e)return f.log("getCurrScenePosition",["No scene ID provided"]),0;const s=o.findIndex(l=>l.dataset.sceneId===e);if(f.log("getCurrScenePosition",["Found scene index:",s]),s===-1)return f.log("getCurrScenePosition",["Scene not found with id:",e]),0;const i=s>=g.navPos&&s<=g.navPos+t,r=i?g.navPos:s;return f.log("getCurrScenePosition",["Final position:",r,"isVisible:",i]),r}catch(t){return f.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}});let F=g;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function vo(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable})),t.push.apply(t,n)}return t}function ke(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vo(Object(t),!0).forEach(function(n){Ss(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):vo(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function dn(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dn=function(e){return typeof e}:dn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(a)}function Ss(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Ae(){return Ae=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},Ae.apply(this,arguments)}function bs(a,e){if(a==null)return{};var t={},n=Object.keys(a),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(t[o]=a[o]);return t}function Ns(a,e){if(a==null)return{};var t=bs(a,e),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(o=0;o<s.length;o++)n=s[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}var Cs="1.15.6";function Pe(a){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(a)}var Fe=Pe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),tn=Pe(/Edge/i),So=Pe(/firefox/i),At=Pe(/safari/i)&&!Pe(/chrome/i)&&!Pe(/android/i),uo=Pe(/iP(ad|od|hone)/i),Ho=Pe(/chrome/i)&&Pe(/android/i),qo={capture:!1,passive:!1};function x(a,e,t){a.addEventListener(e,t,!Fe&&qo)}function G(a,e,t){a.removeEventListener(e,t,!Fe&&qo)}function hn(a,e){if(e){if(e[0]===">"&&(e=e.substring(1)),a)try{if(a.matches)return a.matches(e);if(a.msMatchesSelector)return a.msMatchesSelector(e);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(e)}catch{return!1}return!1}}function Vo(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function be(a,e,t,n){if(a){t=t||document;do{if(e!=null&&(e[0]===">"?a.parentNode===t&&hn(a,e):hn(a,e))||n&&a===t)return a;if(a===t)break}while(a=Vo(a))}return null}var bo=/\s+/g;function ce(a,e,t){if(a&&e)if(a.classList)a.classList[t?"add":"remove"](e);else{var n=(" "+a.className+" ").replace(bo," ").replace(" "+e+" "," ");a.className=(n+(t?" "+e:"")).replace(bo," ")}}function M(a,e,t){var n=a&&a.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(t=a.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function rt(a,e){var t="";if(typeof a=="string")t=a;else do{var n=M(a,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(a=a.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function jo(a,e,t){if(a){var n=a.getElementsByTagName(e),o=0,s=n.length;if(t)for(;o<s;o++)t(n[o],o);return n}return[]}function Ie(){var a=document.scrollingElement;return a||document.documentElement}function Z(a,e,t,n,o){if(!(!a.getBoundingClientRect&&a!==window)){var s,i,r,l,c,u,h;if(a!==window&&a.parentNode&&a!==Ie()?(s=a.getBoundingClientRect(),i=s.top,r=s.left,l=s.bottom,c=s.right,u=s.height,h=s.width):(i=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,h=window.innerWidth),(e||t)&&a!==window&&(o=o||a.parentNode,!Fe))do if(o&&o.getBoundingClientRect&&(M(o,"transform")!=="none"||t&&M(o,"position")!=="static")){var m=o.getBoundingClientRect();i-=m.top+parseInt(M(o,"border-top-width")),r-=m.left+parseInt(M(o,"border-left-width")),l=i+s.height,c=r+s.width;break}while(o=o.parentNode);if(n&&a!==window){var N=rt(o||a),b=N&&N.a,v=N&&N.d;N&&(i/=v,r/=b,h/=b,u/=v,l=i+u,c=r+h)}return{top:i,left:r,bottom:l,right:c,width:h,height:u}}}function No(a,e,t){for(var n=Ve(a,!0),o=Z(a)[e];n;){var s=Z(n)[t],i=void 0;if(i=o>=s,!i)return n;if(n===Ie())break;n=Ve(n,!1)}return!1}function bt(a,e,t,n){for(var o=0,s=0,i=a.children;s<i.length;){if(i[s].style.display!=="none"&&i[s]!==k.ghost&&(n||i[s]!==k.dragged)&&be(i[s],t.draggable,a,!1)){if(o===e)return i[s];o++}s++}return null}function go(a,e){for(var t=a.lastElementChild;t&&(t===k.ghost||M(t,"display")==="none"||e&&!hn(t,e));)t=t.previousElementSibling;return t||null}function he(a,e){var t=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==k.clone&&(!e||hn(a,e))&&t++;return t}function Co(a){var e=0,t=0,n=Ie();if(a)do{var o=rt(a),s=o.a,i=o.d;e+=a.scrollLeft*s,t+=a.scrollTop*i}while(a!==n&&(a=a.parentNode));return[e,t]}function Es(a,e){for(var t in a)if(a.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===a[t][n])return Number(t)}return-1}function Ve(a,e){if(!a||!a.getBoundingClientRect)return Ie();var t=a,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=M(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ie();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ie()}function ws(a,e){if(a&&e)for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a}function Mn(a,e){return Math.round(a.top)===Math.round(e.top)&&Math.round(a.left)===Math.round(e.left)&&Math.round(a.height)===Math.round(e.height)&&Math.round(a.width)===Math.round(e.width)}var Ft;function $o(a,e){return function(){if(!Ft){var t=arguments,n=this;t.length===1?a.call(n,t[0]):a.apply(n,t),Ft=setTimeout(function(){Ft=void 0},e)}}}function Ls(){clearTimeout(Ft),Ft=void 0}function Wo(a,e,t){a.scrollLeft+=e,a.scrollTop+=t}function Yo(a){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(a).cloneNode(!0):t?t(a).clone(!0)[0]:a.cloneNode(!0)}function Xo(a,e,t){var n={};return Array.from(a.children).forEach(function(o){var s,i,r,l;if(!(!be(o,e.draggable,a,!1)||o.animated||o===t)){var c=Z(o);n.left=Math.min((s=n.left)!==null&&s!==void 0?s:1/0,c.left),n.top=Math.min((i=n.top)!==null&&i!==void 0?i:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var ae="Sortable"+new Date().getTime();function Ts(){var a=[],e;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(M(o,"display")==="none"||o===k.ghost)){a.push({target:o,rect:Z(o)});var s=ke({},a[a.length-1].rect);if(o.thisAnimationDuration){var i=rt(o,!0);i&&(s.top-=i.f,s.left-=i.e)}o.fromRect=s}})}},addAnimationState:function(n){a.push(n)},removeAnimationState:function(n){a.splice(Es(a,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var s=!1,i=0;a.forEach(function(r){var l=0,c=r.target,u=c.fromRect,h=Z(c),m=c.prevFromRect,N=c.prevToRect,b=r.rect,v=rt(c,!0);v&&(h.top-=v.f,h.left-=v.e),c.toRect=h,c.thisAnimationDuration&&Mn(m,h)&&!Mn(u,h)&&(b.top-h.top)/(b.left-h.left)===(u.top-h.top)/(u.left-h.left)&&(l=ks(b,m,N,o.options)),Mn(h,u)||(c.prevFromRect=u,c.prevToRect=h,l||(l=o.options.animation),o.animate(c,b,h,l)),l&&(s=!0,i=Math.max(i,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof n=="function"&&n()},i):typeof n=="function"&&n(),a=[]},animate:function(n,o,s,i){if(i){M(n,"transition",""),M(n,"transform","");var r=rt(this.el),l=r&&r.a,c=r&&r.d,u=(o.left-s.left)/(l||1),h=(o.top-s.top)/(c||1);n.animatingX=!!u,n.animatingY=!!h,M(n,"transform","translate3d("+u+"px,"+h+"px,0)"),this.forRepaintDummy=Is(n),M(n,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),M(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){M(n,"transition",""),M(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},i)}}}}function Is(a){return a.offsetWidth}function ks(a,e,t,n){return Math.sqrt(Math.pow(e.top-a.top,2)+Math.pow(e.left-a.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var nt=[],Rn={initializeByDefault:!0},nn={mount:function(e){for(var t in Rn)Rn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Rn[t]);nt.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),nt.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var s=e+"Global";nt.forEach(function(i){t[i.pluginName]&&(t[i.pluginName][s]&&t[i.pluginName][s](ke({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](ke({sortable:t},n)))})},initializePlugins:function(e,t,n,o){nt.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,Ae(n,c.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var i=this.modifyOption(e,s,e.options[s]);typeof i<"u"&&(e.options[s]=i)}},getEventProperties:function(e,t){var n={};return nt.forEach(function(o){typeof o.eventProperties=="function"&&Ae(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return nt.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[t]=="function"&&(o=s.optionListeners[t].call(e[s.pluginName],n))}),o}};function Ms(a){var e=a.sortable,t=a.rootEl,n=a.name,o=a.targetEl,s=a.cloneEl,i=a.toEl,r=a.fromEl,l=a.oldIndex,c=a.newIndex,u=a.oldDraggableIndex,h=a.newDraggableIndex,m=a.originalEvent,N=a.putSortable,b=a.extraEventProperties;if(e=e||t&&t[ae],!!e){var v,I=e.options,z="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Fe&&!tn?v=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(n,!0,!0)),v.to=i||t,v.from=r||t,v.item=o||t,v.clone=s,v.oldIndex=l,v.newIndex=c,v.oldDraggableIndex=u,v.newDraggableIndex=h,v.originalEvent=m,v.pullMode=N?N.lastPutMode:void 0;var B=ke(ke({},b),nn.getEventProperties(n,e));for(var Y in B)v[Y]=B[Y];t&&t.dispatchEvent(v),I[z]&&I[z].call(e,v)}}var Rs=["evt"],oe=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,s=Ns(n,Rs);nn.pluginEvent.bind(k)(e,t,ke({dragEl:C,parentEl:$,ghostEl:D,rootEl:q,nextEl:Ke,lastDownEl:un,cloneEl:j,cloneHidden:Ue,dragStarted:Rt,putSortable:J,activeSortable:k.active,originalEvent:o,oldIndex:at,oldDraggableIndex:Ot,newIndex:de,newDraggableIndex:ze,hideGhostForTarget:Jo,unhideGhostForTarget:_o,cloneNowHidden:function(){Ue=!0},cloneNowShown:function(){Ue=!1},dispatchSortableEvent:function(r){ee({sortable:t,name:r,originalEvent:o})}},s))};function ee(a){Ms(ke({putSortable:J,cloneEl:j,targetEl:C,rootEl:q,oldIndex:at,oldDraggableIndex:Ot,newIndex:de,newDraggableIndex:ze},a))}var C,$,D,q,Ke,un,j,Ue,at,de,Ot,ze,an,J,st=!1,mn=!1,yn=[],Ye,ye,Dn,Pn,Eo,wo,Rt,ot,Gt,xt=!1,rn=!1,gn,_,An=[],Zn=!1,vn=[],In=typeof document<"u",ln=uo,Lo=tn||Fe?"cssFloat":"float",Ds=In&&!Ho&&!uo&&"draggable"in document.createElement("div"),Ko=function(){if(In){if(Fe)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}}(),Zo=function(e,t){var n=M(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),s=bt(e,0,t),i=bt(e,1,t),r=s&&M(s),l=i&&M(i),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Z(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Z(i).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&r.float&&r.float!=="none"){var h=r.float==="left"?"left":"right";return i&&(l.clear==="both"||l.clear===h)?"vertical":"horizontal"}return s&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[Lo]==="none"||i&&n[Lo]==="none"&&c+u>o)?"vertical":"horizontal"},Ps=function(e,t,n){var o=n?e.left:e.top,s=n?e.right:e.bottom,i=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||s===l||o+i/2===r+c/2},As=function(e,t){var n;return yn.some(function(o){var s=o[ae].options.emptyInsertThreshold;if(!(!s||go(o))){var i=Z(o),r=e>=i.left-s&&e<=i.right+s,l=t>=i.top-s&&t<=i.bottom+s;if(r&&l)return n=o}}),n},Qo=function(e){function t(s,i){return function(r,l,c,u){var h=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(s==null&&(i||h))return!0;if(s==null||s===!1)return!1;if(i&&s==="clone")return s;if(typeof s=="function")return t(s(r,l,c,u),i)(r,l,c,u);var m=(i?r:l).options.group.name;return s===!0||typeof s=="string"&&s===m||s.join&&s.indexOf(m)>-1}}var n={},o=e.group;(!o||dn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Jo=function(){!Ko&&D&&M(D,"display","none")},_o=function(){!Ko&&D&&M(D,"display","")};In&&!Ho&&document.addEventListener("click",function(a){if(mn)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),mn=!1,!1},!0);var Xe=function(e){if(C){e=e.touches?e.touches[0]:e;var t=As(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[ae]._onDragOver(n)}}},Fs=function(e){C&&C.parentNode[ae]._isOutsideThisEl(e.target)};function k(a,e){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=e=Ae({},e),a[ae]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Zo(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(i,r){i.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!At||uo),emptyInsertThreshold:5};nn.initializePlugins(this,a,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Qo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Ds,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(a,"pointerdown",this._onTapStart):(x(a,"mousedown",this._onTapStart),x(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(a,"dragover",this),x(a,"dragenter",this)),yn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ae(this,Ts())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(ot=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,C):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,s=o.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(qs(n),!C&&!(/mousedown|pointerdown/.test(i)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&At&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=be(l,o.draggable,n,!1),!(l&&l.animated)&&un!==l)){if(at=he(l),Ot=he(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){ee({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),oe("filter",t,{evt:e}),s&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(h){if(h=be(c,h.trim(),n,!1),h)return ee({sortable:t,rootEl:h,name:"filter",targetEl:l,fromEl:n,toEl:n}),oe("filter",t,{evt:e}),!0}),u)){s&&e.preventDefault();return}o.handle&&!be(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,s=o.el,i=o.options,r=s.ownerDocument,l;if(n&&!C&&n.parentNode===s){var c=Z(n);if(q=s,C=n,$=C.parentNode,Ke=C.nextSibling,un=n,an=i.group,k.dragged=C,Ye={target:C,clientX:(t||e).clientX,clientY:(t||e).clientY},Eo=Ye.clientX-c.left,wo=Ye.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,C.style["will-change"]="all",l=function(){if(oe("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!So&&o.nativeDraggable&&(C.draggable=!0),o._triggerDragStart(e,t),ee({sortable:o,name:"choose",originalEvent:e}),ce(C,i.chosenClass,!0)},i.ignore.split(",").forEach(function(u){jo(C,u.trim(),Fn)}),x(r,"dragover",Xe),x(r,"mousemove",Xe),x(r,"touchmove",Xe),i.supportPointer?(x(r,"pointerup",o._onDrop),!this.nativeDraggable&&x(r,"pointercancel",o._onDrop)):(x(r,"mouseup",o._onDrop),x(r,"touchend",o._onDrop),x(r,"touchcancel",o._onDrop)),So&&this.nativeDraggable&&(this.options.touchStartThreshold=4,C.draggable=!0),oe("delayStart",this,{evt:e}),i.delay&&(!i.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(tn||Fe))){if(k.eventCanceled){this._onDrop();return}i.supportPointer?(x(r,"pointerup",o._disableDelayedDrag),x(r,"pointercancel",o._disableDelayedDrag)):(x(r,"mouseup",o._disableDelayedDrag),x(r,"touchend",o._disableDelayedDrag),x(r,"touchcancel",o._disableDelayedDrag)),x(r,"mousemove",o._delayedDragTouchMoveHandler),x(r,"touchmove",o._delayedDragTouchMoveHandler),i.supportPointer&&x(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,i.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){C&&Fn(C),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;G(e,"mouseup",this._disableDelayedDrag),G(e,"touchend",this._disableDelayedDrag),G(e,"touchcancel",this._disableDelayedDrag),G(e,"pointerup",this._disableDelayedDrag),G(e,"pointercancel",this._disableDelayedDrag),G(e,"mousemove",this._delayedDragTouchMoveHandler),G(e,"touchmove",this._delayedDragTouchMoveHandler),G(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):t?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(C,"dragend",this),x(q,"dragstart",this._onDragStart));try{document.selection?fn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(st=!1,q&&C){oe("dragStarted",this,{evt:t}),this.nativeDraggable&&x(document,"dragover",Fs);var n=this.options;!e&&ce(C,n.dragClass,!1),ce(C,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),ee({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ye){this._lastX=ye.clientX,this._lastY=ye.clientY,Jo();for(var e=document.elementFromPoint(ye.clientX,ye.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ye.clientX,ye.clientY),e!==t);)t=e;if(C.parentNode[ae]._isOutsideThisEl(e),t)do{if(t[ae]){var n=void 0;if(n=t[ae]._onDragOver({clientX:ye.clientX,clientY:ye.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Vo(t));_o()}},_onTouchMove:function(e){if(Ye){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,s=e.touches?e.touches[0]:e,i=D&&rt(D,!0),r=D&&i&&i.a,l=D&&i&&i.d,c=ln&&_&&Co(_),u=(s.clientX-Ye.clientX+o.x)/(r||1)+(c?c[0]-An[0]:0)/(r||1),h=(s.clientY-Ye.clientY+o.y)/(l||1)+(c?c[1]-An[1]:0)/(l||1);if(!k.active&&!st){if(n&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(D){i?(i.e+=u-(Dn||0),i.f+=h-(Pn||0)):i={a:1,b:0,c:0,d:1,e:u,f:h};var m="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");M(D,"webkitTransform",m),M(D,"mozTransform",m),M(D,"msTransform",m),M(D,"transform",m),Dn=u,Pn=h,ye=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!D){var e=this.options.fallbackOnBody?document.body:q,t=Z(C,!0,ln,!0,e),n=this.options;if(ln){for(_=e;M(_,"position")==="static"&&M(_,"transform")==="none"&&_!==document;)_=_.parentNode;_!==document.body&&_!==document.documentElement?(_===document&&(_=Ie()),t.top+=_.scrollTop,t.left+=_.scrollLeft):_=Ie(),An=Co(_)}D=C.cloneNode(!0),ce(D,n.ghostClass,!1),ce(D,n.fallbackClass,!0),ce(D,n.dragClass,!0),M(D,"transition",""),M(D,"transform",""),M(D,"box-sizing","border-box"),M(D,"margin",0),M(D,"top",t.top),M(D,"left",t.left),M(D,"width",t.width),M(D,"height",t.height),M(D,"opacity","0.8"),M(D,"position",ln?"absolute":"fixed"),M(D,"zIndex","100000"),M(D,"pointerEvents","none"),k.ghost=D,e.appendChild(D),M(D,"transform-origin",Eo/parseInt(D.style.width)*100+"% "+wo/parseInt(D.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,s=n.options;if(oe("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}oe("setupClone",this),k.eventCanceled||(j=Yo(C),j.removeAttribute("id"),j.draggable=!1,j.style["will-change"]="",this._hideClone(),ce(j,this.options.chosenClass,!1),k.clone=j),n.cloneId=fn(function(){oe("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||q.insertBefore(j,C),n._hideClone(),ee({sortable:n,name:"clone"}))}),!t&&ce(C,s.dragClass,!0),t?(mn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(G(document,"mouseup",n._onDrop),G(document,"touchend",n._onDrop),G(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",s.setData&&s.setData.call(n,o,C)),x(document,"drop",n),M(C,"transform","translateZ(0)")),st=!0,n._dragStartId=fn(n._dragStarted.bind(n,t,e)),x(document,"selectstart",n),Rt=!0,window.getSelection().removeAllRanges(),At&&M(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,s,i,r=this.options,l=r.group,c=k.active,u=an===l,h=r.sort,m=J||c,N,b=this,v=!1;if(Zn)return;function I(Mt,ns){oe(Mt,b,ke({evt:e,isOwner:u,axis:N?"vertical":"horizontal",revert:i,dragRect:o,targetRect:s,canSort:h,fromSortable:m,target:n,completed:B,onMove:function(mo,os){return cn(q,t,C,o,mo,Z(mo),e,os)},changed:Y},ns))}function z(){I("dragOverAnimationCapture"),b.captureAnimationState(),b!==m&&m.captureAnimationState()}function B(Mt){return I("dragOverCompleted",{insertion:Mt}),Mt&&(u?c._hideClone():c._showClone(b),b!==m&&(ce(C,J?J.options.ghostClass:c.options.ghostClass,!1),ce(C,r.ghostClass,!0)),J!==b&&b!==k.active?J=b:b===k.active&&J&&(J=null),m===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){I("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(n===C&&!C.animated||n===t&&!n.animated)&&(ot=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(C.parentNode[ae]._isOutsideThisEl(e.target),!Mt&&Xe(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function Y(){de=he(C),ze=he(C,r.draggable),ee({sortable:b,name:"change",toEl:t,newIndex:de,newDraggableIndex:ze,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=be(n,r.draggable,t,!0),I("dragOver"),k.eventCanceled)return v;if(C.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return B(!1);if(mn=!1,c&&!r.disabled&&(u?h||(i=$!==q):J===this||(this.lastPutMode=an.checkPull(this,c,C,e))&&l.checkPut(this,c,C,e))){if(N=this._getDirection(e,n)==="vertical",o=Z(C),I("dragOverValid"),k.eventCanceled)return v;if(i)return $=q,z(),this._hideClone(),I("revert"),k.eventCanceled||(Ke?q.insertBefore(C,Ke):q.appendChild(C)),B(!0);var V=go(t,r.draggable);if(!V||zs(e,N,this)&&!V.animated){if(V===C)return B(!1);if(V&&t===e.target&&(n=V),n&&(s=Z(n)),cn(q,t,C,o,n,s,e,!!n)!==!1)return z(),V&&V.nextSibling?t.insertBefore(C,V.nextSibling):t.appendChild(C),$=t,Y(),B(!0)}else if(V&&xs(e,N,this)){var Ne=bt(t,0,r,!0);if(Ne===C)return B(!1);if(n=Ne,s=Z(n),cn(q,t,C,o,n,s,e,!1)!==!1)return z(),t.insertBefore(C,Ne),$=t,Y(),B(!0)}else if(n.parentNode===t){s=Z(n);var fe=0,Me,Lt=C.parentNode!==t,re=!Ps(C.animated&&C.toRect||o,n.animated&&n.toRect||s,N),Tt=N?"top":"left",Oe=No(n,"top","top")||No(C,"top","top"),It=Oe?Oe.scrollTop:void 0;ot!==n&&(Me=s[Tt],xt=!1,rn=!re&&r.invertSwap||Lt),fe=Us(e,n,s,N,re?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,rn,ot===n);var Re;if(fe!==0){var We=he(C);do We-=fe,Re=$.children[We];while(Re&&(M(Re,"display")==="none"||Re===D))}if(fe===0||Re===n)return B(!1);ot=n,Gt=fe;var kt=n.nextElementSibling,Ge=!1;Ge=fe===1;var on=cn(q,t,C,o,n,s,e,Ge);if(on!==!1)return(on===1||on===-1)&&(Ge=on===1),Zn=!0,setTimeout(Gs,30),z(),Ge&&!kt?t.appendChild(C):n.parentNode.insertBefore(C,Ge?kt:n),Oe&&Wo(Oe,0,It-Oe.scrollTop),$=C.parentNode,Me!==void 0&&!rn&&(gn=Math.abs(Me-Z(n)[Tt])),Y(),B(!0)}if(t.contains(C))return B(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){G(document,"mousemove",this._onTouchMove),G(document,"touchmove",this._onTouchMove),G(document,"pointermove",this._onTouchMove),G(document,"dragover",Xe),G(document,"mousemove",Xe),G(document,"touchmove",Xe)},_offUpEvents:function(){var e=this.el.ownerDocument;G(e,"mouseup",this._onDrop),G(e,"touchend",this._onDrop),G(e,"pointerup",this._onDrop),G(e,"pointercancel",this._onDrop),G(e,"touchcancel",this._onDrop),G(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(de=he(C),ze=he(C,n.draggable),oe("drop",this,{evt:e}),$=C&&C.parentNode,de=he(C),ze=he(C,n.draggable),k.eventCanceled){this._nulling();return}st=!1,rn=!1,xt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Qn(this.cloneId),Qn(this._dragStartId),this.nativeDraggable&&(G(document,"drop",this),G(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),At&&M(document.body,"user-select",""),M(C,"transform",""),e&&(Rt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),D&&D.parentNode&&D.parentNode.removeChild(D),(q===$||J&&J.lastPutMode!=="clone")&&j&&j.parentNode&&j.parentNode.removeChild(j),C&&(this.nativeDraggable&&G(C,"dragend",this),Fn(C),C.style["will-change"]="",Rt&&!st&&ce(C,J?J.options.ghostClass:this.options.ghostClass,!1),ce(C,this.options.chosenClass,!1),ee({sortable:this,name:"unchoose",toEl:$,newIndex:null,newDraggableIndex:null,originalEvent:e}),q!==$?(de>=0&&(ee({rootEl:$,name:"add",toEl:$,fromEl:q,originalEvent:e}),ee({sortable:this,name:"remove",toEl:$,originalEvent:e}),ee({rootEl:$,name:"sort",toEl:$,fromEl:q,originalEvent:e}),ee({sortable:this,name:"sort",toEl:$,originalEvent:e})),J&&J.save()):de!==at&&de>=0&&(ee({sortable:this,name:"update",toEl:$,originalEvent:e}),ee({sortable:this,name:"sort",toEl:$,originalEvent:e})),k.active&&((de==null||de===-1)&&(de=at,ze=Ot),ee({sortable:this,name:"end",toEl:$,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){oe("nulling",this),q=C=$=D=Ke=j=un=Ue=Ye=ye=Rt=de=ze=at=Ot=ot=Gt=J=an=k.dragged=k.ghost=k.clone=k.active=null,vn.forEach(function(e){e.checked=!0}),vn.length=Dn=Pn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":C&&(this._onDragOver(e),Os(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,s=n.length,i=this.options;o<s;o++)t=n[o],be(t,i.draggable,this.el,!1)&&e.push(t.getAttribute(i.dataIdAttr)||Hs(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(s,i){var r=o.children[i];be(r,this.options.draggable,o,!1)&&(n[s]=r)},this),t&&this.captureAnimationState(),e.forEach(function(s){n[s]&&(o.removeChild(n[s]),o.appendChild(n[s]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return be(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=nn.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Qo(n)},destroy:function(){oe("destroy",this);var e=this.el;e[ae]=null,G(e,"mousedown",this._onTapStart),G(e,"touchstart",this._onTapStart),G(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(G(e,"dragover",this),G(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),yn.splice(yn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ue){if(oe("hideClone",this),k.eventCanceled)return;M(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),Ue=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ue){if(oe("showClone",this),k.eventCanceled)return;C.parentNode==q&&!this.options.group.revertClone?q.insertBefore(j,C):Ke?q.insertBefore(j,Ke):q.appendChild(j),this.options.group.revertClone&&this.animate(C,j),M(j,"display",""),Ue=!1}}};function Os(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function cn(a,e,t,n,o,s,i,r){var l,c=a[ae],u=c.options.onMove,h;return window.CustomEvent&&!Fe&&!tn?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=a,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=s||Z(e),l.willInsertAfter=r,l.originalEvent=i,a.dispatchEvent(l),u&&(h=u.call(c,l,i)),h}function Fn(a){a.draggable=!1}function Gs(){Zn=!1}function xs(a,e,t){var n=Z(bt(t.el,0,t.options,!0)),o=Xo(t.el,t.options,D),s=10;return e?a.clientX<o.left-s||a.clientY<n.top&&a.clientX<n.right:a.clientY<o.top-s||a.clientY<n.bottom&&a.clientX<n.left}function zs(a,e,t){var n=Z(go(t.el,t.options.draggable)),o=Xo(t.el,t.options,D),s=10;return e?a.clientX>o.right+s||a.clientY>n.bottom&&a.clientX>n.left:a.clientY>o.bottom+s||a.clientX>n.right&&a.clientY>n.top}function Us(a,e,t,n,o,s,i,r){var l=n?a.clientY:a.clientX,c=n?t.height:t.width,u=n?t.top:t.left,h=n?t.bottom:t.right,m=!1;if(!i){if(r&&gn<c*o){if(!xt&&(Gt===1?l>u+c*s/2:l<h-c*s/2)&&(xt=!0),xt)m=!0;else if(Gt===1?l<u+gn:l>h-gn)return-Gt}else if(l>u+c*(1-o)/2&&l<h-c*(1-o)/2)return Bs(e)}return m=m||i,m&&(l<u+c*s/2||l>h-c*s/2)?l>u+c/2?1:-1:0}function Bs(a){return he(C)<he(a)?1:-1}function Hs(a){for(var e=a.tagName+a.className+a.src+a.href+a.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function qs(a){vn.length=0;for(var e=a.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&vn.push(n)}}function fn(a){return setTimeout(a,0)}function Qn(a){return clearTimeout(a)}In&&x(document,"touchmove",function(a){(k.active||st)&&a.cancelable&&a.preventDefault()});k.utils={on:x,off:G,css:M,find:jo,is:function(e,t){return!!be(e,t,e,!1)},extend:ws,throttle:$o,closest:be,toggleClass:ce,clone:Yo,index:he,nextTick:fn,cancelNextTick:Qn,detectDirection:Zo,getChild:bt,expando:ae};k.get=function(a){return a[ae]};k.mount=function(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=ke(ke({},k.utils),n.utils)),nn.mount(n)})};k.create=function(a,e){return new k(a,e)};k.version=Cs;var K=[],Dt,Jn,_n=!1,On,Gn,Sn,Pt;function Vs(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return a.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):n.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?G(document,"dragover",this._handleAutoScroll):(G(document,"pointermove",this._handleFallbackAutoScroll),G(document,"touchmove",this._handleFallbackAutoScroll),G(document,"mousemove",this._handleFallbackAutoScroll)),To(),pn(),Ls()},nulling:function(){Sn=Jn=Dt=_n=Pt=On=Gn=null,K.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,s=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(s,i);if(Sn=t,n||this.options.forceAutoScrollFallback||tn||Fe||At){xn(t,this.options,r,n);var l=Ve(r,!0);_n&&(!Pt||s!==On||i!==Gn)&&(Pt&&To(),Pt=setInterval(function(){var c=Ve(document.elementFromPoint(s,i),!0);c!==l&&(l=c,pn()),xn(t,o.options,c,n)},10),On=s,Gn=i)}else{if(!this.options.bubbleScroll||Ve(r,!0)===Ie()){pn();return}xn(t,this.options,Ve(r,!1),!1)}}},Ae(a,{pluginName:"scroll",initializeByDefault:!0})}function pn(){K.forEach(function(a){clearInterval(a.pid)}),K=[]}function To(){clearInterval(Pt)}var xn=$o(function(a,e,t,n){if(e.scroll){var o=(a.touches?a.touches[0]:a).clientX,s=(a.touches?a.touches[0]:a).clientY,i=e.scrollSensitivity,r=e.scrollSpeed,l=Ie(),c=!1,u;Jn!==t&&(Jn=t,pn(),Dt=e.scroll,u=e.scrollFn,Dt===!0&&(Dt=Ve(t,!0)));var h=0,m=Dt;do{var N=m,b=Z(N),v=b.top,I=b.bottom,z=b.left,B=b.right,Y=b.width,V=b.height,Ne=void 0,fe=void 0,Me=N.scrollWidth,Lt=N.scrollHeight,re=M(N),Tt=N.scrollLeft,Oe=N.scrollTop;N===l?(Ne=Y<Me&&(re.overflowX==="auto"||re.overflowX==="scroll"||re.overflowX==="visible"),fe=V<Lt&&(re.overflowY==="auto"||re.overflowY==="scroll"||re.overflowY==="visible")):(Ne=Y<Me&&(re.overflowX==="auto"||re.overflowX==="scroll"),fe=V<Lt&&(re.overflowY==="auto"||re.overflowY==="scroll"));var It=Ne&&(Math.abs(B-o)<=i&&Tt+Y<Me)-(Math.abs(z-o)<=i&&!!Tt),Re=fe&&(Math.abs(I-s)<=i&&Oe+V<Lt)-(Math.abs(v-s)<=i&&!!Oe);if(!K[h])for(var We=0;We<=h;We++)K[We]||(K[We]={});(K[h].vx!=It||K[h].vy!=Re||K[h].el!==N)&&(K[h].el=N,K[h].vx=It,K[h].vy=Re,clearInterval(K[h].pid),(It!=0||Re!=0)&&(c=!0,K[h].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(Sn);var kt=K[this.layer].vy?K[this.layer].vy*r:0,Ge=K[this.layer].vx?K[this.layer].vx*r:0;typeof u=="function"&&u.call(k.dragged.parentNode[ae],Ge,kt,a,Sn,K[this.layer].el)!=="continue"||Wo(K[this.layer].el,Ge,kt)}).bind({layer:h}),24))),h++}while(e.bubbleScroll&&m!==l&&(m=Ve(m,!1)));_n=c}},30),es=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,s=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||s;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,h=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(h)&&(i("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function fo(){}fo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=bt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:es};Ae(fo,{pluginName:"revertOnSpill"});function po(){}po.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:es};Ae(po,{pluginName:"removeOnSpill"});k.mount(new Vs);k.mount(po,fo);const le="favorites";var Zt,gt,ft,ge,pt,et,Be,En,Qt,Jt,De,tt,Se,ht,mt,wn,Ln,He,co;const d=class d{static init(){d.noFolderView()||!ui.scenes||(!d.folderListData||d.folderListData.length===0)&&(d.preloadTemplate(),d.folderListData=d.getFolders(ui.scenes.folders),d.selectedFolder=d.selectFolder(le))}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||le}static getParentFolders(e){const t=[];let n=ui.scenes.folders.find(s=>s.id===e);const o=new Set;for(;n!=null&&n.folder&&!o.has(n.id);){o.add(n.id);const s=n.folder;if(s)t.unshift(s),n=s;else break}return t}static registerHooks(){Hooks.on(U.CANVAS_INIT,()=>{var s,i;const e=(i=(s=game.scenes)==null?void 0:s.viewed)==null?void 0:i.id,t=p(d,ge).length,n=t>0?p(d,ge)[t-1]:null,o=t>0?p(d,ge)[t-2]:null;(t===0||o!==e&&n!==e)&&(p(d,ge).push(e),f.log(U.CANVAS_INIT,[p(d,ge)]))}),Hooks.on(U.CREATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.UPDATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.DELETE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(U.CREATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.UPDATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.DELETE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(U.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;const t=document.querySelector("#scenes .directory-list");t.addEventListener("contextmenu",o=>{var i;const s=o.target.closest(".directory-item");if(s&&(d.contextMenuSceneId=s.dataset.documentId||null,d.contextMenuSceneId)){const l=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",c=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+l);p(i=d,Jt).call(i,c)}}),t.querySelectorAll("li.scene").forEach(o=>{var i;const s=game.scenes.get(o.dataset.sceneId||o.dataset.documentId);if(F.sceneClickToView&&(o.addEventListener("dblclick",p(d,mt)),o.addEventListener("click",p(d,ht))),F.useSceneIcons&&s&&((i=game.user)!=null&&i.isGM)){let r=document.createElement("i");r.classList.add("fas"),r.classList.add("icon"),s.ownership.default!==0?(s.active&&(r.classList.add("fa-bullseye"),o.prepend(r)),game.scenes.current.id===s.id&&(r.classList.add("fa-crown"),o.prepend(r))):(r.classList.add("fa-lock"),o.prepend(r))}})}),Hooks.on(U.RENDER_SCENE_NAV,()=>{document.querySelector("#navigation").addEventListener("contextmenu",t=>{var o;const n=t.target.closest(".nav-item");if(n&&(d.contextMenuSceneId=t.currentTarget.dataset.sceneId||n.dataset.sceneId||null,d.contextMenuSceneId)){const i=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",r=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+i);p(o=d,Jt).call(o,r)}})}),Hooks.on(U.GET_SCENE_NAV_CONTEXT,(e,t)=>{t.find(o=>o.name==="CRLNGN_UI.ui.sceneNav.initialViewBtn")||t.push({...t[0],condition:o=>{var s;return((s=game.user)==null?void 0:s.isGM)&&game.scenes.get(o.data("sceneId"))._view},callback:o=>{let s=game.scenes.get(o.data("sceneId")),i=parseInt(canvas.stage.pivot.x),r=parseInt(canvas.stage.pivot.y),l=canvas.stage.scale.x;s.update({initial:{x:i,y:r,scale:l}},{diff:!1}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.initialViewSet"))},icon:'<i class="fas fa-expand"></i>',name:"CRLNGN_UI.ui.sceneNav.initialViewBtn"})})}};Zt=new WeakMap,gt=new WeakMap,ft=new WeakMap,ge=new WeakMap,pt=new WeakMap,et=new WeakMap,Be=new WeakMap,En=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,De=new WeakMap,tt=new WeakMap,Se=new WeakMap,ht=new WeakMap,mt=new WeakMap,wn=new WeakMap,Ln=new WeakMap,He=new WeakMap,co=new WeakMap,w(d,"selectedFolder"),w(d,"folderList"),w(d,"folderListData",[]),w(d,"searchValue",""),L(d,Zt,""),w(d,"contextMenuSceneId",null),L(d,gt,{}),L(d,ft),L(d,ge,[]),w(d,"getFolders",e=>{const t=o=>{o.isOpen=p(d,gt)[o.id]??!1,o.children.forEach(t)};let n=e.filter(o=>o.folder===null);return n.forEach(t),n.sort((o,s)=>o.name.toLowerCase().localeCompare(s.name.toLowerCase())),n}),w(d,"selectFolder",e=>d.getFolderById(e)||null),w(d,"createFolderElem",()=>document.createElement("li")),w(d,"preloadTemplate",async()=>{const e=[`modules/${me}/templates/scene-folder-list.hbs`];return await loadTemplates(e),!0}),w(d,"getFoldersData",e=>{const t=e.children.map(o=>d.getFoldersData(o.folder));return{...e,isOpen:p(d,gt)[e.id]||!1,children:t,hasSubfolders:t.length>0,id:e.id}}),L(d,pt,null),L(d,et,null),L(d,Be,null),w(d,"renderSceneFolders",async()=>{var m,N,b,v,I,z,B;if(d.noFolderView()||!d.selectedFolder)return;O(d,Zt,game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"));const e=d.getFolders(ui.scenes.folders),t=`CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.${F.useNavBackButton}`,n=game.i18n.localize("CRLNGN_UI.ui.sceneNav.backTo"),o=F.sceneNavAlias||game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"),s={favoritesId:le,favoritesName:p(d,Zt),folderList:e.map(Y=>d.getFoldersData(Y)),viewedSceneId:game.scenes.current.id,users:game.users.contents,isGM:(m=game.user)==null?void 0:m.isGM,searchValue:d.searchValue,showSearchResults:!!d.searchValue,useNavBackButton:d.isBackBtnActive(),backButtonLabel:d.isBackBtnActive()?game.i18n.localize(t):"",rootButtonLabel:`${n} ${o}`,useSceneIcons:F.useSceneIcons,useScenePreview:F.useScenePreview,sceneNavAlias:F.sceneNavAlias,showRootFolders:F.navShowRootFolders};if(f.log("rootFolders",[(N=ui.scenes)==null?void 0:N.folders,game.folders]),d.selectedFolder===le){const Y=F.navShowRootFolders?((b=ui.scenes)==null?void 0:b.folders.filter(V=>V.folder===null))||[]:[];O(d,pt,{...s,currFolder:{name:"",id:le},currIcon:"fa-map",folders:Y,scenes:ui.nav.scenes.filter(V=>V.permission>=2),hasParents:!1,parentFolders:[]})}else{const Y=d.selectedFolder.children,V=d.getParentFolders(d.selectedFolder.id),Ne=[...d.selectedFolder.contents];Ne.sort((fe,Me)=>fe.sort-Me.sort),O(d,pt,{...s,currFolder:d.selectedFolder,currIcon:"fa-folder",folders:Y,scenes:Ne,hasParents:V.length>0,parentFolders:V})}O(d,et,document.querySelector("#crlngn-scene-folders")),O(d,Be,document.querySelector("#crlngn-scene-list")),(v=p(d,et))==null||v.remove(),(I=p(d,Be))==null||I.remove();const i=await renderTemplate(`modules/${me}/templates/scene-folder-list.hbs`,p(d,pt)),r=document.querySelector("#scene-list");r.insertAdjacentHTML("beforebegin",i),O(d,et,document.querySelector("#crlngn-scene-folders")),O(d,Be,document.querySelector("#crlngn-scene-list")),r==null||r.classList.add("hidden");const l=p(d,Be),c=l.querySelectorAll("li.nav-item"),u=F.navPos||0,h=parseInt((z=c[u])==null?void 0:z.offsetLeft)*-1;l.style.marginLeft=h+"px",d.activateFolderListeners(p(d,et)),p(B=d,En).call(B,p(d,Be)),F.resetLocalVars()}),w(d,"isBackBtnActive",()=>F.useNavBackButton===Qe.lastScene.name?p(d,ge).length>1:F.useNavBackButton===Qe.defaultScenes.name?d.selectedFolder!==le:!1),w(d,"activateFolderListeners",e=>{if(d.noFolderView())return;const t=e.querySelector("i.root");t==null||t.addEventListener("click",p(d,Ln));const n=e.querySelector("i.fa-turn-left");n==null||n.addEventListener("click",p(d,wn));const o=e.querySelector("a.selected");F.showFolderListOnClick?(o==null||o.removeEventListener("mouseover",p(d,De)),e.removeEventListener("mouseleave",p(d,De)),o==null||o.addEventListener("click",p(d,De))):(o==null||o.addEventListener("mouseover",p(d,De)),e.addEventListener("mouseleave",p(d,De)),o==null||o.removeEventListener("click",p(d,De))),e.querySelectorAll(".parent-folder").forEach(l=>{l.addEventListener("click",p(d,He))}),e.querySelectorAll("span.toggle").forEach(l=>{l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();const u=c.currentTarget.closest("li"),h=u.dataset.folderId,m=u.querySelector("ol.subfolders");let N=!1;if(!m)return;!m.classList.contains("open")?(m.classList.add("open"),N=!0):(m.classList.remove("open"),N=!1),c.currentTarget.textContent=N?"−":"+",p(d,gt)[h]=N})}),e.querySelectorAll(".folder-list li.folder").forEach(l=>{l.addEventListener("click",p(d,He))});const i=e.querySelector(".search-container .input-scene-search");i.addEventListener("keyup",d.onSearchInput),i.addEventListener("keydown",l=>{l.stopPropagation()}),e.querySelector(".search-container .back-to-favorites").addEventListener("click",p(d,He))}),L(d,En,e=>{var n,o;e.querySelectorAll("li.nav-item").forEach(s=>{const i=s.classList.contains("folder");s.addEventListener("click",i?p(d,He):p(d,ht)),s.addEventListener("dblclick",i?()=>{}:p(d,mt))}),(n=game.user)!=null&&n.isGM&&p(o=d,Qt).call(o,e)}),L(d,Qt,e=>{clearInterval(p(d,ft));let t=0;if(!k&&t<5){O(d,ft,setTimeout(()=>{var i;return p(i=d,Qt).call(i,e)},500)),t++;return}clearInterval(p(d,ft));const n={animation:200,delay:100,delayOnTouchOnly:!0,onStart:function(){e.querySelectorAll(".scene.nav-item").forEach(i=>i.classList.add("no-hover")),this.el.classList.add("no-hover")},onEnd:function(){e.querySelectorAll(".scene.nav-item").forEach(i=>i.classList.remove("no-hover")),this.el.classList.remove("no-hover")}},o={...n,draggable:".scene.nav-item",onEnd:async i=>{var N,b;const r=e.querySelectorAll(".scene.nav-item"),l=[],c=Array.from(r).map(v=>game.scenes.get(v.dataset.sceneId));let u=0;const h=CONST.SORT_INTEGER_DENSITY;for(const v of c){if(!v)continue;const I={_id:v.id};d.selectedFolder===le?v.navigation&&(I.navOrder=u,u+=h):d.selectedFolder&&((N=v.folder)==null?void 0:N.id)===d.selectedFolder.id&&(I.sort=u,u+=h),l.push(I)}const m=game.scenes.contents.filter(v=>!l.some(I=>I._id===v.id));m.sort((v,I)=>{var z,B;if(d.selectedFolder===le)return!v.navigation&&!I.navigation?0:v.navigation?I.navigation?v.navOrder-I.navOrder:-1:1;{const Y=((z=v.folder)==null?void 0:z.id)===d.selectedFolder.id,V=((B=I.folder)==null?void 0:B.id)===d.selectedFolder.id;return!Y&&!V?0:Y?V?v.sort-I.sort:-1:1}});for(const v of m)d.selectedFolder===le?v.navigation&&(l.push({_id:v.id,navOrder:u}),u+=h):((b=v.folder)==null?void 0:b.id)===d.selectedFolder.id&&(l.push({_id:v.id,sort:u}),u+=h);l.length&&(await Scene.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}},s={...n,draggable:".folder.nav-item",onEnd:async i=>{var N,b;const r=e.querySelectorAll(".folder.nav-item"),l=[],c=Array.from(r).map(v=>{const I=v.dataset.folderId;return game.scenes.folders.find(z=>z.id===I)}).filter(v=>v);let u=0;const h=CONST.SORT_INTEGER_DENSITY;for(const v of c)v&&((N=v.folder)==null?void 0:N.id)===((b=d.selectedFolder)==null?void 0:b.id)&&(l.push({_id:v.id,sort:u}),u+=h);const m=game.scenes.folders.filter(v=>{var I,z;return((I=v.folder)==null?void 0:I.id)===((z=d.selectedFolder)==null?void 0:z.id)&&!l.some(B=>B._id===v.id)}).sort((v,I)=>v.sort-I.sort);for(const v of m)l.push({_id:v.id,sort:u}),u+=h;l.length&&(await Folder.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}};k.create(e,o),k.create(e,s)}),w(d,"refreshFolderView",async()=>{d.noFolderView()||(d.folderListData=d.getFolders(ui.scenes.folders),await d.renderSceneFolders(),F.placeNavButtons())}),w(d,"updateSearchResults",e=>{if(d.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=game.scenes.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())&&s.permission>=2),o=game.scenes.folders.filter(s=>s.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),o.forEach(s=>{const i=document.createElement("li");i.className="folder",i.dataset.folderId=s.id,i.innerHTML=`<a><i class="fas fa-folder"></i> ${s.name}</a>`,i.addEventListener("click",p(d,He)),t.appendChild(i)}),n.forEach(s=>{const i=document.createElement("li");i.className="scene",i.dataset.sceneId=s.id,i.innerHTML=`<a><i class="fas fa-map"></i> ${s.name}</a>`,i.addEventListener("dblclick",p(d,mt)),i.addEventListener("click",p(d,ht)),t.appendChild(i)}),o.length===0&&n.length===0){const s=document.createElement("li");s.className="no-results",s.textContent="No matching results found",t.appendChild(s)}}),L(d,Jt,e=>{const t=()=>{const o=document.querySelector("#context-menu");if(!o)return!1;const s=o.querySelectorAll(".context-item"),i=Array.from(s).find(r=>r.innerHTML.includes(game.i18n.localize("SCENES.ToggleNav")));return i?(i.innerHTML=`<i class="fas fa-compass fa-fw"></i>${e}`,!0):!1};if(t())return;const n=new MutationObserver((o,s)=>{t()&&s.disconnect()});n.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>n.disconnect(),1e3)}),L(d,De,e=>{e.stopPropagation(),e.preventDefault();const t=document.querySelector("#crlngn-scene-folders"),n=e.type.startsWith("mouse"),o=!F.showFolderListOnClick;if(n&&o&&e.type==="mouseover"){t!=null&&t.classList.contains("open")||t==null||t.classList.add("open");return}if(n&&o&&e.type==="mouseleave"){t==null||t.classList.remove("open");return}n||(t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),document.addEventListener("click",p(d,tt))))}),L(d,tt,e=>{e.preventDefault(),document.removeEventListener("click",p(d,tt));const t=e.target,n=document.querySelector("#crlngn-scene-folders");n!=null&&n.classList.contains("open")&&!n.contains(t)&&n.classList.remove("open")}),L(d,Se,null),L(d,ht,e=>{var i;e.preventDefault(),e.stopPropagation(),document.removeEventListener("click",p(d,tt));const t=e.currentTarget,n=t.dataset,o=game.scenes.get(n.sceneId||n.documentId),s=(i=t.parentElement)==null?void 0:i.classList.contains("search-results");p(d,Se)&&(clearTimeout(p(d,Se)),O(d,Se,null)),O(d,Se,setTimeout(()=>{s&&(o.navigation=!0,d.selectedFolder=d.selectFolder(le)),o.view(),d.refreshFolderView(),O(d,Se,null)},250))}),L(d,mt,e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset,o=game.scenes.get(n.sceneId||n.documentId);p(d,Se)&&(clearTimeout(p(d,Se)),O(d,Se,null)),o.activate(),d.refreshFolderView()}),L(d,wn,e=>{var t;switch(e.stopPropagation(),e.preventDefault(),F.useNavBackButton){case Qe.defaultScenes.name:d.selectedFolder=d.selectFolder(le),f.log("onBackButton",[Qe.defaultScenes.name]);break;case Qe.lastScene.name:const n=p(d,ge).length,o=n?p(d,ge)[n-2]:null,s=o?(t=game.scenes)==null?void 0:t.get(o):null;if(s){s.view();const r=!(s.folder&&d.selectedFolder.id===s.folder.id)&&s.navigation||!s.folder?le:s.folder.id;d.selectedFolder=d.selectFolder(r),p(d,ge).splice(n-1,1)}f.log("onBackButton",[s,o,p(d,ge)]);break}d.refreshFolderView()}),L(d,Ln,e=>{e.stopPropagation(),e.preventDefault(),d.selectedFolder=d.selectFolder(le),d.refreshFolderView()}),L(d,He,e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("click",p(d,tt));const n=e.currentTarget.dataset,o=d.selectFolder(n.folderId||"");o!==d.selectedFolder&&(F.navPos=0),d.selectedFolder=o,d.refreshFolderView()}),w(d,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;d.searchValue=n,d.updateSearchResults(n)}),L(d,co,e=>{var o,s,i,r;e.preventDefault(),e.stopPropagation();let t=((s=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:s.sceneId)||"",n=((r=(i=e.currentTarget)==null?void 0:i.dataset)==null?void 0:r.folderId)||"";t?game.scenes.get(t).view():n&&(d.selectedFolder=d.selectFolder(n),d.refreshFolderView())}),w(d,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!F.navFoldersForPlayers||!F.navFoldersEnabled||!F.sceneNavEnabled});let ne=d;var yt;const y=class y{static registerSettings(){const e=E();f.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async r=>{const l=r[1];f.log("Registering... ",[r],!0);const c={name:l.label,hint:l.hint,default:l.default,type:l.propType,scope:l.scope,config:l.config,requiresReload:l.requiresReload||!1,onChange:u=>y.apply(l.tag,u)};(l.choices||l.options)&&(c.choices=l.choices||l.options),await game.settings.register(me,l.tag,c),y.get(l.tag)==null&&(f.log("resetting...",[l.tag]),y.set(l.tag,l.default)),game.keybindings.register(me,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{y.hideInterface()},restricted:!1})}),y.applyThemeSettings(),y.applyCustomCSS(),y.applyModuleAdjustments(),Object.entries(vs()).forEach(async r=>{const l=r[1],c={name:l.tag,label:l.label,hint:l.hint,icon:l.icon,type:l.propType,restricted:l.restricted};await game.settings.registerMenu(me,l.tag,c)}),Hooks.on(U.RENDER_SCENE_CONTROLS,y.applyLeftControlsSettings),Hooks.on(U.RENDER_PLAYERS_LIST,y.applyPlayersListSettings),Hooks.on(U.RENDER_HOTBAR,()=>{y.firstLoad&&(y.firstLoad=!1,y.applyHotBarCollapse()),y.applyHotBarSettings()}),y.applyDebugSettings(),y.applyChatStyles(),y.applyBorderColors(),e.sceneNavMenu.fields.forEach(r=>{y.apply(e[r].tag)}),e.customFontsMenu.fields.forEach(r=>{y.applyCustomFonts(e[r].tag)}),e.leftControlsMenu.fields.forEach(r=>{y.applyLeftControlsSettings(e[r].tag)}),y.applyUiScale()}static get(e,t=me){if(!e)return null;let n=!1;if(t===me)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,f.log("GET Setting",[s,n])}return n}static set(e,t,n=me){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),f.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,s,i,r;const n=E();switch(t===void 0&&(t=y.get(e)),f.log("SettingsUtil.apply",[e,t,y.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:y.applyHotBarSettings();break;case n.collapseMacroBar.tag:y.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:y.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:y.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:case n.hideFoundryLogo.tag:y.applyLeftControlsSettings(e,t);break;case n.cameraDockMenu.tag:y.applyCameraPosX(),y.applyCameraPosY(),y.applyCameraWidth(),y.applyCameraHeight();break;case n.chatBorderColor.tag:St.chatBorderColor=y.get(n.chatBorderColor.tag),f.log("SettingsUtil.apply",[e]),y.applyBorderColors();break;case n.enableChatStyles.tag:St.enableChatStyles=y.get(n.enableChatStyles.tag),f.log("SettingsUtil.apply",[e]),y.applyChatStyles();break;case n.enforceDarkMode.tag:y.resetFoundryThemeSettings();break;case n.debugMode.tag:y.applyDebugSettings();break;case n.sceneNavEnabled.tag:F.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:F.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:F.navShowRootFolders=t;break;case n.sceneClickToView.tag:F.sceneClickToView=t,(o=game.scenes)==null||o.directory.render(),ne.refreshFolderView();break;case n.useSceneIcons.tag:F.useSceneIcons=t,(s=game.scenes)==null||s.directory.render(),ne.refreshFolderView();break;case n.useNavBackButton.tag:F.useNavBackButton=t,(i=ui.nav)==null||i.render();break;case n.useScenePreview.tag:F.useScenePreview=t,(r=ui.nav)==null||r.render();break;case n.sceneNavAlias.tag:F.sceneNavAlias=t,ne.refreshFolderView();break;case n.navStartCollapsed.tag:F.navStartCollapsed=t;break;case n.showFolderListOnClick.tag:F.showFolderListOnClick=t,ne.refreshFolderView();break;case n.showNavOnHover.tag:F.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:F.isCollapsed=y.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:y.applySceneNavPos();break;case n.colorTheme.tag:y.applyThemeSettings();break;case n.customStyles.tag:y.applyCustomCSS();break;case n.adjustOtherModules.tag:y.applyModuleAdjustments();break;case n.otherModulesList.tag:y.applyOtherModulesList();break;case n.uiScale.tag:y.applyUiScale(t);break}}static applyBorderColors(){const e=E(),t=y.get(e.chatBorderColor.tag),n=document.querySelector("body");t===vt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===vt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=E(),t=y.get(e.enableChatStyles.tag),n=document.querySelector("body");f.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=E(),t=y.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=E();y.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const n=E(),o=y.get(n.sceneNavEnabled.tag),s=document.querySelector("#ui-left"),i=document.querySelector("#ui-left #logo"),r=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),f.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:y.get(n.controlsAutoHide.tag)?s.classList.add("auto-hide"):s.classList.remove("auto-hide");break;case n.hideFoundryLogo.tag:const c=window.getComputedStyle(r).getPropertyValue("--top-nav-height")||"0px",u=parseFloat(c)||0,h=y.get(n.hideFoundryLogo.tag);f.log("applyLeftControlsSettings",[e,u,c]),h===void 0||h===!0?(i.classList.remove("visible"),A.addCSSVars("--ui-top-padding",`${u}px`),document.querySelector("body").classList.remove("logo-visible")):(i.classList.add("visible"),o?(A.addCSSVars("--ui-top-padding",`${72+u}px`),document.querySelector("body").classList.add("logo-visible")):A.addCSSVars("--ui-top-padding","72px"));break;case n.controlsBottomBuffer.tag:y.applyControlsBuffer();break;case n.controlsIconSize.tag:y.applyControlIconSize();break}}static applyControlIconSize(){const e=E(),t=y.get(e.controlsIconSize.tag);document.querySelector("body");const n=Ze[t]?Ze[t].size:Ze.regular.size;function o(s){switch(s){case Ze.large.name:return"var(--font-size-18);";case Ze.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[n]),A.addCSSVars("--icon-font-size",o(t)),A.addCSSVars("--left-control-item-size",n),y.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyUiScale(e){var o,s,i,r,l,c;const t=E(),n=e||y.get(t.uiScale.tag);n===zn.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(s=document.querySelector("#interface"))==null||s.classList.remove("scale-large"),y.set(t.controlsIconSize.tag,n),A.addCSSVars("--macro-size","50px")):n===zn.large.name?((i=document.querySelector("#interface"))==null||i.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),y.set(t.controlsIconSize.tag,n),A.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(c=document.querySelector("#interface"))==null||c.classList.remove("scale-large"),y.set(t.controlsIconSize.tag,n),A.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=E(),t=y.get(e.leftControlsMenu.tag),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;A.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,n;const e=E();f.log("applyPlayersListSettings",[document.querySelector("#players"),y.get(e.autoHidePlayerList.tag)]),y.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),it.checkPlayersList()}static applySceneNavPos(e){const t=E();F.navPos=e||y.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockPosX;Je.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockPosY;Je.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockWidth;Je.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockHeight;Je.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=E(),o=n.customFontsMenu.fields,s={};switch(f.log("applyCustomFonts",[e,t]),o.forEach(i=>{s[i]=y.get(n[i].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:A.addCSSVars("--crlngn-font-family",t||s.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:A.addCSSVars("--crlngn-font-titles",t||s.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:A.addCSSVars("--crlngn-font-journal-body",t||s.journalFontBody||s.journalFontBody||"");break;case n.journalFontTitles.tag:A.addCSSVars("--crlngn-font-journal-title",t||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var i,r;const e=E(),t=A.isModuleOn("monks-player-settings"),n=A.isModuleOn("force-client-settings"),o=y.get(e.enforceDarkMode.tag);if(o&&t){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),y.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),y.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","colorScheme");f.log("resetFoundryThemeSettings",[s,o]),s===!1&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=E();f.debugOn=e||y.get(t.debugMode.tag)}};yt=new WeakMap,L(y,yt,!1),w(y,"firstLoad",!0),w(y,"applyThemeSettings",e=>{const t=E(),n=e||y.get(t.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,n,y.get(t.colorTheme.tag)]),xe.forEach(s=>{s.className&&o.classList.remove(s.className)}),n&&o.classList.add(n)}),w(y,"applyCustomCSS",e=>{const t=E(),n=e||y.get(t.customStyles.tag)||"";A.addCustomCSS(n)}),w(y,"applyModuleAdjustments",e=>{const t=E();(e||y.get(t.adjustOtherModules.tag)||!1)&&it.addModuleClasses()}),w(y,"applyOtherModulesList",e=>{const t=E(),n=e||y.get(t.otherModulesList.tag);f.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?y.set(t.adjustOtherModules.tag,!1):y.set(t.adjustOtherModules.tag,!0),it.addModuleClasses()}),w(y,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");p(y,yt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),O(y,yt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),O(y,yt,!0))});let T=y;class ho{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,ho.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const n=e.offsetHeight;A.addCSSVars("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var qe,_t,en;const X=class X{static init(){f.log("LeftControls - init",[]),Hooks.on(U.RENDER_SCENE_CONTROLS,X.initSceneControls),X.initSceneControls()}static resetLocalVars(){O(X,qe,document.querySelector("#ui-left #controls")),O(X,_t,document.querySelector("#ui-left"))}static initSceneControls(){f.log("initSceneControls",[]),X.resetLocalVars(),X.observeControlsWidth()}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!p(X,qe))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};O(X,en,new ResizeObserver(n=>{t(()=>X.updateCSSVars(),250)})),p(X,en).observe(p(X,qe),{box:"border-box"}),X.updateCSSVars()}static updateCSSVars(){if(!p(X,qe))return;let e=parseInt(p(X,_t).offsetWidth),t=parseInt(p(X,qe).offsetWidth),n=-e+t;f.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&A.addCSSVars("--ui-controls-margin-left",n+"px")}};qe=new WeakMap,_t=new WeakMap,en=new WeakMap,L(X,qe),L(X,_t),L(X,en);let eo=X;class ts{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=E();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){f.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=T.get(e.lastUpdateId.tag);if(f.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),T.set(e.lastUpdateId.tag,n.id),f.log("checkForUpdates SUCCESS",[n.id])}catch(t){f.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}w(ts,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());class js{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return f.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Tn;const zt=class zt{static init(){Hooks.once(U.INIT,()=>{var n,o;document.querySelector("body").classList.add(me),(n=document.querySelector("#ui-middle"))==null||n.classList.add(me),f.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},T.registerSettings();const e=E(),t=T.get(e.disableUI.tag);if(f.log(U.INIT,[t]),t){document.querySelector("body").classList.remove(me),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(me);return}F.navFoldersEnabled&&(window.crlngnUI.SceneNavFolders=ne,ne.init()),F.init(),Je.init(),ho.init(),eo.init(),St.init(),Hooks.on(U.RENDER_CHAT_MESSAGE,p(zt,Tn))}),Hooks.once(U.READY,()=>{f.log("Core Ready",[]);const e=E();var t=T.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),js.init(),it.init(),F.checkSceneNavCompat(),ts.init(),F.navFoldersEnabled&&(ne.init(),ne.registerHooks()),T.get(e.enableChatStyles.tag)&&zt.addCSSLocalization(),T.resetFoundryThemeSettings(),T.applyOtherModulesList(),A.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";A.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),A.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),A.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),A.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),A.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),A.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),A.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),A.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),A.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),A.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Tn=new WeakMap,L(zt,Tn,(e,t)=>{f.log(U.RENDER_CHAT_MESSAGE,[e,t]),St.enrichCard(e,t)});let to=zt;to.init();
//# sourceMappingURL=crlngn-ui.js.map
