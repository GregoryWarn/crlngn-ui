var Oa=Object.defineProperty;var wo=l=>{throw TypeError(l)};var Ma=(l,e,t)=>e in l?Oa(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var y=(l,e,t)=>Ma(l,typeof e!="symbol"?e+"":e,t),xn=(l,e,t)=>e.has(l)||wo("Cannot "+t);var h=(l,e,t)=>(xn(l,e,"read from private field"),t?t.call(l):e.get(l)),T=(l,e,t)=>e.has(l)?wo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),A=(l,e,t,n)=>(xn(l,e,"write to private field"),n?n.call(l,t):e.set(l,t),t),U=(l,e,t)=>(xn(l,e,"access private method"),t);const z={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_TOKEN_HUD:"renderTokenHUD"},x="crlngn-ui",hn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],On=class On{static log(e="",t=[],n=!1){try{const o=On.debugOn;if(!(n||o))return;console.log(...hn,e,...t)}catch{console.log(...hn,e,...t)}}static warn(e="",t=[]){console.warn(...hn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...hn,e)}};y(On,"debugOn",!1);let g=On;const Aa={select:"select",checkbox:"checkbox",text:"text",number:"number"},N={client:"client",world:"world"},Pt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Ct={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Pe={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},qn=140,ce=[{label:"Carolingian Teal",className:"crlngn-theme",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(130, 110, 160)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function S(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:N.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!0,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1},scope:N.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:N.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"crlngn-theme",adjustOtherModules:!0,otherModulesList:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player'",customStyles:""},scope:N.world,config:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:Ct.playerColor.name,useLeftChatBorder:!0},scope:N.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:N.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:N.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:Pe.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:N.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:N.client,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:N.client,config:!0,default:!1},navFoldersEnabled:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavItemWidth:{tag:"v2-scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,default:"",scope:N.client,config:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:String,default:!0,scope:N.world,config:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:N.client,config:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:N.client,config:!0},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:N.client,config:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"crlngn-theme",scope:N.world,config:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!0,scope:N.world,config:!1},otherModulesList:{tag:"v2-other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Youtube Player":"'fvtt-youtube-player'"},scope:N.world,config:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:N.world,config:!1},chatBorderColor:{tag:"v2-chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:Ct.playerColor.name,scope:N.client,config:!1},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:Aa.checkbox,default:!0,scope:N.client,config:!1},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:N.client,config:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:N.client,config:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:N.client,config:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:N.client,config:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:N.client,config:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:Pe.horizontal.name,scope:N.client,config:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:N.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:N.world,config:!1,default:""},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:N.client,config:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:N.client,config:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:N.client,config:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:N.client,config:!1},cameraDockFadeOut:{tag:"v2-camera-dock-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!0,scope:N.client,config:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:N.client,config:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:N.client,config:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:N.client,config:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:N.client,config:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:N.client,config:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:N.client,config:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:N.client,config:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:N.client,config:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:N.client,config:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:N.client,config:!1}}}const{ApplicationV2:Da,HandlebarsApplicationMixin:Pa}=foundry.applications.api;var lo,Lt,Wo,$o;const Ne=class Ne extends Pa(Da){static get DEFAULT_OPTIONS(){return{id:S().playersListMenu.tag,actions:{redefine:U(Ne,Lt,$o)},form:{handler:U(Ne,Lt,Wo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=S(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=v.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}}),g.log("_prepareContext A",[o,n,a,s]);const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return g.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Ne.element=this.element,Ne.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ne.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.playersListMenu.tag);g.log("_onRender",[e,t,a])}};lo=new WeakMap,Lt=new WeakSet,Wo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(g.log("Saving setting:",[s[i]]),v.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},$o=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),g.log("#onReset",[e,t,n.playersListMenu.default])},T(Ne,Lt),T(Ne,lo),y(Ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Io=Ne;const{ApplicationV2:Fa,HandlebarsApplicationMixin:Ga}=foundry.applications.api;var Nt,Yo,Xo,Jt,Kn;const Te=class Te extends Ga(Fa){constructor(){super(...arguments);T(this,Jt)}static get DEFAULT_OPTIONS(){return{id:S().cameraDockMenu.tag,actions:{redefine:U(Te,Nt,Xo)},form:{handler:U(Te,Nt,Yo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=S(),o=n.cameraDockMenu.fields,a={},s={},i={};o.forEach(d=>{if(g.log("_prepareContext",[n[d].oldName]),n[d]){const p=v.get(n[d].tag);a[d]=n[d],s[d]=p!==void 0?p:n[d].default,i[d]=n[d].default}});const r={...s,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;g.log("_onRender",[t,n]),Te.element=this.element,Te.element.querySelector(".toggle-hint").addEventListener("click",()=>{Te.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');g.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",U(this,Jt,Kn).bind(this)),U(this,Jt,Kn).call(this,{target:a}))}};Nt=new WeakSet,Yo=async function(t,n,o){const a=S();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,i=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!i.hasOwnProperty(p)&&(i[p]=!1)});const r=foundry.utils.expandObject(i),c=v.get(a.enableFloatingDock.tag);g.log("Compared settings:",[r.enableFloatingDock,c]),s.forEach(p=>{g.log("Saving setting >>",[a[p].tag,r[p]]),r[p]!==void 0&&v.set(a[p].tag,r[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),r.enableFloatingDock!==c&&location.reload()},Xo=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.fields,r={};i.forEach(c=>{o[c]&&(o[c],r[c]=o[c].default)}),s.forEach(c=>{c.value=r[c.name]}),g.log("#onReset",[t,n,o.cameraDockMenu.default])},Jt=new WeakSet,Kn=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(i=>i.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(i=>i.disabled=!t.target.checked),g.log("onDockEnabledChange",[this.element,n,o])},T(Te,Nt),y(Te,"element"),y(Te,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ro=Te;const{ApplicationV2:za,HandlebarsApplicationMixin:xa}=foundry.applications.api;var co,Tt,Jo,Ko;const we=class we extends xa(za){static get DEFAULT_OPTIONS(){return{id:S().chatMessagesMenu.tag,actions:{redefine:U(we,Tt,Ko)},form:{handler:U(we,Tt,Jo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var r;const t=S(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(g.log("_prepareContext",[t[c].oldName]),t[c]){const d=v.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),g.log("_prepareContext",[a,s]);const i={...a,default:{...s},isGM:(r=game.user)==null?void 0:r.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();we.element=this.element,we.element.querySelector(".toggle-hint").addEventListener("click",()=>{we.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.chatMessagesMenu.tag);g.log("_onRender",[e,t,a])}};co=new WeakMap,Tt=new WeakSet,Jo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(d=>{o[d].inputType==="checkbox"&&!s.hasOwnProperty(d)&&(s[d]=!1)});const i=foundry.utils.expandObject(s),r=v.get(o.chatBorderColor.tag);g.log("Compared settings:",[i.chatBorderColor,r]),a.forEach(d=>{g.log("Saving setting >>",[o[d].tag,i[d]]),i[d]!==void 0&&v.set(o[d].tag,i[d])}),i.chatBorderColor!==r&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ko=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(we,Tt),T(we,co),y(we,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ko=we;const Vt=class Vt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family");i&&(t.add(i),g.log("Found font-face rule:",[i]))}else if(s instanceof CSSImportRule){if(g.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const r=await(await fetch(s.href)).text();this.extractFontsFromCSSText(r,t)}catch(i){g.warn("Error fetching imported CSS:",[i])}}}}catch(o){if(o.name==="SecurityError"&&e.href){g.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){g.warn("Error fetching cross-origin stylesheet:",[a])}}else g.warn("Error accessing CSS rules:",[o])}}catch(o){g.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];g.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,i=a.match(s);if(i&&i[2]){const r=i[2].trim();t.add(r),g.log("Found font-face in CSS text:",[r])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return g.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const m=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,m.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const r=o.substring(a+16,s).split(";").map(m=>m.trim()).filter(m=>m!==""),c={};r.forEach(m=>{const E=m.split(":");if(E.length>=2){const C=E[0].trim(),I=E.slice(1).join(":").trim();C&&(c[C]=I)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const d=Object.entries(c).map(([m,E])=>`  ${m}: ${E};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+d+`
}`+o.substring(s+1);n.textContent=p,g.log("addCSSVars",[e,t,n.textContent])}static addCustomCSS(e,t=!0){let n=document.querySelector("#crlngn-ui-custom-css");if(!n){const o=document.querySelector("body");n=document.createElement("style"),n.id="crlngn-ui-custom-css",n.textContent="",o.appendChild(n)}if(!t){n.textContent+=e;return}n.textContent.includes(e)||(n.textContent+=e)}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const i=n==="horizontal",r=i?e.scrollLeft:e.scrollTop,c=t-r;if(c===0)return a&&a(),null;const d=performance.now(),p=E=>{const C=E-d;if(C>=o){i?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const I=C/o,q=I<.5?2*I*I:1-Math.pow(-2*I+2,2)/2;i?e.scrollLeft=r+c*q:e.scrollTop=r+c*q;const V=requestAnimationFrame(p);return e.dataset.scrollAnimationId=V,V},m=requestAnimationFrame(p);return e.dataset.scrollAnimationId=m,m}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const o={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(g.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(o,n),foundry.applications.api.DialogV2.confirm(o)}};y(Vt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));g.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);g.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const i=s.href||"",r=i.includes("css/")||i.includes("styles/"),c=i.includes("modules/crlngn-ui/"),d=i.includes("systems/");if(i&&!r&&!c&&!d){g.log("Skipping stylesheet:",[i]);continue}g.log("Processing stylesheet:",[s,i]),await Vt.processStyleSheetRules(s,o)}}catch(i){g.warn("Error processing stylesheet:",[i])}return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))}),y(Vt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let D=Vt;const{ApplicationV2:qa,HandlebarsApplicationMixin:Ua}=foundry.applications.api;var uo,Ke,Zo,Qo,_o;const le=class le extends Ua(qa){static get DEFAULT_OPTIONS(){return{id:S().customFontsMenu.tag,actions:{redefine:U(le,Ke,_o)},form:{handler:U(le,Ke,Zo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=S(),n=t.customFontsMenu.fields,o={},a={},s={},i=await D.getAllFonts();return n.forEach(c=>{if(t[c]){const d=v.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:i,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){le.element=this.element,le.element.querySelector(".toggle-hint").addEventListener("click",()=>{le.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),le.element.querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const c=()=>{var d;U(d=le,Ke,Qo).call(d),r.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",d=>{const p=r.classList.contains("active"),m=Array.from(r.querySelectorAll(".dropdown-option"));let E=m.findIndex(C=>C.classList.contains("highlighted"));d.key==="ArrowDown"||d.key==="ArrowUp"?(d.preventDefault(),p||r.classList.add("active"),m.forEach(C=>C.classList.remove("highlighted")),E===-1?E=d.key==="ArrowDown"?0:m.length-1:E=d.key==="ArrowDown"?(E+1)%m.length:(E-1+m.length)%m.length,m[E]&&(m[E].classList.add("highlighted"),m[E].scrollIntoView({block:"nearest"}))):d.key==="Enter"?(d.preventDefault(),p&&E!==-1&&m[E]&&m[E].click()):d.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",d=>{i.contains(d.target)||r.classList.remove("active")})}),le.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const r=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),r.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};uo=new WeakMap,Ke=new WeakSet,Zo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(g.log("Saving setting:",[s[i]]),v.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Qo=function(){le.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},_o=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(le,Ke),T(le,uo),y(le,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Oo=le;const{ApplicationV2:Ba,HandlebarsApplicationMixin:Ha}=foundry.applications.api;var go,wt,ea,ta;const Ie=class Ie extends Ha(Ba){static get DEFAULT_OPTIONS(){return{id:S().leftControlsMenu.tag,actions:{redefine:U(Ie,wt,ta)},form:{handler:U(Ie,wt,ea),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=S(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=v.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Ie.element=this.element,Ie.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ie.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.leftControlsMenu.tag);g.log("_onRender",[e,t,a])}};go=new WeakMap,wt=new WeakSet,ea=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(g.log("Saving setting:",[s[i]]),v.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ta=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),g.log("#onReset",[e,t,n.leftControlsMenu.default])},T(Ie,wt),T(Ie,go),y(Ie,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Mo=Ie;const{ApplicationV2:Va,HandlebarsApplicationMixin:ja}=foundry.applications.api;var fo,It,na,oa,Kt,Zn;const Re=class Re extends ja(Va){constructor(){super(...arguments);T(this,Kt)}static get DEFAULT_OPTIONS(){return{id:S().sceneNavMenu.tag,actions:{redefine:U(Re,It,oa)},form:{handler:U(Re,It,na),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=S(),o=n.sceneNavMenu.fields,a={},s={},i={};o.forEach(c=>{if(n[c]){const d=v.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}});const r={...s,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;g.log("_onRender",[t,n]),Re.element=this.element,Re.element.querySelector(".toggle-hint").addEventListener("click",()=>{Re.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');g.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",U(this,Kt,Zn).bind(this)),U(this,Kt,Zn).call(this,{target:a}))}};fo=new WeakMap,It=new WeakSet,na=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=S(),s=a.sceneNavMenu.fields;let i=v.get(a.sceneNavEnabled.tag);const r=foundry.utils.expandObject(o.object);s.forEach(d=>{r[d]!==void 0&&(g.log("Saving setting:",[r[d]]),v.set(a[d].tag,r[d]))});let c=v.get(a.sceneNavEnabled.tag);g.log("Saving settings...",[i,c]),await v.set(a.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i!==c&&location.reload()},oa=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),g.log("#onReset",[t,n,o.sceneNavMenu.default])},Kt=new WeakSet,Zn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),g.log("onSceneNavEnabledChange",[this.element,n])},T(Re,It),T(Re,fo),y(Re,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ao=Re;const{ApplicationV2:Wa,HandlebarsApplicationMixin:$a}=foundry.applications.api;var po,ho,Ze,aa,sa,ia;const Q=class Q extends $a(Wa){static get DEFAULT_OPTIONS(){return{id:S().themeAndStylesMenu.tag,actions:{redefine:U(Q,Ze,ia)},form:{handler:U(Q,Ze,aa),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=S(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const d=v.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default,g.log("_prepareContext",[c,d,o[c]])}});const i=ce.find(c=>c.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||ce[0].label;const r={...a,default:{...s},fields:{...o},selectedTheme:i,themes:ce,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){Q.element=this.element,Q.element.querySelector(".toggle-hint").addEventListener("click",()=>{Q.element.querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))}),this._themes=ce,Q.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(d=>{const p=d.closest(".dropdown-wrapper"),m=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!m)return;const E=()=>{var C;U(C=Q,Ze,sa).call(C),m.classList.add("active")};d.addEventListener("focus",E),d.addEventListener("click",E),d.addEventListener("keydown",C=>{const I=m.classList.contains("active"),q=Array.from(m.querySelectorAll(".dropdown-option"));let V=q.findIndex(Z=>Z.classList.contains("highlighted"));C.key==="ArrowDown"||C.key==="ArrowUp"?(C.preventDefault(),I||m.classList.add("active"),q.forEach(Z=>Z.classList.remove("highlighted")),V===-1?V=C.key==="ArrowDown"?0:q.length-1:V=C.key==="ArrowDown"?(V+1)%q.length:(V-1+q.length)%q.length,q[V]&&(q[V].classList.add("highlighted"),q[V].scrollIntoView({block:"nearest"}))):C.key==="Enter"?(C.preventDefault(),I&&V!==-1&&q[V]&&q[V].click()):C.key==="Escape"&&m.classList.remove("active")}),document.addEventListener("click",C=>{p.contains(C.target)||m.classList.remove("active")})});const a=Q.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(d=>{d.addEventListener("mouseenter",()=>{d.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(m=>m.classList.remove("highlighted")),d.classList.add("highlighted")}),d.addEventListener("click",function(p){g.log("option",[d,d.querySelector(".theme-name")]);const m=d.closest(".dropdown-wrapper").querySelector("input");let E=d.querySelector(".theme-name").innerHTML.toString();if(m.value=E,m.name==="colorTheme"){const I=s._themes.find(q=>q.label===E);s._selectedTheme=I,s._updateThemePreview(I)}d.closest(".dropdown-options").classList.remove("active")})});const i=Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),r=Q.element.querySelector("input.otherModulesList");i.forEach(d=>{d.addEventListener("change",p=>{const m=p.currentTarget;let C=`${r.value}`.split(",")||[],I=C.indexOf(m.value);!p.currentTarget.checked&&I>-1?C.splice(I,1):p.currentTarget.checked&&I===-1&&C.push(m.value),r.value=C.join(","),g.log("checkbox changed",[C,r.value])})}),Q.element.querySelector("input.adjustOtherModules").addEventListener("change",d=>{Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(m=>{m.checked=d.currentTarget.checked;const E=new Event("change",{bubbles:!0});m.dispatchEvent(E)})})}_updateThemePreview(e){if(g.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};po=new WeakMap,ho=new WeakMap,Ze=new WeakSet,aa=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),i=ce.find(r=>r.label===s.colorTheme);s.colorTheme=i?i.className:"",a.forEach(r=>{s[r]!==void 0&&v.set(o[r].tag,s[r]),g.log("Saving setting:",[o[r].tag,s[r]])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},sa=function(){Q.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ia=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)});const r=ce.find(c=>c.label===n.colorTheme.default);i.colorTheme=(r==null?void 0:r.label)||ce[0].label,a.forEach(c=>{c.value=i[c.name]})},T(Q,Ze),T(Q,po),T(Q,ho,!1),y(Q,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Do=Q;const{ApplicationV2:Ya,HandlebarsApplicationMixin:Xa}=foundry.applications.api;var mo,Rt,ra,la;const ke=class ke extends Xa(Ya){static get DEFAULT_OPTIONS(){return{id:S().interfaceOptionsMenu.tag,actions:{redefine:U(ke,Rt,la)},form:{handler:U(ke,Rt,ra),closeOnSubmit:!0},position:{width:540,height:"auto"},tag:"form",window:{icon:"fas fa-table",title:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title")}_prepareContext(e){const t=S(),n=t.interfaceOptionsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=v.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.save"}]};return g.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();ke.element=this.element,ke.element.querySelector(".toggle-hint").addEventListener("click",()=>{ke.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.interfaceOptionsMenu.tag);g.log("_onRender",[e,t,a])}};mo=new WeakMap,Rt=new WeakSet,ra=async function(e,t,n){e.preventDefault(),e.stopPropagation();const o=S(),a=o.interfaceOptionsMenu.fields;let s=v.get(o.sceneNavEnabled.tag);v.get(o.navFoldersEnabled.tag);const i=foundry.utils.expandObject(n.object);a.forEach(c=>{i[c]!==void 0&&(g.log("Saving setting:",[i[c]]),v.set(o[c].tag,i[c]))});let r=v.get(o.sceneNavEnabled.tag);v.get(o.navFoldersEnabled.tag),g.log("Saving settings...",[s,r]),await v.set(o.sceneNavMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s!==r&&location.reload()},la=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.interfaceOptionsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),g.log("#onReset",[e,t,n.interfaceOptionsMenu.default])},T(ke,Rt),T(ke,mo),y(ke,"PARTS",{content:{template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Po=ke;foundry.utils;const{ApplicationV2:Ja,HandlebarsApplicationMixin:Ka}=foundry.applications.api;var jo,_,yt,yo,se,ca,da,ua,_n,eo,ga;const O=class O extends Ka(Ja){constructor(){super(...arguments);y(this,"_onRender",(t,n)=>{S(),A(O,_,this.element);const o=h(O,_).querySelectorAll(".toggle-hint");g.log("_onRender",[t,n,this.element]),o.forEach(a=>{a.addEventListener("click",()=>{h(O,_).querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))})}),O.handleCustomFontFields(),O.handleThemeAndStyleFields(),g.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),o=O.getRestrictedTabs();return game.user.isGM||o.forEach(a=>{delete n[a]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0],S(),n.themes=ce;const o=await D.getAllFonts();return n.fontList=o,n}async _preparePartContext(t,n,o){var i;const a=await super._preparePartContext(t,n,o);t in n.tabs&&(a.tab=a.tabs[t]),S(),to();const s=O.getRestrictedTabs();switch(game.user.isGM||s.forEach(r=>{delete a.tabs[r]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const r=((i=O.PARTS[t])==null?void 0:i.menuKey)||null;if(r){const c=O.getMenuContext(r);if(c.fields&&(a.fields={...a.fields,...c.fields}),c.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...c.fieldDefaults}),c.fieldValues){if(t==="themes"){const d=ce.find(p=>p.className===c.fieldValues.colorTheme);c.fieldValues.colorTheme=(d==null?void 0:d.label)||ce[0].label}Object.assign(a,c.fieldValues)}}break}}return g.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var r;const n=S(),o=((r=n[t])==null?void 0:r.fields)||null;if(!o)return{};const a={},s={},i={};return o.forEach(c=>{if(n[c]){const d=v.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}}),{fields:a,fieldValues:s,fieldDefaults:i}}static getRestrictedTabs(){const t=to(),n=[];return Object.entries(t).forEach((o,a)=>{o[0]!=="moduleSettingsMenu"&&o[1].restricted&&n.push(o[0])}),n}static updateSettings(t){let n=!1;const o=S(),i=h(O,_).querySelector(".form-content.active").dataset.tab;if(A(O,yt,i),!t)return;let r;t.object&&(r=foundry.utils.expandObject(t.object)),g.log("#onSubmit #1",[r,t.object]);const c=ce.find(d=>d.label===r.colorTheme);return r.colorTheme=c?c.className:ce[0].className,Object.entries(r).forEach(([d,p])=>{var m;if(r[d]!==void 0){const E=v.get(o[d].tag);v.set(o[d].tag,r[d]),g.log("#onSubmit - Saving setting:",[o[d].tag,r[d]]),(m=o[d])!=null&&m.requiresReload&&E!==r[d]&&(n=!0)}}),g.log("#onSubmit #2",[t]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),n}changeTab(t,n,o){super.changeTab(t,n,o),A(O,yt,t)}static handleCustomFontFields(){const t=h(O,_).querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),i=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!i)return;const r=()=>{var c;U(c=O,se,_n).call(c),i.classList.add("active")};a.addEventListener("focus",r),a.addEventListener("click",r),g.log("handleCustomFontFields",[a,s,i]),a.addEventListener("keydown",U(O,se,eo)),document.addEventListener("click",c=>{s.contains(c.target)||i.classList.remove("active")})}),h(O,_).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let r=a.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),i.value=r,a.closest(".dropdown-options").classList.remove("active")})})}static handleThemeAndStyleFields(){const t=h(O,_).querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll('input[type="text"]:not([hidden])').forEach(r=>{const c=r.closest(".dropdown-wrapper"),d=c==null?void 0:c.querySelector(".dropdown-options");if(!c||!d)return;const p=()=>{var m;U(m=O,se,_n).call(m),d.classList.add("active")};r.addEventListener("focus",p),r.addEventListener("click",p),r.addEventListener("keydown",U(O,se,eo)),document.addEventListener("click",m=>{c.contains(m.target)||d.classList.remove("active")})}),h(O,_).querySelectorAll(".dropdown-option").forEach(r=>{r.addEventListener("mouseenter",()=>{r.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(d=>d.classList.remove("highlighted")),r.classList.add("highlighted")}),r.addEventListener("click",function(c){var E,C,I;g.log("option",[r,r.querySelector(".theme-name")]);const d=(E=r.closest(".dropdown-wrapper"))==null?void 0:E.querySelector("input");let p=(C=r.querySelector(".theme-name"))==null?void 0:C.innerHTML.toString();if(d.value=p,d.name==="colorTheme"){const q=ce.find(V=>V.label===p);U(I=O,se,ga).call(I,q)}r.closest(".dropdown-options").classList.remove("active")})});const a=h(O,_).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),s=h(O,_).querySelector('input.otherModulesList[type="hidden"]');a.forEach(r=>{r.addEventListener("change",c=>{const d=c.currentTarget;let m=`${s.value}`.split(",")||[],E=m.indexOf(d.value);!c.currentTarget.checked&&E>-1?m.splice(E,1):c.currentTarget.checked&&E===-1&&m.push(d.value),s.value=m.join(","),g.log("checkbox changed",[m,s.value])})});const i=h(O,_).querySelector("input.adjustOtherModules");i.addEventListener("change",r=>{const c=h(O,_).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]');c.forEach(m=>{m.checked=r.currentTarget.checked;const E=new Event("change",{bubbles:!0});m.dispatchEvent(E)});const d=[],p=h(O,_).querySelector('input.otherModulesList[type="hidden"]');c.forEach(m=>{m.checked&&d.push(m.value)}),p.value=d.join(","),d.length===0&&(i.checked=!1)})}};_=new WeakMap,yt=new WeakMap,yo=new WeakMap,se=new WeakSet,ca=async function(t,n,o){t.preventDefault(),t.stopPropagation(),O.updateSettings(o)&&D.confirmReload()},da=async function(t,n){const o=S(),s=h(O,_).querySelector(".form-content.active"),i=s.dataset.tab,r=O.PARTS[i].menuKey,c=o[r].default;s.querySelectorAll("input, select").forEach(p=>{p.value=c[p.name],p.type==="checkbox"&&(p.checked=c[p.name])}),g.log("#onReset",[h(O,yt),i,t,n])},ua=function(){const t=[];return Object.entries(O.PARTS).forEach(([n,o])=>{o.menuKey&&t.push({id:n,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${n}`})}),g.log("getTabs",[t]),t},_n=function(){h(O,_).querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},eo=function(t){const n=t.target.closest(".dropdown-wrapper"),o=n==null?void 0:n.querySelector(".dropdown-options"),a=o.classList.contains("active"),s=Array.from(o.querySelectorAll(".dropdown-option"));let i=s.findIndex(r=>r.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||o.classList.add("active"),s.forEach(r=>r.classList.remove("highlighted")),i===-1?i=t.key==="ArrowDown"?0:s.length-1:i=t.key==="ArrowDown"?(i+1)%s.length:(i-1+s.length)%s.length,s[i]&&(s[i].classList.add("highlighted"),s[i].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&i!==-1&&s[i]&&s[i].click()):t.key==="Escape"&&o.classList.remove("active")},ga=function(t){if(g.log("Selected theme updated:",[t]),!t)return;h(O,_).querySelectorAll("span.selected-theme").forEach((o,a)=>{o.style.setProperty("background-color",t.colorPreview[a])})},T(O,se),T(O,_),T(O,yt),T(O,yo),y(O,"selectedTheme"),y(O,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:640,height:"auto"},actions:{redefine:U(O,se,da)},form:{handler:U(O,se,ca),closeOnSubmit:!0}}),y(O,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs"},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs"},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}}),y(O,"TABS",{primary:{initial:"interface",tabs:U(jo=O,se,ua).call(jo),labelPrefix:""}});let Qn=O;function to(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:Qn,restricted:!1}}}var at,We,Zt,Qt,_t,en,tn,nn,on,an,st,sn,rn;const f=class f{static applyFadeOut(e){f.useFadeOut=e}static applyCustomStyle(e){var t;f.enableFloatingDock=e,g.log("applyCustomStyle",[f.enableFloatingDock,ui,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=S();f.enableFloatingDock=v.get(e.enableFloatingDock.tag),f.currSettings={enableFloatingDock:f.enableFloatingDock,defaultVideoWidth:v.get(e.defaultVideoWidth.tag),dockHeight:v.get(e.dockHeight.tag),dockWidth:v.get(e.dockWidth.tag),dockPosX:v.get(e.dockPosX.tag),dockPosY:v.get(e.dockPosY.tag),dockResizeOnUserJoin:v.get(e.dockResizeOnUserJoin.tag)},f.enableFloatingDock?(f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),Hooks.on(z.RENDER_CAMERA_VIEWS,f.onRenderFloating),Hooks.on(z.RENDER_PLAYERS_LIST,f.onRenderPlayersList),Hooks.on(z.CLIENT_SETTING_CHANGED,t=>{g.log("Setting updated",[t]),t.includes("rtcClientSettings")&&f.checkMinimizedState()})):(Hooks.on(z.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(e,t){var n;f.cameraContainer||(f.cameraContainer=document.querySelector("#av-holder")),(n=f.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){S();const o=f.currSettings,a=document.querySelector("#camera-views");if(f.cameraContainer=document.querySelector("#av-holder"),f.cameraContainer)f.cameraContainer.appendChild(a);else{const c=document.createElement("div");f.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}f.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const d=game.users.get(c.dataset.user),p=(d==null?void 0:d.color)||"";g.log("player color",[d,p]),c.style.setProperty("--player-color",p)}),g.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const r=game.settings.get("core","rtcClientSettings");(r==null?void 0:r.hideDock)!==!0?(f.checkMinimizedState(),f.applyDockResize(o.dockResizeOnUserJoin),f.makeDraggable(),f.makeResizeable(),f.applyVideoWidth(),f.resetPositionAndSize()):f.checkMinimizedState()}static onRenderPlayersList(){g.log("onRenderPlayersList")}static applyPositionWithDelay(){f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),f.resetPositionAndSize();let e=0;f.positionIntervalId=setInterval(()=>{f.resetPositionAndSize(),e++,e>=f.positionAttempts&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=S(),n=v.get(t.defaultVideoWidth.tag);let o=e||n;if(o<qn)o=qn,v.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){f.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",o+"px"),s.style.setProperty("--av-width",o+"px")),f.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){S();const a=f.currSettings;if(!f.enableFloatingDock||!f.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){f.checkMinimizedState();return}if(g.log("CameraDock",[a]),!e&&!t&&!n&&!o){const i=a.dockPosX||0,r=a.dockPosY||0;if(f.cameraContainer.style.left=`${i}px`,f.cameraContainer.style.bottom=`${r}px`,f.currSettings.dockResizeOnUserJoin===Pe.off.name){const c=a.dockWidth||0,d=a.dockHeight||0;f.cameraContainer.style.width=`${c}px`,f.cameraContainer.style.height=`${d}px`}}else e!==null&&(f.cameraContainer.style.left=`${e}px`),t!==null&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===Pe.horizontal.name?n!==null&&(f.cameraContainer.style.width=`${n}px`):f.currSettings.dockResizeOnUserJoin===Pe.vertical.name&&o!==null&&(f.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",n=>{var r,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(g.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(r=n.target.parentNode)!=null&&r.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",h(f,nn)),a==null||a.addEventListener("mouseup",h(f,on)),o))return;const s=D.getOffsetBottom(f.cameraContainer);let i=((c=f.cameraContainer)==null?void 0:c.offsetLeft)||0;f.isDragging=!0,A(f,at,n.clientX-i),A(f,We,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,d;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",h(f,an)),a.addEventListener("touchend",h(f,st)),a.addEventListener("touchcancel",h(f,st)),o))return;const s=n.touches[0],i=D.getOffsetBottom(f.cameraContainer);let r=((d=f.cameraContainer)==null?void 0:d.offsetLeft)||0;f.isDragging=!0,A(f,at,s.clientX-r),A(f,We,window.innerHeight-s.clientY-i),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var r,c;if(!f.cameraContainer)return;const e=S(),t=f.currSettings.dockResizeOnUserJoin,n=f.currSettings.defaultVideoWidth||qn,a=(((c=(r=game.webrtc)==null?void 0:r.users)==null?void 0:c.filter(d=>d.active&&d.canBroadcastVideo))||[]).length;if(a===0)return;if(t===Pe.horizontal.name){const d=n*a+16;f.cameraContainer.style.width=`${d}px`}else if(t===Pe.vertical.name){const d=n*a+16;f.cameraContainer.style.height=`${d}px`}const s=parseInt(f.cameraContainer.style.width||0),i=parseInt(f.cameraContainer.style.height||0);s>0&&v.set(e.dockWidth.tag,s),i>0&&v.set(e.dockHeight.tag,i)}static applyDockResize(e=null){if(!f.cameraContainer)return;e?f.currSettings.dockResizeOnUserJoin=e:e=f.currSettings.dockResizeOnUserJoin,f.cameraContainer.classList.remove("horizontal"),f.cameraContainer.classList.remove("vertical");const t=f.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===Pe.horizontal.name?f.cameraContainer.classList.add("horizontal"):e===Pe.vertical.name&&f.cameraContainer.classList.add("vertical"),f.updateDockSize()}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=f.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),f.isResizing=!0,A(f,Zt,o.clientX),A(f,Qt,o.clientY),A(f,tn,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),A(f,_t,f.cameraContainer.offsetWidth),A(f,en,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",h(f,sn)),e==null||e.addEventListener("mouseup",h(f,rn))})}}static checkMinimizedState(){if(!f.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),g.log("Checking minimized state",[e,t]),f.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=f.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!f.cameraContainer)return;if(g.log("handleMinimizedState",[e]),e)f.cameraContainer.parentNode!==t&&(f.originalParent=f.cameraContainer.parentNode,t.prepend(f.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!f.originalParent)return;f.originalParent.prepend(f.cameraContainer),f.makeDraggable(),f.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),g.log("Restored camera position from settings",[f.currSettings])}const o=(a=f.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};at=new WeakMap,We=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,_t=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,on=new WeakMap,an=new WeakMap,st=new WeakMap,sn=new WeakMap,rn=new WeakMap,T(f,at,0),T(f,We,0),y(f,"isDragging",!1),y(f,"cameraContainer"),y(f,"isResizing",!1),T(f,Zt,0),T(f,Qt,0),T(f,_t,0),T(f,en,0),T(f,tn,0),y(f,"currSettings",{}),y(f,"positionIntervalId",null),y(f,"positionAttempts",5),y(f,"useFadeOut",!0),y(f,"enableFloatingDock",!0),T(f,nn,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!f.isDragging||t)){if(g.log("mousemove",[window.innerHeight,e.clientY,h(f,We)]),f.cameraContainer){let n=e.clientX-h(f,at),o=window.innerHeight-e.clientY-h(f,We);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(f,on,e=>{var a,s;const t=S(),n={...f.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(f.isDragging&&!o){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=f.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),v.set(t.dockPosX.tag,n.dockPosX),v.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",h(f,nn)),i==null||i.removeEventListener("mouseup",h(f,on)),f.isDragging=!1,e.stopPropagation()}}),T(f,an,e=>{if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let n=t.clientX-h(f,at),o=window.innerHeight-t.clientY-h(f,We);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(f,st,e=>{var o,a;const t=S(),n={...f.currSettings};if(f.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),v.set(t.dockPosX.tag,n.dockPosX),v.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",h(f,an)),s==null||s.removeEventListener("touchend",h(f,st)),s==null||s.removeEventListener("touchcancel",h(f,st)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),T(f,sn,e=>{if(!f.isResizing)return;const t=h(f,_t)+(e.clientX-h(f,Zt)),n=e.clientY-h(f,Qt),o=h(f,en)+n,a=h(f,tn)-n;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${o}px`,f.cameraContainer.style.bottom=`${a}px`}),T(f,rn,()=>{var o,a,s,i,r,c,d;const e=S(),t={...f.currSettings},n=document.querySelector("body.crlngn-ui");f.isResizing=!1,n==null||n.removeEventListener("mousemove",h(f,sn)),n==null||n.removeEventListener("mouseup",h(f,rn)),g.log("onStopResize",[(o=f.cameraContainer)==null?void 0:o.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(s=f.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((i=f.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((r=f.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((c=f.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((d=f.cameraContainer)==null?void 0:d.style.left)||0),v.set(e.dockWidth.tag,t.dockWidth),v.set(e.dockHeight.tag,t.dockHeight),v.set(e.dockPosY.tag,t.dockPosY),v.set(e.dockPosX.tag,t.dockPosX)});let oe=f;const ee=class ee{static init(){Hooks.on(z.RENDER_SIDE_BAR,ee.onRender),Hooks.on(z.COLLAPSE_SIDE_BAR,ee.onRender),Hooks.on(z.READY,ee.onRender)}static applyFadeOut(e){ee.useFadeOut=e,ee.handleFadeOut()}static applyCustomStyle(e){var t;ee.customStylesEnabled=e,g.log("applyCustomStyle",[ee.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||ee.addChatToggle(o),ee.handleFadeOut(e,o,n)}static handleFadeOut(e,t,n){g.log("handle FadeOut, ChatLogControls",[ee.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");t?t.querySelector("#roll-privacy"):document.querySelector("#ui-right #roll-privacy"),ee.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}};y(ee,"useFadeOut",!0),y(ee,"customStylesEnabled",!0),y(ee,"addChatToggle",async e=>{const t=await renderTemplate(`modules/${x}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t);const o=n.querySelector("button[data-action=toggleChat]");o.addEventListener("click",ee.onToggleChatBox);const a=game.user.getFlag(x,"chatBoxHidden");if(a!==void 0){g.log("Applying saved chat box state",[a]);const s=document.querySelector("#chat-notifications");a?(o.classList.remove("fa-comment-slash"),o.classList.add("fa-comment"),s.classList.add("input-hidden"),D.addCSSVars("--chat-input-height","0px")):(o.classList.add("fa-comment-slash"),o.classList.remove("fa-comment"),s.classList.remove("input-hidden"),D.addCSSVars("--chat-input-height","100px"))}}),y(ee,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");let o=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),D.addCSSVars("--chat-input-height","0px"),o=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),D.addCSSVars("--chat-input-height","100px"),o=!1),game.user.setFlag(x,"chatBoxHidden",o),g.log("Chat box state saved to flag",[o])});let Wt=ee;const he=class he{static init(){const e=S();he.enableChatStyles=v.get(e.enableChatStyles.tag),he.chatBorderColor=v.get(e.chatBorderColor.tag),he.useLeftChatBorder=v.get(e.useLeftChatBorder.tag)}};y(he,"chatBorderColor"),y(he,"enableChatStyles"),y(he,"useLeftChatBorder"),y(he,"enrichCard",async(e,t)=>{var s,i,r,c,d,p,m,E;g.log("renderChatMessage",[he.chatBorderColor,he.enableChatStyles,Ct.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(r=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:r.activity)==null?void 0:c.type)||((m=(p=(d=e.flags)==null?void 0:d.dnd5e)==null?void 0:p.roll)==null?void 0:m.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn"),he.useLeftChatBorder&&o.classList.add("left-border");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(C=>{const I=C.querySelector(".visible-dc"),q=C.querySelector(".hidden-dc");g.log("enrichCard",[I,q]),I.setAttribute("data-ability",C.getAttribute("data-ability")||""),I.setAttribute("data-dc",C.getAttribute("data-dc")||""),q.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),he.chatBorderColor===Ct.playerColor.name&&((E=e.author)!=null&&E.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let dt=he;var $e,it,ln;const F=class F{static init(){g.log("LeftControls - init",[]),Hooks.on(z.RENDER_SCENE_CONTROLS,F.initSceneControls),Hooks.on(z.ACTIVATE_SCENE_CONTROLS,F.onActivateSceneControls),window.addEventListener("resize",F.onActivateSceneControls),F.initSceneControls()}static applyFadeOut(e){F.useFadeOut=e,g.log("applyFadeOut",[e]),F.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls");F.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),g.log("handle FadeOut",[F.customStylesEnabled,F.useFadeOut])}static applyCustomStyle(e){var t;F.customStylesEnabled=e,g.log("applyCustomStyle",[F.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){A(F,$e,document.querySelector("#ui-left #controls")),A(F,it,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){g.log("initSceneControls",[]),F.resetLocalVars(),F.customStylesEnabled?h(F,it).classList.add("crlngn-controls"):h(F,it).classList.remove("crlngn-controls"),F.handleFadeOut(e,t,n)}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!h(F,$e))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};A(F,ln,new ResizeObserver(n=>{t(()=>F.updateCSSVars(),250)})),h(F,ln).observe(h(F,$e),{box:"border-box"}),F.updateCSSVars()}static updateCSSVars(){if(!h(F,$e))return;let e=parseInt(h(F,it).offsetWidth),t=parseInt(h(F,$e).offsetWidth),n=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&D.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),g.log("onActivateSceneControls",[a,o.length,n.length])}};$e=new WeakMap,it=new WeakMap,ln=new WeakMap,T(F,$e),T(F,it),T(F,ln),y(F,"useFadeOut",!0),y(F,"customStylesEnabled",!0),y(F,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return g.log("Error loading navigation button templates:",[e]),!1}});let $t=F;const H=class H{static init(){this.preloadTemplates(),Hooks.on(z.RENDER_HOTBAR,H.onRender)}static applyFadeOut(e){H.useFadeOut=e,H.handleFadeOut()}static onRender(e,t,n){g.log("MacroHotbar onRender",[H.customStylesEnabled]),H.applyCustomStyle(H.customStylesEnabled),H.handleFadeOut(e,t,n),H.addCollapseButton(),H.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(x,"hotbarCollapsed");H.applyHotBarCollapse(!t)}static handleOpenDirectory(e){g.log("open directory")}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");H.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static applyCustomStyle(e){const t=S();H.customStylesEnabled=e!==void 0?e:v.get(t.enableMacroLayout.tag),g.log("applyCustomStyle",[H.customStylesEnabled]),H.applyHotBarLayout()}static applyHotBarLayout(){const e=document.querySelector("#hotbar");e&&(H.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};y(H,"useFadeOut",!0),y(H,"customStylesEnabled",!0),y(H,"macroStartCollapsed",!1),y(H,"preloadTemplates",async()=>{try{const e=[`modules/${x}/templates/macro-buttons.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),y(H,"addCollapseButton",async()=>{const e=document.querySelector("#hotbar #hotbar-controls-right");if(!e)return;game.user.getFlag(x,"hotbarCollapsed");const t=await renderTemplate(`modules/${x}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const n=e.querySelector("button[data-action=collapse]"),o=e.querySelector("button[data-action=openDirectory]");n==null||n.addEventListener("click",H.handleCollapse),o==null||o.addEventListener("click",H.handleOpenDirectory)}),y(H,"applyHotBarCollapse",async e=>{const t=S();H.macroStartCollapsed=e!==void 0?e:v.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(x,"hotbarCollapsed",H.macroStartCollapsed);const n=document.querySelector("#hotbar #hotbar-controls-right"),o=n==null?void 0:n.querySelector("button[data-action=collapse]"),a=document.querySelector("#hotbar");H.macroStartCollapsed&&a?(a.classList.add("collapsed"),o&&(o.classList.remove("fa-angle-down"),o.classList.add("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipKeepOpen"))):(a==null||a.classList.remove("collapsed"),o&&(o.classList.add("fa-angle-down"),o.classList.remove("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipAutoHide")))});let Fe=H;var So;const Oe=class Oe{static init(){D.isModuleOn("foundry-taskbar")&&Hooks.on(z.UPDATE_USER,Oe.checkTaskbarLock),Oe.checkTaskbarLock(),Oe.addModuleClasses(),D.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),D.isModuleOn("fvtt-youtube-player")&&Oe.ytWigdetFadeOut&&(g.log("ModuleCompatUtil.init",[document.querySelector("#sidebar-video-player")]),setTimeout(()=>{var o;(o=document.querySelector("#sidebar-video-player"))==null||o.classList.add("faded-ui")},1e3))}};So=new WeakMap,T(Oe,So),y(Oe,"ytWigdetFadeOut",!0),y(Oe,"addModuleClasses",()=>{const e=S(),t=v.get(e.otherModulesList.tag)||"",n=t.split(",");g.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),y(Oe,"checkTaskbarLock",()=>{var a,s,i;const e=D.isModuleOn("foundry-taskbar");g.log("checkTaskbarLock #1",[e]);const t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");g.log("checkTaskbarLock #2",[t,n]),(s=t.taskbarSettings)!=null&&s.locked?D.addCSSVars("--crlngn-margin-bottom",n?"50px":"0px"):D.addCSSVars("--crlngn-margin-bottom",n?"10px":"0px"),(i=t.taskbarSettings)!=null&&i.locked?D.addCSSVars("--crlngn-taskbar-height","50px"):D.addCSSVars("--crlngn-taskbar-height","10px"),D.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML="")});let Yt=Oe;const te=class te{static init(){Hooks.on(z.RENDER_PLAYERS_LIST,te.onRender),te.applyPlayersListSettings(),te.handleFadeOut(),g.log("PlayersList init")}static applyFadeOut(e){te.useFadeOut=e,te.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");te.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),g.log("PlayersList handle fade out",[te.useFadeOut])}static applyCustomStyle(e){te.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){if(S(),te.customStylesEnabled)t.classList.add("crlngn-ui");else{t.classList.remove("crlngn-ui");return}te.applyPlayersListSettings(),te.applyAvatars(),te.handleFadeOut(e,t,n)}static applyPlayersListSettings(){var t,n;const e=S();g.log("applyPlayersListSettings",[v.get(e.autoHidePlayerList.tag)]),v.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"):(n=document.querySelector("#players.crlngn-ui"))==null||n.classList.remove("minimized")}static applyAvatars(){const e=S();g.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];v.get(e.playerListAvatars.tag)&&te.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const i=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),r=game.users.get(s.id),c=((p=r.character)==null?void 0:p.img)||"";g.log("player",[r]);const d=document.createElement("img");d.src=c||r.avatar||"",d.alt="*",d.classList.add("crlngn-avatar"),i&&i.prepend(d)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(i=>{const r=i.querySelector("img.crlngn-avatar");r==null||r.remove()}),t==null||t.classList.remove("crlngn-avatars"))}};y(te,"useFadeOut",!0),y(te,"customStylesEnabled",!0),y(te,"playerListAvatars",!0);let Ge=te;var $,cn,rt,bo,St,lt,ct,dn,vo,un,ve,bt,Ye,Ce,Mn,An,Dn;const u=class u{static applyFadeOut(e){u.useFadeOut=e,g.log("applyFadeOut",[e]),u.handleSceneFadeOut()}static applyCustomStyle(e){u.sceneNavEnabled=e,g.log("applyCustomStyle - TopNavigation",[u.sceneNavEnabled,ui.nav])}static resetLocalVars(){A(u,$,document.querySelector("#scene-navigation")),A(u,St,document.querySelector("#scene-navigation-expand")),A(u,lt,document.querySelector("#ui-left")),A(u,cn,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;g.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),u.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),u.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):u.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleBackButton(e,t,n){if(game.scenes.size<2||(S(),g.log("handleBackButton",[e,t,n]),!u.useSceneBackButton))return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",h(u,Mn)),o.prepend(a)}static handleFolderList(e,t,n){S(),u.navFoldersEnabled&&ht.addFolderButtons(e,t,n)}static handleNavState(){S(),h(u,un)&&(A(u,un,!1),u.toggleNav(u.navStartCollapsed))}static toggleNav(e){clearTimeout(h(u,dn)),A(u,dn,setTimeout(()=>{u.resetLocalVars(),e===!0?(ui.nav.collapse(),u.isCollapsed=!0,g.log("toggleNav collapse",[ui.nav.collapse,e,u.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove())):e===!1&&(u.isCollapsed=!1,ui.nav.expand(),g.log("toggleNav expand",[e,u.navStartCollapsed]))},300))}static checkSceneNavCompat(){S(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=h(u,$))==null||e.addEventListener("mouseenter",n=>{if(g.log("TopNavigation mouseenter",[u.isCollapsed,u.showNavOnHover]),!u.isCollapsed||!u.showNavOnHover)return;n.stopPropagation(),clearTimeout(h(u,rt)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=h(u,$))==null||t.addEventListener("mouseleave",n=>{g.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!u.showNavOnHover)&&(n.stopPropagation(),A(u,rt,setTimeout(()=>{clearTimeout(h(u,rt)),A(u,rt,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=S();if(!h(u,$))return;const i=((o=h(u,$))==null?void 0:o.querySelectorAll("li.nav-item"))||[],r=0,c=e!==null?e:u.navPos||0,d=(a=h(u,$))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!d)return;const p=i[c],m=d.offsetWidth||0,E=parseInt(m)*c;g.log("setNavPosition",["position",c,E,h(u,$).scrollWidth]);const C=E-r;if(C>h(u,$).scrollWidth)return;u.navPos=c,v.set(s.sceneNavPos.tag,c),t?D.smoothScrollTo(h(u,$),C,"horizontal",n):h(u,$).scrollTo({left:C,behavior:"instant"})}catch(s){g.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}};$=new WeakMap,cn=new WeakMap,rt=new WeakMap,bo=new WeakMap,St=new WeakMap,lt=new WeakMap,ct=new WeakMap,dn=new WeakMap,vo=new WeakMap,un=new WeakMap,ve=new WeakMap,bt=new WeakMap,Ye=new WeakMap,Ce=new WeakMap,Mn=new WeakMap,An=new WeakMap,Dn=new WeakMap,T(u,$),T(u,cn),T(u,rt),T(u,bo),T(u,St),T(u,lt),y(u,"sceneFoldersTemplate"),y(u,"navButtonsTemplate"),T(u,ct),T(u,dn),T(u,vo),T(u,un,!0),T(u,ve,null),T(u,bt,null),T(u,Ye,""),T(u,Ce,[]),y(u,"useFadeOut",!0),y(u,"sceneNavEnabled"),y(u,"navFoldersEnabled"),y(u,"navFoldersForPlayers"),y(u,"navShowRootFolders"),y(u,"navStartCollapsed"),y(u,"showNavOnHover"),y(u,"useSceneIcons"),y(u,"useScenePreview"),y(u,"useSceneBackButton"),y(u,"sceneClickToView"),y(u,"isCollapsed"),y(u,"navPos"),y(u,"init",()=>{const e=S();u.navStartCollapsed=v.get(e.navStartCollapsed.tag),u.showNavOnHover=v.get(e.showNavOnHover.tag),u.sceneNavEnabled=v.get(e.sceneNavEnabled.tag),u.useScenePreview=v.get(e.useScenePreview.tag),u.navFoldersEnabled=v.get(e.navFoldersEnabled.tag),u.navFoldersForPlayers=v.get(e.navFoldersForPlayers.tag),u.isCollapsed=u.navStartCollapsed,g.log("SCENE NAV INIT",[u.sceneNavEnabled]);const t=document.querySelector("body");if(u.sceneNavEnabled)t.classList.add("crlngn-scene-nav");else{t.classList.remove("crlngn-scene-nav");return}u.checkSceneNavCompat(),u.preloadTemplates(),ht.init(),Hooks.on(z.READY,()=>{u.handleSceneFadeOut(),D.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42)}),Hooks.on(z.RENDER_SCENE_NAV,u.onRender),Hooks.on(z.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(z.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==h(u,Ce)[h(u,Ce).length-1]&&h(u,Ce).push(n),u.handleSceneFadeOut()}),Hooks.on(z.COLLAPSE_SIDE_BAR,n=>{g.log(z.COLLAPSE_SIDE_BAR,[n]),n&&u.checkSideBar(n.expanded),u.placeNavButtons()}),Hooks.on(z.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(h(u,ct)),u.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(s=>s.remove()),A(u,ct,setTimeout(()=>{u.setCollapsedClass(o)},250))}),Hooks.on(z.RENDER_SCENE_DIRECTORY,n=>{g.log(z.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var r,c;const i=game.scenes.get(s.dataset.entryId);if(g.log(z.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,u.sceneClickToView]),u.sceneClickToView&&(s.addEventListener("dblclick",u.onActivateScene),s.addEventListener("click",u.onSelectScene)),u.useSceneIcons&&i&&((r=game.user)!=null&&r.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),i.ownership.default!==0?(i.active&&(d.classList.add("fa-bullseye"),s.prepend(d)),((c=game.scenes.current)==null?void 0:c.id)===i.id&&(d.classList.add("fa-star"),s.prepend(d))):(d.classList.add("fa-eye-slash"),s.prepend(d))}})}),ui.sidebar&&u.checkSideBar(ui.sidebar.expanded),u.placeNavButtons()}),y(u,"onRender",(e,t,n)=>{const o=S(),a=v.get(o.sceneNavPos.tag);g.log(z.RENDER_SCENE_NAV,[t]),u.resetLocalVars(),u.handleSceneFadeOut(e,t,n),u.sceneNavEnabled&&(u.handleBackButton(e,t,n),u.handleSceneList(e,t,n),u.handleFolderList(e,t,n),u.setNavPosition(a,!1),u.handleNavState()),u.addSceneListeners(t),u.addListeners(),u.resetLocalVars(),u.sceneNavEnabled&&u.navShowRootFolders&&(ht.init(),ht.renderFolderList()),u.sceneNavEnabled&&(clearTimeout(h(u,ct)),A(u,ct,setTimeout(()=>{g.log("NAV no transition remove"),u.placeNavButtons()},500)))}),y(u,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(h(u,lt).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),D.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(h(u,lt).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),u.placeNavButtons(),D.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),y(u,"checkSideBar",e=>{u.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),y(u,"handleSceneList",async(e,t,n)=>{var o,a;if(u.sceneNavEnabled){g.log("handleSceneList",[e,t,n]);const s=t.querySelectorAll(".scene-navigation-menu li.scene");for(const i of s){const r=i.dataset.sceneId;if(u.useScenePreview){const c=game.scenes.find(p=>p.id===r);c.isGM=(o=game.user)==null?void 0:o.isGM;const d=await renderTemplate(`modules/${x}/templates/scene-nav-preview.hbs`,c);if(g.log("sceneData",[c]),i.classList.add("nav-item"),i.insertAdjacentHTML("beforeend",d),c.isGM&&h(u,Ye)===r){const p=new MouseEvent("mouseenter");i.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&u.addPreviewIconListeners(i,c)}u.useSceneIcons&&(i.classList.contains("active")||i.classList.contains("view"))&&i.classList.add("crlngn")}}if(u.sceneNavEnabled&&game.scenes.size>1){const s=t.querySelector("#scene-navigation-expand"),i=document.querySelector("#ui-left-column-2"),r=document.querySelector("#crlngn-scene-navigation-expand");r&&r.remove();let c=s==null?void 0:s.cloneNode(!0);c&&(c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{s.click()})),g.log("toggle events",[e,c]),i.prepend(c)}}),T(u,Mn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=h(u,Ce).length,n=h(u,Ce)[t-2];let o;g.log("#onBackButton before",[t,n,h(u,Ce)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),h(u,Ce).pop()),g.log("#onBackButton after",[h(u,Ce)])}),y(u,"placeNavButtons",async()=>{var r;const e=document.querySelector("#scene-navigation");e.querySelector("#scene-navigation-inactive");const t=document.querySelectorAll("#ui-left .crlngn-btn");if(!e)return;const n=((r=h(u,St))==null?void 0:r.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(g.log("placeNavButtons *",[u.isCollapsed,o,t]),t.forEach(c=>c.remove()),!o||u.isCollapsed||h(u,lt).classList.contains("navigation-collapsed"))return;const a=await renderTemplate(`modules/${x}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=e.parentNode.querySelector("button.crlngn-btn.ui-nav-left"),i=e.parentNode.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",h(u,An)),i&&i.addEventListener("click",h(u,Dn))}),T(u,An,async e=>{const t=await u.getItemsPerPage(),n=u.navPos||0;if(!h(u,cn)||!h(u,$))return;let o=n-(t-1);g.log("onNavLast",["pos",o,h(u,$).scrollWidth]),o=o<0?0:o,u.setNavPosition(o)}),T(u,Dn,async e=>{var c,d;const t=await u.getItemsPerPage(),n=u.navPos||0,o=(c=h(u,$))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((d=h(u,$))==null?void 0:d.scrollWidth)||0;if(!a||!h(u,$))return;let i=n+(t-1),r=i*a;g.log("onNavNext",["pos",n,i,o==null?void 0:o.offsetWidth,r,s]),r>=s&&(i=Math.floor(s/a)),u.setNavPosition(i)}),y(u,"getItemsPerPage",async()=>{var e,t;try{g.log("getItemsPerPage",["Starting"]),u.resetLocalVars();const n=0,o=0,a=((e=h(u,St))==null?void 0:e.offsetWidth)||0,s=(t=h(u,$))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!h(u,$))return g.log("getItemsPerPage",["No scene items found"]),0;const i=s.offsetWidth,r=h(u,$).offsetWidth;if(!r)return g.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((r-a*2)/i);return g.log("getItemsPerPage",["Calculated:",c,r,i]),c||0}catch(n){return g.log("getItemsPerPage",["Error:",n]),g.error("Error in getItemsPerPage:",n),0}}),y(u,"preloadTemplates",async()=>{try{const e=[`modules/${x}/templates/scene-nav-buttons.hbs`,`modules/${x}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),y(u,"getCurrScenePosition",async e=>{try{if(!h(u,$)||!e)return 0;const t=await u.getItemsPerPage()||1,n=h(u,$).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(r=>r.dataset.sceneId===e);if(a===-1)return 0;const s=a>=u.navPos&&a<=u.navPos+t,i=s?u.navPos:a;return g.log("getCurrScenePosition",["Final position:",i,"isVisible:",s]),i}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),y(u,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);g.log("onActivateScene",[o,a]),a.activate(),h(u,ve)&&(clearTimeout(h(u,ve)),A(u,ve,null))}),y(u,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(A(u,Ye,""),g.log("onSelectScene",[a,t,n]),a&&a.sheet){const s=a.sheet.render;g.log("onSelectScene - originalRender",[s]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=s},250)}h(u,ve)&&(clearTimeout(h(u,ve)),A(u,ve,null)),A(u,ve,setTimeout(()=>{a.view(),A(u,ve,null)},250))}),y(u,"onScenePreviewOn",e=>{if(e.stopPropagation(),e.preventDefault(),!u.showNavOnHover)return;const t=e.currentTarget,n=t.dataset;A(u,Ye,n.sceneId),A(u,bt,setTimeout(()=>{clearTimeout(h(u,bt)),t.querySelector(".scene-preview").classList.add("open")},200)),g.log("onScenePreviewOn",[h(u,Ye)])}),y(u,"onScenePreviewOff",e=>{if(e.stopPropagation(),e.preventDefault(),clearTimeout(h(u,bt)),!u.showNavOnHover)return;const t=e.currentTarget;A(u,Ye,""),g.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),y(u,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",u.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",u.onActivateScene),u.useScenePreview&&(n.addEventListener("mouseenter",u.onScenePreviewOn),n.addEventListener("mouseleave",u.onScenePreviewOff))})}),y(u,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!d}),g.log("Toggled global illumination",[!d])});const s=o.querySelector(".token-vision");s&&s.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.tokenVision;await n.update({tokenVision:!d}),g.log("Toggled token vision",[!d])});const i=o.querySelector(".sound");i&&n.playlistSound&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.playlistSound;if(d){const p=d.sound.playing;p?await d.sound.pause():await d.sound.play(),ui.nav.render(),g.log("Toggled playlist sound",[!p])}});const r=o.querySelector(".config");r&&r.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),g.log("Opened scene configuration")})});let B=u;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Fo(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable})),t.push.apply(t,n)}return t}function Ae(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fo(Object(t),!0).forEach(function(n){Za(l,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Fo(Object(t)).forEach(function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(t,n))})}return l}function vn(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vn=function(e){return typeof e}:vn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(l)}function Za(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function xe(){return xe=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l},xe.apply(this,arguments)}function Qa(l,e){if(l==null)return{};var t={},n=Object.keys(l),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=l[o]);return t}function _a(l,e){if(l==null)return{};var t=Qa(l,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(l,n)&&(t[n]=l[n])}return t}var es="1.15.6";function ze(l){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(l)}var qe=ze(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),gn=ze(/Edge/i),Go=ze(/firefox/i),xt=ze(/safari/i)&&!ze(/chrome/i)&&!ze(/android/i),Co=ze(/iP(ad|od|hone)/i),fa=ze(/chrome/i)&&ze(/android/i),pa={capture:!1,passive:!1};function G(l,e,t){l.addEventListener(e,t,!qe&&pa)}function P(l,e,t){l.removeEventListener(e,t,!qe&&pa)}function Tn(l,e){if(e){if(e[0]===">"&&(e=e.substring(1)),l)try{if(l.matches)return l.matches(e);if(l.msMatchesSelector)return l.msMatchesSelector(e);if(l.webkitMatchesSelector)return l.webkitMatchesSelector(e)}catch{return!1}return!1}}function ha(l){return l.host&&l!==document&&l.host.nodeType?l.host:l.parentNode}function Ee(l,e,t,n){if(l){t=t||document;do{if(e!=null&&(e[0]===">"?l.parentNode===t&&Tn(l,e):Tn(l,e))||n&&l===t)return l;if(l===t)break}while(l=ha(l))}return null}var zo=/\s+/g;function fe(l,e,t){if(l&&e)if(l.classList)l.classList[t?"add":"remove"](e);else{var n=(" "+l.className+" ").replace(zo," ").replace(" "+e+" "," ");l.className=(n+(t?" "+e:"")).replace(zo," ")}}function R(l,e,t){var n=l&&l.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(t=l.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function mt(l,e){var t="";if(typeof l=="string")t=l;else do{var n=R(l,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(l=l.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function ma(l,e,t){if(l){var n=l.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Me(){var l=document.scrollingElement;return l||document.documentElement}function K(l,e,t,n,o){if(!(!l.getBoundingClientRect&&l!==window)){var a,s,i,r,c,d,p;if(l!==window&&l.parentNode&&l!==Me()?(a=l.getBoundingClientRect(),s=a.top,i=a.left,r=a.bottom,c=a.right,d=a.height,p=a.width):(s=0,i=0,r=window.innerHeight,c=window.innerWidth,d=window.innerHeight,p=window.innerWidth),(e||t)&&l!==window&&(o=o||l.parentNode,!qe))do if(o&&o.getBoundingClientRect&&(R(o,"transform")!=="none"||t&&R(o,"position")!=="static")){var m=o.getBoundingClientRect();s-=m.top+parseInt(R(o,"border-top-width")),i-=m.left+parseInt(R(o,"border-left-width")),r=s+a.height,c=i+a.width;break}while(o=o.parentNode);if(n&&l!==window){var E=mt(o||l),C=E&&E.a,I=E&&E.d;E&&(s/=I,i/=C,p/=C,d/=I,r=s+d,c=i+p)}return{top:s,left:i,bottom:r,right:c,width:p,height:d}}}function xo(l,e,t){for(var n=Je(l,!0),o=K(l)[e];n;){var a=K(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Me())break;n=Je(n,!1)}return!1}function Et(l,e,t,n){for(var o=0,a=0,s=l.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==k.ghost&&(n||s[a]!==k.dragged)&&Ee(s[a],t.draggable,l,!1)){if(o===e)return s[a];o++}a++}return null}function Eo(l,e){for(var t=l.lastElementChild;t&&(t===k.ghost||R(t,"display")==="none"||e&&!Tn(t,e));)t=t.previousElementSibling;return t||null}function ye(l,e){var t=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)l.nodeName.toUpperCase()!=="TEMPLATE"&&l!==k.clone&&(!e||Tn(l,e))&&t++;return t}function qo(l){var e=0,t=0,n=Me();if(l)do{var o=mt(l),a=o.a,s=o.d;e+=l.scrollLeft*a,t+=l.scrollTop*s}while(l!==n&&(l=l.parentNode));return[e,t]}function ts(l,e){for(var t in l)if(l.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===l[t][n])return Number(t)}return-1}function Je(l,e){if(!l||!l.getBoundingClientRect)return Me();var t=l,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=R(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Me();if(n||e)return t;n=!0}}while(t=t.parentNode);return Me()}function ns(l,e){if(l&&e)for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}function Un(l,e){return Math.round(l.top)===Math.round(e.top)&&Math.round(l.left)===Math.round(e.left)&&Math.round(l.height)===Math.round(e.height)&&Math.round(l.width)===Math.round(e.width)}var qt;function ya(l,e){return function(){if(!qt){var t=arguments,n=this;t.length===1?l.call(n,t[0]):l.apply(n,t),qt=setTimeout(function(){qt=void 0},e)}}}function os(){clearTimeout(qt),qt=void 0}function Sa(l,e,t){l.scrollLeft+=e,l.scrollTop+=t}function ba(l){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(l).cloneNode(!0):t?t(l).clone(!0)[0]:l.cloneNode(!0)}function va(l,e,t){var n={};return Array.from(l.children).forEach(function(o){var a,s,i,r;if(!(!Ee(o,e.draggable,l,!1)||o.animated||o===t)){var c=K(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((i=n.right)!==null&&i!==void 0?i:-1/0,c.right),n.bottom=Math.max((r=n.bottom)!==null&&r!==void 0?r:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var de="Sortable"+new Date().getTime();function as(){var l=[],e;return{captureAnimationState:function(){if(l=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(R(o,"display")==="none"||o===k.ghost)){l.push({target:o,rect:K(o)});var a=Ae({},l[l.length-1].rect);if(o.thisAnimationDuration){var s=mt(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){l.push(n)},removeAnimationState:function(n){l.splice(ts(l,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;l.forEach(function(i){var r=0,c=i.target,d=c.fromRect,p=K(c),m=c.prevFromRect,E=c.prevToRect,C=i.rect,I=mt(c,!0);I&&(p.top-=I.f,p.left-=I.e),c.toRect=p,c.thisAnimationDuration&&Un(m,p)&&!Un(d,p)&&(C.top-p.top)/(C.left-p.left)===(d.top-p.top)/(d.left-p.left)&&(r=is(C,m,E,o.options)),Un(p,d)||(c.prevFromRect=d,c.prevToRect=p,r||(r=o.options.animation),o.animate(c,C,p,r)),r&&(a=!0,s=Math.max(s,r),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},r),c.thisAnimationDuration=r)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),l=[]},animate:function(n,o,a,s){if(s){R(n,"transition",""),R(n,"transform","");var i=mt(this.el),r=i&&i.a,c=i&&i.d,d=(o.left-a.left)/(r||1),p=(o.top-a.top)/(c||1);n.animatingX=!!d,n.animatingY=!!p,R(n,"transform","translate3d("+d+"px,"+p+"px,0)"),this.forRepaintDummy=ss(n),R(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),R(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){R(n,"transition",""),R(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function ss(l){return l.offsetWidth}function is(l,e,t,n){return Math.sqrt(Math.pow(e.top-l.top,2)+Math.pow(e.left-l.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var ut=[],Bn={initializeByDefault:!0},fn={mount:function(e){for(var t in Bn)Bn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Bn[t]);ut.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ut.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";ut.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Ae({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Ae({sortable:t},n)))})},initializePlugins:function(e,t,n,o){ut.forEach(function(i){var r=i.pluginName;if(!(!e.options[r]&&!i.initializeByDefault)){var c=new i(e,t,e.options);c.sortable=e,c.options=e.options,e[r]=c,xe(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return ut.forEach(function(o){typeof o.eventProperties=="function"&&xe(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return ut.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function rs(l){var e=l.sortable,t=l.rootEl,n=l.name,o=l.targetEl,a=l.cloneEl,s=l.toEl,i=l.fromEl,r=l.oldIndex,c=l.newIndex,d=l.oldDraggableIndex,p=l.newDraggableIndex,m=l.originalEvent,E=l.putSortable,C=l.extraEventProperties;if(e=e||t&&t[de],!!e){var I,q=e.options,V="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!qe&&!gn?I=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(I=document.createEvent("Event"),I.initEvent(n,!0,!0)),I.to=s||t,I.from=i||t,I.item=o||t,I.clone=a,I.oldIndex=r,I.newIndex=c,I.oldDraggableIndex=d,I.newDraggableIndex=p,I.originalEvent=m,I.pullMode=E?E.lastPutMode:void 0;var Z=Ae(Ae({},C),fn.getEventProperties(n,e));for(var Se in Z)I[Se]=Z[Se];t&&t.dispatchEvent(I),q[V]&&q[V].call(e,I)}}var ls=["evt"],re=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=_a(n,ls);fn.pluginEvent.bind(k)(e,t,Ae({dragEl:b,parentEl:Y,ghostEl:M,rootEl:j,nextEl:ot,lastDownEl:Cn,cloneEl:W,cloneHidden:je,dragStarted:Ft,putSortable:ne,activeSortable:k.active,originalEvent:o,oldIndex:pt,oldDraggableIndex:Ut,newIndex:pe,newDraggableIndex:He,hideGhostForTarget:Na,unhideGhostForTarget:Ta,cloneNowHidden:function(){je=!0},cloneNowShown:function(){je=!1},dispatchSortableEvent:function(i){ie({sortable:t,name:i,originalEvent:o})}},a))};function ie(l){rs(Ae({putSortable:ne,cloneEl:W,targetEl:b,rootEl:j,oldIndex:pt,oldDraggableIndex:Ut,newIndex:pe,newDraggableIndex:He},l))}var b,Y,M,j,ot,Cn,W,je,pt,pe,Ut,He,mn,ne,ft=!1,wn=!1,In=[],tt,be,Hn,Vn,Uo,Bo,Ft,gt,Bt,Ht=!1,yn=!1,En,ae,jn=[],no=!1,Rn=[],zn=typeof document<"u",Sn=Co,Ho=gn||qe?"cssFloat":"float",cs=zn&&!fa&&!Co&&"draggable"in document.createElement("div"),Ca=function(){if(zn){if(qe)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto",l.style.pointerEvents==="auto"}}(),Ea=function(e,t){var n=R(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=Et(e,0,t),s=Et(e,1,t),i=a&&R(a),r=s&&R(s),c=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+K(a).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+K(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&i.float&&i.float!=="none"){var p=i.float==="left"?"left":"right";return s&&(r.clear==="both"||r.clear===p)?"vertical":"horizontal"}return a&&(i.display==="block"||i.display==="flex"||i.display==="table"||i.display==="grid"||c>=o&&n[Ho]==="none"||s&&n[Ho]==="none"&&c+d>o)?"vertical":"horizontal"},ds=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,i=n?t.left:t.top,r=n?t.right:t.bottom,c=n?t.width:t.height;return o===i||a===r||o+s/2===i+c/2},us=function(e,t){var n;return In.some(function(o){var a=o[de].options.emptyInsertThreshold;if(!(!a||Eo(o))){var s=K(o),i=e>=s.left-a&&e<=s.right+a,r=t>=s.top-a&&t<=s.bottom+a;if(i&&r)return n=o}}),n},La=function(e){function t(a,s){return function(i,r,c,d){var p=i.options.group.name&&r.options.group.name&&i.options.group.name===r.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(i,r,c,d),s)(i,r,c,d);var m=(s?i:r).options.group.name;return a===!0||typeof a=="string"&&a===m||a.join&&a.indexOf(m)>-1}}var n={},o=e.group;(!o||vn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Na=function(){!Ca&&M&&R(M,"display","none")},Ta=function(){!Ca&&M&&R(M,"display","")};zn&&!fa&&document.addEventListener("click",function(l){if(wn)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),wn=!1,!1},!0);var nt=function(e){if(b){e=e.touches?e.touches[0]:e;var t=us(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[de]._onDragOver(n)}}},gs=function(e){b&&b.parentNode[de]._isOutsideThisEl(e.target)};function k(l,e){if(!(l&&l.nodeType&&l.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l,this.options=e=xe({},e),l[de]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ea(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,i){s.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!xt||Co),emptyInsertThreshold:5};fn.initializePlugins(this,l,t);for(var n in t)!(n in e)&&(e[n]=t[n]);La(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:cs,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?G(l,"pointerdown",this._onTapStart):(G(l,"mousedown",this._onTapStart),G(l,"touchstart",this._onTapStart)),this.nativeDraggable&&(G(l,"dragover",this),G(l,"dragenter",this)),In.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),xe(this,as())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(gt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,b):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,i=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,r=(i||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=o.filter;if(vs(n),!b&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&xt&&r&&r.tagName.toUpperCase()==="SELECT")&&(r=Ee(r,o.draggable,n,!1),!(r&&r.animated)&&Cn!==r)){if(pt=ye(r),Ut=ye(r,o.draggable),typeof d=="function"){if(d.call(this,e,r,this)){ie({sortable:t,rootEl:c,name:"filter",targetEl:r,toEl:n,fromEl:n}),re("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(p){if(p=Ee(c,p.trim(),n,!1),p)return ie({sortable:t,rootEl:p,name:"filter",targetEl:r,fromEl:n,toEl:n}),re("filter",t,{evt:e}),!0}),d)){a&&e.preventDefault();return}o.handle&&!Ee(c,o.handle,n,!1)||this._prepareDragStart(e,i,r)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,i=a.ownerDocument,r;if(n&&!b&&n.parentNode===a){var c=K(n);if(j=a,b=n,Y=b.parentNode,ot=b.nextSibling,Cn=n,mn=s.group,k.dragged=b,tt={target:b,clientX:(t||e).clientX,clientY:(t||e).clientY},Uo=tt.clientX-c.left,Bo=tt.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,b.style["will-change"]="all",r=function(){if(re("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Go&&o.nativeDraggable&&(b.draggable=!0),o._triggerDragStart(e,t),ie({sortable:o,name:"choose",originalEvent:e}),fe(b,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){ma(b,d.trim(),Wn)}),G(i,"dragover",nt),G(i,"mousemove",nt),G(i,"touchmove",nt),s.supportPointer?(G(i,"pointerup",o._onDrop),!this.nativeDraggable&&G(i,"pointercancel",o._onDrop)):(G(i,"mouseup",o._onDrop),G(i,"touchend",o._onDrop),G(i,"touchcancel",o._onDrop)),Go&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),re("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(gn||qe))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(G(i,"pointerup",o._disableDelayedDrag),G(i,"pointercancel",o._disableDelayedDrag)):(G(i,"mouseup",o._disableDelayedDrag),G(i,"touchend",o._disableDelayedDrag),G(i,"touchcancel",o._disableDelayedDrag)),G(i,"mousemove",o._delayedDragTouchMoveHandler),G(i,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&G(i,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(r,s.delay)}else r()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){b&&Wn(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._disableDelayedDrag),P(e,"touchend",this._disableDelayedDrag),P(e,"touchcancel",this._disableDelayedDrag),P(e,"pointerup",this._disableDelayedDrag),P(e,"pointercancel",this._disableDelayedDrag),P(e,"mousemove",this._delayedDragTouchMoveHandler),P(e,"touchmove",this._delayedDragTouchMoveHandler),P(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?G(document,"pointermove",this._onTouchMove):t?G(document,"touchmove",this._onTouchMove):G(document,"mousemove",this._onTouchMove):(G(b,"dragend",this),G(j,"dragstart",this._onDragStart));try{document.selection?Ln(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(ft=!1,j&&b){re("dragStarted",this,{evt:t}),this.nativeDraggable&&G(document,"dragover",gs);var n=this.options;!e&&fe(b,n.dragClass,!1),fe(b,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),ie({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(be){this._lastX=be.clientX,this._lastY=be.clientY,Na();for(var e=document.elementFromPoint(be.clientX,be.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(be.clientX,be.clientY),e!==t);)t=e;if(b.parentNode[de]._isOutsideThisEl(e),t)do{if(t[de]){var n=void 0;if(n=t[de]._onDragOver({clientX:be.clientX,clientY:be.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=ha(t));Ta()}},_onTouchMove:function(e){if(tt){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=M&&mt(M,!0),i=M&&s&&s.a,r=M&&s&&s.d,c=Sn&&ae&&qo(ae),d=(a.clientX-tt.clientX+o.x)/(i||1)+(c?c[0]-jn[0]:0)/(i||1),p=(a.clientY-tt.clientY+o.y)/(r||1)+(c?c[1]-jn[1]:0)/(r||1);if(!k.active&&!ft){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(M){s?(s.e+=d-(Hn||0),s.f+=p-(Vn||0)):s={a:1,b:0,c:0,d:1,e:d,f:p};var m="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");R(M,"webkitTransform",m),R(M,"mozTransform",m),R(M,"msTransform",m),R(M,"transform",m),Hn=d,Vn=p,be=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!M){var e=this.options.fallbackOnBody?document.body:j,t=K(b,!0,Sn,!0,e),n=this.options;if(Sn){for(ae=e;R(ae,"position")==="static"&&R(ae,"transform")==="none"&&ae!==document;)ae=ae.parentNode;ae!==document.body&&ae!==document.documentElement?(ae===document&&(ae=Me()),t.top+=ae.scrollTop,t.left+=ae.scrollLeft):ae=Me(),jn=qo(ae)}M=b.cloneNode(!0),fe(M,n.ghostClass,!1),fe(M,n.fallbackClass,!0),fe(M,n.dragClass,!0),R(M,"transition",""),R(M,"transform",""),R(M,"box-sizing","border-box"),R(M,"margin",0),R(M,"top",t.top),R(M,"left",t.left),R(M,"width",t.width),R(M,"height",t.height),R(M,"opacity","0.8"),R(M,"position",Sn?"absolute":"fixed"),R(M,"zIndex","100000"),R(M,"pointerEvents","none"),k.ghost=M,e.appendChild(M),R(M,"transform-origin",Uo/parseInt(M.style.width)*100+"% "+Bo/parseInt(M.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(re("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}re("setupClone",this),k.eventCanceled||(W=ba(b),W.removeAttribute("id"),W.draggable=!1,W.style["will-change"]="",this._hideClone(),fe(W,this.options.chosenClass,!1),k.clone=W),n.cloneId=Ln(function(){re("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||j.insertBefore(W,b),n._hideClone(),ie({sortable:n,name:"clone"}))}),!t&&fe(b,a.dragClass,!0),t?(wn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(P(document,"mouseup",n._onDrop),P(document,"touchend",n._onDrop),P(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,b)),G(document,"drop",n),R(b,"transform","translateZ(0)")),ft=!0,n._dragStartId=Ln(n._dragStarted.bind(n,t,e)),G(document,"selectstart",n),Ft=!0,window.getSelection().removeAllRanges(),xt&&R(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,i=this.options,r=i.group,c=k.active,d=mn===r,p=i.sort,m=ne||c,E,C=this,I=!1;if(no)return;function q(Dt,Ra){re(Dt,C,Ae({evt:e,isOwner:d,axis:E?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:m,target:n,completed:Z,onMove:function(To,ka){return bn(j,t,b,o,To,K(To),e,ka)},changed:Se},Ra))}function V(){q("dragOverAnimationCapture"),C.captureAnimationState(),C!==m&&m.captureAnimationState()}function Z(Dt){return q("dragOverCompleted",{insertion:Dt}),Dt&&(d?c._hideClone():c._showClone(C),C!==m&&(fe(b,ne?ne.options.ghostClass:c.options.ghostClass,!1),fe(b,i.ghostClass,!0)),ne!==C&&C!==k.active?ne=C:C===k.active&&ne&&(ne=null),m===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){q("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(n===b&&!b.animated||n===t&&!n.animated)&&(gt=null),!i.dragoverBubble&&!e.rootEl&&n!==document&&(b.parentNode[de]._isOutsideThisEl(e.target),!Dt&&nt(e)),!i.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),I=!0}function Se(){pe=ye(b),He=ye(b,i.draggable),ie({sortable:C,name:"change",toEl:t,newIndex:pe,newDraggableIndex:He,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Ee(n,i.draggable,t,!0),q("dragOver"),k.eventCanceled)return I;if(b.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return Z(!1);if(wn=!1,c&&!i.disabled&&(d?p||(s=Y!==j):ne===this||(this.lastPutMode=mn.checkPull(this,c,b,e))&&r.checkPut(this,c,b,e))){if(E=this._getDirection(e,n)==="vertical",o=K(b),q("dragOverValid"),k.eventCanceled)return I;if(s)return Y=j,V(),this._hideClone(),q("revert"),k.eventCanceled||(ot?j.insertBefore(b,ot):j.appendChild(b)),Z(!0);var ue=Eo(t,i.draggable);if(!ue||ms(e,E,this)&&!ue.animated){if(ue===b)return Z(!1);if(ue&&t===e.target&&(n=ue),n&&(a=K(n)),bn(j,t,b,o,n,a,e,!!n)!==!1)return V(),ue&&ue.nextSibling?t.insertBefore(b,ue.nextSibling):t.appendChild(b),Y=t,Se(),Z(!0)}else if(ue&&hs(e,E,this)){var Qe=Et(t,0,i,!0);if(Qe===b)return Z(!1);if(n=Qe,a=K(n),bn(j,t,b,o,n,a,e,!1)!==!1)return V(),t.insertBefore(b,Qe),Y=t,Se(),Z(!0)}else if(n.parentNode===t){a=K(n);var Le=0,_e,kt=b.parentNode!==t,ge=!ds(b.animated&&b.toRect||o,n.animated&&n.toRect||a,E),Ot=E?"top":"left",Ue=xo(n,"top","top")||xo(b,"top","top"),Mt=Ue?Ue.scrollTop:void 0;gt!==n&&(_e=a[Ot],Ht=!1,yn=!ge&&i.invertSwap||kt),Le=ys(e,n,a,E,ge?1:i.swapThreshold,i.invertedSwapThreshold==null?i.swapThreshold:i.invertedSwapThreshold,yn,gt===n);var De;if(Le!==0){var et=ye(b);do et-=Le,De=Y.children[et];while(De&&(R(De,"display")==="none"||De===M))}if(Le===0||De===n)return Z(!1);gt=n,Bt=Le;var At=n.nextElementSibling,Be=!1;Be=Le===1;var pn=bn(j,t,b,o,n,a,e,Be);if(pn!==!1)return(pn===1||pn===-1)&&(Be=pn===1),no=!0,setTimeout(ps,30),V(),Be&&!At?t.appendChild(b):n.parentNode.insertBefore(b,Be?At:n),Ue&&Sa(Ue,0,Mt-Ue.scrollTop),Y=b.parentNode,_e!==void 0&&!yn&&(En=Math.abs(_e-K(n)[Ot])),Se(),Z(!0)}if(t.contains(b))return Z(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){P(document,"mousemove",this._onTouchMove),P(document,"touchmove",this._onTouchMove),P(document,"pointermove",this._onTouchMove),P(document,"dragover",nt),P(document,"mousemove",nt),P(document,"touchmove",nt)},_offUpEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._onDrop),P(e,"touchend",this._onDrop),P(e,"pointerup",this._onDrop),P(e,"pointercancel",this._onDrop),P(e,"touchcancel",this._onDrop),P(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(pe=ye(b),He=ye(b,n.draggable),re("drop",this,{evt:e}),Y=b&&b.parentNode,pe=ye(b),He=ye(b,n.draggable),k.eventCanceled){this._nulling();return}ft=!1,yn=!1,Ht=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),oo(this.cloneId),oo(this._dragStartId),this.nativeDraggable&&(P(document,"drop",this),P(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),xt&&R(document.body,"user-select",""),R(b,"transform",""),e&&(Ft&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),M&&M.parentNode&&M.parentNode.removeChild(M),(j===Y||ne&&ne.lastPutMode!=="clone")&&W&&W.parentNode&&W.parentNode.removeChild(W),b&&(this.nativeDraggable&&P(b,"dragend",this),Wn(b),b.style["will-change"]="",Ft&&!ft&&fe(b,ne?ne.options.ghostClass:this.options.ghostClass,!1),fe(b,this.options.chosenClass,!1),ie({sortable:this,name:"unchoose",toEl:Y,newIndex:null,newDraggableIndex:null,originalEvent:e}),j!==Y?(pe>=0&&(ie({rootEl:Y,name:"add",toEl:Y,fromEl:j,originalEvent:e}),ie({sortable:this,name:"remove",toEl:Y,originalEvent:e}),ie({rootEl:Y,name:"sort",toEl:Y,fromEl:j,originalEvent:e}),ie({sortable:this,name:"sort",toEl:Y,originalEvent:e})),ne&&ne.save()):pe!==pt&&pe>=0&&(ie({sortable:this,name:"update",toEl:Y,originalEvent:e}),ie({sortable:this,name:"sort",toEl:Y,originalEvent:e})),k.active&&((pe==null||pe===-1)&&(pe=pt,He=Ut),ie({sortable:this,name:"end",toEl:Y,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){re("nulling",this),j=b=Y=M=ot=W=Cn=je=tt=be=Ft=pe=He=pt=Ut=gt=Bt=ne=mn=k.dragged=k.ghost=k.clone=k.active=null,Rn.forEach(function(e){e.checked=!0}),Rn.length=Hn=Vn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":b&&(this._onDragOver(e),fs(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],Ee(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||bs(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var i=o.children[s];Ee(i,this.options.draggable,o,!1)&&(n[a]=i)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ee(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=fn.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&La(n)},destroy:function(){re("destroy",this);var e=this.el;e[de]=null,P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart),P(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),In.splice(In.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!je){if(re("hideClone",this),k.eventCanceled)return;R(W,"display","none"),this.options.removeCloneOnHide&&W.parentNode&&W.parentNode.removeChild(W),je=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(je){if(re("showClone",this),k.eventCanceled)return;b.parentNode==j&&!this.options.group.revertClone?j.insertBefore(W,b):ot?j.insertBefore(W,ot):j.appendChild(W),this.options.group.revertClone&&this.animate(b,W),R(W,"display",""),je=!1}}};function fs(l){l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault()}function bn(l,e,t,n,o,a,s,i){var r,c=l[de],d=c.options.onMove,p;return window.CustomEvent&&!qe&&!gn?r=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(r=document.createEvent("Event"),r.initEvent("move",!0,!0)),r.to=e,r.from=l,r.dragged=t,r.draggedRect=n,r.related=o||e,r.relatedRect=a||K(e),r.willInsertAfter=i,r.originalEvent=s,l.dispatchEvent(r),d&&(p=d.call(c,r,s)),p}function Wn(l){l.draggable=!1}function ps(){no=!1}function hs(l,e,t){var n=K(Et(t.el,0,t.options,!0)),o=va(t.el,t.options,M),a=10;return e?l.clientX<o.left-a||l.clientY<n.top&&l.clientX<n.right:l.clientY<o.top-a||l.clientY<n.bottom&&l.clientX<n.left}function ms(l,e,t){var n=K(Eo(t.el,t.options.draggable)),o=va(t.el,t.options,M),a=10;return e?l.clientX>o.right+a||l.clientY>n.bottom&&l.clientX>n.left:l.clientY>o.bottom+a||l.clientX>n.right&&l.clientY>n.top}function ys(l,e,t,n,o,a,s,i){var r=n?l.clientY:l.clientX,c=n?t.height:t.width,d=n?t.top:t.left,p=n?t.bottom:t.right,m=!1;if(!s){if(i&&En<c*o){if(!Ht&&(Bt===1?r>d+c*a/2:r<p-c*a/2)&&(Ht=!0),Ht)m=!0;else if(Bt===1?r<d+En:r>p-En)return-Bt}else if(r>d+c*(1-o)/2&&r<p-c*(1-o)/2)return Ss(e)}return m=m||s,m&&(r<d+c*a/2||r>p-c*a/2)?r>d+c/2?1:-1:0}function Ss(l){return ye(b)<ye(l)?1:-1}function bs(l){for(var e=l.tagName+l.className+l.src+l.href+l.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function vs(l){Rn.length=0;for(var e=l.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&Rn.push(n)}}function Ln(l){return setTimeout(l,0)}function oo(l){return clearTimeout(l)}zn&&G(document,"touchmove",function(l){(k.active||ft)&&l.cancelable&&l.preventDefault()});k.utils={on:G,off:P,css:R,find:ma,is:function(e,t){return!!Ee(e,t,e,!1)},extend:ns,throttle:ya,closest:Ee,toggleClass:fe,clone:ba,index:ye,nextTick:Ln,cancelNextTick:oo,detectDirection:Ea,getChild:Et,expando:de};k.get=function(l){return l[de]};k.mount=function(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Ae(Ae({},k.utils),n.utils)),fn.mount(n)})};k.create=function(l,e){return new k(l,e)};k.version=es;var X=[],Gt,ao,so=!1,$n,Yn,kn,zt;function Cs(){function l(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return l.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?G(document,"dragover",this._handleAutoScroll):this.options.supportPointer?G(document,"pointermove",this._handleFallbackAutoScroll):n.touches?G(document,"touchmove",this._handleFallbackAutoScroll):G(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):(P(document,"pointermove",this._handleFallbackAutoScroll),P(document,"touchmove",this._handleFallbackAutoScroll),P(document,"mousemove",this._handleFallbackAutoScroll)),Vo(),Nn(),os()},nulling:function(){kn=ao=Gt=so=zt=$n=Yn=null,X.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,i=document.elementFromPoint(a,s);if(kn=t,n||this.options.forceAutoScrollFallback||gn||qe||xt){Xn(t,this.options,i,n);var r=Je(i,!0);so&&(!zt||a!==$n||s!==Yn)&&(zt&&Vo(),zt=setInterval(function(){var c=Je(document.elementFromPoint(a,s),!0);c!==r&&(r=c,Nn()),Xn(t,o.options,c,n)},10),$n=a,Yn=s)}else{if(!this.options.bubbleScroll||Je(i,!0)===Me()){Nn();return}Xn(t,this.options,Je(i,!1),!1)}}},xe(l,{pluginName:"scroll",initializeByDefault:!0})}function Nn(){X.forEach(function(l){clearInterval(l.pid)}),X=[]}function Vo(){clearInterval(zt)}var Xn=ya(function(l,e,t,n){if(e.scroll){var o=(l.touches?l.touches[0]:l).clientX,a=(l.touches?l.touches[0]:l).clientY,s=e.scrollSensitivity,i=e.scrollSpeed,r=Me(),c=!1,d;ao!==t&&(ao=t,Nn(),Gt=e.scroll,d=e.scrollFn,Gt===!0&&(Gt=Je(t,!0)));var p=0,m=Gt;do{var E=m,C=K(E),I=C.top,q=C.bottom,V=C.left,Z=C.right,Se=C.width,ue=C.height,Qe=void 0,Le=void 0,_e=E.scrollWidth,kt=E.scrollHeight,ge=R(E),Ot=E.scrollLeft,Ue=E.scrollTop;E===r?(Qe=Se<_e&&(ge.overflowX==="auto"||ge.overflowX==="scroll"||ge.overflowX==="visible"),Le=ue<kt&&(ge.overflowY==="auto"||ge.overflowY==="scroll"||ge.overflowY==="visible")):(Qe=Se<_e&&(ge.overflowX==="auto"||ge.overflowX==="scroll"),Le=ue<kt&&(ge.overflowY==="auto"||ge.overflowY==="scroll"));var Mt=Qe&&(Math.abs(Z-o)<=s&&Ot+Se<_e)-(Math.abs(V-o)<=s&&!!Ot),De=Le&&(Math.abs(q-a)<=s&&Ue+ue<kt)-(Math.abs(I-a)<=s&&!!Ue);if(!X[p])for(var et=0;et<=p;et++)X[et]||(X[et]={});(X[p].vx!=Mt||X[p].vy!=De||X[p].el!==E)&&(X[p].el=E,X[p].vx=Mt,X[p].vy=De,clearInterval(X[p].pid),(Mt!=0||De!=0)&&(c=!0,X[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(kn);var At=X[this.layer].vy?X[this.layer].vy*i:0,Be=X[this.layer].vx?X[this.layer].vx*i:0;typeof d=="function"&&d.call(k.dragged.parentNode[de],Be,At,l,kn,X[this.layer].el)!=="continue"||Sa(X[this.layer].el,Be,At)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&m!==r&&(m=Je(m,!1)));so=c}},30),wa=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,i=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var c=n||a;i();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(d.clientX,d.clientY);r(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Lo(){}Lo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=Et(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:wa};xe(Lo,{pluginName:"revertOnSpill"});function No(){}No.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:wa};xe(No,{pluginName:"removeOnSpill"});k.mount(new Cs);k.mount(No,Lo);const Jn="root";var Xe,J,Pn,Fn,Ia;const w=class w{static init(){if(w.noFolderView()||!ui.scenes)return;w.preloadTemplates(),game.user.getFlag(x,"activeSceneFolders")||game.user.setFlag(x,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(z.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;U(a=w,Fn,Ia).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){if(!B.navFoldersEnabled||game.scenes.size<2||game.scenes.folders.size<1)return;const o=S(),a=document.querySelector("#crlngn-scene-lookup"),s=document.querySelector("#crlngn-folder-toggle");if(a||s)return;const i=t.querySelector("#scene-navigation-active"),r=i.querySelector("li.scene:first-of-type"),c=document.createElement("div"),d=document.createElement("div");c.id="crlngn-scene-lookup",c.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,d.dataset.tooltip=B.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",d.id="crlngn-folder-toggle",d.innerHTML="<i class='fa-solid icon'></i>",B.navShowRootFolders?i.classList.add("with-folders"):i.classList.remove("with-folders"),c.querySelector(".folder-expand").addEventListener("click",w.toggleFolderLookup),d.addEventListener("click",()=>{B.setNavPosition(0),v.set(o.navShowRootFolders.tag,!B.navShowRootFolders),B.placeNavButtons()}),i.insertBefore(c,r),i.append(d),w.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),A(w,Xe,game.scenes.sortingMode),g.log("buildFolderData A",[e.name,e]),e.id===Jn?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=w.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},g.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),h(w,Xe)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Xe=new WeakMap,J=new WeakMap,Pn=new WeakMap,Fn=new WeakSet,Ia=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){A(w,Xe,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}A(w,Xe,"a"),g.log("updateSortMode fallback",[h(w,Xe)])},T(w,Fn),y(w,"selectedFolder",Jn),T(w,Xe,"a"),T(w,J,[]),y(w,"searchValue",""),y(w,"renderFolderList",async e=>{A(w,J,game.user.getFlag(x,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:Jn},a=w.buildTemplateData(o),s=await renderTemplate(`modules/${x}/templates/scene-nav-folders.hbs`,a);g.log("renderFolderList",[o,h(w,J),s]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const i=t.querySelectorAll("li.folder");w.addFolderListeners(i),B.placeNavButtons()}),y(w,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${x}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",w.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),y(w,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",h(w,Pn));const o=n.dataset.folderId,a=t.get(o),s=h(w,J).includes(o);g.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),w.injectSubfolders(a,n))})}),T(w,Pn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await w.injectSubfolders(a,t.parentNode),B.addSceneListeners(t.parentNode),g.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?w.updateActiveFolders(n,!0):w.updateActiveFolders(n,!1)}),y(w,"injectSubfolders",async(e,t)=>{const n=w.buildTemplateData(e),o=await renderTemplate(`modules/${x}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");w.addFolderListeners(s),B.addSceneListeners(t.querySelector(".contents"))}),y(w,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-navigation-inactive"),o=n==null?void 0:n.querySelector(`li.folder[data-folder-id="${e}"]`),a=h(w,J).indexOf(e);g.log("updateActiveFolders A",[a,e,game.user.getFlag(x,"activeSceneFolders"),h(w,J)]),t?(A(w,J,h(w,J).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):h(w,J).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(i=>{i!==o&&(A(w,J,h(w,J).filter(r=>r!==i.dataset.folderId)),i.classList.remove("crlngn-folder-active"))}),h(w,J).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(x,"activeSceneFolders",h(w,J)),g.log("updateActiveFolders B",[t,e,game.user.getFlag(x,"activeSceneFolders"),h(w,J)])}),y(w,"selectFolder",e=>w.getFolderById(e)||null),y(w,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!B.navFoldersForPlayers||!B.navFoldersEnabled||!B.sceneNavEnabled}),y(w,"preloadTemplates",async()=>{const e=[`modules/${x}/templates/scene-nav-folders.hbs`,`modules/${x}/templates/scene-nav-subfolders.hbs`,`modules/${x}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),y(w,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;w.searchValue=n,w.updateSearchResults(n)}),y(w,"updateSearchResults",e=>{var a,s;if(w.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())&&i.permission>=2))||[];n.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase()));const o=((s=game.scenes)==null?void 0:s.folders.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(i=>{const r=document.createElement("li");r.className="search-folder",r.dataset.folderId=i.id,r.innerHTML=`<a><i class="fas fa-folder"></i> ${i.name}</a>`,r.addEventListener("click",w.onSelectSearchedFolder),t.appendChild(r)}),n.forEach(i=>{const r=document.createElement("li");r.className="search-scene",r.dataset.sceneId=i.id,r.innerHTML=`<a><i class="fas fa-map"></i> ${i.name}</a>`,r.addEventListener("dblclick",B.onActivateScene),r.addEventListener("click",B.onSelectScene),t.appendChild(r)}),o.length===0&&n.length===0){const i=document.createElement("li");i.className="no-results",i.textContent="No matching results found",t.appendChild(i)}}),y(w,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(B.navShowRootFolders||o.click(),!n)return;const i=[...ui.scenes.collection.folders.get(n).ancestors];A(w,J,[]);for(const r of i)h(w,J).push(r.id);h(w,J).push(n),await game.user.setFlag(x,"activeSceneFolders",h(w,J)),setTimeout(async()=>{ui.nav.render()},200)});let ht=w;const me=class me{static init(){Hooks.on(z.RENDER_SIDE_BAR,me.onRender)}static applyFadeOut(e){me.useFadeOut=e,me.handleFadeOut()}static applyCustomStyle(e){var t;me.customStylesEnabled=e,g.log("applyCustomStyle",[me.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){me.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs"),me.handleFadeOut(e,t,n)}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");me.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),g.log("SidebarTabs handle fade out",[me.useFadeOut])}};y(me,"useFadeOut",!0),y(me,"customStylesEnabled",!0);let Xt=me;var vt;const L=class L{static get(e,t=x){if(!e)return null;let n=!1;if(t===x)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,g.log("GET Setting",[a,n])}return n}static set(e,t,n=x){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),g.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{g.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s,i,r,c,d,p,m;const n=S();switch(t===void 0&&(t=L.get(e)),g.log("SettingsUtil.apply",[e,t,L.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:Fe.applyCustomStyle(t);break;case n.collapseMacroBar.tag:Fe.applyHotBarCollapse();break;case n.playerListAvatars.tag:Ge.applyAvatars();break;case n.autoHidePlayerList.tag:Ge.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:L.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:L.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:oe.currSettings.dockHeight=t,L.applyCameraHeight(t);break;case n.dockWidth.tag:oe.currSettings.dockWidth=t,L.applyCameraWidth(t);break;case n.dockPosX.tag:oe.currSettings.dockPosX=t,L.applyCameraPosX(t);break;case n.dockPosY.tag:oe.currSettings.dockPosY=t,L.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:oe.currSettings.defaultVideoWidth=t,oe.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:oe.currSettings.dockResizeOnUserJoin=t,oe.applyDockResize(t);break;case n.chatBorderColor.tag:dt.chatBorderColor=t,L.applyBorderColors();break;case n.useLeftChatBorder.tag:dt.useLeftChatBorder=t;case n.enableChatStyles.tag:dt.enableChatStyles=t,L.applyChatStyles();break;case n.debugMode.tag:L.applyDebugSettings();break;case n.navFoldersEnabled.tag:B.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:B.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:B.sceneClickToView=t,(a=ui.nav)==null||a.render(),(i=(s=game.scenes)==null?void 0:s.directory)==null||i.render();break;case n.useSceneIcons.tag:B.useSceneIcons=t,(r=ui.nav)==null||r.render(),(d=(c=game.scenes)==null?void 0:c.directory)==null||d.render();break;case n.useSceneBackButton.tag:B.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:B.useScenePreview=t,(m=ui.nav)==null||m.render();break;case n.navStartCollapsed.tag:B.navStartCollapsed=t;break;case n.showNavOnHover.tag:B.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:B.isCollapsed=L.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:L.applyThemeSettings();break;case n.customStyles.tag:L.applyCustomCSS();break;case n.adjustOtherModules.tag:L.applyModuleAdjustments(t);break;case n.otherModulesList.tag:L.applyOtherModulesList(t);break;case n.enablePlayerList.tag:Ge.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:B.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Fe.applyCustomStyle(t);break;case n.enableFloatingDock.tag:oe.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:Xt.applyCustomStyle(t);break;case n.enableChatLogControls.tag:Wt.applyCustomStyle(t);break;case n.enableSceneControls.tag:$t.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:$t.applyFadeOut(t);break;case n.playerListFadeOut.tag:Ge.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:Xt.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:oe.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Fe.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:Wt.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:B.applyFadeOut(t);break}}static applyBorderColors(){const e=S(),t=L.get(e.chatBorderColor.tag),n=document.querySelector("body");t===Ct.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===Ct.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=S(),t=L.get(e.enableChatStyles.tag),n=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const n=S();L.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:L.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=S(),t=L.get(e.controlsIconSize.tag);document.querySelector("body");const n=Pt[t]?Pt[t].size:Pt.regular.size;function o(a){switch(a){case Pt.large.name:return"var(--font-size-18);";case Pt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[n]),D.addCSSVars("--icon-font-size",o(t)),D.addCSSVars("--control-item-size",n),L.applyLeftControlsSettings()}static applySceneNavPos(e){const t=S();B.navPos=e||L.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=S(),n=L.get(t.dockPosX.tag),o=e||n;oe.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=S(),n=L.get(t.dockPosY.tag),o=e||n;oe.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=S(),n=L.get(t.dockWidth.tag),o=e||n;oe.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=S(),n=L.get(t.dockHeight.tag),o=e||n;oe.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=S(),o=n.customFontsMenu.fields,a={};switch(g.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=L.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:D.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:D.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:D.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:D.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=S();g.debugOn=e||L.get(t.debugMode.tag)}};vt=new WeakMap,T(L,vt,!1),y(L,"firstLoad",!0),y(L,"registerSettings",async()=>{const e=S(),t=Object.entries(e);g.log("registerSettings - test",[t],!0),t.forEach(async d=>{const p=d[1];if(g.log("Registering... ",[d],!0),p.showOnRoot&&p.isMenu||!p.isMenu){const m={name:p.label,hint:p.hint,default:p.default,type:p.propType,scope:p.scope,config:p.config,requiresReload:p.requiresReload||!1,onChange:E=>L.apply(p.tag,E)};(p.choices||p.options)&&(m.choices=p.choices||p.options),await game.settings.register(x,p.tag,m),L.get(p.tag)===void 0&&(g.log("resetting...",[p.tag]),L.set(p.tag,p.default))}}),game.keybindings.register(x,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{L.hideInterface()},restricted:!1}),L.applyThemeSettings(),L.applyCustomCSS(),L.applyModuleAdjustments();const o=Object.entries(to()).find(d=>d[0]==="moduleSettingsMenu");if(o){const d=o[1],p={name:d.tag,label:d.label,hint:d.hint,icon:d.icon,type:d.propType,restricted:d.restricted};await game.settings.registerMenu(x,d.tag,p)}Hooks.on(z.RENDER_SCENE_CONTROLS,L.applyLeftControlsSettings),Hooks.on(z.RENDER_PLAYERS_LIST,Ge.applyPlayersListSettings),Hooks.on(z.RENDER_HOTBAR,()=>{Fe.applyCustomStyle(),L.firstLoad&&(L.firstLoad=!1,Fe.applyHotBarCollapse())}),L.applyDebugSettings(),L.applyChatStyles(),L.applyBorderColors(),e.sceneNavMenu.fields.forEach(d=>{L.apply(e[d].tag)}),e.cameraDockMenu.fields.forEach(d=>{L.apply(e[d].tag)}),e.customFontsMenu.fields.forEach(d=>{L.applyCustomFonts(e[d].tag)}),e.leftControlsMenu.fields.forEach(d=>{L.applyLeftControlsSettings(e[d].tag)}),e.interfaceOptionsMenu.fields.forEach(d=>{g.log("TEST",[d,e]),L.apply(e[d].tag)})}),y(L,"applyThemeSettings",e=>{const t=S(),n=e||L.get(t.colorTheme.tag)||"",o=document.querySelector("body");g.log("applyThemeSettings",[e,n,L.get(t.colorTheme.tag)]),ce.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),y(L,"applyCustomCSS",e=>{const t=S(),n=e||L.get(t.customStyles.tag)||"";D.addCustomCSS(n)}),y(L,"applyModuleAdjustments",e=>{const t=S();(e||L.get(t.adjustOtherModules.tag)||!1)&&Yt.addModuleClasses()}),y(L,"applyOtherModulesList",e=>{const t=S(),n=e||L.get(t.otherModulesList.tag);g.log("applyOtherModulesList",[n]),n.split(",").length===0?(L.set(t.adjustOtherModules.tag,!1),L.set(t.otherModulesList.tag,"")):L.set(t.adjustOtherModules.tag,!0),Yt.addModuleClasses()}),y(L,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");h(L,vt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),A(L,vt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),A(L,vt,!0))});let v=L;const jt=class jt{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"https://github.com/crlngn/crlngn-ui/releases/latest/download/module-updates.json";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=S();v.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=S();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const o=await v.get(e.lastUpdateId.tag),a=await jt.getIdFromRawJson();if(g.log("checkForUpdates...",[a,o]),o===a)return;const s=await fetch(jt.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!s.ok){g.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const i=await s.json();await this.displayUpdateNews(i),v.set(e.lastUpdateId.tag,i.id),g.log("checkForUpdates | SUCCESS",[i.id])}catch(o){clearTimeout(n),o.name==="AbortError"?g.warn("checkForUpdates | Request timed out",[o]):g.warn("checkForUpdates | Fetch error",[o.message])}}catch(t){g.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;g.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});g.error("displayUpdateNews | Chat message created",[n,e])}catch(t){g.error("displayUpdateNews | Error creating chat message",[t])}}};y(jt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let io=jt;class Es{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Gn;const Ve=class Ve{static init(){Hooks.once(z.INIT,()=>{var a,s;if(document.querySelector("body").classList.add(x),(a=document.querySelector("#ui-middle"))==null||a.classList.add(x),game.data.version<"13.339"){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion")),Ve.isIncompatible=!0;return}g.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},v.registerSettings();const n=S(),o=v.get(n.disableUI.tag);if(g.log(z.INIT,[o]),o){document.querySelector("body").classList.remove(x),(s=document.querySelector("#ui-middle"))==null||s.classList.remove(x);return}B.init(),oe.init(),$t.init(),Wt.init(),dt.init(),Xt.init(),Ge.init(),Fe.init(),Hooks.on(z.RENDER_CHAT_MESSAGE,h(Ve,Gn))}),Hooks.once(z.READY,()=>{if(g.log("Core Ready",[]),Ve.isIncompatible)return;const e=S();var t=v.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Es.init(),Ge.applyPlayersListSettings(),Yt.init(),io.init(),v.get(e.enableChatStyles.tag)&&Ve.addCSSLocalization()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";D.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),D.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),D.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),D.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),D.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),D.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),D.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),D.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),D.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),D.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Gn=new WeakMap,y(Ve,"isIncompatible",!1),T(Ve,Gn,(e,t)=>{g.log(z.RENDER_CHAT_MESSAGE,[e,t]),dt.enrichCard(e,t)});let ro=Ve;ro.init();
//# sourceMappingURL=crlngn-ui.js.map
