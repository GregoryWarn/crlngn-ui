var je=Object.defineProperty;var ze=b=>{throw TypeError(b)};var Ve=(b,e,t)=>e in b?je(b,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[e]=t;var E=(b,e,t)=>Ve(b,typeof e!="symbol"?e+"":e,t),Ne=(b,e,t)=>e.has(b)||ze("Cannot "+t);var p=(b,e,t)=>(Ne(b,e,"read from private field"),t?t.call(b):e.get(b)),S=(b,e,t)=>e.has(b)?ze("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(b):e.set(b,t),R=(b,e,t,n)=>(Ne(b,e,"write to private field"),n?n.call(b,t):e.set(b,t),t),L=(b,e,t)=>(Ne(b,e,"access private method"),t);const v={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},O="crlngn-ui",ue=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],pe=class pe{static log(e="",t=[],n=!1){try{const o=pe.debugOn;if(!(n||o))return;console.log(...ue,e,...t)}catch{console.log(...ue,e,...t)}}static warn(e="",t=[]){console.warn(...ue,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ue,e)}};E(pe,"debugOn",!1);let r=pe;const N={select:"select",checkbox:"checkbox",text:"text",number:"number"},T={client:"client",world:"world"},de={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},Z={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}};function f(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:T.world,config:!1,requiresReload:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:N.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:Z.playerColor.name},scope:T.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:{bottomBuffer:{tag:"control-bottom-buffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),inputType:N.number},iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox},hideFoundryLogo:{tag:"hide-foundry-logo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:N.checkbox}},default:{bottomBuffer:200,iconSize:de.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:T.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:T.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:T.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:T.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:T.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:N.text,default:Z.playerColor.name,scope:T.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:T.client,config:!1,requiresReload:!0}}}const{ApplicationV2:Ye,HandlebarsApplicationMixin:Xe}=foundry.applications.api;var Q,we,Ae;const $=class $ extends Xe(Ye){static get DEFAULT_OPTIONS(){return{id:f().cameraDockMenu.tag,actions:{redefine:L($,Q,Ae)},form:{handler:L($,Q,we),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=f(),n={...m.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return r.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};Q=new WeakSet,we=async function(e,t,n){const o=f();let a=m.get(o.cameraDockMenu.tag),s=a.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await m.set(o.cameraDockMenu.tag,i),a=m.get(o.cameraDockMenu.tag),r.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,i,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.enableFloatingDock!=s&&location.reload()},Ae=async function(e,t){const n=f(),a=this.element.querySelectorAll("input, select"),s=n.cameraDockMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),r.log("#onReset",[e,t,n.cameraDockMenu.default])},S($,Q),E($,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Se=$;const{ApplicationV2:Ke,HandlebarsApplicationMixin:Ze}=foundry.applications.api;var _,De,Ue;const W=class W extends Ze(Ke){static get DEFAULT_OPTIONS(){return{id:f().chatMessagesMenu.tag,actions:{redefine:L(W,_,Ue)},form:{handler:L(W,_,De),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=f(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(r.log("_prepareContext a",[t[c].oldName]),t[c]){const g=m.get(t[c].tag);o[c]=t[c],a[c]=g!==void 0?g:menuValues[t[c].oldName]||t[c].default,s[c]=t[c].default}}),r.log("_prepareContext b",[a,s]);const i={...a,default:{...s},isGM:game.user.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return r.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=f(),o=m.get(n.chatMessagesMenu.tag);r.log("_onRender",[e,t,o])}};_=new WeakSet,De=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=foundry.utils.expandObject(n.object),i=m.get(o.chatBorderColor.tag);r.log("Compared settings:",[s.chatBorderColor,i]),a.forEach(g=>{r.log("Saving setting >>",[o[g].tag,s[g]]),s[g]!==void 0&&m.set(o[g].tag,s[g])}),await m.set(o.chatMessagesMenu.tag,s),s.chatBorderColor!==i&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ue=async function(e,t){const n=f(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)}),a.forEach(c=>{c.value=i[c.name]})},S(W,_),E(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let be=W;class A{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getAllFonts(){var s;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){let c="";if(i.ownerNode.tagName==="STYLE")c=i.ownerNode.textContent;else if(i.ownerNode.tagName==="LINK")try{if((s=i.href)!=null&&s.startsWith(window.location.origin)){const h=i.cssRules||i.rules;c=Array.from(h).map(y=>y.cssText).join(`
`)}}catch(h){r.warn("Could not read stylesheet rules:",[h])}const g=/@import\s+url\(['"]([^'"]+)['"]\)/g;let C;for(;(C=g.exec(c))!==null;){const h=C[1];if(h.includes("fonts.googleapis.com")){const y=h.match(/family=([^&]+)/);y&&decodeURIComponent(y[1]).split("|").map(w=>w.split(":")[0].replace(/\+/g," ")).forEach(w=>{o.add(w)})}else try{fetch(h).then(y=>y.text()).then(y=>{(y.match(/@font-face\s*{[^}]+}/g)||[]).forEach(w=>{const Pe=w.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(Pe){const We=Pe[1].trim();o.add(We)}})}).catch(y=>console.warn("Error loading imported CSS:",y))}catch(y){r.warn("Error processing imported CSS:",[y])}}}if(!i.href||i.href.startsWith(window.location.origin))try{const c=i.cssRules||i.rules;for(const g of c)if(g instanceof CSSFontFaceRule){const C=g.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();o.add(C)}}catch(c){r.warn("Could not read stylesheet rules:",[c])}}catch(c){r.warn("Error processing stylesheet:",[c])}return r.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!i.includes("FontAwesome")&&!i.includes("Font Awesome")).map(i=>i.replace(/['"`]/g,"").trim()).sort((i,c)=>i.toLowerCase().localeCompare(c.toLowerCase()))}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(o=>typeof e[o]=="function"&&o!=="constructor"&&o!=="prototype"&&o!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(o=>{const a=e[o];e[o]=function(...s){return console.log(`TEST: Executing: ${e.name}.${o}`),a.apply(this,s)}});const n=Object.getOwnPropertyNames(e.prototype).filter(o=>typeof e.prototype[o]=="function"&&o!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,n),n.forEach(o=>{const a=e.prototype[o];e.prototype[o]=function(...s){return console.log(`TEST: Executing: ${e.name}.${o}`),a.apply(this,s)}})}}E(A,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Je,HandlebarsApplicationMixin:Qe}=foundry.applications.api;var H,x,xe,Oe,Fe;const z=class z extends Qe(Je){static get DEFAULT_OPTIONS(){return{id:f().customFontsMenu.tag,actions:{redefine:L(z,x,Fe)},form:{handler:L(z,x,xe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=f(),n=m.get(t.customFontsMenu.tag),o=t.customFontsMenu.fields,a={},s={},i={};return o.forEach(g=>{if(t[g]){const C=m.get(t[g].tag);a[g]=t[g],s[g]=C!==void 0?C:n[t[g].oldName]||t[g].default,i[g]=t[g].default}}),{...s,default:{...i},fontList:A.getAllFonts(),fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){R(z,H,this.element),p(z,H).querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),i=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!i)return;const c=()=>{var g;L(g=z,x,Oe).call(g),i.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",g=>{const C=i.classList.contains("active"),h=Array.from(i.querySelectorAll(".dropdown-option"));let y=h.findIndex(I=>I.classList.contains("highlighted"));g.key==="ArrowDown"||g.key==="ArrowUp"?(g.preventDefault(),C||i.classList.add("active"),h.forEach(I=>I.classList.remove("highlighted")),y===-1?y=g.key==="ArrowDown"?0:h.length-1:y=g.key==="ArrowDown"?(y+1)%h.length:(y-1+h.length)%h.length,h[y]&&(h[y].classList.add("highlighted"),h[y].scrollIntoView({block:"nearest"}))):g.key==="Enter"?(g.preventDefault(),C&&y!==-1&&h[y]&&h[y].click()):g.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",g=>{s.contains(g.target)||i.classList.remove("active")})}),p(z,H).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let c=a.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),i.value=c,a.closest(".dropdown-options").classList.remove("active")})})}};H=new WeakMap,x=new WeakSet,xe=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(r.log("Saving setting:",[s[i]]),m.set(o[i].tag,s[i]))}),m.set(o.customFontsMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oe=function(){p(z,H).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Fe=async function(e,t){const n=f(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)}),a.forEach(c=>{c.value=i[c.name]})},S(z,x),S(z,H),E(z,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ce=z;const{ApplicationV2:_e,HandlebarsApplicationMixin:et}=foundry.applications.api;var ee,Be,He;const j=class j extends et(_e){static get DEFAULT_OPTIONS(){return{id:f().leftControlsMenu.tag,actions:{redefine:L(j,ee,He)},form:{handler:L(j,ee,Be),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=f(),n={...m.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return r.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=f(),o=m.get(n.leftControlsMenu.tag);r.log("_onRender",[e,t,o])}};ee=new WeakSet,Be=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const a=foundry.utils.expandObject(n.object);(a.bottomBuffer===void 0||a.bottomBuffer==="")&&(a.bottomBuffer=o.leftControlsMenu.default.bottomBuffer);const s=m.get(o.leftControlsMenu.tag);s.hideFoundryLogo===void 0&&(a.hideFoundryLogo=o.leftControlsMenu.default.hideFoundryLogo),await m.set(o.leftControlsMenu.tag,a);const i=m.get(o.leftControlsMenu.tag);r.log("Saving settings:",[s,a,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},He=async function(e,t){const n=f(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),r.log("#onReset",[e,t,n.leftControlsMenu.default])},S(j,ee),E(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Le=j;const{ApplicationV2:tt,HandlebarsApplicationMixin:nt}=foundry.applications.api;var te,qe,$e;const V=class V extends nt(tt){static get DEFAULT_OPTIONS(){return{id:f().sceneNavMenu.tag,actions:{redefine:L(V,te,$e)},form:{handler:L(V,te,qe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=f(),n={...m.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return r.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};te=new WeakSet,qe=async function(e,t,n){const o=f();let a=m.get(o.sceneNavMenu.tag),s=a.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await m.set(o.sceneNavMenu.tag,i),a=m.get(o.sceneNavMenu.tag),r.log("Saving settings...",[o.sceneNavMenu.tag,t,n.object,i,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.sceneNavEnabled!=s&&location.reload()},$e=async function(e,t){const n=f(),a=this.element.querySelectorAll("input, select"),s=n.sceneNavMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),r.log("#onReset",[e,t,n.sceneNavMenu.default])},S(V,te),E(V,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Me=V;function ot(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Ce,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:be,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Le,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Se,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Me,restricted:!1}}}var ne,oe,se,ae,ie,le,ce,k,ve,Ee,Re,Te;const l=class l{static init(){const e=f(),t=m.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(v.RENDER_CAMERA_VIEWS,l.onRenderFloating),r.log("CameraUtil",[t]),l.onRenderFloating()):(Hooks.on(v.RENDER_CAMERA_VIEWS,l.onRenderPlain),l.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var a,s,i;const e=f(),t=m.get(e.cameraDockMenu.tag);(a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-ui"),l.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");r.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),l.cameraContainer&&o&&n&&((s=l.cameraContainer)==null||s.insertBefore(n,o),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),l.makeDraggable(),l.makeResizeable(),l.resetPositionAndSize(),l.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(r.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=l.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,s;const n=document.querySelector("body.crlngn-ui");if(r.log("mousedown",[t.target]),(a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",L(l,k,Ee)),n==null||n.addEventListener("mouseup",L(l,k,ve));const o=A.getOffsetBottom(l.cameraContainer);l.isDragging=!0,R(l,ne,t.clientX-((s=l.cameraContainer)==null?void 0:s.offsetLeft)),R(l,oe,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(l.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),l.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),l.isResizing=!0,R(l,se,n.clientX),R(l,ae,n.clientY),R(l,ce,parseInt(getComputedStyle(l.cameraContainer).bottom)||0),R(l,ie,l.cameraContainer.offsetWidth),R(l,le,l.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",L(l,k,Re)),e==null||e.addEventListener("mouseup",L(l,k,Te))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const a=f(),s=m.get(a.cameraDockMenu.tag);if(!(!s.enableFloatingDock||!l.cameraContainer))if(!e&&!t&&!n&&!o){const i=s.dockPosX||0,c=s.dockPosY||0,g=s.dockWidth||0,C=s.dockHeight||0;l.cameraContainer.style.left=`${i}px`,l.cameraContainer.style.bottom=`${c}px`,l.cameraContainer.style.width=`${g}px`,l.cameraContainer.style.height=`${C}px`}else e&&(l.cameraContainer.style.left=`${e}px`),t&&(l.cameraContainer.style.bottom=`${t}px`),n&&(l.cameraContainer.style.width=`${n}px`),o&&(l.cameraContainer.style.height=`${o}px`)}};ne=new WeakMap,oe=new WeakMap,se=new WeakMap,ae=new WeakMap,ie=new WeakMap,le=new WeakMap,ce=new WeakMap,k=new WeakSet,ve=function(e){var o,a;const t=f(),n={...m.get(t.cameraDockMenu.tag)};if(l.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=l.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=l.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),m.set(t.cameraDockMenu.tag,n),s==null||s.removeEventListener("mousemove",L(l,k,Ee)),s==null||s.removeEventListener("mouseup",L(l,k,ve)),l.isDragging=!1,e.stopPropagation()}},Ee=function(e){if(l.isDragging&&(r.log("mousemove",[e.target.parentNode]),l.cameraContainer)){let t=e.clientX-p(l,ne),n=window.innerHeight-e.clientY-p(l,oe);t+l.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-l.cameraContainer.offsetWidt),l.cameraContainer.style.left=`${t}px`,n+l.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-l.cameraContainer.offsetHeight),l.cameraContainer.style.bottom=`${n}px`}},Re=function(e){if(!l.isResizing)return;const t=p(l,ie)+(e.clientX-p(l,se)),n=e.clientY-p(l,ae),o=p(l,le)+n,a=p(l,ce)-n;l.cameraContainer.style.width=`${t}px`,l.cameraContainer.style.height=`${o}px`,l.cameraContainer.style.bottom=`${a}px`},Te=function(){var o,a,s,i,c,g;const e=f(),t={...m.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");l.isResizing=!1,n==null||n.removeEventListener("mousemove",L(l,k,Re)),n==null||n.removeEventListener("mouseup",L(l,k,Te)),r.log("onStopResize",[(o=l.cameraContainer)==null?void 0:o.style.width,(a=l.cameraContainer)==null?void 0:a.style.height,(s=l.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((i=l.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((c=l.cameraContainer)==null?void 0:c.style.height)||0),t.dockPosY=parseInt(((g=l.cameraContainer)==null?void 0:g.style.bottom)||0),m.set(e.cameraDockMenu.tag,t)},S(l,k),S(l,ne,0),S(l,oe,0),E(l,"isDragging",!1),E(l,"cameraContainer"),E(l,"isResizing",!1),S(l,se,0),S(l,ae,0),S(l,ie,0),S(l,le,0),S(l,ce,0);let B=l;const D=class D{static init(){const e=f();D.enableChatStyles=m.get(e.enableChatStyles.tag),D.chatBorderColor=m.get(e.chatBorderColor.tag)}static enrichCard(e,t){var n,o,a,s,i,c,g,C;if(D.enableChatStyles){const h=((a=(o=(n=e.flags)==null?void 0:n.dnd5e)==null?void 0:o.activity)==null?void 0:a.type)||((c=(i=(s=e.flags)==null?void 0:s.dnd5e)==null?void 0:i.roll)==null?void 0:c.type)||"custom";let y=t.get?t.get(0):t;y.classList.add(h),r.log("enrichCard",[D.chatBorderColor,Z.playerColor.name,(g=e.author)==null?void 0:g.id]),D.chatBorderColor===Z.playerColor.name&&((C=e.author)!=null&&C.id)&&y.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}}};E(D,"chatBorderColor"),E(D,"enableChatStyles");let J=D;var G,P,q,X,K,ke,me,ye;const d=class d{static init(){const e=f();d.navSettings=m.get(e.sceneNavMenu.tag),d.isCollapsed=m.get(e.sceneNavCollapsed.tag),d.navPos=m.get(e.sceneNavPos.tag);const t=document.querySelector("#ui-middle");let n=d.navSettings;if(n.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}d.resetLocalVars();const o=A.isModuleOn("monks-scene-navigation");o&&n.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),m.set(e.sceneNavMenu.tag,{...n,sceneNavEnabled:!1})),r.log("TopNavigation - init",[o]),o?t.classList.add("with-monks-scene"):(d.resetLocalVars(),d.addListeners(),r.log(v.RENDER_SCENE_NAV,[]),d.setNavPosition(0),d.placeNavButtons()),Hooks.on(v.RENDER_SCENE_NAV,()=>{f();const a=A.isModuleOn("monks-scene-navigation");r.log(v.RENDER_SCENE_NAV,[a]),a||(d.resetLocalVars(),r.log(v.RENDER_SCENE_NAV,[]),d.placeNavButtons(),d.setNavPosition(),d.addListeners())}),Hooks.on(v.COLLAPSE_SIDE_BAR,a=>{const s=A.isModuleOn("monks-scene-navigation");r.log(v.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",s]),s||d.placeNavButtons()}),Hooks.on(v.COLLAPSE_SCENE_NAV,(a,s)=>{const i=f();m.set(i.sceneNavCollapsed.tag,s),r.log("NAV toggle",[a,s]);const c=document.querySelector("#ui-middle");s?c.classList.add("navigation-collapsed"):c.classList.remove("navigation-collapsed")}),Hooks.on(v.EXPAND_SCENE_NAV,(a,s)=>{r.log("NAV expand",[a,!1])}),window.addEventListener("resize",()=>{A.isModuleOn("monks-scene-navigation")||d.placeNavButtons()}),r.log("TopNavigation - init",[n.sceneNavEnabled])}static resetLocalVars(){R(d,G,document.querySelector("#navigation")),R(d,P,document.querySelector("#scene-list")),R(d,X,document.querySelector("#navigation .nav-item.is-root")),R(d,K,document.querySelector("#nav-toggle"))}static addListeners(){var e,t;(e=p(d,G))==null||e.addEventListener("mouseenter",()=>{var a;if(r.log("TopNavigation mouseenter",[]),!d.isCollapsed||!((a=d.navSettings)!=null&&a.showNavOnHover))return;clearTimeout(p(this,q));const n=document.querySelector("#scene-list");n&&(n.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,G))==null||t.addEventListener("mouseleave",o=>{var a;if(r.log("TopNavigation mouseleave",[]),!(!d.isCollapsed||!((a=d.navSettings)!=null&&a.showNavOnHover))){if(!o)var o=window.event;o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),R(this,q,setTimeout(()=>{clearTimeout(p(this,q)),R(this,q,null);const s=document.querySelector("#scene-list");s&&(s.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var i,c,g,C,h,y,I;d.resetLocalVars();const e=(i=p(this,G))==null?void 0:i.querySelectorAll("button.crlngn-nav"),t=((c=p(this,P))==null?void 0:c.scrollWidth)>=((g=p(this,G))==null?void 0:g.offsetWidth);if(r.log("placeNavButtons",[t,e,(C=p(this,P))==null?void 0:C.scrollWidth,(h=p(this,G))==null?void 0:h.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),n.addEventListener("click",p(this,me)),n.append(o);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-right"),a.append(s),a.addEventListener("click",p(this,ye)),(y=p(this,G))==null||y.appendChild(n),(I=p(this,G))==null||I.appendChild(a)}static setNavPosition(e){var s,i;const t=f();if(!p(this,P))return;const n=e!==void 0?e:d.navPos||0,o=((s=p(this,P))==null?void 0:s.querySelectorAll("li.nav-item"))||[],a=((i=o[n])==null?void 0:i.offsetLeft)*-1;p(this,P).style.marginLeft=a+"px",m.set(t.sceneNavPos.tag,n),r.log("setNavPosition",[e,n,o[n],a])}};G=new WeakMap,P=new WeakMap,q=new WeakMap,X=new WeakMap,K=new WeakMap,ke=new WeakMap,me=new WeakMap,ye=new WeakMap,S(d,G),S(d,P),S(d,q),S(d,X),S(d,K),S(d,ke),E(d,"SETTINGS"),E(d,"navSettings"),E(d,"isCollapsed"),E(d,"navPos"),S(d,me,e=>{var C,h,y,I,w;const t=(C=p(d,K))==null?void 0:C.offsetWidth,n=A.isModuleOn("compact-scene-navigation")?(h=p(d,X))==null?void 0:h.offsetWidth:0,o=(y=p(d,P))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),a=((I=p(d,P))==null?void 0:I.querySelectorAll("li.nav-item"))||[],s=o.offsetWidth,i=d.navPos||0,c=Math.floor((((w=p(d,G))==null?void 0:w.offsetWidth)-(i===0?n:0)-t*2)/s);r.log("onNavLast",["currPos",i,c]);let g=i-c;g=g<0?0:g,r.log("onNavLast",["sceneCount",a.length,i,g]),d.setNavPosition(g)}),S(d,ye,e=>{var C,h,y,I,w;f();const t=(C=p(d,K))==null?void 0:C.offsetWidth,n=A.isModuleOn("compact-scene-navigation")?(h=p(d,X))==null?void 0:h.offsetWidth:0,o=(y=p(d,P))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),a=((I=p(d,P))==null?void 0:I.querySelectorAll("li.nav-item:not(.is-root)"))||[],s=o.offsetWidth,i=d.navPos||0,c=Math.floor((((w=p(d,G))==null?void 0:w.offsetWidth)-(i===0?n:0)-t*2)/s);r.log("onNavLast",["currPos",i,c]);let g=i+c;g=g>a.length?a.length:g,d.setNavPosition(g)});let Y=d;const u=class u{static registerSettings(){const e=f();r.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(O),Object.entries(e).forEach(async a=>{const s=a[1];r.log("Registering... ",[a],!0);const i={name:s.label,hint:s.hint,default:s.default,type:s.propType,scope:s.scope,config:s.config,requiresReload:s.requiresReload||!1,onChange:c=>u.apply(s.tag,c)};s.choices&&(i.choices=s.choices),await game.settings.register(O,s.tag,i),u.get(s.tag)===void 0&&u.set(s.tag,s.default)}),Object.entries(ot()).forEach(async a=>{const s=a[1],i={name:s.tag,label:s.label,hint:s.hint,icon:s.icon,type:s.propType,restricted:s.restricted};await game.settings.registerMenu(O,s.tag,i)}),Hooks.on(v.RENDER_SCENE_CONTROLS,u.applyLeftControlsSettings),Hooks.on(v.RENDER_PLAYERS_LIST,u.applyPlayersListSettings),Hooks.on(v.RENDER_HOTBAR,()=>{u.firstLoad&&(u.firstLoad=!1,u.applyHotBarCollapse()),u.applyHotBarSettings()}),u.applyDebugSettings(),u.applySceneNavPos(),u.applyChatStyles(),u.applyBorderColors();const o=e.customFontsMenu.fields;r.log("AAAAA",[o],!0),o.forEach(a=>{r.log("registerSettings",[e[a].tag]),u.applyCustomFonts(e[a].tag)}),u.applyLeftControlsSettings(),u.applyControlIconSize(),u.applyControlsBuffer()}static get(e,t=O){if(!e)return null;let n=!1;if(t===O)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,r.log("GET Setting",[a,n])}return n}static set(e,t,n=O){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),r.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{r.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){const n=f();switch(t===void 0&&(t=u.get(e)),r.log("SettingsUtil.apply",[e,t,u.get(e)]),e){case n.enableMacroLayout.tag:u.applyHotBarSettings();break;case n.collapseMacroBar.tag:u.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:u.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:u.applyCustomFonts(e,t);break;case n.leftControlsMenu.tag:u.applyLeftControlsSettings(),u.applyControlIconSize(),u.applyControlsBuffer();break;case n.cameraDockMenu.tag:u.applyCameraPosX(),u.applyCameraPosY(),u.applyCameraWidth(),u.applyCameraHeight();break;case n.chatBorderColor.tag:J.chatBorderColor=u.get(n.chatBorderColor.tag),r.log("SettingsUtil.apply",[e]),u.applyBorderColors();break;case n.enableChatStyles.tag:J.enableChatStyles=u.get(n.enableChatStyles.tag),r.log("SettingsUtil.apply",[e]),u.applyChatStyles();break;case n.debugMode.tag:u.applyDebugSettings();break;case n.sceneNavMenu.tag:Y.navSettings=u.get(n.sceneNavMenu.tag);break;case n.sceneNavCollapsed.tag:Y.isCollapsed=u.get(n.sceneNavCollapsed.tag);break}}static applyBorderColors(){const e=f(),t=u.get(e.chatBorderColor.tag),n=document.querySelector("body");t===Z.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===Z.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=f(),t=u.get(e.enableChatStyles.tag),n=document.querySelector("body");r.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=f(),t=u.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=f();u.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=f(),t=u.get(e.leftControlsMenu.tag),n=u.get(e.sceneNavMenu.tag),o=document.querySelector("#ui-left"),a=document.querySelector("#ui-left #logo");t.autoHideSecondary?o.classList.add("auto-hide"):o.classList.remove("auto-hide");const s=document.querySelector("body.crlngn-ui"),i=window.getComputedStyle(s),c=parseFloat(i.getPropertyValue("--top-nav-height"));t.hideFoundryLogo===void 0||t.hideFoundryLogo===!0?(a.classList.remove("visible"),s.style.setProperty("--ui-top-padding",`${c}px`),document.querySelector("body").classList.remove("logo-visible")):(a.classList.add("visible"),n.sceneNavEnabled?(s.style.setProperty("--ui-top-padding",`${72+c}px`),document.querySelector("body").classList.add("logo-visible")):s.style.setProperty("--ui-top-padding","72px"))}static applyControlIconSize(){const e=f(),t=u.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=t.iconSize==de.small.name?de.small.size:de.regular.size;n.style.setProperty("--left-control-item-size",o)}static applyControlsBuffer(){const e=f(),t=u.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;n.style.setProperty("--controls-bottom-buffer",`${o||0}px`)}static applyPlayersListSettings(){var t,n;const e=f();r.log("applyPlayersListSettings",[document.querySelector("#players"),u.get(e.autoHidePlayerList.tag)]),u.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),fe.checkPlayersList()}static applySceneNavPos(){const e=f();u.set(e.sceneNavPos.tag,0),Y.navPos=0}static applyCameraPosX(e){const t=f(),n=u.get(t.cameraDockMenu.tag),o=e||n.dockPosX;B.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=f(),n=u.get(t.cameraDockMenu.tag),o=e||n.dockPosY;B.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=f(),n=u.get(t.cameraDockMenu.tag),o=e||n.dockWidth;B.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=f(),n=u.get(t.cameraDockMenu.tag),o=e||n.dockHeight;B.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=f(),o=n.customFontsMenu.fields,a={};r.log("applyCustomFonts",[e,t]),o.forEach(i=>{a[i]=u.get(n[i].tag)});const s=document.querySelector("body.crlngn-ui");switch(e){case n.uiFontBody.tag:s.style.setProperty("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:s.style.setProperty("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:s.style.setProperty("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles:s.style.setProperty("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=f();r.debugOn=e||u.get(t.debugMode.tag)}};E(u,"firstLoad",!0);let m=u;class Ge{static init(){Hooks.on(v.RENDER_PLAYERS_LIST,Ge.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var U,re,ge;const M=class M{static init(){r.log("LeftControls - init",[]),Hooks.on(v.RENDER_SCENE_CONTROLS,M.initSceneControls),M.initSceneControls()}static resetLocalVars(){R(M,U,document.querySelector("#ui-left #controls")),R(M,re,document.querySelector("#ui-left"))}static initSceneControls(){r.log("initSceneControls",[]),M.resetLocalVars(),M.observeControlsWidth()}static observeControlsWidth(){if(r.log("observeControlsWidth",[]),!p(M,U))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};R(M,ge,new ResizeObserver(n=>{t(()=>M.updateCSSVars(),250)},{box:"border-box"})),p(M,ge).observe(p(M,U)),M.updateCSSVars()}static updateCSSVars(){if(!p(M,U))return;let e=Number(p(M,re).offsetWidth),t=Number(p(M,U).offsetWidth),n=-e+t+24;if(r.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const o=document.querySelector("body.crlngn-ui");o==null||o.style.setProperty("--ui-controls-margin-left",n+"px")}}};U=new WeakMap,re=new WeakMap,ge=new WeakMap,S(M,U),S(M,re),S(M,ge);let Ie=M;class st{static init(){const e=A.isModuleOn("foundry-taskbar"),t=document.querySelector("body.crlngn-ui");e&&game.settings.get("foundry-taskbar","reduceSidebar")?t.style.setProperty("--crlngn-sidebar-bottom","50px"):t.style.setProperty("--crlngn-sidebar-bottom","0px")}}var he;const F=class F{static init(){Hooks.once(v.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(O),r.log("Initiating module...",[],!0),Hooks.on(v.RENDER_CHAT_MESSAGE,p(F,he)),Hooks.on(v.RENDER_PLAYERS_LIST,F.checkPlayersList),m.registerSettings()}),Hooks.once(v.READY,()=>{r.log("Core Ready",[]);const e=f();var t=m.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Y.init(),B.init(),Ge.init(),Ie.init(),J.init(),st.init(),m.get(e.enableChatStyles.tag)&&F.addCSSLocalization()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}};he=new WeakMap,S(F,he,(e,t)=>{r.log(v.RENDER_CHAT_MESSAGE,[e,t]),J.enrichCard(e,t)}),E(F,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#ui-left #players"),o=A.isModuleOn("foundry-taskbar")?game.settings.get("foundry-taskbar","dockPlayersList"):!1;e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players"),e.classList.remove("players-hidden")):o?(e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"),e.classList.remove("players-hidden"))});let fe=F;fe.init();
//# sourceMappingURL=crlngn-ui.js.map
