var ta=Object.defineProperty;var uo=i=>{throw TypeError(i)};var na=(i,e,t)=>e in i?ta(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var E=(i,e,t)=>na(i,typeof e!="symbol"?e+"":e,t),Nn=(i,e,t)=>e.has(i)||uo("Cannot "+t);var C=(i,e,t)=>(Nn(i,e,"read from private field"),t?t.call(i):e.get(i)),T=(i,e,t)=>e.has(i)?uo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),O=(i,e,t,n)=>(Nn(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),W=(i,e,t)=>(Nn(i,e,"access private method"),t);const G={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},ee="crlngn-ui",_t=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],mn=class mn{static log(e="",t=[],n=!1){try{const o=mn.debugOn;if(!(n||o))return;console.log(..._t,e,...t)}catch{console.log(..._t,e,...t)}}static warn(e="",t=[]){console.warn(..._t,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(..._t,e)}};E(mn,"debugOn",!1);let f=mn;const k={select:"select",checkbox:"checkbox",text:"text",number:"number"},I={client:"client",world:"world"},je={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},An={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},st={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},go={noButton:{name:"noButton"},lastScene:{name:"lastScene"},defaultScenes:{name:"defaultScenes"}},ge={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},En=140,De=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function S(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:k.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:I.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:I.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:k.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:st.playerColor.name},scope:I.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:k.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide"],default:{bottomBuffer:200,iconSize:je.small.name,autoHideSecondary:!1},scope:I.client,config:!1,requiresReload:!1},playersListMenu:{tag:"players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,inputType:k.button,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:I.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:k.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:ge.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:I.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:k.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navShowRootFolders","sceneClickToView","useSceneIcons","sceneNavAlias","navStartCollapsed","showNavOnHover","useNavBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,sceneNavAlias:"",showFolderListOnClick:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useNavBackButton:go.lastScene.name},scope:I.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:I.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:k.select,propType:String,default:An.small.name,scope:I.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.world,config:!1},useNavBackButton:{tag:"use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.hint"),propType:String,inputType:k.select,options:{noButton:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.noButton"),lastScene:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.lastScene"),defaultScenes:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.defaultScenes")},default:go.lastScene.name,scope:I.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:k.text,default:"",scope:I.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:k.number,default:0,scope:I.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.world,config:!0},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,inputType:k.checkbox,default:!1,scope:I.client,config:!1},playerListAvatars:{tag:"player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:k.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:I.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:k.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:I.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:k.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:I.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:k.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:I.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:k.text,propType:String,default:"",scope:I.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:k.checkbox,propType:Boolean,default:!1,scope:I.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:k.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:I.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:k.text,propType:String,default:"",scope:I.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:k.text,default:st.playerColor.name,scope:I.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:k.checkbox,default:!0,scope:I.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:k.number,default:200,scope:I.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:k.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:je.small.name,scope:I.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:k.checkbox,propType:Boolean,default:!1,scope:I.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:k.checkbox,propType:Boolean,default:!0,scope:I.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:k.number,propType:Number,default:0,scope:I.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:k.number,propType:Number,default:120,scope:I.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:k.number,propType:Number,default:160,scope:I.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:k.number,propType:Number,default:145,scope:I.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:k.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:ge.off.name,scope:I.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:k.number,propType:Number,default:160,scope:I.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:I.world,config:!1,default:""}}}const{ApplicationV2:oa,HandlebarsApplicationMixin:aa}=foundry.applications.api;var Jn,lt,No,Eo;const me=class me extends aa(oa){static get DEFAULT_OPTIONS(){return{id:S().playersListMenu.tag,actions:{redefine:W(me,lt,Eo)},form:{handler:W(me,lt,No),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=S(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=v.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}}),f.log("_prepareContext A",[o,n,a,s]);const r={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return f.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();me.element=this.element,me.element.querySelector(".toggle-hint").addEventListener("click",()=>{me.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.playersListMenu.tag);f.log("_onRender",[e,t,a])}};Jn=new WeakMap,lt=new WeakSet,No=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(r=>{s[r]!==void 0&&(f.log("Saving setting:",[s[r]]),v.set(o[r].tag,s[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Eo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(r=>{r.value=s[r.name],r.type==="checkbox"&&(r.checked=s[r.name])}),f.log("#onReset",[e,t,n.playersListMenu.default])},T(me,lt),T(me,Jn),E(me,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let zn=me;const{ApplicationV2:sa,HandlebarsApplicationMixin:ia}=foundry.applications.api;var ct,To,Lo,Rt,On;const ye=class ye extends ia(sa){constructor(){super(...arguments);T(this,Rt)}static get DEFAULT_OPTIONS(){return{id:S().cameraDockMenu.tag,actions:{redefine:W(ye,ct,Lo)},form:{handler:W(ye,ct,To),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=S(),o=n.cameraDockMenu.fields,a={},s={},r={};o.forEach(u=>{if(f.log("_prepareContext",[n[u].oldName]),n[u]){const p=v.get(n[u].tag);a[u]=n[u],s[u]=p!==void 0?p:n[u].default,r[u]=n[u].default}});const l={...s,default:{...r},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),ye.element=this.element,ye.element.querySelector(".toggle-hint").addEventListener("click",()=>{ye.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",W(this,Rt,On).bind(this)),W(this,Rt,On).call(this,{target:a}))}};ct=new WeakSet,To=async function(t,n,o){const a=S();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,r=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!r.hasOwnProperty(p)&&(r[p]=!1)});const l=foundry.utils.expandObject(r),c=v.get(a.enableFloatingDock.tag);f.log("Compared settings:",[l.enableFloatingDock,c]),s.forEach(p=>{f.log("Saving setting >>",[a[p].tag,l[p]]),l[p]!==void 0&&v.set(a[p].tag,l[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==c&&location.reload()},Lo=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),r=o.cameraDockMenu.fields,l={};r.forEach(c=>{o[c]&&(o[c],l[c]=o[c].default)}),s.forEach(c=>{c.value=l[c.name]}),f.log("#onReset",[t,n,o.cameraDockMenu.default])},Rt=new WeakSet,On=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(r=>r.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(r=>r.disabled=!t.target.checked),f.log("onDockEnabledChange",[this.element,n,o])},T(ye,ct),E(ye,"element"),E(ye,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Gn=ye;const{ApplicationV2:ra,HandlebarsApplicationMixin:la}=foundry.applications.api;var Kn,dt,Io,wo;const Se=class Se extends la(ra){static get DEFAULT_OPTIONS(){return{id:S().chatMessagesMenu.tag,actions:{redefine:W(Se,dt,wo)},form:{handler:W(Se,dt,Io),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=S(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(f.log("_prepareContext",[t[c].oldName]),t[c]){const u=v.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}}),f.log("_prepareContext",[a,s]);const r={...a,default:{...s},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Se.element=this.element,Se.element.querySelector(".toggle-hint").addEventListener("click",()=>{Se.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.chatMessagesMenu.tag);f.log("_onRender",[e,t,a])}};Kn=new WeakMap,dt=new WeakSet,Io=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(u=>{o[u].inputType==="checkbox"&&!s.hasOwnProperty(u)&&(s[u]=!1)});const r=foundry.utils.expandObject(s),l=v.get(o.chatBorderColor.tag);f.log("Compared settings:",[r.chatBorderColor,l]),a.forEach(u=>{f.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&v.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},wo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,r={};s.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),a.forEach(l=>{l.value=r[l.name]})},T(Se,dt),T(Se,Kn),E(Se,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let xn=Se;const wt=class wt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const r=s.style.getPropertyValue("font-family");r&&(t.add(r),f.log("Found font-face rule:",[r]))}else if(s instanceof CSSImportRule){if(f.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const l=await(await fetch(s.href)).text();this.extractFontsFromCSSText(l,t)}catch(r){f.warn("Error fetching imported CSS:",[r])}}}}catch(o){if(o.name==="SecurityError"&&e.href){f.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){f.warn("Error fetching cross-origin stylesheet:",[a])}}else f.warn("Error accessing CSS rules:",[o])}}catch(o){f.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];f.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,r=a.match(s);if(r&&r[2]){const l=r[2].trim();t.add(l),f.log("Found font-face in CSS text:",[l])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return f.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const l=o.substring(a+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),c={};l.forEach(h=>{const N=h.split(":");if(N.length>=2){const b=N[0].trim(),L=N.slice(1).join(":").trim();b&&(c[b]=L)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([h,N])=>`  ${h}: ${N};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+u+`
}`+o.substring(s+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const r=n==="horizontal",l=r?e.scrollLeft:e.scrollTop,c=t-l;if(c===0)return a&&a(),null;const u=performance.now(),p=N=>{const b=N-u;if(b>=o){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const L=b/o,z=L<.5?2*L*L:1-Math.pow(-2*L+2,2)/2;r?e.scrollLeft=l+c*z:e.scrollTop=l+c*z;const x=requestAnimationFrame(p);return e.dataset.scrollAnimationId=x,x},h=requestAnimationFrame(p);return e.dataset.scrollAnimationId=h,h}};E(wt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));f.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);f.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const r=s.href||"",l=r.includes("css/")||r.includes("styles/"),c=r.includes("modules/crlngn-ui/"),u=r.includes("systems/");if(r&&!l&&!c&&!u){f.log("Skipping stylesheet:",[r]);continue}f.log("Processing stylesheet:",[s,r]),await wt.processStyleSheetRules(s,o)}}catch(r){f.warn("Error processing stylesheet:",[r])}return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))}),E(wt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let D=wt;const{ApplicationV2:ca,HandlebarsApplicationMixin:da}=foundry.applications.api;var Zn,xe,ko,Ro,Mo;const ne=class ne extends da(ca){static get DEFAULT_OPTIONS(){return{id:S().customFontsMenu.tag,actions:{redefine:W(ne,xe,Mo)},form:{handler:W(ne,xe,ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=S(),n=t.customFontsMenu.fields,o={},a={},s={},r=await D.getAllFonts();return n.forEach(c=>{if(t[c]){const u=v.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:r,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){ne.element=this.element,ne.element.querySelector(".toggle-hint").addEventListener("click",()=>{ne.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),ne.element.querySelectorAll('input[type="text"]').forEach(s=>{const r=s.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const c=()=>{var u;W(u=ne,xe,Ro).call(u),l.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",u=>{const p=l.classList.contains("active"),h=Array.from(l.querySelectorAll(".dropdown-option"));let N=h.findIndex(b=>b.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),p||l.classList.add("active"),h.forEach(b=>b.classList.remove("highlighted")),N===-1?N=u.key==="ArrowDown"?0:h.length-1:N=u.key==="ArrowDown"?(N+1)%h.length:(N-1+h.length)%h.length,h[N]&&(h[N].classList.add("highlighted"),h[N].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),p&&N!==-1&&h[N]&&h[N].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),ne.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",r=>{const l=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),l.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};Zn=new WeakMap,xe=new WeakSet,ko=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(r=>{s[r]!==void 0&&(f.log("Saving setting:",[s[r]]),v.set(o[r].tag,s[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ro=function(){ne.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Mo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,r={};s.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),a.forEach(l=>{l.value=r[l.name]})},T(ne,xe),T(ne,Zn),E(ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Fn=ne;const{ApplicationV2:ua,HandlebarsApplicationMixin:ga}=foundry.applications.api;var Qn,ut,Do,Po;const be=class be extends ga(ua){static get DEFAULT_OPTIONS(){return{id:S().leftControlsMenu.tag,actions:{redefine:W(be,ut,Po)},form:{handler:W(be,ut,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=S(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(l=>{if(t[l]){const c=v.get(t[l].tag);o[l]=t[l],a[l]=c!==void 0?c:t[l].default,s[l]=t[l].default}});const r={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();be.element=this.element,be.element.querySelector(".toggle-hint").addEventListener("click",()=>{be.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=v.get(n.leftControlsMenu.tag);f.log("_onRender",[e,t,a])}};Qn=new WeakMap,ut=new WeakSet,Do=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(r=>{s[r]!==void 0&&(f.log("Saving setting:",[s[r]]),v.set(o[r].tag,s[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Po=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(r=>{r.value=s[r.name],r.type==="checkbox"&&(r.checked=s[r.name])}),f.log("#onReset",[e,t,n.leftControlsMenu.default])},T(be,ut),T(be,Qn),E(be,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Un=be;const{ApplicationV2:fa,HandlebarsApplicationMixin:pa}=foundry.applications.api;var _n,gt,Ao,zo,Mt,Hn;const ve=class ve extends pa(fa){constructor(){super(...arguments);T(this,Mt)}static get DEFAULT_OPTIONS(){return{id:S().sceneNavMenu.tag,actions:{redefine:W(ve,gt,zo)},form:{handler:W(ve,gt,Ao),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=S(),o=n.sceneNavMenu.fields,a={},s={},r={};o.forEach(c=>{if(n[c]){const u=v.get(n[c].tag);a[c]=n[c],s[c]=u!==void 0?u:n[c].default,r[c]=n[c].default}});const l={...s,default:{...r},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",W(this,Mt,Hn).bind(this)),W(this,Mt,Hn).call(this,{target:a}))}};_n=new WeakMap,gt=new WeakSet,Ao=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=S(),s=a.sceneNavMenu.fields;let r=v.get(a.sceneNavEnabled.tag),l=v.get(a.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);s.forEach(h=>{c[h]!==void 0&&(f.log("Saving setting:",[c[h]]),v.set(a[h].tag,c[h]))});let u=v.get(a.sceneNavEnabled.tag),p=v.get(a.navFoldersEnabled.tag);f.log("Saving settings...",[r,u]),await v.set(a.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==p)&&location.reload()},zo=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;s.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),f.log("#onReset",[t,n,o.sceneNavMenu.default])},Mt=new WeakSet,Hn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),f.log("onSceneNavEnabledChange",[this.element,n])},T(ve,gt),T(ve,_n),E(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Bn=ve;const{ApplicationV2:ha,HandlebarsApplicationMixin:ma}=foundry.applications.api;var eo,to,Fe,Go,Oo,xo;const X=class X extends ma(ha){static get DEFAULT_OPTIONS(){return{id:S().themeAndStylesMenu.tag,actions:{redefine:W(X,Fe,xo)},form:{handler:W(X,Fe,Go),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=S(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const u=v.get(t[c].tag);o[c]=t[c],a[c]=u!==void 0?u:t[c].default,s[c]=t[c].default}});const r=De.find(c=>c.className===a.colorTheme);a.colorTheme=(r==null?void 0:r.label)||De[0].label;const l={...a,default:{...s},fields:{...o},selectedTheme:r,themes:De,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){X.element=this.element,X.element.querySelector(".toggle-hint").addEventListener("click",()=>{X.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=De,X.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const p=u.closest(".dropdown-wrapper"),h=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!h)return;const N=()=>{var b;W(b=X,Fe,Oo).call(b),h.classList.add("active")};u.addEventListener("focus",N),u.addEventListener("click",N),u.addEventListener("keydown",b=>{const L=h.classList.contains("active"),z=Array.from(h.querySelectorAll(".dropdown-option"));let x=z.findIndex($=>$.classList.contains("highlighted"));b.key==="ArrowDown"||b.key==="ArrowUp"?(b.preventDefault(),L||h.classList.add("active"),z.forEach($=>$.classList.remove("highlighted")),x===-1?x=b.key==="ArrowDown"?0:z.length-1:x=b.key==="ArrowDown"?(x+1)%z.length:(x-1+z.length)%z.length,z[x]&&(z[x].classList.add("highlighted"),z[x].scrollIntoView({block:"nearest"}))):b.key==="Enter"?(b.preventDefault(),L&&x!==-1&&z[x]&&z[x].click()):b.key==="Escape"&&h.classList.remove("active")}),document.addEventListener("click",b=>{p.contains(b.target)||h.classList.remove("active")})});const a=X.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(p){f.log("option",[u,u.querySelector(".theme-name")]);const h=u.closest(".dropdown-wrapper").querySelector("input");let N=u.querySelector(".theme-name").innerHTML.toString();if(h.value=N,h.name==="colorTheme"){const L=s._themes.find(z=>z.label===N);s._selectedTheme=L,s._updateThemePreview(L)}u.closest(".dropdown-options").classList.remove("active")})});const r=X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=X.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",p=>{const h=p.currentTarget;let b=`${l.value}`.split(",")||[],L=b.indexOf(h.value);!p.currentTarget.checked&&L>-1?b.splice(L,1):p.currentTarget.checked&&L===-1&&b.push(h.value),l.value=b.join(","),f.log("checkbox changed",[b,l.value])})}),X.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(h=>{h.checked=u.currentTarget.checked;const N=new Event("change",{bubbles:!0});h.dispatchEvent(N)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};eo=new WeakMap,to=new WeakMap,Fe=new WeakSet,Go=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),r=De.find(l=>l.label===s.colorTheme);s.colorTheme=r?r.className:"",a.forEach(l=>{s[l]!==void 0&&(f.log("Saving setting:",[s[l]]),v.set(o[l].tag,s[l]))}),v.set(o.themeAndStylesMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oo=function(){X.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},xo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,r={};s.forEach(c=>{n[c]&&(n[c],r[c]=n[c].default)});const l=De.find(c=>c.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||De[0].label,a.forEach(c=>{c.value=r[c.name]})},T(X,Fe),T(X,eo),T(X,to,!1),E(X,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let qn=X;function ya(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Fn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:qn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:xn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:Un,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:Bn,restricted:!1},playersListMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-camera",propType:zn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Gn,restricted:!1}}}var Ye,ze,Dt,Pt,At,zt,Gt,Ot,xt,Ft,$e,Ut,Bt;const d=class d{static init(){const e=S();d.currSettings={enableFloatingDock:v.get(e.enableFloatingDock.tag),defaultVideoWidth:v.get(e.defaultVideoWidth.tag),dockHeight:v.get(e.dockHeight.tag),dockWidth:v.get(e.dockWidth.tag),dockPosX:v.get(e.dockPosX.tag),dockPosY:v.get(e.dockPosY.tag),dockResizeOnUserJoin:v.get(e.dockResizeOnUserJoin.tag)},Hooks.on("updateSetting",t=>{f.log("checkMinimizedState",[t]),t.key==="rtcClientSettings"&&t.namespace==="core"&&d.checkMinimizedState()}),Hooks.on(G.RENDER_CAMERA_VIEWS,(t,n,o)=>{setTimeout(()=>d.checkMinimizedState(),100)}),d.currSettings.enableFloatingDock?(d.positionIntervalId&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null),Hooks.on(G.RENDER_CAMERA_VIEWS,d.onRenderFloating),Hooks.on(G.WEBRTC_SETTINGS_CHANGED,d.resetPositionAndSize),Hooks.on(G.WEBRTC_USER_STATE_CHANGED,d.resetPositionAndSize),Hooks.on(G.UPDATE_USER,d.resetPositionAndSize),Hooks.on(G.RENDER_PLAYERS_LIST,d.resetPositionAndSize),Hooks.once(G.READY,()=>{d.onRenderFloating()}),f.log("CameraUtil settings",[d.currSettings])):(Hooks.on(G.RENDER_CAMERA_VIEWS,d.onRenderPlain),d.onRenderPlain())}static onRenderPlain(){d.cameraContainer.classList.add("visible")}static onRenderFloating(){S();const e=d.currSettings;if(d.cameraContainer=document.querySelector("#camera-views"),!d.cameraContainer)return;d.cameraContainer.classList.add("crlngn-ui"),f.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),d.checkMinimizedState();const t=game.settings.get("core","rtcClientSettings");(t==null?void 0:t.hideDock)!==!0&&(d.makeDraggable(),d.makeResizeable(),d.applyDockResize(e.dockResizeOnUserJoin),d.applyVideoWidth(),d.resetPositionAndSize(),d.applyPositionWithDelay())}static applyPositionWithDelay(){d.positionIntervalId&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null);let e=0;d.positionIntervalId=setInterval(()=>{d.resetPositionAndSize(),e++,e>=d.positionAttempts&&(clearInterval(d.positionIntervalId),d.positionIntervalId=null)},50)}static applyVideoWidth(e){const t=S(),n=v.get(t.defaultVideoWidth.tag);let o=e||n;if(o<En)o=En,v.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){d.currSettings.defaultVideoWidth=o;const a=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),s=document.querySelector("#camera-views.crlngn-ui");!a&&s?s.style.setProperty("--av-width",o+"px"):s&&s.style.removeProperty("--av-width"),d.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){S();const a=d.currSettings;if(!a.enableFloatingDock||!d.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){d.checkMinimizedState();return}if(d.cameraContainer.style.removeProperty("top"),f.log("CameraUtil",[a]),!e&&!t&&!n&&!o){const r=a.dockPosX||0,l=a.dockPosY||0;if(d.cameraContainer.style.transform=`translateX(${r}px)`,d.cameraContainer.style.bottom=`${l}px`,d.cameraContainer.style.removeProperty("left"),d.cameraContainer.style.removeProperty("top"),d.currSettings.dockResizeOnUserJoin===ge.off.name){const c=a.dockWidth||0,u=a.dockHeight||0;d.cameraContainer.style.width=`${c}px`,d.cameraContainer.style.height=`${u}px`}}else e!==null&&(d.cameraContainer.style.transform=`translateX(${e}px)`),t!==null&&(d.cameraContainer.style.bottom=`${t}px`),d.currSettings.dockResizeOnUserJoin===ge.horizontal.name?n!==null&&(d.cameraContainer.style.width=`${n}px`):d.currSettings.dockResizeOnUserJoin===ge.vertical.name&&o!==null&&(d.cameraContainer.style.height=`${o}px`),d.cameraContainer.style.removeProperty("left"),d.cameraContainer.style.removeProperty("top");d.cameraContainer.style.top="",d.cameraContainer.style.left=""}static applyDockResize(e){const t=S();d.cameraContainer&&(d.currSettings.dockResizeOnUserJoin=e,v.set(t.dockResizeOnUserJoin.tag,e),d.cameraContainer.classList.remove("horizontal","vertical"),e===ge.horizontal.name?d.cameraContainer.classList.add("horizontal"):e===ge.vertical.name&&d.cameraContainer.classList.add("vertical"),d.updateDockSize())}static makeDraggable(){var e,t;(e=d.cameraContainer)==null||e.addEventListener("mousedown",n=>{var c,u,p;const o=document.querySelector("#camera-views.minimized");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a==null||a.addEventListener("mousemove",C(d,Ot)),a==null||a.addEventListener("mouseup",C(d,xt)),o))return;const s=D.getOffsetBottom(d.cameraContainer),r=(u=d.cameraContainer)==null?void 0:u.style.transform;let l=0;if(r){const h=r.match(/translateX\(([-\d.]+)px\)/);h&&h[1]&&(l=parseInt(h[1]))}else l=((p=d.cameraContainer)==null?void 0:p.offsetLeft)||0;d.isDragging=!0,O(d,Ye,n.clientX-l),O(d,ze,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=d.cameraContainer)==null||t.addEventListener("touchstart",n=>{var u,p,h;const o=document.querySelector("#camera-views.minimized");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((u=n.target.parentNode)!=null&&u.classList.contains("volume-bar")||(a.addEventListener("touchmove",C(d,Ft)),a.addEventListener("touchend",C(d,$e)),a.addEventListener("touchcancel",C(d,$e)),o))return;const s=n.touches[0],r=D.getOffsetBottom(d.cameraContainer),l=(p=d.cameraContainer)==null?void 0:p.style.transform;let c=0;if(l){const N=l.match(/translateX\(([-\d.]+)px\)/);N&&N[1]&&(c=parseInt(N[1]))}else c=((h=d.cameraContainer)==null?void 0:h.offsetLeft)||0;d.isDragging=!0,O(d,Ye,s.clientX-c),O(d,ze,window.innerHeight-s.clientY-r),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var l,c;if(!d.cameraContainer)return;const e=S(),t=d.currSettings.dockResizeOnUserJoin,n=d.currSettings.defaultVideoWidth||En,a=(((c=(l=game.webrtc)==null?void 0:l.users)==null?void 0:c.filter(u=>u.active&&u.canBroadcastVideo))||[]).length;if(a===0)return;if(t===ge.horizontal.name){const u=n*a+16;d.cameraContainer.style.width=`${u}px`}else if(t===ge.vertical.name){const u=n*a+16;d.cameraContainer.style.height=`${u}px`}const s=parseInt(d.cameraContainer.style.width||0),r=parseInt(d.cameraContainer.style.height||0);s>0&&v.set(e.dockWidth.tag,s),r>0&&v.set(e.dockHeight.tag,r)}static applyDockResize(e){d.cameraContainer&&(d.currSettings.dockResizeOnUserJoin=e,d.cameraContainer.classList.remove("horizontal","vertical"),e===ge.horizontal.name?d.cameraContainer.classList.add("horizontal"):e===ge.vertical.name&&d.cameraContainer.classList.add("vertical"),d.updateDockSize())}static makeResizeable(){if(d.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=d.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),d.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),d.isResizing=!0,O(d,Dt,o.clientX),O(d,Pt,o.clientY),O(d,Gt,parseInt(getComputedStyle(d.cameraContainer).bottom)||0),O(d,At,d.cameraContainer.offsetWidth),O(d,zt,d.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",C(d,Ut)),e==null||e.addEventListener("mouseup",C(d,Bt))})}}static checkMinimizedState(){if(!d.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;f.log("Checking minimized state",[e,t]),d.handleMinimizedState(t),d.cameraContainer.style.removeProperty("top")}static handleMinimizedState(e){const t=document.querySelector("#interface #players #players-active"),n=d.cameraContainer.querySelector("button[data-action=toggleDock]");!t||!n||!d.cameraContainer||(e?d.cameraContainer.parentNode!==t&&(d.originalParent=d.cameraContainer.parentNode,d.originalNextSibling=d.cameraContainer.nextSibling,n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"),t.insertBefore(d.cameraContainer,t.firstChild),d.cameraContainer.style.transform="",d.cameraContainer.style.bottom="",d.cameraContainer.style.top="",d.cameraContainer.style.left="",d.cameraContainer.style.position="relative"):d.originalParent&&d.cameraContainer.parentNode===t&&(d.originalNextSibling?d.originalParent.insertBefore(d.cameraContainer,d.originalNextSibling):d.originalParent.appendChild(d.cameraContainer),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),d.cameraContainer.style.position="absolute",d.resetPositionAndSize(),d.makeDraggable(),d.makeResizeable(),f.log("Restored camera position from settings",[d.currSettings])))}};Ye=new WeakMap,ze=new WeakMap,Dt=new WeakMap,Pt=new WeakMap,At=new WeakMap,zt=new WeakMap,Gt=new WeakMap,Ot=new WeakMap,xt=new WeakMap,Ft=new WeakMap,$e=new WeakMap,Ut=new WeakMap,Bt=new WeakMap,T(d,Ye,0),T(d,ze,0),E(d,"isDragging",!1),E(d,"cameraContainer"),E(d,"isResizing",!1),T(d,Dt,0),T(d,Pt,0),T(d,At,0),T(d,zt,0),T(d,Gt,0),E(d,"currSettings",{}),E(d,"positionIntervalId",null),E(d,"positionAttempts",10),T(d,Ot,e=>{const t=document.querySelector("#camera-views.minimized");if(!(!d.isDragging||t)){if(f.log("mousemove",[window.innerHeight,e.clientY,C(d,ze)]),d.cameraContainer){let n=e.clientX-C(d,Ye),o=window.innerHeight-e.clientY-C(d,ze);d.cameraContainer.style.removeProperty("top"),n+d.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-d.cameraContainer.offsetWidth),n<0&&(n=0),d.cameraContainer.style.transform=`translateX(${n}px)`,o+d.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(d,xt,e=>{var a,s;const t=S(),n={...d.currSettings},o=document.querySelector("#camera-views.minimized");if(d.isDragging&&!o){const r=document.querySelector("body.crlngn-ui"),l=(a=d.cameraContainer)==null?void 0:a.style.transform;let c=0;if(l){const u=l.match(/translateX\(([\d.]+)px\)/);u&&u[1]&&(c=parseInt(u[1]))}n.dockPosX=c,n.dockPosY=parseInt((s=d.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),v.set(t.dockPosX.tag,n.dockPosX),v.set(t.dockPosY.tag,n.dockPosY),r==null||r.removeEventListener("mousemove",C(d,Ot)),r==null||r.removeEventListener("mouseup",C(d,xt)),d.isDragging=!1,e.stopPropagation()}}),T(d,Ft,e=>{if(!(!d.isDragging||!e.touches[0])){if(d.cameraContainer){const t=e.touches[0];let n=t.clientX-C(d,Ye),o=window.innerHeight-t.clientY-C(d,ze);d.cameraContainer.style.removeProperty("top"),n+d.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-d.cameraContainer.offsetWidth),n<0&&(n=0),d.cameraContainer.style.transform=`translateX(${n}px)`,o+d.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(d,$e,e=>{var o,a;const t=S(),n={...d.currSettings};if(d.isDragging){const s=document.querySelector("body.crlngn-ui"),r=(o=d.cameraContainer)==null?void 0:o.style.transform;let l=0;if(r){const c=r.match(/translateX\(([\d.]+)px\)/);c&&c[1]&&(l=parseInt(c[1]))}n.dockPosX=l,n.dockPosY=parseInt((a=d.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),v.set(t.dockPosX.tag,n.dockPosX),v.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",C(d,Ft)),s==null||s.removeEventListener("touchend",C(d,$e)),s==null||s.removeEventListener("touchcancel",C(d,$e)),d.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),T(d,Ut,e=>{if(!d.isResizing)return;const t=C(d,At)+(e.clientX-C(d,Dt)),n=e.clientY-C(d,Pt),o=C(d,zt)+n,a=C(d,Gt)-n;d.cameraContainer.style.width=`${t}px`,d.cameraContainer.style.height=`${o}px`,d.cameraContainer.style.bottom=`${a}px`}),T(d,Bt,()=>{var s,r,l,c,u,p,h;const e=S(),t={...d.currSettings},n=document.querySelector("body.crlngn-ui");d.isResizing=!1,n==null||n.removeEventListener("mousemove",C(d,Ut)),n==null||n.removeEventListener("mouseup",C(d,Bt)),f.log("onStopResize",[(s=d.cameraContainer)==null?void 0:s.style.width,(r=d.cameraContainer)==null?void 0:r.style.height,(l=d.cameraContainer)==null?void 0:l.style.bottom]),t.dockWidth=parseInt(((c=d.cameraContainer)==null?void 0:c.style.width)||0),t.dockHeight=parseInt(((u=d.cameraContainer)==null?void 0:u.style.height)||0),t.dockPosY=parseInt(((p=d.cameraContainer)==null?void 0:p.style.bottom)||0);const o=(h=d.cameraContainer)==null?void 0:h.style.transform;let a=0;if(o){const N=o.match(/translateX\(([\d.]+)px\)/);N&&N[1]&&(a=parseInt(N[1]))}t.dockPosX=a,v.set(e.dockWidth.tag,t.dockWidth),v.set(e.dockHeight.tag,t.dockHeight),v.set(e.dockPosY.tag,t.dockPosY),v.set(e.dockPosX.tag,t.dockPosX)});let Z=d;const Ce=class Ce{static init(){const e=S();Ce.enableChatStyles=v.get(e.enableChatStyles.tag),Ce.chatBorderColor=v.get(e.chatBorderColor.tag)}};E(Ce,"chatBorderColor"),E(Ce,"enableChatStyles"),E(Ce,"enrichCard",async(e,t)=>{var s,r,l,c,u,p,h,N;f.log("renderChatMessage",[Ce.chatBorderColor,Ce.enableChatStyles,st.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((h=(p=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:p.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(b=>{const L=b.querySelector(".visible-dc"),z=b.querySelector(".hidden-dc");f.log("enrichCard",[L,z]),L.setAttribute("data-ability",b.getAttribute("data-ability")||""),L.setAttribute("data-dc",b.getAttribute("data-dc")||""),z.setAttribute("data-ability",b.getAttribute("data-ability")||"")}),Ce.chatBorderColor===st.playerColor.name&&((N=e.author)!=null&&N.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let it=Ce;var no;const le=class le{static init(){Hooks.on(G.RENDER_PLAYERS_LIST,le.checkPlayersList),Hooks.on(G.RENDER_HOTBAR,le.checkPlayersList),D.isModuleOn("foundry-taskbar")&&Hooks.on(G.UPDATE_USER,le.checkTaskbarLock),le.checkTaskbarLock(),le.addModuleClasses(),D.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})}};no=new WeakMap,T(le,no),E(le,"addModuleClasses",()=>{const e=S(),t=v.get(e.otherModulesList.tag)||"",n=t.split(",");f.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),E(le,"checkTaskbarLock",()=>{var a,s,r;const e=D.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(f.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(s=t.taskbarSettings)!=null&&s.locked?D.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):D.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?D.addCSSVars("--crlngn-taskbar-height","50px"):D.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),le.checkPlayersList()}),E(le,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=D.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,n,a,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.minimized")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let Ke=le;class Ne{static init(){Hooks.on(G.RENDER_PLAYERS_LIST,Ne.onRender),Ne.applyPlayersListSettings(),f.log("PlayersList init")}static onRender(e,t,n){S(),Ne.applyPlayersListSettings(),Ne.applyAvatars()}static applyPlayersListSettings(){var t,n;const e=S();f.log("applyPlayersListSettings",[v.get(e.autoHidePlayerList.tag)]),v.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized"),Ke.checkPlayersList()}static applyAvatars(){const e=S();f.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];v.get(e.playerListAvatars.tag)?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const r=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),l=game.users.get(s.id),c=((p=l.character)==null?void 0:p.img)||"";f.log("player",[l]);const u=document.createElement("img");u.src=c||l.avatar||"",u.alt="*",u.classList.add("avatar"),r&&r.prepend(u)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const l=r.querySelector("img.avatar");l==null||l.remove()}),t==null||t.classList.remove("crlngn-avatars")),Ke.checkPlayersList()}}var nt,_,Xe,oo,Ht,ot,Je,qt,ao,Wt,fe,yn,Sn,bn,Vt,jt;const g=class g{static resetLocalVars(){O(g,nt,document.querySelector("#scene-navigation")),O(g,Ht,document.querySelector("#scene-navigation-expand")),O(g,ot,document.querySelector("#ui-left")),O(g,_,document.querySelector("#scene-navigation-inactive"))}static handleSceneList(e,t,n){g.useScenePreview&&(f.log("handleSceneList",[e,t,n]),t.querySelectorAll(".scene-navigation-menu li.scene").forEach(a=>{const s=a.dataset.sceneId,r=game.scenes.find(c=>c.id===s);f.log("sceneData",[r]);const l=document.createElement("span");l.classList.add("scene-preview"),l.style=`background-image: url('${r.thumbnail||""}')`,a.classList.add("nav-item"),a.append(l),g.useSceneIcons&&(a.classList.contains("active")||a.classList.contains("view"))&&a.classList.add("crlngn")}))}static handleBackButton(e,t,n){const o=S();if(f.log("handleBackButton",[e,t,n]),g.useNavBackButton===o.useNavBackButton.options.noButton)return;const a=t.querySelector("#scene-navigation-active"),s=document.createElement("button");s.classList.add("back-button"),s.innerHTML="<i class='fa fa-turn-left'></i>",s.addEventListener("click",C(g,yn)),a.prepend(s)}static handleFolderList(e,t,n){S(),g.navFoldersEnabled&&It.addFolderButtons(e,t,n)}static handleNavState(){S(),C(g,Wt)&&(O(g,Wt,!1),g.toggleNav(g.navStartCollapsed))}static toggleNav(e){clearTimeout(C(g,qt)),O(g,qt,setTimeout(()=>{g.resetLocalVars(),e===!0?f.log("toggleNav collapse",[e,g.navStartCollapsed]):e===!1&&(ui.nav.expand(),f.log("toggleNav expand",[e,g.navStartCollapsed]))},500))}static checkSceneNavCompat(){S(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=C(g,nt))==null||e.addEventListener("mouseenter",n=>{if(f.log("TopNavigation mouseenter",[g.isCollapsed,g.showNavOnHover]),!g.isCollapsed||!g.showNavOnHover)return;n.stopPropagation(),clearTimeout(C(g,Xe)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=C(g,nt))==null||t.addEventListener("mouseleave",n=>{f.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)&&(n.stopPropagation(),O(g,Xe,setTimeout(()=>{clearTimeout(C(g,Xe)),O(g,Xe,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static placeNavButtons(){var l;const e=document.querySelector("#scene-navigation"),t=e.querySelector("#scene-navigation-inactive"),n=e.querySelectorAll("button.crlngn-btn");if(!e||!t)return;const o=parseInt((l=n[0])==null?void 0:l.clientWidth)*2||0,a=t?t.clientWidth-o<t.scrollWidth:!1;if(f.log("isNavOverflowing",[a,t.clientWidth,o,t.scrollWidth]),!a)return;if(n.forEach(c=>c.remove()),typeof this.navButtonsTemplate=="function"){const c=this.navButtonsTemplate();e.insertAdjacentHTML("beforeend",c)}const s=e.querySelector("button.crlngn-btn.ui-nav-left"),r=e.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",C(this,Sn)),r&&r.addEventListener("click",C(this,bn))}static setNavPosition(e=null,t=!0,n=300){var o;try{const a=S();if(!C(g,_))return;const s=((o=C(g,_))==null?void 0:o.querySelectorAll("li.nav-item"))||[],r=0,l=e!==void 0?e:g.navPos||0;if(s.length===0||l>=s.length)return;const c=s[l],u=(c==null?void 0:c.offsetWidth)||0,p=parseInt(u)*l;if(typeof p!="number")return;const h=(p-r)*1;if(f.log("setNavPosition",["Calculated margin:",l,p,h]),g.navPos=l,v.set(a.sceneNavPos.tag,l),h>C(g,_).scrollWidth)return;t?D.smoothScrollTo(C(g,_),h,"horizontal",n):C(g,_).scrollTo({left:h,behavior:"instant"}),f.log("setNavPosition",["Complete"])}catch(a){f.log("setNavPosition",["Error:",a]),console.error("Error in setNavPosition:",a)}}};nt=new WeakMap,_=new WeakMap,Xe=new WeakMap,oo=new WeakMap,Ht=new WeakMap,ot=new WeakMap,Je=new WeakMap,qt=new WeakMap,ao=new WeakMap,Wt=new WeakMap,fe=new WeakMap,yn=new WeakMap,Sn=new WeakMap,bn=new WeakMap,Vt=new WeakMap,jt=new WeakMap,T(g,nt),T(g,_),T(g,Xe),T(g,oo),T(g,Ht),T(g,ot),E(g,"sceneFoldersTemplate"),E(g,"navButtonsTemplate"),T(g,Je),T(g,qt),T(g,ao),T(g,Wt,!0),T(g,fe,null),E(g,"sceneNavEnabled"),E(g,"navFoldersEnabled"),E(g,"navFoldersForPlayers"),E(g,"navShowRootFolders"),E(g,"navStartCollapsed"),E(g,"showFolderListOnClick"),E(g,"showNavOnHover"),E(g,"useSceneIcons"),E(g,"useScenePreview"),E(g,"useNavBackButton"),E(g,"sceneNavAlias",""),E(g,"sceneClickToView"),E(g,"isCollapsed"),E(g,"navPos"),E(g,"init",()=>{const e=S();g.checkSceneNavCompat(),g.preloadTemplates(),g.navStartCollapsed=v.get(e.navStartCollapsed.tag),g.showNavOnHover=v.get(e.showNavOnHover.tag),g.sceneNavEnabled=v.get(e.sceneNavEnabled.tag),g.useScenePreview=v.get(e.useScenePreview.tag),g.navFoldersEnabled=v.get(e.navFoldersEnabled.tag),g.navFoldersForPlayers=v.get(e.navFoldersForPlayers.tag),g.showFolderListOnClick=v.get(e.showFolderListOnClick.tag),It.init(),f.log("SCENE NAV INIT",[g.sceneNavEnabled]);const t=document.querySelector("#ui-left");if(g.sceneNavEnabled&&t)t.classList.add("crlngn-nav");else if(t){t.classList.remove("crlngn-nav");return}Hooks.on(G.RENDER_SCENE_NAV,(n,o,a)=>{const s=S();g.handleSceneList(n,o,a),g.handleBackButton(n,o,a),g.handleFolderList(n,o,a);const r=v.get(s.sceneNavPos.tag);g.resetLocalVars(),g.setNavPosition(r,!1),g.addListeners(),g.handleNavState(),g.addSceneListeners(o),g.navShowRootFolders&&It.renderFolderList(),clearTimeout(C(g,Je)),O(g,Je,setTimeout(()=>{f.log("NAV no transition remove"),g.placeNavButtons()},750))}),Hooks.on(G.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(G.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(G.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(G.COLLAPSE_SIDE_BAR,n=>{f.log(G.COLLAPSE_SIDE_BAR,[n]),n&&g.checkSideBar(n.expanded),g.placeNavButtons()}),Hooks.on(G.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(C(g,Je)),g.isCollapsed=o,O(g,Je,setTimeout(()=>{o?C(g,ot).classList.add("navigation-collapsed"):(C(g,ot).classList.remove("navigation-collapsed"),g.placeNavButtons())},250))}),Hooks.on(G.RENDER_SCENE_DIRECTORY,n=>{f.log(G.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var l,c;const r=game.scenes.get(s.dataset.entryId);if(f.log(G.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,g.sceneClickToView]),g.sceneClickToView&&(s.addEventListener("dblclick",C(g,Vt)),s.addEventListener("click",C(g,jt))),g.useSceneIcons&&r&&((l=game.user)!=null&&l.isGM)){let u=document.createElement("i");u.classList.add("fas"),u.classList.add("icon"),r.ownership.default!==0?(r.active&&(u.classList.add("fa-bullseye"),s.prepend(u)),((c=game.scenes.current)==null?void 0:c.id)===r.id&&(u.classList.add("fa-star"),s.prepend(u))):(u.classList.add("fa-eye-slash"),s.prepend(u))}})}),ui.sidebar&&g.checkSideBar(ui.sidebar.expanded),g.placeNavButtons()}),E(g,"checkSideBar",e=>{g.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),T(g,yn,e=>{e.stopPropagation(),e.preventDefault()}),T(g,Sn,async e=>{const t=await g.getItemsPerPage(),n=g.navPos||0;let o=n-(t-1);f.log("onNavLast",["pos",n,o]),o=o<0?0:o,g.setNavPosition(o)}),T(g,bn,async e=>{var s;const t=await g.getItemsPerPage(),n=((s=C(g,_))==null?void 0:s.querySelectorAll("li.nav-item"))||[],o=g.navPos||0;let a=o+(t-1);f.log("onNavNext",["pos",o,a,t]),a=a>n.length-t-1?n.length-t-1:a,g.setNavPosition(a)}),E(g,"getItemsPerPage",async()=>{var e,t,n;try{f.log("getItemsPerPage",["Starting"]),g.resetLocalVars();const o=0,a=0,s=((e=C(g,Ht))==null?void 0:e.offsetWidth)||0,r=(t=C(g,_))==null?void 0:t.querySelector("li:first-child");if(!r)return f.log("getItemsPerPage",[C(g,_),"No scene items found"]),0;const l=r.offsetWidth,c=(n=C(g,_))==null?void 0:n.clientWidth;if(!c)return f.log("getItemsPerPage",["Nav element has no width"]),0;const u=Math.floor((c-s*2)/l);return f.log("getItemsPerPage",["Calculated:",u,c,l]),u||0}catch(o){return f.log("getItemsPerPage",["Error:",o]),f.error("Error in getItemsPerPage:",o),0}}),E(g,"preloadTemplates",async()=>{try{const e=`modules/${ee}/templates/scene-nav-buttons.hbs`;return await loadTemplates([e]),g.navButtonsTemplate=Handlebars.compile(await fetch(e).then(t=>t.text())),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),E(g,"getCurrScenePosition",async e=>{try{if(!C(g,_)||!e)return 0;const t=await g.getItemsPerPage()||1,n=C(g,_).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(a===-1)return 0;const s=a>=g.navPos&&a<=g.navPos+t,r=s?g.navPos:a;return f.log("getCurrScenePosition",["Final position:",r,"isVisible:",s]),r}catch(t){return f.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),T(g,Vt,e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset,o=game.scenes.get(n.entryId||n.sceneId);f.log("#onActivateScene",[n,o]),o.activate(),C(g,fe)&&(clearTimeout(C(g,fe)),O(g,fe,null))}),T(g,jt,e=>{e.preventDefault(),e.stopPropagation();const n=e.currentTarget.dataset,o=game.scenes.get(n.entryId||n.sceneId);if(f.log("#onSelectScene",[o]),o&&o.sheet){const a=o.sheet.render;f.log("#onSelectScene - originalRender",[a]),o.sheet.render=function(){return this},setTimeout(()=>{o.sheet.render=a},300)}C(g,fe)&&(clearTimeout(C(g,fe)),O(g,fe,null)),O(g,fe,setTimeout(()=>{o.view(),O(g,fe,null)},500))}),E(g,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.addEventListener("click",C(g,jt)),n.addEventListener("dblclick",C(g,Vt))})});let B=g;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function fo(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(i,o).enumerable})),t.push.apply(t,n)}return t}function Te(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fo(Object(t),!0).forEach(function(n){Sa(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):fo(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function sn(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?sn=function(e){return typeof e}:sn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(i)}function Sa(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function we(){return we=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},we.apply(this,arguments)}function ba(i,e){if(i==null)return{};var t={},n=Object.keys(i),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=i[o]);return t}function va(i,e){if(i==null)return{};var t=ba(i,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}var Ca="1.15.6";function Ie(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var ke=Ie(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Kt=Ie(/Edge/i),po=Ie(/firefox/i),Ct=Ie(/safari/i)&&!Ie(/chrome/i)&&!Ie(/android/i),so=Ie(/iP(ad|od|hone)/i),Fo=Ie(/chrome/i)&&Ie(/android/i),Uo={capture:!1,passive:!1};function A(i,e,t){i.addEventListener(e,t,!ke&&Uo)}function P(i,e,t){i.removeEventListener(e,t,!ke&&Uo)}function un(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch{return!1}return!1}}function Bo(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function pe(i,e,t,n){if(i){t=t||document;do{if(e!=null&&(e[0]===">"?i.parentNode===t&&un(i,e):un(i,e))||n&&i===t)return i;if(i===t)break}while(i=Bo(i))}return null}var ho=/\s+/g;function ie(i,e,t){if(i&&e)if(i.classList)i.classList[t?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(ho," ").replace(" "+e+" "," ");i.className=(n+(t?" "+e:"")).replace(ho," ")}}function w(i,e,t){var n=i&&i.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function tt(i,e){var t="";if(typeof i=="string")t=i;else do{var n=w(i,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(i=i.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Ho(i,e,t){if(i){var n=i.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Ee(){var i=document.scrollingElement;return i||document.documentElement}function Y(i,e,t,n,o){if(!(!i.getBoundingClientRect&&i!==window)){var a,s,r,l,c,u,p;if(i!==window&&i.parentNode&&i!==Ee()?(a=i.getBoundingClientRect(),s=a.top,r=a.left,l=a.bottom,c=a.right,u=a.height,p=a.width):(s=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,p=window.innerWidth),(e||t)&&i!==window&&(o=o||i.parentNode,!ke))do if(o&&o.getBoundingClientRect&&(w(o,"transform")!=="none"||t&&w(o,"position")!=="static")){var h=o.getBoundingClientRect();s-=h.top+parseInt(w(o,"border-top-width")),r-=h.left+parseInt(w(o,"border-left-width")),l=s+a.height,c=r+a.width;break}while(o=o.parentNode);if(n&&i!==window){var N=tt(o||i),b=N&&N.a,L=N&&N.d;N&&(s/=L,r/=b,p/=b,u/=L,l=s+u,c=r+p)}return{top:s,left:r,bottom:l,right:c,width:p,height:u}}}function mo(i,e,t){for(var n=Oe(i,!0),o=Y(i)[e];n;){var a=Y(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Ee())break;n=Oe(n,!1)}return!1}function rt(i,e,t,n){for(var o=0,a=0,s=i.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==R.ghost&&(n||s[a]!==R.dragged)&&pe(s[a],t.draggable,i,!1)){if(o===e)return s[a];o++}a++}return null}function io(i,e){for(var t=i.lastElementChild;t&&(t===R.ghost||w(t,"display")==="none"||e&&!un(t,e));)t=t.previousElementSibling;return t||null}function ce(i,e){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==R.clone&&(!e||un(i,e))&&t++;return t}function yo(i){var e=0,t=0,n=Ee();if(i)do{var o=tt(i),a=o.a,s=o.d;e+=i.scrollLeft*a,t+=i.scrollTop*s}while(i!==n&&(i=i.parentNode));return[e,t]}function Na(i,e){for(var t in i)if(i.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[t][n])return Number(t)}return-1}function Oe(i,e){if(!i||!i.getBoundingClientRect)return Ee();var t=i,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=w(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ee();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ee()}function Ea(i,e){if(i&&e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function Tn(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var Nt;function qo(i,e){return function(){if(!Nt){var t=arguments,n=this;t.length===1?i.call(n,t[0]):i.apply(n,t),Nt=setTimeout(function(){Nt=void 0},e)}}}function Ta(){clearTimeout(Nt),Nt=void 0}function Wo(i,e,t){i.scrollLeft+=e,i.scrollTop+=t}function Vo(i){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function jo(i,e,t){var n={};return Array.from(i.children).forEach(function(o){var a,s,r,l;if(!(!pe(o,e.draggable,i,!1)||o.animated||o===t)){var c=Y(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var oe="Sortable"+new Date().getTime();function La(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(w(o,"display")==="none"||o===R.ghost)){i.push({target:o,rect:Y(o)});var a=Te({},i[i.length-1].rect);if(o.thisAnimationDuration){var s=tt(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(Na(i,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;i.forEach(function(r){var l=0,c=r.target,u=c.fromRect,p=Y(c),h=c.prevFromRect,N=c.prevToRect,b=r.rect,L=tt(c,!0);L&&(p.top-=L.f,p.left-=L.e),c.toRect=p,c.thisAnimationDuration&&Tn(h,p)&&!Tn(u,p)&&(b.top-p.top)/(b.left-p.left)===(u.top-p.top)/(u.left-p.left)&&(l=wa(b,h,N,o.options)),Tn(p,u)||(c.prevFromRect=u,c.prevToRect=p,l||(l=o.options.animation),o.animate(c,b,p,l)),l&&(a=!0,s=Math.max(s,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),i=[]},animate:function(n,o,a,s){if(s){w(n,"transition",""),w(n,"transform","");var r=tt(this.el),l=r&&r.a,c=r&&r.d,u=(o.left-a.left)/(l||1),p=(o.top-a.top)/(c||1);n.animatingX=!!u,n.animatingY=!!p,w(n,"transform","translate3d("+u+"px,"+p+"px,0)"),this.forRepaintDummy=Ia(n),w(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),w(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){w(n,"transition",""),w(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function Ia(i){return i.offsetWidth}function wa(i,e,t,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var Ze=[],Ln={initializeByDefault:!0},Zt={mount:function(e){for(var t in Ln)Ln.hasOwnProperty(t)&&!(t in e)&&(e[t]=Ln[t]);Ze.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Ze.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";Ze.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Te({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Te({sortable:t},n)))})},initializePlugins:function(e,t,n,o){Ze.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,we(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return Ze.forEach(function(o){typeof o.eventProperties=="function"&&we(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return Ze.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function ka(i){var e=i.sortable,t=i.rootEl,n=i.name,o=i.targetEl,a=i.cloneEl,s=i.toEl,r=i.fromEl,l=i.oldIndex,c=i.newIndex,u=i.oldDraggableIndex,p=i.newDraggableIndex,h=i.originalEvent,N=i.putSortable,b=i.extraEventProperties;if(e=e||t&&t[oe],!!e){var L,z=e.options,x="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!ke&&!Kt?L=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(L=document.createEvent("Event"),L.initEvent(n,!0,!0)),L.to=s||t,L.from=r||t,L.item=o||t,L.clone=a,L.oldIndex=l,L.newIndex=c,L.oldDraggableIndex=u,L.newDraggableIndex=p,L.originalEvent=h,L.pullMode=N?N.lastPutMode:void 0;var $=Te(Te({},b),Zt.getEventProperties(n,e));for(var de in $)L[de]=$[de];t&&t.dispatchEvent(L),z[x]&&z[x].call(e,L)}}var Ra=["evt"],te=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=va(n,Ra);Zt.pluginEvent.bind(R)(e,t,Te({dragEl:y,parentEl:q,ghostEl:M,rootEl:F,nextEl:Ve,lastDownEl:rn,cloneEl:H,cloneHidden:Ae,dragStarted:St,putSortable:J,activeSortable:R.active,originalEvent:o,oldIndex:et,oldDraggableIndex:Et,newIndex:re,newDraggableIndex:Pe,hideGhostForTarget:Jo,unhideGhostForTarget:Ko,cloneNowHidden:function(){Ae=!0},cloneNowShown:function(){Ae=!1},dispatchSortableEvent:function(r){Q({sortable:t,name:r,originalEvent:o})}},a))};function Q(i){ka(Te({putSortable:J,cloneEl:H,targetEl:y,rootEl:F,oldIndex:et,oldDraggableIndex:Et,newIndex:re,newDraggableIndex:Pe},i))}var y,q,M,F,Ve,rn,H,Ae,et,re,Et,Pe,en,J,_e=!1,gn=!1,fn=[],qe,ue,In,wn,So,bo,St,Qe,Tt,Lt=!1,tn=!1,ln,K,kn=[],Wn=!1,pn=[],Cn=typeof document<"u",nn=so,vo=Kt||ke?"cssFloat":"float",Ma=Cn&&!Fo&&!so&&"draggable"in document.createElement("div"),Yo=function(){if(Cn){if(ke)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),$o=function(e,t){var n=w(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=rt(e,0,t),s=rt(e,1,t),r=a&&w(a),l=s&&w(s),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Y(a).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Y(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&r.float!=="none"){var p=r.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return a&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[vo]==="none"||s&&n[vo]==="none"&&c+u>o)?"vertical":"horizontal"},Da=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||a===l||o+s/2===r+c/2},Pa=function(e,t){var n;return fn.some(function(o){var a=o[oe].options.emptyInsertThreshold;if(!(!a||io(o))){var s=Y(o),r=e>=s.left-a&&e<=s.right+a,l=t>=s.top-a&&t<=s.bottom+a;if(r&&l)return n=o}}),n},Xo=function(e){function t(a,s){return function(r,l,c,u){var p=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(r,l,c,u),s)(r,l,c,u);var h=(s?r:l).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},o=e.group;(!o||sn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Jo=function(){!Yo&&M&&w(M,"display","none")},Ko=function(){!Yo&&M&&w(M,"display","")};Cn&&!Fo&&document.addEventListener("click",function(i){if(gn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),gn=!1,!1},!0);var We=function(e){if(y){e=e.touches?e.touches[0]:e;var t=Pa(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[oe]._onDragOver(n)}}},Aa=function(e){y&&y.parentNode[oe]._isOutsideThisEl(e.target)};function R(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=we({},e),i[oe]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return $o(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,r){s.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:R.supportPointer!==!1&&"PointerEvent"in window&&(!Ct||so),emptyInsertThreshold:5};Zt.initializePlugins(this,i,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Xo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Ma,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?A(i,"pointerdown",this._onTapStart):(A(i,"mousedown",this._onTapStart),A(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(A(i,"dragover",this),A(i,"dragenter",this)),fn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),we(this,La())}R.prototype={constructor:R,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Qe=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,y):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(Ha(n),!y&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Ct&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=pe(l,o.draggable,n,!1),!(l&&l.animated)&&rn!==l)){if(et=ce(l),Et=ce(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){Q({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),te("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(p){if(p=pe(c,p.trim(),n,!1),p)return Q({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),te("filter",t,{evt:e}),!0}),u)){a&&e.preventDefault();return}o.handle&&!pe(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,r=a.ownerDocument,l;if(n&&!y&&n.parentNode===a){var c=Y(n);if(F=a,y=n,q=y.parentNode,Ve=y.nextSibling,rn=n,en=s.group,R.dragged=y,qe={target:y,clientX:(t||e).clientX,clientY:(t||e).clientY},So=qe.clientX-c.left,bo=qe.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,y.style["will-change"]="all",l=function(){if(te("delayEnded",o,{evt:e}),R.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!po&&o.nativeDraggable&&(y.draggable=!0),o._triggerDragStart(e,t),Q({sortable:o,name:"choose",originalEvent:e}),ie(y,s.chosenClass,!0)},s.ignore.split(",").forEach(function(u){Ho(y,u.trim(),Rn)}),A(r,"dragover",We),A(r,"mousemove",We),A(r,"touchmove",We),s.supportPointer?(A(r,"pointerup",o._onDrop),!this.nativeDraggable&&A(r,"pointercancel",o._onDrop)):(A(r,"mouseup",o._onDrop),A(r,"touchend",o._onDrop),A(r,"touchcancel",o._onDrop)),po&&this.nativeDraggable&&(this.options.touchStartThreshold=4,y.draggable=!0),te("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Kt||ke))){if(R.eventCanceled){this._onDrop();return}s.supportPointer?(A(r,"pointerup",o._disableDelayedDrag),A(r,"pointercancel",o._disableDelayedDrag)):(A(r,"mouseup",o._disableDelayedDrag),A(r,"touchend",o._disableDelayedDrag),A(r,"touchcancel",o._disableDelayedDrag)),A(r,"mousemove",o._delayedDragTouchMoveHandler),A(r,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&A(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,s.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){y&&Rn(y),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._disableDelayedDrag),P(e,"touchend",this._disableDelayedDrag),P(e,"touchcancel",this._disableDelayedDrag),P(e,"pointerup",this._disableDelayedDrag),P(e,"pointercancel",this._disableDelayedDrag),P(e,"mousemove",this._delayedDragTouchMoveHandler),P(e,"touchmove",this._delayedDragTouchMoveHandler),P(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?A(document,"pointermove",this._onTouchMove):t?A(document,"touchmove",this._onTouchMove):A(document,"mousemove",this._onTouchMove):(A(y,"dragend",this),A(F,"dragstart",this._onDragStart));try{document.selection?cn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(_e=!1,F&&y){te("dragStarted",this,{evt:t}),this.nativeDraggable&&A(document,"dragover",Aa);var n=this.options;!e&&ie(y,n.dragClass,!1),ie(y,n.ghostClass,!0),R.active=this,e&&this._appendGhost(),Q({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ue){this._lastX=ue.clientX,this._lastY=ue.clientY,Jo();for(var e=document.elementFromPoint(ue.clientX,ue.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ue.clientX,ue.clientY),e!==t);)t=e;if(y.parentNode[oe]._isOutsideThisEl(e),t)do{if(t[oe]){var n=void 0;if(n=t[oe]._onDragOver({clientX:ue.clientX,clientY:ue.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Bo(t));Ko()}},_onTouchMove:function(e){if(qe){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=M&&tt(M,!0),r=M&&s&&s.a,l=M&&s&&s.d,c=nn&&K&&yo(K),u=(a.clientX-qe.clientX+o.x)/(r||1)+(c?c[0]-kn[0]:0)/(r||1),p=(a.clientY-qe.clientY+o.y)/(l||1)+(c?c[1]-kn[1]:0)/(l||1);if(!R.active&&!_e){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(M){s?(s.e+=u-(In||0),s.f+=p-(wn||0)):s={a:1,b:0,c:0,d:1,e:u,f:p};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");w(M,"webkitTransform",h),w(M,"mozTransform",h),w(M,"msTransform",h),w(M,"transform",h),In=u,wn=p,ue=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!M){var e=this.options.fallbackOnBody?document.body:F,t=Y(y,!0,nn,!0,e),n=this.options;if(nn){for(K=e;w(K,"position")==="static"&&w(K,"transform")==="none"&&K!==document;)K=K.parentNode;K!==document.body&&K!==document.documentElement?(K===document&&(K=Ee()),t.top+=K.scrollTop,t.left+=K.scrollLeft):K=Ee(),kn=yo(K)}M=y.cloneNode(!0),ie(M,n.ghostClass,!1),ie(M,n.fallbackClass,!0),ie(M,n.dragClass,!0),w(M,"transition",""),w(M,"transform",""),w(M,"box-sizing","border-box"),w(M,"margin",0),w(M,"top",t.top),w(M,"left",t.left),w(M,"width",t.width),w(M,"height",t.height),w(M,"opacity","0.8"),w(M,"position",nn?"absolute":"fixed"),w(M,"zIndex","100000"),w(M,"pointerEvents","none"),R.ghost=M,e.appendChild(M),w(M,"transform-origin",So/parseInt(M.style.width)*100+"% "+bo/parseInt(M.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(te("dragStart",this,{evt:e}),R.eventCanceled){this._onDrop();return}te("setupClone",this),R.eventCanceled||(H=Vo(y),H.removeAttribute("id"),H.draggable=!1,H.style["will-change"]="",this._hideClone(),ie(H,this.options.chosenClass,!1),R.clone=H),n.cloneId=cn(function(){te("clone",n),!R.eventCanceled&&(n.options.removeCloneOnHide||F.insertBefore(H,y),n._hideClone(),Q({sortable:n,name:"clone"}))}),!t&&ie(y,a.dragClass,!0),t?(gn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(P(document,"mouseup",n._onDrop),P(document,"touchend",n._onDrop),P(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,y)),A(document,"drop",n),w(y,"transform","translateZ(0)")),_e=!0,n._dragStartId=cn(n._dragStarted.bind(n,t,e)),A(document,"selectstart",n),St=!0,window.getSelection().removeAllRanges(),Ct&&w(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,r=this.options,l=r.group,c=R.active,u=en===l,p=r.sort,h=J||c,N,b=this,L=!1;if(Wn)return;function z(yt,_o){te(yt,b,Te({evt:e,isOwner:u,axis:N?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:h,target:n,completed:$,onMove:function(co,ea){return on(F,t,y,o,co,Y(co),e,ea)},changed:de},_o))}function x(){z("dragOverAnimationCapture"),b.captureAnimationState(),b!==h&&h.captureAnimationState()}function $(yt){return z("dragOverCompleted",{insertion:yt}),yt&&(u?c._hideClone():c._showClone(b),b!==h&&(ie(y,J?J.options.ghostClass:c.options.ghostClass,!1),ie(y,r.ghostClass,!0)),J!==b&&b!==R.active?J=b:b===R.active&&J&&(J=null),h===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){z("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===y&&!y.animated||n===t&&!n.animated)&&(Qe=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(y.parentNode[oe]._isOutsideThisEl(e.target),!yt&&We(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),L=!0}function de(){re=ce(y),Pe=ce(y,r.draggable),Q({sortable:b,name:"change",toEl:t,newIndex:re,newDraggableIndex:Pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=pe(n,r.draggable,t,!0),z("dragOver"),R.eventCanceled)return L;if(y.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return $(!1);if(gn=!1,c&&!r.disabled&&(u?p||(s=q!==F):J===this||(this.lastPutMode=en.checkPull(this,c,y,e))&&l.checkPut(this,c,y,e))){if(N=this._getDirection(e,n)==="vertical",o=Y(y),z("dragOverValid"),R.eventCanceled)return L;if(s)return q=F,x(),this._hideClone(),z("revert"),R.eventCanceled||(Ve?F.insertBefore(y,Ve):F.appendChild(y)),$(!0);var ae=io(t,r.draggable);if(!ae||xa(e,N,this)&&!ae.animated){if(ae===y)return $(!1);if(ae&&t===e.target&&(n=ae),n&&(a=Y(n)),on(F,t,y,o,n,a,e,!!n)!==!1)return x(),ae&&ae.nextSibling?t.insertBefore(y,ae.nextSibling):t.appendChild(y),q=t,de(),$(!0)}else if(ae&&Oa(e,N,this)){var Ue=rt(t,0,r,!0);if(Ue===y)return $(!1);if(n=Ue,a=Y(n),on(F,t,y,o,n,a,e,!1)!==!1)return x(),t.insertBefore(y,Ue),q=t,de(),$(!0)}else if(n.parentNode===t){a=Y(n);var he=0,Be,ft=y.parentNode!==t,se=!Da(y.animated&&y.toRect||o,n.animated&&n.toRect||a,N),pt=N?"top":"left",Re=mo(n,"top","top")||mo(y,"top","top"),ht=Re?Re.scrollTop:void 0;Qe!==n&&(Be=a[pt],Lt=!1,tn=!se&&r.invertSwap||ft),he=Fa(e,n,a,N,se?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,tn,Qe===n);var Le;if(he!==0){var He=ce(y);do He-=he,Le=q.children[He];while(Le&&(w(Le,"display")==="none"||Le===M))}if(he===0||Le===n)return $(!1);Qe=n,Tt=he;var mt=n.nextElementSibling,Me=!1;Me=he===1;var Qt=on(F,t,y,o,n,a,e,Me);if(Qt!==!1)return(Qt===1||Qt===-1)&&(Me=Qt===1),Wn=!0,setTimeout(Ga,30),x(),Me&&!mt?t.appendChild(y):n.parentNode.insertBefore(y,Me?mt:n),Re&&Wo(Re,0,ht-Re.scrollTop),q=y.parentNode,Be!==void 0&&!tn&&(ln=Math.abs(Be-Y(n)[pt])),de(),$(!0)}if(t.contains(y))return $(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){P(document,"mousemove",this._onTouchMove),P(document,"touchmove",this._onTouchMove),P(document,"pointermove",this._onTouchMove),P(document,"dragover",We),P(document,"mousemove",We),P(document,"touchmove",We)},_offUpEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._onDrop),P(e,"touchend",this._onDrop),P(e,"pointerup",this._onDrop),P(e,"pointercancel",this._onDrop),P(e,"touchcancel",this._onDrop),P(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(re=ce(y),Pe=ce(y,n.draggable),te("drop",this,{evt:e}),q=y&&y.parentNode,re=ce(y),Pe=ce(y,n.draggable),R.eventCanceled){this._nulling();return}_e=!1,tn=!1,Lt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Vn(this.cloneId),Vn(this._dragStartId),this.nativeDraggable&&(P(document,"drop",this),P(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ct&&w(document.body,"user-select",""),w(y,"transform",""),e&&(St&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),M&&M.parentNode&&M.parentNode.removeChild(M),(F===q||J&&J.lastPutMode!=="clone")&&H&&H.parentNode&&H.parentNode.removeChild(H),y&&(this.nativeDraggable&&P(y,"dragend",this),Rn(y),y.style["will-change"]="",St&&!_e&&ie(y,J?J.options.ghostClass:this.options.ghostClass,!1),ie(y,this.options.chosenClass,!1),Q({sortable:this,name:"unchoose",toEl:q,newIndex:null,newDraggableIndex:null,originalEvent:e}),F!==q?(re>=0&&(Q({rootEl:q,name:"add",toEl:q,fromEl:F,originalEvent:e}),Q({sortable:this,name:"remove",toEl:q,originalEvent:e}),Q({rootEl:q,name:"sort",toEl:q,fromEl:F,originalEvent:e}),Q({sortable:this,name:"sort",toEl:q,originalEvent:e})),J&&J.save()):re!==et&&re>=0&&(Q({sortable:this,name:"update",toEl:q,originalEvent:e}),Q({sortable:this,name:"sort",toEl:q,originalEvent:e})),R.active&&((re==null||re===-1)&&(re=et,Pe=Et),Q({sortable:this,name:"end",toEl:q,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){te("nulling",this),F=y=q=M=Ve=H=rn=Ae=qe=ue=St=re=Pe=et=Et=Qe=Tt=J=en=R.dragged=R.ghost=R.clone=R.active=null,pn.forEach(function(e){e.checked=!0}),pn.length=In=wn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":y&&(this._onDragOver(e),za(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],pe(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Ba(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var r=o.children[s];pe(r,this.options.draggable,o,!1)&&(n[a]=r)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return pe(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=Zt.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Xo(n)},destroy:function(){te("destroy",this);var e=this.el;e[oe]=null,P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart),P(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),fn.splice(fn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ae){if(te("hideClone",this),R.eventCanceled)return;w(H,"display","none"),this.options.removeCloneOnHide&&H.parentNode&&H.parentNode.removeChild(H),Ae=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ae){if(te("showClone",this),R.eventCanceled)return;y.parentNode==F&&!this.options.group.revertClone?F.insertBefore(H,y):Ve?F.insertBefore(H,Ve):F.appendChild(H),this.options.group.revertClone&&this.animate(y,H),w(H,"display",""),Ae=!1}}};function za(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function on(i,e,t,n,o,a,s,r){var l,c=i[oe],u=c.options.onMove,p;return window.CustomEvent&&!ke&&!Kt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=i,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=a||Y(e),l.willInsertAfter=r,l.originalEvent=s,i.dispatchEvent(l),u&&(p=u.call(c,l,s)),p}function Rn(i){i.draggable=!1}function Ga(){Wn=!1}function Oa(i,e,t){var n=Y(rt(t.el,0,t.options,!0)),o=jo(t.el,t.options,M),a=10;return e?i.clientX<o.left-a||i.clientY<n.top&&i.clientX<n.right:i.clientY<o.top-a||i.clientY<n.bottom&&i.clientX<n.left}function xa(i,e,t){var n=Y(io(t.el,t.options.draggable)),o=jo(t.el,t.options,M),a=10;return e?i.clientX>o.right+a||i.clientY>n.bottom&&i.clientX>n.left:i.clientY>o.bottom+a||i.clientX>n.right&&i.clientY>n.top}function Fa(i,e,t,n,o,a,s,r){var l=n?i.clientY:i.clientX,c=n?t.height:t.width,u=n?t.top:t.left,p=n?t.bottom:t.right,h=!1;if(!s){if(r&&ln<c*o){if(!Lt&&(Tt===1?l>u+c*a/2:l<p-c*a/2)&&(Lt=!0),Lt)h=!0;else if(Tt===1?l<u+ln:l>p-ln)return-Tt}else if(l>u+c*(1-o)/2&&l<p-c*(1-o)/2)return Ua(e)}return h=h||s,h&&(l<u+c*a/2||l>p-c*a/2)?l>u+c/2?1:-1:0}function Ua(i){return ce(y)<ce(i)?1:-1}function Ba(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Ha(i){pn.length=0;for(var e=i.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&pn.push(n)}}function cn(i){return setTimeout(i,0)}function Vn(i){return clearTimeout(i)}Cn&&A(document,"touchmove",function(i){(R.active||_e)&&i.cancelable&&i.preventDefault()});R.utils={on:A,off:P,css:w,find:Ho,is:function(e,t){return!!pe(e,t,e,!1)},extend:Ea,throttle:qo,closest:pe,toggleClass:ie,clone:Vo,index:ce,nextTick:cn,cancelNextTick:Vn,detectDirection:$o,getChild:rt,expando:oe};R.get=function(i){return i[oe]};R.mount=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(R.utils=Te(Te({},R.utils),n.utils)),Zt.mount(n)})};R.create=function(i,e){return new R(i,e)};R.version=Ca;var j=[],bt,jn,Yn=!1,Mn,Dn,hn,vt;function qa(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?A(document,"dragover",this._handleAutoScroll):this.options.supportPointer?A(document,"pointermove",this._handleFallbackAutoScroll):n.touches?A(document,"touchmove",this._handleFallbackAutoScroll):A(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):(P(document,"pointermove",this._handleFallbackAutoScroll),P(document,"touchmove",this._handleFallbackAutoScroll),P(document,"mousemove",this._handleFallbackAutoScroll)),Co(),dn(),Ta()},nulling:function(){hn=jn=bt=Yn=vt=Mn=Dn=null,j.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(a,s);if(hn=t,n||this.options.forceAutoScrollFallback||Kt||ke||Ct){Pn(t,this.options,r,n);var l=Oe(r,!0);Yn&&(!vt||a!==Mn||s!==Dn)&&(vt&&Co(),vt=setInterval(function(){var c=Oe(document.elementFromPoint(a,s),!0);c!==l&&(l=c,dn()),Pn(t,o.options,c,n)},10),Mn=a,Dn=s)}else{if(!this.options.bubbleScroll||Oe(r,!0)===Ee()){dn();return}Pn(t,this.options,Oe(r,!1),!1)}}},we(i,{pluginName:"scroll",initializeByDefault:!0})}function dn(){j.forEach(function(i){clearInterval(i.pid)}),j=[]}function Co(){clearInterval(vt)}var Pn=qo(function(i,e,t,n){if(e.scroll){var o=(i.touches?i.touches[0]:i).clientX,a=(i.touches?i.touches[0]:i).clientY,s=e.scrollSensitivity,r=e.scrollSpeed,l=Ee(),c=!1,u;jn!==t&&(jn=t,dn(),bt=e.scroll,u=e.scrollFn,bt===!0&&(bt=Oe(t,!0)));var p=0,h=bt;do{var N=h,b=Y(N),L=b.top,z=b.bottom,x=b.left,$=b.right,de=b.width,ae=b.height,Ue=void 0,he=void 0,Be=N.scrollWidth,ft=N.scrollHeight,se=w(N),pt=N.scrollLeft,Re=N.scrollTop;N===l?(Ue=de<Be&&(se.overflowX==="auto"||se.overflowX==="scroll"||se.overflowX==="visible"),he=ae<ft&&(se.overflowY==="auto"||se.overflowY==="scroll"||se.overflowY==="visible")):(Ue=de<Be&&(se.overflowX==="auto"||se.overflowX==="scroll"),he=ae<ft&&(se.overflowY==="auto"||se.overflowY==="scroll"));var ht=Ue&&(Math.abs($-o)<=s&&pt+de<Be)-(Math.abs(x-o)<=s&&!!pt),Le=he&&(Math.abs(z-a)<=s&&Re+ae<ft)-(Math.abs(L-a)<=s&&!!Re);if(!j[p])for(var He=0;He<=p;He++)j[He]||(j[He]={});(j[p].vx!=ht||j[p].vy!=Le||j[p].el!==N)&&(j[p].el=N,j[p].vx=ht,j[p].vy=Le,clearInterval(j[p].pid),(ht!=0||Le!=0)&&(c=!0,j[p].pid=setInterval((function(){n&&this.layer===0&&R.active._onTouchMove(hn);var mt=j[this.layer].vy?j[this.layer].vy*r:0,Me=j[this.layer].vx?j[this.layer].vx*r:0;typeof u=="function"&&u.call(R.dragged.parentNode[oe],Me,mt,i,hn,j[this.layer].el)!=="continue"||Wo(j[this.layer].el,Me,mt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&h!==l&&(h=Oe(h,!1)));Yn=c}},30),Zo=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||a;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function ro(){}ro.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=rt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Zo};we(ro,{pluginName:"revertOnSpill"});function lo(){}lo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Zo};we(lo,{pluginName:"removeOnSpill"});R.mount(new qa);R.mount(lo,ro);const an="root";var Yt,$t;const U=class U{static init(){U.noFolderView()||!ui.scenes||(U.preloadTemplates(),U.folderListData=U.getFolders(ui.scenes.folders),U.selectedFolder=U.selectFolder(an))}static addFolderButtons(e,t,n){const o=S(),a=t.querySelector("#scene-navigation-active"),s=a.querySelector("li.scene:first-of-type"),r=document.createElement("div"),l=document.createElement("div");r.id="folder-lookup",r.dataset.tooltip="Search Scenes",r.innerHTML="<button class='folder-expand'><i class='fa-solid fa-magnifying-glass'></i></button>",l.id="folder-toggle",l.dataset.tooltip=B.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",l.innerHTML="<i class='fa-solid icon'></i>",B.navShowRootFolders?a.classList.add("with-folders"):a.classList.remove("with-folders"),r.addEventListener("click",U.toggleFolderLookup),l.addEventListener("click",()=>{B.setNavPosition(0),v.set(o.navShowRootFolders.tag,!B.navShowRootFolders)}),a.insertBefore(r,s),a.append(l)}static toggleFolderLookup(e){}static buildTemplateData(e){if(!e||!ui.scenes)return{};let t={},n=[],o=e.contents?[...e.contents]:[];return o=o.filter(a=>a.permission>=2),O(U,Yt,game.scenes.sortingMode),e.id===an?n=ui.scenes.collection.folders.filter(a=>a.folder===null)||[]:n=e.children,n=U.sortFolderList(n),t={currentFolder:e,folders:n,scenes:o},f.log("buildFolderData",[n,t]),t}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),C(U,Yt)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Yt=new WeakMap,$t=new WeakMap,E(U,"selectedFolder",an),T(U,Yt,"a"),E(U,"renderFolderList",async e=>{let t;const n=e?game.scenes.get(parentFolder.dataset.sceneId):{name:"",id:an},o=U.buildTemplateData(n),a=await renderTemplate(`modules/${ee}/templates/scene-nav-folder-list.hbs`,o);f.log("renderedHtml",[a]),e?t=e.parentNode():t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",a),t.querySelectorAll("li.folder").forEach(r=>{r.querySelector(".folder-item").addEventListener("click",C(U,$t))})}),T(U,$t,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.offsetLeft;t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active").forEach(h=>{h!==t&&h.classList.remove("crlngn-folder-active")});const a=t.dataset.folderId,s=ui.scenes.collection.folders,r=a?s.get(a):null;if(f.log("#onNavFolderClick",[a]),!r)return;const l=U.buildTemplateData(r),c=await renderTemplate(`modules/${ee}/templates/scene-nav-subfolders.hbs`,l),u=t.parentNode.querySelector(".contents");u&&u.remove(),t.parentNode.insertAdjacentHTML("beforeend",c),t.parentNode.querySelectorAll("li.folder").forEach(h=>{h.querySelector(".folder-item").addEventListener("click",C(U,$t))}),B.addSceneListeners(t.parentNode),t.parentNode.style.setProperty("--parent-offset-left",n+"px"),t.parentNode.classList.toggle("crlngn-folder-active")}),E(U,"selectFolder",e=>U.getFolderById(e)||null),E(U,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!B.navFoldersForPlayers||!B.navFoldersEnabled||!B.sceneNavEnabled}),E(U,"preloadTemplates",async()=>{const e=[`modules/${ee}/templates/scene-nav-folder-list.hbs`,`modules/${ee}/templates/scene-nav-subfolders.hbs`];return await loadTemplates(e),!0});let It=U;var at;const m=class m{static registerSettings(){const e=S();f.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{const c=l[1];f.log("Registering... ",[l],!0);const u={name:c.label,hint:c.hint,default:c.default,type:c.propType,scope:c.scope,config:c.config,requiresReload:c.requiresReload||!1,onChange:p=>m.apply(c.tag,p)};(c.choices||c.options)&&(u.choices=c.choices||c.options),await game.settings.register(ee,c.tag,u),m.get(c.tag)===void 0&&(f.log("resetting...",[c.tag]),m.set(c.tag,c.default))}),game.keybindings.register(ee,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{m.hideInterface()},restricted:!1}),m.applyThemeSettings(),m.applyCustomCSS(),m.applyModuleAdjustments(),Object.entries(ya()).forEach(async l=>{const c=l[1],u={name:c.tag,label:c.label,hint:c.hint,icon:c.icon,type:c.propType,restricted:c.restricted};await game.settings.registerMenu(ee,c.tag,u)}),Hooks.on(G.RENDER_SCENE_CONTROLS,m.applyLeftControlsSettings),Hooks.on(G.RENDER_PLAYERS_LIST,Ne.applyPlayersListSettings),Hooks.on(G.RENDER_HOTBAR,()=>{m.firstLoad&&(m.firstLoad=!1,m.applyHotBarCollapse()),m.applyHotBarSettings()}),m.applyDebugSettings(),m.applyChatStyles(),m.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.cameraDockMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.customFontsMenu.fields.forEach(l=>{m.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{m.applyLeftControlsSettings(e[l].tag)}),m.applyUiScale(),f.log("game settings",[game.settings])}static get(e,t=ee){if(!e)return null;let n=!1;if(t===ee)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,f.log("GET Setting",[a,n])}return n}static set(e,t,n=ee){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),f.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s;const n=S();switch(t===void 0&&(t=m.get(e)),f.log("SettingsUtil.apply",[e,t,m.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:m.applyHotBarSettings();break;case n.collapseMacroBar.tag:m.applyHotBarCollapse();break;case n.playerListAvatars.tag:Ne.applyAvatars();break;case n.autoHidePlayerList.tag:Ne.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:m.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:m.applyLeftControlsSettings(e,t);break;case n.enableFloatingDock.tag:Z.currSettings.enableFloatingDock=t;break;case n.dockHeight.tag:Z.currSettings.dockHeight=t,m.applyCameraHeight(t);break;case n.dockWidth.tag:Z.currSettings.dockWidth=t,m.applyCameraWidth(t);break;case n.dockPosX.tag:Z.currSettings.dockPosX=t,m.applyCameraPosX(t);break;case n.dockPosY.tag:Z.currSettings.dockPosY=t,m.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:Z.currSettings.defaultVideoWidth=t,Z.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:Z.currSettings.dockResizeOnUserJoin=t,Z.applyDockResize(t);break;case n.chatBorderColor.tag:it.chatBorderColor=m.get(n.chatBorderColor.tag),m.applyBorderColors();break;case n.enableChatStyles.tag:it.enableChatStyles=m.get(n.enableChatStyles.tag),m.applyChatStyles();break;case n.enforceDarkMode.tag:m.resetFoundryThemeSettings();break;case n.debugMode.tag:m.applyDebugSettings();break;case n.sceneNavEnabled.tag:B.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:B.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:B.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:B.sceneClickToView=t;break;case n.useSceneIcons.tag:B.useSceneIcons=t;break;case n.useNavBackButton.tag:B.useNavBackButton=t,(a=ui.nav)==null||a.render();break;case n.useScenePreview.tag:B.useScenePreview=t,(s=ui.nav)==null||s.render();break;case n.sceneNavAlias.tag:B.sceneNavAlias=t;break;case n.navStartCollapsed.tag:B.navStartCollapsed=t;break;case n.showFolderListOnClick.tag:B.showFolderListOnClick=t;break;case n.showNavOnHover.tag:B.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:B.isCollapsed=m.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:break;case n.colorTheme.tag:m.applyThemeSettings();break;case n.customStyles.tag:m.applyCustomCSS();break;case n.adjustOtherModules.tag:m.applyModuleAdjustments();break;case n.otherModulesList.tag:m.applyOtherModulesList();break;case n.uiScale.tag:m.applyUiScale(t);break}}static applyBorderColors(){const e=S(),t=m.get(e.chatBorderColor.tag),n=document.querySelector("body");t===st.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===st.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=S(),t=m.get(e.enableChatStyles.tag),n=document.querySelector("body");f.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=S(),t=m.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=S();m.get(e.collapseMacroBar.tag)}static applyLeftControlsSettings(e,t){const n=S();m.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),f.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:m.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break;case n.controlsBottomBuffer.tag:m.applyControlsBuffer();break;case n.controlsIconSize.tag:m.applyControlIconSize();break}}static applyControlIconSize(){const e=S(),t=m.get(e.controlsIconSize.tag);document.querySelector("body");const n=je[t]?je[t].size:je.regular.size;function o(a){switch(a){case je.large.name:return"var(--font-size-18);";case je.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[n]),D.addCSSVars("--icon-font-size",o(t)),D.addCSSVars("--control-item-size",n),m.applyLeftControlsSettings()}static applyUiScale(e){var o,a,s,r,l,c;const t=S(),n=e||m.get(t.uiScale.tag);n===An.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(a=document.querySelector("#interface"))==null||a.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","50px")):n===An.large.name?((s=document.querySelector("#interface"))==null||s.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),m.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(c=document.querySelector("#interface"))==null||c.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=S(),t=m.get(e.leftControlsMenu.tag),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;D.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applySceneNavPos(e){const t=S();B.navPos=e||m.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=S(),n=m.get(t.dockPosX.tag),o=e||n;Z.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=S(),n=m.get(t.dockPosY.tag),o=e||n;Z.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=S(),n=m.get(t.dockWidth.tag),o=e||n;Z.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=S(),n=m.get(t.dockHeight.tag),o=e||n;Z.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=S(),o=n.customFontsMenu.fields,a={};switch(f.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=m.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:D.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:D.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:D.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:D.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var s,r;const e=S(),t=D.isModuleOn("monks-player-settings"),n=D.isModuleOn("force-client-settings"),o=m.get(e.enforceDarkMode.tag);if(o&&t){(s=game.user)!=null&&s.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","uiConfig")||null;if(f.log("resetFoundryThemeSettings",[a,game.settings]),o){const l={...a,colorScheme:{application:a.colorScheme.applications===""?"dark":a.colorScheme.applications,interface:a.colorScheme.interface===""?"dark":a.colorScheme.interface}};game.settings.set("core","uiConfig",l)}}static applyDebugSettings(e){const t=S();f.debugOn=e||m.get(t.debugMode.tag)}};at=new WeakMap,T(m,at,!1),E(m,"firstLoad",!0),E(m,"applyThemeSettings",e=>{const t=S(),n=e||m.get(t.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,n,m.get(t.colorTheme.tag)]),De.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),E(m,"applyCustomCSS",e=>{const t=S(),n=e||m.get(t.customStyles.tag)||"";D.addCustomCSS(n)}),E(m,"applyModuleAdjustments",e=>{const t=S();(e||m.get(t.adjustOtherModules.tag)||!1)&&Ke.addModuleClasses()}),E(m,"applyOtherModulesList",e=>{const t=S(),n=e||m.get(t.otherModulesList.tag);f.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?m.set(t.adjustOtherModules.tag,!1):m.set(t.adjustOtherModules.tag,!0),Ke.addModuleClasses()}),E(m,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");C(m,at)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),O(m,at,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),O(m,at,!0))});let v=m;var Ge,Xt,Jt;const V=class V{static init(){f.log("LeftControls - init",[]),Hooks.on(G.RENDER_SCENE_CONTROLS,V.initSceneControls),V.initSceneControls()}static resetLocalVars(){O(V,Ge,document.querySelector("#ui-left #controls")),O(V,Xt,document.querySelector("#ui-left"))}static initSceneControls(){f.log("initSceneControls",[]),V.resetLocalVars(),V.observeControlsWidth()}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!C(V,Ge))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};O(V,Jt,new ResizeObserver(n=>{t(()=>V.updateCSSVars(),250)})),C(V,Jt).observe(C(V,Ge),{box:"border-box"}),V.updateCSSVars()}static updateCSSVars(){if(!C(V,Ge))return;let e=parseInt(C(V,Xt).offsetWidth),t=parseInt(C(V,Ge).offsetWidth),n=-e+t;f.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&D.addCSSVars("--ui-controls-margin-left",n+"px")}};Ge=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,T(V,Ge),T(V,Xt),T(V,Jt);let $n=V;class Qo{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=S();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){f.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=v.get(e.lastUpdateId.tag);if(f.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),v.set(e.lastUpdateId.tag,n.id),f.log("checkForUpdates SUCCESS",[n.id])}catch(t){f.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}E(Qo,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());class Wa{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return f.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var vn;const kt=class kt{static init(){Hooks.once(G.INIT,()=>{var n,o;document.querySelector("body").classList.add(ee),(n=document.querySelector("#ui-middle"))==null||n.classList.add(ee),f.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},v.registerSettings();const e=S(),t=v.get(e.disableUI.tag);if(f.log(G.INIT,[t]),t){document.querySelector("body").classList.remove(ee),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(ee);return}B.init(),Z.init(),$n.init(),it.init(),Ne.init(),Hooks.on(G.RENDER_CHAT_MESSAGE,C(kt,vn))}),Hooks.once(G.READY,()=>{f.log("Core Ready",[]);const e=S();var t=v.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Wa.init(),Ne.applyPlayersListSettings(),Ke.init(),Qo.init(),v.get(e.enableChatStyles.tag)&&kt.addCSSLocalization(),v.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";D.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),D.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),D.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),D.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),D.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),D.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),D.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),D.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),D.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),D.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};vn=new WeakMap,T(kt,vn,(e,t)=>{f.log(G.RENDER_CHAT_MESSAGE,[e,t]),it.enrichCard(e,t)});let Xn=kt;Xn.init();
//# sourceMappingURL=crlngn-ui.js.map
