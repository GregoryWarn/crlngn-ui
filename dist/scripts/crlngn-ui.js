var _o=Object.defineProperty;var fo=a=>{throw TypeError(a)};var es=(a,e,t)=>e in a?_o(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var w=(a,e,t)=>es(a,typeof e!="symbol"?e+"":e,t),Rn=(a,e,t)=>e.has(a)||fo("Cannot "+t);var g=(a,e,t)=>(Rn(a,e,"read from private field"),t?t.call(a):e.get(a)),I=(a,e,t)=>e.has(a)?fo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),P=(a,e,t,n)=>(Rn(a,e,"write to private field"),n?n.call(a,t):e.set(a,t),t),H=(a,e,t)=>(Rn(a,e,"access private method"),t);const x={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},pe="crlngn-ui",an=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Cn=class Cn{static log(e="",t=[],n=!1){try{const o=Cn.debugOn;if(!(n||o))return;console.log(...an,e,...t)}catch{console.log(...an,e,...t)}}static warn(e="",t=[]){console.warn(...an,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...an,e)}};w(Cn,"debugOn",!1);let p=Cn;const M={select:"select",checkbox:"checkbox",text:"text",number:"number"},A={client:"client",world:"world"},We={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Un={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},St={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Ye={noButton:{name:"noButton"},lastScene:{name:"lastScene"},previousFolder:{name:"previousFolder"},defaultScenes:{name:"defaultScenes"}},Pe=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function E(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:M.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:A.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:A.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:M.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:St.playerColor.name},scope:A.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:M.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:We.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:A.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:M.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:M.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:M.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:M.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:M.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:M.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:A.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:M.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navShowRootFolders","sceneClickToView","useSceneIcons","sceneNavAlias","navStartCollapsed","showNavOnHover","useNavBackButton","useScenePreview"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,sceneNavAlias:"",showFolderListOnClick:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useNavBackButton:Ye.lastScene.name},scope:A.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:A.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:M.select,propType:String,default:Un.small.name,scope:A.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:A.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:A.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:A.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:A.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.world,config:!1},useNavBackButton:{tag:"use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.hint"),propType:String,inputType:M.select,options:{noButton:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.noButton"),lastScene:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.lastScene"),previousFolder:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.previousFolder"),defaultScenes:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.defaultScenes")},default:Ye.lastScene.name,scope:A.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:M.text,default:"",scope:A.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:M.number,default:0,scope:A.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:A.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:A.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:A.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:A.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:A.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:M.text,propType:String,default:"",scope:A.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:A.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:M.text,propType:String,default:"",scope:A.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:M.text,default:St.playerColor.name,scope:A.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:A.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:M.number,default:200,scope:A.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:M.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:We.small.name,scope:A.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:A.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:M.checkbox,propType:Boolean,default:!0,scope:A.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:A.world,config:!1,default:""}}}const{ApplicationV2:ts,HandlebarsApplicationMixin:ns}=foundry.applications.api;var Ct,Co,Eo;const st=class st extends ns(ts){static get DEFAULT_OPTIONS(){return{id:E().cameraDockMenu.tag,actions:{redefine:H(st,Ct,Eo)},form:{handler:H(st,Ct,Co),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=E(),n={...T.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return p.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,p.log("_preparePartContext",[e,t]),t}_onRender(e,t){p.log("_onRender",[e,t])}};Ct=new WeakSet,Co=async function(e,t,n){const o=E();let s=T.get(o.cameraDockMenu.tag),i=s.enableFloatingDock;e.preventDefault(),e.stopPropagation();const r=n.object;r.hasOwnProperty("enableFloatingDock")||(r.enableFloatingDock=!1);const l=foundry.utils.expandObject(r);await T.set(o.cameraDockMenu.tag,l),s=T.get(o.cameraDockMenu.tag),p.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,l,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.enableFloatingDock!=i&&location.reload()},Eo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.cameraDockMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),p.log("#onReset",[e,t,n.cameraDockMenu.default])},I(st,Ct),w(st,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Bn=st;const{ApplicationV2:os,HandlebarsApplicationMixin:ss}=foundry.applications.api;var Et,wo,Io;const at=class at extends ss(os){static get DEFAULT_OPTIONS(){return{id:E().chatMessagesMenu.tag,actions:{redefine:H(at,Et,Io)},form:{handler:H(at,Et,wo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=E(),n=t.chatMessagesMenu.fields,o={},s={},i={};n.forEach(c=>{if(p.log("_prepareContext",[t[c].oldName]),t[c]){const u=T.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}}),p.log("_prepareContext",[s,i]);const r={...s,default:{...i},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return p.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,p.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E(),o=T.get(n.chatMessagesMenu.tag);p.log("_onRender",[e,t,o])}};Et=new WeakSet,wo=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.chatMessagesMenu.fields,i=n.object;s.forEach(u=>{o[u].inputType==="checkbox"&&!i.hasOwnProperty(u)&&(i[u]=!1)});const r=foundry.utils.expandObject(i),l=T.get(o.chatBorderColor.tag);p.log("Compared settings:",[r.chatBorderColor,l]),s.forEach(u=>{p.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&T.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Io=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.chatMessagesMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(at,Et),w(at,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Hn=at;class D{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=await this.processStyleSheets();return p.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!/FontAwesome|Font Awesome|FoundryVTT/.test(i)).map(i=>i.replace(/['"]/g,"").trim()).sort((i,r)=>i.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const m=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,m.prepend(n)}let o=n.textContent,s=o.indexOf("body.crlngn-ui {"),i=o.indexOf("}",s);s===-1&&(o=`body.crlngn-ui {
}
`,s=0,i=o.indexOf("}"));const l=o.substring(s+16,i).split(";").map(m=>m.trim()).filter(m=>m!==""),c={};l.forEach(m=>{const N=m.split(":");if(N.length>=2){const C=N[0].trim(),b=N.slice(1).join(":").trim();C&&(c[C]=b)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const u=Object.entries(c).map(([m,N])=>`  ${m}: ${N};`).join(`
`),h=o.substring(0,s)+`body.crlngn-ui {
`+u+`
}`+o.substring(i+1);n.textContent=h}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}}w(D,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([n])=>n);const t=new Set;for(const n of document.styleSheets)try{if(n.ownerNode){const o=n.href||"",s=o.includes("/css/")||o.includes("/styles/"),i=o.includes("/modules/crlngn-ui/");if(o&&!s&&!i){p.log("Skipping non-core/module stylesheet:",[o]);continue}let r="";if(n.ownerNode instanceof Element){if(n.ownerNode.tagName==="STYLE")r=n.ownerNode.textContent;else if(n.ownerNode.tagName==="LINK")try{const u=n.cssRules||n.rules;r=Array.from(u).map(h=>h.cssText).join(`
`)}catch(u){p.warn("Could not read stylesheet rules:",[u])}}p.log("Processing stylesheet:",[o||"inline style"]);const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let c;for(;(c=l.exec(r))!==null;){let u=c[1];if(u.includes("fonts.googleapis.com")){const h=u.match(/family=([^&]+)/);h&&decodeURIComponent(h[1]).split("|").map(N=>N.split(":")[0].replace(/\+/g," ")).forEach(N=>{t.add(N)})}else{if(u.startsWith("./")||u.startsWith("../")){p.log("Skipping relative import:",[u]);continue}let h=u;try{const m=await fetch(h);if(!m.ok){p.warn("Error loading imported CSS:",[m.status]);continue}const C=(await m.text()).match(/@font-face\s*{[^}]+}/g);if(!C)continue;C.forEach(b=>{const F=b.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(F&&F[1]){const B=F[1].trim();t.add(B)}})}catch(m){p.warn("Error processing imported CSS:",[m])}}}}if(!n.href||n.href.startsWith(window.location.origin))try{const o=n.cssRules||n.rules;for(const s of o)if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(i)}}catch(o){p.warn("Could not read stylesheet rules:",[o])}}catch(o){p.warn("Error processing stylesheet:",[o])}return t}),w(D,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:as,HandlebarsApplicationMixin:is}=foundry.applications.api;var Ke,Ue,To,Lo,ko;const ue=class ue extends is(as){static get DEFAULT_OPTIONS(){return{id:E().customFontsMenu.tag,actions:{redefine:H(ue,Ue,ko)},form:{handler:H(ue,Ue,To),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=E(),n=t.customFontsMenu.fields,o={},s={},i={};return n.forEach(l=>{if(t[l]){const c=T.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}}),{...s,default:{...i},fontList:await D.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){P(ue,Ke,this.element),g(ue,Ke).querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const l=()=>{var c;H(c=ue,Ue,Lo).call(c),r.classList.add("active")};s.addEventListener("focus",l),s.addEventListener("click",l),s.addEventListener("keydown",c=>{const u=r.classList.contains("active"),h=Array.from(r.querySelectorAll(".dropdown-option"));let m=h.findIndex(N=>N.classList.contains("highlighted"));c.key==="ArrowDown"||c.key==="ArrowUp"?(c.preventDefault(),u||r.classList.add("active"),h.forEach(N=>N.classList.remove("highlighted")),m===-1?m=c.key==="ArrowDown"?0:h.length-1:m=c.key==="ArrowDown"?(m+1)%h.length:(m-1+h.length)%h.length,h[m]&&(h[m].classList.add("highlighted"),h[m].scrollIntoView({block:"nearest"}))):c.key==="Enter"?(c.preventDefault(),u&&m!==-1&&h[m]&&h[m].click()):c.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",c=>{i.contains(c.target)||r.classList.remove("active")})}),g(ue,Ke).querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const r=s.closest(".dropdown-wrapper").querySelector("input");let l=s.dataset.value;l.includes(" ")&&!l.startsWith('"')?l=`"${l}"`:l.startsWith("&quot;")&&(l=l.replace(/&quot;/g,'"')),r.value=l,s.closest(".dropdown-options").classList.remove("active")})})}};Ke=new WeakMap,Ue=new WeakSet,To=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,i=foundry.utils.expandObject(n.object);s.forEach(r=>{i[r]!==void 0&&(p.log("Saving setting:",[i[r]]),T.set(o[r].tag,i[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Lo=function(){g(ue,Ke).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ko=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),i=n.customFontsMenu.fields,r={};i.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(ue,Ue),I(ue,Ke),w(ue,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let qn=ue;const{ApplicationV2:rs,HandlebarsApplicationMixin:ls}=foundry.applications.api;var wt,Ro,Mo;const it=class it extends ls(rs){static get DEFAULT_OPTIONS(){return{id:E().leftControlsMenu.tag,actions:{redefine:H(it,wt,Mo)},form:{handler:H(it,wt,Ro),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=E(),n=t.leftControlsMenu.fields,o={},s={},i={};n.forEach(l=>{if(t[l]){const c=T.get(t[l].tag);o[l]=t[l],s[l]=c!==void 0?c:t[l].default,i[l]=t[l].default}});const r={...s,default:{...i},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return p.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,p.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=E(),o=T.get(n.leftControlsMenu.tag);p.log("_onRender",[e,t,o])}};wt=new WeakSet,Ro=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.leftControlsMenu.fields,i=foundry.utils.expandObject(n.object);s.forEach(r=>{i[r]!==void 0&&(p.log("Saving setting:",[i[r]]),T.set(o[r].tag,i[r]))}),await T.set(o.leftControlsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Mo=async function(e,t){const n=E(),s=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),p.log("#onReset",[e,t,n.leftControlsMenu.default])},I(it,wt),w(it,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Vn=it;const{ApplicationV2:cs,HandlebarsApplicationMixin:ds}=foundry.applications.api;var It,Do,Po,Bt,$n;const rt=class rt extends ds(cs){constructor(){super(...arguments);I(this,Bt)}static get DEFAULT_OPTIONS(){return{id:E().sceneNavMenu.tag,actions:{redefine:H(rt,It,Po)},form:{handler:H(rt,It,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=E(),o=n.sceneNavMenu.fields,s={},i={},r={};o.forEach(c=>{if(n[c]){const u=T.get(n[c].tag);s[c]=n[c],i[c]=u!==void 0?u:n[c].default,r[c]=n[c].default}});const l={...i,default:{...r},fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return p.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,p.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;p.log("_onRender",[t,n]);const o=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');p.log("_onRender",[this.element,o]),o&&(o.addEventListener("change",H(this,Bt,$n).bind(this)),H(this,Bt,$n).call(this,{target:o}))}};It=new WeakSet,Do=async function(t,n,o){t.preventDefault(),t.stopPropagation();const s=E(),i=s.sceneNavMenu.fields;let r=T.get(s.sceneNavEnabled.tag),l=T.get(s.navFoldersEnabled.tag);const c=foundry.utils.expandObject(o.object);i.forEach(m=>{c[m]!==void 0&&(p.log("Saving setting:",[c[m]]),T.set(s[m].tag,c[m]))});let u=T.get(s.sceneNavEnabled.tag),h=T.get(s.navFoldersEnabled.tag);p.log("Saving settings...",[r,u]),await T.set(s.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==h)&&location.reload()},Po=async function(t,n){const o=E(),i=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;i.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),p.log("#onReset",[t,n,o.sceneNavMenu.default])},Bt=new WeakSet,$n=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(s=>s.disabled=!t.target.checked),p.log("onSceneNavEnabledChange",[this.element,n])},I(rt,It),w(rt,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let jn=rt;const{ApplicationV2:us,HandlebarsApplicationMixin:fs}=foundry.applications.api;var Ze,Be,Ao,Fo,Go;const fe=class fe extends fs(us){static get DEFAULT_OPTIONS(){return{id:E().themeAndStylesMenu.tag,actions:{redefine:H(fe,Be,Go)},form:{handler:H(fe,Be,Ao),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=E(),n=t.themeAndStylesMenu.fields,o={},s={},i={};n.forEach(c=>{if(t[c]){const u=T.get(t[c].tag);o[c]=t[c],s[c]=u!==void 0?u:t[c].default,i[c]=t[c].default}});const r=Pe.find(c=>c.className===s.colorTheme);s.colorTheme=(r==null?void 0:r.label)||Pe[0].label;const l={...s,default:{...i},fields:{...o},selectedTheme:r,themes:Pe,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...s},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){P(fe,Ze,this.element),this._themes=Pe,g(fe,Ze).querySelectorAll('input[type="text"]').forEach(i=>{const r=i.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const c=()=>{var u;H(u=fe,Be,Fo).call(u),l.classList.add("active")};i.addEventListener("focus",c),i.addEventListener("click",c),i.addEventListener("keydown",u=>{const h=l.classList.contains("active"),m=Array.from(l.querySelectorAll(".dropdown-option"));let N=m.findIndex(C=>C.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),h||l.classList.add("active"),m.forEach(C=>C.classList.remove("highlighted")),N===-1?N=u.key==="ArrowDown"?0:m.length-1:N=u.key==="ArrowDown"?(N+1)%m.length:(N-1+m.length)%m.length,m[N]&&(m[N].classList.add("highlighted"),m[N].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),h&&N!==-1&&m[N]&&m[N].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})});const o=g(fe,Ze).querySelectorAll(".dropdown-option"),s=this;o.forEach(i=>{i.addEventListener("mouseenter",()=>{i.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),i.classList.add("highlighted")}),i.addEventListener("click",function(r){p.log("option",[i,i.querySelector(".theme-name")]);const l=i.closest(".dropdown-wrapper").querySelector("input");let c=i.querySelector(".theme-name").innerHTML.toString();if(l.value=c,l.name==="colorTheme"){const h=s._themes.find(m=>m.label===c);s._selectedTheme=h,s._updateThemePreview(h)}i.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(p.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};Ze=new WeakMap,Be=new WeakSet,Ao=async function(e,t,n){const o=E();e.preventDefault(),e.stopPropagation();const s=o.themeAndStylesMenu.fields,i=foundry.utils.expandObject(n.object),r=Pe.find(l=>l.label===i.colorTheme);i.colorTheme=r?r.className:"",s.forEach(l=>{i[l]!==void 0&&(p.log("Saving setting:",[i[l]]),T.set(o[l].tag,i[l]))}),T.set(o.themeAndStylesMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Fo=function(){g(fe,Ze).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Go=async function(e,t){const n=E(),s=this.element.querySelectorAll("input[type=text]"),i=n.themeAndStylesMenu.fields,r={};i.forEach(c=>{n[c]&&(n[c],r[c]=n[c].default)});const l=Pe.find(c=>c.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||Pe[0].label,s.forEach(c=>{c.value=r[c.name]})},I(fe,Be),I(fe,Ze),w(fe,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Wn=fe;function gs(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:qn,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Wn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Hn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:Vn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Bn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:jn,restricted:!1}}}var Ht,qt,Vt,jt,$t,Wt,Yt,se,Yn,Xn,Kn,Zn;const v=class v{static init(){const e=E(),t=T.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(x.RENDER_CAMERA_VIEWS,v.onRenderFloating),p.log("CameraUtil",[t]),v.onRenderFloating()):(Hooks.on(x.RENDER_CAMERA_VIEWS,v.onRenderPlain),v.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var s,i,r;const e=E(),t=T.get(e.cameraDockMenu.tag);(s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-ui"),v.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");p.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),v.cameraContainer&&o&&n&&((i=v.cameraContainer)==null||i.insertBefore(n,o),(r=document.querySelector("#camera-views .camera-container"))==null||r.classList.add("visible")),v.makeDraggable(),v.makeResizeable(),v.resetPositionAndSize(),v.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(p.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=v.cameraContainer)==null||e.addEventListener("mousedown",t=>{var s,i;const n=document.querySelector("body.crlngn-ui");if((s=t.target.parentNode)!=null&&s.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",H(v,se,Xn)),n==null||n.addEventListener("mouseup",H(v,se,Yn));const o=D.getOffsetBottom(v.cameraContainer);v.isDragging=!0,P(v,Ht,t.clientX-((i=v.cameraContainer)==null?void 0:i.offsetLeft)),P(v,qt,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(v.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),v.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),v.isResizing=!0,P(v,Vt,n.clientX),P(v,jt,n.clientY),P(v,Yt,parseInt(getComputedStyle(v.cameraContainer).bottom)||0),P(v,$t,v.cameraContainer.offsetWidth),P(v,Wt,v.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",H(v,se,Kn)),e==null||e.addEventListener("mouseup",H(v,se,Zn))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const s=E(),i=T.get(s.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!v.cameraContainer))if(!e&&!t&&!n&&!o){const r=i.dockPosX||0,l=i.dockPosY||0,c=i.dockWidth||0,u=i.dockHeight||0;v.cameraContainer.style.left=`${r}px`,v.cameraContainer.style.bottom=`${l}px`,v.cameraContainer.style.width=`${c}px`,v.cameraContainer.style.height=`${u}px`}else e&&(v.cameraContainer.style.left=`${e}px`),t&&(v.cameraContainer.style.bottom=`${t}px`),n&&(v.cameraContainer.style.width=`${n}px`),o&&(v.cameraContainer.style.height=`${o}px`)}};Ht=new WeakMap,qt=new WeakMap,Vt=new WeakMap,jt=new WeakMap,$t=new WeakMap,Wt=new WeakMap,Yt=new WeakMap,se=new WeakSet,Yn=function(e){var o,s;const t=E(),n={...T.get(t.cameraDockMenu.tag)};if(v.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=v.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=v.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.cameraDockMenu.tag,n),i==null||i.removeEventListener("mousemove",H(v,se,Xn)),i==null||i.removeEventListener("mouseup",H(v,se,Yn)),v.isDragging=!1,e.stopPropagation()}},Xn=function(e){if(v.isDragging&&(p.log("mousemove",[e.target.parentNode]),v.cameraContainer)){let t=e.clientX-g(v,Ht),n=window.innerHeight-e.clientY-g(v,qt);t+v.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-v.cameraContainer.offsetWidt),v.cameraContainer.style.left=`${t}px`,n+v.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-v.cameraContainer.offsetHeight),v.cameraContainer.style.bottom=`${n}px`}},Kn=function(e){if(!v.isResizing)return;const t=g(v,$t)+(e.clientX-g(v,Vt)),n=e.clientY-g(v,jt),o=g(v,Wt)+n,s=g(v,Yt)-n;v.cameraContainer.style.width=`${t}px`,v.cameraContainer.style.height=`${o}px`,v.cameraContainer.style.bottom=`${s}px`},Zn=function(){var o,s,i,r,l,c;const e=E(),t={...T.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");v.isResizing=!1,n==null||n.removeEventListener("mousemove",H(v,se,Kn)),n==null||n.removeEventListener("mouseup",H(v,se,Zn)),p.log("onStopResize",[(o=v.cameraContainer)==null?void 0:o.style.width,(s=v.cameraContainer)==null?void 0:s.style.height,(i=v.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((r=v.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=v.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((c=v.cameraContainer)==null?void 0:c.style.bottom)||0),T.set(e.cameraDockMenu.tag,t)},I(v,se),I(v,Ht,0),I(v,qt,0),w(v,"isDragging",!1),w(v,"cameraContainer"),w(v,"isResizing",!1),I(v,Vt,0),I(v,jt,0),I(v,$t,0),I(v,Wt,0),I(v,Yt,0);let Xe=v;const be=class be{static init(){const e=E();be.enableChatStyles=T.get(e.enableChatStyles.tag),be.chatBorderColor=T.get(e.chatBorderColor.tag)}};w(be,"chatBorderColor"),w(be,"enableChatStyles"),w(be,"enrichCard",async(e,t)=>{var i,r,l,c,u,h,m,N;p.log("renderChatMessage",[be.chatBorderColor,be.enableChatStyles,St.playerColor.name,(i=e.author)==null?void 0:i.id]);const n=((c=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:c.type)||((m=(h=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:h.roll)==null?void 0:m.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const s=o.querySelectorAll(".card-buttons button[data-action=rollSave]");s.length>0&&s.forEach(C=>{const b=C.querySelector(".visible-dc"),F=C.querySelector(".hidden-dc");p.log("enrichCard",[b,F]),b.setAttribute("data-ability",C.getAttribute("data-ability")||""),b.setAttribute("data-dc",C.getAttribute("data-dc")||""),F.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),be.chatBorderColor===St.playerColor.name&&((N=e.author)!=null&&N.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let bt=be;var oo;const Ne=class Ne{static init(){Hooks.on(x.RENDER_PLAYERS_LIST,Ne.checkPlayersList),Hooks.on(x.RENDER_HOTBAR,Ne.checkPlayersList),D.isModuleOn("foundry-taskbar")&&Hooks.on(x.UPDATE_USER,Ne.checkTaskbarLock),Ne.checkTaskbarLock()}};oo=new WeakMap,I(Ne,oo),w(Ne,"checkTaskbarLock",()=>{var s,i,r;const e=D.isModuleOn("foundry-taskbar"),t=(s=game.user.flags)==null?void 0:s["foundry-taskbar"];if(p.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(i=t.taskbarSettings)!=null&&i.locked?D.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):D.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?D.addCSSVars("--crlngn-taskbar-height","50px"):D.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),Ne.checkPlayersList()}),w(Ne,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=D.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,s=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;p.log("checkPlayersList",[o,n,s,game.settings]),document.querySelector("#hotbar"),o?(p.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let mn=Ne;var ee,$,Qe,ct,Xt,dt,Kt,Zt,ut,ft,ce,me,En,wn;const f=class f{static handleNavState(){const e=E();game.ready&&g(f,ft)?(P(f,ft,!1),f.toggleNav(f.navStartCollapsed)):f.toggleNav(T.get(e.sceneNavCollapsed.tag))}static toggleNav(e){clearTimeout(g(f,Zt)),P(f,Zt,setTimeout(()=>{if(!ui.nav){f.toggleNav(e);return}f.resetLocalVars(),e===!0?(ui.nav.collapse(),g(f,dt).classList.add("navigation-collapsed")):e===!1&&(ui.nav.expand(),g(f,dt).classList.remove("navigation-collapsed"))},500))}static checkSceneNavCompat(){var n,o;const e=E(),t=document.querySelector("#ui-middle");P(this,ce,D.isModuleOn("monks-scene-navigation")),P(this,me,D.isModuleOn("compact-scene-navigation")),g(this,me)&&f.navFoldersEnabled&&(n=game.user)!=null&&n.isGM&&g(this,me)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),g(this,ce)&&f.sceneNavEnabled&&(t.classList.remove("crlngn-ui"),game.ready&&(T.set(e.sceneNavEnabled.tag,!1),f.sceneNavEnabled=!1),p.log("checkSceneNavCompat",[g(this,ce),g(this,me)]),(o=game.user)!=null&&o.isGM&&g(this,ce)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static resetLocalVars(){P(f,ee,document.querySelector("#navigation")),P(f,ct,document.querySelector("#navigation .nav-item.is-root")),P(f,Xt,document.querySelector("#nav-toggle")),P(f,dt,document.querySelector("#ui-middle")),f.navFoldersEnabled?(P(f,$,document.querySelector("#crlngn-scene-list")),p.log("TopNavigation resetLocalVars",[g(f,$)])):P(f,$,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=g(f,ee))==null||e.addEventListener("mouseenter",n=>{if(p.log("TopNavigation mouseenter",[]),!f.isCollapsed||!f.showNavOnHover)return;n.stopPropagation(),clearTimeout(g(f,Qe)),document.querySelector("#navigation").classList.remove("collapsed")}),(t=g(this,ee))==null||t.addEventListener("mouseleave",n=>{p.log("TopNavigation mouseleave",[]),!(!f.isCollapsed||!f.showNavOnHover)&&(n.stopPropagation(),P(this,Qe,setTimeout(()=>{clearTimeout(g(this,Qe)),P(this,Qe,null),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){clearTimeout(g(this,ut)),P(f,ut,setTimeout(()=>{var l,c,u,h,m,N,C;clearTimeout(g(this,ut)),f.resetLocalVars();const e=((c=(l=g(f,ee))==null?void 0:l.querySelector("#crlngn-scene-folders"))==null?void 0:c.offsetWidth)||0,t=(u=g(f,ee))==null?void 0:u.querySelectorAll("button.crlngn-nav"),n=((h=g(f,$))==null?void 0:h.scrollWidth)+e>=((m=g(this,ee))==null?void 0:m.offsetWidth);if(p.log("placeNavButtons",[g(f,$),n]),!n)return;t.forEach(b=>b.remove());const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),o.addEventListener("click",g(this,En)),o.append(s);const i=document.createElement("button");i.classList.add("crlngn-nav"),i.classList.add("ui-nav-right");const r=document.createElement("i");r.classList.add("fa"),r.classList.add("fa-chevron-right"),i.append(r),i.addEventListener("click",g(this,wn)),(N=g(this,ee))==null||N.appendChild(o),(C=g(this,ee))==null||C.appendChild(i),g(this,$)&&g(this,$).classList.remove("no-transition")},250))}static setNavPosition(e){var t,n;try{p.log("setNavPosition",["Starting with pos:",e]);const o=E();if(!g(this,$)){p.log("setNavPosition",["No scenes list found"]);return}const s=((t=g(this,$))==null?void 0:t.querySelectorAll("li.nav-item:not(.is-root)"))||[];if(s.length===0){p.log("setNavPosition",["No scene items found"]);return}const i=g(this,me)&&((n=g(this,ct))==null?void 0:n.offsetWidth)||0,r=e!==void 0?e:f.navPos||0;if(r>=s.length){p.log("setNavPosition",["Position out of bounds:",r,"max:",s.length-1]);return}const l=s[r];if(!l){p.log("setNavPosition",["Target scene not found at position:",r]);return}const c=l.offsetLeft;if(typeof c!="number"){p.log("setNavPosition",["Invalid offsetLeft for scene:",c]);return}const u=(parseInt(c)-i)*-1;p.log("setNavPosition",["Calculated margin:",u]),g(this,$).style.marginLeft=u+"px",f.navPos=r,T.set(o.sceneNavPos.tag,r),p.log("setNavPosition",["Complete:",{pos:e,position:r,newMargin:u}])}catch(o){p.log("setNavPosition",["Error:",o]),console.error("Error in setNavPosition:",o)}}};ee=new WeakMap,$=new WeakMap,Qe=new WeakMap,ct=new WeakMap,Xt=new WeakMap,dt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,ut=new WeakMap,ft=new WeakMap,ce=new WeakMap,me=new WeakMap,En=new WeakMap,wn=new WeakMap,I(f,ee),I(f,$),I(f,Qe),I(f,ct),I(f,Xt),I(f,dt),w(f,"sceneFoldersTemplate"),I(f,Kt),I(f,Zt),I(f,ut),I(f,ft,!0),I(f,ce,!1),I(f,me,!1),w(f,"sceneNavEnabled"),w(f,"navFoldersEnabled"),w(f,"navFoldersForPlayers"),w(f,"navShowRootFolders"),w(f,"navStartCollapsed"),w(f,"showFolderListOnClick"),w(f,"showNavOnHover"),w(f,"useSceneIcons"),w(f,"useScenePreview"),w(f,"useNavBackButton"),w(f,"sceneNavAlias",""),w(f,"sceneClickToView"),w(f,"isCollapsed"),w(f,"navPos"),w(f,"init",async()=>{const e=E();f.checkSceneNavCompat(),f.navStartCollapsed=T.get(e.navStartCollapsed.tag),f.showNavOnHover=T.get(e.showNavOnHover.tag),f.sceneNavEnabled=T.get(e.sceneNavEnabled.tag),f.navFoldersEnabled=T.get(e.navFoldersEnabled.tag),f.navFoldersForPlayers=T.get(e.navFoldersForPlayers.tag),f.showFolderListOnClick=T.get(e.showFolderListOnClick.tag),f.isCollapsed=g(f,ft)?f.navStartCollapsed:T.get(e.sceneNavCollapsed.tag),f.navPos=T.get(e.sceneNavPos.tag),f.resetLocalVars();const t=document.querySelector("#ui-middle");if(p.log("SCENE NAV INIT",[f.sceneNavEnabled]),f.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}if(g(f,ce))g(f,ce)&&t.classList.add("with-monks-scene");else{g(f,me)||(te.init(),te.registerHooks(),te.renderSceneFolders());const n=T.get(e.sceneNavPos.tag);f.setNavPosition(n),f.placeNavButtons(),f.addListeners(),f.handleNavState()}Hooks.on(x.RENDER_SCENE_NAV,async()=>{p.log("SCENE NAV",[f.navPos]),p.log("TopNavigation",[f.isCollapsed,f.navStartCollapsed]);const n=E();if(!g(f,ce)){p.log("NAV no transition add"),f.navPos=T.get(n.sceneNavPos.tag),g(f,me)||(te.init(),await te.renderSceneFolders()),g(f,$)&&g(f,$).classList.add("no-transition");const o=f.navPos;f.setNavPosition(o),f.placeNavButtons(),f.addListeners(),f.handleNavState(),clearTimeout(g(f,Kt)),P(f,Kt,setTimeout(()=>{p.log("NAV no transition remove"),g(f,$)&&g(f,$).classList.remove("no-transition")},250))}}),Hooks.on(x.COLLAPSE_SIDE_BAR,n=>{p.log(x.COLLAPSE_SIDE_BAR,["isMonksSceneNavOn",g(f,ce)]),g(f,ce)||f.placeNavButtons()}),Hooks.on(x.COLLAPSE_SCENE_NAV,(n,o)=>{const s=E();T.set(s.sceneNavCollapsed.tag,o),p.log("NAV toggle",[n,o]),f.isCollapsed=o,f.toggleNav(o)}),Hooks.on(x.EXPAND_SCENE_NAV,(n,o)=>{p.log("NAV expand",[n,!1])}),Hooks.on(x.CANVAS_INIT,async()=>{try{const n=game.scenes.viewed;if(!n)return;const o=await f.getCurrScenePosition(n.id);await new Promise(s=>setTimeout(s,100)),f.setNavPosition(o)}catch(n){p.warn(x.CANVAS_INIT,["Error in canvas init:",n]),console.error("Error in canvas init:",n)}}),window.addEventListener("resize",()=>{g(f,ce)||f.placeNavButtons()}),p.log("TopNavigation - init",[f.sceneNavEnabled])}),I(f,En,async e=>{var s;const t=await f.getItemsPerPage();(s=g(f,$))!=null&&s.querySelectorAll("li.nav-item:not(.is-root)");const n=f.navPos||0;let o=n-(t-1);o=o<0?0:o,p.log("onNavLast",["currPos",n,"items",t,o]),f.setNavPosition(o)}),I(f,wn,async e=>{var i;const t=await f.getItemsPerPage(),n=((i=g(f,$))==null?void 0:i.querySelectorAll("li.nav-item:not(.is-root)"))||[],o=f.navPos||0;let s=o+(t-1);s=s>n.length-1?n.length-1:s,p.log("onNavNext",["currPos",o,"items",t,s]),f.setNavPosition(s)}),w(f,"getItemsPerPage",async()=>{var e,t,n,o,s,i;try{if(p.log("getItemsPerPage",["Starting"]),g(f,ee)||(p.log("getItemsPerPage",["No nav element, resetting vars"]),f.resetLocalVars(),await new Promise(b=>setTimeout(b,100))),!g(f,ee))return p.log("getItemsPerPage",["Nav element still not found after reset"]),0;const r=((t=(e=g(f,ee))==null?void 0:e.querySelector("#crlngn-scene-folders"))==null?void 0:t.offsetWidth)||0,l=g(f,me)&&((n=g(f,ct))==null?void 0:n.offsetWidth)||0,c=((o=g(f,Xt))==null?void 0:o.offsetWidth)||0,u=(s=g(f,$))==null?void 0:s.querySelector("li.nav-item:not(.is-root)");if(!u)return p.log("getItemsPerPage",["No scene items found"]),0;const h=u.offsetWidth;if(!h)return p.log("getItemsPerPage",["Scene item has no width"]),0;const m=f.navPos||0,N=(i=g(f,ee))==null?void 0:i.offsetWidth;if(!N)return p.log("getItemsPerPage",["Nav element has no width"]),0;const C=Math.floor((N-(m===0?l+r:0)-c*2)/h);return p.log("getItemsPerPage",["Calculated items per page:",C]),C||0}catch(r){return p.log("getItemsPerPage",["Error:",r]),console.error("Error in getItemsPerPage:",r),0}}),w(f,"getCurrScenePosition",async e=>{try{if(p.log("getCurrScenePosition",["Starting with id:",e]),!g(f,$))return p.log("getCurrScenePosition",["No scenes list found"]),0;const t=await f.getItemsPerPage()||1;p.log("getCurrScenePosition",["Items per page:",t]);const n=g(f,$).querySelectorAll("li.nav-item:not(.is-root)");if(!n||n.length===0)return p.log("getCurrScenePosition",["No scene items found"]),0;const o=Array.from(n);if(!e)return p.log("getCurrScenePosition",["No scene ID provided"]),0;const s=o.findIndex(l=>l.dataset.sceneId===e);if(p.log("getCurrScenePosition",["Found scene index:",s]),s===-1)return p.log("getCurrScenePosition",["Scene not found with id:",e]),0;const i=s>=f.navPos&&s<=f.navPos+t,r=i?f.navPos:s;return p.log("getCurrScenePosition",["Final position:",r,"isVisible:",i]),r}catch(t){return p.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}});let G=f;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function go(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable})),t.push.apply(t,n)}return t}function Ee(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?go(Object(t),!0).forEach(function(n){ps(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):go(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function un(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?un=function(e){return typeof e}:un=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(a)}function ps(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function ke(){return ke=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},ke.apply(this,arguments)}function hs(a,e){if(a==null)return{};var t={},n=Object.keys(a),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(t[o]=a[o]);return t}function ms(a,e){if(a==null)return{};var t=hs(a,e),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(o=0;o<s.length;o++)n=s[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(t[n]=a[n])}return t}var vs="1.15.6";function Le(a){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(a)}var Re=Le(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),nn=Le(/Edge/i),po=Le(/firefox/i),Ft=Le(/safari/i)&&!Le(/chrome/i)&&!Le(/android/i),ao=Le(/iP(ad|od|hone)/i),Oo=Le(/chrome/i)&&Le(/android/i),zo={capture:!1,passive:!1};function z(a,e,t){a.addEventListener(e,t,!Re&&zo)}function O(a,e,t){a.removeEventListener(e,t,!Re&&zo)}function vn(a,e){if(e){if(e[0]===">"&&(e=e.substring(1)),a)try{if(a.matches)return a.matches(e);if(a.msMatchesSelector)return a.msMatchesSelector(e);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(e)}catch{return!1}return!1}}function xo(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function ye(a,e,t,n){if(a){t=t||document;do{if(e!=null&&(e[0]===">"?a.parentNode===t&&vn(a,e):vn(a,e))||n&&a===t)return a;if(a===t)break}while(a=xo(a))}return null}var ho=/\s+/g;function re(a,e,t){if(a&&e)if(a.classList)a.classList[t?"add":"remove"](e);else{var n=(" "+a.className+" ").replace(ho," ").replace(" "+e+" "," ");a.className=(n+(t?" "+e:"")).replace(ho," ")}}function k(a,e,t){var n=a&&a.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(t=a.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function lt(a,e){var t="";if(typeof a=="string")t=a;else do{var n=k(a,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(a=a.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Uo(a,e,t){if(a){var n=a.getElementsByTagName(e),o=0,s=n.length;if(t)for(;o<s;o++)t(n[o],o);return n}return[]}function Ce(){var a=document.scrollingElement;return a||document.documentElement}function X(a,e,t,n,o){if(!(!a.getBoundingClientRect&&a!==window)){var s,i,r,l,c,u,h;if(a!==window&&a.parentNode&&a!==Ce()?(s=a.getBoundingClientRect(),i=s.top,r=s.left,l=s.bottom,c=s.right,u=s.height,h=s.width):(i=0,r=0,l=window.innerHeight,c=window.innerWidth,u=window.innerHeight,h=window.innerWidth),(e||t)&&a!==window&&(o=o||a.parentNode,!Re))do if(o&&o.getBoundingClientRect&&(k(o,"transform")!=="none"||t&&k(o,"position")!=="static")){var m=o.getBoundingClientRect();i-=m.top+parseInt(k(o,"border-top-width")),r-=m.left+parseInt(k(o,"border-left-width")),l=i+s.height,c=r+s.width;break}while(o=o.parentNode);if(n&&a!==window){var N=lt(o||a),C=N&&N.a,b=N&&N.d;N&&(i/=b,r/=C,h/=C,u/=b,l=i+u,c=r+h)}return{top:i,left:r,bottom:l,right:c,width:h,height:u}}}function mo(a,e,t){for(var n=xe(a,!0),o=X(a)[e];n;){var s=X(n)[t],i=void 0;if(i=o>=s,!i)return n;if(n===Ce())break;n=xe(n,!1)}return!1}function Nt(a,e,t,n){for(var o=0,s=0,i=a.children;s<i.length;){if(i[s].style.display!=="none"&&i[s]!==L.ghost&&(n||i[s]!==L.dragged)&&ye(i[s],t.draggable,a,!1)){if(o===e)return i[s];o++}s++}return null}function io(a,e){for(var t=a.lastElementChild;t&&(t===L.ghost||k(t,"display")==="none"||e&&!vn(t,e));)t=t.previousElementSibling;return t||null}function ge(a,e){var t=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==L.clone&&(!e||vn(a,e))&&t++;return t}function vo(a){var e=0,t=0,n=Ce();if(a)do{var o=lt(a),s=o.a,i=o.d;e+=a.scrollLeft*s,t+=a.scrollTop*i}while(a!==n&&(a=a.parentNode));return[e,t]}function ys(a,e){for(var t in a)if(a.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===a[t][n])return Number(t)}return-1}function xe(a,e){if(!a||!a.getBoundingClientRect)return Ce();var t=a,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=k(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ce();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ce()}function Ss(a,e){if(a&&e)for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a}function Mn(a,e){return Math.round(a.top)===Math.round(e.top)&&Math.round(a.left)===Math.round(e.left)&&Math.round(a.height)===Math.round(e.height)&&Math.round(a.width)===Math.round(e.width)}var Gt;function Bo(a,e){return function(){if(!Gt){var t=arguments,n=this;t.length===1?a.call(n,t[0]):a.apply(n,t),Gt=setTimeout(function(){Gt=void 0},e)}}}function bs(){clearTimeout(Gt),Gt=void 0}function Ho(a,e,t){a.scrollLeft+=e,a.scrollTop+=t}function qo(a){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(a).cloneNode(!0):t?t(a).clone(!0)[0]:a.cloneNode(!0)}function Vo(a,e,t){var n={};return Array.from(a.children).forEach(function(o){var s,i,r,l;if(!(!ye(o,e.draggable,a,!1)||o.animated||o===t)){var c=X(o);n.left=Math.min((s=n.left)!==null&&s!==void 0?s:1/0,c.left),n.top=Math.min((i=n.top)!==null&&i!==void 0?i:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var oe="Sortable"+new Date().getTime();function Ns(){var a=[],e;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(k(o,"display")==="none"||o===L.ghost)){a.push({target:o,rect:X(o)});var s=Ee({},a[a.length-1].rect);if(o.thisAnimationDuration){var i=lt(o,!0);i&&(s.top-=i.f,s.left-=i.e)}o.fromRect=s}})}},addAnimationState:function(n){a.push(n)},removeAnimationState:function(n){a.splice(ys(a,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var s=!1,i=0;a.forEach(function(r){var l=0,c=r.target,u=c.fromRect,h=X(c),m=c.prevFromRect,N=c.prevToRect,C=r.rect,b=lt(c,!0);b&&(h.top-=b.f,h.left-=b.e),c.toRect=h,c.thisAnimationDuration&&Mn(m,h)&&!Mn(u,h)&&(C.top-h.top)/(C.left-h.left)===(u.top-h.top)/(u.left-h.left)&&(l=Es(C,m,N,o.options)),Mn(h,u)||(c.prevFromRect=u,c.prevToRect=h,l||(l=o.options.animation),o.animate(c,C,h,l)),l&&(s=!0,i=Math.max(i,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof n=="function"&&n()},i):typeof n=="function"&&n(),a=[]},animate:function(n,o,s,i){if(i){k(n,"transition",""),k(n,"transform","");var r=lt(this.el),l=r&&r.a,c=r&&r.d,u=(o.left-s.left)/(l||1),h=(o.top-s.top)/(c||1);n.animatingX=!!u,n.animatingY=!!h,k(n,"transform","translate3d("+u+"px,"+h+"px,0)"),this.forRepaintDummy=Cs(n),k(n,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),k(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){k(n,"transition",""),k(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},i)}}}}function Cs(a){return a.offsetWidth}function Es(a,e,t,n){return Math.sqrt(Math.pow(e.top-a.top,2)+Math.pow(e.left-a.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var et=[],Dn={initializeByDefault:!0},on={mount:function(e){for(var t in Dn)Dn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Dn[t]);et.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),et.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var s=e+"Global";et.forEach(function(i){t[i.pluginName]&&(t[i.pluginName][s]&&t[i.pluginName][s](Ee({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](Ee({sortable:t},n)))})},initializePlugins:function(e,t,n,o){et.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[l]=c,ke(n,c.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var i=this.modifyOption(e,s,e.options[s]);typeof i<"u"&&(e.options[s]=i)}},getEventProperties:function(e,t){var n={};return et.forEach(function(o){typeof o.eventProperties=="function"&&ke(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return et.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[t]=="function"&&(o=s.optionListeners[t].call(e[s.pluginName],n))}),o}};function ws(a){var e=a.sortable,t=a.rootEl,n=a.name,o=a.targetEl,s=a.cloneEl,i=a.toEl,r=a.fromEl,l=a.oldIndex,c=a.newIndex,u=a.oldDraggableIndex,h=a.newDraggableIndex,m=a.originalEvent,N=a.putSortable,C=a.extraEventProperties;if(e=e||t&&t[oe],!!e){var b,F=e.options,B="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Re&&!nn?b=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(b=document.createEvent("Event"),b.initEvent(n,!0,!0)),b.to=i||t,b.from=r||t,b.item=o||t,b.clone=s,b.oldIndex=l,b.newIndex=c,b.oldDraggableIndex=u,b.newDraggableIndex=h,b.originalEvent=m,b.pullMode=N?N.lastPutMode:void 0;var U=Ee(Ee({},C),on.getEventProperties(n,e));for(var Z in U)b[Z]=U[Z];t&&t.dispatchEvent(b),F[B]&&F[B].call(e,b)}}var Is=["evt"],ne=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,s=ms(n,Is);on.pluginEvent.bind(L)(e,t,Ee({dragEl:S,parentEl:j,ghostEl:R,rootEl:q,nextEl:$e,lastDownEl:fn,cloneEl:V,cloneHidden:Fe,dragStarted:Dt,putSortable:Q,activeSortable:L.active,originalEvent:o,oldIndex:ot,oldDraggableIndex:Ot,newIndex:le,newDraggableIndex:Ae,hideGhostForTarget:Yo,unhideGhostForTarget:Xo,cloneNowHidden:function(){Fe=!0},cloneNowShown:function(){Fe=!1},dispatchSortableEvent:function(r){_({sortable:t,name:r,originalEvent:o})}},s))};function _(a){ws(Ee({putSortable:Q,cloneEl:V,targetEl:S,rootEl:q,oldIndex:ot,oldDraggableIndex:Ot,newIndex:le,newDraggableIndex:Ae},a))}var S,j,R,q,$e,fn,V,Fe,ot,le,Ot,Ae,rn,Q,nt=!1,yn=!1,Sn=[],Ve,he,Pn,An,yo,So,Dt,tt,zt,xt=!1,ln=!1,gn,J,Fn=[],Qn=!1,bn=[],kn=typeof document<"u",cn=ao,bo=nn||Re?"cssFloat":"float",Ts=kn&&!Oo&&!ao&&"draggable"in document.createElement("div"),jo=function(){if(kn){if(Re)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}}(),$o=function(e,t){var n=k(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),s=Nt(e,0,t),i=Nt(e,1,t),r=s&&k(s),l=i&&k(i),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+X(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+X(i).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&r.float&&r.float!=="none"){var h=r.float==="left"?"left":"right";return i&&(l.clear==="both"||l.clear===h)?"vertical":"horizontal"}return s&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[bo]==="none"||i&&n[bo]==="none"&&c+u>o)?"vertical":"horizontal"},Ls=function(e,t,n){var o=n?e.left:e.top,s=n?e.right:e.bottom,i=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||s===l||o+i/2===r+c/2},ks=function(e,t){var n;return Sn.some(function(o){var s=o[oe].options.emptyInsertThreshold;if(!(!s||io(o))){var i=X(o),r=e>=i.left-s&&e<=i.right+s,l=t>=i.top-s&&t<=i.bottom+s;if(r&&l)return n=o}}),n},Wo=function(e){function t(s,i){return function(r,l,c,u){var h=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(s==null&&(i||h))return!0;if(s==null||s===!1)return!1;if(i&&s==="clone")return s;if(typeof s=="function")return t(s(r,l,c,u),i)(r,l,c,u);var m=(i?r:l).options.group.name;return s===!0||typeof s=="string"&&s===m||s.join&&s.indexOf(m)>-1}}var n={},o=e.group;(!o||un(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Yo=function(){!jo&&R&&k(R,"display","none")},Xo=function(){!jo&&R&&k(R,"display","")};kn&&!Oo&&document.addEventListener("click",function(a){if(yn)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),yn=!1,!1},!0);var je=function(e){if(S){e=e.touches?e.touches[0]:e;var t=ks(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[oe]._onDragOver(n)}}},Rs=function(e){S&&S.parentNode[oe]._isOutsideThisEl(e.target)};function L(a,e){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=e=ke({},e),a[oe]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return $o(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(i,r){i.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:L.supportPointer!==!1&&"PointerEvent"in window&&(!Ft||ao),emptyInsertThreshold:5};on.initializePlugins(this,a,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Wo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Ts,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(a,"pointerdown",this._onTapStart):(z(a,"mousedown",this._onTapStart),z(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(a,"dragover",this),z(a,"dragenter",this)),Sn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ke(this,Ns())}L.prototype={constructor:L,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(tt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,S):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,s=o.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(zs(n),!S&&!(/mousedown|pointerdown/.test(i)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Ft&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=ye(l,o.draggable,n,!1),!(l&&l.animated)&&fn!==l)){if(ot=ge(l),Ot=ge(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){_({sortable:t,rootEl:c,name:"filter",targetEl:l,toEl:n,fromEl:n}),ne("filter",t,{evt:e}),s&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(h){if(h=ye(c,h.trim(),n,!1),h)return _({sortable:t,rootEl:h,name:"filter",targetEl:l,fromEl:n,toEl:n}),ne("filter",t,{evt:e}),!0}),u)){s&&e.preventDefault();return}o.handle&&!ye(c,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,s=o.el,i=o.options,r=s.ownerDocument,l;if(n&&!S&&n.parentNode===s){var c=X(n);if(q=s,S=n,j=S.parentNode,$e=S.nextSibling,fn=n,rn=i.group,L.dragged=S,Ve={target:S,clientX:(t||e).clientX,clientY:(t||e).clientY},yo=Ve.clientX-c.left,So=Ve.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,S.style["will-change"]="all",l=function(){if(ne("delayEnded",o,{evt:e}),L.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!po&&o.nativeDraggable&&(S.draggable=!0),o._triggerDragStart(e,t),_({sortable:o,name:"choose",originalEvent:e}),re(S,i.chosenClass,!0)},i.ignore.split(",").forEach(function(u){Uo(S,u.trim(),Gn)}),z(r,"dragover",je),z(r,"mousemove",je),z(r,"touchmove",je),i.supportPointer?(z(r,"pointerup",o._onDrop),!this.nativeDraggable&&z(r,"pointercancel",o._onDrop)):(z(r,"mouseup",o._onDrop),z(r,"touchend",o._onDrop),z(r,"touchcancel",o._onDrop)),po&&this.nativeDraggable&&(this.options.touchStartThreshold=4,S.draggable=!0),ne("delayStart",this,{evt:e}),i.delay&&(!i.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(nn||Re))){if(L.eventCanceled){this._onDrop();return}i.supportPointer?(z(r,"pointerup",o._disableDelayedDrag),z(r,"pointercancel",o._disableDelayedDrag)):(z(r,"mouseup",o._disableDelayedDrag),z(r,"touchend",o._disableDelayedDrag),z(r,"touchcancel",o._disableDelayedDrag)),z(r,"mousemove",o._delayedDragTouchMoveHandler),z(r,"touchmove",o._delayedDragTouchMoveHandler),i.supportPointer&&z(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,i.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){S&&Gn(S),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._disableDelayedDrag),O(e,"touchend",this._disableDelayedDrag),O(e,"touchcancel",this._disableDelayedDrag),O(e,"pointerup",this._disableDelayedDrag),O(e,"pointercancel",this._disableDelayedDrag),O(e,"mousemove",this._delayedDragTouchMoveHandler),O(e,"touchmove",this._delayedDragTouchMoveHandler),O(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):t?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(S,"dragend",this),z(q,"dragstart",this._onDragStart));try{document.selection?pn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(nt=!1,q&&S){ne("dragStarted",this,{evt:t}),this.nativeDraggable&&z(document,"dragover",Rs);var n=this.options;!e&&re(S,n.dragClass,!1),re(S,n.ghostClass,!0),L.active=this,e&&this._appendGhost(),_({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(he){this._lastX=he.clientX,this._lastY=he.clientY,Yo();for(var e=document.elementFromPoint(he.clientX,he.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(he.clientX,he.clientY),e!==t);)t=e;if(S.parentNode[oe]._isOutsideThisEl(e),t)do{if(t[oe]){var n=void 0;if(n=t[oe]._onDragOver({clientX:he.clientX,clientY:he.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=xo(t));Xo()}},_onTouchMove:function(e){if(Ve){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,s=e.touches?e.touches[0]:e,i=R&&lt(R,!0),r=R&&i&&i.a,l=R&&i&&i.d,c=cn&&J&&vo(J),u=(s.clientX-Ve.clientX+o.x)/(r||1)+(c?c[0]-Fn[0]:0)/(r||1),h=(s.clientY-Ve.clientY+o.y)/(l||1)+(c?c[1]-Fn[1]:0)/(l||1);if(!L.active&&!nt){if(n&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(R){i?(i.e+=u-(Pn||0),i.f+=h-(An||0)):i={a:1,b:0,c:0,d:1,e:u,f:h};var m="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");k(R,"webkitTransform",m),k(R,"mozTransform",m),k(R,"msTransform",m),k(R,"transform",m),Pn=u,An=h,he=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!R){var e=this.options.fallbackOnBody?document.body:q,t=X(S,!0,cn,!0,e),n=this.options;if(cn){for(J=e;k(J,"position")==="static"&&k(J,"transform")==="none"&&J!==document;)J=J.parentNode;J!==document.body&&J!==document.documentElement?(J===document&&(J=Ce()),t.top+=J.scrollTop,t.left+=J.scrollLeft):J=Ce(),Fn=vo(J)}R=S.cloneNode(!0),re(R,n.ghostClass,!1),re(R,n.fallbackClass,!0),re(R,n.dragClass,!0),k(R,"transition",""),k(R,"transform",""),k(R,"box-sizing","border-box"),k(R,"margin",0),k(R,"top",t.top),k(R,"left",t.left),k(R,"width",t.width),k(R,"height",t.height),k(R,"opacity","0.8"),k(R,"position",cn?"absolute":"fixed"),k(R,"zIndex","100000"),k(R,"pointerEvents","none"),L.ghost=R,e.appendChild(R),k(R,"transform-origin",yo/parseInt(R.style.width)*100+"% "+So/parseInt(R.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,s=n.options;if(ne("dragStart",this,{evt:e}),L.eventCanceled){this._onDrop();return}ne("setupClone",this),L.eventCanceled||(V=qo(S),V.removeAttribute("id"),V.draggable=!1,V.style["will-change"]="",this._hideClone(),re(V,this.options.chosenClass,!1),L.clone=V),n.cloneId=pn(function(){ne("clone",n),!L.eventCanceled&&(n.options.removeCloneOnHide||q.insertBefore(V,S),n._hideClone(),_({sortable:n,name:"clone"}))}),!t&&re(S,s.dragClass,!0),t?(yn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(O(document,"mouseup",n._onDrop),O(document,"touchend",n._onDrop),O(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",s.setData&&s.setData.call(n,o,S)),z(document,"drop",n),k(S,"transform","translateZ(0)")),nt=!0,n._dragStartId=pn(n._dragStarted.bind(n,t,e)),z(document,"selectstart",n),Dt=!0,window.getSelection().removeAllRanges(),Ft&&k(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,s,i,r=this.options,l=r.group,c=L.active,u=rn===l,h=r.sort,m=Q||c,N,C=this,b=!1;if(Qn)return;function F(Mt,Qo){ne(Mt,C,Ee({evt:e,isOwner:u,axis:N?"vertical":"horizontal",revert:i,dragRect:o,targetRect:s,canSort:h,fromSortable:m,target:n,completed:U,onMove:function(uo,Jo){return dn(q,t,S,o,uo,X(uo),e,Jo)},changed:Z},Qo))}function B(){F("dragOverAnimationCapture"),C.captureAnimationState(),C!==m&&m.captureAnimationState()}function U(Mt){return F("dragOverCompleted",{insertion:Mt}),Mt&&(u?c._hideClone():c._showClone(C),C!==m&&(re(S,Q?Q.options.ghostClass:c.options.ghostClass,!1),re(S,r.ghostClass,!0)),Q!==C&&C!==L.active?Q=C:C===L.active&&Q&&(Q=null),m===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){F("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(n===S&&!S.animated||n===t&&!n.animated)&&(tt=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(S.parentNode[oe]._isOutsideThisEl(e.target),!Mt&&je(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),b=!0}function Z(){le=ge(S),Ae=ge(S,r.draggable),_({sortable:C,name:"change",toEl:t,newIndex:le,newDraggableIndex:Ae,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=ye(n,r.draggable,t,!0),F("dragOver"),L.eventCanceled)return b;if(S.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return U(!1);if(yn=!1,c&&!r.disabled&&(u?h||(i=j!==q):Q===this||(this.lastPutMode=rn.checkPull(this,c,S,e))&&l.checkPut(this,c,S,e))){if(N=this._getDirection(e,n)==="vertical",o=X(S),F("dragOverValid"),L.eventCanceled)return b;if(i)return j=q,B(),this._hideClone(),F("revert"),L.eventCanceled||($e?q.insertBefore(S,$e):q.appendChild(S)),U(!0);var K=io(t,r.draggable);if(!K||As(e,N,this)&&!K.animated){if(K===S)return U(!1);if(K&&t===e.target&&(n=K),n&&(s=X(n)),dn(q,t,S,o,n,s,e,!!n)!==!1)return B(),K&&K.nextSibling?t.insertBefore(S,K.nextSibling):t.appendChild(S),j=t,Z(),U(!0)}else if(K&&Ps(e,N,this)){var we=Nt(t,0,r,!0);if(we===S)return U(!1);if(n=we,s=X(n),dn(q,t,S,o,n,s,e,!1)!==!1)return B(),t.insertBefore(S,we),j=t,Z(),U(!0)}else if(n.parentNode===t){s=X(n);var Se=0,He,Tt=S.parentNode!==t,ae=!Ls(S.animated&&S.toRect||o,n.animated&&n.toRect||s,N),Lt=N?"top":"left",Me=mo(n,"top","top")||mo(S,"top","top"),kt=Me?Me.scrollTop:void 0;tt!==n&&(He=s[Lt],xt=!1,ln=!ae&&r.invertSwap||Tt),Se=Fs(e,n,s,N,ae?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,ln,tt===n);var Ie;if(Se!==0){var qe=ge(S);do qe-=Se,Ie=j.children[qe];while(Ie&&(k(Ie,"display")==="none"||Ie===R))}if(Se===0||Ie===n)return U(!1);tt=n,zt=Se;var Rt=n.nextElementSibling,De=!1;De=Se===1;var sn=dn(q,t,S,o,n,s,e,De);if(sn!==!1)return(sn===1||sn===-1)&&(De=sn===1),Qn=!0,setTimeout(Ds,30),B(),De&&!Rt?t.appendChild(S):n.parentNode.insertBefore(S,De?Rt:n),Me&&Ho(Me,0,kt-Me.scrollTop),j=S.parentNode,He!==void 0&&!ln&&(gn=Math.abs(He-X(n)[Lt])),Z(),U(!0)}if(t.contains(S))return U(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){O(document,"mousemove",this._onTouchMove),O(document,"touchmove",this._onTouchMove),O(document,"pointermove",this._onTouchMove),O(document,"dragover",je),O(document,"mousemove",je),O(document,"touchmove",je)},_offUpEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._onDrop),O(e,"touchend",this._onDrop),O(e,"pointerup",this._onDrop),O(e,"pointercancel",this._onDrop),O(e,"touchcancel",this._onDrop),O(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(le=ge(S),Ae=ge(S,n.draggable),ne("drop",this,{evt:e}),j=S&&S.parentNode,le=ge(S),Ae=ge(S,n.draggable),L.eventCanceled){this._nulling();return}nt=!1,ln=!1,xt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Jn(this.cloneId),Jn(this._dragStartId),this.nativeDraggable&&(O(document,"drop",this),O(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ft&&k(document.body,"user-select",""),k(S,"transform",""),e&&(Dt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),R&&R.parentNode&&R.parentNode.removeChild(R),(q===j||Q&&Q.lastPutMode!=="clone")&&V&&V.parentNode&&V.parentNode.removeChild(V),S&&(this.nativeDraggable&&O(S,"dragend",this),Gn(S),S.style["will-change"]="",Dt&&!nt&&re(S,Q?Q.options.ghostClass:this.options.ghostClass,!1),re(S,this.options.chosenClass,!1),_({sortable:this,name:"unchoose",toEl:j,newIndex:null,newDraggableIndex:null,originalEvent:e}),q!==j?(le>=0&&(_({rootEl:j,name:"add",toEl:j,fromEl:q,originalEvent:e}),_({sortable:this,name:"remove",toEl:j,originalEvent:e}),_({rootEl:j,name:"sort",toEl:j,fromEl:q,originalEvent:e}),_({sortable:this,name:"sort",toEl:j,originalEvent:e})),Q&&Q.save()):le!==ot&&le>=0&&(_({sortable:this,name:"update",toEl:j,originalEvent:e}),_({sortable:this,name:"sort",toEl:j,originalEvent:e})),L.active&&((le==null||le===-1)&&(le=ot,Ae=Ot),_({sortable:this,name:"end",toEl:j,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ne("nulling",this),q=S=j=R=$e=V=fn=Fe=Ve=he=Dt=le=Ae=ot=Ot=tt=zt=Q=rn=L.dragged=L.ghost=L.clone=L.active=null,bn.forEach(function(e){e.checked=!0}),bn.length=Pn=An=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":S&&(this._onDragOver(e),Ms(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,s=n.length,i=this.options;o<s;o++)t=n[o],ye(t,i.draggable,this.el,!1)&&e.push(t.getAttribute(i.dataIdAttr)||Os(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(s,i){var r=o.children[i];ye(r,this.options.draggable,o,!1)&&(n[s]=r)},this),t&&this.captureAnimationState(),e.forEach(function(s){n[s]&&(o.removeChild(n[s]),o.appendChild(n[s]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ye(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=on.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Wo(n)},destroy:function(){ne("destroy",this);var e=this.el;e[oe]=null,O(e,"mousedown",this._onTapStart),O(e,"touchstart",this._onTapStart),O(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(O(e,"dragover",this),O(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Sn.splice(Sn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Fe){if(ne("hideClone",this),L.eventCanceled)return;k(V,"display","none"),this.options.removeCloneOnHide&&V.parentNode&&V.parentNode.removeChild(V),Fe=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Fe){if(ne("showClone",this),L.eventCanceled)return;S.parentNode==q&&!this.options.group.revertClone?q.insertBefore(V,S):$e?q.insertBefore(V,$e):q.appendChild(V),this.options.group.revertClone&&this.animate(S,V),k(V,"display",""),Fe=!1}}};function Ms(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function dn(a,e,t,n,o,s,i,r){var l,c=a[oe],u=c.options.onMove,h;return window.CustomEvent&&!Re&&!nn?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=a,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=s||X(e),l.willInsertAfter=r,l.originalEvent=i,a.dispatchEvent(l),u&&(h=u.call(c,l,i)),h}function Gn(a){a.draggable=!1}function Ds(){Qn=!1}function Ps(a,e,t){var n=X(Nt(t.el,0,t.options,!0)),o=Vo(t.el,t.options,R),s=10;return e?a.clientX<o.left-s||a.clientY<n.top&&a.clientX<n.right:a.clientY<o.top-s||a.clientY<n.bottom&&a.clientX<n.left}function As(a,e,t){var n=X(io(t.el,t.options.draggable)),o=Vo(t.el,t.options,R),s=10;return e?a.clientX>o.right+s||a.clientY>n.bottom&&a.clientX>n.left:a.clientY>o.bottom+s||a.clientX>n.right&&a.clientY>n.top}function Fs(a,e,t,n,o,s,i,r){var l=n?a.clientY:a.clientX,c=n?t.height:t.width,u=n?t.top:t.left,h=n?t.bottom:t.right,m=!1;if(!i){if(r&&gn<c*o){if(!xt&&(zt===1?l>u+c*s/2:l<h-c*s/2)&&(xt=!0),xt)m=!0;else if(zt===1?l<u+gn:l>h-gn)return-zt}else if(l>u+c*(1-o)/2&&l<h-c*(1-o)/2)return Gs(e)}return m=m||i,m&&(l<u+c*s/2||l>h-c*s/2)?l>u+c/2?1:-1:0}function Gs(a){return ge(S)<ge(a)?1:-1}function Os(a){for(var e=a.tagName+a.className+a.src+a.href+a.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function zs(a){bn.length=0;for(var e=a.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&bn.push(n)}}function pn(a){return setTimeout(a,0)}function Jn(a){return clearTimeout(a)}kn&&z(document,"touchmove",function(a){(L.active||nt)&&a.cancelable&&a.preventDefault()});L.utils={on:z,off:O,css:k,find:Uo,is:function(e,t){return!!ye(e,t,e,!1)},extend:Ss,throttle:Bo,closest:ye,toggleClass:re,clone:qo,index:ge,nextTick:pn,cancelNextTick:Jn,detectDirection:$o,getChild:Nt,expando:oe};L.get=function(a){return a[oe]};L.mount=function(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(L.utils=Ee(Ee({},L.utils),n.utils)),on.mount(n)})};L.create=function(a,e){return new L(a,e)};L.version=vs;var Y=[],Pt,_n,eo=!1,On,zn,Nn,At;function xs(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return a.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):n.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?O(document,"dragover",this._handleAutoScroll):(O(document,"pointermove",this._handleFallbackAutoScroll),O(document,"touchmove",this._handleFallbackAutoScroll),O(document,"mousemove",this._handleFallbackAutoScroll)),No(),hn(),bs()},nulling:function(){Nn=_n=Pt=eo=At=On=zn=null,Y.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,s=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(s,i);if(Nn=t,n||this.options.forceAutoScrollFallback||nn||Re||Ft){xn(t,this.options,r,n);var l=xe(r,!0);eo&&(!At||s!==On||i!==zn)&&(At&&No(),At=setInterval(function(){var c=xe(document.elementFromPoint(s,i),!0);c!==l&&(l=c,hn()),xn(t,o.options,c,n)},10),On=s,zn=i)}else{if(!this.options.bubbleScroll||xe(r,!0)===Ce()){hn();return}xn(t,this.options,xe(r,!1),!1)}}},ke(a,{pluginName:"scroll",initializeByDefault:!0})}function hn(){Y.forEach(function(a){clearInterval(a.pid)}),Y=[]}function No(){clearInterval(At)}var xn=Bo(function(a,e,t,n){if(e.scroll){var o=(a.touches?a.touches[0]:a).clientX,s=(a.touches?a.touches[0]:a).clientY,i=e.scrollSensitivity,r=e.scrollSpeed,l=Ce(),c=!1,u;_n!==t&&(_n=t,hn(),Pt=e.scroll,u=e.scrollFn,Pt===!0&&(Pt=xe(t,!0)));var h=0,m=Pt;do{var N=m,C=X(N),b=C.top,F=C.bottom,B=C.left,U=C.right,Z=C.width,K=C.height,we=void 0,Se=void 0,He=N.scrollWidth,Tt=N.scrollHeight,ae=k(N),Lt=N.scrollLeft,Me=N.scrollTop;N===l?(we=Z<He&&(ae.overflowX==="auto"||ae.overflowX==="scroll"||ae.overflowX==="visible"),Se=K<Tt&&(ae.overflowY==="auto"||ae.overflowY==="scroll"||ae.overflowY==="visible")):(we=Z<He&&(ae.overflowX==="auto"||ae.overflowX==="scroll"),Se=K<Tt&&(ae.overflowY==="auto"||ae.overflowY==="scroll"));var kt=we&&(Math.abs(U-o)<=i&&Lt+Z<He)-(Math.abs(B-o)<=i&&!!Lt),Ie=Se&&(Math.abs(F-s)<=i&&Me+K<Tt)-(Math.abs(b-s)<=i&&!!Me);if(!Y[h])for(var qe=0;qe<=h;qe++)Y[qe]||(Y[qe]={});(Y[h].vx!=kt||Y[h].vy!=Ie||Y[h].el!==N)&&(Y[h].el=N,Y[h].vx=kt,Y[h].vy=Ie,clearInterval(Y[h].pid),(kt!=0||Ie!=0)&&(c=!0,Y[h].pid=setInterval((function(){n&&this.layer===0&&L.active._onTouchMove(Nn);var Rt=Y[this.layer].vy?Y[this.layer].vy*r:0,De=Y[this.layer].vx?Y[this.layer].vx*r:0;typeof u=="function"&&u.call(L.dragged.parentNode[oe],De,Rt,a,Nn,Y[this.layer].el)!=="continue"||Ho(Y[this.layer].el,De,Rt)}).bind({layer:h}),24))),h++}while(e.bubbleScroll&&m!==l&&(m=xe(m,!1)));eo=c}},30),Ko=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,s=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var c=n||s;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,h=document.elementFromPoint(u.clientX,u.clientY);l(),c&&!c.el.contains(h)&&(i("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function ro(){}ro.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=Nt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Ko};ke(ro,{pluginName:"revertOnSpill"});function lo(){}lo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Ko};ke(lo,{pluginName:"removeOnSpill"});L.mount(new xs);L.mount(lo,ro);const ie="favorites";var Qt,gt,pt,de,ht,Je,Ge,In,Jt,_t,Te,_e,ve,mt,vt,Tn,Oe,so;const d=class d{static init(){d.noFolderView()||!ui.scenes||(!d.folderListData||d.folderListData.length===0)&&(d.preloadTemplate(),d.folderListData=d.getFolders(ui.scenes.folders),d.selectedFolder=d.selectFolder(ie))}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||ie}static getParentFolders(e){const t=[];let n=ui.scenes.folders.find(s=>s.id===e);const o=new Set;for(;n!=null&&n.folder&&!o.has(n.id);){o.add(n.id);const s=n.folder;if(s)t.unshift(s),n=s;else break}return t}static registerHooks(){Hooks.on(x.CANVAS_INIT,()=>{var s,i;const e=(i=(s=game.scenes)==null?void 0:s.viewed)==null?void 0:i.id,t=g(d,de).length,n=t>0?g(d,de)[t-1]:null,o=t>0?g(d,de)[t-2]:null;(t===0||o!==e&&n!==e)&&(g(d,de).push(e),p.log(x.CANVAS_INIT,[g(d,de)]))}),Hooks.on(x.CREATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(x.UPDATE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(x.DELETE_FOLDER,e=>{e.type==="Scene"&&(d.refreshFolderView(),ui.nav.render())}),Hooks.on(x.CREATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(x.UPDATE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(x.DELETE_SCENE,()=>{d.refreshFolderView(),ui.nav.render()}),Hooks.on(x.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;const t=document.querySelector("#scenes .directory-list");t.addEventListener("contextmenu",o=>{var i;const s=o.target.closest(".directory-item");if(s&&(d.contextMenuSceneId=s.dataset.documentId||null,d.contextMenuSceneId)){const l=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",c=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+l);g(i=d,_t).call(i,c)}}),t.querySelectorAll("li.scene").forEach(o=>{var i;const s=game.scenes.get(o.dataset.sceneId||o.dataset.documentId);if(G.sceneClickToView&&(o.addEventListener("dblclick",g(d,vt)),o.addEventListener("click",g(d,mt))),G.useSceneIcons&&s&&((i=game.user)!=null&&i.isGM)){let r=document.createElement("i");r.classList.add("fas"),r.classList.add("icon"),s.ownership.default!==0?(s.active&&(r.classList.add("fa-bullseye"),o.prepend(r)),game.scenes.current.id===s.id&&(r.classList.add("fa-crown"),o.prepend(r))):(r.classList.add("fa-lock"),o.prepend(r))}})}),Hooks.on(x.RENDER_SCENE_NAV,()=>{document.querySelector("#navigation").addEventListener("contextmenu",t=>{var o;const n=t.target.closest(".nav-item");if(n&&(d.contextMenuSceneId=t.currentTarget.dataset.sceneId||n.dataset.sceneId||null,d.contextMenuSceneId)){const i=game.scenes.get(d.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",r=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+i);g(o=d,_t).call(o,r)}})}),Hooks.on(x.GET_SCENE_NAV_CONTEXT,(e,t)=>{t.find(o=>o.name==="CRLNGN_UI.ui.sceneNav.initialViewBtn")||t.push({...t[0],condition:o=>{var s;return((s=game.user)==null?void 0:s.isGM)&&game.scenes.get(o.data("sceneId"))._view},callback:o=>{let s=game.scenes.get(o.data("sceneId")),i=parseInt(canvas.stage.pivot.x),r=parseInt(canvas.stage.pivot.y),l=canvas.stage.scale.x;s.update({initial:{x:i,y:r,scale:l}},{diff:!1}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.initialViewSet"))},icon:'<i class="fas fa-expand"></i>',name:"CRLNGN_UI.ui.sceneNav.initialViewBtn"})})}};Qt=new WeakMap,gt=new WeakMap,pt=new WeakMap,de=new WeakMap,ht=new WeakMap,Je=new WeakMap,Ge=new WeakMap,In=new WeakMap,Jt=new WeakMap,_t=new WeakMap,Te=new WeakMap,_e=new WeakMap,ve=new WeakMap,mt=new WeakMap,vt=new WeakMap,Tn=new WeakMap,Oe=new WeakMap,so=new WeakMap,w(d,"selectedFolder"),w(d,"folderList"),w(d,"folderListData",[]),w(d,"searchValue",""),I(d,Qt,""),w(d,"contextMenuSceneId",null),I(d,gt,{}),I(d,pt),I(d,de,[]),w(d,"getFolders",e=>{const t=o=>{o.isOpen=g(d,gt)[o.id]??!1,o.children.forEach(t)};let n=e.filter(o=>o.folder===null);return n.forEach(t),n.sort((o,s)=>o.name.toLowerCase().localeCompare(s.name.toLowerCase())),n}),w(d,"selectFolder",e=>d.getFolderById(e)||null),w(d,"createFolderElem",()=>document.createElement("li")),w(d,"preloadTemplate",async()=>{const e=[`modules/${pe}/templates/scene-folder-list.hbs`];return await loadTemplates(e),!0}),w(d,"getFoldersData",e=>{const t=e.children.map(o=>d.getFoldersData(o.folder));return{...e,isOpen:g(d,gt)[e.id]||!1,children:t,hasSubfolders:t.length>0,id:e.id}}),I(d,ht,null),I(d,Je,null),I(d,Ge,null),w(d,"renderSceneFolders",async()=>{var u,h,m,N,C,b,F;if(d.noFolderView()||!d.selectedFolder)return;P(d,Qt,game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"));const e=d.getFolders(ui.scenes.folders),t=`CRLNGN_UI.settings.sceneNavMenu.fields.useNavBackButton.options.${G.useNavBackButton}`;d.selectedFolder;const n={favoritesId:ie,favoritesName:g(d,Qt),folderList:e.map(B=>d.getFoldersData(B)),viewedSceneId:game.scenes.current.id,users:game.users.contents,isGM:(u=game.user)==null?void 0:u.isGM,searchValue:d.searchValue,showSearchResults:!!d.searchValue,useNavBackButton:d.isBackBtnActive(),backButtonLabel:d.isBackBtnActive()?game.i18n.localize(t):"",useSceneIcons:G.useSceneIcons,useScenePreview:G.useScenePreview,sceneNavAlias:G.sceneNavAlias,showRootFolders:G.navShowRootFolders};if(p.log("rootFolders",[(h=ui.scenes)==null?void 0:h.folders,game.folders]),d.selectedFolder===ie){const B=G.navShowRootFolders?((m=ui.scenes)==null?void 0:m.folders.filter(U=>U.folder===null))||[]:[];P(d,ht,{...n,currFolder:{name:"",id:ie},currIcon:"fa-map",folders:B,scenes:ui.nav.scenes.filter(U=>U.permission>=2),hasParents:!1,parentFolders:[]})}else{const B=d.selectedFolder.children,U=d.getParentFolders(d.selectedFolder.id),Z=[...d.selectedFolder.contents];Z.sort((K,we)=>K.sort-we.sort),P(d,ht,{...n,currFolder:d.selectedFolder,currIcon:"fa-folder",folders:B,scenes:Z,hasParents:U.length>0,parentFolders:U})}P(d,Je,document.querySelector("#crlngn-scene-folders")),P(d,Ge,document.querySelector("#crlngn-scene-list")),(N=g(d,Je))==null||N.remove(),(C=g(d,Ge))==null||C.remove();const o=await renderTemplate(`modules/${pe}/templates/scene-folder-list.hbs`,g(d,ht)),s=document.querySelector("#scene-list");s.insertAdjacentHTML("beforebegin",o),P(d,Je,document.querySelector("#crlngn-scene-folders")),P(d,Ge,document.querySelector("#crlngn-scene-list")),s==null||s.classList.add("hidden");const i=g(d,Ge),r=i.querySelectorAll("li.nav-item"),l=G.navPos||0,c=parseInt((b=r[l])==null?void 0:b.offsetLeft)*-1;i.style.marginLeft=c+"px",d.activateFolderListeners(g(d,Je)),g(F=d,In).call(F,g(d,Ge)),G.resetLocalVars()}),w(d,"isBackBtnActive",()=>G.useNavBackButton===Ye.lastScene.name?g(d,de).length>1:G.useNavBackButton===Ye.defaultScenes.name?d.selectedFolder!==ie:!1),w(d,"activateFolderListeners",e=>{if(d.noFolderView())return;const t=e.querySelector("i.fa-turn-left");p.log("navBackButton",[e,t]),t==null||t.addEventListener("click",g(d,Tn));const n=e.querySelector("a.selected");G.showFolderListOnClick?(n==null||n.removeEventListener("mouseover",g(d,Te)),e.removeEventListener("mouseleave",g(d,Te)),n==null||n.addEventListener("click",g(d,Te))):(n==null||n.addEventListener("mouseover",g(d,Te)),e.addEventListener("mouseleave",g(d,Te)),n==null||n.removeEventListener("click",g(d,Te))),e.querySelectorAll(".parent-folder").forEach(r=>{r.addEventListener("click",g(d,Oe))}),e.querySelectorAll("span.toggle").forEach(r=>{r.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();const c=l.currentTarget.closest("li"),u=c.dataset.folderId,h=c.querySelector("ol.subfolders");let m=!1;if(!h)return;!h.classList.contains("open")?(h.classList.add("open"),m=!0):(h.classList.remove("open"),m=!1),l.currentTarget.textContent=m?"−":"+",g(d,gt)[u]=m})}),e.querySelectorAll(".folder-list li.folder").forEach(r=>{r.addEventListener("click",g(d,Oe))});const s=e.querySelector(".search-container .input-scene-search");s.addEventListener("keyup",d.onSearchInput),s.addEventListener("keydown",r=>{r.stopPropagation()}),e.querySelector(".search-container .back-to-favorites").addEventListener("click",g(d,Oe))}),I(d,In,e=>{var n,o;e.querySelectorAll("li.nav-item").forEach(s=>{const i=s.classList.contains("folder");s.addEventListener("click",i?g(d,Oe):g(d,mt)),s.addEventListener("dblclick",i?()=>{}:g(d,vt))}),(n=game.user)!=null&&n.isGM&&g(o=d,Jt).call(o,e)}),I(d,Jt,e=>{clearInterval(g(d,pt));let t=0;if(!L&&t<5){P(d,pt,setTimeout(()=>{var i;return g(i=d,Jt).call(i,e)},500)),t++;return}clearInterval(g(d,pt));const n={animation:200,delay:100,delayOnTouchOnly:!0,onStart:function(){e.querySelectorAll(".scene.nav-item").forEach(i=>i.classList.add("no-hover")),this.el.classList.add("no-hover")},onEnd:function(){e.querySelectorAll(".scene.nav-item").forEach(i=>i.classList.remove("no-hover")),this.el.classList.remove("no-hover")}},o={...n,draggable:".scene.nav-item",onEnd:async i=>{var N,C;const r=e.querySelectorAll(".scene.nav-item"),l=[],c=Array.from(r).map(b=>game.scenes.get(b.dataset.sceneId));let u=0;const h=CONST.SORT_INTEGER_DENSITY;for(const b of c){if(!b)continue;const F={_id:b.id};d.selectedFolder===ie?b.navigation&&(F.navOrder=u,u+=h):d.selectedFolder&&((N=b.folder)==null?void 0:N.id)===d.selectedFolder.id&&(F.sort=u,u+=h),l.push(F)}const m=game.scenes.contents.filter(b=>!l.some(F=>F._id===b.id));m.sort((b,F)=>{var B,U;if(d.selectedFolder===ie)return!b.navigation&&!F.navigation?0:b.navigation?F.navigation?b.navOrder-F.navOrder:-1:1;{const Z=((B=b.folder)==null?void 0:B.id)===d.selectedFolder.id,K=((U=F.folder)==null?void 0:U.id)===d.selectedFolder.id;return!Z&&!K?0:Z?K?b.sort-F.sort:-1:1}});for(const b of m)d.selectedFolder===ie?b.navigation&&(l.push({_id:b.id,navOrder:u}),u+=h):((C=b.folder)==null?void 0:C.id)===d.selectedFolder.id&&(l.push({_id:b.id,sort:u}),u+=h);l.length&&(await Scene.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}},s={...n,draggable:".folder.nav-item",onEnd:async i=>{var N,C;const r=e.querySelectorAll(".folder.nav-item"),l=[],c=Array.from(r).map(b=>{const F=b.dataset.folderId;return game.scenes.folders.find(B=>B.id===F)}).filter(b=>b);let u=0;const h=CONST.SORT_INTEGER_DENSITY;for(const b of c)b&&((N=b.folder)==null?void 0:N.id)===((C=d.selectedFolder)==null?void 0:C.id)&&(l.push({_id:b.id,sort:u}),u+=h);const m=game.scenes.folders.filter(b=>{var F,B;return((F=b.folder)==null?void 0:F.id)===((B=d.selectedFolder)==null?void 0:B.id)&&!l.some(U=>U._id===b.id)}).sort((b,F)=>b.sort-F.sort);for(const b of m)l.push({_id:b.id,sort:u}),u+=h;l.length&&(await Folder.updateDocuments(l),ui.nav.render(),game.scenes.directory.render())}};L.create(e,o),L.create(e,s)}),w(d,"refreshFolderView",async()=>{d.noFolderView()||(d.folderListData=d.getFolders(ui.scenes.folders),await d.renderSceneFolders(),G.placeNavButtons())}),w(d,"updateSearchResults",e=>{if(d.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=game.scenes.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())&&s.permission>=2),o=game.scenes.folders.filter(s=>s.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),o.forEach(s=>{const i=document.createElement("li");i.className="folder",i.dataset.folderId=s.id,i.innerHTML=`<a><i class="fas fa-folder"></i> ${s.name}</a>`,i.addEventListener("click",g(d,Oe)),t.appendChild(i)}),n.forEach(s=>{const i=document.createElement("li");i.className="scene",i.dataset.sceneId=s.id,i.innerHTML=`<a><i class="fas fa-map"></i> ${s.name}</a>`,i.addEventListener("dblclick",g(d,vt)),i.addEventListener("click",g(d,mt)),t.appendChild(i)}),o.length===0&&n.length===0){const s=document.createElement("li");s.className="no-results",s.textContent="No matching results found",t.appendChild(s)}}),I(d,_t,e=>{const t=()=>{const o=document.querySelector("#context-menu");if(!o)return!1;const s=o.querySelectorAll(".context-item"),i=Array.from(s).find(r=>r.innerHTML.includes(game.i18n.localize("SCENES.ToggleNav")));return i?(i.innerHTML=`<i class="fas fa-compass fa-fw"></i>${e}`,!0):!1};if(t())return;const n=new MutationObserver((o,s)=>{t()&&s.disconnect()});n.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>n.disconnect(),1e3)}),I(d,Te,e=>{e.stopPropagation(),e.preventDefault();const t=document.querySelector("#crlngn-scene-folders"),n=e.type.startsWith("mouse"),o=!G.showFolderListOnClick;if(n&&o&&e.type==="mouseover"){t!=null&&t.classList.contains("open")||t==null||t.classList.add("open");return}if(n&&o&&e.type==="mouseleave"){t==null||t.classList.remove("open");return}n||(t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),document.addEventListener("click",g(d,_e))))}),I(d,_e,e=>{e.preventDefault(),document.removeEventListener("click",g(d,_e));const t=e.target,n=document.querySelector("#crlngn-scene-folders");n!=null&&n.classList.contains("open")&&!n.contains(t)&&n.classList.remove("open")}),I(d,ve,null),I(d,mt,e=>{var i;e.preventDefault(),e.stopPropagation(),document.removeEventListener("click",g(d,_e));const t=e.currentTarget,n=t.dataset,o=game.scenes.get(n.sceneId||n.documentId),s=(i=t.parentElement)==null?void 0:i.classList.contains("search-results");g(d,ve)&&(clearTimeout(g(d,ve)),P(d,ve,null)),P(d,ve,setTimeout(()=>{s&&(o.navigation=!0,d.selectedFolder=d.selectFolder(ie)),o.view(),d.refreshFolderView(),P(d,ve,null)},250))}),I(d,vt,e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset,o=game.scenes.get(n.sceneId||n.documentId);g(d,ve)&&(clearTimeout(g(d,ve)),P(d,ve,null)),o.activate(),d.refreshFolderView()}),I(d,Tn,e=>{var t;switch(e.stopPropagation(),e.preventDefault(),G.useNavBackButton){case Ye.defaultScenes.name:d.selectedFolder=d.selectFolder(ie),p.log("onBackButton",[Ye.defaultScenes.name]);break;case Ye.lastScene.name:const n=g(d,de).length,o=n?g(d,de)[n-2]:null,s=o?(t=game.scenes)==null?void 0:t.get(o):null;if(s){s.view();const r=!(s.folder&&d.selectedFolder.id===s.folder.id)&&s.navigation||!s.folder?ie:s.folder.id;d.selectedFolder=d.selectFolder(r),g(d,de).splice(n-1,1)}p.log("onBackButton",[s,o,g(d,de)]);break}d.refreshFolderView()}),I(d,Oe,e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("click",g(d,_e));const n=e.currentTarget.dataset,o=d.selectFolder(n.folderId||"");o!==d.selectedFolder&&(G.navPos=0),d.selectedFolder=o,d.refreshFolderView()}),w(d,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;d.searchValue=n,d.updateSearchResults(n)}),I(d,so,e=>{var o,s,i,r;e.preventDefault(),e.stopPropagation();let t=((s=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:s.sceneId)||"",n=((r=(i=e.currentTarget)==null?void 0:i.dataset)==null?void 0:r.folderId)||"";t?game.scenes.get(t).view():n&&(d.selectedFolder=d.selectFolder(n),d.refreshFolderView())}),w(d,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!G.navFoldersForPlayers||!G.navFoldersEnabled||!G.sceneNavEnabled});let te=d;var yt;const y=class y{static registerSettings(){const e=E();p.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async r=>{const l=r[1];p.log("Registering... ",[r],!0);const c={name:l.label,hint:l.hint,default:l.default,type:l.propType,scope:l.scope,config:l.config,requiresReload:l.requiresReload||!1,onChange:u=>y.apply(l.tag,u)};l.choices&&(c.choices=l.choices),await game.settings.register(pe,l.tag,c),y.get(l.tag)==null&&(p.log("resetting...",[l.tag]),y.set(l.tag,l.default)),game.keybindings.register(pe,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{y.hideInterface()},restricted:!1})}),y.applyThemeSettings(),y.applyCustomCSS(),y.applyModuleAdjustments(),Object.entries(gs()).forEach(async r=>{const l=r[1],c={name:l.tag,label:l.label,hint:l.hint,icon:l.icon,type:l.propType,restricted:l.restricted};await game.settings.registerMenu(pe,l.tag,c)}),Hooks.on(x.RENDER_SCENE_CONTROLS,y.applyLeftControlsSettings),Hooks.on(x.RENDER_PLAYERS_LIST,y.applyPlayersListSettings),Hooks.on(x.RENDER_HOTBAR,()=>{y.firstLoad&&(y.firstLoad=!1,y.applyHotBarCollapse()),y.applyHotBarSettings()}),y.applyDebugSettings(),y.applyChatStyles(),y.applyBorderColors(),e.sceneNavMenu.fields.forEach(r=>{y.apply(e[r].tag)}),e.customFontsMenu.fields.forEach(r=>{y.applyCustomFonts(e[r].tag)}),e.leftControlsMenu.fields.forEach(r=>{y.applyLeftControlsSettings(e[r].tag)}),y.applyUiScale()}static get(e,t=pe){if(!e)return null;let n=!1;if(t===pe)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,p.log("GET Setting",[s,n])}return n}static set(e,t,n=pe){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),p.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{p.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,s,i,r;const n=E();switch(t===void 0&&(t=y.get(e)),p.log("SettingsUtil.apply",[e,t,y.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:y.applyHotBarSettings();break;case n.collapseMacroBar.tag:y.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:y.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:y.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:case n.hideFoundryLogo.tag:y.applyLeftControlsSettings(e,t);break;case n.cameraDockMenu.tag:y.applyCameraPosX(),y.applyCameraPosY(),y.applyCameraWidth(),y.applyCameraHeight();break;case n.chatBorderColor.tag:bt.chatBorderColor=y.get(n.chatBorderColor.tag),p.log("SettingsUtil.apply",[e]),y.applyBorderColors();break;case n.enableChatStyles.tag:bt.enableChatStyles=y.get(n.enableChatStyles.tag),p.log("SettingsUtil.apply",[e]),y.applyChatStyles();break;case n.enforceDarkMode.tag:y.resetFoundryThemeSettings();break;case n.debugMode.tag:y.applyDebugSettings();break;case n.sceneNavEnabled.tag:G.sceneNavEnabled=t;break;case n.navFoldersEnabled.tag:G.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:G.navShowRootFolders=t;break;case n.sceneClickToView.tag:G.sceneClickToView=t,(o=game.scenes)==null||o.directory.render(),te.refreshFolderView();break;case n.useSceneIcons.tag:G.useSceneIcons=t,(s=game.scenes)==null||s.directory.render(),te.refreshFolderView();break;case n.useNavBackButton.tag:G.useNavBackButton=t,(i=ui.nav)==null||i.render();break;case n.useScenePreview.tag:G.useScenePreview=t,(r=ui.nav)==null||r.render();break;case n.sceneNavAlias.tag:G.sceneNavAlias=t,te.refreshFolderView();break;case n.navStartCollapsed.tag:G.navStartCollapsed=t;break;case n.showFolderListOnClick.tag:G.showFolderListOnClick=t,te.refreshFolderView();break;case n.showNavOnHover.tag:G.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:G.isCollapsed=y.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:y.applySceneNavPos();break;case n.colorTheme.tag:y.applyThemeSettings();break;case n.customStyles.tag:y.applyCustomCSS();break;case n.adjustOtherModules.tag:y.applyModuleAdjustments();break;case n.uiScale.tag:y.applyUiScale(t);break}}static applyBorderColors(){const e=E(),t=y.get(e.chatBorderColor.tag),n=document.querySelector("body");t===St.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===St.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=E(),t=y.get(e.enableChatStyles.tag),n=document.querySelector("body");p.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=E(),t=y.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=E();y.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const n=E(),o=y.get(n.sceneNavEnabled.tag),s=document.querySelector("#ui-left"),i=document.querySelector("#ui-left #logo"),r=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),p.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:y.get(n.controlsAutoHide.tag)?s.classList.add("auto-hide"):s.classList.remove("auto-hide");break;case n.hideFoundryLogo.tag:const c=window.getComputedStyle(r).getPropertyValue("--top-nav-height")||"0px",u=parseFloat(c)||0,h=y.get(n.hideFoundryLogo.tag);p.log("applyLeftControlsSettings",[e,u,c]),h===void 0||h===!0?(i.classList.remove("visible"),D.addCSSVars("--ui-top-padding",`${u}px`),document.querySelector("body").classList.remove("logo-visible")):(i.classList.add("visible"),o?(D.addCSSVars("--ui-top-padding",`${72+u}px`),document.querySelector("body").classList.add("logo-visible")):D.addCSSVars("--ui-top-padding","72px"));break;case n.controlsBottomBuffer.tag:y.applyControlsBuffer();break;case n.controlsIconSize.tag:y.applyControlIconSize();break}}static applyControlIconSize(){const e=E(),t=y.get(e.controlsIconSize.tag);document.querySelector("body");const n=We[t]?We[t].size:We.regular.size;function o(s){switch(s){case We.large.name:return"var(--font-size-18);";case We.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}p.log("applyControlIconSize",[n]),D.addCSSVars("--icon-font-size",o(t)),D.addCSSVars("--left-control-item-size",n),y.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyUiScale(e){var o,s,i,r,l,c;const t=E(),n=e||y.get(t.uiScale.tag);n===Un.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(s=document.querySelector("#interface"))==null||s.classList.remove("scale-large"),y.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","50px")):n===Un.large.name?((i=document.querySelector("#interface"))==null||i.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),y.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(c=document.querySelector("#interface"))==null||c.classList.remove("scale-large"),y.set(t.controlsIconSize.tag,n),D.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=E(),t=y.get(e.leftControlsMenu.tag),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;D.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,n;const e=E();p.log("applyPlayersListSettings",[document.querySelector("#players"),y.get(e.autoHidePlayerList.tag)]),y.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),mn.checkPlayersList()}static applySceneNavPos(e){const t=E();G.navPos=e||y.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockPosX;Xe.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockPosY;Xe.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockWidth;Xe.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=E(),n=y.get(t.cameraDockMenu.tag),o=e||n.dockHeight;Xe.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=E(),o=n.customFontsMenu.fields,s={};switch(p.log("applyCustomFonts",[e,t]),o.forEach(i=>{s[i]=y.get(n[i].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:D.addCSSVars("--crlngn-font-family",t||s.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:D.addCSSVars("--crlngn-font-titles",t||s.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:D.addCSSVars("--crlngn-font-journal-body",t||s.journalFontBody||s.journalFontBody||"");break;case n.journalFontTitles.tag:D.addCSSVars("--crlngn-font-journal-title",t||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var i,r;const e=E(),t=D.isModuleOn("monks-player-settings"),n=D.isModuleOn("force-client-settings"),o=y.get(e.enforceDarkMode.tag);if(o&&t){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),y.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),y.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","colorScheme");p.log("resetFoundryThemeSettings",[s,o]),s===!1&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=E();p.debugOn=e||y.get(t.debugMode.tag)}};yt=new WeakMap,I(y,yt,!1),w(y,"firstLoad",!0),w(y,"applyThemeSettings",e=>{const t=E(),n=e||y.get(t.colorTheme.tag)||"",o=document.querySelector("body");p.log("applyThemeSettings",[e,n,y.get(t.colorTheme.tag)]),Pe.forEach(s=>{s.className&&o.classList.remove(s.className)}),n&&o.classList.add(n)}),w(y,"applyCustomCSS",e=>{const t=E(),n=e||y.get(t.customStyles.tag)||"";D.addCustomCSS(n)}),w(y,"applyModuleAdjustments",e=>{const t=E(),n=e||y.get(t.adjustOtherModules.tag)||!1,o=document.querySelector("body");n?o.classList.add("crlngn-enforce-styles"):o.classList.remove("crlngn-enforce-styles")}),w(y,"hideInterface",()=>{p.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");g(y,yt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),P(y,yt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),P(y,yt,!0))});let T=y;class co{static init(){Hooks.on(x.RENDER_PLAYERS_LIST,co.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const n=e.offsetHeight;D.addCSSVars("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var ze,en,tn;const W=class W{static init(){p.log("LeftControls - init",[]),Hooks.on(x.RENDER_SCENE_CONTROLS,W.initSceneControls),W.initSceneControls()}static resetLocalVars(){P(W,ze,document.querySelector("#ui-left #controls")),P(W,en,document.querySelector("#ui-left"))}static initSceneControls(){p.log("initSceneControls",[]),W.resetLocalVars(),W.observeControlsWidth()}static observeControlsWidth(){if(p.log("observeControlsWidth",[]),!g(W,ze))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};P(W,tn,new ResizeObserver(n=>{t(()=>W.updateCSSVars(),250)})),g(W,tn).observe(g(W,ze),{box:"border-box"}),W.updateCSSVars()}static updateCSSVars(){if(!g(W,ze))return;let e=parseInt(g(W,en).offsetWidth),t=parseInt(g(W,ze).offsetWidth),n=-e+t;p.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&D.addCSSVars("--ui-controls-margin-left",n+"px")}};ze=new WeakMap,en=new WeakMap,tn=new WeakMap,I(W,ze),I(W,en),I(W,tn);let to=W;class Zo{static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static async checkForUpdates(){const e=E();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){p.warn("checkForUpdates | Failed to fetch update news",[t]);return}const n=await t.json(),o=T.get(e.lastUpdateId.tag);if(p.log("checkForUpdates...",[n.id,o]),n.id===o)return;await this.displayUpdateNews(n),T.set(e.lastUpdateId.tag,n.id),p.log("checkForUpdates SUCCESS",[n.id])}catch(t){p.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}w(Zo,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json?v="+new Date().getTime());var Ln;const Ut=class Ut{static init(){Hooks.once(x.INIT,()=>{var n,o;document.querySelector("body").classList.add(pe),(n=document.querySelector("#ui-middle"))==null||n.classList.add(pe),p.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},T.registerSettings();const e=E(),t=T.get(e.disableUI.tag);if(p.log(x.INIT,[t]),t){document.querySelector("body").classList.remove(pe),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(pe);return}G.navFoldersEnabled&&(window.crlngnUI.SceneNavFolders=te,te.init()),G.init(),Xe.init(),co.init(),to.init(),bt.init(),Hooks.on(x.RENDER_CHAT_MESSAGE,g(Ut,Ln))}),Hooks.once(x.READY,()=>{p.log("Core Ready",[]);const e=E();p.log("Available libraries:",[Object.keys(window).filter(s=>typeof window[s]=="function"&&/^[A-Z]/.test(s)&&s.length>3)]);var t=T.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),mn.init(),G.checkSceneNavCompat(),Zo.init(),G.navFoldersEnabled&&(te.init(),te.registerHooks()),T.get(e.enableChatStyles.tag)&&Ut.addCSSLocalization(),T.resetFoundryThemeSettings(),D.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";D.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),D.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),D.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),D.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),D.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),D.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),D.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),D.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),D.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),D.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Ln=new WeakMap,I(Ut,Ln,(e,t)=>{p.log(x.RENDER_CHAT_MESSAGE,[e,t]),bt.enrichCard(e,t)});let no=Ut;no.init();
//# sourceMappingURL=crlngn-ui.js.map
