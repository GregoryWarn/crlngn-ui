var ns=Object.defineProperty;var fo=i=>{throw TypeError(i)};var os=(i,e,t)=>e in i?ns(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var S=(i,e,t)=>os(i,typeof e!="symbol"?e+"":e,t),yn=(i,e,t)=>e.has(i)||fo("Cannot "+t);var N=(i,e,t)=>(yn(i,e,"read from private field"),t?t.call(i):e.get(i)),I=(i,e,t)=>e.has(i)?fo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),F=(i,e,t,n)=>(yn(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),O=(i,e,t)=>(yn(i,e,"access private method"),t);const U={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_SIDE_BAR:"renderSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",COMBAT_START:"combatStart",COMBAT_ROUND_START:"combatRound",RENDER_ACTOR_SHEET:"renderActorSheet"},B="crlngn-ui",Jt=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],un=class un{static log(e="",t=[],n=!1){try{const o=un.debugOn;if(!(n||o))return;console.log(...Jt,e,...t)}catch{console.log(...Jt,e,...t)}}static warn(e="",t=[]){console.warn(...Jt,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Jt,e)}};S(un,"debugOn",!1);let g=un;const R={select:"select",checkbox:"checkbox",text:"text",number:"number"},w={client:"client",world:"world"},je={small:{name:"small",size:"38px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Rn={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},lt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},nt={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},po=140,De=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(49, 140, 231)"]}];function v(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:R.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:w.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles","useHorizontalSheetTabs","applyThemeToSheets"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock'",customStyles:"",useHorizontalSheetTabs:!0,applyThemeToSheets:!0},scope:w.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:R.button,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:lt.playerColor.name,useLeftChatBorder:!1},scope:w.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:R.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:je.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:w.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:R.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth","dockWasResized"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:nt.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140,dockWasResized:!1},scope:w.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:R.button,fields:["sceneNavEnabled","useSceneFolders","navShowSceneFolders","openFolderOnSceneLoad","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useSceneLookup","useScenePreview"],default:{sceneNavEnabled:!0,useSceneFolders:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,navShowSceneFolders:!1,openFolderOnSceneLoad:!1,showNavOnHover:!1,useScenePreview:!0,useSceneLookup:!0,useSceneBackButton:!0},scope:w.client,config:!1,requiresReload:!0},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:w.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:R.select,propType:String,default:Rn.small.name,scope:w.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!1},useSceneFolders:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!1},openFolderOnSceneLoad:{tag:"open-folder-on-scene-load",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.openFolderOnSceneLoad.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.openFolderOnSceneLoad.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.world,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!1},navShowSceneFolders:{tag:"v1-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowSceneFolders.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.world,config:!1},useSceneBackButton:{tag:"v1-use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.world,config:!1},useSceneLookup:{tag:"use-scene-lookup",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:R.text,default:"",scope:w.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:R.number,default:0,scope:w.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:w.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:w.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:w.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:w.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:R.text,propType:String,default:"",scope:w.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:w.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:R.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'","Party HUD":"'party-monitor-dock'"},scope:w.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:R.text,propType:String,default:"",scope:w.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:R.text,default:lt.playerColor.name,scope:w.client,config:!1},useLeftChatBorder:{tag:"use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:w.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:w.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:R.number,default:200,scope:w.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:R.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:je.small.name,scope:w.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:w.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:R.checkbox,propType:Boolean,default:!0,scope:w.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:R.checkbox,propType:Boolean,default:!0,scope:w.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:R.number,propType:Number,default:0,scope:w.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:R.number,propType:Number,default:120,scope:w.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:R.number,propType:Number,default:160,scope:w.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:R.number,propType:Number,default:145,scope:w.client,config:!1},dockWasResized:{tag:"dock-was-resized",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:w.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:R.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:nt.off.name,scope:w.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:R.number,propType:Number,default:160,scope:w.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:w.world,config:!1,default:""},applyThemeToSheets:{tag:"v1-apply-theme-and-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyThemeToSheets.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyThemeToSheets.hint"),propType:Boolean,default:!0,scope:w.world,config:!1,requiresReload:!1},useHorizontalSheetTabs:{tag:"v1-use-horizontal-tabs",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useHorizontalSheetTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useHorizontalSheetTabs.hint"),propType:Boolean,default:!0,scope:w.client,config:!1,requiresReload:!1}}}const{ApplicationV2:ss,HandlebarsApplicationMixin:as}=foundry.applications.api;var ut,To,Lo,At,Dn;const ye=class ye extends as(ss){constructor(){super(...arguments);I(this,At)}static get DEFAULT_OPTIONS(){return{id:v().cameraDockMenu.tag,actions:{redefine:O(ye,ut,Lo)},form:{handler:O(ye,ut,To),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var d;const n=v(),o=n.cameraDockMenu.fields,s={},a={},r={};o.forEach(u=>{if(g.log("_prepareContext",[n[u].oldName]),n[u]){const p=C.get(n[u].tag);s[u]=n[u],a[u]=p!==void 0?p:n[u].default,r[u]=n[u].default}});const l={...a,default:{...r},isGM:(d=game.user)==null?void 0:d.isGM,fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var a;g.log("_onRender",[t,n]),ye.element=this.element,ye.element.querySelector(".toggle-hint").addEventListener("click",()=>{ye.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(a=this.element)==null?void 0:a.querySelector('input[name="enableFloatingDock"]');g.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",O(this,At,Dn).bind(this)),O(this,At,Dn).call(this,{target:s}))}};ut=new WeakSet,To=async function(t,n,o){const s=v();t.preventDefault(),t.stopPropagation();const a=s.cameraDockMenu.fields,r=o.object;a.forEach(p=>{s[p].inputType==="checkbox"&&!r.hasOwnProperty(p)&&(r[p]=!1)});const l=foundry.utils.expandObject(r),d=C.get(s.enableFloatingDock.tag);g.log("Compared settings:",[l.enableFloatingDock,d]),a.forEach(p=>{g.log("Saving setting >>",[s[p].tag,l[p]]),l[p]!==void 0&&C.set(s[p].tag,l[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==d&&location.reload()},Lo=async function(t,n){const o=v(),a=this.element.querySelectorAll("input, select"),r=o.cameraDockMenu.fields,l={};r.forEach(d=>{o[d]&&(o[d],l[d]=o[d].default)}),a.forEach(d=>{d.value=l[d.name]}),g.log("#onReset",[t,n,o.cameraDockMenu.default])},At=new WeakSet,Dn=function(t){var s,a;const n=(s=this.element)==null?void 0:s.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(r=>r.disabled=!t.target.checked);const o=(a=this.element)==null?void 0:a.querySelectorAll("select");o.forEach(r=>r.disabled=!t.target.checked),g.log("onDockEnabledChange",[this.element,n,o])},I(ye,ut),S(ye,"element"),S(ye,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Mn=ye;const{ApplicationV2:is,HandlebarsApplicationMixin:rs}=foundry.applications.api;var Zn,gt,wo,ko;const be=class be extends rs(is){static get DEFAULT_OPTIONS(){return{id:v().chatMessagesMenu.tag,actions:{redefine:O(be,gt,ko)},form:{handler:O(be,gt,wo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var l;const t=v(),n=t.chatMessagesMenu.fields,o={},s={},a={};n.forEach(d=>{if(g.log("_prepareContext",[t[d].oldName]),t[d]){const u=C.get(t[d].tag);o[d]=t[d],s[d]=u!==void 0?u:t[d].default,a[d]=t[d].default}}),g.log("_prepareContext",[s,a]);const r={...s,default:{...a},isGM:(l=game.user)==null?void 0:l.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=v();be.element=this.element,be.element.querySelector(".toggle-hint").addEventListener("click",()=>{be.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=C.get(n.chatMessagesMenu.tag);g.log("_onRender",[e,t,s])}};Zn=new WeakMap,gt=new WeakSet,wo=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const s=o.chatMessagesMenu.fields,a=n.object;s.forEach(u=>{o[u].inputType==="checkbox"&&!a.hasOwnProperty(u)&&(a[u]=!1)});const r=foundry.utils.expandObject(a),l=C.get(o.chatBorderColor.tag);g.log("Compared settings:",[r.chatBorderColor,l]),s.forEach(u=>{g.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&C.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ko=async function(e,t){const n=v(),s=this.element.querySelectorAll("input, select"),a=n.chatMessagesMenu.fields,r={};a.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(be,gt),I(be,Zn),S(be,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Pn=be;class k{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([a])=>a),o=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(a=>!/FontAwesome|Font Awesome|FoundryVTT/.test(a)).map(a=>a.replace(/['"]/g,"").trim()).sort((a,r)=>a.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,s=o.indexOf("body.crlngn-ui {"),a=o.indexOf("}",s);s===-1&&(o=`body.crlngn-ui {
}
`,s=0,a=o.indexOf("}"));const l=o.substring(s+16,a).split(";").map(h=>h.trim()).filter(h=>h!==""),d={};l.forEach(h=>{const E=h.split(":");if(E.length>=2){const b=E[0].trim(),L=E.slice(1).join(":").trim();b&&(d[b]=L)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),d[e]=t;const u=Object.entries(d).map(([h,E])=>`  ${h}: ${E};`).join(`
`),p=o.substring(0,s)+`body.crlngn-ui {
`+u+`
}`+o.substring(a+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,s=null){const a=e.dataset.scrollAnimationId;a&&cancelAnimationFrame(Number(a));const r=n==="horizontal",l=r?e.scrollLeft:e.scrollTop,d=t-l;if(d===0)return s&&s(),null;const u=performance.now(),p=E=>{const b=E-u;if(b>=o){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,s&&s();return}const L=b/o,z=L<.5?2*L*L:1-Math.pow(-2*L+2,2)/2;r?e.scrollLeft=l+d*z:e.scrollTop=l+d*z;const q=requestAnimationFrame(p);return e.dataset.scrollAnimationId=q,q},h=requestAnimationFrame(p);return e.dataset.scrollAnimationId=h,h}}S(k,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([n])=>n);const t=new Set;for(const n of document.styleSheets)try{if(n.ownerNode){const o=n.href||"",s=o.includes("/css/")||o.includes("/styles/"),a=o.includes("/modules/crlngn-ui/");if(o&&!s&&!a){g.log("Skipping non-core/module stylesheet:",[o]);continue}let r="";if(n.ownerNode instanceof Element){if(n.ownerNode.tagName==="STYLE")r=n.ownerNode.textContent;else if(n.ownerNode.tagName==="LINK")try{const u=n.cssRules||n.rules;r=Array.from(u).map(p=>p.cssText).join(`
`)}catch(u){g.warn("Could not read stylesheet rules:",[u])}}g.log("Processing stylesheet:",[o||"inline style"]);const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let d;for(;(d=l.exec(r))!==null;){let u=d[1];if(u.includes("fonts.googleapis.com")){const p=u.match(/family=([^&]+)/);p&&decodeURIComponent(p[1]).split("|").map(E=>E.split(":")[0].replace(/\+/g," ")).forEach(E=>{t.add(E)})}else{if(u.startsWith("./")||u.startsWith("../")){g.log("Skipping relative import:",[u]);continue}let p=u;try{const h=await fetch(p);if(!h.ok){g.warn("Error loading imported CSS:",[h.status]);continue}const b=(await h.text()).match(/@font-face\s*{[^}]+}/g);if(!b)continue;b.forEach(L=>{const z=L.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(z&&z[1]){const q=z[1].trim();t.add(q)}})}catch(h){g.warn("Error processing imported CSS:",[h])}}}}if(!n.href||n.href.startsWith(window.location.origin))try{const o=n.cssRules||n.rules;for(const s of o)if(s instanceof CSSFontFaceRule){const a=s.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(a)}}catch(o){g.warn("Could not read stylesheet rules:",[o])}}catch(o){g.warn("Error processing stylesheet:",[o])}return t}),S(k,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:ls,HandlebarsApplicationMixin:cs}=foundry.applications.api;var Qn,Fe,Io,Ro,Mo;const ae=class ae extends cs(ls){static get DEFAULT_OPTIONS(){return{id:v().customFontsMenu.tag,actions:{redefine:O(ae,Fe,Mo)},form:{handler:O(ae,Fe,Io),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=v(),n=t.customFontsMenu.fields,o={},s={},a={};return n.forEach(l=>{if(t[l]){const d=C.get(t[l].tag);o[l]=t[l],s[l]=d!==void 0?d:t[l].default,a[l]=t[l].default}}),{...s,default:{...a},fontList:await k.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){ae.element=this.element,ae.element.querySelector(".toggle-hint").addEventListener("click",()=>{ae.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))}),ae.element.querySelectorAll('input[type="text"]').forEach(a=>{const r=a.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const d=()=>{var u;O(u=ae,Fe,Ro).call(u),l.classList.add("active")};a.addEventListener("focus",d),a.addEventListener("click",d),a.addEventListener("keydown",u=>{const p=l.classList.contains("active"),h=Array.from(l.querySelectorAll(".dropdown-option"));let E=h.findIndex(b=>b.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),p||l.classList.add("active"),h.forEach(b=>b.classList.remove("highlighted")),E===-1?E=u.key==="ArrowDown"?0:h.length-1:E=u.key==="ArrowDown"?(E+1)%h.length:(E-1+h.length)%h.length,h[E]&&(h[E].classList.add("highlighted"),h[E].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),p&&E!==-1&&h[E]&&h[E].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),ae.element.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",r=>{const l=a.closest(".dropdown-wrapper").querySelector("input");let d=a.dataset.value;d.includes(" ")&&!d.startsWith('"')?d=`"${d}"`:d.startsWith("&quot;")&&(d=d.replace(/&quot;/g,'"')),l.value=d,a.closest(".dropdown-options").classList.remove("active")})})}};Qn=new WeakMap,Fe=new WeakSet,Io=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),C.set(o[r].tag,a[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ro=function(){ae.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Mo=async function(e,t){const n=v(),s=this.element.querySelectorAll("input[type=text]"),a=n.customFontsMenu.fields,r={};a.forEach(l=>{n[l]&&(n[l],r[l]=n[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(ae,Fe),I(ae,Qn),S(ae,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let An=ae;const{ApplicationV2:ds,HandlebarsApplicationMixin:us}=foundry.applications.api;var _n,ft,Do,Po;const ve=class ve extends us(ds){static get DEFAULT_OPTIONS(){return{id:v().leftControlsMenu.tag,actions:{redefine:O(ve,ft,Po)},form:{handler:O(ve,ft,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=v(),n=t.leftControlsMenu.fields,o={},s={},a={};n.forEach(l=>{if(t[l]){const d=C.get(t[l].tag);o[l]=t[l],s[l]=d!==void 0?d:t[l].default,a[l]=t[l].default}});const r={...s,default:{...a},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=v();ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=C.get(n.leftControlsMenu.tag);g.log("_onRender",[e,t,s])}};_n=new WeakMap,ft=new WeakSet,Do=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const s=o.leftControlsMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),C.set(o[r].tag,a[r]))}),await C.set(o.leftControlsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Po=async function(e,t){const n=v(),s=this.element.querySelectorAll("input, select"),a=n.leftControlsMenu.default;s.forEach(r=>{r.value=a[r.name],r.type==="checkbox"&&(r.checked=a[r.name])}),g.log("#onReset",[e,t,n.leftControlsMenu.default])},I(ve,ft),I(ve,_n),S(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let On=ve;const{ApplicationV2:gs,HandlebarsApplicationMixin:fs}=foundry.applications.api;var eo,pt,Ao,Oo,Ot,Gn;const Ce=class Ce extends fs(gs){constructor(){super(...arguments);I(this,Ot)}static get DEFAULT_OPTIONS(){return{id:v().sceneNavMenu.tag,actions:{redefine:O(Ce,pt,Oo)},form:{handler:O(Ce,pt,Ao),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=v(),o=n.sceneNavMenu.fields,s={},a={},r={};o.forEach(d=>{if(n[d]){const u=C.get(n[d].tag);s[d]=n[d],a[d]=u!==void 0?u:n[d].default,r[d]=n[d].default}});const l={...a,default:{...r},fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[l,t]),l}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,g.log("_preparePartContext",[t,n]),n}_onRender(t,n){var a;g.log("_onRender",[t,n]),Ce.element=this.element,Ce.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ce.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(a=this.element)==null?void 0:a.querySelector('input[name="sceneNavEnabled"]');g.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",O(this,Ot,Gn).bind(this)),O(this,Ot,Gn).call(this,{target:s}))}};eo=new WeakMap,pt=new WeakSet,Ao=async function(t,n,o){t.preventDefault(),t.stopPropagation();const s=v(),a=s.sceneNavMenu.fields;let r=C.get(s.sceneNavEnabled.tag),l=C.get(s.useSceneFolders.tag);const d=foundry.utils.expandObject(o.object);a.forEach(h=>{d[h]!==void 0&&(g.log("Saving setting:",[h,d[h]]),C.set(s[h].tag,d[h]))});let u=C.get(s.sceneNavEnabled.tag),p=C.get(s.useSceneFolders.tag);g.log("Saving settings...",[r,u]),await C.set(s.sceneNavMenu.tag,d),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==p)&&location.reload()},Oo=async function(t,n){const o=v(),a=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;a.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),g.log("#onReset",[t,n,o.sceneNavMenu.default])},Ot=new WeakSet,Gn=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(s=>s.disabled=!t.target.checked),g.log("onSceneNavEnabledChange",[this.element,n])},I(Ce,pt),I(Ce,eo),S(Ce,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let zn=Ce;const{ApplicationV2:ps,HandlebarsApplicationMixin:hs}=foundry.applications.api;var to,no,xe,zo,Go,Fo;const Z=class Z extends hs(ps){static get DEFAULT_OPTIONS(){return{id:v().themeAndStylesMenu.tag,actions:{redefine:O(Z,xe,Fo)},form:{handler:O(Z,xe,zo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=v(),n=t.themeAndStylesMenu.fields,o={},s={},a={};n.forEach(d=>{if(t[d]){const u=C.get(t[d].tag);o[d]=t[d],s[d]=u!==void 0?u:t[d].default,a[d]=t[d].default}});const r=De.find(d=>d.className===s.colorTheme);s.colorTheme=(r==null?void 0:r.label)||De[0].label;const l={...s,default:{...a},fields:{...o},selectedTheme:r,themes:De,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...s},l}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){Z.element=this.element,Z.element.querySelector(".toggle-hint").addEventListener("click",()=>{Z.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=De,Z.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const p=u.closest(".dropdown-wrapper"),h=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!h)return;const E=()=>{var b;O(b=Z,xe,Go).call(b),h.classList.add("active")};u.addEventListener("focus",E),u.addEventListener("click",E),u.addEventListener("keydown",b=>{const L=h.classList.contains("active"),z=Array.from(h.querySelectorAll(".dropdown-option"));let q=z.findIndex($=>$.classList.contains("highlighted"));b.key==="ArrowDown"||b.key==="ArrowUp"?(b.preventDefault(),L||h.classList.add("active"),z.forEach($=>$.classList.remove("highlighted")),q===-1?q=b.key==="ArrowDown"?0:z.length-1:q=b.key==="ArrowDown"?(q+1)%z.length:(q-1+z.length)%z.length,z[q]&&(z[q].classList.add("highlighted"),z[q].scrollIntoView({block:"nearest"}))):b.key==="Enter"?(b.preventDefault(),L&&q!==-1&&z[q]&&z[q].click()):b.key==="Escape"&&h.classList.remove("active")}),document.addEventListener("click",b=>{p.contains(b.target)||h.classList.remove("active")})});const s=Z.element.querySelectorAll(".dropdown-option"),a=this;s.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(p){g.log("option",[u,u.querySelector(".theme-name")]);const h=u.closest(".dropdown-wrapper").querySelector("input");let E=u.querySelector(".theme-name").innerHTML.toString();if(h.value=E,h.name==="colorTheme"){const L=a._themes.find(z=>z.label===E);a._selectedTheme=L,a._updateThemePreview(L)}u.closest(".dropdown-options").classList.remove("active")})});const r=Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=Z.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",p=>{const h=p.currentTarget;let b=`${l.value}`.split(",")||[],L=b.indexOf(h.value);!p.currentTarget.checked&&L>-1?b.splice(L,1):p.currentTarget.checked&&L===-1&&b.push(h.value),l.value=b.join(","),g.log("checkbox changed",[b,l.value])})}),Z.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(h=>{h.checked=u.currentTarget.checked;const E=new Event("change",{bubbles:!0});h.dispatchEvent(E)})})}_updateThemePreview(e){if(g.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};to=new WeakMap,no=new WeakMap,xe=new WeakSet,zo=async function(e,t,n){const o=v();e.preventDefault(),e.stopPropagation();const s=o.themeAndStylesMenu.fields,a=foundry.utils.expandObject(n.object),r=De.find(l=>l.label===a.colorTheme);a.colorTheme=r?r.className:"",s.forEach(l=>{a[l]!==void 0&&(g.log("Saving setting:",[a[l]]),C.set(o[l].tag,a[l]))}),C.set(o.themeAndStylesMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Go=function(){Z.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Fo=async function(e,t){const n=v(),s=this.element.querySelectorAll("input[type=text]"),a=n.themeAndStylesMenu.fields,r={};a.forEach(d=>{n[d]&&(n[d],r[d]=n[d].default)});const l=De.find(d=>d.label===n.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||De[0].label,s.forEach(d=>{d.value=r[d.name]})},I(Z,xe),I(Z,to),I(Z,no,!1),S(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Fn=Z;function ms(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:An,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Fn,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Pn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:On,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Mn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:zn,restricted:!1}}}var $e,Ye,zt,Gt,Ft,xt,Ut,j,xn,Ct,Un,Bn,qn,Hn;const f=class f{static init(){const e=v();f.currSettings={enableFloatingDock:C.get(e.enableFloatingDock.tag),defaultVideoWidth:C.get(e.defaultVideoWidth.tag),dockHeight:C.get(e.dockHeight.tag),dockWidth:C.get(e.dockWidth.tag),dockPosX:C.get(e.dockPosX.tag),dockPosY:C.get(e.dockPosY.tag),dockWasResized:C.get(e.dockWasResized.tag),dockResizeOnUserJoin:C.get(e.dockResizeOnUserJoin.tag)},f.currSettings.enableFloatingDock?(Hooks.on(U.RENDER_CAMERA_VIEWS,f.onRenderFloating),g.log("CameraUtil settings",[f.currSettings]),f.onRenderFloating()):(Hooks.on(U.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,s,a;v();const e=f.currSettings;(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),f.cameraContainer=document.querySelector("#camera-views .camera-container");const t=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");g.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),f.cameraContainer&&n&&t&&((s=f.cameraContainer)==null||s.insertBefore(t,n),(a=document.querySelector("#camera-views .camera-container"))==null||a.classList.add("visible")),f.makeDraggable(),f.makeResizeable(),f.resetPositionAndSize(),f.placeControlsToggle(),f.applyDockResize(),f.applyVideoWidth()}static applyDockResize(e){var n,o,s,a,r,l;const t=e||f.currSettings.dockResizeOnUserJoin;t===nt.horizontal.name?((n=document.querySelector("#camera-views"))==null||n.classList.add("crlngn-horizontal"),(o=document.querySelector("#camera-views"))==null||o.classList.remove("crlngn-vertical")):t===nt.vertical.name?((s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-vertical"),(a=document.querySelector("#camera-views"))==null||a.classList.remove("crlngn-horizontal")):((r=document.querySelector("#camera-views"))==null||r.classList.remove("crlngn-vertical"),(l=document.querySelector("#camera-views"))==null||l.classList.remove("crlngn-horizontal"))}static applyVideoWidth(e){const t=v(),n=C.get(t.defaultVideoWidth.tag);let o=e||n;if(o<po)o=po,C.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){f.currSettings.defaultVideoWidth=o;const s=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),a=document.querySelector("#camera-views.crlngn-ui");!s&&a?a.style.setProperty("--av-width",o+"px"):a&&a.style.removeProperty("--av-width"),f.resizeDock()}}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(g.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",n=>{var a,r;if(n.button!==0)return;const o=document.querySelector("body.crlngn-ui");if((a=n.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",O(f,j,Un)),o==null||o.addEventListener("mouseup",O(f,j,xn));const s=k.getOffsetBottom(f.cameraContainer);f.isDragging=!0,F(f,$e,n.clientX-((r=f.cameraContainer)==null?void 0:r.offsetLeft)),F(f,Ye,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",n=>{var r,l;if(n.touches.length>1)return;const o=document.querySelector("body.crlngn-ui");if((r=n.target.parentNode)!=null&&r.classList.contains("volume-bar"))return;o==null||o.addEventListener("touchmove",O(f,j,Bn)),o==null||o.addEventListener("touchend",O(f,j,Ct)),o==null||o.addEventListener("touchcancel",O(f,j,Ct));const s=n.touches[0],a=k.getOffsetBottom(f.cameraContainer);f.isDragging=!0,F(f,$e,s.clientX-((l=f.cameraContainer)==null?void 0:l.offsetLeft)),F(f,Ye,window.innerHeight-s.clientY-a),n.preventDefault(),n.stopPropagation()})}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),f.isResizing=!0,F(f,zt,n.clientX),F(f,Gt,n.clientY),F(f,Ut,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),F(f,Ft,f.cameraContainer.offsetWidth),F(f,xt,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",O(f,j,qn)),e==null||e.addEventListener("mouseup",O(f,j,Hn))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){v();const s=f.currSettings;if(!(!s.enableFloatingDock||!f.cameraContainer))if(!e&&!t&&!n&&!o){const a=s.dockPosX||0,r=s.dockPosY||0;if(f.cameraContainer.style.left=`${a}px`,f.cameraContainer.style.bottom=`${r}px`,f.currSettings.dockResizeOnUserJoin===nt.off.name){const l=s.dockWidth||0,d=s.dockHeight||0;f.cameraContainer.style.width=`${l}px`,f.cameraContainer.style.height=`${d}px`}}else e&&(f.cameraContainer.style.left=`${e}px`),t&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===nt.horizontal.name&&(n&&(f.cameraContainer.style.width=`${n}px`),o&&(f.cameraContainer.style.height=`${o}px`))}};$e=new WeakMap,Ye=new WeakMap,zt=new WeakMap,Gt=new WeakMap,Ft=new WeakMap,xt=new WeakMap,Ut=new WeakMap,j=new WeakSet,xn=function(e){var o,s;const t=v(),n={...f.currSettings};if(f.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),C.set(t.dockPosX.tag,n.dockPosX),C.set(t.dockPosY.tag,n.dockPosY),a==null||a.removeEventListener("mousemove",O(f,j,Un)),a==null||a.removeEventListener("mouseup",O(f,j,xn)),f.isDragging=!1,e.stopPropagation()}},Ct=function(e){var o,s;const t=v(),n={...f.currSettings};if(f.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),C.set(t.dockPosX.tag,n.dockPosX),C.set(t.dockPosY.tag,n.dockPosY),a==null||a.removeEventListener("touchmove",O(f,j,Bn)),a==null||a.removeEventListener("touchend",O(f,j,Ct)),a==null||a.removeEventListener("touchcancel",O(f,j,Ct)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}},Un=function(e){if(f.isDragging){if(g.log("mousemove",[e.target.parentNode]),f.cameraContainer){let t=e.clientX-N(f,$e),n=window.innerHeight-e.clientY-N(f,Ye);t+f.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-f.cameraContainer.offsetWidth),f.cameraContainer.style.left=`${t}px`,n+f.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${n}px`}e.preventDefault(),e.stopPropagation()}},Bn=function(e){if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let n=t.clientX-N(f,$e),o=window.innerHeight-t.clientY-N(f,Ye);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}},qn=function(e){if(!f.isResizing)return;const t=N(f,Ft)+(e.clientX-N(f,zt)),n=e.clientY-N(f,Gt),o=N(f,xt)+n,s=N(f,Ut)-n;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${o}px`,f.cameraContainer.style.bottom=`${s}px`},Hn=function(){var o,s,a,r,l,d;const e=v(),t={...f.currSettings},n=document.querySelector("body.crlngn-ui");f.isResizing=!1,n==null||n.removeEventListener("mousemove",O(f,j,qn)),n==null||n.removeEventListener("mouseup",O(f,j,Hn)),g.log("onStopResize",[(o=f.cameraContainer)==null?void 0:o.style.width,(s=f.cameraContainer)==null?void 0:s.style.height,(a=f.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((r=f.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((l=f.cameraContainer)==null?void 0:l.style.height)||0),t.dockPosY=parseInt(((d=f.cameraContainer)==null?void 0:d.style.bottom)||0),C.set(e.dockWidth.tag,t.dockWidth),C.set(e.dockHeight.tag,t.dockHeight),C.set(e.dockPosY.tag,t.dockPosY),C.set(e.dockWasResized.tag,!0)},I(f,j),I(f,$e,0),I(f,Ye,0),S(f,"isDragging",!1),S(f,"cameraContainer"),S(f,"isResizing",!1),I(f,zt,0),I(f,Gt,0),I(f,Ft,0),I(f,xt,0),I(f,Ut,0),S(f,"currSettings",{}),S(f,"resizeDock",()=>{v(),!f.currSettings.enableFloatingDock||f.cameraContainer});let ee=f;const ue=class ue{static init(){const e=v();ue.enableChatStyles=C.get(e.enableChatStyles.tag),ue.chatBorderColor=C.get(e.chatBorderColor.tag),ue.useLeftChatBorder=C.get(e.useLeftChatBorder.tag)}};S(ue,"chatBorderColor"),S(ue,"enableChatStyles"),S(ue,"useLeftChatBorder"),S(ue,"enrichCard",async(e,t)=>{var a,r,l,d,u,p,h,E;g.log("renderChatMessage",[ue.chatBorderColor,ue.enableChatStyles,lt.playerColor.name,(a=e.author)==null?void 0:a.id]);const n=((d=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:d.type)||((h=(p=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:p.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn"),ue.useLeftChatBorder&&o.classList.add("left-border");const s=o.querySelectorAll(".card-buttons button[data-action=rollSave]");s.length>0&&s.forEach(b=>{const L=b.querySelector(".visible-dc"),z=b.querySelector(".hidden-dc");g.log("enrichCard",[L,z]),L.setAttribute("data-ability",b.getAttribute("data-ability")||""),L.setAttribute("data-dc",b.getAttribute("data-dc")||""),z.setAttribute("data-ability",b.getAttribute("data-ability")||"")}),ue.chatBorderColor===lt.playerColor.name&&((E=e.author)!=null&&E.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let ct=ue;var oo;const ge=class ge{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,ge.checkPlayersList),Hooks.on(U.RENDER_HOTBAR,ge.checkPlayersList),k.isModuleOn("foundry-taskbar")&&Hooks.on(U.UPDATE_USER,ge.checkTaskbarLock),ge.checkTaskbarLock(),ge.addModuleClasses()}};oo=new WeakMap,I(ge,oo),S(ge,"addModuleClasses",()=>{const e=v(),t=C.get(e.otherModulesList.tag)||"",n=t.split(",");g.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const s=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+s)}),n.forEach(o=>{const s=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+s)})}),S(ge,"checkTaskbarLock",()=>{var s,a,r;const e=k.isModuleOn("foundry-taskbar"),t=(s=game.user.flags)==null?void 0:s["foundry-taskbar"];if(g.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(a=t.taskbarSettings)!=null&&a.locked?k.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):k.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=t.taskbarSettings)!=null&&r.locked?k.addCSSVars("--crlngn-taskbar-height","50px"):k.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),ge.checkPlayersList()}),S(ge,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=k.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,s=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;g.log("checkPlayersList",[o,n,s,game.settings]),document.querySelector("#hotbar"),o?(g.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let st=ge;var Xe,so,Le,Bt,Je,qt,ao,Ht,Ke,it,Ze,he,gn,fn,pn;const c=class c{static applyCustomStyle(e){c.sceneNavEnabled=e,g.log("applyCustomStyle - TopNavigation",[c.sceneNavEnabled,ui.nav])}static applyButtonSettings(){var t,n;v();let e=1;(t=game.user)!=null&&t.isGM&&c.useSceneBackButton&&e++,(n=game.user)!=null&&n.isGM&&c.useSceneLookup&&e++,k.addCSSVars("--scene-list-left",`calc(var(--left-control-item-size) * ${e})`)}static resetLocalVars(e){let t=(e==null?void 0:e[0])||e||document.querySelector("#navigation");c.navElem=t,F(c,Le,t.querySelector("#nav-toggle")),F(c,Bt,t.querySelector("#ui-left")),c.scenesList=t.querySelector("#scene-list")}static handleFolderList(e,t,n){v(),c.useSceneFolders&&Ae.addFolderButtons(e,t,n)}static handleNavState(e){const t=v();if(e=e[0]||e,N(c,Ht)){F(c,Ht,!1),c.toggleNav(c.navStartCollapsed);const n=e.querySelector("#scene-list > li.scene.active"),o=n?n.offsetLeft:0,s=(n==null?void 0:n.offsetWidth)||0,a=Math.floor(o/s);g.log("onLoad - scenePos",[o,a]),c.navPos=a,C.set(t.sceneNavPos.tag,a)}}static toggleNav(e){clearTimeout(N(c,qt)),F(c,qt,setTimeout(()=>{var t,n;c.resetLocalVars(),e===!0?((t=ui.nav)==null||t.collapse(),c.isCollapsed=!0,g.log("toggleNav collapse",[ui.nav,e,c.navStartCollapsed]),document.querySelectorAll("#ui-top .crlngn-btn").forEach(s=>s.remove())):e===!1&&(c.isCollapsed=!1,(n=ui.nav)==null||n.expand(),g.log("toggleNav expand",[e,c.navStartCollapsed]))},300))}static checkSceneNavCompat(){var n,o;const e=v(),t=document.querySelector("#ui-middle");this.isMonksSceneNavOn=k.isModuleOn("monks-scene-navigation"),this.isRipperSceneNavOn=k.isModuleOn("compact-scene-navigation"),this.isRipperSceneNavOn&&c.useSceneFolders&&(n=game.user)!=null&&n.isGM&&this.isRipperSceneNavOn&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),this.isMonksSceneNavOn&&c.sceneNavEnabled&&(t.classList.remove("crlngn-ui"),game.ready&&(C.set(e.sceneNavEnabled.tag,!1),c.sceneNavEnabled=!1),g.log("checkSceneNavCompat",[c.isMonksSceneNavOn,c.isRipperSceneNavOn]),(o=game.user)!=null&&o.isGM&&c.isMonksSceneNavOn&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static addListeners(){var e,t;(e=c.navElem)==null||e.addEventListener("mouseenter",n=>{if(g.log("TopNavigation mouseenter",[c.isCollapsed,c.showNavOnHover]),!c.isCollapsed||!c.showNavOnHover)return;n.stopPropagation(),clearTimeout(N(c,Xe)),document.querySelector("#navigation").classList.remove("collapsed")}),(t=c.navElem)==null||t.addEventListener("mouseleave",n=>{g.log("TopNavigation mouseleave",[c.isCollapsed,c.showNavOnHover]),!(!c.isCollapsed||!c.showNavOnHover)&&(n.stopPropagation(),F(c,Xe,setTimeout(()=>{clearTimeout(N(c,Xe)),F(c,Xe,null),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,s,a,r;try{const l=v();if(g.log("setNavPosition #1",[e,c.navElem]),!c.navElem)return;const d=(o=c.navElem)==null?void 0:o.querySelector("#folders-group"),u=(s=c.navElem)==null?void 0:s.querySelector("#crlngn-folder-toggle"),p=((a=c.navElem)==null?void 0:a.querySelectorAll("#scene-list > li.scene"))||[],h=Array.from(p)[0],E=(h==null?void 0:h.offsetWidth)||0,b=c.navShowSceneFolders&&(d==null?void 0:d.offsetWidth)||0,L=e!==null?e:c.navPos||0;if(!h)return;const z=p[L],q=(h==null?void 0:h.offsetWidth)||0,$=parseInt(q)*L;g.log("setNavPosition #2",[e,L,b,E,d,u]);const te=$+b;if(te>((r=c.navElem)==null?void 0:r.scrollWidth))return;c.navPos=L,C.set(l.sceneNavPos.tag,L),t?k.smoothScrollTo(c.navElem,te,"horizontal",n):c.navElem.scrollTo({left:te,behavior:"instant"})}catch(l){g.log("setNavPosition",["Error:",l]),console.error("Error in setNavPosition:",l)}}};Xe=new WeakMap,so=new WeakMap,Le=new WeakMap,Bt=new WeakMap,Je=new WeakMap,qt=new WeakMap,ao=new WeakMap,Ht=new WeakMap,Ke=new WeakMap,it=new WeakMap,Ze=new WeakMap,he=new WeakMap,gn=new WeakMap,fn=new WeakMap,pn=new WeakMap,S(c,"navElem"),S(c,"scenesList"),I(c,Xe),I(c,so),I(c,Le),I(c,Bt),S(c,"sceneFoldersTemplate"),S(c,"navButtonsTemplate"),I(c,Je),I(c,qt),I(c,ao),I(c,Ht,!0),I(c,Ke,null),I(c,it,null),I(c,Ze,""),I(c,he,[]),S(c,"preventReposition",!1),S(c,"preventRerender",!1),S(c,"sceneNavEnabled"),S(c,"useSceneFolders"),S(c,"openFolderOnSceneLoad"),S(c,"navFoldersForPlayers"),S(c,"navShowSceneFolders"),S(c,"navStartCollapsed"),S(c,"showNavOnHover"),S(c,"useSceneIcons"),S(c,"useScenePreview"),S(c,"useSceneBackButton"),S(c,"sceneClickToView"),S(c,"isCollapsed"),S(c,"navPos"),S(c,"isMonksSceneNavOn",!1),S(c,"isRipperSceneNavOn",!1),S(c,"init",()=>{const e=v();if(c.isMonksSceneNavOn=k.isModuleOn("monks-scene-navigation"),c.isRipperSceneNavOn=k.isModuleOn("compact-scene-navigation"),c.sceneNavEnabled&&(c.checkSceneNavCompat(),c.isMonksSceneNavOn))return;Hooks.on(U.RENDER_SCENE_NAV,c.onRender),c.navStartCollapsed=C.get(e.navStartCollapsed.tag),c.showNavOnHover=C.get(e.showNavOnHover.tag),c.sceneNavEnabled=C.get(e.sceneNavEnabled.tag),c.useScenePreview=C.get(e.useScenePreview.tag),c.useSceneFolders=C.get(e.useSceneFolders.tag),c.navFoldersForPlayers=C.get(e.navFoldersForPlayers.tag),c.useSceneIcons=C.get(e.useSceneIcons.tag),c.isCollapsed=c.navStartCollapsed,c.isCollapsed&&c.toggleNav(c.isCollapsed),g.log("SCENE NAV INIT",[c.sceneNavEnabled],!0);const t=document.querySelector("body");c.sceneNavEnabled?t.classList.add("crlngn-scene-nav"):t.classList.remove("crlngn-scene-nav"),c.sceneNavEnabled&&(c.preloadTemplates(),Ae.init(),Hooks.on(U.READY,()=>{k.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42),g.log(U.READY,[ui.sidebar]),c.checkSideBar(!ui.sidebar._collapsed)}),Hooks.on(U.COLLAPSE_SIDE_BAR,n=>{g.log(U.COLLAPSE_SIDE_BAR,[n,n.expanded,n._collapsed]),n&&c.checkSideBar(!n._collapsed)}),Hooks.on(U.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(N(c,Je)),c.isCollapsed=o,o&&document.querySelectorAll("#ui-top .crlngn-btn").forEach(a=>a.remove()),c.setCollapsedClass(o),F(c,Je,setTimeout(()=>{c.setCollapsedClass(o)},500))}),ui.sidebar&&c.checkSideBar(ui.sidebar.expanded),c.placeNavButtons()),Hooks.on(U.CREATE_SCENE,(n,o)=>{var s;c.preventReposition=!0,g.log("CREATE_SCENE",[n,o]),(s=ui.nav)==null||s.render()}),Hooks.on(U.UPDATE_SCENE,(n,o)=>{var s;c.preventReposition=!0,g.log("UPDATE_SCENE",[n,o]),c.preventRerender?c.preventRerender=!1:(s=ui.nav)==null||s.render()}),Hooks.on(U.DELETE_SCENE,(n,o)=>{var s;c.preventReposition=!0,g.log("DELETE_SCENE",[n,o]),(s=ui.nav)==null||s.render()}),Hooks.on(U.CANVAS_INIT,()=>{var o,s,a;const n=(s=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:s.id;if(n!==N(c,he)[N(c,he).length-1]&&(N(c,he).push(n),c.useSceneFolders&&c.openFolderOnSceneLoad)){const r=game.scenes.get(n);g.log(U.CANVAS_INIT,[r]),r!=null&&r.folder&&((a=game.user)!=null&&a.isGM)&&Ae.activateFolder(r.folder.id)}}),Hooks.on(U.RENDER_SCENE_DIRECTORY,n=>{g.log(U.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(a=>{var l,d;const r=game.scenes.get(a.dataset.entryId);if(g.log(U.RENDER_SCENE_DIRECTORY,["directoryScenes",a.dataset.entryId,c.sceneClickToView]),c.sceneClickToView&&(a.addEventListener("dblclick",c.onActivateScene),a.addEventListener("click",c.onSelectScene)),c.useSceneIcons&&r&&((l=game.user)!=null&&l.isGM)){let u=document.createElement("i");u.classList.add("fas"),u.classList.add("icon"),r.ownership.default!==0?(r.active&&(u.classList.add("fa-bullseye"),a.prepend(u)),((d=game.scenes.current)==null?void 0:d.id)===r.id&&(u.classList.add("fa-star"),a.prepend(u))):(u.classList.add("fa-eye-slash"),a.prepend(u))}})})}),S(c,"onRender",async(e,t,n)=>{var a,r;if(c.isMonksSceneNavOn)return;g.log("onRender",[]),t=(t==null?void 0:t[0])||t;const o=v(),s=c.navPos;c.resetLocalVars(t),c.sceneNavEnabled&&(c.handleExtraButtons(e,t,n),c.handleFolderList(e,t,n),c.handleSceneList(e,t,n),c.navShowSceneFolders&&(Ae.init(),await Ae.renderFolderList()),c.handleNavState(t)),(!c.useSceneFolders||!((a=game.user)!=null&&a.isGM))&&document.body.classList.add("crlngn-no-folders"),c.addSceneListeners(t),c.addListeners(),c.resetLocalVars(t),c.sceneNavEnabled&&(g.log("onRender - preventReposition?",[c.preventReposition]),c.preventReposition?c.preventReposition=!1:c.setNavPosition(s,!1),clearTimeout(N(c,Je)),F(c,Je,setTimeout(()=>{c.placeNavButtons()},500))),c.applyButtonSettings(),N(c,Le)&&(N(c,Le).dataset.tooltipDirection="RIGHT"),(r=c.navElem)==null||r.addEventListener("scrollend",()=>{var p;const d=((p=c.navElem)==null?void 0:p.querySelector("#scene-list > li.scene.view")).offsetWidth,u=Math.floor(c.navElem.scrollLeft/d);g.log("Scene list scroll position",[u]),c.navPos=u,C.set(o.sceneNavPos.tag,u)})}),S(c,"setCollapsedClass",e=>{var n,o;const t=document.querySelector("body");e?((n=c.navElem)==null||n.classList.add("collapsed"),t.classList.add("navigation-collapsed"),k.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",s=>s.top=10)):((o=c.navElem)==null||o.classList.remove("collapsed"),t.classList.remove("navigation-collapsed"),c.placeNavButtons(),k.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",s=>s.top=42))}),S(c,"checkSideBar",e=>{c.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),S(c,"handleSceneList",async(e,t,n)=>{var o,s;if(t=t[0]||t,c.sceneNavEnabled){g.log("handleSceneList",[e,t,n]);const a=t.querySelectorAll("#scene-list li.scene");for(const r of a){const l=r.dataset.sceneId;if(c.useScenePreview){const d=game.scenes.find(p=>p.id===l);d.isGM=(o=game.user)==null?void 0:o.isGM,d.thumb=d.thumb||null;const u=await renderTemplate(`modules/${B}/templates/scene-nav-preview.hbs`,d);if(g.log("sceneData",[d]),r.classList.add("nav-item"),r.insertAdjacentHTML("beforeend",u),d.isGM&&N(c,Ze)===l){const p=new MouseEvent("mouseenter");r.dispatchEvent(p)}(s=game.user)!=null&&s.isGM&&c.addPreviewIconListeners(r,d)}c.useSceneIcons&&r.classList.add("crlngn-icons")}}}),S(c,"handleExtraButtons",async(e,t,n)=>{var a;v(),t=t[0]||t,g.log("handleExtraButtons",[e,t,n]);const o=await renderTemplate(`modules/${B}/templates/scene-nav-extra-buttons.hbs`,{useSceneBackButton:game.user.isGM?c.useSceneBackButton:!1,useSceneFolders:game.user.isGM?c.useSceneFolders:!1,useSceneLookup:game.user.isGM?c.useSceneLookup:!1,backButtonTooltip:game.i18n.localize("CRLNGN_UI.ui.backButtonTooltip"),sceneLookupTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneLookupTooltip"),isGM:(a=game.user)==null?void 0:a.isGM});t.querySelector("#nav-toggle").insertAdjacentHTML("afterend",o);const s=t.querySelector("#crlngn-back-button");s&&s.addEventListener("click",N(c,gn)),c.sceneNavEnabled&&c.useSceneLookup&&game.user.isGM&&Ae.handleFolderLookup(e,t,n)}),I(c,gn,e=>{var s;e.stopPropagation(),e.preventDefault();const t=N(c,he).length,n=N(c,he)[t-2];let o;g.log("#onBackButton before",[t,n,N(c,he)]),n&&n!==((s=game.scenes.current)==null?void 0:s.id)&&(o=game.scenes.get(n),o&&o.view(),N(c,he).pop()),g.log("#onBackButton after",[N(c,he)])}),S(c,"placeNavButtons",async()=>{var l,d;const e=document.querySelector("#navigation");if(g.log("placeNavButtons #1",[e]),!e||e.nodeName=="TEMPLATE")return;c.resetLocalVars(),e.querySelector("#scene-list");let t=document.querySelectorAll("button.crlngn-btn");const n=((l=N(c,Le))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(g.log("placeNavButtons #2",[e.offsetWidth,n,e.scrollWidth]),!o||c.isCollapsed||(d=N(c,Bt))!=null&&d.classList.contains("navigation-collapsed")){t.forEach(u=>{g.log("placeNavButtons remove",[u.remove,u]),u.remove()}),t=[];return}if(t.length>0)return;const s=await renderTemplate(`modules/${B}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",s);const a=document.querySelector("#ui-top .crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-top .crlngn-btn.ui-nav-right");g.log("placeNavButtons #3",[a,r]),a==null||a.addEventListener("click",N(c,fn)),r==null||r.addEventListener("click",N(c,pn))}),I(c,fn,async e=>{e.preventDefault();const t=await c.getItemsPerPage(),n=document.querySelector("#navigation"),o=(n==null?void 0:n.querySelectorAll("li.nav-item"))||[],s=Array.from(o)[0],a=document.querySelector("#scene-list > li.scene.active"),r=(s==null?void 0:s.offsetWidth)||0,l=Math.floor((a==null?void 0:a.offsetLeft)/r);if(c.navPos=l,!c.scenesList||!c.navElem)return;let d=l-(t-1);g.log("onNavLast",["pos",l,d,c.navPos,t]),c.setNavPosition(d)}),I(c,pn,async e=>{e.preventDefault();const t=await c.getItemsPerPage(),n=document.querySelector("#navigation"),o=(n==null?void 0:n.querySelectorAll("li.nav-item"))||[],s=c.navPos||0,a=Array.from(o)[0],r=(a==null?void 0:a.offsetWidth)||0,l=(n==null?void 0:n.scrollWidth)||0;if(g.log("onNavNext",[t,r,a,c.navElem]),!r||!c.navElem)return;let d=s+(t-1),u=d*r;u>=l&&(d=Math.floor(l/r)),g.log("onNavNext",["pos",s,d,r,u,l]),c.setNavPosition(d)}),S(c,"getItemsPerPage",()=>{var e,t;try{const s=((e=N(c,Le))==null?void 0:e.offsetWidth)||((t=N(c,Le))==null?void 0:t.clientWidth)||0,a=document.querySelector("#navigation li.nav-item.scene.active");if(!a)return g.log("getItemsPerPage",["No scene items found"]),1;const r=a.offsetWidth,l=document.querySelector("#navigation").offsetWidth;if(!l)return g.log("getItemsPerPage",["Nav element has no width"]),1;const d=Math.floor((l-s*2)/r);return g.log("getItemsPerPage",["Calculated:",d,l,r,a,a.offsetWidth,a.clientWidth]),d||1}catch(n){return g.log("getItemsPerPage",["Error:",n]),g.error("Error in getItemsPerPage:",n),1}}),S(c,"preloadTemplates",async()=>{try{const e=[`modules/${B}/templates/scene-nav-buttons.hbs`,`modules/${B}/templates/scene-nav-preview.hbs`,`modules/${B}/templates/scene-nav-extra-buttons.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),S(c,"getCurrScenePosition",async e=>{try{if(!c.navElem||!e)return 0;const t=await c.getItemsPerPage()||1,n=c.navElem.querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const s=Array.from(n).findIndex(l=>l.dataset.sceneId===e);if(s===-1)return 0;const a=s>=c.navPos&&s<=c.navPos+t,r=a?c.navPos:s;return g.log("getCurrScenePosition",["Final position:",r,"isVisible:",a]),r}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),S(c,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,s=n?t.parentNode.classList.contains("on-folder"):t.classList.contains("on-folder"),a=game.scenes.get(o.entryId||o.sceneId);g.log("onActivateScene",[o,a,e.currentTarget.classList,e.target.classList]),s&&(c.preventReposition=!0),a.activate(),clearTimeout(N(c,Ke))}),S(c,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,s=n?t.parentNode.classList.contains("on-folder"):t.classList.contains("on-folder"),a=game.scenes.get(o.entryId||o.sceneId);if(F(c,Ze,""),g.log("onSelectScene",[a,t,s]),a&&a.sheet){const r=a.sheet.render;a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=r},250)}clearTimeout(N(c,Ke)),F(c,Ke,setTimeout(()=>{s&&(c.preventReposition=!0),a.view(),F(c,Ke,null)},250))}),S(c,"onScenePreviewOn",e=>{if(e.stopPropagation(),e.preventDefault(),!c.showNavOnHover)return;const t=e.currentTarget,n=t.dataset;F(c,Ze,n.sceneId),F(c,it,setTimeout(()=>{clearTimeout(N(c,it)),t.querySelector(".scene-preview").classList.add("open")},200))}),S(c,"onScenePreviewOff",e=>{if(e.stopPropagation(),e.preventDefault(),clearTimeout(N(c,it)),!c.showNavOnHover)return;const t=e.currentTarget;F(c,Ze,""),t.querySelector(".scene-preview").classList.remove("open")}),S(c,"updateScenePreview",async(e,t)=>{var d,u,p,h;if(!c.sceneNavEnabled||!e||!t)return;const n=game.scenes.get(t);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const s=o.classList.contains("open");g.log("Scene data for preview",[t,(u=(d=n.environment)==null?void 0:d.globalLight)==null?void 0:u.enabled,n.tokenVision]);const a={id:n.id,name:n.name,thumb:n.thumb||null,environment:n.environment,tokenVision:n.tokenVision,isGM:(p=game.user)==null?void 0:p.isGM},r=await renderTemplate(`modules/${B}/templates/scene-nav-preview.hbs`,a);o.outerHTML=r;const l=e.querySelector(".scene-preview");s&&l&&l.classList.add("open"),c.sceneNavEnabled&&c.useScenePreview&&(e.removeEventListener("mouseenter",c.onScenePreviewOn),e.removeEventListener("mouseleave",c.onScenePreviewOff),e.addEventListener("mouseenter",c.onScenePreviewOn),e.addEventListener("mouseleave",c.onScenePreviewOff),(h=game.user)!=null&&h.isGM&&c.addPreviewIconListeners(e,a))}),S(c,"addSceneListeners",e=>{if(!c.sceneNavEnabled)return;e=e[0]||e,e.querySelectorAll("li.scene").forEach(n=>{var o;if(n.classList.contains("folder"),n.querySelector(".scene-name").removeEventListener("click",c.onSelectScene),n.querySelector(".scene-name").removeEventListener("dblclick",c.onActivateScene),n.querySelector(".scene-name").addEventListener("click",c.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",c.onActivateScene),c.useScenePreview){n.addEventListener("mouseenter",c.onScenePreviewOn),n.addEventListener("mouseleave",c.onScenePreviewOff);const s=n.dataset.sceneId,a=game.scenes.find(r=>r.id===s);(o=game.user)!=null&&o.isGM&&c.addPreviewIconListeners(n,a)}else n.removeEventListener("mouseenter",c.onScenePreviewOn),n.removeEventListener("mouseleave",c.onScenePreviewOff)})}),S(c,"onSceneConfigClick",async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");game.scenes.get(t.dataset.sceneId).sheet.render(!0)}),S(c,"onIlumClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const t=e.currentTarget.closest("li.scene"),n=t.dataset.sceneId;let o=game.scenes.get(n);const s=o.environment.globalLight.enabled;await o.update({"environment.globalLight.enabled":!s}),o=game.scenes.get(n),g.log("Toggled global illumination",[!s,o.environment.globalLight.enabled]),await c.updateScenePreview(t,n)}),S(c,"onTokenVisionClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const t=e.currentTarget.closest("li.scene"),n=t.dataset.sceneId;let o=game.scenes.get(n);const s=o.tokenVision;await o.update({tokenVision:!s}),o=game.scenes.get(n),g.log("Toggled token vision",[!s,o.tokenVision]),await c.updateScenePreview(t,n)}),S(c,"onGenerateThumbnailClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const t=e.currentTarget.closest("li.scene"),n=t.dataset.sceneId;let o=game.scenes.get(n);await o.generateThumbnail(),o=game.scenes.get(n),g.log("Generated thumbnail",[o.thumb?"Thumbnail created":"No thumbnail"]),await c.updateScenePreview(t,n)}),S(c,"addPreviewIconListeners",(e,t)=>{if(!e||!t||!game.scenes.get(t.id))return;const o=e.querySelector(".scene-preview");if(!o)return;const s=o.querySelector(".ilum");s&&(s.removeEventListener("click",c.onIlumClick),s.addEventListener("click",c.onIlumClick));const a=o.querySelector(".token-vision");a&&(a.removeEventListener("click",c.onTokenVisionClick),a.addEventListener("click",c.onTokenVisionClick));const r=o.querySelector(".config");r&&r.addEventListener("click",c.onSceneConfigClick);const l=o.querySelector(".gen-thumb");l&&l.addEventListener("click",c.onGenerateThumbnailClick)});let A=c;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ho(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(i,o).enumerable})),t.push.apply(t,n)}return t}function Ne(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ho(Object(t),!0).forEach(function(n){Ss(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):ho(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function en(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?en=function(e){return typeof e}:en=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},en(i)}function Ss(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ke(){return ke=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},ke.apply(this,arguments)}function ys(i,e){if(i==null)return{};var t={},n=Object.keys(i),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(t[o]=i[o]);return t}function bs(i,e){if(i==null)return{};var t=ys(i,e),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(o=0;o<s.length;o++)n=s[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}var vs="1.15.6";function we(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var Ie=we(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),$t=we(/Edge/i),mo=we(/firefox/i),Lt=we(/safari/i)&&!we(/chrome/i)&&!we(/android/i),io=we(/iP(ad|od|hone)/i),xo=we(/chrome/i)&&we(/android/i),Uo={capture:!1,passive:!1};function x(i,e,t){i.addEventListener(e,t,!Ie&&Uo)}function G(i,e,t){i.removeEventListener(e,t,!Ie&&Uo)}function an(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch{return!1}return!1}}function Bo(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function me(i,e,t,n){if(i){t=t||document;do{if(e!=null&&(e[0]===">"?i.parentNode===t&&an(i,e):an(i,e))||n&&i===t)return i;if(i===t)break}while(i=Bo(i))}return null}var So=/\s+/g;function ce(i,e,t){if(i&&e)if(i.classList)i.classList[t?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(So," ").replace(" "+e+" "," ");i.className=(n+(t?" "+e:"")).replace(So," ")}}function M(i,e,t){var n=i&&i.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function at(i,e){var t="";if(typeof i=="string")t=i;else do{var n=M(i,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(i=i.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function qo(i,e,t){if(i){var n=i.getElementsByTagName(e),o=0,s=n.length;if(t)for(;o<s;o++)t(n[o],o);return n}return[]}function Ee(){var i=document.scrollingElement;return i||document.documentElement}function K(i,e,t,n,o){if(!(!i.getBoundingClientRect&&i!==window)){var s,a,r,l,d,u,p;if(i!==window&&i.parentNode&&i!==Ee()?(s=i.getBoundingClientRect(),a=s.top,r=s.left,l=s.bottom,d=s.right,u=s.height,p=s.width):(a=0,r=0,l=window.innerHeight,d=window.innerWidth,u=window.innerHeight,p=window.innerWidth),(e||t)&&i!==window&&(o=o||i.parentNode,!Ie))do if(o&&o.getBoundingClientRect&&(M(o,"transform")!=="none"||t&&M(o,"position")!=="static")){var h=o.getBoundingClientRect();a-=h.top+parseInt(M(o,"border-top-width")),r-=h.left+parseInt(M(o,"border-left-width")),l=a+s.height,d=r+s.width;break}while(o=o.parentNode);if(n&&i!==window){var E=at(o||i),b=E&&E.a,L=E&&E.d;E&&(a/=L,r/=b,p/=b,u/=L,l=a+u,d=r+p)}return{top:a,left:r,bottom:l,right:d,width:p,height:u}}}function yo(i,e,t){for(var n=Ge(i,!0),o=K(i)[e];n;){var s=K(n)[t],a=void 0;if(a=o>=s,!a)return n;if(n===Ee())break;n=Ge(n,!1)}return!1}function dt(i,e,t,n){for(var o=0,s=0,a=i.children;s<a.length;){if(a[s].style.display!=="none"&&a[s]!==D.ghost&&(n||a[s]!==D.dragged)&&me(a[s],t.draggable,i,!1)){if(o===e)return a[s];o++}s++}return null}function ro(i,e){for(var t=i.lastElementChild;t&&(t===D.ghost||M(t,"display")==="none"||e&&!an(t,e));)t=t.previousElementSibling;return t||null}function fe(i,e){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==D.clone&&(!e||an(i,e))&&t++;return t}function bo(i){var e=0,t=0,n=Ee();if(i)do{var o=at(i),s=o.a,a=o.d;e+=i.scrollLeft*s,t+=i.scrollTop*a}while(i!==n&&(i=i.parentNode));return[e,t]}function Cs(i,e){for(var t in i)if(i.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[t][n])return Number(t)}return-1}function Ge(i,e){if(!i||!i.getBoundingClientRect)return Ee();var t=i,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=M(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ee();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ee()}function Es(i,e){if(i&&e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function bn(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var wt;function Ho(i,e){return function(){if(!wt){var t=arguments,n=this;t.length===1?i.call(n,t[0]):i.apply(n,t),wt=setTimeout(function(){wt=void 0},e)}}}function Ns(){clearTimeout(wt),wt=void 0}function Vo(i,e,t){i.scrollLeft+=e,i.scrollTop+=t}function Wo(i){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function jo(i,e,t){var n={};return Array.from(i.children).forEach(function(o){var s,a,r,l;if(!(!me(o,e.draggable,i,!1)||o.animated||o===t)){var d=K(o);n.left=Math.min((s=n.left)!==null&&s!==void 0?s:1/0,d.left),n.top=Math.min((a=n.top)!==null&&a!==void 0?a:1/0,d.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,d.right),n.bottom=Math.max((l=n.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var ie="Sortable"+new Date().getTime();function Ts(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(M(o,"display")==="none"||o===D.ghost)){i.push({target:o,rect:K(o)});var s=Ne({},i[i.length-1].rect);if(o.thisAnimationDuration){var a=at(o,!0);a&&(s.top-=a.f,s.left-=a.e)}o.fromRect=s}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(Cs(i,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var s=!1,a=0;i.forEach(function(r){var l=0,d=r.target,u=d.fromRect,p=K(d),h=d.prevFromRect,E=d.prevToRect,b=r.rect,L=at(d,!0);L&&(p.top-=L.f,p.left-=L.e),d.toRect=p,d.thisAnimationDuration&&bn(h,p)&&!bn(u,p)&&(b.top-p.top)/(b.left-p.left)===(u.top-p.top)/(u.left-p.left)&&(l=ws(b,h,E,o.options)),bn(p,u)||(d.prevFromRect=u,d.prevToRect=p,l||(l=o.options.animation),o.animate(d,b,p,l)),l&&(s=!0,a=Math.max(a,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof n=="function"&&n()},a):typeof n=="function"&&n(),i=[]},animate:function(n,o,s,a){if(a){M(n,"transition",""),M(n,"transform","");var r=at(this.el),l=r&&r.a,d=r&&r.d,u=(o.left-s.left)/(l||1),p=(o.top-s.top)/(d||1);n.animatingX=!!u,n.animatingY=!!p,M(n,"transform","translate3d("+u+"px,"+p+"px,0)"),this.forRepaintDummy=Ls(n),M(n,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),M(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){M(n,"transition",""),M(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},a)}}}}function Ls(i){return i.offsetWidth}function ws(i,e,t,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var _e=[],vn={initializeByDefault:!0},Yt={mount:function(e){for(var t in vn)vn.hasOwnProperty(t)&&!(t in e)&&(e[t]=vn[t]);_e.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),_e.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var s=e+"Global";_e.forEach(function(a){t[a.pluginName]&&(t[a.pluginName][s]&&t[a.pluginName][s](Ne({sortable:t},n)),t.options[a.pluginName]&&t[a.pluginName][e]&&t[a.pluginName][e](Ne({sortable:t},n)))})},initializePlugins:function(e,t,n,o){_e.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var d=new r(e,t,e.options);d.sortable=e,d.options=e.options,e[l]=d,ke(n,d.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var a=this.modifyOption(e,s,e.options[s]);typeof a<"u"&&(e.options[s]=a)}},getEventProperties:function(e,t){var n={};return _e.forEach(function(o){typeof o.eventProperties=="function"&&ke(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return _e.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[t]=="function"&&(o=s.optionListeners[t].call(e[s.pluginName],n))}),o}};function ks(i){var e=i.sortable,t=i.rootEl,n=i.name,o=i.targetEl,s=i.cloneEl,a=i.toEl,r=i.fromEl,l=i.oldIndex,d=i.newIndex,u=i.oldDraggableIndex,p=i.newDraggableIndex,h=i.originalEvent,E=i.putSortable,b=i.extraEventProperties;if(e=e||t&&t[ie],!!e){var L,z=e.options,q="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Ie&&!$t?L=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(L=document.createEvent("Event"),L.initEvent(n,!0,!0)),L.to=a||t,L.from=r||t,L.item=o||t,L.clone=s,L.oldIndex=l,L.newIndex=d,L.oldDraggableIndex=u,L.newDraggableIndex=p,L.originalEvent=h,L.pullMode=E?E.lastPutMode:void 0;var $=Ne(Ne({},b),Yt.getEventProperties(n,e));for(var te in $)L[te]=$[te];t&&t.dispatchEvent(L),z[q]&&z[q].call(e,L)}}var Is=["evt"],se=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,s=bs(n,Is);Yt.pluginEvent.bind(D)(e,t,Ne({dragEl:y,parentEl:W,ghostEl:P,rootEl:H,nextEl:We,lastDownEl:tn,cloneEl:V,cloneHidden:Oe,dragStarted:Et,putSortable:Q,activeSortable:D.active,originalEvent:o,oldIndex:ot,oldDraggableIndex:kt,newIndex:de,newDraggableIndex:Pe,hideGhostForTarget:Jo,unhideGhostForTarget:Ko,cloneNowHidden:function(){Oe=!0},cloneNowShown:function(){Oe=!1},dispatchSortableEvent:function(r){ne({sortable:t,name:r,originalEvent:o})}},s))};function ne(i){ks(Ne({putSortable:Q,cloneEl:V,targetEl:y,rootEl:H,oldIndex:ot,oldDraggableIndex:kt,newIndex:de,newDraggableIndex:Pe},i))}var y,W,P,H,We,tn,V,Oe,ot,de,kt,Pe,Kt,Q,tt=!1,rn=!1,ln=[],He,pe,Cn,En,vo,Co,Et,et,It,Rt=!1,Zt=!1,nn,_,Nn=[],Vn=!1,cn=[],Sn=typeof document<"u",Qt=io,Eo=$t||Ie?"cssFloat":"float",Rs=Sn&&!xo&&!io&&"draggable"in document.createElement("div"),$o=function(){if(Sn){if(Ie)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Yo=function(e,t){var n=M(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),s=dt(e,0,t),a=dt(e,1,t),r=s&&M(s),l=a&&M(a),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+K(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+K(a).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&r.float&&r.float!=="none"){var p=r.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return s&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=o&&n[Eo]==="none"||a&&n[Eo]==="none"&&d+u>o)?"vertical":"horizontal"},Ms=function(e,t,n){var o=n?e.left:e.top,s=n?e.right:e.bottom,a=n?e.width:e.height,r=n?t.left:t.top,l=n?t.right:t.bottom,d=n?t.width:t.height;return o===r||s===l||o+a/2===r+d/2},Ds=function(e,t){var n;return ln.some(function(o){var s=o[ie].options.emptyInsertThreshold;if(!(!s||ro(o))){var a=K(o),r=e>=a.left-s&&e<=a.right+s,l=t>=a.top-s&&t<=a.bottom+s;if(r&&l)return n=o}}),n},Xo=function(e){function t(s,a){return function(r,l,d,u){var p=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(s==null&&(a||p))return!0;if(s==null||s===!1)return!1;if(a&&s==="clone")return s;if(typeof s=="function")return t(s(r,l,d,u),a)(r,l,d,u);var h=(a?r:l).options.group.name;return s===!0||typeof s=="string"&&s===h||s.join&&s.indexOf(h)>-1}}var n={},o=e.group;(!o||en(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Jo=function(){!$o&&P&&M(P,"display","none")},Ko=function(){!$o&&P&&M(P,"display","")};Sn&&!xo&&document.addEventListener("click",function(i){if(rn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),rn=!1,!1},!0);var Ve=function(e){if(y){e=e.touches?e.touches[0]:e;var t=Ds(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[ie]._onDragOver(n)}}},Ps=function(e){y&&y.parentNode[ie]._isOutsideThisEl(e.target)};function D(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=ke({},e),i[ie]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Yo(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,r){a.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:D.supportPointer!==!1&&"PointerEvent"in window&&(!Lt||io),emptyInsertThreshold:5};Yt.initializePlugins(this,i,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Xo(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:Rs,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(i,"pointerdown",this._onTapStart):(x(i,"mousedown",this._onTapStart),x(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(i,"dragover",this),x(i,"dragenter",this)),ln.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ke(this,Ts())}D.prototype={constructor:D,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(et=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,y):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,s=o.preventOnFilter,a=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(Bs(n),!y&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||o.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Lt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=me(l,o.draggable,n,!1),!(l&&l.animated)&&tn!==l)){if(ot=fe(l),kt=fe(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){ne({sortable:t,rootEl:d,name:"filter",targetEl:l,toEl:n,fromEl:n}),se("filter",t,{evt:e}),s&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(p){if(p=me(d,p.trim(),n,!1),p)return ne({sortable:t,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),se("filter",t,{evt:e}),!0}),u)){s&&e.preventDefault();return}o.handle&&!me(d,o.handle,n,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,t,n){var o=this,s=o.el,a=o.options,r=s.ownerDocument,l;if(n&&!y&&n.parentNode===s){var d=K(n);if(H=s,y=n,W=y.parentNode,We=y.nextSibling,tn=n,Kt=a.group,D.dragged=y,He={target:y,clientX:(t||e).clientX,clientY:(t||e).clientY},vo=He.clientX-d.left,Co=He.clientY-d.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,y.style["will-change"]="all",l=function(){if(se("delayEnded",o,{evt:e}),D.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!mo&&o.nativeDraggable&&(y.draggable=!0),o._triggerDragStart(e,t),ne({sortable:o,name:"choose",originalEvent:e}),ce(y,a.chosenClass,!0)},a.ignore.split(",").forEach(function(u){qo(y,u.trim(),Tn)}),x(r,"dragover",Ve),x(r,"mousemove",Ve),x(r,"touchmove",Ve),a.supportPointer?(x(r,"pointerup",o._onDrop),!this.nativeDraggable&&x(r,"pointercancel",o._onDrop)):(x(r,"mouseup",o._onDrop),x(r,"touchend",o._onDrop),x(r,"touchcancel",o._onDrop)),mo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,y.draggable=!0),se("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||t)&&(!this.nativeDraggable||!($t||Ie))){if(D.eventCanceled){this._onDrop();return}a.supportPointer?(x(r,"pointerup",o._disableDelayedDrag),x(r,"pointercancel",o._disableDelayedDrag)):(x(r,"mouseup",o._disableDelayedDrag),x(r,"touchend",o._disableDelayedDrag),x(r,"touchcancel",o._disableDelayedDrag)),x(r,"mousemove",o._delayedDragTouchMoveHandler),x(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&x(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){y&&Tn(y),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;G(e,"mouseup",this._disableDelayedDrag),G(e,"touchend",this._disableDelayedDrag),G(e,"touchcancel",this._disableDelayedDrag),G(e,"pointerup",this._disableDelayedDrag),G(e,"pointercancel",this._disableDelayedDrag),G(e,"mousemove",this._delayedDragTouchMoveHandler),G(e,"touchmove",this._delayedDragTouchMoveHandler),G(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):t?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(y,"dragend",this),x(H,"dragstart",this._onDragStart));try{document.selection?on(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(tt=!1,H&&y){se("dragStarted",this,{evt:t}),this.nativeDraggable&&x(document,"dragover",Ps);var n=this.options;!e&&ce(y,n.dragClass,!1),ce(y,n.ghostClass,!0),D.active=this,e&&this._appendGhost(),ne({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(pe){this._lastX=pe.clientX,this._lastY=pe.clientY,Jo();for(var e=document.elementFromPoint(pe.clientX,pe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(pe.clientX,pe.clientY),e!==t);)t=e;if(y.parentNode[ie]._isOutsideThisEl(e),t)do{if(t[ie]){var n=void 0;if(n=t[ie]._onDragOver({clientX:pe.clientX,clientY:pe.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Bo(t));Ko()}},_onTouchMove:function(e){if(He){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,s=e.touches?e.touches[0]:e,a=P&&at(P,!0),r=P&&a&&a.a,l=P&&a&&a.d,d=Qt&&_&&bo(_),u=(s.clientX-He.clientX+o.x)/(r||1)+(d?d[0]-Nn[0]:0)/(r||1),p=(s.clientY-He.clientY+o.y)/(l||1)+(d?d[1]-Nn[1]:0)/(l||1);if(!D.active&&!tt){if(n&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(P){a?(a.e+=u-(Cn||0),a.f+=p-(En||0)):a={a:1,b:0,c:0,d:1,e:u,f:p};var h="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");M(P,"webkitTransform",h),M(P,"mozTransform",h),M(P,"msTransform",h),M(P,"transform",h),Cn=u,En=p,pe=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!P){var e=this.options.fallbackOnBody?document.body:H,t=K(y,!0,Qt,!0,e),n=this.options;if(Qt){for(_=e;M(_,"position")==="static"&&M(_,"transform")==="none"&&_!==document;)_=_.parentNode;_!==document.body&&_!==document.documentElement?(_===document&&(_=Ee()),t.top+=_.scrollTop,t.left+=_.scrollLeft):_=Ee(),Nn=bo(_)}P=y.cloneNode(!0),ce(P,n.ghostClass,!1),ce(P,n.fallbackClass,!0),ce(P,n.dragClass,!0),M(P,"transition",""),M(P,"transform",""),M(P,"box-sizing","border-box"),M(P,"margin",0),M(P,"top",t.top),M(P,"left",t.left),M(P,"width",t.width),M(P,"height",t.height),M(P,"opacity","0.8"),M(P,"position",Qt?"absolute":"fixed"),M(P,"zIndex","100000"),M(P,"pointerEvents","none"),D.ghost=P,e.appendChild(P),M(P,"transform-origin",vo/parseInt(P.style.width)*100+"% "+Co/parseInt(P.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,s=n.options;if(se("dragStart",this,{evt:e}),D.eventCanceled){this._onDrop();return}se("setupClone",this),D.eventCanceled||(V=Wo(y),V.removeAttribute("id"),V.draggable=!1,V.style["will-change"]="",this._hideClone(),ce(V,this.options.chosenClass,!1),D.clone=V),n.cloneId=on(function(){se("clone",n),!D.eventCanceled&&(n.options.removeCloneOnHide||H.insertBefore(V,y),n._hideClone(),ne({sortable:n,name:"clone"}))}),!t&&ce(y,s.dragClass,!0),t?(rn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(G(document,"mouseup",n._onDrop),G(document,"touchend",n._onDrop),G(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",s.setData&&s.setData.call(n,o,y)),x(document,"drop",n),M(y,"transform","translateZ(0)")),tt=!0,n._dragStartId=on(n._dragStarted.bind(n,t,e)),x(document,"selectstart",n),Et=!0,window.getSelection().removeAllRanges(),Lt&&M(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,s,a,r=this.options,l=r.group,d=D.active,u=Kt===l,p=r.sort,h=Q||d,E,b=this,L=!1;if(Vn)return;function z(vt,es){se(vt,b,Ne({evt:e,isOwner:u,axis:E?"vertical":"horizontal",revert:a,dragRect:o,targetRect:s,canSort:p,fromSortable:h,target:n,completed:$,onMove:function(go,ts){return _t(H,t,y,o,go,K(go),e,ts)},changed:te},es))}function q(){z("dragOverAnimationCapture"),b.captureAnimationState(),b!==h&&h.captureAnimationState()}function $(vt){return z("dragOverCompleted",{insertion:vt}),vt&&(u?d._hideClone():d._showClone(b),b!==h&&(ce(y,Q?Q.options.ghostClass:d.options.ghostClass,!1),ce(y,r.ghostClass,!0)),Q!==b&&b!==D.active?Q=b:b===D.active&&Q&&(Q=null),h===b&&(b._ignoreWhileAnimating=n),b.animateAll(function(){z("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===y&&!y.animated||n===t&&!n.animated)&&(et=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(y.parentNode[ie]._isOutsideThisEl(e.target),!vt&&Ve(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),L=!0}function te(){de=fe(y),Pe=fe(y,r.draggable),ne({sortable:b,name:"change",toEl:t,newIndex:de,newDraggableIndex:Pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=me(n,r.draggable,t,!0),z("dragOver"),D.eventCanceled)return L;if(y.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||b._ignoreWhileAnimating===n)return $(!1);if(rn=!1,d&&!r.disabled&&(u?p||(a=W!==H):Q===this||(this.lastPutMode=Kt.checkPull(this,d,y,e))&&l.checkPut(this,d,y,e))){if(E=this._getDirection(e,n)==="vertical",o=K(y),z("dragOverValid"),D.eventCanceled)return L;if(a)return W=H,q(),this._hideClone(),z("revert"),D.eventCanceled||(We?H.insertBefore(y,We):H.appendChild(y)),$(!0);var re=ro(t,r.draggable);if(!re||Gs(e,E,this)&&!re.animated){if(re===y)return $(!1);if(re&&t===e.target&&(n=re),n&&(s=K(n)),_t(H,t,y,o,n,s,e,!!n)!==!1)return q(),re&&re.nextSibling?t.insertBefore(y,re.nextSibling):t.appendChild(y),W=t,te(),$(!0)}else if(re&&zs(e,E,this)){var Ue=dt(t,0,r,!0);if(Ue===y)return $(!1);if(n=Ue,s=K(n),_t(H,t,y,o,n,s,e,!1)!==!1)return q(),t.insertBefore(y,Ue),W=t,te(),$(!0)}else if(n.parentNode===t){s=K(n);var Se=0,Be,mt=y.parentNode!==t,le=!Ms(y.animated&&y.toRect||o,n.animated&&n.toRect||s,E),St=E?"top":"left",Re=yo(n,"top","top")||yo(y,"top","top"),yt=Re?Re.scrollTop:void 0;et!==n&&(Be=s[St],Rt=!1,Zt=!le&&r.invertSwap||mt),Se=Fs(e,n,s,E,le?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,Zt,et===n);var Te;if(Se!==0){var qe=fe(y);do qe-=Se,Te=W.children[qe];while(Te&&(M(Te,"display")==="none"||Te===P))}if(Se===0||Te===n)return $(!1);et=n,It=Se;var bt=n.nextElementSibling,Me=!1;Me=Se===1;var Xt=_t(H,t,y,o,n,s,e,Me);if(Xt!==!1)return(Xt===1||Xt===-1)&&(Me=Xt===1),Vn=!0,setTimeout(Os,30),q(),Me&&!bt?t.appendChild(y):n.parentNode.insertBefore(y,Me?bt:n),Re&&Vo(Re,0,yt-Re.scrollTop),W=y.parentNode,Be!==void 0&&!Zt&&(nn=Math.abs(Be-K(n)[St])),te(),$(!0)}if(t.contains(y))return $(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){G(document,"mousemove",this._onTouchMove),G(document,"touchmove",this._onTouchMove),G(document,"pointermove",this._onTouchMove),G(document,"dragover",Ve),G(document,"mousemove",Ve),G(document,"touchmove",Ve)},_offUpEvents:function(){var e=this.el.ownerDocument;G(e,"mouseup",this._onDrop),G(e,"touchend",this._onDrop),G(e,"pointerup",this._onDrop),G(e,"pointercancel",this._onDrop),G(e,"touchcancel",this._onDrop),G(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(de=fe(y),Pe=fe(y,n.draggable),se("drop",this,{evt:e}),W=y&&y.parentNode,de=fe(y),Pe=fe(y,n.draggable),D.eventCanceled){this._nulling();return}tt=!1,Zt=!1,Rt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Wn(this.cloneId),Wn(this._dragStartId),this.nativeDraggable&&(G(document,"drop",this),G(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Lt&&M(document.body,"user-select",""),M(y,"transform",""),e&&(Et&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),P&&P.parentNode&&P.parentNode.removeChild(P),(H===W||Q&&Q.lastPutMode!=="clone")&&V&&V.parentNode&&V.parentNode.removeChild(V),y&&(this.nativeDraggable&&G(y,"dragend",this),Tn(y),y.style["will-change"]="",Et&&!tt&&ce(y,Q?Q.options.ghostClass:this.options.ghostClass,!1),ce(y,this.options.chosenClass,!1),ne({sortable:this,name:"unchoose",toEl:W,newIndex:null,newDraggableIndex:null,originalEvent:e}),H!==W?(de>=0&&(ne({rootEl:W,name:"add",toEl:W,fromEl:H,originalEvent:e}),ne({sortable:this,name:"remove",toEl:W,originalEvent:e}),ne({rootEl:W,name:"sort",toEl:W,fromEl:H,originalEvent:e}),ne({sortable:this,name:"sort",toEl:W,originalEvent:e})),Q&&Q.save()):de!==ot&&de>=0&&(ne({sortable:this,name:"update",toEl:W,originalEvent:e}),ne({sortable:this,name:"sort",toEl:W,originalEvent:e})),D.active&&((de==null||de===-1)&&(de=ot,Pe=kt),ne({sortable:this,name:"end",toEl:W,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){se("nulling",this),H=y=W=P=We=V=tn=Oe=He=pe=Et=de=Pe=ot=kt=et=It=Q=Kt=D.dragged=D.ghost=D.clone=D.active=null,cn.forEach(function(e){e.checked=!0}),cn.length=Cn=En=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":y&&(this._onDragOver(e),As(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,s=n.length,a=this.options;o<s;o++)t=n[o],me(t,a.draggable,this.el,!1)&&e.push(t.getAttribute(a.dataIdAttr)||Us(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(s,a){var r=o.children[a];me(r,this.options.draggable,o,!1)&&(n[s]=r)},this),t&&this.captureAnimationState(),e.forEach(function(s){n[s]&&(o.removeChild(n[s]),o.appendChild(n[s]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return me(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=Yt.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Xo(n)},destroy:function(){se("destroy",this);var e=this.el;e[ie]=null,G(e,"mousedown",this._onTapStart),G(e,"touchstart",this._onTapStart),G(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(G(e,"dragover",this),G(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ln.splice(ln.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Oe){if(se("hideClone",this),D.eventCanceled)return;M(V,"display","none"),this.options.removeCloneOnHide&&V.parentNode&&V.parentNode.removeChild(V),Oe=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Oe){if(se("showClone",this),D.eventCanceled)return;y.parentNode==H&&!this.options.group.revertClone?H.insertBefore(V,y):We?H.insertBefore(V,We):H.appendChild(V),this.options.group.revertClone&&this.animate(y,V),M(V,"display",""),Oe=!1}}};function As(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function _t(i,e,t,n,o,s,a,r){var l,d=i[ie],u=d.options.onMove,p;return window.CustomEvent&&!Ie&&!$t?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=i,l.dragged=t,l.draggedRect=n,l.related=o||e,l.relatedRect=s||K(e),l.willInsertAfter=r,l.originalEvent=a,i.dispatchEvent(l),u&&(p=u.call(d,l,a)),p}function Tn(i){i.draggable=!1}function Os(){Vn=!1}function zs(i,e,t){var n=K(dt(t.el,0,t.options,!0)),o=jo(t.el,t.options,P),s=10;return e?i.clientX<o.left-s||i.clientY<n.top&&i.clientX<n.right:i.clientY<o.top-s||i.clientY<n.bottom&&i.clientX<n.left}function Gs(i,e,t){var n=K(ro(t.el,t.options.draggable)),o=jo(t.el,t.options,P),s=10;return e?i.clientX>o.right+s||i.clientY>n.bottom&&i.clientX>n.left:i.clientY>o.bottom+s||i.clientX>n.right&&i.clientY>n.top}function Fs(i,e,t,n,o,s,a,r){var l=n?i.clientY:i.clientX,d=n?t.height:t.width,u=n?t.top:t.left,p=n?t.bottom:t.right,h=!1;if(!a){if(r&&nn<d*o){if(!Rt&&(It===1?l>u+d*s/2:l<p-d*s/2)&&(Rt=!0),Rt)h=!0;else if(It===1?l<u+nn:l>p-nn)return-It}else if(l>u+d*(1-o)/2&&l<p-d*(1-o)/2)return xs(e)}return h=h||a,h&&(l<u+d*s/2||l>p-d*s/2)?l>u+d/2?1:-1:0}function xs(i){return fe(y)<fe(i)?1:-1}function Us(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Bs(i){cn.length=0;for(var e=i.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&cn.push(n)}}function on(i){return setTimeout(i,0)}function Wn(i){return clearTimeout(i)}Sn&&x(document,"touchmove",function(i){(D.active||tt)&&i.cancelable&&i.preventDefault()});D.utils={on:x,off:G,css:M,find:qo,is:function(e,t){return!!me(e,t,e,!1)},extend:Es,throttle:Ho,closest:me,toggleClass:ce,clone:Wo,index:fe,nextTick:on,cancelNextTick:Wn,detectDirection:Yo,getChild:dt,expando:ie};D.get=function(i){return i[ie]};D.mount=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(D.utils=Ne(Ne({},D.utils),n.utils)),Yt.mount(n)})};D.create=function(i,e){return new D(i,e)};D.version=vs;var X=[],Nt,jn,$n=!1,Ln,wn,dn,Tt;function qs(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):n.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?G(document,"dragover",this._handleAutoScroll):(G(document,"pointermove",this._handleFallbackAutoScroll),G(document,"touchmove",this._handleFallbackAutoScroll),G(document,"mousemove",this._handleFallbackAutoScroll)),No(),sn(),Ns()},nulling:function(){dn=jn=Nt=$n=Tt=Ln=wn=null,X.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,s=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(s,a);if(dn=t,n||this.options.forceAutoScrollFallback||$t||Ie||Lt){kn(t,this.options,r,n);var l=Ge(r,!0);$n&&(!Tt||s!==Ln||a!==wn)&&(Tt&&No(),Tt=setInterval(function(){var d=Ge(document.elementFromPoint(s,a),!0);d!==l&&(l=d,sn()),kn(t,o.options,d,n)},10),Ln=s,wn=a)}else{if(!this.options.bubbleScroll||Ge(r,!0)===Ee()){sn();return}kn(t,this.options,Ge(r,!1),!1)}}},ke(i,{pluginName:"scroll",initializeByDefault:!0})}function sn(){X.forEach(function(i){clearInterval(i.pid)}),X=[]}function No(){clearInterval(Tt)}var kn=Ho(function(i,e,t,n){if(e.scroll){var o=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,a=e.scrollSensitivity,r=e.scrollSpeed,l=Ee(),d=!1,u;jn!==t&&(jn=t,sn(),Nt=e.scroll,u=e.scrollFn,Nt===!0&&(Nt=Ge(t,!0)));var p=0,h=Nt;do{var E=h,b=K(E),L=b.top,z=b.bottom,q=b.left,$=b.right,te=b.width,re=b.height,Ue=void 0,Se=void 0,Be=E.scrollWidth,mt=E.scrollHeight,le=M(E),St=E.scrollLeft,Re=E.scrollTop;E===l?(Ue=te<Be&&(le.overflowX==="auto"||le.overflowX==="scroll"||le.overflowX==="visible"),Se=re<mt&&(le.overflowY==="auto"||le.overflowY==="scroll"||le.overflowY==="visible")):(Ue=te<Be&&(le.overflowX==="auto"||le.overflowX==="scroll"),Se=re<mt&&(le.overflowY==="auto"||le.overflowY==="scroll"));var yt=Ue&&(Math.abs($-o)<=a&&St+te<Be)-(Math.abs(q-o)<=a&&!!St),Te=Se&&(Math.abs(z-s)<=a&&Re+re<mt)-(Math.abs(L-s)<=a&&!!Re);if(!X[p])for(var qe=0;qe<=p;qe++)X[qe]||(X[qe]={});(X[p].vx!=yt||X[p].vy!=Te||X[p].el!==E)&&(X[p].el=E,X[p].vx=yt,X[p].vy=Te,clearInterval(X[p].pid),(yt!=0||Te!=0)&&(d=!0,X[p].pid=setInterval((function(){n&&this.layer===0&&D.active._onTouchMove(dn);var bt=X[this.layer].vy?X[this.layer].vy*r:0,Me=X[this.layer].vx?X[this.layer].vx*r:0;typeof u=="function"&&u.call(D.dragged.parentNode[ie],Me,bt,i,dn,X[this.layer].el)!=="continue"||Vo(X[this.layer].el,Me,bt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&h!==l&&(h=Ge(h,!1)));$n=d}},30),Zo=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,s=e.activeSortable,a=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(t){var d=n||s;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(u.clientX,u.clientY);l(),d&&!d.el.contains(p)&&(a("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function lo(){}lo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=dt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Zo};ke(lo,{pluginName:"revertOnSpill"});function co(){}co.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Zo};ke(co,{pluginName:"removeOnSpill"});D.mount(new qs);D.mount(co,lo);const In="root";var Qe,J,hn,Vt,Yn;const T=class T{static init(){if(T.noFolderView()||!ui.scenes)return;T.preloadTemplates(),game.user.getFlag(B,"activeSceneFoldersV1")||game.user.setFlag(B,"activeSceneFoldersV1",[]);const e=document.querySelector("#navigation #scene-list");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(U.RENDER_SCENE_DIRECTORY,(n,o)=>{var s;O(s=T,Vt,Yn).call(s)})}static addFolderButtons(e,t,n){if(g.log("addFolderButtons",[A.useSceneFolders,game.scenes.size,game.scenes.folders.size]),!A.useSceneFolders||A.isRipperSceneNavOn||A.isMonksSceneNavOn||game.user.isGM===!1||game.scenes.size<2||game.scenes.folders.size<1)return;const o=v();if(document.querySelector("#crlngn-folder-toggle"))return;const a=document.querySelector("#navigation"),r=a.querySelector("#scene-list"),l=document.createElement("div");l.dataset.tooltip=A.navShowSceneFolders?"Hide Scene Folders":"Show Scene Folders",l.dataset.tooltipDirection="DOWN",l.id="crlngn-folder-toggle",l.innerHTML="<i class='fa-solid icon'></i>",A.navShowSceneFolders?a.classList.add("with-folders"):a.classList.remove("with-folders"),l.addEventListener("click",()=>{var d;A.setNavPosition(0),C.set(o.navShowSceneFolders.tag,!A.navShowSceneFolders),A.preventReposition=!0,(d=ui.nav)==null||d.render()}),a.insertBefore(l,r)}static toggleFolderLookup(e){const t=e.target.parentNode;e.stopPropagation(),e.preventDefault(),g.log("toggleFolderLookup",[e,t]),t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){var r;if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],s=e.contents?[...e.contents]:[];s=s.filter(l=>l.permission>=2);let a="a";return g.log("buildFolderData A",[e.name,e]),e.id===In?(o=t.filter(l=>l.folder===null)||[],O(r=T,Vt,Yn).call(r),a=N(T,Qe)):(o=e.children,a=e.sorting),o=T.sortFolderList(o,a),s=T.sortFolderScenes(s,a),n={currentFolder:e,folders:o,scenes:s,useIcons:A.useSceneIcons,usePreview:A.useScenePreview},g.log("buildFolderData",[o,n]),n}static sortFolderList(e,t="a"){return e=e.map((n,o)=>n.folder?n.folder:n),g.log("sortFolderList",[t,e]),t==="a"?e.sort((n,o)=>n.name.toLowerCase().localeCompare(o.name.toLowerCase())):e.sort((n,o)=>n.sort-o.sort),e}static sortFolderScenes(e,t="a"){return t==="a"?e.sort((n,o)=>n.name.toLowerCase().localeCompare(o.name.toLowerCase())):e.sort((n,o)=>n.sort-o.sort),e}};Qe=new WeakMap,J=new WeakMap,hn=new WeakMap,Vt=new WeakSet,Yn=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){F(T,Qe,game.scenes.sortingMode);return}}catch(e){console.error("Error checking scene directory sort mode:",e)}F(T,Qe,"a"),g.log("updateSortMode fallback",[N(gSceneNavFolders,Qe)])},I(T,Vt),S(T,"selectedFolder",In),I(T,Qe,"a"),I(T,J,[]),S(T,"searchValue",""),S(T,"renderFolderList",async e=>{F(T,J,game.user.getFlag(B,"activeSceneFoldersV1")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:In},s=T.buildTemplateData(o),a=await renderTemplate(`modules/${B}/templates/scene-nav-folders.hbs`,s);g.log("renderFolderList",[o,N(T,J)]),e?t=e.parentNode:t=A.scenesList,t.insertAdjacentHTML("afterbegin",a);const r=t.querySelectorAll("li.crlngn-folder");T.addFolderListeners(r),A.placeNavButtons()}),S(T,"handleFolderLookup",async()=>{var a;const e=await renderTemplate(`modules/${B}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n?n.insertAdjacentHTML("beforeend",e):(a=document.querySelector("#scene-list"))==null||a.insertAdjacentHTML("beforebegin",e);const o=n==null?void 0:n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",T.onSearchInput),o.addEventListener("keydown",r=>{r.stopPropagation()});const s=n==null?void 0:n.querySelector(".scene-lookup-toggle");s&&s.addEventListener("click",T.toggleFolderLookup)}),S(T,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",N(T,hn));const o=n.dataset.folderId,s=t.get(o);N(T,J).includes(o)&&(n.classList.add("crlngn-folder-active"),T.injectSubfolders(s,n))})}),I(T,hn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,s=n?o.get(n):null;if(!s)return;await T.injectSubfolders(s,t.parentNode),A.addSceneListeners(t.parentNode),g.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?T.updateActiveFolders(n,!0):T.updateActiveFolders(n,!1)}),S(T,"injectSubfolders",async(e,t)=>{const n=T.buildTemplateData(e),o=await renderTemplate(`modules/${B}/templates/scene-nav-subfolders.hbs`,n),s=t.querySelector(".contents");s&&s.remove(),t.insertAdjacentHTML("beforeend",o);const a=t.querySelectorAll("li.crlngn-folder");T.addFolderListeners(a),A.addSceneListeners(t.querySelector(".contents"))}),S(T,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-list"),o=n==null?void 0:n.querySelector(`li.crlngn-folder[data-folder-id="${e}"]`),s=N(T,J).indexOf(e);g.log("updateActiveFolders A",[s,e,game.user.getFlag(B,"activeSceneFoldersV1"),N(T,J)]),t?(F(T,J,N(T,J).filter(a=>a!==e)),o.classList.remove("crlngn-folder-active")):N(T,J).includes(e)||(o.parentNode.querySelectorAll("li.crlngn-folder").forEach(r=>{r!==o&&(F(T,J,N(T,J).filter(l=>l!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),N(T,J).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(B,"activeSceneFoldersV1",N(T,J)),g.log("updateActiveFolders B",[t,e,game.user.getFlag(B,"activeSceneFoldersV1"),N(T,J)])}),S(T,"selectFolder",e=>T.getFolderById(e)||null),S(T,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!A.navFoldersForPlayers||!A.useSceneFolders||!A.sceneNavEnabled}),S(T,"preloadTemplates",async()=>{const e=[`modules/${B}/templates/scene-nav-folders.hbs`,`modules/${B}/templates/scene-nav-subfolders.hbs`,`modules/${B}/templates/scene-nav-lookup.hbs`,`modules/${B}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}),S(T,"onSearchInput",e=>{e.stopPropagation();const t=e.currentTarget,n=t.value;g.log("onSearchInput",[t.value]),T.searchValue=n,T.updateSearchResults(n)}),S(T,"updateSearchResults",e=>{var s,a;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((s=game.scenes)==null?void 0:s.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];n.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase()));let o=[];if(A.useSceneFolders&&(o=((a=game.scenes)==null?void 0:a.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[],o.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase())),o.forEach(r=>{const l=document.createElement("li");l.className="search-folder",l.dataset.folderId=r.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,l.addEventListener("click",T.onSelectSearchedFolder),t.appendChild(l)})),n.forEach(r=>{const l=document.createElement("li");l.className="search-scene",l.dataset.sceneId=r.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,l.addEventListener("dblclick",A.onActivateScene),l.addEventListener("click",A.onSelectScene),t.appendChild(l)}),o.length===0&&n.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}t.classList.remove("hidden")}),S(T,"onSelectSearchedFolder",e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");A.navShowSceneFolders||o.click(),n&&T.activateFolder(n)}),S(T,"activateFolder",async e=>{const o=[...ui.scenes.collection.folders.get(e).ancestors];F(T,J,[]);for(const s of o)N(T,J).push(s.id);N(T,J).push(e),await game.user.setFlag(B,"activeSceneFoldersV1",N(T,J)),setTimeout(async()=>{A.preventReposition=!0,ui.nav.render()},200)});let Ae=T;var ht,Qo,_o;const oe=class oe{static init(){const e=v();g.log("SheetsUtil.init",[]),game.system.id==="dnd5e"&&(oe.themeStylesEnabled=C.get(e.applyThemeToSheets.tag),oe.horizontalSheetTabsEnabled=C.get(e.useHorizontalSheetTabs.tag),Hooks.on(U.RENDER_ACTOR_SHEET,O(oe,ht,Qo)))}static applyThemeToSheets(e){oe.themeStylesEnabled=e,e?document.body.classList.add("crlngn-sheets"):document.body.classList.remove("crlngn-sheets")}static applyHorizontalSheetTabs(e){oe.horizontalSheetTabsEnabled=e,e?document.body.classList.add("crlngn-sheet-tabs"):document.body.classList.remove("crlngn-sheet-tabs")}};ht=new WeakSet,Qo=function(e,t,n){var s;t=t[0]||t,g.log(U.RENDER_ACTOR_SHEET,[e,t.querySelector(".sheet-body"),n]),(s=t.querySelector(".sheet-body .main-content"))==null||s.addEventListener("scroll",O(oe,ht,_o));const o=t.querySelectorAll("nav.tabs > a.item");for(const a of o){const r=game.i18n.localize(a.getAttribute("aria-label"));a.setAttribute("data-label",r),a.removeAttribute("data-tooltip"),a.removeAttribute("data-tooltip-delay")}oe.applyThemeToSheets(oe.themeStylesEnabled),oe.applyHorizontalSheetTabs(oe.horizontalSheetTabsEnabled)},_o=function(e){const t=e.target.closest(".window-content"),n=t==null?void 0:t.querySelector(".ability-scores");n&&(e.target.scrollTop>30?n.classList.add("fadeout"):n.classList.remove("fadeout"))},I(oe,ht),S(oe,"themeStylesEnabled",!0),S(oe,"horizontalSheetTabsEnabled",!0);let Pt=oe;var rt;const m=class m{static registerSettings(){const e=v();g.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{const d=l[1];g.log("Registering... ",[l],!0);const u={name:d.label,hint:d.hint,default:d.default,type:d.propType,scope:d.scope,config:d.config,requiresReload:d.requiresReload||!1,onChange:p=>m.apply(d.tag,p)};(d.choices||d.options)&&(u.choices=d.choices||d.options),await game.settings.register(B,d.tag,u),m.get(d.tag)===void 0&&(g.log("resetting...",[d.tag]),m.set(d.tag,d.default))}),game.keybindings.register(B,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{m.hideInterface()},restricted:!1}),m.applyThemeSettings(),m.applyCustomCSS(),m.applyModuleAdjustments(),Object.entries(ms()).forEach(async l=>{const d=l[1],u={name:d.tag,label:d.label,hint:d.hint,icon:d.icon,type:d.propType,restricted:d.restricted};await game.settings.registerMenu(B,d.tag,u)}),Hooks.on(U.RENDER_SCENE_CONTROLS,m.applyLeftControlsSettings),Hooks.on(U.RENDER_PLAYERS_LIST,m.applyPlayersListSettings),Hooks.on(U.RENDER_HOTBAR,()=>{m.firstLoad&&(m.firstLoad=!1,m.applyHotBarCollapse()),m.applyHotBarSettings()}),m.applyDebugSettings(),m.applyChatStyles(),m.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.cameraDockMenu.fields.forEach(l=>{m.apply(e[l].tag)}),e.customFontsMenu.fields.forEach(l=>{m.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{m.applyLeftControlsSettings(e[l].tag)}),m.applyUiScale()}static get(e,t=B){if(!e)return null;let n=!1;if(t===B)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,g.log("GET Setting",[s,n])}return n}static set(e,t,n=B){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),g.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{g.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,s,a,r,l,d,u;const n=v();switch(t===void 0&&(t=m.get(e)),g.log("SettingsUtil.apply",[e,t,m.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:m.applyHotBarSettings();break;case n.collapseMacroBar.tag:m.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:m.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:m.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:case n.hideFoundryLogo.tag:m.applyLeftControlsSettings(e,t);break;case n.enableFloatingDock.tag:ee.currSettings.enableFloatingDock=t;break;case n.dockHeight.tag:ee.currSettings.dockHeight=t,m.applyCameraHeight(t);break;case n.dockWidth.tag:ee.currSettings.dockWidth=t,m.applyCameraWidth(t);break;case n.dockPosX.tag:ee.currSettings.dockPosX=t,m.applyCameraPosX(t);break;case n.dockPosY.tag:ee.currSettings.dockPosY=t,m.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:ee.currSettings.defaultVideoWidth=t,ee.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:ee.currSettings.dockResizeOnUserJoin=t,ee.applyDockResize(t);break;case n.chatBorderColor.tag:ct.chatBorderColor=m.get(n.chatBorderColor.tag),m.applyBorderColors();break;case n.enableChatStyles.tag:ct.enableChatStyles=m.get(n.enableChatStyles.tag),m.applyChatStyles();break;case n.enforceDarkMode.tag:m.resetFoundryThemeSettings();break;case n.debugMode.tag:m.applyDebugSettings();break;case n.sceneNavEnabled.tag:A.sceneNavEnabled=t,t===!1&&m.set(n.useSceneFolders.tag,!1),A.applyButtonSettings(),(o=ui.nav)==null||o.render();break;case n.useSceneFolders.tag:A.useSceneFolders=t,t===!1&&m.set(n.navShowSceneFolders.tag,!1);break;case n.navShowSceneFolders.tag:A.navShowSceneFolders=t;break;case n.sceneClickToView.tag:A.sceneClickToView=t,(s=game.scenes)==null||s.directory.render();break;case n.useSceneIcons.tag:A.useSceneIcons=t,(a=ui.nav)==null||a.render(),(r=game.scenes)==null||r.directory.render();break;case n.useSceneBackButton.tag:A.useSceneBackButton=t,(l=ui.nav)==null||l.render();break;case n.useSceneLookup.tag:A.useSceneLookup=t,A.applyButtonSettings(),(d=ui.nav)==null||d.render();break;case n.useScenePreview.tag:A.useScenePreview=t,(u=ui.nav)==null||u.render();break;case n.sceneNavAlias.tag:A.sceneNavAlias=t;break;case n.navStartCollapsed.tag:A.navStartCollapsed=t;break;case n.openFolderOnSceneLoad.tag:A.openFolderOnSceneLoad=t;break;case n.showNavOnHover.tag:A.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:A.isCollapsed=m.get(n.sceneNavCollapsed.tag);break;case n.sceneNavPos.tag:m.applySceneNavPos();break;case n.colorTheme.tag:m.applyThemeSettings();break;case n.customStyles.tag:m.applyCustomCSS();break;case n.adjustOtherModules.tag:m.applyModuleAdjustments();break;case n.otherModulesList.tag:m.applyOtherModulesList();break;case n.uiScale.tag:m.applyUiScale(t);break;case n.applyThemeToSheets.tag:Pt.applyThemeToSheets(t);break;case n.useHorizontalSheetTabs.tag:Pt.applyHorizontalSheetTabs(t);break}}static applyBorderColors(){const e=v(),t=m.get(e.chatBorderColor.tag),n=document.querySelector("body");t===lt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===lt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=v(),t=m.get(e.enableChatStyles.tag),n=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=v(),t=m.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=v();m.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const n=v(),o=m.get(n.sceneNavEnabled.tag),s=document.querySelector("#ui-left"),a=document.querySelector("#ui-left #logo"),r=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:m.get(n.controlsAutoHide.tag)?s.classList.add("auto-hide"):s.classList.remove("auto-hide");break;case n.hideFoundryLogo.tag:const d=window.getComputedStyle(r).getPropertyValue("--top-nav-height")||"0px",u=parseFloat(d)||0,p=m.get(n.hideFoundryLogo.tag);g.log("applyLeftControlsSettings",[e,u,d]),p===void 0||p===!0?(a.classList.remove("visible"),k.addCSSVars("--ui-top-padding",`${u}px`),document.querySelector("body").classList.remove("logo-visible")):(a.classList.add("visible"),o?(k.addCSSVars("--ui-top-padding",`${72+u}px`),document.querySelector("body").classList.add("logo-visible")):k.addCSSVars("--ui-top-padding","72px"));break;case n.controlsBottomBuffer.tag:m.applyControlsBuffer();break;case n.controlsIconSize.tag:m.applyControlIconSize();break}}static applyControlIconSize(){const e=v(),t=m.get(e.controlsIconSize.tag);document.querySelector("body");const n=je[t]?je[t].size:je.regular.size;function o(s){switch(s){case je.large.name:return"var(--font-size-18);";case je.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[n]),k.addCSSVars("--icon-font-size",o(t)),k.addCSSVars("--left-control-item-size",n),m.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyUiScale(e){var o,s,a,r,l,d;const t=v(),n=e||m.get(t.uiScale.tag);n===Rn.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(s=document.querySelector("#interface"))==null||s.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),k.addCSSVars("--macro-size","50px")):n===Rn.large.name?((a=document.querySelector("#interface"))==null||a.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),m.set(t.controlsIconSize.tag,n),k.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(d=document.querySelector("#interface"))==null||d.classList.remove("scale-large"),m.set(t.controlsIconSize.tag,n),k.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=v(),t=m.get(e.controlsBottomBuffer.tag),n=isNaN(t)?e.controlsBottomBuffer.default:t;g.log("applyControlsBuffer",[n,t]),k.addCSSVars("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,n;const e=v();g.log("applyPlayersListSettings",[document.querySelector("#players"),m.get(e.autoHidePlayerList.tag)]),m.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),st.checkPlayersList()}static applySceneNavPos(e){const t=v();A.navPos=e||m.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=v(),n=m.get(t.dockPosX.tag),o=e||n;ee.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=v(),n=m.get(t.dockPosY.tag),o=e||n;ee.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=v(),n=m.get(t.dockWidth.tag),o=e||n;ee.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=v(),n=m.get(t.dockHeight.tag),o=e||n;ee.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=v(),o=n.customFontsMenu.fields,s={};switch(g.log("applyCustomFonts",[e,t]),o.forEach(a=>{s[a]=m.get(n[a].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:k.addCSSVars("--crlngn-font-family",t||s.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:k.addCSSVars("--crlngn-font-titles",t||s.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:k.addCSSVars("--crlngn-font-journal-body",t||s.journalFontBody||s.journalFontBody||"");break;case n.journalFontTitles.tag:k.addCSSVars("--crlngn-font-journal-title",t||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var a,r;const e=v(),t=k.isModuleOn("monks-player-settings"),n=k.isModuleOn("force-client-settings"),o=m.get(e.enforceDarkMode.tag);if(o&&t){(a=game.user)!=null&&a.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}if(o&&n){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","colorScheme");g.log("resetFoundryThemeSettings",["color scheme",s," / dark mode",o]),!s&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=v();g.debugOn=e||m.get(t.debugMode.tag)}};rt=new WeakMap,I(m,rt,!1),S(m,"firstLoad",!0),S(m,"applyThemeSettings",e=>{const t=v(),n=e||m.get(t.colorTheme.tag)||"",o=document.querySelector("body");g.log("applyThemeSettings",[e,n,m.get(t.colorTheme.tag)]),De.forEach(s=>{s.className&&o.classList.remove(s.className)}),n&&o.classList.add(n)}),S(m,"applyCustomCSS",e=>{const t=v(),n=e||m.get(t.customStyles.tag)||"";k.addCustomCSS(n)}),S(m,"applyModuleAdjustments",e=>{const t=v();(e||m.get(t.adjustOtherModules.tag)||!1)&&st.addModuleClasses()}),S(m,"applyOtherModulesList",e=>{const t=v(),n=e||m.get(t.otherModulesList.tag);g.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?m.set(t.adjustOtherModules.tag,!1):m.set(t.adjustOtherModules.tag,!0),st.addModuleClasses()}),S(m,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");N(m,rt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),F(m,rt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),F(m,rt,!0))});let C=m;class uo{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,uo.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const n=e.offsetHeight;k.addCSSVars("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var ze,Wt,jt;const Y=class Y{static init(){g.log("LeftControls - init",[]),Hooks.on(U.RENDER_SCENE_CONTROLS,Y.initSceneControls),Y.initSceneControls()}static resetLocalVars(){F(Y,ze,document.querySelector("#ui-left #controls")),F(Y,Wt,document.querySelector("#ui-left"))}static initSceneControls(){g.log("initSceneControls",[]),Y.resetLocalVars(),Y.observeControlsWidth()}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!N(Y,ze))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};F(Y,jt,new ResizeObserver(n=>{t(()=>Y.updateCSSVars(),250)})),N(Y,jt).observe(N(Y,ze),{box:"border-box"}),Y.updateCSSVars()}static updateCSSVars(){if(!N(Y,ze))return;let e=parseInt(N(Y,Wt).offsetWidth),t=parseInt(N(Y,ze).offsetWidth),n=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&k.addCSSVars("--ui-controls-margin-left",n+"px")}};ze=new WeakMap,Wt=new WeakMap,jt=new WeakMap,I(Y,ze),I(Y,Wt),I(Y,jt);let Xn=Y;const Mt=class Mt{static getUpdateNewsUrl(){var t;const e=(t=game.modules.get("crlngn-ui"))==null?void 0:t.version;if(g.log("getUpdateNewsUrl",[e]),e){const n=`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`;return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(n)}&v=${e}`}else return""}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=v();C.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=v();try{const t=Mt.getUpdateNewsUrl();if(!t)return;const n=new AbortController,o=setTimeout(()=>n.abort(),1e4);try{const s=await C.get(e.lastUpdateId.tag),a=await Mt.getIdFromRawJson();if(g.log("checkForUpdates...",[a,s]),s===a)return;const r=await fetch(t,{signal:n.signal,mode:"cors",credentials:"omit"});if(clearTimeout(o),!r.ok){g.warn("checkForUpdates | Failed to fetch update news",[r.status,r.statusText]);return}const l=await r.json();await this.displayUpdateNews(l),C.set(e.lastUpdateId.tag,l.id),g.log("checkForUpdates | SUCCESS",[l.id])}catch(s){clearTimeout(o),s.name==="AbortError"?g.warn("checkForUpdates | Request timed out",[s]):g.warn("checkForUpdates | Fetch error",[s.message])}}catch(t){g.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;g.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});g.error("displayUpdateNews | Chat message created",[n,e])}catch(t){g.error("displayUpdateNews | Error creating chat message",[t])}}};S(Mt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/main/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let Jn=Mt;class Hs{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var mn;const Dt=class Dt{static init(){Hooks.once(U.INIT,()=>{var n,o;document.querySelector("body").classList.add(B),(n=document.querySelector("#ui-middle"))==null||n.classList.add(B),document.querySelector("body").classList.add("crlngn-sheets"),g.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},C.registerSettings();const e=v(),t=C.get(e.disableUI.tag);if(g.log(U.INIT,[t]),t){document.querySelector("body").classList.remove(B),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(B);return}A.init(),ee.init(),uo.init(),Xn.init(),ct.init(),Hooks.on(U.RENDER_CHAT_MESSAGE,N(Dt,mn))}),Hooks.once(U.READY,()=>{g.log("Core Ready",[]);const e=v();var t=C.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Hs.init(),st.init(),A.checkSceneNavCompat(),Jn.init(),Pt.init(),C.get(e.enableChatStyles.tag)&&Dt.addCSSLocalization(),C.resetFoundryThemeSettings(),C.applyOtherModulesList(),k.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";k.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),k.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),k.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),k.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),k.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),k.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),k.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),k.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),k.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),k.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};mn=new WeakMap,I(Dt,mn,(e,t)=>{g.log(U.RENDER_CHAT_MESSAGE,[e,t]),ct.enrichCard(e,t)});let Kn=Dt;Kn.init();
//# sourceMappingURL=crlngn-ui.js.map
