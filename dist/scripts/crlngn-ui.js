var je=Object.defineProperty;var Pe=C=>{throw TypeError(C)};var Ve=(C,e,t)=>e in C?je(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var R=(C,e,t)=>Ve(C,typeof e!="symbol"?e+"":e,t),Se=(C,e,t)=>e.has(C)||Pe("Cannot "+t);var f=(C,e,t)=>(Se(C,e,"read from private field"),t?t.call(C):e.get(C)),b=(C,e,t)=>e.has(C)?Pe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(C):e.set(C,t),T=(C,e,t,o)=>(Se(C,e,"write to private field"),o?o.call(C,t):e.set(C,t),t),M=(C,e,t)=>(Se(C,e,"access private method"),t);const E={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},O="crlngn-ui",ue=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],fe=class fe{static log(e="",t=[],o=!1){try{const n=fe.debugOn;if(!(o||n))return;console.log(...ue,e,...t)}catch{console.log(...ue,e,...t)}}static warn(e="",t=[]){console.warn(...ue,e,...t)}static logError(e,t){var o;t.ui&&((o=ui.notifications)==null||o.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ue,e)}};R(fe,"debugOn",!1);let g=fe;const N={select:"select",checkbox:"checkbox",text:"text",number:"number"},L={client:"client",world:"world"},oe={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},Z={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}};function p(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:L.world,config:!1,requiresReload:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:N.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:Z.playerColor.name},scope:L.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:oe.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:L.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:L.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:L.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:L.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:L.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:N.text,default:Z.playerColor.name,scope:L.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:N.number,default:200,scope:L.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:oe.small.name,scope:L.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox,propType:Boolean,default:!1,scope:L.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:N.checkbox,propType:Boolean,default:!0,scope:L.client,config:!1}}}const{ApplicationV2:Ye,HandlebarsApplicationMixin:Xe}=foundry.applications.api;var Q,we,Ae;const $=class $ extends Xe(Ye){static get DEFAULT_OPTIONS(){return{id:p().cameraDockMenu.tag,actions:{redefine:M($,Q,Ae)},form:{handler:M($,Q,we),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=p(),o={...m.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[o,e]),o}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){g.log("_onRender",[e,t])}};Q=new WeakSet,we=async function(e,t,o){const n=p();let a=m.get(n.cameraDockMenu.tag),i=a.enableFloatingDock;e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(o.object);await m.set(n.cameraDockMenu.tag,s),a=m.get(n.cameraDockMenu.tag),g.log("Saving settings:",[n.cameraDockMenu.tag,t,o.object,s,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.enableFloatingDock!=i&&location.reload()},Ae=async function(e,t){const o=p(),a=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.default;a.forEach(s=>{s.value=i[s.name],s.type==="checkbox"&&(s.checked=i[s.name])}),g.log("#onReset",[e,t,o.cameraDockMenu.default])},b($,Q),R($,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ne=$;const{ApplicationV2:Ke,HandlebarsApplicationMixin:Ze}=foundry.applications.api;var _,De,Ue;const W=class W extends Ze(Ke){static get DEFAULT_OPTIONS(){return{id:p().chatMessagesMenu.tag,actions:{redefine:M(W,_,Ue)},form:{handler:M(W,_,De),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=p(),o=m.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,a={},i={},s={};n.forEach(c=>{if(g.log("_prepareContext",[t[c].oldName]),t[c]){const h=m.get(t[c].tag);a[c]=t[c],i[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}}),g.log("_prepareContext",[i,s]);const r={...i,default:{...s},isGM:game.user.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const o=p(),n=m.get(o.chatMessagesMenu.tag);g.log("_onRender",[e,t,n])}};_=new WeakSet,De=async function(e,t,o){const n=p();e.preventDefault(),e.stopPropagation();const a=n.chatMessagesMenu.fields,i=foundry.utils.expandObject(o.object),s=m.get(n.chatBorderColor.tag);g.log("Compared settings:",[i.chatBorderColor,s]),a.forEach(c=>{g.log("Saving setting >>",[n[c].tag,i[c]]),i[c]!==void 0&&m.set(n[c].tag,i[c])}),await m.set(n.chatMessagesMenu.tag,i),i.chatBorderColor!==s&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ue=async function(e,t){const o=p(),a=this.element.querySelectorAll("input, select"),i=o.chatMessagesMenu.fields,s={};i.forEach(r=>{o[r]&&(o[r],s[r]=o[r].default)}),a.forEach(r=>{r.value=s[r.name]})},b(W,_),R(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let be=W;class A{static isModuleOn(e){var o;const t=(o=game.modules)==null?void 0:o.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,o=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+o)}static getAllFonts(){var i;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},o=Object.entries(t).map(([s])=>s),n=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){let r="";if(s.ownerNode.tagName==="STYLE")r=s.ownerNode.textContent;else if(s.ownerNode.tagName==="LINK")try{if((i=s.href)!=null&&i.startsWith(window.location.origin)){const S=s.cssRules||s.rules;r=Array.from(S).map(y=>y.cssText).join(`
`)}}catch(S){g.warn("Could not read stylesheet rules:",[S])}const c=/@import\s+url\(['"]([^'"]+)['"]\)/g;let h;for(;(h=c.exec(r))!==null;){const S=h[1];if(S.includes("fonts.googleapis.com")){const y=S.match(/family=([^&]+)/);y&&decodeURIComponent(y[1]).split("|").map(w=>w.split(":")[0].replace(/\+/g," ")).forEach(w=>{n.add(w)})}else try{fetch(S).then(y=>y.text()).then(y=>{(y.match(/@font-face\s*{[^}]+}/g)||[]).forEach(w=>{const ze=w.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(ze){const We=ze[1].trim();n.add(We)}})}).catch(y=>console.warn("Error loading imported CSS:",y))}catch(y){g.warn("Error processing imported CSS:",[y])}}}if(!s.href||s.href.startsWith(window.location.origin))try{const r=s.cssRules||s.rules;for(const c of r)if(c instanceof CSSFontFaceRule){const h=c.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();n.add(h)}}catch(r){g.warn("Could not read stylesheet rules:",[r])}}catch(r){g.warn("Error processing stylesheet:",[r])}return g.log("Found fonts:",[{foundry:Array.from(e),custom:o,cssImported:Array.from(n)}]),Array.from(new Set([...e,...o,...n])).filter(s=>!s.includes("FontAwesome")&&!s.includes("Font Awesome")).map(s=>s.replace(/['"`]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(n=>typeof e[n]=="function"&&n!=="constructor"&&n!=="prototype"&&n!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(n=>{const a=e[n];e[n]=function(...i){return console.log(`TEST: Executing: ${e.name}.${n}`),a.apply(this,i)}});const o=Object.getOwnPropertyNames(e.prototype).filter(n=>typeof e.prototype[n]=="function"&&n!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,o),o.forEach(n=>{const a=e.prototype[n];e.prototype[n]=function(...i){return console.log(`TEST: Executing: ${e.name}.${n}`),a.apply(this,i)}})}}R(A,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Je,HandlebarsApplicationMixin:Qe}=foundry.applications.api;var H,x,xe,Oe,Fe;const P=class P extends Qe(Je){static get DEFAULT_OPTIONS(){return{id:p().customFontsMenu.tag,actions:{redefine:M(P,x,Fe)},form:{handler:M(P,x,xe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=p(),o=m.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,a={},i={},s={};return n.forEach(c=>{if(t[c]){const h=m.get(t[c].tag);a[c]=t[c],i[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}}),{...i,default:{...s},fontList:A.getAllFonts(),fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){T(P,H,this.element),f(P,H).querySelectorAll('input[type="text"]').forEach(a=>{const i=a.closest(".dropdown-wrapper"),s=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!s)return;const r=()=>{var c;M(c=P,x,Oe).call(c),s.classList.add("active")};a.addEventListener("focus",r),a.addEventListener("click",r),a.addEventListener("keydown",c=>{const h=s.classList.contains("active"),S=Array.from(s.querySelectorAll(".dropdown-option"));let y=S.findIndex(I=>I.classList.contains("highlighted"));c.key==="ArrowDown"||c.key==="ArrowUp"?(c.preventDefault(),h||s.classList.add("active"),S.forEach(I=>I.classList.remove("highlighted")),y===-1?y=c.key==="ArrowDown"?0:S.length-1:y=c.key==="ArrowDown"?(y+1)%S.length:(y-1+S.length)%S.length,S[y]&&(S[y].classList.add("highlighted"),S[y].scrollIntoView({block:"nearest"}))):c.key==="Enter"?(c.preventDefault(),h&&y!==-1&&S[y]&&S[y].click()):c.key==="Escape"&&s.classList.remove("active")}),document.addEventListener("click",c=>{i.contains(c.target)||s.classList.remove("active")})}),f(P,H).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(s=>s.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",i=>{const s=a.closest(".dropdown-wrapper").querySelector("input");let r=a.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),s.value=r,a.closest(".dropdown-options").classList.remove("active")})})}};H=new WeakMap,x=new WeakSet,xe=async function(e,t,o){const n=p();e.preventDefault(),e.stopPropagation();const a=n.customFontsMenu.fields,i=foundry.utils.expandObject(o.object);a.forEach(s=>{i[s]!==void 0&&(g.log("Saving setting:",[i[s]]),m.set(n[s].tag,i[s]))}),m.set(n.customFontsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oe=function(){f(P,H).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Fe=async function(e,t){const o=p(),a=this.element.querySelectorAll("input[type=text]"),i=o.customFontsMenu.fields,s={};i.forEach(r=>{o[r]&&(o[r],s[r]=o[r].default)}),a.forEach(r=>{r.value=s[r.name]})},b(P,x),b(P,H),R(P,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ce=P;const{ApplicationV2:_e,HandlebarsApplicationMixin:et}=foundry.applications.api;var ee,Be,He;const j=class j extends et(_e){static get DEFAULT_OPTIONS(){return{id:p().leftControlsMenu.tag,actions:{redefine:M(j,ee,He)},form:{handler:M(j,ee,Be),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=p(),o=m.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,a={},i={},s={};n.forEach(c=>{if(t[c]){const h=m.get(t[c].tag);a[c]=t[c],i[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}});const r={...i,default:{...s},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const o=p(),n=m.get(o.leftControlsMenu.tag);g.log("_onRender",[e,t,n])}};ee=new WeakSet,Be=async function(e,t,o){const n=p();e.preventDefault(),e.stopPropagation();const a=n.leftControlsMenu.fields,i=foundry.utils.expandObject(o.object);a.forEach(s=>{i[s]!==void 0&&(g.log("Saving setting:",[i[s]]),m.set(n[s].tag,i[s]))}),await m.set(n.leftControlsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},He=async function(e,t){const o=p(),a=this.element.querySelectorAll("input, select"),i=o.leftControlsMenu.default;a.forEach(s=>{s.value=i[s.name],s.type==="checkbox"&&(s.checked=i[s.name])}),g.log("#onReset",[e,t,o.leftControlsMenu.default])},b(j,ee),R(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Le=j;const{ApplicationV2:tt,HandlebarsApplicationMixin:ot}=foundry.applications.api;var te,qe,$e;const V=class V extends ot(tt){static get DEFAULT_OPTIONS(){return{id:p().sceneNavMenu.tag,actions:{redefine:M(V,te,$e)},form:{handler:M(V,te,qe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=p(),o={...m.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[o,e]),o}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){g.log("_onRender",[e,t])}};te=new WeakSet,qe=async function(e,t,o){const n=p();let a=m.get(n.sceneNavMenu.tag),i=a.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(o.object);await m.set(n.sceneNavMenu.tag,s),a=m.get(n.sceneNavMenu.tag),g.log("Saving settings...",[n.sceneNavMenu.tag,t,o.object,s,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.sceneNavEnabled!=i&&location.reload()},$e=async function(e,t){const o=p(),a=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;a.forEach(s=>{s.value=i[s.name],s.type==="checkbox"&&(s.checked=i[s.name])}),g.log("#onReset",[e,t,o.sceneNavMenu.default])},b(V,te),R(V,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Me=V;function nt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Ce,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:be,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Le,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Ne,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Me,restricted:!1}}}var ne,se,ae,ie,le,ce,re,k,ve,Ee,Re,Te;const l=class l{static init(){const e=p(),t=m.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(E.RENDER_CAMERA_VIEWS,l.onRenderFloating),g.log("CameraUtil",[t]),l.onRenderFloating()):(Hooks.on(E.RENDER_CAMERA_VIEWS,l.onRenderPlain),l.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var a,i,s;const e=p(),t=m.get(e.cameraDockMenu.tag);(a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-ui"),l.cameraContainer=document.querySelector("#camera-views .camera-container");const o=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");g.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),l.cameraContainer&&n&&o&&((i=l.cameraContainer)==null||i.insertBefore(o,n),(s=document.querySelector("#camera-views .camera-container"))==null||s.classList.add("visible")),l.makeDraggable(),l.makeResizeable(),l.resetPositionAndSize(),l.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(g.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const o=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,o)}static makeDraggable(){var e;(e=l.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,i;const o=document.querySelector("body.crlngn-ui");if(g.log("mousedown",[t.target]),(a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",M(l,k,Ee)),o==null||o.addEventListener("mouseup",M(l,k,ve));const n=A.getOffsetBottom(l.cameraContainer);l.isDragging=!0,T(l,ne,t.clientX-((i=l.cameraContainer)==null?void 0:i.offsetLeft)),T(l,se,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(l.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),l.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),l.isResizing=!0,T(l,ae,o.clientX),T(l,ie,o.clientY),T(l,re,parseInt(getComputedStyle(l.cameraContainer).bottom)||0),T(l,le,l.cameraContainer.offsetWidth),T(l,ce,l.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",M(l,k,Re)),e==null||e.addEventListener("mouseup",M(l,k,Te))})}}static resetPositionAndSize({x:e,y:t,w:o,h:n}={x:null,y:null,w:null,h:null}){const a=p(),i=m.get(a.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!l.cameraContainer))if(!e&&!t&&!o&&!n){const s=i.dockPosX||0,r=i.dockPosY||0,c=i.dockWidth||0,h=i.dockHeight||0;l.cameraContainer.style.left=`${s}px`,l.cameraContainer.style.bottom=`${r}px`,l.cameraContainer.style.width=`${c}px`,l.cameraContainer.style.height=`${h}px`}else e&&(l.cameraContainer.style.left=`${e}px`),t&&(l.cameraContainer.style.bottom=`${t}px`),o&&(l.cameraContainer.style.width=`${o}px`),n&&(l.cameraContainer.style.height=`${n}px`)}};ne=new WeakMap,se=new WeakMap,ae=new WeakMap,ie=new WeakMap,le=new WeakMap,ce=new WeakMap,re=new WeakMap,k=new WeakSet,ve=function(e){var n,a;const t=p(),o={...m.get(t.cameraDockMenu.tag)};if(l.isDragging){const i=document.querySelector("body.crlngn-ui");o.dockPosX=parseInt((n=l.cameraContainer)==null?void 0:n.style.left)||0,o.dockPosY=parseInt((a=l.cameraContainer)==null?void 0:a.style.bottom)||0,o.dockPosY<=0&&(o.dockPosY=0),m.set(t.cameraDockMenu.tag,o),i==null||i.removeEventListener("mousemove",M(l,k,Ee)),i==null||i.removeEventListener("mouseup",M(l,k,ve)),l.isDragging=!1,e.stopPropagation()}},Ee=function(e){if(l.isDragging&&(g.log("mousemove",[e.target.parentNode]),l.cameraContainer)){let t=e.clientX-f(l,ne),o=window.innerHeight-e.clientY-f(l,se);t+l.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-l.cameraContainer.offsetWidt),l.cameraContainer.style.left=`${t}px`,o+l.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-l.cameraContainer.offsetHeight),l.cameraContainer.style.bottom=`${o}px`}},Re=function(e){if(!l.isResizing)return;const t=f(l,le)+(e.clientX-f(l,ae)),o=e.clientY-f(l,ie),n=f(l,ce)+o,a=f(l,re)-o;l.cameraContainer.style.width=`${t}px`,l.cameraContainer.style.height=`${n}px`,l.cameraContainer.style.bottom=`${a}px`},Te=function(){var n,a,i,s,r,c;const e=p(),t={...m.get(e.cameraDockMenu.tag)},o=document.querySelector("body.crlngn-ui");l.isResizing=!1,o==null||o.removeEventListener("mousemove",M(l,k,Re)),o==null||o.removeEventListener("mouseup",M(l,k,Te)),g.log("onStopResize",[(n=l.cameraContainer)==null?void 0:n.style.width,(a=l.cameraContainer)==null?void 0:a.style.height,(i=l.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((s=l.cameraContainer)==null?void 0:s.style.width)||0),t.dockHeight=parseInt(((r=l.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((c=l.cameraContainer)==null?void 0:c.style.bottom)||0),m.set(e.cameraDockMenu.tag,t)},b(l,k),b(l,ne,0),b(l,se,0),R(l,"isDragging",!1),R(l,"cameraContainer"),R(l,"isResizing",!1),b(l,ae,0),b(l,ie,0),b(l,le,0),b(l,ce,0),b(l,re,0);let B=l;const D=class D{static init(){const e=p();D.enableChatStyles=m.get(e.enableChatStyles.tag),D.chatBorderColor=m.get(e.chatBorderColor.tag)}static enrichCard(e,t){var o,n,a,i,s,r,c,h;if(D.enableChatStyles){const S=((a=(n=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:n.activity)==null?void 0:a.type)||((r=(s=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:s.roll)==null?void 0:r.type)||"custom";let y=t.get?t.get(0):t;y.classList.add(S),g.log("enrichCard",[D.chatBorderColor,Z.playerColor.name,(c=e.author)==null?void 0:c.id]),D.chatBorderColor===Z.playerColor.name&&((h=e.author)!=null&&h.id)&&y.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}}};R(D,"chatBorderColor"),R(D,"enableChatStyles");let J=D;var G,z,q,X,K,ke,me,ye;const u=class u{static init(){const e=p();u.navSettings=m.get(e.sceneNavMenu.tag),u.isCollapsed=m.get(e.sceneNavCollapsed.tag),u.navPos=m.get(e.sceneNavPos.tag);const t=document.querySelector("#ui-middle");let o=u.navSettings;if(o.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}u.resetLocalVars();const n=A.isModuleOn("monks-scene-navigation");n&&o.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),m.set(e.sceneNavMenu.tag,{...o,sceneNavEnabled:!1})),g.log("TopNavigation - init",[n]),n?t.classList.add("with-monks-scene"):(u.resetLocalVars(),u.addListeners(),g.log(E.RENDER_SCENE_NAV,[]),u.setNavPosition(0),u.placeNavButtons()),Hooks.on(E.RENDER_SCENE_NAV,()=>{p();const a=A.isModuleOn("monks-scene-navigation");g.log(E.RENDER_SCENE_NAV,[a]),a||(u.resetLocalVars(),g.log(E.RENDER_SCENE_NAV,[]),u.placeNavButtons(),u.setNavPosition(),u.addListeners())}),Hooks.on(E.COLLAPSE_SIDE_BAR,a=>{const i=A.isModuleOn("monks-scene-navigation");g.log(E.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",i]),i||u.placeNavButtons()}),Hooks.on(E.COLLAPSE_SCENE_NAV,(a,i)=>{const s=p();m.set(s.sceneNavCollapsed.tag,i),g.log("NAV toggle",[a,i]);const r=document.querySelector("#ui-middle");i?r.classList.add("navigation-collapsed"):r.classList.remove("navigation-collapsed")}),Hooks.on(E.EXPAND_SCENE_NAV,(a,i)=>{g.log("NAV expand",[a,!1])}),window.addEventListener("resize",()=>{A.isModuleOn("monks-scene-navigation")||u.placeNavButtons()}),g.log("TopNavigation - init",[o.sceneNavEnabled])}static resetLocalVars(){T(u,G,document.querySelector("#navigation")),T(u,z,document.querySelector("#scene-list")),T(u,X,document.querySelector("#navigation .nav-item.is-root")),T(u,K,document.querySelector("#nav-toggle"))}static addListeners(){var e,t;(e=f(u,G))==null||e.addEventListener("mouseenter",()=>{var a;if(g.log("TopNavigation mouseenter",[]),!u.isCollapsed||!((a=u.navSettings)!=null&&a.showNavOnHover))return;clearTimeout(f(this,q));const o=document.querySelector("#scene-list");o&&(o.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=f(this,G))==null||t.addEventListener("mouseleave",n=>{var a;if(g.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!((a=u.navSettings)!=null&&a.showNavOnHover))){if(!n)var n=window.event;n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),T(this,q,setTimeout(()=>{clearTimeout(f(this,q)),T(this,q,null);const i=document.querySelector("#scene-list");i&&(i.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var s,r,c,h,S,y,I;u.resetLocalVars();const e=(s=f(this,G))==null?void 0:s.querySelectorAll("button.crlngn-nav"),t=((r=f(this,z))==null?void 0:r.scrollWidth)>=((c=f(this,G))==null?void 0:c.offsetWidth);if(g.log("placeNavButtons",[t,e,(h=f(this,z))==null?void 0:h.scrollWidth,(S=f(this,G))==null?void 0:S.offsetWidth]),!t||e.length>0)return;const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-chevron-left"),o.addEventListener("click",f(this,me)),o.append(n);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),a.append(i),a.addEventListener("click",f(this,ye)),(y=f(this,G))==null||y.appendChild(o),(I=f(this,G))==null||I.appendChild(a)}static setNavPosition(e){var i,s;const t=p();if(!f(this,z))return;const o=e!==void 0?e:u.navPos||0,n=((i=f(this,z))==null?void 0:i.querySelectorAll("li.nav-item"))||[],a=((s=n[o])==null?void 0:s.offsetLeft)*-1;f(this,z).style.marginLeft=a+"px",m.set(t.sceneNavPos.tag,o),g.log("setNavPosition",[e,o,n[o],a])}};G=new WeakMap,z=new WeakMap,q=new WeakMap,X=new WeakMap,K=new WeakMap,ke=new WeakMap,me=new WeakMap,ye=new WeakMap,b(u,G),b(u,z),b(u,q),b(u,X),b(u,K),b(u,ke),R(u,"SETTINGS"),R(u,"navSettings"),R(u,"isCollapsed"),R(u,"navPos"),b(u,me,e=>{var h,S,y,I,w;const t=(h=f(u,K))==null?void 0:h.offsetWidth,o=A.isModuleOn("compact-scene-navigation")?(S=f(u,X))==null?void 0:S.offsetWidth:0,n=(y=f(u,z))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),a=((I=f(u,z))==null?void 0:I.querySelectorAll("li.nav-item"))||[],i=n.offsetWidth,s=u.navPos||0,r=Math.floor((((w=f(u,G))==null?void 0:w.offsetWidth)-(s===0?o:0)-t*2)/i);g.log("onNavLast",["currPos",s,r]);let c=s-r;c=c<0?0:c,g.log("onNavLast",["sceneCount",a.length,s,c]),u.setNavPosition(c)}),b(u,ye,e=>{var h,S,y,I,w;p();const t=(h=f(u,K))==null?void 0:h.offsetWidth,o=A.isModuleOn("compact-scene-navigation")?(S=f(u,X))==null?void 0:S.offsetWidth:0,n=(y=f(u,z))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),a=((I=f(u,z))==null?void 0:I.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=n.offsetWidth,s=u.navPos||0,r=Math.floor((((w=f(u,G))==null?void 0:w.offsetWidth)-(s===0?o:0)-t*2)/i);g.log("onNavLast",["currPos",s,r]);let c=s+r;c=c>a.length?a.length:c,u.setNavPosition(c)});let Y=u;const d=class d{static registerSettings(){const e=p();g.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(O),Object.entries(e).forEach(async i=>{const s=i[1];g.log("Registering... ",[i],!0);const r={name:s.label,hint:s.hint,default:s.default,type:s.propType,scope:s.scope,config:s.config,requiresReload:s.requiresReload||!1,onChange:c=>d.apply(s.tag,c)};s.choices&&(r.choices=s.choices),await game.settings.register(O,s.tag,r),d.get(s.tag)===void 0&&d.set(s.tag,s.default)}),Object.entries(nt()).forEach(async i=>{const s=i[1],r={name:s.tag,label:s.label,hint:s.hint,icon:s.icon,type:s.propType,restricted:s.restricted};await game.settings.registerMenu(O,s.tag,r)}),Hooks.on(E.RENDER_SCENE_CONTROLS,d.applyLeftControlsSettings),Hooks.on(E.RENDER_PLAYERS_LIST,d.applyPlayersListSettings),Hooks.on(E.RENDER_HOTBAR,()=>{d.firstLoad&&(d.firstLoad=!1,d.applyHotBarCollapse()),d.applyHotBarSettings()}),d.applyDebugSettings(),d.applySceneNavPos(),d.applyChatStyles(),d.applyBorderColors(),e.customFontsMenu.fields.forEach(i=>{d.applyCustomFonts(e[i].tag)}),e.leftControlsMenu.fields.forEach(i=>{d.applyLeftControlsSettings(e[i].tag)})}static get(e,t=O){if(!e)return null;let o=!1;if(t===O)o=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),o=a==null?void 0:a.value,g.log("GET Setting",[a,o])}return o}static set(e,t,o=O){if(!e)return!1;let n=game.settings.storage.get("client")[`${o}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${o}.${e}`)),g.log("Setting",[e,n]);try{game.settings.set(o,e,t)}catch{g.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const o=p();switch(t===void 0&&(t=d.get(e)),g.log("SettingsUtil.apply",[e,t,d.get(e)]),e){case o.enableMacroLayout.tag:d.applyHotBarSettings();break;case o.collapseMacroBar.tag:d.applyHotBarCollapse();break;case o.autoHidePlayerList.tag:d.applyPlayersListSettings();break;case o.uiFontBody.tag:case o.uiFontTitles.tag:case o.journalFontBody.tag:case o.journalFontTitles.tag:d.applyCustomFonts(e,t);break;case o.controlsBottomBuffer.tag:case o.controlsIconSize.tag:case o.controlsAutoHide.tag:case o.hideFoundryLogo.tag:d.applyLeftControlsSettings(e,t);break;case o.cameraDockMenu.tag:d.applyCameraPosX(),d.applyCameraPosY(),d.applyCameraWidth(),d.applyCameraHeight();break;case o.chatBorderColor.tag:J.chatBorderColor=d.get(o.chatBorderColor.tag),g.log("SettingsUtil.apply",[e]),d.applyBorderColors();break;case o.enableChatStyles.tag:J.enableChatStyles=d.get(o.enableChatStyles.tag),g.log("SettingsUtil.apply",[e]),d.applyChatStyles();break;case o.debugMode.tag:d.applyDebugSettings();break;case o.sceneNavMenu.tag:Y.navSettings=d.get(o.sceneNavMenu.tag);break;case o.sceneNavCollapsed.tag:Y.isCollapsed=d.get(o.sceneNavCollapsed.tag);break}}static applyBorderColors(){const e=p(),t=d.get(e.chatBorderColor.tag),o=document.querySelector("body");t===Z.playerColor.name?(o.classList.add("player-chat-borders"),o.classList.remove("roll-chat-borders")):t===Z.rollType.name?(o.classList.add("roll-chat-borders"),o.classList.remove("player-chat-borders")):(o.classList.remove("player-chat-borders"),o.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=p(),t=d.get(e.enableChatStyles.tag),o=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?o.classList.add("crlngn-chat"):o.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=p(),t=d.get(e.enableMacroLayout.tag),o=document.querySelector("#hotbar");!t&&o?o.classList.add("foundry-default"):o&&o.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=p();d.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const o=p(),n=d.get(o.sceneNavMenu.tag),a=document.querySelector("#ui-left"),i=document.querySelector("#ui-left #logo"),s=document.querySelector("body.crlngn-ui");switch(g.log("applyLeftControlsSettings",[e]),e){case o.controlsAutoHide.tag:d.get(o.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break;case o.hideFoundryLogo.tag:const r=window.getComputedStyle(s),c=parseFloat(r.getPropertyValue("--top-nav-height")),h=d.get(o.hideFoundryLogo.tag);g.log("applyLeftControlsSettings",[e,c]),h===void 0||h===!0?(i.classList.remove("visible"),s.style.setProperty("--ui-top-padding",`${c}px`),document.querySelector("body").classList.remove("logo-visible")):(i.classList.add("visible"),n.sceneNavEnabled?(s.style.setProperty("--ui-top-padding",`${72+c}px`),document.querySelector("body").classList.add("logo-visible")):s.style.setProperty("--ui-top-padding","72px"));break;case o.controlsBottomBuffer.tag:d.applyControlsBuffer();break;case o.controlsIconSize.tag:d.applyControlIconSize();break}}static applyControlIconSize(){const e=p(),t=d.get(e.controlsIconSize.tag),o=document.querySelector("body"),n=t==oe.small.name?oe.small.size:oe.regular.size;g.log("applyControlIconSize",[n]),o.style.setProperty("--left-control-item-size",n),d.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=p(),t=d.get(e.leftControlsMenu.tag),o=document.querySelector("body.crlngn-ui"),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;o.style.setProperty("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,o;const e=p();g.log("applyPlayersListSettings",[document.querySelector("#players"),d.get(e.autoHidePlayerList.tag)]),d.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(o=document.querySelector("#players"))==null||o.classList.remove("auto-hide"),pe.checkPlayersList()}static applySceneNavPos(){const e=p();d.set(e.sceneNavPos.tag,0),Y.navPos=0}static applyCameraPosX(e){const t=p(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockPosX;B.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=p(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockPosY;B.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=p(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockWidth;B.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=p(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockHeight;B.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const o=p(),n=o.customFontsMenu.fields,a={};g.log("applyCustomFonts",[e,t]),n.forEach(s=>{a[s]=d.get(o[s].tag)});const i=document.querySelector("body.crlngn-ui");switch(e){case o.uiFontBody.tag:i.style.setProperty("--crlngn-font-family",t||a.uiFontBody||o.uiFontBody.default.uiFont||"");break;case o.uiFontTitles.tag:i.style.setProperty("--crlngn-font-titles",t||a.uiFontTitles||o.uiFontTitles.default.uiTitles||"");break;case o.journalFontBody.tag:i.style.setProperty("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case o.journalFontTitles:i.style.setProperty("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=p();g.debugOn=e||d.get(t.debugMode.tag)}};R(d,"firstLoad",!0);let m=d;class Ge{static init(){Hooks.on(E.RENDER_PLAYERS_LIST,Ge.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),o=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",o+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var U,ge,de;const v=class v{static init(){g.log("LeftControls - init",[]),Hooks.on(E.RENDER_SCENE_CONTROLS,v.initSceneControls),v.initSceneControls()}static resetLocalVars(){T(v,U,document.querySelector("#ui-left #controls")),T(v,ge,document.querySelector("#ui-left"))}static initSceneControls(){g.log("initSceneControls",[]),v.resetLocalVars(),v.observeControlsWidth()}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!f(v,U))return;let e;const t=(o,n)=>{e||(e=setTimeout(()=>{o(),e=null},n))};T(v,de,new ResizeObserver(o=>{t(()=>v.updateCSSVars(),250)},{box:"border-box"})),f(v,de).observe(f(v,U)),v.updateCSSVars()}static updateCSSVars(){if(!f(v,U))return;let e=Number(f(v,ge).offsetWidth),t=Number(f(v,U).offsetWidth),o=-e+t+24;if(g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const n=document.querySelector("body.crlngn-ui");n==null||n.style.setProperty("--ui-controls-margin-left",o+"px")}}};U=new WeakMap,ge=new WeakMap,de=new WeakMap,b(v,U),b(v,ge),b(v,de);let Ie=v;class st{static init(){const e=A.isModuleOn("foundry-taskbar"),t=document.querySelector("body.crlngn-ui");e&&game.settings.get("foundry-taskbar","reduceSidebar")?t.style.setProperty("--crlngn-sidebar-bottom","50px"):t.style.setProperty("--crlngn-sidebar-bottom","0px")}}var he;const F=class F{static init(){Hooks.once(E.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(O),g.log("Initiating module...",[],!0),Hooks.on(E.RENDER_CHAT_MESSAGE,f(F,he)),Hooks.on(E.RENDER_PLAYERS_LIST,F.checkPlayersList),m.registerSettings()}),Hooks.once(E.READY,()=>{g.log("Core Ready",[]);const e=p();var t=m.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Y.init(),B.init(),Ge.init(),Ie.init(),J.init(),st.init(),m.get(e.enableChatStyles.tag)&&F.addCSSLocalization()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}};he=new WeakMap,b(F,he,(e,t)=>{g.log(E.RENDER_CHAT_MESSAGE,[e,t]),J.enrichCard(e,t)}),R(F,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#ui-left #players"),n=A.isModuleOn("foundry-taskbar")?game.settings.get("foundry-taskbar","dockPlayersList"):!1;e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players"),e.classList.remove("players-hidden")):n?(e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"),e.classList.remove("players-hidden"))});let pe=F;pe.init();
//# sourceMappingURL=crlngn-ui.js.map
