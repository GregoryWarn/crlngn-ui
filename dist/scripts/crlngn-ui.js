var Ft=Object.defineProperty;var ht=w=>{throw TypeError(w)};var Pt=(w,e,t)=>e in w?Ft(w,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):w[e]=t;var L=(w,e,t)=>Pt(w,typeof e!="symbol"?e+"":e,t),et=(w,e,t)=>e.has(w)||ht("Cannot "+t);var d=(w,e,t)=>(et(w,e,"read from private field"),t?t.call(w):e.get(w)),N=(w,e,t)=>e.has(w)?ht("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(w):e.set(w,t),E=(w,e,t,s)=>(et(w,e,"write to private field"),s?s.call(w,t):e.set(w,t),t),F=(w,e,t)=>(et(w,e,"access private method"),t);const R={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},W="crlngn-ui",We=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Xe=class Xe{static log(e="",t=[],s=!1){try{const n=Xe.debugOn;if(!(s||n))return;console.log(...We,e,...t)}catch{console.log(...We,e,...t)}}static warn(e="",t=[]){console.warn(...We,e,...t)}static error(e,t){var s;t.ui&&((s=ui.notifications)==null||s.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...We,e)}};L(Xe,"debugOn",!1);let g=Xe;const M={select:"select",checkbox:"checkbox",text:"text",number:"number"},k={client:"client",world:"world"},Me={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},Ne={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},K=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function C(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:M.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:k.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:k.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:M.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:Ne.playerColor.name},scope:k.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:M.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:Me.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:k.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:M.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:M.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:M.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:M.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:M.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:M.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:k.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:M.button,fields:["sceneNavEnabled","navFoldersEnabled","showFolderListOnClick","navStartCollapsed","showNavOnHover"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navStartCollapsed:!1,showFolderListOnClick:!1,showNavOnHover:!1},scope:k.client,config:!1,requiresReload:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:k.client,config:!1},navStartCollapsed:{tag:"nav-compasst-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:k.client,config:!1},showFolderListOnClick:{tag:"nav-folders-list-on-click",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:k.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:k.client,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:M.number,default:0,scope:k.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:M.checkbox,default:!1,scope:k.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:k.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:k.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:M.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:k.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:M.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:k.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:M.text,propType:String,default:"",scope:k.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:k.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:M.text,propType:String,default:"",scope:k.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:M.text,default:Ne.playerColor.name,scope:k.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:M.checkbox,default:!0,scope:k.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:M.number,default:200,scope:k.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:M.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:Me.small.name,scope:k.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:M.checkbox,propType:Boolean,default:!1,scope:k.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:M.checkbox,propType:Boolean,default:!0,scope:k.client,config:!1},lastUpdateId:{tag:"last-update-id",label:"",hint:"",propType:String,scope:k.world,config:!1,default:""}}}const{ApplicationV2:Dt,HandlebarsApplicationMixin:At}=foundry.applications.api;var ve,yt,St;const ce=class ce extends At(Dt){static get DEFAULT_OPTIONS(){return{id:C().cameraDockMenu.tag,actions:{redefine:F(ce,ve,St)},form:{handler:F(ce,ve,yt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=C(),s={...S.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return g.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){g.log("_onRender",[e,t])}};ve=new WeakSet,yt=async function(e,t,s){const n=C();let o=S.get(n.cameraDockMenu.tag),a=o.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=s.object;i.hasOwnProperty("enableFloatingDock")||(i.enableFloatingDock=!1);const r=foundry.utils.expandObject(i);await S.set(n.cameraDockMenu.tag,r),o=S.get(n.cameraDockMenu.tag),g.log("Saving settings:",[n.cameraDockMenu.tag,t,s.object,r,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.enableFloatingDock!=a&&location.reload()},St=async function(e,t){const s=C(),o=this.element.querySelectorAll("input, select"),a=s.cameraDockMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),g.log("#onReset",[e,t,s.cameraDockMenu.default])},N(ce,ve),L(ce,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let tt=ce;const{ApplicationV2:zt,HandlebarsApplicationMixin:Ot}=foundry.applications.api;var Ee,bt,Ct;const de=class de extends Ot(zt){static get DEFAULT_OPTIONS(){return{id:C().chatMessagesMenu.tag,actions:{redefine:F(de,Ee,Ct)},form:{handler:F(de,Ee,bt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var c;const t=C(),s=S.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,o={},a={},i={};n.forEach(f=>{if(g.log("_prepareContext",[t[f].oldName]),t[f]){const b=S.get(t[f].tag);o[f]=t[f],a[f]=b!==void 0?b:s[t[f].oldName]||t[f].default,i[f]=t[f].default}}),g.log("_prepareContext",[a,i]);const r={...a,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=C(),n=S.get(s.chatMessagesMenu.tag);g.log("_onRender",[e,t,n])}};Ee=new WeakSet,bt=async function(e,t,s){const n=C();e.preventDefault(),e.stopPropagation();const o=n.chatMessagesMenu.fields,a=s.object;o.forEach(f=>{n[f].inputType==="checkbox"&&!a.hasOwnProperty(f)&&(a[f]=!1)});const i=foundry.utils.expandObject(a),r=S.get(n.chatBorderColor.tag);g.log("Compared settings:",[i.chatBorderColor,r]),o.forEach(f=>{g.log("Saving setting >>",[n[f].tag,i[f]]),i[f]!==void 0&&S.set(n[f].tag,i[f])}),await S.set(n.chatMessagesMenu.tag,i),i.chatBorderColor!==r&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ct=async function(e,t){const s=C(),o=this.element.querySelectorAll("input, select"),a=s.chatMessagesMenu.fields,i={};a.forEach(r=>{s[r]&&(s[r],i[r]=s[r].default)}),o.forEach(r=>{r.value=i[r.name]})},N(de,Ee),L(de,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let st=de;class T{static isModuleOn(e){var s;const t=(s=game.modules)==null?void 0:s.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},s=Object.entries(t).map(([a])=>a),n=await this.processStyleSheets();return g.log("Found fonts:",[{foundry:Array.from(e),custom:s,cssImported:Array.from(n)}]),Array.from(new Set([...e,...s,...n])).filter(a=>!/FontAwesome|Font Awesome|FoundryVTT/.test(a)).map(a=>a.replace(/['"]/g,"").trim()).sort((a,i)=>a.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let s=document.querySelector("#crlngn-ui-vars");if(!s){const y=document.querySelector("body");s=document.createElement("style"),s.id="crlngn-ui-vars",s.textContent=`body.crlngn-ui {
}
`,y.prepend(s)}let n=s.textContent,o=n.indexOf("body.crlngn-ui {"),a=n.indexOf("}",o);o===-1&&(n=`body.crlngn-ui {
}
`,o=0,a=n.indexOf("}"));const r=n.substring(o+16,a).split(";").map(y=>y.trim()).filter(y=>y!==""),c={};r.forEach(y=>{const v=y.split(":");if(v.length>=2){const h=v[0].trim(),I=v.slice(1).join(":").trim();h&&(c[h]=I)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const f=Object.entries(c).map(([y,v])=>`  ${y}: ${v};`).join(`
`),b=n.substring(0,o)+`body.crlngn-ui {
`+f+`
}`+n.substring(a+1);s.textContent=b}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const s=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,s.appendChild(t)}t.textContent=e}}L(T,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([s])=>s);const t=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const n=s.href||"",o=n.includes("/css/")||n.includes("/styles/"),a=n.includes("/modules/crlngn-ui/");if(n&&!o&&!a){g.log("Skipping non-core/module stylesheet:",[n]);continue}let i="";if(s.ownerNode instanceof Element){if(s.ownerNode.tagName==="STYLE")i=s.ownerNode.textContent;else if(s.ownerNode.tagName==="LINK")try{const f=s.cssRules||s.rules;i=Array.from(f).map(b=>b.cssText).join(`
`)}catch(f){g.warn("Could not read stylesheet rules:",[f])}}g.log("Processing stylesheet:",[n||"inline style"]);const r=/@import\s+url\(['"]([^'"]+)['"]\)/g;let c;for(;(c=r.exec(i))!==null;){let f=c[1];if(f.includes("fonts.googleapis.com")){const b=f.match(/family=([^&]+)/);b&&decodeURIComponent(b[1]).split("|").map(v=>v.split(":")[0].replace(/\+/g," ")).forEach(v=>{t.add(v)})}else{if(f.startsWith("./")||f.startsWith("../")){g.log("Skipping relative import:",[f]);continue}let b=f;try{const y=await fetch(b);if(!y.ok){g.warn("Error loading imported CSS:",[y.status]);continue}const h=(await y.text()).match(/@font-face\s*{[^}]+}/g);if(!h)continue;h.forEach(I=>{const G=I.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(G&&G[1]){const V=G[1].trim();t.add(V)}})}catch(y){g.warn("Error processing imported CSS:",[y])}}}}if(!s.href||s.href.startsWith(window.location.origin))try{const n=s.cssRules||s.rules;for(const o of n)if(o instanceof CSSFontFaceRule){const a=o.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(a)}}catch(n){g.warn("Could not read stylesheet rules:",[n])}}catch(n){g.warn("Error processing stylesheet:",[n])}return t}),L(T,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Ut,HandlebarsApplicationMixin:xt}=foundry.applications.api;var te,Q,Nt,Lt,vt;const H=class H extends xt(Ut){static get DEFAULT_OPTIONS(){return{id:C().customFontsMenu.tag,actions:{redefine:F(H,Q,vt)},form:{handler:F(H,Q,Nt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=C(),s=S.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,o={},a={},i={};return n.forEach(c=>{if(t[c]){const f=S.get(t[c].tag);o[c]=t[c],a[c]=f!==void 0?f:s[t[c].oldName]||t[c].default,i[c]=t[c].default}}),{...a,default:{...i},fontList:await T.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){E(H,te,this.element),d(H,te).querySelectorAll('input[type="text"]').forEach(o=>{const a=o.closest(".dropdown-wrapper"),i=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!i)return;const r=()=>{var c;F(c=H,Q,Lt).call(c),i.classList.add("active")};o.addEventListener("focus",r),o.addEventListener("click",r),o.addEventListener("keydown",c=>{const f=i.classList.contains("active"),b=Array.from(i.querySelectorAll(".dropdown-option"));let y=b.findIndex(v=>v.classList.contains("highlighted"));c.key==="ArrowDown"||c.key==="ArrowUp"?(c.preventDefault(),f||i.classList.add("active"),b.forEach(v=>v.classList.remove("highlighted")),y===-1?y=c.key==="ArrowDown"?0:b.length-1:y=c.key==="ArrowDown"?(y+1)%b.length:(y-1+b.length)%b.length,b[y]&&(b[y].classList.add("highlighted"),b[y].scrollIntoView({block:"nearest"}))):c.key==="Enter"?(c.preventDefault(),f&&y!==-1&&b[y]&&b[y].click()):c.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",c=>{a.contains(c.target)||i.classList.remove("active")})}),d(H,te).querySelectorAll(".dropdown-option").forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",a=>{const i=o.closest(".dropdown-wrapper").querySelector("input");let r=o.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),i.value=r,o.closest(".dropdown-options").classList.remove("active")})})}};te=new WeakMap,Q=new WeakSet,Nt=async function(e,t,s){const n=C();e.preventDefault(),e.stopPropagation();const o=n.customFontsMenu.fields,a=foundry.utils.expandObject(s.object);o.forEach(i=>{a[i]!==void 0&&(g.log("Saving setting:",[a[i]]),S.set(n[i].tag,a[i]))}),S.set(n.customFontsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Lt=function(){d(H,te).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},vt=async function(e,t){const s=C(),o=this.element.querySelectorAll("input[type=text]"),a=s.customFontsMenu.fields,i={};a.forEach(r=>{s[r]&&(s[r],i[r]=s[r].default)}),o.forEach(r=>{r.value=i[r.name]})},N(H,Q),N(H,te),L(H,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let nt=H;const{ApplicationV2:Ht,HandlebarsApplicationMixin:qt}=foundry.applications.api;var Te,Et,Tt;const ue=class ue extends qt(Ht){static get DEFAULT_OPTIONS(){return{id:C().leftControlsMenu.tag,actions:{redefine:F(ue,Te,Tt)},form:{handler:F(ue,Te,Et),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=C(),s=S.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,o={},a={},i={};n.forEach(c=>{if(t[c]){const f=S.get(t[c].tag);o[c]=t[c],a[c]=f!==void 0?f:s[t[c].oldName]||t[c].default,i[c]=t[c].default}});const r={...a,default:{...i},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=C(),n=S.get(s.leftControlsMenu.tag);g.log("_onRender",[e,t,n])}};Te=new WeakSet,Et=async function(e,t,s){const n=C();e.preventDefault(),e.stopPropagation();const o=n.leftControlsMenu.fields,a=foundry.utils.expandObject(s.object);o.forEach(i=>{a[i]!==void 0&&(g.log("Saving setting:",[a[i]]),S.set(n[i].tag,a[i]))}),await S.set(n.leftControlsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Tt=async function(e,t){const s=C(),o=this.element.querySelectorAll("input, select"),a=s.leftControlsMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),g.log("#onReset",[e,t,s.leftControlsMenu.default])},N(ue,Te),L(ue,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ot=ue;const{ApplicationV2:Bt,HandlebarsApplicationMixin:Vt}=foundry.applications.api;var Ie,It,Mt;const ge=class ge extends Vt(Bt){static get DEFAULT_OPTIONS(){return{id:C().sceneNavMenu.tag,actions:{redefine:F(ge,Ie,Mt)},form:{handler:F(ge,Ie,It),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=C(),s=S.get(t.sceneNavMenu.tag),n=t.sceneNavMenu.fields,o={},a={},i={};n.forEach(c=>{if(t[c]){const f=S.get(t[c].tag);o[c]=t[c],a[c]=f!==void 0?f:s[t[c].oldName]||t[c].default,i[c]=t[c].default}});const r={...a,default:{...i},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return g.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,g.log("_preparePartContext",[e,t]),t}_onRender(e,t){g.log("_onRender",[e,t])}};Ie=new WeakSet,It=async function(e,t,s){e.preventDefault(),e.stopPropagation();const n=C(),o=n.sceneNavMenu.fields;let a=S.get(n.sceneNavEnabled.tag),i=S.get(n.navFoldersEnabled.tag);const r=foundry.utils.expandObject(s.object);o.forEach(b=>{r[b]!==void 0&&(g.log("Saving setting:",[r[b]]),S.set(n[b].tag,r[b]))});let c=S.get(n.sceneNavEnabled.tag),f=S.get(n.navFoldersEnabled.tag);g.log("Saving settings...",[a,c]),await S.set(n.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(a!==c||i!==f)&&location.reload()},Mt=async function(e,t){const s=C(),o=this.element.querySelectorAll("input, select"),a=s.sceneNavMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),g.log("#onReset",[e,t,s.sceneNavMenu.default])},N(ge,Ie),L(ge,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let at=ge;const{ApplicationV2:$t,HandlebarsApplicationMixin:jt}=foundry.applications.api;var se,_,kt,Rt,wt;const q=class q extends jt($t){static get DEFAULT_OPTIONS(){return{id:C().themeAndStylesMenu.tag,actions:{redefine:F(q,_,wt)},form:{handler:F(q,_,kt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=C();S.get(t.themeAndStylesMenu.tag);const s=t.themeAndStylesMenu.fields,n={},o={},a={};s.forEach(c=>{if(t[c]){const f=S.get(t[c].tag);n[c]=t[c],o[c]=f!==void 0?f:t[c].default,a[c]=t[c].default}});const i=K.find(c=>c.className===o.colorTheme);o.colorTheme=(i==null?void 0:i.label)||K[0].label;const r={...o,default:{...a},fields:{...n},selectedTheme:i,themes:K,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...o},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){E(q,se,this.element),this._themes=K,d(q,se).querySelectorAll('input[type="text"]').forEach(a=>{const i=a.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const c=()=>{var f;F(f=q,_,Rt).call(f),r.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",f=>{const b=r.classList.contains("active"),y=Array.from(r.querySelectorAll(".dropdown-option"));let v=y.findIndex(h=>h.classList.contains("highlighted"));f.key==="ArrowDown"||f.key==="ArrowUp"?(f.preventDefault(),b||r.classList.add("active"),y.forEach(h=>h.classList.remove("highlighted")),v===-1?v=f.key==="ArrowDown"?0:y.length-1:v=f.key==="ArrowDown"?(v+1)%y.length:(v-1+y.length)%y.length,y[v]&&(y[v].classList.add("highlighted"),y[v].scrollIntoView({block:"nearest"}))):f.key==="Enter"?(f.preventDefault(),b&&v!==-1&&y[v]&&y[v].click()):f.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",f=>{i.contains(f.target)||r.classList.remove("active")})});const n=d(q,se).querySelectorAll(".dropdown-option"),o=this;n.forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",function(i){g.log("option",[a,a.querySelector(".theme-name")]);const r=a.closest(".dropdown-wrapper").querySelector("input");let c=a.querySelector(".theme-name").innerHTML.toString();if(r.value=c,r.name==="colorTheme"){const b=o._themes.find(y=>y.label===c);o._selectedTheme=b,o._updateThemePreview(b)}a.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(g.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((s,n)=>{s.style.setProperty("background-color",e.colorPreview[n])})}};se=new WeakMap,_=new WeakSet,kt=async function(e,t,s){const n=C();e.preventDefault(),e.stopPropagation();const o=n.themeAndStylesMenu.fields,a=foundry.utils.expandObject(s.object),i=K.find(r=>r.label===a.colorTheme);a.colorTheme=i?i.className:"",o.forEach(r=>{a[r]!==void 0&&(g.log("Saving setting:",[a[r]]),S.set(n[r].tag,a[r]))}),S.set(n.themeAndStylesMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Rt=function(){d(q,se).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},wt=async function(e,t){const s=C(),o=this.element.querySelectorAll("input[type=text]"),a=s.themeAndStylesMenu.fields,i={};a.forEach(c=>{s[c]&&(s[c],i[c]=s[c].default)});const r=K.find(c=>c.label===s.colorTheme.default);i.colorTheme=(r==null?void 0:r.label)||K[0].label,o.forEach(c=>{c.value=i[c.name]})},N(q,_),N(q,se),L(q,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let it=q;function Wt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:nt,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:it,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:st,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:ot,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:tt,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:at,restricted:!1}}}var Re,we,Ge,Fe,Pe,De,Ae,O,lt,rt,ct,dt;const p=class p{static init(){const e=C(),t=S.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(R.RENDER_CAMERA_VIEWS,p.onRenderFloating),g.log("CameraUtil",[t]),p.onRenderFloating()):(Hooks.on(R.RENDER_CAMERA_VIEWS,p.onRenderPlain),p.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,a,i;const e=C(),t=S.get(e.cameraDockMenu.tag);(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),p.cameraContainer=document.querySelector("#camera-views .camera-container");const s=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");g.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),p.cameraContainer&&n&&s&&((a=p.cameraContainer)==null||a.insertBefore(s,n),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),p.makeDraggable(),p.makeResizeable(),p.resetPositionAndSize(),p.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(g.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const s=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,s)}static makeDraggable(){var e;(e=p.cameraContainer)==null||e.addEventListener("mousedown",t=>{var o,a;const s=document.querySelector("body.crlngn-ui");if((o=t.target.parentNode)!=null&&o.classList.contains("volume-bar"))return;s==null||s.addEventListener("mousemove",F(p,O,rt)),s==null||s.addEventListener("mouseup",F(p,O,lt));const n=T.getOffsetBottom(p.cameraContainer);p.isDragging=!0,E(p,Re,t.clientX-((a=p.cameraContainer)==null?void 0:a.offsetLeft)),E(p,we,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(p.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),p.cameraContainer.append(t),t.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),p.isResizing=!0,E(p,Ge,s.clientX),E(p,Fe,s.clientY),E(p,Ae,parseInt(getComputedStyle(p.cameraContainer).bottom)||0),E(p,Pe,p.cameraContainer.offsetWidth),E(p,De,p.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",F(p,O,ct)),e==null||e.addEventListener("mouseup",F(p,O,dt))})}}static resetPositionAndSize({x:e,y:t,w:s,h:n}={x:null,y:null,w:null,h:null}){const o=C(),a=S.get(o.cameraDockMenu.tag);if(!(!a.enableFloatingDock||!p.cameraContainer))if(!e&&!t&&!s&&!n){const i=a.dockPosX||0,r=a.dockPosY||0,c=a.dockWidth||0,f=a.dockHeight||0;p.cameraContainer.style.left=`${i}px`,p.cameraContainer.style.bottom=`${r}px`,p.cameraContainer.style.width=`${c}px`,p.cameraContainer.style.height=`${f}px`}else e&&(p.cameraContainer.style.left=`${e}px`),t&&(p.cameraContainer.style.bottom=`${t}px`),s&&(p.cameraContainer.style.width=`${s}px`),n&&(p.cameraContainer.style.height=`${n}px`)}};Re=new WeakMap,we=new WeakMap,Ge=new WeakMap,Fe=new WeakMap,Pe=new WeakMap,De=new WeakMap,Ae=new WeakMap,O=new WeakSet,lt=function(e){var n,o;const t=C(),s={...S.get(t.cameraDockMenu.tag)};if(p.isDragging){const a=document.querySelector("body.crlngn-ui");s.dockPosX=parseInt((n=p.cameraContainer)==null?void 0:n.style.left)||0,s.dockPosY=parseInt((o=p.cameraContainer)==null?void 0:o.style.bottom)||0,s.dockPosY<=0&&(s.dockPosY=0),S.set(t.cameraDockMenu.tag,s),a==null||a.removeEventListener("mousemove",F(p,O,rt)),a==null||a.removeEventListener("mouseup",F(p,O,lt)),p.isDragging=!1,e.stopPropagation()}},rt=function(e){if(p.isDragging&&(g.log("mousemove",[e.target.parentNode]),p.cameraContainer)){let t=e.clientX-d(p,Re),s=window.innerHeight-e.clientY-d(p,we);t+p.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-p.cameraContainer.offsetWidt),p.cameraContainer.style.left=`${t}px`,s+p.cameraContainer.offsetHeight>window.innerHeight&&(s=window.innerHeight-p.cameraContainer.offsetHeight),p.cameraContainer.style.bottom=`${s}px`}},ct=function(e){if(!p.isResizing)return;const t=d(p,Pe)+(e.clientX-d(p,Ge)),s=e.clientY-d(p,Fe),n=d(p,De)+s,o=d(p,Ae)-s;p.cameraContainer.style.width=`${t}px`,p.cameraContainer.style.height=`${n}px`,p.cameraContainer.style.bottom=`${o}px`},dt=function(){var n,o,a,i,r,c;const e=C(),t={...S.get(e.cameraDockMenu.tag)},s=document.querySelector("body.crlngn-ui");p.isResizing=!1,s==null||s.removeEventListener("mousemove",F(p,O,ct)),s==null||s.removeEventListener("mouseup",F(p,O,dt)),g.log("onStopResize",[(n=p.cameraContainer)==null?void 0:n.style.width,(o=p.cameraContainer)==null?void 0:o.style.height,(a=p.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((i=p.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((r=p.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((c=p.cameraContainer)==null?void 0:c.style.bottom)||0),S.set(e.cameraDockMenu.tag,t)},N(p,O),N(p,Re,0),N(p,we,0),L(p,"isDragging",!1),L(p,"cameraContainer"),L(p,"isResizing",!1),N(p,Ge,0),N(p,Fe,0),N(p,Pe,0),N(p,De,0),N(p,Ae,0);let ee=p;const j=class j{static init(){const e=C();j.enableChatStyles=S.get(e.enableChatStyles.tag),j.chatBorderColor=S.get(e.chatBorderColor.tag)}};L(j,"chatBorderColor"),L(j,"enableChatStyles"),L(j,"enrichCard",async(e,t)=>{var a,i,r,c,f,b,y,v;g.log("renderChatMessage",[j.chatBorderColor,j.enableChatStyles,Ne.playerColor.name,(a=e.author)==null?void 0:a.id]);const s=((c=(r=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:r.activity)==null?void 0:c.type)||((y=(b=(f=e.flags)==null?void 0:f.dnd5e)==null?void 0:b.roll)==null?void 0:y.type)||"custom";let n=t.get?t.get(0):t;if(!n)return;n.classList.add(s),n.classList.add("crlngn");const o=n.querySelectorAll(".card-buttons button[data-action=rollSave]");o.length>0&&o.forEach(h=>{const I=h.querySelector(".visible-dc"),G=h.querySelector(".hidden-dc");g.log("enrichCard",[I,G]),I.setAttribute("data-ability",h.getAttribute("data-ability")||""),I.setAttribute("data-dc",h.getAttribute("data-dc")||""),G.setAttribute("data-ability",h.getAttribute("data-ability")||"")}),j.chatBorderColor===Ne.playerColor.name&&((v=e.author)!=null&&v.id)&&n.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let Le=j;var fe;const U=class U{static init(){Hooks.on(R.RENDER_PLAYERS_LIST,U.checkPlayersList),Hooks.on(R.RENDER_HOTBAR,U.checkPlayersList),T.isModuleOn("foundry-taskbar")&&Hooks.on(R.UPDATE_USER,U.checkTaskbarLock),U.checkTaskbarLock()}};fe=new WeakMap,N(U,fe),L(U,"checkTaskbarLock",()=>{var o,a,i;const e=T.isModuleOn("foundry-taskbar"),t=(o=game.user.flags)==null?void 0:o["foundry-taskbar"];if(g.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(a=t.taskbarSettings)!=null&&a.locked?T.addCSSVars("--crlngn-sidebar-bottom",s?"50px":"0px"):T.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?T.addCSSVars("--crlngn-taskbar-height","50px"):T.addCSSVars("--crlngn-taskbar-height","10px");const n=document.querySelector("#ft-move-players-macro");n&&(n.innerHTML=""),U.checkPlayersList()}),L(U,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),s=T.isModuleOn("foundry-taskbar"),n=s?game.settings.get("foundry-taskbar","dockPlayersList"):!1,o=s?game.settings.get("foundry-taskbar","dockMacroBar"):!1;g.log("checkPlayersList",[n,s,o,game.settings]);let a=10;n&&(a=250);const i=document.querySelector("#hotbar");i&&i instanceof HTMLElement&&i.style.setProperty("visibility","hidden"),clearTimeout(d(U,fe)),E(U,fe,setTimeout(()=>{n?(g.log("checkPlayersList TEST",[n]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),i&&i instanceof HTMLElement&&i.style.removeProperty("visibility"),clearTimeout(d(U,fe))},a))});let Ye=U;var z,P,ne,oe,pe,me,ze,Oe,he,ye,x,B,Ke,Ze;const u=class u{static handleNavState(){const e=C();game.ready&&d(u,ye)?(E(u,ye,!1),u.toggleNav(u.navStartCollapsed)):u.toggleNav(S.get(e.sceneNavCollapsed.tag))}static toggleNav(e){clearTimeout(d(u,Oe)),E(u,Oe,setTimeout(()=>{u.resetLocalVars(),e?(ui.nav.collapse(),d(u,me).classList.add("navigation-collapsed")):(ui.nav.expand(),d(u,me).classList.remove("navigation-collapsed"))},500))}static checkSceneNavCompat(){var s,n;const e=C(),t=document.querySelector("#ui-middle");E(this,x,T.isModuleOn("monks-scene-navigation")),E(this,B,T.isModuleOn("compact-scene-navigation")),d(this,B)&&u.navFoldersEnabled&&(s=game.user)!=null&&s.isGM&&d(this,B)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),d(this,x)&&u.sceneNavEnabled&&(t.classList.remove("crlngn-ui"),game.ready&&(S.set(e.sceneNavEnabled.tag,!1),u.sceneNavEnabled=!1),g.log("checkSceneNavCompat",[d(this,x),d(this,B)]),(n=game.user)!=null&&n.isGM&&d(this,x)&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static resetLocalVars(){E(u,z,document.querySelector("#navigation")),E(u,oe,document.querySelector("#navigation .nav-item.is-root")),E(u,pe,document.querySelector("#nav-toggle")),E(u,me,document.querySelector("#ui-middle")),u.navFoldersEnabled?(E(u,P,document.querySelector("#crlngn-scene-list")),g.log("TopNavigation resetLocalVars",[d(u,P)])):E(u,P,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=d(u,z))==null||e.addEventListener("mouseenter",s=>{if(g.log("TopNavigation mouseenter",[]),!u.isCollapsed||!u.showNavOnHover)return;s.stopPropagation(),clearTimeout(d(u,ne)),document.querySelector("#navigation").classList.remove("collapsed")}),(t=d(this,z))==null||t.addEventListener("mouseleave",s=>{g.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!u.showNavOnHover)&&(s.stopPropagation(),E(this,ne,setTimeout(()=>{clearTimeout(d(this,ne)),E(this,ne,null),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){clearTimeout(d(this,he)),E(u,he,setTimeout(()=>{var r,c,f,b,y,v,h;clearTimeout(d(this,he)),u.resetLocalVars();const e=((c=(r=d(u,z))==null?void 0:r.querySelector("#crlngn-scene-folders"))==null?void 0:c.offsetWidth)||0,t=(f=d(u,z))==null?void 0:f.querySelectorAll("button.crlngn-nav"),s=((b=d(u,P))==null?void 0:b.scrollWidth)+e>=((y=d(this,z))==null?void 0:y.offsetWidth);if(g.log("placeNavButtons",[d(u,P),s]),!s)return;t.forEach(I=>I.remove());const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),n.addEventListener("click",d(this,Ke)),n.append(o);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),a.append(i),a.addEventListener("click",d(this,Ze)),(v=d(this,z))==null||v.appendChild(n),(h=d(this,z))==null||h.appendChild(a),d(this,P)&&d(this,P).classList.remove("no-transition")},250))}static setNavPosition(e){var i,r,c;const t=C();if(!d(this,P))return;const s=((i=d(this,P))==null?void 0:i.querySelectorAll("li.nav-item:not(.is-root)"))||[],n=d(this,B)?(r=d(this,oe))==null?void 0:r.offsetWidth:0,o=e!==void 0?e:u.navPos||0,a=(parseInt((c=s[o])==null?void 0:c.offsetLeft)-n)*-1;d(this,P).style.marginLeft=a+"px",u.navPos=o,S.set(t.sceneNavPos.tag,o),g.log("setNavPosition",[e,o,s,s[o],a])}};z=new WeakMap,P=new WeakMap,ne=new WeakMap,oe=new WeakMap,pe=new WeakMap,me=new WeakMap,ze=new WeakMap,Oe=new WeakMap,he=new WeakMap,ye=new WeakMap,x=new WeakMap,B=new WeakMap,Ke=new WeakMap,Ze=new WeakMap,N(u,z),N(u,P),N(u,ne),N(u,oe),N(u,pe),N(u,me),L(u,"sceneFoldersTemplate"),N(u,ze),N(u,Oe),N(u,he),N(u,ye,!0),N(u,x,!1),N(u,B,!1),L(u,"sceneNavEnabled"),L(u,"navFoldersEnabled"),L(u,"navFoldersForPlayers"),L(u,"navStartCollapsed"),L(u,"showFolderListOnClick"),L(u,"showNavOnHover"),L(u,"isCollapsed"),L(u,"navPos"),L(u,"init",async()=>{const e=C();u.checkSceneNavCompat(),u.navStartCollapsed=S.get(e.navStartCollapsed.tag),u.showNavOnHover=S.get(e.showNavOnHover.tag),u.sceneNavEnabled=S.get(e.sceneNavEnabled.tag),u.navFoldersEnabled=S.get(e.navFoldersEnabled.tag),u.navFoldersForPlayers=S.get(e.navFoldersForPlayers.tag),u.showFolderListOnClick=S.get(e.showFolderListOnClick.tag),u.isCollapsed=d(u,ye)?u.navStartCollapsed:S.get(e.sceneNavCollapsed.tag),u.navPos=S.get(e.sceneNavPos.tag),u.resetLocalVars();const t=document.querySelector("#ui-middle");if(g.log("SCENE NAV INIT",[u.sceneNavEnabled]),u.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}if(d(u,x))d(u,x)&&t.classList.add("with-monks-scene");else{d(u,B)||await re.renderSceneFolders();const s=S.get(e.sceneNavPos.tag);u.setNavPosition(s),u.placeNavButtons(),u.addListeners(),u.handleNavState()}Hooks.on(R.RENDER_SCENE_NAV,async()=>{g.log("SCENE NAV",[u.navPos]),g.log("TopNavigation",[u.isCollapsed,u.navStartCollapsed]);const s=C();if(!d(u,x)){g.log("NAV no transition add"),u.navPos=S.get(s.sceneNavPos.tag),re.init(),d(u,B)||await re.renderSceneFolders(),d(u,P)&&d(u,P).classList.add("no-transition");const n=u.navPos;u.setNavPosition(n),u.placeNavButtons(),u.addListeners(),u.handleNavState(),clearTimeout(d(u,ze)),E(u,ze,setTimeout(()=>{g.log("NAV no transition remove"),d(u,P)&&d(u,P).classList.remove("no-transition")},250))}}),Hooks.on(R.COLLAPSE_SIDE_BAR,s=>{g.log(R.COLLAPSE_SIDE_BAR,["isMonksSceneNavOn",d(u,x)]),d(u,x)||u.placeNavButtons()}),Hooks.on(R.COLLAPSE_SCENE_NAV,(s,n)=>{const o=C();S.set(o.sceneNavCollapsed.tag,n),g.log("NAV toggle",[s,n]),u.isCollapsed=n,u.toggleNav(n)}),Hooks.on(R.EXPAND_SCENE_NAV,(s,n)=>{g.log("NAV expand",[s,!1])}),window.addEventListener("resize",()=>{d(u,x)||u.placeNavButtons()}),g.log("TopNavigation - init",[u.sceneNavEnabled])}),N(u,Ke,e=>{var f,b,y,v,h,I,G;const t=((b=(f=d(u,z))==null?void 0:f.querySelector("#crlngn-scene-folders"))==null?void 0:b.offsetWidth)||0,s=d(u,B)?(y=d(u,oe))==null?void 0:y.offsetWidth:0,n=(v=d(u,pe))==null?void 0:v.offsetWidth,o=(h=d(u,P))==null?void 0:h.querySelector("li.nav-item:not(.is-root)");(I=d(u,P))!=null&&I.querySelectorAll("li.nav-item:not(.is-root)");const a=o.offsetWidth,i=u.navPos||0,r=Math.floor((((G=d(u,z))==null?void 0:G.offsetWidth)-(i===0?s+t:0)-n*2)/a);let c=i-(r-1);c=c<0?0:c,g.log("onNavLast",["currPos",i,"items",r,c]),u.setNavPosition(c)}),N(u,Ze,e=>{var b,y,v,h,I,G,V;const t=((y=(b=d(u,z))==null?void 0:b.querySelector("#crlngn-scene-folders"))==null?void 0:y.offsetWidth)||0,s=d(u,B)?(v=d(u,oe))==null?void 0:v.offsetWidth:0,n=(h=d(u,pe))==null?void 0:h.offsetWidth,o=(I=d(u,P))==null?void 0:I.querySelector("li.nav-item:not(.is-root)"),a=((G=d(u,P))==null?void 0:G.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=o.offsetWidth,r=u.navPos||0,c=Math.floor((((V=d(u,z))==null?void 0:V.offsetWidth)-(r===0?s+t:0)-n*2)/i);let f=r+(c-1);f=f>a.length-1?a.length-1:f,g.log("onNavNext",["currPos",r,"items",c,f]),u.setNavPosition(f)});let D=u;const Y="favorites";var Ue,ae,Se,be,ie,Je,xe,He,X,le,$,qe,Be,Z,Qe,ft;const l=class l{static init(){if(!l.noFolderView()&&(!l.folderListData||l.folderListData.length===0)){const e=T.isModuleOn("monks-scene-navigation"),t=T.isModuleOn("compact-scene-navigation");!e&&!t&&l.preloadTemplate(),g.log("SceneNavFolders",[ui.scenes]),l.folderListData=l.getFolders(ui.scenes.folders),l.selectedFolder=l.selectFolder(Y)}}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||Y}static getParentFolders(e){const t=[];let s=ui.scenes.folders.find(o=>o.id===e);g.log("getParentFolders",[ui.scenes.folders,s]);const n=new Set;for(;s!=null&&s.folder;){if(n.has(s.id)){g.log("Circular reference detected in folder structure",[s]);break}n.add(s.id);const o=s.folder;if(o)t.unshift(o),s=o;else break}return t}static registerHooks(){Hooks.on(R.CREATE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(R.UPDATE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(R.DELETE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(R.CREATE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(R.UPDATE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(R.DELETE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(R.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;document.querySelector("#scenes .directory-list").addEventListener("contextmenu",s=>{var o;const n=s.target.closest(".directory-item");if(n&&(l.contextMenuSceneId=n.dataset.documentId||null,l.contextMenuSceneId)){const i=game.scenes.get(l.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",r=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+i);d(o=l,He).call(o,r)}})}),Hooks.on(R.RENDER_SCENE_NAV,()=>{document.querySelector("#navigation").addEventListener("contextmenu",t=>{var n;const s=t.target.closest(".nav-item");if(s&&(l.contextMenuSceneId=t.currentTarget.dataset.sceneId||s.dataset.sceneId||null,l.contextMenuSceneId)){const a=game.scenes.get(l.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",i=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+a);d(n=l,He).call(n,i)}})}),Hooks.on(R.GET_SCENE_NAV_CONTEXT,(e,t)=>{g.log(R.GET_SCENE_NAV_CONTEXT,[e,t]),t.find(n=>n.name==="CRLNGN_UI.ui.sceneNav.initialViewBtn")||t.push({...t[0],condition:n=>{var o;return((o=game.user)==null?void 0:o.isGM)&&game.scenes.get(n.data("sceneId"))._view},callback:n=>{let o=game.scenes.get(n.data("sceneId")),a=parseInt(canvas.stage.pivot.x),i=parseInt(canvas.stage.pivot.y),r=canvas.stage.scale.x;o.update({initial:{x:a,y:i,scale:r}},{diff:!1}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.initialViewSet"))},icon:'<i class="fas fa-expand"></i>',name:"CRLNGN_UI.ui.sceneNav.initialViewBtn"})})}};Ue=new WeakMap,ae=new WeakMap,Se=new WeakMap,be=new WeakMap,ie=new WeakMap,Je=new WeakMap,xe=new WeakMap,He=new WeakMap,X=new WeakMap,le=new WeakMap,$=new WeakMap,qe=new WeakMap,Be=new WeakMap,Z=new WeakMap,Qe=new WeakMap,ft=new WeakMap,L(l,"selectedFolder"),L(l,"folderList"),L(l,"folderListData",[]),L(l,"searchValue",""),N(l,Ue,""),L(l,"contextMenuSceneId",null),N(l,ae,{}),L(l,"getFolders",e=>{const t=n=>{n.isOpen=d(l,ae)[n.id]??!1,n.children.forEach(t)};let s=e.filter(n=>n.folder===null);return s.forEach(t),s.sort((n,o)=>n.name.toLowerCase().localeCompare(o.name.toLowerCase())),s}),L(l,"selectFolder",e=>l.getFolderById(e)||null),L(l,"createFolderElem",()=>document.createElement("li")),L(l,"preloadTemplate",async()=>{const e=[`modules/${W}/templates/scene-folder-list.hbs`];return await loadTemplates(e),g.log("preloadTemplate",[!0]),!0}),L(l,"getFoldersData",e=>{const t=e.children.map(n=>l.getFoldersData(n.folder)),s={...e,isOpen:d(l,ae)[e.id]||!1,children:t,hasSubfolders:t.length>0,id:e.id};return g.log("processedFolder",[s]),s}),N(l,Se,null),N(l,be,null),N(l,ie,null),L(l,"renderSceneFolders",async()=>{var c,f,b,y,v;if(l.noFolderView()||!l.selectedFolder)return;E(l,Ue,game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder"));const e=l.getFolders(ui.scenes.folders),t={favoritesId:Y,favoritesName:d(l,Ue),folderList:e.map(h=>l.getFoldersData(h)),viewedSceneId:game.scenes.current.id,users:game.users.contents,isGM:(c=game.user)==null?void 0:c.isGM,searchValue:l.searchValue,showSearchResults:!!l.searchValue};if(g.log("renderSceneFolders",[t.folderList,d(l,ae)]),l.selectedFolder===Y)E(l,Se,{...t,currFolder:{name:"",id:Y},currIcon:"fa-map",folders:[],scenes:ui.nav.scenes.filter(h=>h.permission>=2),hasParents:!1,parentFolders:[]});else{const h=l.selectedFolder.children,I=l.getParentFolders(l.selectedFolder.id);g.log("foldersData",[h,l.selectedFolder,I]);const G=[...l.selectedFolder.contents];G.sort((V,je)=>V.sort-je.sort),E(l,Se,{...t,currFolder:l.selectedFolder,currIcon:"fa-folder",folders:h,scenes:G,hasParents:I.length>0,parentFolders:I})}g.log("Elements not in DOM, rendering template",[]),(f=d(l,be))==null||f.remove(),(b=d(l,ie))==null||b.remove();const s=await renderTemplate(`modules/${W}/templates/scene-folder-list.hbs`,d(l,Se)),n=document.querySelector("#scene-list");n.insertAdjacentHTML("beforebegin",s),E(l,be,document.querySelector("#crlngn-scene-folders")),E(l,ie,document.querySelector("#crlngn-scene-list")),n==null||n.classList.add("hidden");const o=d(l,ie),a=o.querySelectorAll("li.nav-item"),i=D.navPos||0,r=parseInt((y=a[i])==null?void 0:y.offsetLeft)*-1;o.style.marginLeft=r+"px",l.activateFolderListeners(d(l,be)),d(v=l,Je).call(v,d(l,ie)),D.resetLocalVars()}),L(l,"activateFolderListeners",e=>{if(l.noFolderView())return;g.log("activateFolderListeners",[e]);const t=e.querySelector("a.selected");D.showFolderListOnClick?(t==null||t.removeEventListener("mouseover",d(l,X)),e.removeEventListener("mouseleave",d(l,X)),t==null||t.addEventListener("click",d(l,X))):(t==null||t.addEventListener("mouseover",d(l,X)),e.addEventListener("mouseleave",d(l,X)),t==null||t.removeEventListener("click",d(l,X))),e.querySelectorAll(".parent-folder").forEach(a=>{a.addEventListener("click",d(l,Z))}),e.querySelectorAll("span.toggle").forEach(a=>{a.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation();const r=i.currentTarget.closest("li"),c=r.dataset.folderId,f=r.querySelector("ol.subfolders");let b=!1;if(!f)return;!f.classList.contains("open")?(f.classList.add("open"),b=!0):(f.classList.remove("open"),b=!1),i.currentTarget.textContent=b?"−":"+",d(l,ae)[c]=b})}),e.querySelectorAll(".folder-list li.folder").forEach(a=>{a.addEventListener("click",d(l,Z))});const n=e.querySelector(".search-container .input-scene-search");n.addEventListener("keyup",d(l,Qe)),n.addEventListener("keydown",a=>{a.stopPropagation()}),e.querySelector(".search-container .back-to-favorites").addEventListener("click",d(l,Z))}),N(l,Je,e=>{var s,n;e.querySelectorAll("li.nav-item").forEach(o=>{const a=o.classList.contains("folder");o.addEventListener("click",a?d(l,Z):d(l,qe)),o.addEventListener("dblclick",a?()=>{}:d(l,Be))}),(s=game.user)!=null&&s.isGM&&d(n=l,xe).call(n,e)}),N(l,xe,e=>{if(typeof Sortable>"u"){setTimeout(()=>{var o;return d(o=l,xe).call(o,e)},100);return}g.log("#initializeDragDrop",[]);const t={animation:100,delay:50,delayOnTouchOnly:!0},s={...t,draggable:".scene.nav-item",onEnd:async o=>{var y,v;g.log("#initializeDragDrop scenes",["onEnd",o]);const a=e.querySelectorAll(".scene.nav-item"),i=[],r=Array.from(a).map(h=>game.scenes.get(h.dataset.sceneId));let c=0;const f=CONST.SORT_INTEGER_DENSITY;for(const h of r){if(!h)continue;const I={_id:h.id};l.selectedFolder===Y?h.navigation&&(I.navOrder=c,c+=f):l.selectedFolder&&((y=h.folder)==null?void 0:y.id)===l.selectedFolder.id&&(I.sort=c,c+=f),i.push(I)}const b=game.scenes.contents.filter(h=>!i.some(I=>I._id===h.id));b.sort((h,I)=>{var G,V;if(l.selectedFolder===Y)return!h.navigation&&!I.navigation?0:h.navigation?I.navigation?h.navOrder-I.navOrder:-1:1;{const je=((G=h.folder)==null?void 0:G.id)===l.selectedFolder.id,mt=((V=I.folder)==null?void 0:V.id)===l.selectedFolder.id;return!je&&!mt?0:je?mt?h.sort-I.sort:-1:1}});for(const h of b)l.selectedFolder===Y?h.navigation&&(i.push({_id:h.id,navOrder:c}),c+=f):((v=h.folder)==null?void 0:v.id)===l.selectedFolder.id&&(i.push({_id:h.id,sort:c}),c+=f);i.length&&(await Scene.updateDocuments(i),ui.nav.render(),game.scenes.directory.render())}},n={...t,draggable:".folder.nav-item",onEnd:async o=>{var y,v;g.log("#initializeDragDrop folders",["onEnd",o]);const a=e.querySelectorAll(".folder.nav-item"),i=[],r=Array.from(a).map(h=>{const I=h.dataset.folderId;return game.scenes.folders.find(G=>G.id===I)}).filter(h=>h);let c=0;const f=CONST.SORT_INTEGER_DENSITY;for(const h of r)h&&((y=h.folder)==null?void 0:y.id)===((v=l.selectedFolder)==null?void 0:v.id)&&(i.push({_id:h.id,sort:c}),c+=f);const b=game.scenes.folders.filter(h=>{var I,G;return((I=h.folder)==null?void 0:I.id)===((G=l.selectedFolder)==null?void 0:G.id)&&!i.some(V=>V._id===h.id)}).sort((h,I)=>h.sort-I.sort);for(const h of b)i.push({_id:h.id,sort:c}),c+=f;i.length&&(await Folder.updateDocuments(i),ui.nav.render(),game.scenes.directory.render())}};new Sortable(e,s),new Sortable(e,n)}),L(l,"refreshFolderView",async()=>{l.noFolderView()||(l.folderListData=l.getFolders(ui.scenes.folders),await l.renderSceneFolders(),D.placeNavButtons())}),L(l,"updateSearchResults",e=>{if(l.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const s=game.scenes.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())&&o.permission>=2),n=game.scenes.folders.filter(o=>o.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),n.forEach(o=>{const a=document.createElement("li");a.className="folder",a.dataset.folderId=o.id,a.innerHTML=`<a><i class="fas fa-folder"></i> ${o.name}</a>`,a.addEventListener("click",d(l,Z)),t.appendChild(a)}),s.forEach(o=>{const a=document.createElement("li");a.className="scene",a.dataset.sceneId=o.id,a.innerHTML=`<a><i class="fas fa-map"></i> ${o.name}</a>`,a.addEventListener("dblclick",d(l,Be)),a.addEventListener("click",d(l,qe)),t.appendChild(a)}),n.length===0&&s.length===0){const o=document.createElement("li");o.className="no-results",o.textContent="No matching results found",t.appendChild(o)}}),N(l,He,e=>{const t=()=>{const n=document.querySelector("#context-menu");if(!n)return!1;const o=n.querySelectorAll(".context-item"),a=Array.from(o).find(i=>i.innerHTML.includes(game.i18n.localize("SCENES.ToggleNav")));return a?(g.log("updating toggle nav item",[a]),a.innerHTML=`<i class="fas fa-compass fa-fw"></i>${e}`,!0):!1};if(t())return;const s=new MutationObserver((n,o)=>{t()&&o.disconnect()});s.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>s.disconnect(),1e3)}),N(l,X,e=>{e.stopPropagation(),e.preventDefault();const t=document.querySelector("#crlngn-scene-folders"),s=e.type.startsWith("mouse"),n=!D.showFolderListOnClick;if(s&&n&&e.type==="mouseover"){t!=null&&t.classList.contains("open")||t==null||t.classList.add("open");return}if(s&&n&&e.type==="mouseleave"){t==null||t.classList.remove("open");return}s||(t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),document.addEventListener("click",d(l,le))))}),N(l,le,e=>{e.preventDefault(),document.removeEventListener("click",d(l,le));const t=e.target,s=document.querySelector("#crlngn-scene-folders");g.log("#onOutsideClick",[s,t,s.contains(t)]),s!=null&&s.classList.contains("open")&&!s.contains(t)&&s.classList.remove("open")}),N(l,$,null),N(l,qe,e=>{var a;e.preventDefault(),e.stopPropagation(),document.removeEventListener("click",d(l,le));const t=e.currentTarget,s=t.dataset,n=game.scenes.get(s.sceneId),o=(a=t.parentElement)==null?void 0:a.classList.contains("search-results");g.log("scene click",[n,t.parentElement,o]),d(l,$)&&(clearTimeout(d(l,$)),E(l,$,null)),E(l,$,setTimeout(()=>{o&&(n.navigation=!0,l.selectedFolder=l.selectFolder(Y)),n.view(),l.refreshFolderView(),E(l,$,null)},250))}),N(l,Be,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset,n=game.scenes.get(s.sceneId);d(l,$)&&(clearTimeout(d(l,$)),E(l,$,null)),g.log("#onActivateScene",[n]),n.activate(),l.refreshFolderView()}),N(l,Z,e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("click",d(l,le));const s=e.currentTarget.dataset;g.log("#onSelectFolder",[s]);const n=l.selectFolder(s.folderId||"");n!==l.selectedFolder&&(D.navPos=0),l.selectedFolder=n,l.refreshFolderView()}),N(l,Qe,e=>{e.stopPropagation();const s=e.currentTarget.value;l.searchValue=s,l.updateSearchResults(s)}),N(l,ft,e=>{var n,o,a,i;e.preventDefault(),e.stopPropagation();let t=((o=(n=e.currentTarget)==null?void 0:n.dataset)==null?void 0:o.sceneId)||"",s=((i=(a=e.currentTarget)==null?void 0:a.dataset)==null?void 0:i.folderId)||"";t?game.scenes.get(t).view():s&&(l.selectedFolder=l.selectFolder(s),l.refreshFolderView())}),L(l,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!D.navFoldersForPlayers||!D.navFoldersEnabled||!D.sceneNavEnabled});let re=l;var Ce;const m=class m{static registerSettings(){const e=C();g.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(W),Object.entries(e).forEach(async i=>{const r=i[1];g.log("Registering... ",[i],!0);const c={name:r.label,hint:r.hint,default:r.default,type:r.propType,scope:r.scope,config:r.config,requiresReload:r.requiresReload||!1,onChange:f=>m.apply(r.tag,f)};r.choices&&(c.choices=r.choices),await game.settings.register(W,r.tag,c),m.get(r.tag)===void 0&&m.set(r.tag,r.default),game.keybindings.register(W,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{m.hideInterface()},restricted:!1})}),m.applyThemeSettings(),m.applyCustomCSS(),m.applyModuleAdjustments(),Object.entries(Wt()).forEach(async i=>{const r=i[1],c={name:r.tag,label:r.label,hint:r.hint,icon:r.icon,type:r.propType,restricted:r.restricted};await game.settings.registerMenu(W,r.tag,c)}),Hooks.on(R.RENDER_SCENE_CONTROLS,m.applyLeftControlsSettings),Hooks.on(R.RENDER_PLAYERS_LIST,m.applyPlayersListSettings),Hooks.on(R.RENDER_HOTBAR,()=>{m.firstLoad&&(m.firstLoad=!1,m.applyHotBarCollapse()),m.applyHotBarSettings()}),m.applyDebugSettings(),m.applyChatStyles(),m.applyBorderColors(),e.sceneNavMenu.fields.forEach(i=>{m.apply(e[i].tag)}),e.customFontsMenu.fields.forEach(i=>{m.applyCustomFonts(e[i].tag)}),e.leftControlsMenu.fields.forEach(i=>{m.applyLeftControlsSettings(e[i].tag)})}static get(e,t=W){if(!e)return null;let s=!1;if(t===W)s=game.settings.get(t,e);else{let o=game.settings.storage.get("client")[`${t}.${e}`];o===void 0&&(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),s=o==null?void 0:o.value,g.log("GET Setting",[o,s])}return s}static set(e,t,s=W){if(!e)return!1;let n=game.settings.storage.get("client")[`${s}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${s}.${e}`)),g.log("Setting",[e,n]);try{game.settings.set(s,e,t)}catch{g.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const s=C();switch(t===void 0&&(t=m.get(e)),g.log("SettingsUtil.apply",[e,t,m.get(e)]),e){case s.enableMacroLayout.tag:m.applyHotBarSettings();break;case s.collapseMacroBar.tag:m.applyHotBarCollapse();break;case s.autoHidePlayerList.tag:m.applyPlayersListSettings();break;case s.uiFontBody.tag:case s.uiFontTitles.tag:case s.journalFontBody.tag:case s.journalFontTitles.tag:m.applyCustomFonts(e,t);break;case s.controlsBottomBuffer.tag:case s.controlsIconSize.tag:case s.controlsAutoHide.tag:case s.hideFoundryLogo.tag:m.applyLeftControlsSettings(e,t);break;case s.cameraDockMenu.tag:m.applyCameraPosX(),m.applyCameraPosY(),m.applyCameraWidth(),m.applyCameraHeight();break;case s.chatBorderColor.tag:Le.chatBorderColor=m.get(s.chatBorderColor.tag),g.log("SettingsUtil.apply",[e]),m.applyBorderColors();break;case s.enableChatStyles.tag:Le.enableChatStyles=m.get(s.enableChatStyles.tag),g.log("SettingsUtil.apply",[e]),m.applyChatStyles();break;case s.enforceDarkMode.tag:m.resetFoundryThemeSettings();break;case s.debugMode.tag:m.applyDebugSettings();break;case s.sceneNavEnabled.tag:D.sceneNavEnabled=t;break;case s.navFoldersEnabled.tag:D.navFoldersEnabled=t;break;case s.navStartCollapsed.tag:D.navStartCollapsed=t;break;case s.showFolderListOnClick.tag:D.showFolderListOnClick=t,re.refreshFolderView();break;case s.showNavOnHover.tag:D.showNavOnHover=t;break;case s.sceneNavCollapsed.tag:D.isCollapsed=m.get(s.sceneNavCollapsed.tag);break;case s.sceneNavPos.tag:m.applySceneNavPos();break;case s.colorTheme.tag:m.applyThemeSettings();break;case s.customStyles.tag:m.applyCustomCSS();break;case s.adjustOtherModules.tag:m.applyModuleAdjustments();break}}static applyBorderColors(){const e=C(),t=m.get(e.chatBorderColor.tag),s=document.querySelector("body");t===Ne.playerColor.name?(s.classList.add("player-chat-borders"),s.classList.remove("roll-chat-borders")):t===Ne.rollType.name?(s.classList.add("roll-chat-borders"),s.classList.remove("player-chat-borders")):(s.classList.remove("player-chat-borders"),s.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=C(),t=m.get(e.enableChatStyles.tag),s=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?s.classList.add("crlngn-chat"):s.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=C(),t=m.get(e.enableMacroLayout.tag),s=document.querySelector("#hotbar");!t&&s?s.classList.add("foundry-default"):s&&s.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=C();m.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const s=C(),n=m.get(s.sceneNavEnabled.tag),o=document.querySelector("#ui-left"),a=document.querySelector("#ui-left #logo"),i=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),e){case s.controlsAutoHide.tag:m.get(s.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break;case s.hideFoundryLogo.tag:const c=window.getComputedStyle(i).getPropertyValue("--top-nav-height")||"0px",f=parseFloat(c)||0,b=m.get(s.hideFoundryLogo.tag);g.log("applyLeftControlsSettings",[e,f,c]),b===void 0||b===!0?(a.classList.remove("visible"),T.addCSSVars("--ui-top-padding",`${f}px`),document.querySelector("body").classList.remove("logo-visible")):(a.classList.add("visible"),n?(T.addCSSVars("--ui-top-padding",`${72+f}px`),document.querySelector("body").classList.add("logo-visible")):T.addCSSVars("--ui-top-padding","72px"));break;case s.controlsBottomBuffer.tag:m.applyControlsBuffer();break;case s.controlsIconSize.tag:m.applyControlIconSize();break}}static applyControlIconSize(){const e=C(),t=m.get(e.controlsIconSize.tag);document.querySelector("body");const s=t==Me.small.name?Me.small.size:Me.regular.size;g.log("applyControlIconSize",[s]),T.addCSSVars("--left-control-item-size",s),m.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=C(),t=m.get(e.leftControlsMenu.tag),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;T.addCSSVars("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,s;const e=C();g.log("applyPlayersListSettings",[document.querySelector("#players"),m.get(e.autoHidePlayerList.tag)]),m.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(s=document.querySelector("#players"))==null||s.classList.remove("auto-hide"),Ye.checkPlayersList()}static applySceneNavPos(e){const t=C();D.navPos=e||m.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=C(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockPosX;ee.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=C(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockPosY;ee.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=C(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockWidth;ee.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=C(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockHeight;ee.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const s=C(),n=s.customFontsMenu.fields,o={};switch(g.log("applyCustomFonts",[e,t]),n.forEach(a=>{o[a]=m.get(s[a].tag)}),document.querySelector("body.crlngn-ui"),e){case s.uiFontBody.tag:T.addCSSVars("--crlngn-font-family",t||o.uiFontBody||s.uiFontBody.default.uiFont||"");break;case s.uiFontTitles.tag:T.addCSSVars("--crlngn-font-titles",t||o.uiFontTitles||s.uiFontTitles.default.uiTitles||"");break;case s.journalFontBody.tag:T.addCSSVars("--crlngn-font-journal-body",t||o.journalFontBody||o.journalFontBody||"");break;case s.journalFontTitles.tag:T.addCSSVars("--crlngn-font-journal-title",t||o.journalFontTitles||o.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var a,i;const e=C(),t=T.isModuleOn("monks-player-settings"),s=T.isModuleOn("force-client-settings"),n=m.get(e.enforceDarkMode.tag);if(n&&t){(a=game.user)!=null&&a.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}if(n&&s){(i=game.user)!=null&&i.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}const o=game.settings.get("core","colorScheme");g.log("resetFoundryThemeSettings",[o,n]),o===!1&&n&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=C();g.debugOn=e||m.get(t.debugMode.tag)}};Ce=new WeakMap,N(m,Ce,!1),L(m,"firstLoad",!0),L(m,"applyThemeSettings",e=>{const t=C(),s=e||m.get(t.colorTheme.tag)||"",n=document.querySelector("body");g.log("applyThemeSettings",[e,s,m.get(t.colorTheme.tag)]),K.forEach(o=>{o.className&&n.classList.remove(o.className)}),s&&n.classList.add(s)}),L(m,"applyCustomCSS",e=>{const t=C(),s=e||m.get(t.customStyles.tag)||"";T.addCustomCSS(s)}),L(m,"applyModuleAdjustments",e=>{const t=C(),s=e||m.get(t.adjustOtherModules.tag)||!1,n=document.querySelector("body");s?n.classList.add("crlngn-enforce-styles"):n.classList.remove("crlngn-enforce-styles")}),L(m,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),s=document.querySelector(".taskbar");d(m,Ce)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&s.style.removeProperty("visibility"),E(m,Ce,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),s&&s.style.setProperty("visibility","hidden"),E(m,Ce,!0))});let S=m;class pt{static init(){Hooks.on(R.RENDER_PLAYERS_LIST,pt.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const s=e.offsetHeight;T.addCSSVars("--players-list-height",s+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var J,Ve,$e;const A=class A{static init(){g.log("LeftControls - init",[]),Hooks.on(R.RENDER_SCENE_CONTROLS,A.initSceneControls),A.initSceneControls()}static resetLocalVars(){E(A,J,document.querySelector("#ui-left #controls")),E(A,Ve,document.querySelector("#ui-left"))}static initSceneControls(){g.log("initSceneControls",[]),A.resetLocalVars(),A.observeControlsWidth()}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!d(A,J))return;let e;const t=(s,n)=>{e||(e=setTimeout(()=>{s(),e=null},n))};E(A,$e,new ResizeObserver(s=>{t(()=>A.updateCSSVars(),250)})),d(A,$e).observe(d(A,J),{box:"border-box"}),A.updateCSSVars()}static updateCSSVars(){if(!d(A,J))return;let e=Number(d(A,Ve).offsetWidth),t=Number(d(A,J).offsetWidth),s=-e+t+24;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&T.addCSSVars("--ui-controls-margin-left",s+"px")}};J=new WeakMap,Ve=new WeakMap,$e=new WeakMap,N(A,J),N(A,Ve),N(A,$e);let ut=A;class Gt{static init(){Hooks.once("ready",()=>{var t;if(!((t=game.user)!=null&&t.isGM))return;const e=C();S.set(e.lastUpdateId.tag,""),this.checkForUpdates()})}static async checkForUpdates(){const e=C();try{const t=await fetch(this.UPDATE_NEWS_URL);if(!t.ok){g.warn("checkForUpdates | Failed to fetch update news",[t]);return}const s=await t.json(),n=S.get(e.lastUpdateId.tag);if(g.log("checkForUpdates...",[s.id,n]),s.id===n)return;await this.displayUpdateNews(s),S.set(e.lastUpdateId.tag,s.id),g.log("checkForUpdates SUCCESS",[s.id])}catch(t){g.warn("checkForUpdates | Failed to check for updates",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<video src="${e.videoUrl}" alt="Update Preview" />`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}}L(Gt,"UPDATE_NEWS_URL","https://raw.githubusercontent.com/crlngn/crlngn-ui/main/news/module-updates.json");var _e;const ke=class ke{static init(){Hooks.once(R.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(W),g.log("Initiating module...",[],!0),Hooks.on(R.RENDER_CHAT_MESSAGE,d(ke,_e)),S.registerSettings(),D.init(),ee.init(),pt.init(),ut.init(),Le.init(),D.navFoldersEnabled&&re.registerHooks(),Gt.init()}),Hooks.once(R.READY,()=>{g.log("Core Ready",[]);const e=C();var t=S.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Ye.init(),D.checkSceneNavCompat(),S.get(e.enableChatStyles.tag)&&ke.addCSSLocalization(),S.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";T.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),T.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),T.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),T.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),T.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),T.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),T.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),T.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),T.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),T.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};_e=new WeakMap,N(ke,_e,(e,t)=>{g.log(R.RENDER_CHAT_MESSAGE,[e,t]),Le.enrichCard(e,t)});let gt=ke;gt.init();
//# sourceMappingURL=crlngn-ui.js.map
