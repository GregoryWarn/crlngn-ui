var je=Object.defineProperty;var ze=C=>{throw TypeError(C)};var Ve=(C,e,t)=>e in C?je(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var R=(C,e,t)=>Ve(C,typeof e!="symbol"?e+"":e,t),Ne=(C,e,t)=>e.has(C)||ze("Cannot "+t);var m=(C,e,t)=>(Ne(C,e,"read from private field"),t?t.call(C):e.get(C)),b=(C,e,t)=>e.has(C)?ze("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(C):e.set(C,t),E=(C,e,t,n)=>(Ne(C,e,"write to private field"),n?n.call(C,t):e.set(C,t),t),M=(C,e,t)=>(Ne(C,e,"access private method"),t);const v={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},O="crlngn-ui",ue=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],pe=class pe{static log(e="",t=[],n=!1){try{const o=pe.debugOn;if(!(n||o))return;console.log(...ue,e,...t)}catch{console.log(...ue,e,...t)}}static warn(e="",t=[]){console.warn(...ue,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ue,e)}};R(pe,"debugOn",!1);let c=pe;const N={select:"select",checkbox:"checkbox",text:"text",number:"number"},k={client:"client",world:"world"},de={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},ee={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}};function f(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFont:'"Work Sans", Arial, sans-serif',uiTitles:'"Roboto Slab", Arial, sans-serif',journalBody:'"Work Sans", Arial, sans-serif',journalTitles:'"Roboto Slab", Arial, sans-serif'},scope:k.world,config:!1,requiresReload:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:N.button,fields:{enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox},borderColor:{tag:"border-color",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),inputType:N.select,options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")}},enforceDarkMode:{restricted:!0,tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox}},default:{enableChatStyles:!0,borderColor:ee.playerColor.name},scope:k.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:{bottomBuffer:{tag:"control-bottom-buffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),inputType:N.number},iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox},hideFoundryLogo:{tag:"hide-foundry-logo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:N.checkbox}},default:{bottomBuffer:200,iconSize:de.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:k.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:k.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:k.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:k.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:k.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:k.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:k.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:N.text,propType:String,default:"Work Sans",scope:k.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text,propType:String,default:"Roboto Slab",scope:k.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text,propType:String,default:"Work Sans",scope:k.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text,propType:String,default:"Roboto Slab",scope:k.world,config:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:k.world,config:!1}}}const{ApplicationV2:Ye,HandlebarsApplicationMixin:Xe}=foundry.applications.api;var K,we,De;const H=class H extends Xe(Ye){static get DEFAULT_OPTIONS(){return{id:f().cameraDockMenu.tag,actions:{redefine:M(H,K,De)},form:{handler:M(H,K,we),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=f(),n={...p.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};K=new WeakSet,we=async function(e,t,n){const o=f();let s=p.get(o.cameraDockMenu.tag),a=s.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await p.set(o.cameraDockMenu.tag,i),s=p.get(o.cameraDockMenu.tag),c.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,i,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.enableFloatingDock!=a&&location.reload()},De=async function(e,t){const n=f(),s=this.element.querySelectorAll("input, select"),a=n.cameraDockMenu.default;s.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.cameraDockMenu.default])},b(H,K),R(H,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Se=H;const{ApplicationV2:Ke,HandlebarsApplicationMixin:Ze}=foundry.applications.api;var Z,Ue,Ae;const $=class $ extends Ze(Ke){static get DEFAULT_OPTIONS(){return{id:f().chatMessagesMenu.tag,actions:{redefine:M($,Z,Ae)},form:{handler:M($,Z,Ue),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=f(),n={...p.get(t.chatMessagesMenu.tag),enforceDarkMode:p.get(t.enforceDarkMode.tag),default:{...t.chatMessagesMenu.default,enforceDarkMode:t.enforceDarkMode.default||null},isGM:game.user.isGM,fields:{...t.chatMessagesMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=f(),o=p.get(n.chatMessagesMenu.tag);c.log("_onRender",[e,t,o])}};Z=new WeakSet,Ue=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(n.object);c.log("Saving settings:",[s]),(s.bottomBuffer===void 0||s.bottomBuffer==="")&&(s.bottomBuffer=o.chatMessagesMenu.default.bottomBuffer);const a=p.get(o.chatMessagesMenu.tag),i=a.borderColor;s.enforceDarkMode===void 0&&delete s.enforceDarkMode;const g=[];Object.entries(s).forEach(S=>{c.log("menuSettings",[S]),o.chatMessagesMenu.default[S[0]]&&g.push(S[1])}),c.log("menuSettings",[g]),await p.set(o.chatMessagesMenu.tag,s),await p.set(o.enforceDarkMode.tag,s.enforceDarkMode);const u=p.get(o.chatMessagesMenu.tag);c.log("Saving settings:",[a,s,u]),u.borderColor!==i&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ae=async function(e,t){const n=f(),s=this.element.querySelectorAll("input, select"),a={...n.chatMessagesMenu.default,enforceDarkMode:n.enforceDarkMode.default};s.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[a])},b($,Z),R($,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let be=$;class z{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getAllFonts(){var a;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i),o=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){let g="";if(i.ownerNode.tagName==="STYLE")g=i.ownerNode.textContent;else if(i.ownerNode.tagName==="LINK")try{if((a=i.href)!=null&&a.startsWith(window.location.origin)){const h=i.cssRules||i.rules;g=Array.from(h).map(y=>y.cssText).join(`
`)}}catch(h){c.warn("Could not read stylesheet rules:",[h])}const u=/@import\s+url\(['"]([^'"]+)['"]\)/g;let S;for(;(S=u.exec(g))!==null;){const h=S[1];if(h.includes("fonts.googleapis.com")){const y=h.match(/family=([^&]+)/);y&&decodeURIComponent(y[1]).split("|").map(D=>D.split(":")[0].replace(/\+/g," ")).forEach(D=>{o.add(D)})}else try{fetch(h).then(y=>y.text()).then(y=>{(y.match(/@font-face\s*{[^}]+}/g)||[]).forEach(D=>{const Pe=D.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(Pe){const We=Pe[1].trim();o.add(We)}})}).catch(y=>console.warn("Error loading imported CSS:",y))}catch(y){c.warn("Error processing imported CSS:",[y])}}}if(!i.href||i.href.startsWith(window.location.origin))try{const g=i.cssRules||i.rules;for(const u of g)if(u instanceof CSSFontFaceRule){const S=u.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();o.add(S)}}catch(g){c.warn("Could not read stylesheet rules:",[g])}}catch(g){c.warn("Error processing stylesheet:",[g])}return c.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!i.includes("FontAwesome")&&!i.includes("Font Awesome")).map(i=>i.replace(/['"`]/g,"").trim()).sort((i,g)=>i.toLowerCase().localeCompare(g.toLowerCase()))}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(o=>typeof e[o]=="function"&&o!=="constructor"&&o!=="prototype"&&o!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(o=>{const s=e[o];e[o]=function(...a){return console.log(`TEST: Executing: ${e.name}.${o}`),s.apply(this,a)}});const n=Object.getOwnPropertyNames(e.prototype).filter(o=>typeof e.prototype[o]=="function"&&o!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,n),n.forEach(o=>{const s=e.prototype[o];e.prototype[o]=function(...a){return console.log(`TEST: Executing: ${e.name}.${o}`),s.apply(this,a)}})}}R(z,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Je,HandlebarsApplicationMixin:Qe}=foundry.applications.api;var q,A,Oe,xe,Fe;const w=class w extends Qe(Je){static get DEFAULT_OPTIONS(){return{id:f().customFontsMenu.tag,actions:{redefine:M(w,A,Fe)},form:{handler:M(w,A,Oe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=f(),n=p.get(t.customFontsMenu.tag),o=t.customFontsMenu.fields,s={},a={},i={};return o.forEach(u=>{if(c.log("_prepareContext",[t[u].oldName,n]),t[u]){const S=p.get(t[u].tag);s[u]=t[u],a[u]=S||n[t[u].oldName]||t[u].default,i[u]=t[u].default}}),{...a,default:{...i},fontList:z.getAllFonts(),fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){E(w,q,this.element),m(w,q).querySelectorAll('input[type="text"]').forEach(s=>{const a=s.closest(".dropdown-wrapper"),i=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!i)return;const g=()=>{var u;M(u=w,A,xe).call(u),i.classList.add("active")};s.addEventListener("focus",g),s.addEventListener("click",g),s.addEventListener("keydown",u=>{const S=i.classList.contains("active"),h=Array.from(i.querySelectorAll(".dropdown-option"));let y=h.findIndex(T=>T.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),S||i.classList.add("active"),h.forEach(T=>T.classList.remove("highlighted")),y===-1?y=u.key==="ArrowDown"?0:h.length-1:y=u.key==="ArrowDown"?(y+1)%h.length:(y-1+h.length)%h.length,h[y]&&(h[y].classList.add("highlighted"),h[y].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),S&&y!==-1&&h[y]&&h[y].click()):u.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",u=>{a.contains(u.target)||i.classList.remove("active")})}),m(w,q).querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",a=>{const i=s.closest(".dropdown-wrapper").querySelector("input");let g=s.dataset.value;g.includes(" ")&&!g.startsWith('"')?g=`"${g}"`:g.startsWith("&quot;")&&(g=g.replace(/&quot;/g,'"')),i.value=g,s.closest(".dropdown-options").classList.remove("active")})})}};q=new WeakMap,A=new WeakSet,Oe=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,a=foundry.utils.expandObject(n.object);s.forEach(i=>{a[i]&&(c.log("Saving setting:",[a[i]]),p.set(o[i].tag,a[i]))}),p.set(o.customFontsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},xe=function(){m(w,q).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Fe=async function(e,t){const n=f(),s=this.element.querySelectorAll("input[type=text]");p.get(n.customFontsMenu.tag);const a=n.customFontsMenu.fields,i={};a.forEach(g=>{n[g]&&(n[g],i[g]=n[g].default)}),s.forEach(g=>{g.value=i[g.name]})},b(w,A),b(w,q),R(w,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ce=w;const{ApplicationV2:_e,HandlebarsApplicationMixin:et}=foundry.applications.api;var J,qe,Be;const W=class W extends et(_e){static get DEFAULT_OPTIONS(){return{id:f().leftControlsMenu.tag,actions:{redefine:M(W,J,Be)},form:{handler:M(W,J,qe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=f(),n={...p.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=f(),o=p.get(n.leftControlsMenu.tag);c.log("_onRender",[e,t,o])}};J=new WeakSet,qe=async function(e,t,n){const o=f();e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(n.object);(s.bottomBuffer===void 0||s.bottomBuffer==="")&&(s.bottomBuffer=o.leftControlsMenu.default.bottomBuffer);const a=p.get(o.leftControlsMenu.tag);a.hideFoundryLogo===void 0&&(s.hideFoundryLogo=o.leftControlsMenu.default.hideFoundryLogo),await p.set(o.leftControlsMenu.tag,s);const i=p.get(o.leftControlsMenu.tag);c.log("Saving settings:",[a,s,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Be=async function(e,t){const n=f(),s=this.element.querySelectorAll("input, select"),a=n.leftControlsMenu.default;s.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.leftControlsMenu.default])},b(W,J),R(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Me=W;const{ApplicationV2:tt,HandlebarsApplicationMixin:nt}=foundry.applications.api;var Q,He,$e;const j=class j extends nt(tt){static get DEFAULT_OPTIONS(){return{id:f().sceneNavMenu.tag,actions:{redefine:M(j,Q,$e)},form:{handler:M(j,Q,He),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=f(),n={...p.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};Q=new WeakSet,He=async function(e,t,n){const o=f();let s=p.get(o.sceneNavMenu.tag),a=s.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await p.set(o.sceneNavMenu.tag,i),s=p.get(o.sceneNavMenu.tag),c.log("Saving settings...",[o.sceneNavMenu.tag,t,n.object,i,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.sceneNavEnabled!=a&&location.reload()},$e=async function(e,t){const n=f(),s=this.element.querySelectorAll("input, select"),a=n.sceneNavMenu.default;s.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.sceneNavMenu.default])},b(j,Q),R(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Le=j;function ot(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Ce,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:be,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Me,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Se,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Le,restricted:!1}}}var ne,oe,se,ae,ie,le,ce,I,ve,Re,Ee,Te;const l=class l{static init(){const e=f(),t=p.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(v.RENDER_CAMERA_VIEWS,l.onRenderFloating),c.log("CameraUtil",[t]),l.onRenderFloating()):(Hooks.on(v.RENDER_CAMERA_VIEWS,l.onRenderPlain),l.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var s,a,i;const e=f(),t=p.get(e.cameraDockMenu.tag);(s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-ui"),l.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");c.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),l.cameraContainer&&o&&n&&((a=l.cameraContainer)==null||a.insertBefore(n,o),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),l.makeDraggable(),l.makeResizeable(),l.resetPositionAndSize(),l.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(c.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=l.cameraContainer)==null||e.addEventListener("mousedown",t=>{var s,a;const n=document.querySelector("body.crlngn-ui");if(c.log("mousedown",[t.target]),(s=t.target.parentNode)!=null&&s.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",M(l,I,Re)),n==null||n.addEventListener("mouseup",M(l,I,ve));const o=z.getOffsetBottom(l.cameraContainer);l.isDragging=!0,E(l,ne,t.clientX-((a=l.cameraContainer)==null?void 0:a.offsetLeft)),E(l,oe,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(l.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),l.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),l.isResizing=!0,E(l,se,n.clientX),E(l,ae,n.clientY),E(l,ce,parseInt(getComputedStyle(l.cameraContainer).bottom)||0),E(l,ie,l.cameraContainer.offsetWidth),E(l,le,l.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",M(l,I,Ee)),e==null||e.addEventListener("mouseup",M(l,I,Te))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const s=f(),a=p.get(s.cameraDockMenu.tag);if(!(!a.enableFloatingDock||!l.cameraContainer))if(!e&&!t&&!n&&!o){const i=a.dockPosX||0,g=a.dockPosY||0,u=a.dockWidth||0,S=a.dockHeight||0;l.cameraContainer.style.left=`${i}px`,l.cameraContainer.style.bottom=`${g}px`,l.cameraContainer.style.width=`${u}px`,l.cameraContainer.style.height=`${S}px`}else e&&(l.cameraContainer.style.left=`${e}px`),t&&(l.cameraContainer.style.bottom=`${t}px`),n&&(l.cameraContainer.style.width=`${n}px`),o&&(l.cameraContainer.style.height=`${o}px`)}};ne=new WeakMap,oe=new WeakMap,se=new WeakMap,ae=new WeakMap,ie=new WeakMap,le=new WeakMap,ce=new WeakMap,I=new WeakSet,ve=function(e){var o,s;const t=f(),n={...p.get(t.cameraDockMenu.tag)};if(l.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=l.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=l.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),p.set(t.cameraDockMenu.tag,n),a==null||a.removeEventListener("mousemove",M(l,I,Re)),a==null||a.removeEventListener("mouseup",M(l,I,ve)),l.isDragging=!1,e.stopPropagation()}},Re=function(e){if(l.isDragging&&(c.log("mousemove",[e.target.parentNode]),l.cameraContainer)){let t=e.clientX-m(l,ne),n=window.innerHeight-e.clientY-m(l,oe);t+l.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-l.cameraContainer.offsetWidt),l.cameraContainer.style.left=`${t}px`,n+l.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-l.cameraContainer.offsetHeight),l.cameraContainer.style.bottom=`${n}px`}},Ee=function(e){if(!l.isResizing)return;const t=m(l,ie)+(e.clientX-m(l,se)),n=e.clientY-m(l,ae),o=m(l,le)+n,s=m(l,ce)-n;l.cameraContainer.style.width=`${t}px`,l.cameraContainer.style.height=`${o}px`,l.cameraContainer.style.bottom=`${s}px`},Te=function(){var o,s,a,i,g,u;const e=f(),t={...p.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");l.isResizing=!1,n==null||n.removeEventListener("mousemove",M(l,I,Ee)),n==null||n.removeEventListener("mouseup",M(l,I,Te)),c.log("onStopResize",[(o=l.cameraContainer)==null?void 0:o.style.width,(s=l.cameraContainer)==null?void 0:s.style.height,(a=l.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((i=l.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((g=l.cameraContainer)==null?void 0:g.style.height)||0),t.dockPosY=parseInt(((u=l.cameraContainer)==null?void 0:u.style.bottom)||0),p.set(e.cameraDockMenu.tag,t)},b(l,I),b(l,ne,0),b(l,oe,0),R(l,"isDragging",!1),R(l,"cameraContainer"),R(l,"isResizing",!1),b(l,se,0),b(l,ae,0),b(l,ie,0),b(l,le,0),b(l,ce,0);let F=l;const _=class _{static init(){const e=f();_.chatMsgSettings=p.get(e.chatMessagesMenu.tag)}static enrichCard(e,t){var o,s,a,i,g,u,S,h;const n=_.chatMsgSettings;if(n!=null&&n.enableChatStyles){const y=((a=(s=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:s.activity)==null?void 0:a.type)||((u=(g=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:g.roll)==null?void 0:u.type)||"custom";let T=t.get?t.get(0):t;T.classList.add(y),c.log("enrichCard",[n.borderColor,ee.playerColor.name,(S=e.author)==null?void 0:S.id]),n.borderColor===ee.playerColor.name&&((h=e.author)!=null&&h.id)&&T.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}}};R(_,"chatMsgSettings");let te=_;var G,P,B,Y,X,Ie,me,ye;const d=class d{static init(){const e=f();d.navSettings=p.get(e.sceneNavMenu.tag),d.isCollapsed=p.get(e.sceneNavCollapsed.tag),d.navPos=p.get(e.sceneNavPos.tag);const t=document.querySelector("#ui-middle");let n=d.navSettings;if(n.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}d.resetLocalVars();const o=z.isModuleOn("monks-scene-navigation");o&&n.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),p.set(e.sceneNavMenu.tag,{...n,sceneNavEnabled:!1})),c.log("TopNavigation - init",[o]),o?t.classList.add("with-monks-scene"):(d.resetLocalVars(),d.addListeners(),c.log(v.RENDER_SCENE_NAV,[]),d.setNavPosition(0),d.placeNavButtons()),Hooks.on(v.RENDER_SCENE_NAV,()=>{f();const s=z.isModuleOn("monks-scene-navigation");c.log(v.RENDER_SCENE_NAV,[s]),s||(d.resetLocalVars(),c.log(v.RENDER_SCENE_NAV,[]),d.placeNavButtons(),d.setNavPosition(),d.addListeners())}),Hooks.on(v.COLLAPSE_SIDE_BAR,s=>{const a=z.isModuleOn("monks-scene-navigation");c.log(v.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",a]),a||d.placeNavButtons()}),Hooks.on(v.COLLAPSE_SCENE_NAV,(s,a)=>{const i=f();p.set(i.sceneNavCollapsed.tag,a),c.log("NAV toggle",[s,a]);const g=document.querySelector("#ui-middle");a?g.classList.add("navigation-collapsed"):g.classList.remove("navigation-collapsed")}),Hooks.on(v.EXPAND_SCENE_NAV,(s,a)=>{c.log("NAV expand",[s,!1])}),window.addEventListener("resize",()=>{z.isModuleOn("monks-scene-navigation")||d.placeNavButtons()}),c.log("TopNavigation - init",[n.sceneNavEnabled])}static resetLocalVars(){E(d,G,document.querySelector("#navigation")),E(d,P,document.querySelector("#scene-list")),E(d,Y,document.querySelector("#navigation .nav-item.is-root")),E(d,X,document.querySelector("#nav-toggle"))}static addListeners(){var e,t;(e=m(d,G))==null||e.addEventListener("mouseenter",()=>{var s;if(c.log("TopNavigation mouseenter",[]),!d.isCollapsed||!((s=d.navSettings)!=null&&s.showNavOnHover))return;clearTimeout(m(this,B));const n=document.querySelector("#scene-list");n&&(n.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=m(this,G))==null||t.addEventListener("mouseleave",o=>{var s;if(c.log("TopNavigation mouseleave",[]),!(!d.isCollapsed||!((s=d.navSettings)!=null&&s.showNavOnHover))){if(!o)var o=window.event;o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),E(this,B,setTimeout(()=>{clearTimeout(m(this,B)),E(this,B,null);const a=document.querySelector("#scene-list");a&&(a.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var i,g,u,S,h,y,T;d.resetLocalVars();const e=(i=m(this,G))==null?void 0:i.querySelectorAll("button.crlngn-nav"),t=((g=m(this,P))==null?void 0:g.scrollWidth)>=((u=m(this,G))==null?void 0:u.offsetWidth);if(c.log("placeNavButtons",[t,e,(S=m(this,P))==null?void 0:S.scrollWidth,(h=m(this,G))==null?void 0:h.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),n.addEventListener("click",m(this,me)),n.append(o);const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-right");const a=document.createElement("i");a.classList.add("fa"),a.classList.add("fa-chevron-right"),s.append(a),s.addEventListener("click",m(this,ye)),(y=m(this,G))==null||y.appendChild(n),(T=m(this,G))==null||T.appendChild(s)}static setNavPosition(e){var a,i;const t=f();if(!m(this,P))return;const n=e!==void 0?e:d.navPos||0,o=((a=m(this,P))==null?void 0:a.querySelectorAll("li.nav-item"))||[],s=((i=o[n])==null?void 0:i.offsetLeft)*-1;m(this,P).style.marginLeft=s+"px",p.set(t.sceneNavPos.tag,n),c.log("setNavPosition",[e,n,o[n],s])}};G=new WeakMap,P=new WeakMap,B=new WeakMap,Y=new WeakMap,X=new WeakMap,Ie=new WeakMap,me=new WeakMap,ye=new WeakMap,b(d,G),b(d,P),b(d,B),b(d,Y),b(d,X),b(d,Ie),R(d,"SETTINGS"),R(d,"navSettings"),R(d,"isCollapsed"),R(d,"navPos"),b(d,me,e=>{var S,h,y,T,D;const t=(S=m(d,X))==null?void 0:S.offsetWidth,n=z.isModuleOn("compact-scene-navigation")?(h=m(d,Y))==null?void 0:h.offsetWidth:0,o=(y=m(d,P))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),s=((T=m(d,P))==null?void 0:T.querySelectorAll("li.nav-item"))||[],a=o.offsetWidth,i=d.navPos||0,g=Math.floor((((D=m(d,G))==null?void 0:D.offsetWidth)-(i===0?n:0)-t*2)/a);c.log("onNavLast",["currPos",i,g]);let u=i-g;u=u<0?0:u,c.log("onNavLast",["sceneCount",s.length,i,u]),d.setNavPosition(u)}),b(d,ye,e=>{var S,h,y,T,D;f();const t=(S=m(d,X))==null?void 0:S.offsetWidth,n=z.isModuleOn("compact-scene-navigation")?(h=m(d,Y))==null?void 0:h.offsetWidth:0,o=(y=m(d,P))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),s=((T=m(d,P))==null?void 0:T.querySelectorAll("li.nav-item:not(.is-root)"))||[],a=o.offsetWidth,i=d.navPos||0,g=Math.floor((((D=m(d,G))==null?void 0:D.offsetWidth)-(i===0?n:0)-t*2)/a);c.log("onNavLast",["currPos",i,g]);let u=i+g;u=u>s.length?s.length:u,d.setNavPosition(u)});let V=d;const r=class r{static registerSettings(){const e=f();document.querySelector("body").classList.add(O),Object.entries(e).forEach(async s=>{const a=s[1];c.log("Registering... ",[s]);const i={name:a.label,hint:a.hint,default:a.default,type:a.propType,scope:a.scope,config:a.config,requiresReload:a.requiresReload||!1,onChange:g=>r.apply(a.tag,g)};a.choices&&(i.choices=a.choices),await game.settings.register(O,a.tag,i),r.get(a.tag)===void 0&&r.set(a.tag,a.default),c.log("registerSettings",[a.tag,r.get(a.tag)])}),Object.entries(ot()).forEach(async s=>{const a=s[1],i={name:a.tag,label:a.label,hint:a.hint,icon:a.icon,type:a.propType,restricted:a.restricted};await game.settings.registerMenu(O,a.tag,i)}),Hooks.on(v.RENDER_SCENE_CONTROLS,r.applyLeftControlsSettings),Hooks.on(v.RENDER_PLAYERS_LIST,r.applyPlayersListSettings),Hooks.on(v.RENDER_HOTBAR,()=>{r.firstLoad&&(r.firstLoad=!1,r.applyHotBarCollapse()),r.applyHotBarSettings()}),r.applySceneNavPos(),r.applyChatStyles(),r.applyBorderColors(),e.customFontsMenu.fields.forEach(s=>{r.applyCustomFonts(e[s].tag)}),r.applyLeftControlsSettings(),r.applyControlIconSize(),r.applyControlsBuffer(),r.applyDebugSettings()}static get(e,t=O){if(!e)return null;let n=!1;if(t===O)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,c.log("GET Setting",[s,n])}return n}static set(e,t,n=O){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),c.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{c.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){const n=f();switch(t===void 0&&(t=r.get(e)),c.log("SettingsUtil.apply",[e,t,r.get(e)]),e){case n.enableMacroLayout.tag:r.applyHotBarSettings();break;case n.collapseMacroBar.tag:r.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:r.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:c.log("SettingsUtil.apply",[e]),r.applyCustomFonts(e,t);break;case n.leftControlsMenu.tag:r.applyLeftControlsSettings(),r.applyControlIconSize(),r.applyControlsBuffer();break;case n.cameraDockMenu.tag:r.applyCameraPosX(),r.applyCameraPosY(),r.applyCameraWidth(),r.applyCameraHeight();break;case n.chatMessagesMenu.tag:te.chatMsgSettings=r.get(n.chatMessagesMenu.tag),r.applyBorderColors(),r.applyChatStyles();break;case n.enforceDarkMode.tag:r.resetFoundryThemeSettings();break;case n.debugMode.tag:r.applyDebugSettings();break;case n.sceneNavMenu.tag:V.navSettings=r.get(n.sceneNavMenu.tag);break;case n.sceneNavCollapsed.tag:V.isCollapsed=r.get(n.sceneNavCollapsed.tag);break}}static applyBorderColors(){const e=f(),t=r.get(e.chatMessagesMenu.tag);t.borderColor===ee.playerColor.name?(document.querySelector("body").classList.add("player-chat-borders"),document.querySelector("body").classList.remove("roll-chat-borders")):t.borderColor===ee.rollType.name?(document.querySelector("body").classList.add("roll-chat-borders"),document.querySelector("body").classList.remove("player-chat-borders")):(document.querySelector("body").classList.remove("player-chat-borders"),document.querySelector("body").classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=f();r.get(e.chatMessagesMenu.tag).enableChatStyles&&document.querySelector("body").classList.add("crlngn-chat")}static applyHotBarSettings(){const e=f(),t=r.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=f();r.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=f(),t=r.get(e.leftControlsMenu.tag),n=r.get(e.sceneNavMenu.tag),o=document.querySelector("#ui-left"),s=document.querySelector("#ui-left #logo");t.autoHideSecondary?o.classList.add("auto-hide"):o.classList.remove("auto-hide");const a=document.querySelector("body.crlngn-ui"),i=window.getComputedStyle(a),g=parseFloat(i.getPropertyValue("--top-nav-height"));t.hideFoundryLogo===void 0||t.hideFoundryLogo===!0?(s.classList.remove("visible"),a.style.setProperty("--ui-top-padding",`${g}px`),document.querySelector("body").classList.remove("logo-visible")):(s.classList.add("visible"),n.sceneNavEnabled?(a.style.setProperty("--ui-top-padding",`${72+g}px`),document.querySelector("body").classList.add("logo-visible")):a.style.setProperty("--ui-top-padding","72px"))}static applyControlIconSize(){const e=f(),t=r.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=t.iconSize==de.small.name?de.small.size:de.regular.size;n.style.setProperty("--left-control-item-size",o)}static applyControlsBuffer(){const e=f(),t=r.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;n.style.setProperty("--controls-bottom-buffer",`${o||0}px`)}static applyPlayersListSettings(){var t,n;const e=f();c.log("applyPlayersListSettings",[document.querySelector("#players"),r.get(e.autoHidePlayerList.tag)]),r.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),fe.checkPlayersList()}static applySceneNavPos(){const e=f();r.set(e.sceneNavPos.tag,0),V.navPos=0}static applyCameraPosX(e){const t=f(),n=r.get(t.cameraDockMenu.tag),o=e||n.dockPosX;F.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=f(),n=r.get(t.cameraDockMenu.tag),o=e||n.dockPosY;F.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=f(),n=r.get(t.cameraDockMenu.tag),o=e||n.dockWidth;F.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=f(),n=r.get(t.cameraDockMenu.tag),o=e||n.dockHeight;F.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=f(),o=n.customFontsMenu.fields,s={};o.forEach(i=>{s[i]=r.get(n[i].tag)}),c.log("applyCustomFonts",[e,t]);const a=document.querySelector("body.crlngn-ui");switch(e){case n.uiFontBody.tag:a.style.setProperty("--crlngn-font-family",t||s.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:a.style.setProperty("--crlngn-font-titles",t||s.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:a.style.setProperty("--crlngn-font-journal-body",t||s.journalFontBody||s.journalFontBody||"");break;case n.journalFontTitles:a.style.setProperty("--crlngn-font-journal-title",t||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=f(),t=z.isModuleOn("monks-player-settings"),n=z.isModuleOn("force-client-settings"),o=r.get(e.enforceDarkMode.tag);if(o&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),r.set(e.enforceDarkMode.tag,!1));return}if(o&&n){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),r.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","colorScheme");c.log("resetFoundryThemeSettings",[s,o]),!s&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=f();c.debugOn=e||r.get(t.debugMode.tag)}};R(r,"firstLoad",!0);let p=r;class Ge{static init(){Hooks.on(v.RENDER_PLAYERS_LIST,Ge.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var U,re,ge;const L=class L{static init(){c.log("LeftControls - init",[]),Hooks.on(v.RENDER_SCENE_CONTROLS,L.initSceneControls),L.initSceneControls()}static resetLocalVars(){E(L,U,document.querySelector("#ui-left #controls")),E(L,re,document.querySelector("#ui-left"))}static initSceneControls(){c.log("initSceneControls",[]),L.resetLocalVars(),L.observeControlsWidth()}static observeControlsWidth(){if(c.log("observeControlsWidth",[]),!m(L,U))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};E(L,ge,new ResizeObserver(n=>{t(()=>L.updateCSSVars(),250)},{box:"border-box"})),m(L,ge).observe(m(L,U)),L.updateCSSVars()}static updateCSSVars(){if(!m(L,U))return;let e=Number(m(L,re).offsetWidth),t=Number(m(L,U).offsetWidth),n=-e+t+24;if(c.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const o=document.querySelector("body.crlngn-ui");o==null||o.style.setProperty("--ui-controls-margin-left",n+"px")}}};U=new WeakMap,re=new WeakMap,ge=new WeakMap,b(L,U),b(L,re),b(L,ge);let ke=L;class st{static init(){const e=z.isModuleOn("foundry-taskbar"),t=document.querySelector("body.crlngn-ui");e&&game.settings.get("foundry-taskbar","reduceSidebar")?t.style.setProperty("--crlngn-sidebar-bottom","50px"):t.style.setProperty("--crlngn-sidebar-bottom","0px")}}var he;const x=class x{static init(){Hooks.once(v.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(O),c.log("Initiating module",[],!0),p.registerSettings(),Hooks.on(v.RENDER_CHAT_MESSAGE,m(x,he)),Hooks.on(v.RENDER_PLAYERS_LIST,x.checkPlayersList)}),Hooks.once(v.READY,()=>{const e=f();var t=p.get("debug-mode");t&&(CONFIG.debug.hooks=!0);const n=CONFIG.fontFamilies||[],o=p.get("fonts","core");c.log("Core Ready",[CONFIG,n,o]),V.init(),F.init(),Ge.init(),ke.init(),te.init(),st.init(),p.get(e.chatMessagesMenu.tag).enableChatStyles&&x.addCSSLocalization(),p.resetFoundryThemeSettings()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}};he=new WeakMap,b(x,he,(e,t)=>{c.log(v.RENDER_CHAT_MESSAGE,[e,t]),te.enrichCard(e,t)}),R(x,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#ui-left #players"),n=z.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1;c.log("checkPlayersList",[o,n,game.settings]),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players"),e.classList.remove("players-hidden")):o?(e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"),e.classList.remove("players-hidden"))});let fe=x;fe.init();
//# sourceMappingURL=crlngn-ui.js.map
