var Ra=Object.defineProperty;var Ao=l=>{throw TypeError(l)};var ka=(l,e,t)=>e in l?Ra(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var h=(l,e,t)=>ka(l,typeof e!="symbol"?e+"":e,t),Gn=(l,e,t)=>e.has(l)||Ao("Cannot "+t);var y=(l,e,t)=>(Gn(l,e,"read from private field"),t?t.call(l):e.get(l)),T=(l,e,t)=>e.has(l)?Ao("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),D=(l,e,t,n)=>(Gn(l,e,"write to private field"),n?n.call(l,t):e.set(l,t),t),U=(l,e,t)=>(Gn(l,e,"access private method"),t);const P={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_TOKEN_HUD:"renderTokenHUD"},x="crlngn-ui",fn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Rn=class Rn{static log(e="",t=[],n=!1){try{const o=Rn.debugOn;if(!(n||o))return;console.log(...fn,e,...t)}catch{console.log(...fn,e,...t)}}static warn(e="",t=[]){console.warn(...fn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...fn,e)}};h(Rn,"debugOn",!1);let u=Rn;const Ma={select:"select",checkbox:"checkbox",text:"text",number:"number"},L={client:"client",world:"world"},Dt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},vt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},De={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},zn=140,oe=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(130, 110, 160)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function S(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:L.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!0,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1},scope:L.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:L.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",customStyles:""},scope:L.world,config:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:vt.playerColor.name,useLeftChatBorder:!0},scope:L.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:L.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:L.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:De.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:L.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:L.client,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:L.client,config:!0,default:!1},navFoldersEnabled:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavItemWidth:{tag:"v2-scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,default:"",scope:L.client,config:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:String,default:!0,scope:L.world,config:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:L.client,config:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:L.client,config:!0},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"",scope:L.world,config:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!1,scope:L.world,config:!1},otherModulesList:{tag:"v2-other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:L.world,config:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:L.world,config:!1},chatBorderColor:{tag:"v2-chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:vt.playerColor.name,scope:L.client,config:!1},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:Ma.checkbox,default:!0,scope:L.client,config:!1},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:L.client,config:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:L.client,config:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:L.client,config:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:L.client,config:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:De.horizontal.name,scope:L.client,config:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:L.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:L.world,config:!1,default:""},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:L.client,config:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:L.client,config:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:L.client,config:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:L.client,config:!1},cameraDockFadeOut:{tag:"v2-camera-dock-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!0,scope:L.client,config:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:L.client,config:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:L.client,config:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:L.client,config:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:L.client,config:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:L.client,config:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:L.client,config:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:L.client,config:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:L.client,config:!1}}}const{ApplicationV2:Oa,HandlebarsApplicationMixin:Aa}=foundry.applications.api;var po,Et,Vo,jo;const Le=class Le extends Aa(Oa){static get DEFAULT_OPTIONS(){return{id:S().playersListMenu.tag,actions:{redefine:U(Le,Et,jo)},form:{handler:U(Le,Et,Vo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=S(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}}),u.log("_prepareContext A",[o,n,a,s]);const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return u.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,u.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Le.element=this.element,Le.element.querySelector(".toggle-hint").addEventListener("click",()=>{Le.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.playersListMenu.tag);u.log("_onRender",[e,t,a])}};po=new WeakMap,Et=new WeakSet,Vo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(u.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},jo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),u.log("#onReset",[e,t,n.playersListMenu.default])},T(Le,Et),T(Le,po),h(Le,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Xn=Le;const{ApplicationV2:Da,HandlebarsApplicationMixin:Pa}=foundry.applications.api;var Nt,Wo,$o,Yt,Jn;const Te=class Te extends Pa(Da){constructor(){super(...arguments);T(this,Yt)}static get DEFAULT_OPTIONS(){return{id:S().cameraDockMenu.tag,actions:{redefine:U(Te,Nt,$o)},form:{handler:U(Te,Nt,Wo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=S(),o=n.cameraDockMenu.fields,a={},s={},i={};o.forEach(d=>{if(u.log("_prepareContext",[n[d].oldName]),n[d]){const p=E.get(n[d].tag);a[d]=n[d],s[d]=p!==void 0?p:n[d].default,i[d]=n[d].default}});const r={...s,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return u.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,u.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;u.log("_onRender",[t,n]),Te.element=this.element,Te.element.querySelector(".toggle-hint").addEventListener("click",()=>{Te.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');u.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",U(this,Yt,Jn).bind(this)),U(this,Yt,Jn).call(this,{target:a}))}};Nt=new WeakSet,Wo=async function(t,n,o){const a=S();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,i=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!i.hasOwnProperty(p)&&(i[p]=!1)});const r=foundry.utils.expandObject(i),c=E.get(a.enableFloatingDock.tag);u.log("Compared settings:",[r.enableFloatingDock,c]),s.forEach(p=>{u.log("Saving setting >>",[a[p].tag,r[p]]),r[p]!==void 0&&E.set(a[p].tag,r[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),r.enableFloatingDock!==c&&location.reload()},$o=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.fields,r={};i.forEach(c=>{o[c]&&(o[c],r[c]=o[c].default)}),s.forEach(c=>{c.value=r[c.name]}),u.log("#onReset",[t,n,o.cameraDockMenu.default])},Yt=new WeakSet,Jn=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(i=>i.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(i=>i.disabled=!t.target.checked),u.log("onDockEnabledChange",[this.element,n,o])},T(Te,Nt),h(Te,"element"),h(Te,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Kn=Te;const{ApplicationV2:Fa,HandlebarsApplicationMixin:Ga}=foundry.applications.api;var mo,Lt,Yo,Xo;const we=class we extends Ga(Fa){static get DEFAULT_OPTIONS(){return{id:S().chatMessagesMenu.tag,actions:{redefine:U(we,Lt,Xo)},form:{handler:U(we,Lt,Yo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var r;const t=S(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(u.log("_prepareContext",[t[c].oldName]),t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),u.log("_prepareContext",[a,s]);const i={...a,default:{...s},isGM:(r=game.user)==null?void 0:r.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return u.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,u.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();we.element=this.element,we.element.querySelector(".toggle-hint").addEventListener("click",()=>{we.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.chatMessagesMenu.tag);u.log("_onRender",[e,t,a])}};mo=new WeakMap,Lt=new WeakSet,Yo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(d=>{o[d].inputType==="checkbox"&&!s.hasOwnProperty(d)&&(s[d]=!1)});const i=foundry.utils.expandObject(s),r=E.get(o.chatBorderColor.tag);u.log("Compared settings:",[i.chatBorderColor,r]),a.forEach(d=>{u.log("Saving setting >>",[o[d].tag,i[d]]),i[d]!==void 0&&E.set(o[d].tag,i[d])}),i.chatBorderColor!==r&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Xo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(we,Lt),T(we,mo),h(we,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Zn=we;const Ht=class Ht{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family");i&&(t.add(i),u.log("Found font-face rule:",[i]))}else if(s instanceof CSSImportRule){if(u.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const r=await(await fetch(s.href)).text();this.extractFontsFromCSSText(r,t)}catch(i){u.warn("Error fetching imported CSS:",[i])}}}}catch(o){if(o.name==="SecurityError"&&e.href){u.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){u.warn("Error fetching cross-origin stylesheet:",[a])}}else u.warn("Error accessing CSS rules:",[o])}}catch(o){u.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];u.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,i=a.match(s);if(i&&i[2]){const r=i[2].trim();t.add(r),u.log("Found font-face in CSS text:",[r])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return u.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return u.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const m=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,m.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const r=o.substring(a+16,s).split(";").map(m=>m.trim()).filter(m=>m!==""),c={};r.forEach(m=>{const b=m.split(":");if(b.length>=2){const C=b[0].trim(),I=b.slice(1).join(":").trim();C&&(c[C]=I)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const d=Object.entries(c).map(([m,b])=>`  ${m}: ${b};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+d+`
}`+o.substring(s+1);n.textContent=p,u.log("addCSSVars",[e,t,n.textContent])}static addCustomCSS(e,t=!0){let n=document.querySelector("#crlngn-ui-custom-css");if(!n){const o=document.querySelector("body");n=document.createElement("style"),n.id="crlngn-ui-custom-css",n.textContent="",o.appendChild(n)}if(!t){n.textContent+=e;return}n.textContent.includes(e)||(n.textContent+=e)}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const i=n==="horizontal",r=i?e.scrollLeft:e.scrollTop,c=t-r;if(c===0)return a&&a(),null;const d=performance.now(),p=b=>{const C=b-d;if(C>=o){i?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const I=C/o,q=I<.5?2*I*I:1-Math.pow(-2*I+2,2)/2;i?e.scrollLeft=r+c*q:e.scrollTop=r+c*q;const V=requestAnimationFrame(p);return e.dataset.scrollAnimationId=V,V},m=requestAnimationFrame(p);return e.dataset.scrollAnimationId=m,m}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const o={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(u.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(o,n),foundry.applications.api.DialogV2.confirm(o)}};h(Ht,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));u.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);u.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const i=s.href||"",r=i.includes("css/")||i.includes("styles/"),c=i.includes("modules/crlngn-ui/"),d=i.includes("systems/");if(i&&!r&&!c&&!d){u.log("Skipping stylesheet:",[i]);continue}u.log("Processing stylesheet:",[s,i]),await Ht.processStyleSheetRules(s,o)}}catch(i){u.warn("Error processing stylesheet:",[i])}return u.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))}),h(Ht,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let A=Ht;const{ApplicationV2:za,HandlebarsApplicationMixin:xa}=foundry.applications.api;var ho,Ke,Ko,Jo,Zo;const le=class le extends xa(za){static get DEFAULT_OPTIONS(){return{id:S().customFontsMenu.tag,actions:{redefine:U(le,Ke,Zo)},form:{handler:U(le,Ke,Ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=S(),n=t.customFontsMenu.fields,o={},a={},s={},i=await A.getAllFonts();return n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:i,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){le.element=this.element,le.element.querySelector(".toggle-hint").addEventListener("click",()=>{le.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),le.element.querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const c=()=>{var d;U(d=le,Ke,Jo).call(d),r.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",d=>{const p=r.classList.contains("active"),m=Array.from(r.querySelectorAll(".dropdown-option"));let b=m.findIndex(C=>C.classList.contains("highlighted"));d.key==="ArrowDown"||d.key==="ArrowUp"?(d.preventDefault(),p||r.classList.add("active"),m.forEach(C=>C.classList.remove("highlighted")),b===-1?b=d.key==="ArrowDown"?0:m.length-1:b=d.key==="ArrowDown"?(b+1)%m.length:(b-1+m.length)%m.length,m[b]&&(m[b].classList.add("highlighted"),m[b].scrollIntoView({block:"nearest"}))):d.key==="Enter"?(d.preventDefault(),p&&b!==-1&&m[b]&&m[b].click()):d.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",d=>{i.contains(d.target)||r.classList.remove("active")})}),le.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const r=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),r.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};ho=new WeakMap,Ke=new WeakSet,Ko=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(u.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Jo=function(){le.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Zo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(le,Ke),T(le,ho),h(le,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Qn=le;const{ApplicationV2:Ua,HandlebarsApplicationMixin:qa}=foundry.applications.api;var yo,Tt,Qo,_o;const Ie=class Ie extends qa(Ua){static get DEFAULT_OPTIONS(){return{id:S().leftControlsMenu.tag,actions:{redefine:U(Ie,Tt,_o)},form:{handler:U(Ie,Tt,Qo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=S(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return u.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,u.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Ie.element=this.element,Ie.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ie.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.leftControlsMenu.tag);u.log("_onRender",[e,t,a])}};yo=new WeakMap,Tt=new WeakSet,Qo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(u.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},_o=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),u.log("#onReset",[e,t,n.leftControlsMenu.default])},T(Ie,Tt),T(Ie,yo),h(Ie,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let _n=Ie;const{ApplicationV2:Ba,HandlebarsApplicationMixin:Ha}=foundry.applications.api;var So,wt,ea,ta,Xt,to;const Re=class Re extends Ha(Ba){constructor(){super(...arguments);T(this,Xt)}static get DEFAULT_OPTIONS(){return{id:S().sceneNavMenu.tag,actions:{redefine:U(Re,wt,ta)},form:{handler:U(Re,wt,ea),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=S(),o=n.sceneNavMenu.fields,a={},s={},i={};o.forEach(c=>{if(n[c]){const d=E.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}});const r={...s,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return u.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,u.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;u.log("_onRender",[t,n]),Re.element=this.element,Re.element.querySelector(".toggle-hint").addEventListener("click",()=>{Re.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');u.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",U(this,Xt,to).bind(this)),U(this,Xt,to).call(this,{target:a}))}};So=new WeakMap,wt=new WeakSet,ea=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=S(),s=a.sceneNavMenu.fields;let i=E.get(a.sceneNavEnabled.tag);const r=foundry.utils.expandObject(o.object);s.forEach(d=>{r[d]!==void 0&&(u.log("Saving setting:",[r[d]]),E.set(a[d].tag,r[d]))});let c=E.get(a.sceneNavEnabled.tag);u.log("Saving settings...",[i,c]),await E.set(a.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i!==c&&location.reload()},ta=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),u.log("#onReset",[t,n,o.sceneNavMenu.default])},Xt=new WeakSet,to=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),u.log("onSceneNavEnabledChange",[this.element,n])},T(Re,wt),T(Re,So),h(Re,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let eo=Re;const{ApplicationV2:Va,HandlebarsApplicationMixin:ja}=foundry.applications.api;var X,bo,vo,Je,na,oa,aa;let Wa=(X=class extends ja(Va){static get DEFAULT_OPTIONS(){return{id:S().themeAndStylesMenu.tag,actions:{redefine:U(X,Je,aa)},form:{handler:U(X,Je,na),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=S(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default,u.log("_prepareContext",[c,d,o[c]])}});const i=oe.find(c=>c.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||oe[0].label;const r={...a,default:{...s},fields:{...o},selectedTheme:i,themes:oe,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,u.log("_preparePartContext",[e,t]),t}_onRender(e,t){X.element=this.element,X.element.querySelector(".toggle-hint").addEventListener("click",()=>{X.element.querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))}),this._themes=oe,X.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(d=>{const p=d.closest(".dropdown-wrapper"),m=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!m)return;const b=()=>{var C;U(C=X,Je,oa).call(C),m.classList.add("active")};d.addEventListener("focus",b),d.addEventListener("click",b),d.addEventListener("keydown",C=>{const I=m.classList.contains("active"),q=Array.from(m.querySelectorAll(".dropdown-option"));let V=q.findIndex(Q=>Q.classList.contains("highlighted"));C.key==="ArrowDown"||C.key==="ArrowUp"?(C.preventDefault(),I||m.classList.add("active"),q.forEach(Q=>Q.classList.remove("highlighted")),V===-1?V=C.key==="ArrowDown"?0:q.length-1:V=C.key==="ArrowDown"?(V+1)%q.length:(V-1+q.length)%q.length,q[V]&&(q[V].classList.add("highlighted"),q[V].scrollIntoView({block:"nearest"}))):C.key==="Enter"?(C.preventDefault(),I&&V!==-1&&q[V]&&q[V].click()):C.key==="Escape"&&m.classList.remove("active")}),document.addEventListener("click",C=>{p.contains(C.target)||m.classList.remove("active")})});const a=X.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(d=>{d.addEventListener("mouseenter",()=>{d.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(m=>m.classList.remove("highlighted")),d.classList.add("highlighted")}),d.addEventListener("click",function(p){u.log("option",[d,d.querySelector(".theme-name")]);const m=d.closest(".dropdown-wrapper").querySelector("input");let b=d.querySelector(".theme-name").innerHTML.toString();if(m.value=b,m.name==="colorTheme"){const I=s._themes.find(q=>q.label===b);s._selectedTheme=I,s._updateThemePreview(I)}d.closest(".dropdown-options").classList.remove("active")})});const i=X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),r=X.element.querySelector("input.otherModulesList");i.forEach(d=>{d.addEventListener("change",p=>{const m=p.currentTarget;let C=`${r.value}`.split(",")||[],I=C.indexOf(m.value);!p.currentTarget.checked&&I>-1?C.splice(I,1):p.currentTarget.checked&&I===-1&&C.push(m.value),r.value=C.join(","),u.log("checkbox changed",[C,r.value])})}),X.element.querySelector("input.adjustOtherModules").addEventListener("change",d=>{X.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(m=>{m.checked=d.currentTarget.checked;const b=new Event("change",{bubbles:!0});m.dispatchEvent(b)})})}_updateThemePreview(e){if(u.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}},bo=new WeakMap,vo=new WeakMap,Je=new WeakSet,na=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),i=oe.find(r=>r.label===s.colorTheme);s.colorTheme=i?i.className:"",a.forEach(r=>{s[r]!==void 0&&E.set(o[r].tag,s[r]),u.log("Saving setting:",[o[r].tag,s[r]])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},oa=function(){X.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},aa=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)});const r=oe.find(c=>c.label===n.colorTheme.default);i.colorTheme=(r==null?void 0:r.label)||oe[0].label,a.forEach(c=>{c.value=i[c.name]})},T(X,Je),T(X,bo),T(X,vo,!1),h(X,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}}),X);const{ApplicationV2:$a,HandlebarsApplicationMixin:Ya}=foundry.applications.api;var Co,It,sa,ia;const ke=class ke extends Ya($a){static get DEFAULT_OPTIONS(){return{id:S().interfaceOptionsMenu.tag,actions:{redefine:U(ke,It,ia)},form:{handler:U(ke,It,sa),closeOnSubmit:!0},position:{width:540,height:"auto"},tag:"form",window:{icon:"fas fa-table",title:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title")}_prepareContext(e){const t=S(),n=t.interfaceOptionsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.save"}]};return u.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,u.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();ke.element=this.element,ke.element.querySelector(".toggle-hint").addEventListener("click",()=>{ke.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.interfaceOptionsMenu.tag);u.log("_onRender",[e,t,a])}};Co=new WeakMap,It=new WeakSet,sa=async function(e,t,n){e.preventDefault(),e.stopPropagation();const o=S(),a=o.interfaceOptionsMenu.fields;let s=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag);const i=foundry.utils.expandObject(n.object);a.forEach(c=>{i[c]!==void 0&&(u.log("Saving setting:",[i[c]]),E.set(o[c].tag,i[c]))});let r=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag),u.log("Saving settings...",[s,r]),await E.set(o.sceneNavMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s!==r&&location.reload()},ia=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.interfaceOptionsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),u.log("#onReset",[e,t,n.interfaceOptionsMenu.default])},T(ke,It),T(ke,Co),h(ke,"PARTS",{content:{template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let no=ke;const{ApplicationV2:Xa,HandlebarsApplicationMixin:Ka}=foundry.applications.api;var Ho,Eo,ot,No,se,ra,la,ca,ao,so,da;const O=class O extends Ka(Xa){constructor(){super(...arguments);h(this,"_onRender",(t,n)=>{S(),O.element=this.element;const o=O.element.querySelectorAll(".toggle-hint");u.log("_onRender",[t,n,this.element]),o.forEach(a=>{a.addEventListener("click",()=>{O.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))})}),O.handleCustomFontFields(),O.handleThemeAndStyleFields(),u.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),o=O.getRestrictedTabs();return game.user.isGM||o.forEach(a=>{delete n[a]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0];const o=S(),a=o.themeAndStylesMenu.fields,s={};a.forEach(c=>{if(o[c]){const d=E.get(o[c].tag);s[c]=d!==void 0?d:o[c].default}});const i=oe.find(c=>c.className===s.colorTheme);u.log("selectedTheme",[i==null?void 0:i.label,oe[0].label]),s.colorTheme=(i==null?void 0:i.label)||oe[0].label,n.selectedTheme=i,n.themes=oe;const r=await A.getAllFonts();return n.fontList=r,n}async _preparePartContext(t,n,o){var i;const a=await super._preparePartContext(t,n,o);t in n.tabs&&(a.tab=a.tabs[t]),S(),io();const s=O.getRestrictedTabs();switch(game.user.isGM||s.forEach(r=>{delete a.tabs[r]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const r=((i=O.PARTS[t])==null?void 0:i.menuKey)||null;if(r){const c=O.getMenuContext(r);if(c.fields&&(a.fields={...a.fields,...c.fields}),c.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...c.fieldDefaults}),c.fieldValues){if(t==="themes"){const d=oe.find(p=>p.className===c.fieldValues.colorTheme);u.log("selectedTheme",[d==null?void 0:d.label,oe[0].label]),c.fieldValues.colorTheme=(d==null?void 0:d.label)||oe[0].label}Object.assign(a,c.fieldValues)}}break}}return u.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var r;const n=S(),o=((r=n[t])==null?void 0:r.fields)||null;if(!o)return{};const a={},s={},i={};return o.forEach(c=>{if(n[c]){const d=E.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}}),{fields:a,fieldValues:s,fieldDefaults:i}}static getRestrictedTabs(){const t=io(),n=[];return Object.entries(t).forEach((o,a)=>{o[0]!=="moduleSettingsMenu"&&o[1].restricted&&n.push(o[0])}),n}changeTab(t,n,o){super.changeTab(t,n,o),D(O,ot,t),u.log("changeTab",[t,n,y(O,ot)])}static handleCustomFontFields(){const t=O.element.querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),i=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!i)return;const r=()=>{var c;U(c=O,se,ao).call(c),i.classList.add("active")};a.addEventListener("focus",r),a.addEventListener("click",r),u.log("handleCustomFontFields",[a,s,i]),a.addEventListener("keydown",U(O,se,so)),document.addEventListener("click",c=>{s.contains(c.target)||i.classList.remove("active")})}),O.element.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let r=a.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),i.value=r,a.closest(".dropdown-options").classList.remove("active")})})}static handleThemeAndStyleFields(){const t=O.element.querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll('input[type="text"]:not([hidden])').forEach(r=>{const c=r.closest(".dropdown-wrapper"),d=c==null?void 0:c.querySelector(".dropdown-options");if(!c||!d)return;const p=()=>{var m;U(m=O,se,ao).call(m),d.classList.add("active")};r.addEventListener("focus",p),r.addEventListener("click",p),r.addEventListener("keydown",U(O,se,so)),document.addEventListener("click",m=>{c.contains(m.target)||d.classList.remove("active")})}),O.element.querySelectorAll(".dropdown-option").forEach(r=>{r.addEventListener("mouseenter",()=>{r.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(d=>d.classList.remove("highlighted")),r.classList.add("highlighted")}),r.addEventListener("click",function(c){var b;u.log("option",[r,r.querySelector(".theme-name")]);const d=r.closest(".dropdown-wrapper").querySelector("input");let p=r.querySelector(".theme-name").innerHTML.toString();if(d.value=p,d.name==="colorTheme"){const C=oe.find(I=>I.label===p);U(b=O,se,da).call(b,C)}r.closest(".dropdown-options").classList.remove("active")})});const a=O.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),s=O.element.querySelector("input.otherModulesList");a.forEach(r=>{r.addEventListener("change",c=>{const d=c.currentTarget;let m=`${s.value}`.split(",")||[],b=m.indexOf(d.value);!c.currentTarget.checked&&b>-1?m.splice(b,1):c.currentTarget.checked&&b===-1&&m.push(d.value),s.value=m.join(","),u.log("checkbox changed",[m,s.value])})}),ThemeAndStyleSettings.element.querySelector("input.adjustOtherModules").addEventListener("change",r=>{ThemeAndStyleSettings.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(d=>{d.checked=r.currentTarget.checked;const p=new Event("change",{bubbles:!0});d.dispatchEvent(p)})})}};Eo=new WeakMap,ot=new WeakMap,No=new WeakMap,se=new WeakSet,ra=async function(t,n,o){let a=!1;const s=S();t.preventDefault(),t.stopPropagation();const c=O.element.querySelector(".form-content.active").dataset.tab;D(O,ot,c);const d=O.PARTS[c].menuKey;if(!d){console.warn("onSubmit",["menuKey not defined"]);return}const p=foundry.utils.expandObject(o.object),m=s[d].fields||[];if(d===O.PARTS.themes.menuKey){const b=oe.find(C=>C.label===p.colorTheme);p.colorTheme=b?b.className:""}m.forEach(b=>{var C;if(p[b]!==void 0){const I=E.set(s[b].tag);u.log("Saving setting:",[b,p[b]]),E.set(s[b].tag,p[b]),(C=s[b])!=null&&C.requiresReload&&I!==p[b]&&(a=!0)}}),u.log("#onSubmit",[t,n,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a&&A.confirmReload()},la=async function(t,n){const o=S(),s=O.element.querySelector(".form-content.active"),i=s.dataset.tab,r=O.PARTS[i].menuKey,c=o[r].default;s.querySelectorAll("input, select").forEach(p=>{p.value=c[p.name],p.type==="checkbox"&&(p.checked=c[p.name])}),u.log("#onReset",[y(O,ot),i,t,n])},ca=function(){const t=[];return Object.entries(O.PARTS).forEach(([n,o])=>{o.menuKey&&t.push({id:n,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${n}`})}),u.log("getTabs",[t]),t},ao=function(){O.element.querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},so=function(t){const n=t.target.closest(".dropdown-wrapper"),o=n==null?void 0:n.querySelector(".dropdown-options"),a=o.classList.contains("active"),s=Array.from(o.querySelectorAll(".dropdown-option"));let i=s.findIndex(r=>r.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||o.classList.add("active"),s.forEach(r=>r.classList.remove("highlighted")),i===-1?i=t.key==="ArrowDown"?0:s.length-1:i=t.key==="ArrowDown"?(i+1)%s.length:(i-1+s.length)%s.length,s[i]&&(s[i].classList.add("highlighted"),s[i].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&i!==-1&&s[i]&&s[i].click()):t.key==="Escape"&&o.classList.remove("active")},da=function(t){if(u.log("Selected theme updated:",[t]),!t)return;this.element.querySelectorAll("span.selected-theme").forEach((o,a)=>{o.style.setProperty("background-color",t.colorPreview[a])})},T(O,se),T(O,Eo),T(O,ot),T(O,No),h(O,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:640,height:"auto"},actions:{redefine:U(O,se,la)},form:{handler:U(O,se,ra),closeOnSubmit:!0}}),h(O,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs"},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs"},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}}),h(O,"TABS",{primary:{initial:"interface",tabs:U(Ho=O,se,ca).call(Ho),labelPrefix:""}});let oo=O;function io(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:oo,restricted:!1},interfaceOptionsMenu:{tab:"interface",tag:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),icon:"fas fa-table-layout",propType:no,restricted:!1},customFontsMenu:{tab:"fonts",tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-font",propType:Qn,restricted:!0},themeAndStylesMenu:{tab:"themes",tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Wa,restricted:!1},chatMessagesMenu:{tab:"chat",tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Zn,restricted:!1},leftControlsMenu:{tab:"controls",tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:_n,restricted:!1},sceneNavMenu:{tab:"scenes",tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:eo,restricted:!1},playersListMenu:{tab:"players",tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-users",propType:Xn,restricted:!1},cameraDockMenu:{tab:"camera",tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Kn,restricted:!1}}}var at,je,Kt,Jt,Zt,Qt,_t,en,tn,nn,st,on,an;const f=class f{static applyFadeOut(e){f.useFadeOut=e}static applyCustomStyle(e){var t;f.enableFloatingDock=e,u.log("applyCustomStyle",[f.enableFloatingDock,ui,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=S();f.enableFloatingDock=E.get(e.enableFloatingDock.tag),f.currSettings={enableFloatingDock:f.enableFloatingDock,defaultVideoWidth:E.get(e.defaultVideoWidth.tag),dockHeight:E.get(e.dockHeight.tag),dockWidth:E.get(e.dockWidth.tag),dockPosX:E.get(e.dockPosX.tag),dockPosY:E.get(e.dockPosY.tag),dockResizeOnUserJoin:E.get(e.dockResizeOnUserJoin.tag)},f.enableFloatingDock?(f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),Hooks.on(P.RENDER_CAMERA_VIEWS,f.onRenderFloating),Hooks.on(P.RENDER_PLAYERS_LIST,f.onRenderPlayersList),Hooks.on(P.CLIENT_SETTING_CHANGED,t=>{u.log("Setting updated",[t]),t.includes("rtcClientSettings")&&f.checkMinimizedState()})):(Hooks.on(P.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(e,t){var n;f.cameraContainer||(f.cameraContainer=document.querySelector("#av-holder")),(n=f.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){S();const o=f.currSettings,a=document.querySelector("#camera-views");if(f.cameraContainer=document.querySelector("#av-holder"),f.cameraContainer)f.cameraContainer.appendChild(a);else{const c=document.createElement("div");f.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}f.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const d=game.users.get(c.dataset.user),p=(d==null?void 0:d.color)||"";u.log("player color",[d,p]),c.style.setProperty("--player-color",p)}),u.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const r=game.settings.get("core","rtcClientSettings");(r==null?void 0:r.hideDock)!==!0?(f.checkMinimizedState(),f.applyDockResize(o.dockResizeOnUserJoin),f.makeDraggable(),f.makeResizeable(),f.applyVideoWidth(),f.resetPositionAndSize()):f.checkMinimizedState()}static onRenderPlayersList(){u.log("onRenderPlayersList")}static applyPositionWithDelay(){f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),f.resetPositionAndSize();let e=0;f.positionIntervalId=setInterval(()=>{f.resetPositionAndSize(),e++,e>=f.positionAttempts&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=S(),n=E.get(t.defaultVideoWidth.tag);let o=e||n;if(o<zn)o=zn,E.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){f.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",o+"px"),s.style.setProperty("--av-width",o+"px")),f.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){S();const a=f.currSettings;if(!f.enableFloatingDock||!f.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){f.checkMinimizedState();return}if(u.log("CameraDock",[a]),!e&&!t&&!n&&!o){const i=a.dockPosX||0,r=a.dockPosY||0;if(f.cameraContainer.style.left=`${i}px`,f.cameraContainer.style.bottom=`${r}px`,f.currSettings.dockResizeOnUserJoin===De.off.name){const c=a.dockWidth||0,d=a.dockHeight||0;f.cameraContainer.style.width=`${c}px`,f.cameraContainer.style.height=`${d}px`}}else e!==null&&(f.cameraContainer.style.left=`${e}px`),t!==null&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===De.horizontal.name?n!==null&&(f.cameraContainer.style.width=`${n}px`):f.currSettings.dockResizeOnUserJoin===De.vertical.name&&o!==null&&(f.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",n=>{var r,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(u.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(r=n.target.parentNode)!=null&&r.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",y(f,en)),a==null||a.addEventListener("mouseup",y(f,tn)),o))return;const s=A.getOffsetBottom(f.cameraContainer);let i=((c=f.cameraContainer)==null?void 0:c.offsetLeft)||0;f.isDragging=!0,D(f,at,n.clientX-i),D(f,je,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,d;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",y(f,nn)),a.addEventListener("touchend",y(f,st)),a.addEventListener("touchcancel",y(f,st)),o))return;const s=n.touches[0],i=A.getOffsetBottom(f.cameraContainer);let r=((d=f.cameraContainer)==null?void 0:d.offsetLeft)||0;f.isDragging=!0,D(f,at,s.clientX-r),D(f,je,window.innerHeight-s.clientY-i),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var r,c;if(!f.cameraContainer)return;const e=S(),t=f.currSettings.dockResizeOnUserJoin,n=f.currSettings.defaultVideoWidth||zn,a=(((c=(r=game.webrtc)==null?void 0:r.users)==null?void 0:c.filter(d=>d.active&&d.canBroadcastVideo))||[]).length;if(a===0)return;if(t===De.horizontal.name){const d=n*a+16;f.cameraContainer.style.width=`${d}px`}else if(t===De.vertical.name){const d=n*a+16;f.cameraContainer.style.height=`${d}px`}const s=parseInt(f.cameraContainer.style.width||0),i=parseInt(f.cameraContainer.style.height||0);s>0&&E.set(e.dockWidth.tag,s),i>0&&E.set(e.dockHeight.tag,i)}static applyDockResize(e=null){if(!f.cameraContainer)return;e?f.currSettings.dockResizeOnUserJoin=e:e=f.currSettings.dockResizeOnUserJoin,f.cameraContainer.classList.remove("horizontal"),f.cameraContainer.classList.remove("vertical");const t=f.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===De.horizontal.name?f.cameraContainer.classList.add("horizontal"):e===De.vertical.name&&f.cameraContainer.classList.add("vertical"),f.updateDockSize()}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=f.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),f.isResizing=!0,D(f,Kt,o.clientX),D(f,Jt,o.clientY),D(f,_t,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),D(f,Zt,f.cameraContainer.offsetWidth),D(f,Qt,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",y(f,on)),e==null||e.addEventListener("mouseup",y(f,an))})}}static checkMinimizedState(){if(!f.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),u.log("Checking minimized state",[e,t]),f.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=f.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!f.cameraContainer)return;if(u.log("handleMinimizedState",[e]),e)f.cameraContainer.parentNode!==t&&(f.originalParent=f.cameraContainer.parentNode,t.prepend(f.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!f.originalParent)return;f.originalParent.prepend(f.cameraContainer),f.makeDraggable(),f.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),u.log("Restored camera position from settings",[f.currSettings])}const o=(a=f.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};at=new WeakMap,je=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,_t=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,st=new WeakMap,on=new WeakMap,an=new WeakMap,T(f,at,0),T(f,je,0),h(f,"isDragging",!1),h(f,"cameraContainer"),h(f,"isResizing",!1),T(f,Kt,0),T(f,Jt,0),T(f,Zt,0),T(f,Qt,0),T(f,_t,0),h(f,"currSettings",{}),h(f,"positionIntervalId",null),h(f,"positionAttempts",5),h(f,"useFadeOut",!0),h(f,"enableFloatingDock",!0),T(f,en,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!f.isDragging||t)){if(u.log("mousemove",[window.innerHeight,e.clientY,y(f,je)]),f.cameraContainer){let n=e.clientX-y(f,at),o=window.innerHeight-e.clientY-y(f,je);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(f,tn,e=>{var a,s;const t=S(),n={...f.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(f.isDragging&&!o){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=f.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",y(f,en)),i==null||i.removeEventListener("mouseup",y(f,tn)),f.isDragging=!1,e.stopPropagation()}}),T(f,nn,e=>{if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let n=t.clientX-y(f,at),o=window.innerHeight-t.clientY-y(f,je);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(f,st,e=>{var o,a;const t=S(),n={...f.currSettings};if(f.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",y(f,nn)),s==null||s.removeEventListener("touchend",y(f,st)),s==null||s.removeEventListener("touchcancel",y(f,st)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),T(f,on,e=>{if(!f.isResizing)return;const t=y(f,Zt)+(e.clientX-y(f,Kt)),n=e.clientY-y(f,Jt),o=y(f,Qt)+n,a=y(f,_t)-n;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${o}px`,f.cameraContainer.style.bottom=`${a}px`}),T(f,an,()=>{var o,a,s,i,r,c,d;const e=S(),t={...f.currSettings},n=document.querySelector("body.crlngn-ui");f.isResizing=!1,n==null||n.removeEventListener("mousemove",y(f,on)),n==null||n.removeEventListener("mouseup",y(f,an)),u.log("onStopResize",[(o=f.cameraContainer)==null?void 0:o.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(s=f.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((i=f.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((r=f.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((c=f.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((d=f.cameraContainer)==null?void 0:d.style.left)||0),E.set(e.dockWidth.tag,t.dockWidth),E.set(e.dockHeight.tag,t.dockHeight),E.set(e.dockPosY.tag,t.dockPosY),E.set(e.dockPosX.tag,t.dockPosX)});let ne=f;const _=class _{static init(){Hooks.on(P.RENDER_SIDE_BAR,_.onRender),Hooks.on(P.COLLAPSE_SIDE_BAR,_.onRender),Hooks.on(P.READY,_.onRender)}static applyFadeOut(e){_.useFadeOut=e,_.handleFadeOut()}static applyCustomStyle(e){var t;_.customStylesEnabled=e,u.log("applyCustomStyle",[_.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||_.addChatToggle(o),_.handleFadeOut(e,o,n)}static handleFadeOut(e,t,n){u.log("handle FadeOut, ChatLogControls",[_.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");t?t.querySelector("#roll-privacy"):document.querySelector("#ui-right #roll-privacy"),_.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}};h(_,"useFadeOut",!0),h(_,"customStylesEnabled",!0),h(_,"addChatToggle",async e=>{const t=await renderTemplate(`modules/${x}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t);const o=n.querySelector("button[data-action=toggleChat]");o.addEventListener("click",_.onToggleChatBox);const a=game.user.getFlag(x,"chatBoxHidden");if(a!==void 0){u.log("Applying saved chat box state",[a]);const s=document.querySelector("#chat-notifications");a?(o.classList.remove("fa-comment-slash"),o.classList.add("fa-comment"),s.classList.add("input-hidden"),A.addCSSVars("--chat-input-height","0px")):(o.classList.add("fa-comment-slash"),o.classList.remove("fa-comment"),s.classList.remove("input-hidden"),A.addCSSVars("--chat-input-height","100px"))}}),h(_,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");let o=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),A.addCSSVars("--chat-input-height","0px"),o=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),A.addCSSVars("--chat-input-height","100px"),o=!1),game.user.setFlag(x,"chatBoxHidden",o),u.log("Chat box state saved to flag",[o])});let jt=_;const me=class me{static init(){const e=S();me.enableChatStyles=E.get(e.enableChatStyles.tag),me.chatBorderColor=E.get(e.chatBorderColor.tag),me.useLeftChatBorder=E.get(e.useLeftChatBorder.tag)}};h(me,"chatBorderColor"),h(me,"enableChatStyles"),h(me,"useLeftChatBorder"),h(me,"enrichCard",async(e,t)=>{var s,i,r,c,d,p,m,b;u.log("renderChatMessage",[me.chatBorderColor,me.enableChatStyles,vt.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(r=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:r.activity)==null?void 0:c.type)||((m=(p=(d=e.flags)==null?void 0:d.dnd5e)==null?void 0:p.roll)==null?void 0:m.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn"),me.useLeftChatBorder&&o.classList.add("left-border");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(C=>{const I=C.querySelector(".visible-dc"),q=C.querySelector(".hidden-dc");u.log("enrichCard",[I,q]),I.setAttribute("data-ability",C.getAttribute("data-ability")||""),I.setAttribute("data-dc",C.getAttribute("data-dc")||""),q.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),me.chatBorderColor===vt.playerColor.name&&((b=e.author)!=null&&b.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let dt=me;var We,it,sn;const G=class G{static init(){u.log("LeftControls - init",[]),Hooks.on(P.RENDER_SCENE_CONTROLS,G.initSceneControls),Hooks.on(P.ACTIVATE_SCENE_CONTROLS,G.onActivateSceneControls),window.addEventListener("resize",G.onActivateSceneControls),G.initSceneControls()}static applyFadeOut(e){G.useFadeOut=e,u.log("applyFadeOut",[e]),G.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls");G.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),u.log("handle FadeOut",[G.customStylesEnabled,G.useFadeOut])}static applyCustomStyle(e){var t;G.customStylesEnabled=e,u.log("applyCustomStyle",[G.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){D(G,We,document.querySelector("#ui-left #controls")),D(G,it,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){u.log("initSceneControls",[]),G.resetLocalVars(),G.customStylesEnabled?y(G,it).classList.add("crlngn-controls"):y(G,it).classList.remove("crlngn-controls"),G.handleFadeOut(e,t,n)}static observeControlsWidth(){if(u.log("observeControlsWidth",[]),!y(G,We))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};D(G,sn,new ResizeObserver(n=>{t(()=>G.updateCSSVars(),250)})),y(G,sn).observe(y(G,We),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!y(G,We))return;let e=parseInt(y(G,it).offsetWidth),t=parseInt(y(G,We).offsetWidth),n=-e+t;u.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&A.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),u.log("onActivateSceneControls",[a,o.length,n.length])}};We=new WeakMap,it=new WeakMap,sn=new WeakMap,T(G,We),T(G,it),T(G,sn),h(G,"useFadeOut",!0),h(G,"customStylesEnabled",!0),h(G,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return u.log("Error loading navigation button templates:",[e]),!1}});let Wt=G;const H=class H{static init(){this.preloadTemplates(),Hooks.on(P.RENDER_HOTBAR,H.onRender)}static applyFadeOut(e){H.useFadeOut=e,H.handleFadeOut()}static onRender(e,t,n){u.log("MacroHotbar onRender",[H.customStylesEnabled]),H.applyCustomStyle(H.customStylesEnabled),H.handleFadeOut(e,t,n),H.addCollapseButton(),H.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(x,"hotbarCollapsed");H.applyHotBarCollapse(!t)}static handleOpenDirectory(e){u.log("open directory")}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");H.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static applyCustomStyle(e){const t=S();H.customStylesEnabled=e!==void 0?e:E.get(t.enableMacroLayout.tag),u.log("applyCustomStyle",[H.customStylesEnabled]),H.applyHotBarLayout()}static applyHotBarLayout(){document.querySelector("body.crlngn-ui");const e=document.querySelector("#hotbar");e&&(H.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};h(H,"useFadeOut",!0),h(H,"customStylesEnabled",!0),h(H,"macroStartCollapsed",!1),h(H,"preloadTemplates",async()=>{try{const e=[`modules/${x}/templates/macro-buttons.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),h(H,"addCollapseButton",async()=>{const e=document.querySelector("body.crlngn-ui #hotbar-controls-right");if(!e)return;game.user.getFlag(x,"hotbarCollapsed");const t=await renderTemplate(`modules/${x}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const n=e.querySelector("button[data-action=collapse]"),o=e.querySelector("button[data-action=openDirectory]");n==null||n.addEventListener("click",H.handleCollapse),o==null||o.addEventListener("click",H.handleOpenDirectory)}),h(H,"applyHotBarCollapse",async e=>{var a,s;const t=S();H.macroStartCollapsed=e!==void 0?e:E.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(x,"hotbarCollapsed",H.macroStartCollapsed);const n=document.querySelector("body.crlngn-ui #hotbar-controls-right"),o=n==null?void 0:n.querySelector("button[data-action=collapse]");H.macroStartCollapsed?((a=document.querySelector("#hotbar"))==null||a.classList.add("collapsed"),o&&(o.classList.remove("fa-angle-down"),o.classList.add("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGNUI.MacroBarTooltipKeepOpen"))):((s=document.querySelector("#hotbar"))==null||s.classList.remove("collapsed"),o&&(o.classList.add("fa-angle-down"),o.classList.remove("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGNUI.MacroBarTooltipAutoHide")))});let Pe=H;var Lo;const ce=class ce{static init(){Hooks.on(P.RENDER_PLAYERS_LIST,ce.checkPlayersList),Hooks.on(P.RENDER_HOTBAR,ce.checkPlayersList),A.isModuleOn("foundry-taskbar")&&Hooks.on(P.UPDATE_USER,ce.checkTaskbarLock),ce.checkTaskbarLock(),ce.addModuleClasses(),A.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),A.isModuleOn("fvtt-youtube-player")&&ce.ytWigdetFadeOut&&(u.log("ModuleCompatUtil.init",[document.querySelector("#sidebar-video-player")]),setTimeout(()=>{var o;(o=document.querySelector("#sidebar-video-player"))==null||o.classList.add("faded-ui")},1e3))}};Lo=new WeakMap,T(ce,Lo),h(ce,"ytWigdetFadeOut",!0),h(ce,"addModuleClasses",()=>{const e=S(),t=E.get(e.otherModulesList.tag)||"",n=t.split(",");u.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),h(ce,"checkTaskbarLock",()=>{var a,s,i;const e=A.isModuleOn("foundry-taskbar");u.log("checkTaskbarLock #1",[e]);const t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");u.log("checkTaskbarLock #2",[t,n]),(s=t.taskbarSettings)!=null&&s.locked?A.addCSSVars("--crlngn-margin-bottom",n?"50px":"0px"):A.addCSSVars("--crlngn-margin-bottom",n?"10px":"0px"),(i=t.taskbarSettings)!=null&&i.locked?A.addCSSVars("--crlngn-taskbar-height","50px"):A.addCSSVars("--crlngn-taskbar-height","10px"),A.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),ce.checkPlayersList()}),h(ce,"checkPlayersList",()=>{document.querySelector("body"),document.querySelector("#players"),A.isModuleOn("foundry-taskbar")});let ut=ce;const ee=class ee{static init(){Hooks.on(P.RENDER_PLAYERS_LIST,ee.onRender),ee.applyPlayersListSettings(),ee.handleFadeOut(),u.log("PlayersList init")}static applyFadeOut(e){ee.useFadeOut=e,ee.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");ee.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),u.log("PlayersList handle fade out",[ee.useFadeOut])}static applyCustomStyle(e){ee.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){if(S(),ee.customStylesEnabled)t.classList.add("crlngn-ui");else{t.classList.remove("crlngn-ui");return}ee.applyPlayersListSettings(),ee.applyAvatars(),ee.handleFadeOut(e,t,n)}static applyPlayersListSettings(){var t,n;const e=S();u.log("applyPlayersListSettings",[E.get(e.autoHidePlayerList.tag)]),E.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"):(n=document.querySelector("#players.crlngn-ui"))==null||n.classList.remove("minimized"),ut.checkPlayersList()}static applyAvatars(){const e=S();u.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];E.get(e.playerListAvatars.tag)&&ee.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const i=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),r=game.users.get(s.id),c=((p=r.character)==null?void 0:p.img)||"";u.log("player",[r]);const d=document.createElement("img");d.src=c||r.avatar||"",d.alt="*",d.classList.add("crlngn-avatar"),i&&i.prepend(d)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(i=>{const r=i.querySelector("img.crlngn-avatar");r==null||r.remove()}),t==null||t.classList.remove("crlngn-avatars")),ut.checkPlayersList()}};h(ee,"useFadeOut",!0),h(ee,"customStylesEnabled",!0),h(ee,"playerListAvatars",!0);let Fe=ee;var $,rn,rt,To,St,lt,ct,ln,wo,cn,ve,$e,Ce,kn,Mn,On;const g=class g{static applyFadeOut(e){g.useFadeOut=e,u.log("applyFadeOut",[e]),g.handleSceneFadeOut()}static applyCustomStyle(e){g.sceneNavEnabled=e,u.log("applyCustomStyle - TopNavigation",[g.sceneNavEnabled,ui.nav])}static resetLocalVars(){D(g,$,document.querySelector("#scene-navigation")),D(g,St,document.querySelector("#scene-navigation-expand")),D(g,lt,document.querySelector("#ui-left")),D(g,rn,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;u.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),g.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),g.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):g.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleBackButton(e,t,n){if(game.scenes.size<2||(S(),u.log("handleBackButton",[e,t,n]),!g.useSceneBackButton))return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",y(g,kn)),o.prepend(a)}static handleFolderList(e,t,n){S(),g.navFoldersEnabled&&ht.addFolderButtons(e,t,n)}static handleNavState(){S(),y(g,cn)&&(D(g,cn,!1),g.toggleNav(g.navStartCollapsed))}static toggleNav(e){clearTimeout(y(g,ln)),D(g,ln,setTimeout(()=>{g.resetLocalVars(),e===!0?(ui.nav.collapse(),g.isCollapsed=!0,u.log("toggleNav collapse",[e,g.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove())):e===!1&&(g.isCollapsed=!1,ui.nav.expand(),u.log("toggleNav expand",[e,g.navStartCollapsed]))},300))}static checkSceneNavCompat(){S(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=y(g,$))==null||e.addEventListener("mouseenter",n=>{if(u.log("TopNavigation mouseenter",[g.isCollapsed,g.showNavOnHover]),!g.isCollapsed||!g.showNavOnHover)return;n.stopPropagation(),clearTimeout(y(g,rt)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=y(g,$))==null||t.addEventListener("mouseleave",n=>{u.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)&&(n.stopPropagation(),D(g,rt,setTimeout(()=>{clearTimeout(y(g,rt)),D(g,rt,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=S();if(!y(g,$))return;const i=((o=y(g,$))==null?void 0:o.querySelectorAll("li.nav-item"))||[],r=0,c=e!==null?e:g.navPos||0,d=(a=y(g,$))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!d)return;const p=i[c],m=d.offsetWidth||0,b=parseInt(m)*c;u.log("setNavPosition",["position",c,b,y(g,$).scrollWidth]);const C=b-r;if(C>y(g,$).scrollWidth)return;g.navPos=c,E.set(s.sceneNavPos.tag,c),t?A.smoothScrollTo(y(g,$),C,"horizontal",n):y(g,$).scrollTo({left:C,behavior:"instant"})}catch(s){u.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}};$=new WeakMap,rn=new WeakMap,rt=new WeakMap,To=new WeakMap,St=new WeakMap,lt=new WeakMap,ct=new WeakMap,ln=new WeakMap,wo=new WeakMap,cn=new WeakMap,ve=new WeakMap,$e=new WeakMap,Ce=new WeakMap,kn=new WeakMap,Mn=new WeakMap,On=new WeakMap,T(g,$),T(g,rn),T(g,rt),T(g,To),T(g,St),T(g,lt),h(g,"sceneFoldersTemplate"),h(g,"navButtonsTemplate"),T(g,ct),T(g,ln),T(g,wo),T(g,cn,!0),T(g,ve,null),T(g,$e,""),T(g,Ce,[]),h(g,"useFadeOut",!0),h(g,"sceneNavEnabled"),h(g,"navFoldersEnabled"),h(g,"navFoldersForPlayers"),h(g,"navShowRootFolders"),h(g,"navStartCollapsed"),h(g,"showNavOnHover"),h(g,"useSceneIcons"),h(g,"useScenePreview"),h(g,"useSceneBackButton"),h(g,"sceneClickToView"),h(g,"isCollapsed"),h(g,"navPos"),h(g,"init",()=>{const e=S();g.navStartCollapsed=E.get(e.navStartCollapsed.tag),g.showNavOnHover=E.get(e.showNavOnHover.tag),g.sceneNavEnabled=E.get(e.sceneNavEnabled.tag),g.useScenePreview=E.get(e.useScenePreview.tag),g.navFoldersEnabled=E.get(e.navFoldersEnabled.tag),g.navFoldersForPlayers=E.get(e.navFoldersForPlayers.tag),g.isCollapsed=g.navStartCollapsed,u.log("SCENE NAV INIT",[g.sceneNavEnabled]);const t=document.querySelector("body");if(g.sceneNavEnabled)t.classList.add("crlngn-scene-nav");else{t.classList.remove("crlngn-scene-nav");return}g.checkSceneNavCompat(),g.preloadTemplates(),ht.init(),Hooks.on(P.READY,()=>{g.handleSceneFadeOut(),A.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42)}),Hooks.on(P.RENDER_SCENE_NAV,g.onRender),Hooks.on(P.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(P.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(P.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(P.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==y(g,Ce)[y(g,Ce).length-1]&&y(g,Ce).push(n),g.handleSceneFadeOut()}),Hooks.on(P.COLLAPSE_SIDE_BAR,n=>{u.log(P.COLLAPSE_SIDE_BAR,[n]),n&&g.checkSideBar(n.expanded),g.placeNavButtons()}),Hooks.on(P.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(y(g,ct)),g.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(s=>s.remove()),D(g,ct,setTimeout(()=>{g.setCollapsedClass(o)},250))}),Hooks.on(P.RENDER_SCENE_DIRECTORY,n=>{u.log(P.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var r,c;const i=game.scenes.get(s.dataset.entryId);if(u.log(P.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,g.sceneClickToView]),g.sceneClickToView&&(s.addEventListener("dblclick",g.onActivateScene),s.addEventListener("click",g.onSelectScene)),g.useSceneIcons&&i&&((r=game.user)!=null&&r.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),i.ownership.default!==0?(i.active&&(d.classList.add("fa-bullseye"),s.prepend(d)),((c=game.scenes.current)==null?void 0:c.id)===i.id&&(d.classList.add("fa-star"),s.prepend(d))):(d.classList.add("fa-eye-slash"),s.prepend(d))}})}),ui.sidebar&&g.checkSideBar(ui.sidebar.expanded),g.placeNavButtons()}),h(g,"onRender",(e,t,n)=>{const o=S(),a=E.get(o.sceneNavPos.tag);u.log(P.RENDER_SCENE_NAV,[t]),g.resetLocalVars(),g.handleSceneFadeOut(e,t,n),g.sceneNavEnabled&&(g.handleBackButton(e,t,n),g.handleSceneList(e,t,n),g.handleFolderList(e,t,n),g.setNavPosition(a,!1),g.handleNavState()),g.addSceneListeners(t),g.addListeners(),g.resetLocalVars(),g.sceneNavEnabled&&g.navShowRootFolders&&(ht.init(),ht.renderFolderList()),u.log(P.RENDER_SCENE_NAV),g.sceneNavEnabled&&(clearTimeout(y(g,ct)),D(g,ct,setTimeout(()=>{u.log("NAV no transition remove"),g.placeNavButtons()},500)))}),h(g,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(y(g,lt).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),A.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(y(g,lt).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),g.placeNavButtons(),A.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),h(g,"checkSideBar",e=>{g.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),h(g,"handleSceneList",async(e,t,n)=>{var o,a;if(g.sceneNavEnabled){u.log("handleSceneList",[e,t,n]);const s=t.querySelectorAll(".scene-navigation-menu li.scene");for(const i of s){const r=i.dataset.sceneId;if(g.useScenePreview){const c=game.scenes.find(p=>p.id===r);c.isGM=(o=game.user)==null?void 0:o.isGM;const d=await renderTemplate(`modules/${x}/templates/scene-nav-preview.hbs`,c);if(u.log("sceneData",[c]),i.classList.add("nav-item"),i.insertAdjacentHTML("beforeend",d),c.isGM&&y(g,$e)===r){const p=new MouseEvent("mouseenter");i.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&g.addPreviewIconListeners(i,c)}g.useSceneIcons&&(i.classList.contains("active")||i.classList.contains("view"))&&i.classList.add("crlngn")}}if(g.sceneNavEnabled&&game.scenes.size>1){const s=t.querySelector("#scene-navigation-expand"),i=document.querySelector("#ui-left-column-2"),r=document.querySelector("#crlngn-scene-navigation-expand");r&&r.remove();let c=s==null?void 0:s.cloneNode(!0);c&&(c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{s.click()})),u.log("toggle events",[e,c]),i.prepend(c)}}),T(g,kn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=y(g,Ce).length,n=y(g,Ce)[t-2];let o;u.log("#onBackButton before",[t,n,y(g,Ce)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),y(g,Ce).pop()),u.log("#onBackButton after",[y(g,Ce)])}),h(g,"placeNavButtons",async()=>{var r;const e=document.querySelector("#scene-navigation");e.querySelector("#scene-navigation-inactive");const t=document.querySelectorAll("#ui-left .crlngn-btn");if(!e)return;const n=((r=y(g,St))==null?void 0:r.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(u.log("placeNavButtons *",[g.isCollapsed,o,t]),t.forEach(c=>c.remove()),!o||g.isCollapsed||y(g,lt).classList.contains("navigation-collapsed"))return;const a=await renderTemplate(`modules/${x}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=e.parentNode.querySelector("button.crlngn-btn.ui-nav-left"),i=e.parentNode.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",y(g,Mn)),i&&i.addEventListener("click",y(g,On))}),T(g,Mn,async e=>{const t=await g.getItemsPerPage(),n=g.navPos||0;if(!y(g,rn)||!y(g,$))return;let o=n-(t-1);u.log("onNavLast",["pos",o,y(g,$).scrollWidth]),o=o<0?0:o,g.setNavPosition(o)}),T(g,On,async e=>{var c,d;const t=await g.getItemsPerPage(),n=g.navPos||0,o=(c=y(g,$))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((d=y(g,$))==null?void 0:d.scrollWidth)||0;if(!a||!y(g,$))return;let i=n+(t-1),r=i*a;u.log("onNavNext",["pos",n,i,o==null?void 0:o.offsetWidth,r,s]),r>=s&&(i=Math.floor(s/a)),g.setNavPosition(i)}),h(g,"getItemsPerPage",async()=>{var e,t;try{u.log("getItemsPerPage",["Starting"]),g.resetLocalVars();const n=0,o=0,a=((e=y(g,St))==null?void 0:e.offsetWidth)||0,s=(t=y(g,$))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!y(g,$))return u.log("getItemsPerPage",["No scene items found"]),0;const i=s.offsetWidth,r=y(g,$).offsetWidth;if(!r)return u.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((r-a*2)/i);return u.log("getItemsPerPage",["Calculated:",c,r,i]),c||0}catch(n){return u.log("getItemsPerPage",["Error:",n]),u.error("Error in getItemsPerPage:",n),0}}),h(g,"preloadTemplates",async()=>{try{const e=[`modules/${x}/templates/scene-nav-buttons.hbs`,`modules/${x}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),h(g,"getCurrScenePosition",async e=>{try{if(!y(g,$)||!e)return 0;const t=await g.getItemsPerPage()||1,n=y(g,$).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(r=>r.dataset.sceneId===e);if(a===-1)return 0;const s=a>=g.navPos&&a<=g.navPos+t,i=s?g.navPos:a;return u.log("getCurrScenePosition",["Final position:",i,"isVisible:",s]),i}catch(t){return u.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),h(g,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);u.log("onActivateScene",[o,a]),a.activate(),y(g,ve)&&(clearTimeout(y(g,ve)),D(g,ve,null))}),h(g,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(D(g,$e,""),u.log("onSelectScene",[a,t,n]),a&&a.sheet){const s=a.sheet.render;u.log("onSelectScene - originalRender",[s]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=s},250)}y(g,ve)&&(clearTimeout(y(g,ve)),D(g,ve,null)),D(g,ve,setTimeout(()=>{a.view(),D(g,ve,null)},250))}),h(g,"onScenePreviewOn",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.dataset;D(g,$e,n.sceneId),u.log("onScenePreviewOn",[y(g,$e)]),t.querySelector(".scene-preview").classList.add("open")}),h(g,"onScenePreviewOff",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget;D(g,$e,""),u.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),h(g,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",g.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",g.onActivateScene),g.useScenePreview&&(n.addEventListener("mouseenter",g.onScenePreviewOn),n.addEventListener("mouseleave",g.onScenePreviewOff))})}),h(g,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!d}),u.log("Toggled global illumination",[!d])});const s=o.querySelector(".token-vision");s&&s.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.tokenVision;await n.update({tokenVision:!d}),u.log("Toggled token vision",[!d])});const i=o.querySelector(".sound");i&&n.playlistSound&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.playlistSound;if(d){const p=d.sound.playing;p?await d.sound.pause():await d.sound.play(),ui.nav.render(),u.log("Toggled playlist sound",[!p])}});const r=o.querySelector(".config");r&&r.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),u.log("Opened scene configuration")})});let B=g;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Do(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable})),t.push.apply(t,n)}return t}function Oe(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Do(Object(t),!0).forEach(function(n){Ja(l,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Do(Object(t)).forEach(function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(t,n))})}return l}function Sn(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sn=function(e){return typeof e}:Sn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(l)}function Ja(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function ze(){return ze=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l},ze.apply(this,arguments)}function Za(l,e){if(l==null)return{};var t={},n=Object.keys(l),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=l[o]);return t}function Qa(l,e){if(l==null)return{};var t=Za(l,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(l,n)&&(t[n]=l[n])}return t}var _a="1.15.6";function Ge(l){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(l)}var xe=Ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),dn=Ge(/Edge/i),Po=Ge(/firefox/i),zt=Ge(/safari/i)&&!Ge(/chrome/i)&&!Ge(/android/i),Io=Ge(/iP(ad|od|hone)/i),ua=Ge(/chrome/i)&&Ge(/android/i),ga={capture:!1,passive:!1};function z(l,e,t){l.addEventListener(e,t,!xe&&ga)}function F(l,e,t){l.removeEventListener(e,t,!xe&&ga)}function Nn(l,e){if(e){if(e[0]===">"&&(e=e.substring(1)),l)try{if(l.matches)return l.matches(e);if(l.msMatchesSelector)return l.msMatchesSelector(e);if(l.webkitMatchesSelector)return l.webkitMatchesSelector(e)}catch{return!1}return!1}}function fa(l){return l.host&&l!==document&&l.host.nodeType?l.host:l.parentNode}function Ee(l,e,t,n){if(l){t=t||document;do{if(e!=null&&(e[0]===">"?l.parentNode===t&&Nn(l,e):Nn(l,e))||n&&l===t)return l;if(l===t)break}while(l=fa(l))}return null}var Fo=/\s+/g;function fe(l,e,t){if(l&&e)if(l.classList)l.classList[t?"add":"remove"](e);else{var n=(" "+l.className+" ").replace(Fo," ").replace(" "+e+" "," ");l.className=(n+(t?" "+e:"")).replace(Fo," ")}}function R(l,e,t){var n=l&&l.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(t=l.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function yt(l,e){var t="";if(typeof l=="string")t=l;else do{var n=R(l,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(l=l.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function pa(l,e,t){if(l){var n=l.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Me(){var l=document.scrollingElement;return l||document.documentElement}function Z(l,e,t,n,o){if(!(!l.getBoundingClientRect&&l!==window)){var a,s,i,r,c,d,p;if(l!==window&&l.parentNode&&l!==Me()?(a=l.getBoundingClientRect(),s=a.top,i=a.left,r=a.bottom,c=a.right,d=a.height,p=a.width):(s=0,i=0,r=window.innerHeight,c=window.innerWidth,d=window.innerHeight,p=window.innerWidth),(e||t)&&l!==window&&(o=o||l.parentNode,!xe))do if(o&&o.getBoundingClientRect&&(R(o,"transform")!=="none"||t&&R(o,"position")!=="static")){var m=o.getBoundingClientRect();s-=m.top+parseInt(R(o,"border-top-width")),i-=m.left+parseInt(R(o,"border-left-width")),r=s+a.height,c=i+a.width;break}while(o=o.parentNode);if(n&&l!==window){var b=yt(o||l),C=b&&b.a,I=b&&b.d;b&&(s/=I,i/=C,p/=C,d/=I,r=s+d,c=i+p)}return{top:s,left:i,bottom:r,right:c,width:p,height:d}}}function Go(l,e,t){for(var n=Xe(l,!0),o=Z(l)[e];n;){var a=Z(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Me())break;n=Xe(n,!1)}return!1}function Ct(l,e,t,n){for(var o=0,a=0,s=l.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==k.ghost&&(n||s[a]!==k.dragged)&&Ee(s[a],t.draggable,l,!1)){if(o===e)return s[a];o++}a++}return null}function Ro(l,e){for(var t=l.lastElementChild;t&&(t===k.ghost||R(t,"display")==="none"||e&&!Nn(t,e));)t=t.previousElementSibling;return t||null}function ye(l,e){var t=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)l.nodeName.toUpperCase()!=="TEMPLATE"&&l!==k.clone&&(!e||Nn(l,e))&&t++;return t}function zo(l){var e=0,t=0,n=Me();if(l)do{var o=yt(l),a=o.a,s=o.d;e+=l.scrollLeft*a,t+=l.scrollTop*s}while(l!==n&&(l=l.parentNode));return[e,t]}function es(l,e){for(var t in l)if(l.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===l[t][n])return Number(t)}return-1}function Xe(l,e){if(!l||!l.getBoundingClientRect)return Me();var t=l,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=R(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Me();if(n||e)return t;n=!0}}while(t=t.parentNode);return Me()}function ts(l,e){if(l&&e)for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}function xn(l,e){return Math.round(l.top)===Math.round(e.top)&&Math.round(l.left)===Math.round(e.left)&&Math.round(l.height)===Math.round(e.height)&&Math.round(l.width)===Math.round(e.width)}var xt;function ma(l,e){return function(){if(!xt){var t=arguments,n=this;t.length===1?l.call(n,t[0]):l.apply(n,t),xt=setTimeout(function(){xt=void 0},e)}}}function ns(){clearTimeout(xt),xt=void 0}function ha(l,e,t){l.scrollLeft+=e,l.scrollTop+=t}function ya(l){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(l).cloneNode(!0):t?t(l).clone(!0)[0]:l.cloneNode(!0)}function Sa(l,e,t){var n={};return Array.from(l.children).forEach(function(o){var a,s,i,r;if(!(!Ee(o,e.draggable,l,!1)||o.animated||o===t)){var c=Z(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((i=n.right)!==null&&i!==void 0?i:-1/0,c.right),n.bottom=Math.max((r=n.bottom)!==null&&r!==void 0?r:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var de="Sortable"+new Date().getTime();function os(){var l=[],e;return{captureAnimationState:function(){if(l=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(R(o,"display")==="none"||o===k.ghost)){l.push({target:o,rect:Z(o)});var a=Oe({},l[l.length-1].rect);if(o.thisAnimationDuration){var s=yt(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){l.push(n)},removeAnimationState:function(n){l.splice(es(l,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;l.forEach(function(i){var r=0,c=i.target,d=c.fromRect,p=Z(c),m=c.prevFromRect,b=c.prevToRect,C=i.rect,I=yt(c,!0);I&&(p.top-=I.f,p.left-=I.e),c.toRect=p,c.thisAnimationDuration&&xn(m,p)&&!xn(d,p)&&(C.top-p.top)/(C.left-p.left)===(d.top-p.top)/(d.left-p.left)&&(r=ss(C,m,b,o.options)),xn(p,d)||(c.prevFromRect=d,c.prevToRect=p,r||(r=o.options.animation),o.animate(c,C,p,r)),r&&(a=!0,s=Math.max(s,r),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},r),c.thisAnimationDuration=r)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),l=[]},animate:function(n,o,a,s){if(s){R(n,"transition",""),R(n,"transform","");var i=yt(this.el),r=i&&i.a,c=i&&i.d,d=(o.left-a.left)/(r||1),p=(o.top-a.top)/(c||1);n.animatingX=!!d,n.animatingY=!!p,R(n,"transform","translate3d("+d+"px,"+p+"px,0)"),this.forRepaintDummy=as(n),R(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),R(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){R(n,"transition",""),R(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function as(l){return l.offsetWidth}function ss(l,e,t,n){return Math.sqrt(Math.pow(e.top-l.top,2)+Math.pow(e.left-l.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var gt=[],Un={initializeByDefault:!0},un={mount:function(e){for(var t in Un)Un.hasOwnProperty(t)&&!(t in e)&&(e[t]=Un[t]);gt.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),gt.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";gt.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Oe({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Oe({sortable:t},n)))})},initializePlugins:function(e,t,n,o){gt.forEach(function(i){var r=i.pluginName;if(!(!e.options[r]&&!i.initializeByDefault)){var c=new i(e,t,e.options);c.sortable=e,c.options=e.options,e[r]=c,ze(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return gt.forEach(function(o){typeof o.eventProperties=="function"&&ze(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return gt.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function is(l){var e=l.sortable,t=l.rootEl,n=l.name,o=l.targetEl,a=l.cloneEl,s=l.toEl,i=l.fromEl,r=l.oldIndex,c=l.newIndex,d=l.oldDraggableIndex,p=l.newDraggableIndex,m=l.originalEvent,b=l.putSortable,C=l.extraEventProperties;if(e=e||t&&t[de],!!e){var I,q=e.options,V="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!xe&&!dn?I=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(I=document.createEvent("Event"),I.initEvent(n,!0,!0)),I.to=s||t,I.from=i||t,I.item=o||t,I.clone=a,I.oldIndex=r,I.newIndex=c,I.oldDraggableIndex=d,I.newDraggableIndex=p,I.originalEvent=m,I.pullMode=b?b.lastPutMode:void 0;var Q=Oe(Oe({},C),un.getEventProperties(n,e));for(var Se in Q)I[Se]=Q[Se];t&&t.dispatchEvent(I),q[V]&&q[V].call(e,I)}}var rs=["evt"],re=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=Qa(n,rs);un.pluginEvent.bind(k)(e,t,Oe({dragEl:v,parentEl:Y,ghostEl:M,rootEl:j,nextEl:nt,lastDownEl:bn,cloneEl:W,cloneHidden:Ve,dragStarted:Pt,putSortable:te,activeSortable:k.active,originalEvent:o,oldIndex:mt,oldDraggableIndex:Ut,newIndex:pe,newDraggableIndex:Be,hideGhostForTarget:Ea,unhideGhostForTarget:Na,cloneNowHidden:function(){Ve=!0},cloneNowShown:function(){Ve=!1},dispatchSortableEvent:function(i){ie({sortable:t,name:i,originalEvent:o})}},a))};function ie(l){is(Oe({putSortable:te,cloneEl:W,targetEl:v,rootEl:j,oldIndex:mt,oldDraggableIndex:Ut,newIndex:pe,newDraggableIndex:Be},l))}var v,Y,M,j,nt,bn,W,Ve,mt,pe,Ut,Be,pn,te,pt=!1,Ln=!1,Tn=[],et,be,qn,Bn,xo,Uo,Pt,ft,qt,Bt=!1,mn=!1,vn,ae,Hn=[],ro=!1,wn=[],Fn=typeof document<"u",hn=Io,qo=dn||xe?"cssFloat":"float",ls=Fn&&!ua&&!Io&&"draggable"in document.createElement("div"),ba=function(){if(Fn){if(xe)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto",l.style.pointerEvents==="auto"}}(),va=function(e,t){var n=R(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=Ct(e,0,t),s=Ct(e,1,t),i=a&&R(a),r=s&&R(s),c=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+Z(a).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Z(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&i.float&&i.float!=="none"){var p=i.float==="left"?"left":"right";return s&&(r.clear==="both"||r.clear===p)?"vertical":"horizontal"}return a&&(i.display==="block"||i.display==="flex"||i.display==="table"||i.display==="grid"||c>=o&&n[qo]==="none"||s&&n[qo]==="none"&&c+d>o)?"vertical":"horizontal"},cs=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,i=n?t.left:t.top,r=n?t.right:t.bottom,c=n?t.width:t.height;return o===i||a===r||o+s/2===i+c/2},ds=function(e,t){var n;return Tn.some(function(o){var a=o[de].options.emptyInsertThreshold;if(!(!a||Ro(o))){var s=Z(o),i=e>=s.left-a&&e<=s.right+a,r=t>=s.top-a&&t<=s.bottom+a;if(i&&r)return n=o}}),n},Ca=function(e){function t(a,s){return function(i,r,c,d){var p=i.options.group.name&&r.options.group.name&&i.options.group.name===r.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(i,r,c,d),s)(i,r,c,d);var m=(s?i:r).options.group.name;return a===!0||typeof a=="string"&&a===m||a.join&&a.indexOf(m)>-1}}var n={},o=e.group;(!o||Sn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Ea=function(){!ba&&M&&R(M,"display","none")},Na=function(){!ba&&M&&R(M,"display","")};Fn&&!ua&&document.addEventListener("click",function(l){if(Ln)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),Ln=!1,!1},!0);var tt=function(e){if(v){e=e.touches?e.touches[0]:e;var t=ds(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[de]._onDragOver(n)}}},us=function(e){v&&v.parentNode[de]._isOutsideThisEl(e.target)};function k(l,e){if(!(l&&l.nodeType&&l.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l,this.options=e=ze({},e),l[de]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return va(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,i){s.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!zt||Io),emptyInsertThreshold:5};un.initializePlugins(this,l,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Ca(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:ls,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(l,"pointerdown",this._onTapStart):(z(l,"mousedown",this._onTapStart),z(l,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(l,"dragover",this),z(l,"dragenter",this)),Tn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ze(this,os())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(ft=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,v):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,i=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,r=(i||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=o.filter;if(bs(n),!v&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&zt&&r&&r.tagName.toUpperCase()==="SELECT")&&(r=Ee(r,o.draggable,n,!1),!(r&&r.animated)&&bn!==r)){if(mt=ye(r),Ut=ye(r,o.draggable),typeof d=="function"){if(d.call(this,e,r,this)){ie({sortable:t,rootEl:c,name:"filter",targetEl:r,toEl:n,fromEl:n}),re("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(p){if(p=Ee(c,p.trim(),n,!1),p)return ie({sortable:t,rootEl:p,name:"filter",targetEl:r,fromEl:n,toEl:n}),re("filter",t,{evt:e}),!0}),d)){a&&e.preventDefault();return}o.handle&&!Ee(c,o.handle,n,!1)||this._prepareDragStart(e,i,r)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,i=a.ownerDocument,r;if(n&&!v&&n.parentNode===a){var c=Z(n);if(j=a,v=n,Y=v.parentNode,nt=v.nextSibling,bn=n,pn=s.group,k.dragged=v,et={target:v,clientX:(t||e).clientX,clientY:(t||e).clientY},xo=et.clientX-c.left,Uo=et.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,v.style["will-change"]="all",r=function(){if(re("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Po&&o.nativeDraggable&&(v.draggable=!0),o._triggerDragStart(e,t),ie({sortable:o,name:"choose",originalEvent:e}),fe(v,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){pa(v,d.trim(),Vn)}),z(i,"dragover",tt),z(i,"mousemove",tt),z(i,"touchmove",tt),s.supportPointer?(z(i,"pointerup",o._onDrop),!this.nativeDraggable&&z(i,"pointercancel",o._onDrop)):(z(i,"mouseup",o._onDrop),z(i,"touchend",o._onDrop),z(i,"touchcancel",o._onDrop)),Po&&this.nativeDraggable&&(this.options.touchStartThreshold=4,v.draggable=!0),re("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(dn||xe))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(z(i,"pointerup",o._disableDelayedDrag),z(i,"pointercancel",o._disableDelayedDrag)):(z(i,"mouseup",o._disableDelayedDrag),z(i,"touchend",o._disableDelayedDrag),z(i,"touchcancel",o._disableDelayedDrag)),z(i,"mousemove",o._delayedDragTouchMoveHandler),z(i,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&z(i,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(r,s.delay)}else r()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){v&&Vn(v),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;F(e,"mouseup",this._disableDelayedDrag),F(e,"touchend",this._disableDelayedDrag),F(e,"touchcancel",this._disableDelayedDrag),F(e,"pointerup",this._disableDelayedDrag),F(e,"pointercancel",this._disableDelayedDrag),F(e,"mousemove",this._delayedDragTouchMoveHandler),F(e,"touchmove",this._delayedDragTouchMoveHandler),F(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):t?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(v,"dragend",this),z(j,"dragstart",this._onDragStart));try{document.selection?Cn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(pt=!1,j&&v){re("dragStarted",this,{evt:t}),this.nativeDraggable&&z(document,"dragover",us);var n=this.options;!e&&fe(v,n.dragClass,!1),fe(v,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),ie({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(be){this._lastX=be.clientX,this._lastY=be.clientY,Ea();for(var e=document.elementFromPoint(be.clientX,be.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(be.clientX,be.clientY),e!==t);)t=e;if(v.parentNode[de]._isOutsideThisEl(e),t)do{if(t[de]){var n=void 0;if(n=t[de]._onDragOver({clientX:be.clientX,clientY:be.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=fa(t));Na()}},_onTouchMove:function(e){if(et){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=M&&yt(M,!0),i=M&&s&&s.a,r=M&&s&&s.d,c=hn&&ae&&zo(ae),d=(a.clientX-et.clientX+o.x)/(i||1)+(c?c[0]-Hn[0]:0)/(i||1),p=(a.clientY-et.clientY+o.y)/(r||1)+(c?c[1]-Hn[1]:0)/(r||1);if(!k.active&&!pt){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(M){s?(s.e+=d-(qn||0),s.f+=p-(Bn||0)):s={a:1,b:0,c:0,d:1,e:d,f:p};var m="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");R(M,"webkitTransform",m),R(M,"mozTransform",m),R(M,"msTransform",m),R(M,"transform",m),qn=d,Bn=p,be=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!M){var e=this.options.fallbackOnBody?document.body:j,t=Z(v,!0,hn,!0,e),n=this.options;if(hn){for(ae=e;R(ae,"position")==="static"&&R(ae,"transform")==="none"&&ae!==document;)ae=ae.parentNode;ae!==document.body&&ae!==document.documentElement?(ae===document&&(ae=Me()),t.top+=ae.scrollTop,t.left+=ae.scrollLeft):ae=Me(),Hn=zo(ae)}M=v.cloneNode(!0),fe(M,n.ghostClass,!1),fe(M,n.fallbackClass,!0),fe(M,n.dragClass,!0),R(M,"transition",""),R(M,"transform",""),R(M,"box-sizing","border-box"),R(M,"margin",0),R(M,"top",t.top),R(M,"left",t.left),R(M,"width",t.width),R(M,"height",t.height),R(M,"opacity","0.8"),R(M,"position",hn?"absolute":"fixed"),R(M,"zIndex","100000"),R(M,"pointerEvents","none"),k.ghost=M,e.appendChild(M),R(M,"transform-origin",xo/parseInt(M.style.width)*100+"% "+Uo/parseInt(M.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(re("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}re("setupClone",this),k.eventCanceled||(W=ya(v),W.removeAttribute("id"),W.draggable=!1,W.style["will-change"]="",this._hideClone(),fe(W,this.options.chosenClass,!1),k.clone=W),n.cloneId=Cn(function(){re("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||j.insertBefore(W,v),n._hideClone(),ie({sortable:n,name:"clone"}))}),!t&&fe(v,a.dragClass,!0),t?(Ln=!0,n._loopId=setInterval(n._emulateDragOver,50)):(F(document,"mouseup",n._onDrop),F(document,"touchend",n._onDrop),F(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,v)),z(document,"drop",n),R(v,"transform","translateZ(0)")),pt=!0,n._dragStartId=Cn(n._dragStarted.bind(n,t,e)),z(document,"selectstart",n),Pt=!0,window.getSelection().removeAllRanges(),zt&&R(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,i=this.options,r=i.group,c=k.active,d=pn===r,p=i.sort,m=te||c,b,C=this,I=!1;if(ro)return;function q(At,wa){re(At,C,Oe({evt:e,isOwner:d,axis:b?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:m,target:n,completed:Q,onMove:function(Oo,Ia){return yn(j,t,v,o,Oo,Z(Oo),e,Ia)},changed:Se},wa))}function V(){q("dragOverAnimationCapture"),C.captureAnimationState(),C!==m&&m.captureAnimationState()}function Q(At){return q("dragOverCompleted",{insertion:At}),At&&(d?c._hideClone():c._showClone(C),C!==m&&(fe(v,te?te.options.ghostClass:c.options.ghostClass,!1),fe(v,i.ghostClass,!0)),te!==C&&C!==k.active?te=C:C===k.active&&te&&(te=null),m===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){q("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(n===v&&!v.animated||n===t&&!n.animated)&&(ft=null),!i.dragoverBubble&&!e.rootEl&&n!==document&&(v.parentNode[de]._isOutsideThisEl(e.target),!At&&tt(e)),!i.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),I=!0}function Se(){pe=ye(v),Be=ye(v,i.draggable),ie({sortable:C,name:"change",toEl:t,newIndex:pe,newDraggableIndex:Be,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Ee(n,i.draggable,t,!0),q("dragOver"),k.eventCanceled)return I;if(v.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return Q(!1);if(Ln=!1,c&&!i.disabled&&(d?p||(s=Y!==j):te===this||(this.lastPutMode=pn.checkPull(this,c,v,e))&&r.checkPut(this,c,v,e))){if(b=this._getDirection(e,n)==="vertical",o=Z(v),q("dragOverValid"),k.eventCanceled)return I;if(s)return Y=j,V(),this._hideClone(),q("revert"),k.eventCanceled||(nt?j.insertBefore(v,nt):j.appendChild(v)),Q(!0);var ue=Ro(t,i.draggable);if(!ue||ms(e,b,this)&&!ue.animated){if(ue===v)return Q(!1);if(ue&&t===e.target&&(n=ue),n&&(a=Z(n)),yn(j,t,v,o,n,a,e,!!n)!==!1)return V(),ue&&ue.nextSibling?t.insertBefore(v,ue.nextSibling):t.appendChild(v),Y=t,Se(),Q(!0)}else if(ue&&ps(e,b,this)){var Ze=Ct(t,0,i,!0);if(Ze===v)return Q(!1);if(n=Ze,a=Z(n),yn(j,t,v,o,n,a,e,!1)!==!1)return V(),t.insertBefore(v,Ze),Y=t,Se(),Q(!0)}else if(n.parentNode===t){a=Z(n);var Ne=0,Qe,Rt=v.parentNode!==t,ge=!cs(v.animated&&v.toRect||o,n.animated&&n.toRect||a,b),kt=b?"top":"left",Ue=Go(n,"top","top")||Go(v,"top","top"),Mt=Ue?Ue.scrollTop:void 0;ft!==n&&(Qe=a[kt],Bt=!1,mn=!ge&&i.invertSwap||Rt),Ne=hs(e,n,a,b,ge?1:i.swapThreshold,i.invertedSwapThreshold==null?i.swapThreshold:i.invertedSwapThreshold,mn,ft===n);var Ae;if(Ne!==0){var _e=ye(v);do _e-=Ne,Ae=Y.children[_e];while(Ae&&(R(Ae,"display")==="none"||Ae===M))}if(Ne===0||Ae===n)return Q(!1);ft=n,qt=Ne;var Ot=n.nextElementSibling,qe=!1;qe=Ne===1;var gn=yn(j,t,v,o,n,a,e,qe);if(gn!==!1)return(gn===1||gn===-1)&&(qe=gn===1),ro=!0,setTimeout(fs,30),V(),qe&&!Ot?t.appendChild(v):n.parentNode.insertBefore(v,qe?Ot:n),Ue&&ha(Ue,0,Mt-Ue.scrollTop),Y=v.parentNode,Qe!==void 0&&!mn&&(vn=Math.abs(Qe-Z(n)[kt])),Se(),Q(!0)}if(t.contains(v))return Q(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",tt),F(document,"mousemove",tt),F(document,"touchmove",tt)},_offUpEvents:function(){var e=this.el.ownerDocument;F(e,"mouseup",this._onDrop),F(e,"touchend",this._onDrop),F(e,"pointerup",this._onDrop),F(e,"pointercancel",this._onDrop),F(e,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(pe=ye(v),Be=ye(v,n.draggable),re("drop",this,{evt:e}),Y=v&&v.parentNode,pe=ye(v),Be=ye(v,n.draggable),k.eventCanceled){this._nulling();return}pt=!1,mn=!1,Bt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),lo(this.cloneId),lo(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),zt&&R(document.body,"user-select",""),R(v,"transform",""),e&&(Pt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),M&&M.parentNode&&M.parentNode.removeChild(M),(j===Y||te&&te.lastPutMode!=="clone")&&W&&W.parentNode&&W.parentNode.removeChild(W),v&&(this.nativeDraggable&&F(v,"dragend",this),Vn(v),v.style["will-change"]="",Pt&&!pt&&fe(v,te?te.options.ghostClass:this.options.ghostClass,!1),fe(v,this.options.chosenClass,!1),ie({sortable:this,name:"unchoose",toEl:Y,newIndex:null,newDraggableIndex:null,originalEvent:e}),j!==Y?(pe>=0&&(ie({rootEl:Y,name:"add",toEl:Y,fromEl:j,originalEvent:e}),ie({sortable:this,name:"remove",toEl:Y,originalEvent:e}),ie({rootEl:Y,name:"sort",toEl:Y,fromEl:j,originalEvent:e}),ie({sortable:this,name:"sort",toEl:Y,originalEvent:e})),te&&te.save()):pe!==mt&&pe>=0&&(ie({sortable:this,name:"update",toEl:Y,originalEvent:e}),ie({sortable:this,name:"sort",toEl:Y,originalEvent:e})),k.active&&((pe==null||pe===-1)&&(pe=mt,Be=Ut),ie({sortable:this,name:"end",toEl:Y,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){re("nulling",this),j=v=Y=M=nt=W=bn=Ve=et=be=Pt=pe=Be=mt=Ut=ft=qt=te=pn=k.dragged=k.ghost=k.clone=k.active=null,wn.forEach(function(e){e.checked=!0}),wn.length=qn=Bn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":v&&(this._onDragOver(e),gs(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],Ee(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Ss(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var i=o.children[s];Ee(i,this.options.draggable,o,!1)&&(n[a]=i)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ee(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=un.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Ca(n)},destroy:function(){re("destroy",this);var e=this.el;e[de]=null,F(e,"mousedown",this._onTapStart),F(e,"touchstart",this._onTapStart),F(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(e,"dragover",this),F(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Tn.splice(Tn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ve){if(re("hideClone",this),k.eventCanceled)return;R(W,"display","none"),this.options.removeCloneOnHide&&W.parentNode&&W.parentNode.removeChild(W),Ve=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ve){if(re("showClone",this),k.eventCanceled)return;v.parentNode==j&&!this.options.group.revertClone?j.insertBefore(W,v):nt?j.insertBefore(W,nt):j.appendChild(W),this.options.group.revertClone&&this.animate(v,W),R(W,"display",""),Ve=!1}}};function gs(l){l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault()}function yn(l,e,t,n,o,a,s,i){var r,c=l[de],d=c.options.onMove,p;return window.CustomEvent&&!xe&&!dn?r=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(r=document.createEvent("Event"),r.initEvent("move",!0,!0)),r.to=e,r.from=l,r.dragged=t,r.draggedRect=n,r.related=o||e,r.relatedRect=a||Z(e),r.willInsertAfter=i,r.originalEvent=s,l.dispatchEvent(r),d&&(p=d.call(c,r,s)),p}function Vn(l){l.draggable=!1}function fs(){ro=!1}function ps(l,e,t){var n=Z(Ct(t.el,0,t.options,!0)),o=Sa(t.el,t.options,M),a=10;return e?l.clientX<o.left-a||l.clientY<n.top&&l.clientX<n.right:l.clientY<o.top-a||l.clientY<n.bottom&&l.clientX<n.left}function ms(l,e,t){var n=Z(Ro(t.el,t.options.draggable)),o=Sa(t.el,t.options,M),a=10;return e?l.clientX>o.right+a||l.clientY>n.bottom&&l.clientX>n.left:l.clientY>o.bottom+a||l.clientX>n.right&&l.clientY>n.top}function hs(l,e,t,n,o,a,s,i){var r=n?l.clientY:l.clientX,c=n?t.height:t.width,d=n?t.top:t.left,p=n?t.bottom:t.right,m=!1;if(!s){if(i&&vn<c*o){if(!Bt&&(qt===1?r>d+c*a/2:r<p-c*a/2)&&(Bt=!0),Bt)m=!0;else if(qt===1?r<d+vn:r>p-vn)return-qt}else if(r>d+c*(1-o)/2&&r<p-c*(1-o)/2)return ys(e)}return m=m||s,m&&(r<d+c*a/2||r>p-c*a/2)?r>d+c/2?1:-1:0}function ys(l){return ye(v)<ye(l)?1:-1}function Ss(l){for(var e=l.tagName+l.className+l.src+l.href+l.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function bs(l){wn.length=0;for(var e=l.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&wn.push(n)}}function Cn(l){return setTimeout(l,0)}function lo(l){return clearTimeout(l)}Fn&&z(document,"touchmove",function(l){(k.active||pt)&&l.cancelable&&l.preventDefault()});k.utils={on:z,off:F,css:R,find:pa,is:function(e,t){return!!Ee(e,t,e,!1)},extend:ts,throttle:ma,closest:Ee,toggleClass:fe,clone:ya,index:ye,nextTick:Cn,cancelNextTick:lo,detectDirection:va,getChild:Ct,expando:de};k.get=function(l){return l[de]};k.mount=function(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Oe(Oe({},k.utils),n.utils)),un.mount(n)})};k.create=function(l,e){return new k(l,e)};k.version=_a;var K=[],Ft,co,uo=!1,jn,Wn,In,Gt;function vs(){function l(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return l.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):n.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),Bo(),En(),ns()},nulling:function(){In=co=Ft=uo=Gt=jn=Wn=null,K.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,i=document.elementFromPoint(a,s);if(In=t,n||this.options.forceAutoScrollFallback||dn||xe||zt){$n(t,this.options,i,n);var r=Xe(i,!0);uo&&(!Gt||a!==jn||s!==Wn)&&(Gt&&Bo(),Gt=setInterval(function(){var c=Xe(document.elementFromPoint(a,s),!0);c!==r&&(r=c,En()),$n(t,o.options,c,n)},10),jn=a,Wn=s)}else{if(!this.options.bubbleScroll||Xe(i,!0)===Me()){En();return}$n(t,this.options,Xe(i,!1),!1)}}},ze(l,{pluginName:"scroll",initializeByDefault:!0})}function En(){K.forEach(function(l){clearInterval(l.pid)}),K=[]}function Bo(){clearInterval(Gt)}var $n=ma(function(l,e,t,n){if(e.scroll){var o=(l.touches?l.touches[0]:l).clientX,a=(l.touches?l.touches[0]:l).clientY,s=e.scrollSensitivity,i=e.scrollSpeed,r=Me(),c=!1,d;co!==t&&(co=t,En(),Ft=e.scroll,d=e.scrollFn,Ft===!0&&(Ft=Xe(t,!0)));var p=0,m=Ft;do{var b=m,C=Z(b),I=C.top,q=C.bottom,V=C.left,Q=C.right,Se=C.width,ue=C.height,Ze=void 0,Ne=void 0,Qe=b.scrollWidth,Rt=b.scrollHeight,ge=R(b),kt=b.scrollLeft,Ue=b.scrollTop;b===r?(Ze=Se<Qe&&(ge.overflowX==="auto"||ge.overflowX==="scroll"||ge.overflowX==="visible"),Ne=ue<Rt&&(ge.overflowY==="auto"||ge.overflowY==="scroll"||ge.overflowY==="visible")):(Ze=Se<Qe&&(ge.overflowX==="auto"||ge.overflowX==="scroll"),Ne=ue<Rt&&(ge.overflowY==="auto"||ge.overflowY==="scroll"));var Mt=Ze&&(Math.abs(Q-o)<=s&&kt+Se<Qe)-(Math.abs(V-o)<=s&&!!kt),Ae=Ne&&(Math.abs(q-a)<=s&&Ue+ue<Rt)-(Math.abs(I-a)<=s&&!!Ue);if(!K[p])for(var _e=0;_e<=p;_e++)K[_e]||(K[_e]={});(K[p].vx!=Mt||K[p].vy!=Ae||K[p].el!==b)&&(K[p].el=b,K[p].vx=Mt,K[p].vy=Ae,clearInterval(K[p].pid),(Mt!=0||Ae!=0)&&(c=!0,K[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(In);var Ot=K[this.layer].vy?K[this.layer].vy*i:0,qe=K[this.layer].vx?K[this.layer].vx*i:0;typeof d=="function"&&d.call(k.dragged.parentNode[de],qe,Ot,l,In,K[this.layer].el)!=="continue"||ha(K[this.layer].el,qe,Ot)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&m!==r&&(m=Xe(m,!1)));uo=c}},30),La=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,i=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var c=n||a;i();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(d.clientX,d.clientY);r(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function ko(){}ko.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=Ct(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:La};ze(ko,{pluginName:"revertOnSpill"});function Mo(){}Mo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:La};ze(Mo,{pluginName:"removeOnSpill"});k.mount(new vs);k.mount(Mo,ko);const Yn="root";var Ye,J,An,Dn,Ta;const w=class w{static init(){if(w.noFolderView()||!ui.scenes)return;w.preloadTemplates(),game.user.getFlag(x,"activeSceneFolders")||game.user.setFlag(x,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(P.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;U(a=w,Dn,Ta).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){if(!B.navFoldersEnabled||game.scenes.size<2||game.scenes.folders.size<1)return;const o=S(),a=document.querySelector("#crlngn-scene-lookup"),s=document.querySelector("#crlngn-folder-toggle");if(a||s)return;const i=t.querySelector("#scene-navigation-active"),r=i.querySelector("li.scene:first-of-type"),c=document.createElement("div"),d=document.createElement("div");c.id="crlngn-scene-lookup",c.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,d.dataset.tooltip=B.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",d.id="crlngn-folder-toggle",d.innerHTML="<i class='fa-solid icon'></i>",B.navShowRootFolders?i.classList.add("with-folders"):i.classList.remove("with-folders"),c.querySelector(".folder-expand").addEventListener("click",w.toggleFolderLookup),d.addEventListener("click",()=>{B.setNavPosition(0),E.set(o.navShowRootFolders.tag,!B.navShowRootFolders),B.placeNavButtons()}),i.insertBefore(c,r),i.append(d),w.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),D(w,Ye,game.scenes.sortingMode),u.log("buildFolderData A",[e.name,e]),e.id===Yn?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=w.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},u.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),y(w,Ye)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Ye=new WeakMap,J=new WeakMap,An=new WeakMap,Dn=new WeakSet,Ta=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){D(w,Ye,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}D(w,Ye,"a"),u.log("updateSortMode fallback",[y(w,Ye)])},T(w,Dn),h(w,"selectedFolder",Yn),T(w,Ye,"a"),T(w,J,[]),h(w,"searchValue",""),h(w,"renderFolderList",async e=>{D(w,J,game.user.getFlag(x,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:Yn},a=w.buildTemplateData(o),s=await renderTemplate(`modules/${x}/templates/scene-nav-folders.hbs`,a);u.log("renderFolderList",[o,y(w,J),s]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const i=t.querySelectorAll("li.folder");w.addFolderListeners(i),B.placeNavButtons()}),h(w,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${x}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",w.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),h(w,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",y(w,An));const o=n.dataset.folderId,a=t.get(o),s=y(w,J).includes(o);u.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),w.injectSubfolders(a,n))})}),T(w,An,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await w.injectSubfolders(a,t.parentNode),B.addSceneListeners(t.parentNode),u.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?w.updateActiveFolders(n,!0):w.updateActiveFolders(n,!1)}),h(w,"injectSubfolders",async(e,t)=>{const n=w.buildTemplateData(e),o=await renderTemplate(`modules/${x}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");w.addFolderListeners(s),B.addSceneListeners(t.querySelector(".contents"))}),h(w,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-navigation-inactive"),o=n==null?void 0:n.querySelector(`li.folder[data-folder-id="${e}"]`),a=y(w,J).indexOf(e);u.log("updateActiveFolders A",[a,e,game.user.getFlag(x,"activeSceneFolders"),y(w,J)]),t?(D(w,J,y(w,J).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):y(w,J).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(i=>{i!==o&&(D(w,J,y(w,J).filter(r=>r!==i.dataset.folderId)),i.classList.remove("crlngn-folder-active"))}),y(w,J).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(x,"activeSceneFolders",y(w,J)),u.log("updateActiveFolders B",[t,e,game.user.getFlag(x,"activeSceneFolders"),y(w,J)])}),h(w,"selectFolder",e=>w.getFolderById(e)||null),h(w,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!B.navFoldersForPlayers||!B.navFoldersEnabled||!B.sceneNavEnabled}),h(w,"preloadTemplates",async()=>{const e=[`modules/${x}/templates/scene-nav-folders.hbs`,`modules/${x}/templates/scene-nav-subfolders.hbs`,`modules/${x}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),h(w,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;w.searchValue=n,w.updateSearchResults(n)}),h(w,"updateSearchResults",e=>{var a,s;if(w.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())&&i.permission>=2))||[];n.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase()));const o=((s=game.scenes)==null?void 0:s.folders.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(i=>{const r=document.createElement("li");r.className="search-folder",r.dataset.folderId=i.id,r.innerHTML=`<a><i class="fas fa-folder"></i> ${i.name}</a>`,r.addEventListener("click",w.onSelectSearchedFolder),t.appendChild(r)}),n.forEach(i=>{const r=document.createElement("li");r.className="search-scene",r.dataset.sceneId=i.id,r.innerHTML=`<a><i class="fas fa-map"></i> ${i.name}</a>`,r.addEventListener("dblclick",B.onActivateScene),r.addEventListener("click",B.onSelectScene),t.appendChild(r)}),o.length===0&&n.length===0){const i=document.createElement("li");i.className="no-results",i.textContent="No matching results found",t.appendChild(i)}}),h(w,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(B.navShowRootFolders||o.click(),!n)return;const i=[...ui.scenes.collection.folders.get(n).ancestors];D(w,J,[]);for(const r of i)y(w,J).push(r.id);y(w,J).push(n),await game.user.setFlag(x,"activeSceneFolders",y(w,J)),setTimeout(async()=>{ui.nav.render()},200)});let ht=w;const he=class he{static init(){Hooks.on(P.RENDER_SIDE_BAR,he.onRender)}static applyFadeOut(e){he.useFadeOut=e,he.handleFadeOut()}static applyCustomStyle(e){var t;he.customStylesEnabled=e,u.log("applyCustomStyle",[he.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){he.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs"),he.handleFadeOut(e,t,n)}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");he.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),u.log("SidebarTabs handle fade out",[he.useFadeOut])}};h(he,"useFadeOut",!0),h(he,"customStylesEnabled",!0);let $t=he;var bt;const N=class N{static get(e,t=x){if(!e)return null;let n=!1;if(t===x)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,u.log("GET Setting",[a,n])}return n}static set(e,t,n=x){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),u.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{u.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s,i,r,c,d,p,m;const n=S();switch(t===void 0&&(t=N.get(e)),u.log("SettingsUtil.apply",[e,t,N.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:Pe.applyCustomStyle(t);break;case n.collapseMacroBar.tag:Pe.applyHotBarCollapse();break;case n.playerListAvatars.tag:Fe.applyAvatars();break;case n.autoHidePlayerList.tag:Fe.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:N.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:N.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:ne.currSettings.dockHeight=t,N.applyCameraHeight(t);break;case n.dockWidth.tag:ne.currSettings.dockWidth=t,N.applyCameraWidth(t);break;case n.dockPosX.tag:ne.currSettings.dockPosX=t,N.applyCameraPosX(t);break;case n.dockPosY.tag:ne.currSettings.dockPosY=t,N.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:ne.currSettings.defaultVideoWidth=t,ne.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:ne.currSettings.dockResizeOnUserJoin=t,ne.applyDockResize(t);break;case n.chatBorderColor.tag:dt.chatBorderColor=t,N.applyBorderColors();break;case n.useLeftChatBorder.tag:dt.useLeftChatBorder=t;case n.enableChatStyles.tag:dt.enableChatStyles=t,N.applyChatStyles();break;case n.debugMode.tag:N.applyDebugSettings();break;case n.navFoldersEnabled.tag:B.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:B.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:B.sceneClickToView=t,(a=ui.nav)==null||a.render(),(i=(s=game.scenes)==null?void 0:s.directory)==null||i.render();break;case n.useSceneIcons.tag:B.useSceneIcons=t,(r=ui.nav)==null||r.render(),(d=(c=game.scenes)==null?void 0:c.directory)==null||d.render();break;case n.useSceneBackButton.tag:B.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:B.useScenePreview=t,(m=ui.nav)==null||m.render();break;case n.navStartCollapsed.tag:B.navStartCollapsed=t;break;case n.showNavOnHover.tag:B.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:B.isCollapsed=N.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:N.applyThemeSettings();break;case n.customStyles.tag:N.applyCustomCSS();break;case n.adjustOtherModules.tag:N.applyModuleAdjustments(t);break;case n.otherModulesList.tag:N.applyOtherModulesList(t);break;case n.enablePlayerList.tag:Fe.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:B.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Pe.applyCustomStyle(t);break;case n.enableFloatingDock.tag:ne.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:$t.applyCustomStyle(t);break;case n.enableChatLogControls.tag:jt.applyCustomStyle(t);break;case n.enableSceneControls.tag:Wt.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:Wt.applyFadeOut(t);break;case n.playerListFadeOut.tag:Fe.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:$t.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:ne.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Pe.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:jt.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:B.applyFadeOut(t);break}}static applyBorderColors(){const e=S(),t=N.get(e.chatBorderColor.tag),n=document.querySelector("body");t===vt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===vt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=S(),t=N.get(e.enableChatStyles.tag),n=document.querySelector("body");u.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const n=S();N.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),u.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:N.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=S(),t=N.get(e.controlsIconSize.tag);document.querySelector("body");const n=Dt[t]?Dt[t].size:Dt.regular.size;function o(a){switch(a){case Dt.large.name:return"var(--font-size-18);";case Dt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}u.log("applyControlIconSize",[n]),A.addCSSVars("--icon-font-size",o(t)),A.addCSSVars("--control-item-size",n),N.applyLeftControlsSettings()}static applySceneNavPos(e){const t=S();B.navPos=e||N.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=S(),n=N.get(t.dockPosX.tag),o=e||n;ne.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=S(),n=N.get(t.dockPosY.tag),o=e||n;ne.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=S(),n=N.get(t.dockWidth.tag),o=e||n;ne.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=S(),n=N.get(t.dockHeight.tag),o=e||n;ne.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=S(),o=n.customFontsMenu.fields,a={};switch(u.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=N.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:A.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:A.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:A.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:A.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=S();u.debugOn=e||N.get(t.debugMode.tag)}};bt=new WeakMap,T(N,bt,!1),h(N,"firstLoad",!0),h(N,"registerSettings",async()=>{const e=S(),t=Object.entries(e);u.log("registerSettings - test",[t],!0),t.forEach(async d=>{const p=d[1];if(u.log("Registering... ",[d],!0),p.showOnRoot&&p.isMenu||!p.isMenu){const m={name:p.label,hint:p.hint,default:p.default,type:p.propType,scope:p.scope,config:p.config,requiresReload:p.requiresReload||!1,onChange:b=>N.apply(p.tag,b)};(p.choices||p.options)&&(m.choices=p.choices||p.options),await game.settings.register(x,p.tag,m),N.get(p.tag)===void 0&&(u.log("resetting...",[p.tag]),N.set(p.tag,p.default))}}),game.keybindings.register(x,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{N.hideInterface()},restricted:!1}),N.applyThemeSettings(),N.applyCustomCSS(),N.applyModuleAdjustments();const o=Object.entries(io()).find(d=>d[0]==="moduleSettingsMenu");if(o){const d=o[1],p={name:d.tag,label:d.label,hint:d.hint,icon:d.icon,type:d.propType,restricted:d.restricted};await game.settings.registerMenu(x,d.tag,p)}Hooks.on(P.RENDER_SCENE_CONTROLS,N.applyLeftControlsSettings),Hooks.on(P.RENDER_PLAYERS_LIST,Fe.applyPlayersListSettings),Hooks.on(P.RENDER_HOTBAR,()=>{Pe.applyCustomStyle(),N.firstLoad&&(N.firstLoad=!1,Pe.applyHotBarCollapse())}),N.applyDebugSettings(),N.applyChatStyles(),N.applyBorderColors(),e.sceneNavMenu.fields.forEach(d=>{N.apply(e[d].tag)}),e.cameraDockMenu.fields.forEach(d=>{N.apply(e[d].tag)}),e.customFontsMenu.fields.forEach(d=>{N.applyCustomFonts(e[d].tag)}),e.leftControlsMenu.fields.forEach(d=>{N.applyLeftControlsSettings(e[d].tag)}),e.interfaceOptionsMenu.fields.forEach(d=>{u.log("TEST",[d,e]),N.apply(e[d].tag)})}),h(N,"applyThemeSettings",e=>{const t=S(),n=e||N.get(t.colorTheme.tag)||"",o=document.querySelector("body");u.log("applyThemeSettings",[e,n,N.get(t.colorTheme.tag)]),oe.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),h(N,"applyCustomCSS",e=>{const t=S(),n=e||N.get(t.customStyles.tag)||"";A.addCustomCSS(n)}),h(N,"applyModuleAdjustments",e=>{const t=S();(e||N.get(t.adjustOtherModules.tag)||!1)&&ut.addModuleClasses()}),h(N,"applyOtherModulesList",e=>{const t=S(),n=e||N.get(t.otherModulesList.tag);u.log("applyOtherModulesList",[n]),n.split(",").length===0?(N.set(t.adjustOtherModules.tag,!1),N.set(t.otherModulesList.tag,"")):N.set(t.adjustOtherModules.tag,!0),ut.addModuleClasses()}),h(N,"hideInterface",()=>{u.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");y(N,bt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),D(N,bt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),D(N,bt,!0))});let E=N;const Vt=class Vt{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"https://github.com/crlngn/crlngn-ui/releases/latest/download/module-updates.json";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=S();E.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=S();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const o=await E.get(e.lastUpdateId.tag),a=await Vt.getIdFromRawJson();if(u.log("checkForUpdates...",[a,o]),o===a)return;const s=await fetch(Vt.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!s.ok){u.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const i=await s.json();await this.displayUpdateNews(i),E.set(e.lastUpdateId.tag,i.id),u.log("checkForUpdates | SUCCESS",[i.id])}catch(o){clearTimeout(n),o.name==="AbortError"?u.warn("checkForUpdates | Request timed out",[o]):u.warn("checkForUpdates | Fetch error",[o.message])}}catch(t){u.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;u.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});u.error("displayUpdateNews | Chat message created",[n,e])}catch(t){u.error("displayUpdateNews | Error creating chat message",[t])}}};h(Vt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let go=Vt;class Cs{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return u.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Pn;const He=class He{static init(){Hooks.once(P.INIT,()=>{var a,s;if(document.querySelector("body").classList.add(x),(a=document.querySelector("#ui-middle"))==null||a.classList.add(x),game.data.version<"13.339"){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion")),He.isIncompatible=!0;return}u.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},E.registerSettings();const n=S(),o=E.get(n.disableUI.tag);if(u.log(P.INIT,[o]),o){document.querySelector("body").classList.remove(x),(s=document.querySelector("#ui-middle"))==null||s.classList.remove(x);return}B.init(),ne.init(),Wt.init(),jt.init(),dt.init(),$t.init(),Fe.init(),Pe.init(),Hooks.on(P.RENDER_CHAT_MESSAGE,y(He,Pn))}),Hooks.once(P.READY,()=>{if(u.log("Core Ready",[]),He.isIncompatible)return;const e=S();var t=E.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Cs.init(),Fe.applyPlayersListSettings(),ut.init(),go.init(),E.get(e.enableChatStyles.tag)&&He.addCSSLocalization()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";A.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),A.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),A.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),A.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),A.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),A.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),A.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),A.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),A.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),A.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Pn=new WeakMap,h(He,"isIncompatible",!1),T(He,Pn,(e,t)=>{u.log(P.RENDER_CHAT_MESSAGE,[e,t]),dt.enrichCard(e,t)});let fo=He;fo.init();
//# sourceMappingURL=crlngn-ui.js.map
