var ka=Object.defineProperty;var Do=l=>{throw TypeError(l)};var Ma=(l,e,t)=>e in l?ka(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var y=(l,e,t)=>Ma(l,typeof e!="symbol"?e+"":e,t),Gn=(l,e,t)=>e.has(l)||Do("Cannot "+t);var m=(l,e,t)=>(Gn(l,e,"read from private field"),t?t.call(l):e.get(l)),T=(l,e,t)=>e.has(l)?Do("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),A=(l,e,t,n)=>(Gn(l,e,"write to private field"),n?n.call(l,t):e.set(l,t),t),x=(l,e,t)=>(Gn(l,e,"access private method"),t);const D={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged"},H="crlngn-ui",fn=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Rn=class Rn{static log(e="",t=[],n=!1){try{const o=Rn.debugOn;if(!(n||o))return;console.log(...fn,e,...t)}catch{console.log(...fn,e,...t)}}static warn(e="",t=[]){console.warn(...fn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...fn,e)}};y(Rn,"debugOn",!1);let f=Rn;const L={client:"client",world:"world"},Ot={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},yt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},De={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},zn=140,te=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(130, 110, 160)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function S(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:L.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList"],default:{sceneControlsFadeOut:!0,sidebarTabsFadeOut:!0,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!0,macroHotbarFadeOut:!0,sceneNavFadeOut:!0,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0},scope:L.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:L.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:{crux:!1,"monks-scene-navigation":!0,"combat-carousel":!0},customStyles:""},scope:L.world,config:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:yt.playerColor.name},scope:L.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:L.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:L.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:De.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:L.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navFoldersEnabled","navShowRootFolders","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useScenePreview"],default:{navFoldersEnabled:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,showNavOnHover:!1,useScenePreview:!0,useSceneBackButton:!0},scope:L.client,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:L.client,config:!0,default:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},navShowRootFolders:{tag:"nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavItemWidth:{tag:"scene-nav-item-width",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavItemWidth.hint"),propType:String,default:"",scope:L.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},useSceneBackButton:{tag:"use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:String,default:!0,scope:L.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:L.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:L.client,config:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:L.client,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},playerListAvatars:{tag:"player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:L.client,config:!1},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"",scope:L.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!1,scope:L.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','hurry-up','crux'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'"},scope:L.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:L.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:yt.playerColor.name,scope:L.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!0},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:L.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:L.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:L.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:L.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:L.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:De.horizontal.name,scope:L.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:L.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:L.world,config:!1,default:""},sceneControlsFadeOut:{tag:"scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:L.client,config:!1},sidebarTabsFadeOut:{tag:"sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:L.client,config:!1},chatLogControlsFadeOut:{tag:"chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:L.client,config:!1},playerListFadeOut:{tag:"player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:L.client,config:!1},cameraDockFadeOut:{tag:"camera-dock-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!0,scope:L.client,config:!1},macroHotbarFadeOut:{tag:"macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneNavFadeOut:{tag:"scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:L.client,config:!1},sceneControlsHide:{tag:"scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:L.client,config:!1},sidebarTabsHide:{tag:"sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:L.client,config:!1},chatLogControlsHide:{tag:"chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:L.client,config:!1},playerListHide:{tag:"player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:L.client,config:!1},cameraDockHide:{tag:"camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:L.client,config:!1},macroHotbarHide:{tag:"macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavHide:{tag:"scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:L.client,config:!1},sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:L.client,config:!1},enableSidebarTabs:{tag:"enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:L.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:L.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:L.client,config:!1}}}const{ApplicationV2:Oa,HandlebarsApplicationMixin:Aa}=foundry.applications.api;var ho,vt,jo,Wo;const Ne=class Ne extends Aa(Oa){static get DEFAULT_OPTIONS(){return{id:S().playersListMenu.tag,actions:{redefine:x(Ne,vt,Wo)},form:{handler:x(Ne,vt,jo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-user",title:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title")}_prepareContext(e){const t=S(),n=t.playersListMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}}),f.log("_prepareContext A",[o,n,a,s]);const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.playersListMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.playersListMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Ne.element=this.element,Ne.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ne.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.playersListMenu.tag);f.log("_onRender",[e,t,a])}};ho=new WeakMap,vt=new WeakSet,jo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.playersListMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Wo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.playersListMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.playersListMenu.default])},T(Ne,vt),T(Ne,ho),y(Ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/players-list-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Xn=Ne;const{ApplicationV2:Da,HandlebarsApplicationMixin:Pa}=foundry.applications.api;var Ct,$o,Yo,Yt,Kn;const Le=class Le extends Pa(Da){constructor(){super(...arguments);T(this,Yt)}static get DEFAULT_OPTIONS(){return{id:S().cameraDockMenu.tag,actions:{redefine:x(Le,Ct,Yo)},form:{handler:x(Le,Ct,$o),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(t){var c;const n=S(),o=n.cameraDockMenu.fields,a={},s={},i={};o.forEach(d=>{if(f.log("_prepareContext",[n[d].oldName]),n[d]){const p=E.get(n[d].tag);a[d]=n[d],s[d]=p!==void 0?p:n[d].default,i[d]=n[d].default}});const r={...s,default:{...i},isGM:(c=game.user)==null?void 0:c.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),Le.element=this.element,Le.element.querySelector(".toggle-hint").addEventListener("click",()=>{Le.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="enableFloatingDock"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",x(this,Yt,Kn).bind(this)),x(this,Yt,Kn).call(this,{target:a}))}};Ct=new WeakSet,$o=async function(t,n,o){const a=S();t.preventDefault(),t.stopPropagation();const s=a.cameraDockMenu.fields,i=o.object;s.forEach(p=>{a[p].inputType==="checkbox"&&!i.hasOwnProperty(p)&&(i[p]=!1)});const r=foundry.utils.expandObject(i),c=E.get(a.enableFloatingDock.tag);f.log("Compared settings:",[r.enableFloatingDock,c]),s.forEach(p=>{f.log("Saving setting >>",[a[p].tag,r[p]]),r[p]!==void 0&&E.set(a[p].tag,r[p])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),r.enableFloatingDock!==c&&location.reload()},Yo=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.cameraDockMenu.fields,r={};i.forEach(c=>{o[c]&&(o[c],r[c]=o[c].default)}),s.forEach(c=>{c.value=r[c.name]}),f.log("#onReset",[t,n,o.cameraDockMenu.default])},Yt=new WeakSet,Kn=function(t){var a,s;const n=(a=this.element)==null?void 0:a.querySelectorAll('input:not([name="enableFloatingDock"])');n.forEach(i=>i.disabled=!t.target.checked);const o=(s=this.element)==null?void 0:s.querySelectorAll("select");o.forEach(i=>i.disabled=!t.target.checked),f.log("onDockEnabledChange",[this.element,n,o])},T(Le,Ct),y(Le,"element"),y(Le,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Jn=Le;const{ApplicationV2:Fa,HandlebarsApplicationMixin:Ga}=foundry.applications.api;var mo,Et,Xo,Jo;const Te=class Te extends Ga(Fa){static get DEFAULT_OPTIONS(){return{id:S().chatMessagesMenu.tag,actions:{redefine:x(Te,Et,Jo)},form:{handler:x(Te,Et,Xo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var r;const t=S(),n=t.chatMessagesMenu.fields,o={},a={},s={};n.forEach(c=>{if(f.log("_prepareContext",[t[c].oldName]),t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),f.log("_prepareContext",[a,s]);const i={...a,default:{...s},isGM:(r=game.user)==null?void 0:r.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Te.element=this.element,Te.element.querySelector(".toggle-hint").addEventListener("click",()=>{Te.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.chatMessagesMenu.tag);f.log("_onRender",[e,t,a])}};mo=new WeakMap,Et=new WeakSet,Xo=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.chatMessagesMenu.fields,s=n.object;a.forEach(d=>{o[d].inputType==="checkbox"&&!s.hasOwnProperty(d)&&(s[d]=!1)});const i=foundry.utils.expandObject(s),r=E.get(o.chatBorderColor.tag);f.log("Compared settings:",[i.chatBorderColor,r]),a.forEach(d=>{f.log("Saving setting >>",[o[d].tag,i[d]]),i[d]!==void 0&&E.set(o[d].tag,i[d])}),i.chatBorderColor!==r&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Jo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.chatMessagesMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(Te,Et),T(Te,mo),y(Te,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Zn=Te;const qt=class qt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const i=s.style.getPropertyValue("font-family");i&&(t.add(i),f.log("Found font-face rule:",[i]))}else if(s instanceof CSSImportRule){if(f.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const r=await(await fetch(s.href)).text();this.extractFontsFromCSSText(r,t)}catch(i){f.warn("Error fetching imported CSS:",[i])}}}}catch(o){if(o.name==="SecurityError"&&e.href){f.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){f.warn("Error fetching cross-origin stylesheet:",[a])}}else f.warn("Error accessing CSS rules:",[o])}}catch(o){f.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs,o=e.match(n)||[];f.log("Font face matches in CSS text:",[o.length]),o.forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,i=a.match(s);if(i&&i[2]){const r=i[2].trim();t.add(r),f.log("Found font-face in CSS text:",[r])}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return f.log("getOffsetBottom",[t,n,window.innerHeight]),window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const r=o.substring(a+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),c={};r.forEach(h=>{const b=h.split(":");if(b.length>=2){const C=b[0].trim(),I=b.slice(1).join(":").trim();C&&(c[C]=I)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const d=Object.entries(c).map(([h,b])=>`  ${h}: ${b};`).join(`
`),p=o.substring(0,a)+`body.crlngn-ui {
`+d+`
}`+o.substring(s+1);n.textContent=p}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const n=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,n.appendChild(t)}t.textContent=e}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const i=n==="horizontal",r=i?e.scrollLeft:e.scrollTop,c=t-r;if(c===0)return a&&a(),null;const d=performance.now(),p=b=>{const C=b-d;if(C>=o){i?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const I=C/o,U=I<.5?2*I*I:1-Math.pow(-2*I+2,2)/2;i?e.scrollLeft=r+c*U:e.scrollTop=r+c*U;const B=requestAnimationFrame(p);return e.dataset.scrollAnimationId=B,B},h=requestAnimationFrame(p);return e.dataset.scrollAnimationId=h,h}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const o={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(f.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(o,n),foundry.applications.api.DialogV2.confirm(o)}};y(qt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions));f.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s);f.log("Stylesheets:",[document.styleSheets]);const o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const i=s.href||"",r=i.includes("css/")||i.includes("styles/"),c=i.includes("modules/crlngn-ui/"),d=i.includes("systems/");if(i&&!r&&!c&&!d){f.log("Skipping stylesheet:",[i]);continue}f.log("Processing stylesheet:",[s,i]),await qt.processStyleSheetRules(s,o)}}catch(i){f.warn("Error processing stylesheet:",[i])}return f.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,i)=>s.toLowerCase().localeCompare(i.toLowerCase()))}),y(qt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let F=qt;const{ApplicationV2:za,HandlebarsApplicationMixin:xa}=foundry.applications.api;var yo,Ye,Ko,Zo,Qo;const le=class le extends xa(za){static get DEFAULT_OPTIONS(){return{id:S().customFontsMenu.tag,actions:{redefine:x(le,Ye,Qo)},form:{handler:x(le,Ye,Ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=S(),n=t.customFontsMenu.fields,o={},a={},s={},i=await F.getAllFonts();return n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:i,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){le.element=this.element,le.element.querySelector(".toggle-hint").addEventListener("click",()=>{le.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))}),le.element.querySelectorAll('input[type="text"]').forEach(s=>{const i=s.closest(".dropdown-wrapper"),r=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!r)return;const c=()=>{var d;x(d=le,Ye,Zo).call(d),r.classList.add("active")};s.addEventListener("focus",c),s.addEventListener("click",c),s.addEventListener("keydown",d=>{const p=r.classList.contains("active"),h=Array.from(r.querySelectorAll(".dropdown-option"));let b=h.findIndex(C=>C.classList.contains("highlighted"));d.key==="ArrowDown"||d.key==="ArrowUp"?(d.preventDefault(),p||r.classList.add("active"),h.forEach(C=>C.classList.remove("highlighted")),b===-1?b=d.key==="ArrowDown"?0:h.length-1:b=d.key==="ArrowDown"?(b+1)%h.length:(b-1+h.length)%h.length,h[b]&&(h[b].classList.add("highlighted"),h[b].scrollIntoView({block:"nearest"}))):d.key==="Enter"?(d.preventDefault(),p&&b!==-1&&h[b]&&h[b].click()):d.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",d=>{i.contains(d.target)||r.classList.remove("active")})}),le.element.querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",i=>{const r=s.closest(".dropdown-wrapper").querySelector("input");let c=s.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),r.value=c,s.closest(".dropdown-options").classList.remove("active")})})}};yo=new WeakMap,Ye=new WeakSet,Ko=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.customFontsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Zo=function(){le.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Qo=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.customFontsMenu.fields,i={};s.forEach(r=>{n[r]&&(n[r],i[r]=n[r].default)}),a.forEach(r=>{r.value=i[r.name]})},T(le,Ye),T(le,yo),y(le,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Qn=le;const{ApplicationV2:Ua,HandlebarsApplicationMixin:qa}=foundry.applications.api;var So,Nt,_o,ea;const we=class we extends qa(Ua){static get DEFAULT_OPTIONS(){return{id:S().leftControlsMenu.tag,actions:{redefine:x(we,Nt,ea)},form:{handler:x(we,Nt,_o),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=S(),n=t.leftControlsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();we.element=this.element,we.element.querySelector(".toggle-hint").addEventListener("click",()=>{we.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.leftControlsMenu.tag);f.log("_onRender",[e,t,a])}};So=new WeakMap,Nt=new WeakSet,_o=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.leftControlsMenu.fields,s=foundry.utils.expandObject(n.object);a.forEach(i=>{s[i]!==void 0&&(f.log("Saving setting:",[s[i]]),E.set(o[i].tag,s[i]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ea=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.leftControlsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.leftControlsMenu.default])},T(we,Nt),T(we,So),y(we,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let _n=we;const{ApplicationV2:Ha,HandlebarsApplicationMixin:Ba}=foundry.applications.api;var bo,Lt,ta,na,Xt,to;const Ie=class Ie extends Ba(Ha){constructor(){super(...arguments);T(this,Xt)}static get DEFAULT_OPTIONS(){return{id:S().sceneNavMenu.tag,actions:{redefine:x(Ie,Lt,na)},form:{handler:x(Ie,Lt,ta),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(t){const n=S(),o=n.sceneNavMenu.fields,a={},s={},i={};o.forEach(c=>{if(n[c]){const d=E.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}});const r={...s,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[r,t]),r}async _preparePartContext(t,n){return n.partId=`${t}-${this.id}`,f.log("_preparePartContext",[t,n]),n}_onRender(t,n){var s;f.log("_onRender",[t,n]),Ie.element=this.element,Ie.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ie.element.querySelectorAll("p.hint").forEach(i=>i.classList.toggle("shown"))});const a=(s=this.element)==null?void 0:s.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender",[this.element,a]),a&&(a.addEventListener("change",x(this,Xt,to).bind(this)),x(this,Xt,to).call(this,{target:a}))}};bo=new WeakMap,Lt=new WeakSet,ta=async function(t,n,o){t.preventDefault(),t.stopPropagation();const a=S(),s=a.sceneNavMenu.fields;let i=E.get(a.sceneNavEnabled.tag);const r=foundry.utils.expandObject(o.object);s.forEach(d=>{r[d]!==void 0&&(f.log("Saving setting:",[r[d]]),E.set(a[d].tag,r[d]))});let c=E.get(a.sceneNavEnabled.tag);f.log("Saving settings...",[i,c]),await E.set(a.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i!==c&&location.reload()},na=async function(t,n){const o=S(),s=this.element.querySelectorAll("input, select"),i=o.sceneNavMenu.default;s.forEach(r=>{r.value=i[r.name],r.type==="checkbox"&&(r.checked=i[r.name])}),f.log("#onReset",[t,n,o.sceneNavMenu.default])},Xt=new WeakSet,to=function(t){var o;const n=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');n.forEach(a=>a.disabled=!t.target.checked),f.log("onSceneNavEnabledChange",[this.element,n])},T(Ie,Lt),T(Ie,bo),y(Ie,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let eo=Ie;const{ApplicationV2:Va,HandlebarsApplicationMixin:ja}=foundry.applications.api;var vo,Co,Xe,oa,aa,sa;const Z=class Z extends ja(Va){static get DEFAULT_OPTIONS(){return{id:S().themeAndStylesMenu.tag,actions:{redefine:x(Z,Xe,sa)},form:{handler:x(Z,Xe,oa),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=S(),n=t.themeAndStylesMenu.fields,o={},a={},s={};n.forEach(c=>{if(t[c]){const d=E.get(t[c].tag);o[c]=t[c],a[c]=d!==void 0?d:t[c].default,s[c]=t[c].default}});const i=te.find(c=>c.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||te[0].label;const r={...a,default:{...s},fields:{...o},selectedTheme:i,themes:te,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){Z.element=this.element,Z.element.querySelector(".toggle-hint").addEventListener("click",()=>{Z.element.querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))}),this._themes=te,Z.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(d=>{const p=d.closest(".dropdown-wrapper"),h=p==null?void 0:p.querySelector(".dropdown-options");if(!p||!h)return;const b=()=>{var C;x(C=Z,Xe,aa).call(C),h.classList.add("active")};d.addEventListener("focus",b),d.addEventListener("click",b),d.addEventListener("keydown",C=>{const I=h.classList.contains("active"),U=Array.from(h.querySelectorAll(".dropdown-option"));let B=U.findIndex(K=>K.classList.contains("highlighted"));C.key==="ArrowDown"||C.key==="ArrowUp"?(C.preventDefault(),I||h.classList.add("active"),U.forEach(K=>K.classList.remove("highlighted")),B===-1?B=C.key==="ArrowDown"?0:U.length-1:B=C.key==="ArrowDown"?(B+1)%U.length:(B-1+U.length)%U.length,U[B]&&(U[B].classList.add("highlighted"),U[B].scrollIntoView({block:"nearest"}))):C.key==="Enter"?(C.preventDefault(),I&&B!==-1&&U[B]&&U[B].click()):C.key==="Escape"&&h.classList.remove("active")}),document.addEventListener("click",C=>{p.contains(C.target)||h.classList.remove("active")})});const a=Z.element.querySelectorAll(".dropdown-option"),s=this;a.forEach(d=>{d.addEventListener("mouseenter",()=>{d.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),d.classList.add("highlighted")}),d.addEventListener("click",function(p){f.log("option",[d,d.querySelector(".theme-name")]);const h=d.closest(".dropdown-wrapper").querySelector("input");let b=d.querySelector(".theme-name").innerHTML.toString();if(h.value=b,h.name==="colorTheme"){const I=s._themes.find(U=>U.label===b);s._selectedTheme=I,s._updateThemePreview(I)}d.closest(".dropdown-options").classList.remove("active")})});const i=Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),r=Z.element.querySelector("input.otherModulesList");i.forEach(d=>{d.addEventListener("change",p=>{const h=p.currentTarget;let C=`${r.value}`.split(",")||[],I=C.indexOf(h.value);!p.currentTarget.checked&&I>-1?C.splice(I,1):p.currentTarget.checked&&I===-1&&C.push(h.value),r.value=C.join(","),f.log("checkbox changed",[C,r.value])})}),Z.element.querySelector("input.adjustOtherModules").addEventListener("change",d=>{Z.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(h=>{h.checked=d.currentTarget.checked;const b=new Event("change",{bubbles:!0});h.dispatchEvent(b)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((n,o)=>{n.style.setProperty("background-color",e.colorPreview[o])})}};vo=new WeakMap,Co=new WeakMap,Xe=new WeakSet,oa=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const a=o.themeAndStylesMenu.fields,s=foundry.utils.expandObject(n.object),i=te.find(r=>r.label===s.colorTheme);s.colorTheme=i?i.className:"",a.forEach(r=>{s[r]!==void 0&&(f.log("Saving setting:",[s[r]]),E.set(o[r].tag,s[r]))}),E.set(o.themeAndStylesMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},aa=function(){Z.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},sa=async function(e,t){const n=S(),a=this.element.querySelectorAll("input[type=text]"),s=n.themeAndStylesMenu.fields,i={};s.forEach(c=>{n[c]&&(n[c],i[c]=n[c].default)});const r=te.find(c=>c.label===n.colorTheme.default);i.colorTheme=(r==null?void 0:r.label)||te[0].label,a.forEach(c=>{c.value=i[c.name]})},T(Z,Xe),T(Z,vo),T(Z,Co,!1),y(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let no=Z;const{ApplicationV2:Wa,HandlebarsApplicationMixin:$a}=foundry.applications.api;var Eo,Tt,ia,ra;const Re=class Re extends $a(Wa){static get DEFAULT_OPTIONS(){return{id:S().interfaceOptionsMenu.tag,actions:{redefine:x(Re,Tt,ra)},form:{handler:x(Re,Tt,ia),closeOnSubmit:!0},position:{width:540,height:"auto"},tag:"form",window:{icon:"fas fa-table",title:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title")}_prepareContext(e){const t=S(),n=t.interfaceOptionsMenu.fields,o={},a={},s={};n.forEach(r=>{if(t[r]){const c=E.get(t[r].tag);o[r]=t[r],a[r]=c!==void 0?c:t[r].default,s[r]=t[r].default}});const i={...a,default:{...s},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.interfaceOptionsMenu.save"}]};return f.log("_prepareContext",[i,e]),i}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S();Re.element=this.element,Re.element.querySelector(".toggle-hint").addEventListener("click",()=>{Re.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))});const a=E.get(n.interfaceOptionsMenu.tag);f.log("_onRender",[e,t,a])}};Eo=new WeakMap,Tt=new WeakSet,ia=async function(e,t,n){e.preventDefault(),e.stopPropagation();const o=S(),a=o.interfaceOptionsMenu.fields;let s=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag);const i=foundry.utils.expandObject(n.object);a.forEach(c=>{i[c]!==void 0&&(f.log("Saving setting:",[i[c]]),E.set(o[c].tag,i[c]))});let r=E.get(o.sceneNavEnabled.tag);E.get(o.navFoldersEnabled.tag),f.log("Saving settings...",[s,r]),await E.set(o.sceneNavMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s!==r&&location.reload()},ra=async function(e,t){const n=S(),a=this.element.querySelectorAll("input, select"),s=n.interfaceOptionsMenu.default;a.forEach(i=>{i.value=s[i.name],i.type==="checkbox"&&(i.checked=s[i.name])}),f.log("#onReset",[e,t,n.interfaceOptionsMenu.default])},T(Re,Tt),T(Re,Eo),y(Re,"PARTS",{content:{template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let oo=Re;const{ApplicationV2:Ya,HandlebarsApplicationMixin:Xa}=foundry.applications.api;var Vo,No,tt,Lo,ae,la,ca,da,so,io,ua;const M=class M extends Xa(Ya){constructor(){super(...arguments);y(this,"_onRender",(t,n)=>{S(),M.element=this.element;const o=M.element.querySelectorAll(".toggle-hint");f.log("_onRender",[t,n,this.element]),o.forEach(a=>{a.addEventListener("click",()=>{M.element.querySelectorAll("p.hint").forEach(s=>s.classList.toggle("shown"))})}),M.handleCustomFontFields(),M.handleThemeAndStyleFields(),f.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),o=M.getRestrictedTabs();return game.user.isGM||o.forEach(a=>{delete n[a]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0];const o=S(),a=o.themeAndStylesMenu.fields,s={};a.forEach(c=>{if(o[c]){const d=E.get(o[c].tag);s[c]=d!==void 0?d:o[c].default}});const i=te.find(c=>c.className===s.colorTheme);f.log("selectedTheme",[i==null?void 0:i.label,te[0].label]),s.colorTheme=(i==null?void 0:i.label)||te[0].label,n.selectedTheme=i,n.themes=te;const r=await F.getAllFonts();return n.fontList=r,n}async _preparePartContext(t,n,o){var i;const a=await super._preparePartContext(t,n,o);t in n.tabs&&(a.tab=a.tabs[t]),S(),ro();const s=M.getRestrictedTabs();switch(game.user.isGM||s.forEach(r=>{delete a.tabs[r]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const r=((i=M.PARTS[t])==null?void 0:i.menuKey)||null;if(r){const c=M.getMenuContext(r);if(c.fields&&(a.fields={...a.fields,...c.fields}),c.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...c.fieldDefaults}),c.fieldValues){if(t==="themes"){const d=te.find(p=>p.className===c.fieldValues.colorTheme);f.log("selectedTheme",[d==null?void 0:d.label,te[0].label]),c.fieldValues.colorTheme=(d==null?void 0:d.label)||te[0].label}Object.assign(a,c.fieldValues)}}break}}return f.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var r;const n=S(),o=((r=n[t])==null?void 0:r.fields)||null;if(!o)return{};const a={},s={},i={};return o.forEach(c=>{if(n[c]){const d=E.get(n[c].tag);a[c]=n[c],s[c]=d!==void 0?d:n[c].default,i[c]=n[c].default}}),{fields:a,fieldValues:s,fieldDefaults:i}}static getRestrictedTabs(){const t=ro(),n=[];return Object.entries(t).forEach((o,a)=>{o[0]!=="moduleSettingsMenu"&&o[1].restricted&&n.push(o[0])}),n}changeTab(t,n,o){super.changeTab(t,n,o),A(M,tt,t),f.log("changeTab",[t,n,m(M,tt)])}static handleCustomFontFields(){const t=M.element.querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),i=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!i)return;const r=()=>{var c;x(c=M,ae,so).call(c),i.classList.add("active")};a.addEventListener("focus",r),a.addEventListener("click",r),f.log("handleCustomFontFields",[a,s,i]),a.addEventListener("keydown",x(M,ae,io)),document.addEventListener("click",c=>{s.contains(c.target)||i.classList.remove("active")})}),M.element.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let r=a.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),i.value=r,a.closest(".dropdown-options").classList.remove("active")})})}static handleThemeAndStyleFields(){const t=M.element.querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll('input[type="text"]:not([hidden])').forEach(r=>{const c=r.closest(".dropdown-wrapper"),d=c==null?void 0:c.querySelector(".dropdown-options");if(!c||!d)return;const p=()=>{var h;x(h=M,ae,so).call(h),d.classList.add("active")};r.addEventListener("focus",p),r.addEventListener("click",p),r.addEventListener("keydown",x(M,ae,io)),document.addEventListener("click",h=>{c.contains(h.target)||d.classList.remove("active")})}),M.element.querySelectorAll(".dropdown-option").forEach(r=>{r.addEventListener("mouseenter",()=>{r.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(d=>d.classList.remove("highlighted")),r.classList.add("highlighted")}),r.addEventListener("click",function(c){var b;f.log("option",[r,r.querySelector(".theme-name")]);const d=r.closest(".dropdown-wrapper").querySelector("input");let p=r.querySelector(".theme-name").innerHTML.toString();if(d.value=p,d.name==="colorTheme"){const C=te.find(I=>I.label===p);x(b=M,ae,ua).call(b,C)}r.closest(".dropdown-options").classList.remove("active")})});const a=M.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),s=M.element.querySelector("input.otherModulesList");a.forEach(r=>{r.addEventListener("change",c=>{const d=c.currentTarget;let h=`${s.value}`.split(",")||[],b=h.indexOf(d.value);!c.currentTarget.checked&&b>-1?h.splice(b,1):c.currentTarget.checked&&b===-1&&h.push(d.value),s.value=h.join(","),f.log("checkbox changed",[h,s.value])})}),M.element.querySelector("input.adjustOtherModules").addEventListener("change",r=>{M.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(d=>{d.checked=r.currentTarget.checked;const p=new Event("change",{bubbles:!0});d.dispatchEvent(p)})})}};No=new WeakMap,tt=new WeakMap,Lo=new WeakMap,ae=new WeakSet,la=async function(t,n,o){let a=!1;const s=S();t.preventDefault(),t.stopPropagation();const c=M.element.querySelector(".form-content.active").dataset.tab;A(M,tt,c);const d=M.PARTS[c].menuKey;if(!d){console.warn("onSubmit",["menuKey not defined"]);return}const p=foundry.utils.expandObject(o.object),h=s[d].fields||[];if(d===M.PARTS.themes.menuKey){const b=te.find(C=>C.label===p.colorTheme);p.colorTheme=b?b.className:""}h.forEach(b=>{var C;if(p[b]!==void 0){const I=E.set(s[b].tag);f.log("Saving setting:",[p[b]]),E.set(s[b].tag,p[b]),(C=s[b])!=null&&C.requiresReload&&I!==p[b]&&(a=!0)}}),f.log("#onSubmit",[t,n,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a&&F.confirmReload()},ca=async function(t,n){const o=S(),s=M.element.querySelector(".form-content.active"),i=s.dataset.tab,r=M.PARTS[i].menuKey,c=o[r].default;s.querySelectorAll("input, select").forEach(p=>{p.value=c[p.name],p.type==="checkbox"&&(p.checked=c[p.name])}),f.log("#onReset",[m(M,tt),i,t,n])},da=function(){const t=[];return Object.entries(M.PARTS).forEach(([n,o])=>{o.menuKey&&t.push({id:n,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${n}`})}),f.log("getTabs",[t]),t},so=function(){M.element.querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},io=function(t){const n=t.target.closest(".dropdown-wrapper"),o=n==null?void 0:n.querySelector(".dropdown-options"),a=o.classList.contains("active"),s=Array.from(o.querySelectorAll(".dropdown-option"));let i=s.findIndex(r=>r.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||o.classList.add("active"),s.forEach(r=>r.classList.remove("highlighted")),i===-1?i=t.key==="ArrowDown"?0:s.length-1:i=t.key==="ArrowDown"?(i+1)%s.length:(i-1+s.length)%s.length,s[i]&&(s[i].classList.add("highlighted"),s[i].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&i!==-1&&s[i]&&s[i].click()):t.key==="Escape"&&o.classList.remove("active")},ua=function(t){if(f.log("Selected theme updated:",[t]),!t)return;this.element.querySelectorAll("span.selected-theme").forEach((o,a)=>{o.style.setProperty("background-color",t.colorPreview[a])})},T(M,ae),T(M,No),T(M,tt),T(M,Lo),y(M,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:640,height:"auto"},actions:{redefine:x(M,ae,ca)},form:{handler:x(M,ae,la),closeOnSubmit:!0}}),y(M,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs"},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs"},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs"},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}}),y(M,"TABS",{primary:{initial:"interface",tabs:x(Vo=M,ae,da).call(Vo),labelPrefix:""}});let ao=M;function ro(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:ao,restricted:!1},interfaceOptionsMenu:{tab:"interface",tag:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),icon:"fas fa-table-layout",propType:oo,restricted:!1},customFontsMenu:{tab:"fonts",tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-font",propType:Qn,restricted:!0},themeAndStylesMenu:{tab:"themes",tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:no,restricted:!1},chatMessagesMenu:{tab:"chat",tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Zn,restricted:!1},leftControlsMenu:{tab:"controls",tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:_n,restricted:!1},sceneNavMenu:{tab:"scenes",tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:eo,restricted:!1},playersListMenu:{tab:"players",tag:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),icon:"fas fa-users",propType:Xn,restricted:!1},cameraDockMenu:{tab:"camera",tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Jn,restricted:!1}}}var nt,Be,Jt,Kt,Zt,Qt,_t,en,tn,nn,ot,on,an;const g=class g{static applyFadeOut(e){g.useFadeOut=e}static applyCustomStyle(e){var t;g.enableFloatingDock=e,f.log("applyCustomStyle",[g.enableFloatingDock,ui,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=S();g.enableFloatingDock=E.get(e.enableFloatingDock.tag),g.currSettings={enableFloatingDock:g.enableFloatingDock,defaultVideoWidth:E.get(e.defaultVideoWidth.tag),dockHeight:E.get(e.dockHeight.tag),dockWidth:E.get(e.dockWidth.tag),dockPosX:E.get(e.dockPosX.tag),dockPosY:E.get(e.dockPosY.tag),dockResizeOnUserJoin:E.get(e.dockResizeOnUserJoin.tag)},g.enableFloatingDock?(g.positionIntervalId&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null),Hooks.on(D.RENDER_CAMERA_VIEWS,g.onRenderFloating),Hooks.on(D.RENDER_PLAYERS_LIST,g.onRenderPlayersList),Hooks.on(D.CLIENT_SETTING_CHANGED,t=>{f.log("Setting updated",[t]),t.includes("rtcClientSettings")&&g.checkMinimizedState()})):(Hooks.on(D.RENDER_CAMERA_VIEWS,g.onRenderPlain),g.onRenderPlain())}static onRenderPlain(e,t){var n;g.cameraContainer||(g.cameraContainer=document.querySelector("#av-holder")),(n=g.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){S();const o=g.currSettings,a=document.querySelector("#camera-views");if(g.cameraContainer=document.querySelector("#av-holder"),g.cameraContainer)g.cameraContainer.appendChild(a);else{const c=document.createElement("div");g.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}g.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const d=game.users.get(c.dataset.user),p=(d==null?void 0:d.color)||"";f.log("player color",[d,p]),c.style.setProperty("--player-color",p)}),f.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const r=game.settings.get("core","rtcClientSettings");(r==null?void 0:r.hideDock)!==!0?(g.checkMinimizedState(),g.applyDockResize(o.dockResizeOnUserJoin),g.makeDraggable(),g.makeResizeable(),g.applyVideoWidth(),g.resetPositionAndSize()):g.checkMinimizedState()}static onRenderPlayersList(){f.log("onRenderPlayersList")}static applyPositionWithDelay(){g.positionIntervalId&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null),g.resetPositionAndSize();let e=0;g.positionIntervalId=setInterval(()=>{g.resetPositionAndSize(),e++,e>=g.positionAttempts&&(clearInterval(g.positionIntervalId),g.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=S(),n=E.get(t.defaultVideoWidth.tag);let o=e||n;if(o<zn)o=zn,E.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){g.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",o+"px"),s.style.setProperty("--av-width",o+"px")),g.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){S();const a=g.currSettings;if(!g.enableFloatingDock||!g.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){g.checkMinimizedState();return}if(f.log("CameraDock",[a]),!e&&!t&&!n&&!o){const i=a.dockPosX||0,r=a.dockPosY||0;if(g.cameraContainer.style.left=`${i}px`,g.cameraContainer.style.bottom=`${r}px`,g.currSettings.dockResizeOnUserJoin===De.off.name){const c=a.dockWidth||0,d=a.dockHeight||0;g.cameraContainer.style.width=`${c}px`,g.cameraContainer.style.height=`${d}px`}}else e!==null&&(g.cameraContainer.style.left=`${e}px`),t!==null&&(g.cameraContainer.style.bottom=`${t}px`),g.currSettings.dockResizeOnUserJoin===De.horizontal.name?n!==null&&(g.cameraContainer.style.width=`${n}px`):g.currSettings.dockResizeOnUserJoin===De.vertical.name&&o!==null&&(g.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=g.cameraContainer)==null||e.addEventListener("mousedown",n=>{var r,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(f.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(r=n.target.parentNode)!=null&&r.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",m(g,en)),a==null||a.addEventListener("mouseup",m(g,tn)),o))return;const s=F.getOffsetBottom(g.cameraContainer);let i=((c=g.cameraContainer)==null?void 0:c.offsetLeft)||0;g.isDragging=!0,A(g,nt,n.clientX-i),A(g,Be,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=g.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,d;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",m(g,nn)),a.addEventListener("touchend",m(g,ot)),a.addEventListener("touchcancel",m(g,ot)),o))return;const s=n.touches[0],i=F.getOffsetBottom(g.cameraContainer);let r=((d=g.cameraContainer)==null?void 0:d.offsetLeft)||0;g.isDragging=!0,A(g,nt,s.clientX-r),A(g,Be,window.innerHeight-s.clientY-i),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var r,c;if(!g.cameraContainer)return;const e=S(),t=g.currSettings.dockResizeOnUserJoin,n=g.currSettings.defaultVideoWidth||zn,a=(((c=(r=game.webrtc)==null?void 0:r.users)==null?void 0:c.filter(d=>d.active&&d.canBroadcastVideo))||[]).length;if(a===0)return;if(t===De.horizontal.name){const d=n*a+16;g.cameraContainer.style.width=`${d}px`}else if(t===De.vertical.name){const d=n*a+16;g.cameraContainer.style.height=`${d}px`}const s=parseInt(g.cameraContainer.style.width||0),i=parseInt(g.cameraContainer.style.height||0);s>0&&E.set(e.dockWidth.tag,s),i>0&&E.set(e.dockHeight.tag,i)}static applyDockResize(e=null){if(!g.cameraContainer)return;e?g.currSettings.dockResizeOnUserJoin=e:e=g.currSettings.dockResizeOnUserJoin,g.cameraContainer.classList.remove("horizontal"),g.cameraContainer.classList.remove("vertical");const t=g.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===De.horizontal.name?g.cameraContainer.classList.add("horizontal"):e===De.vertical.name&&g.cameraContainer.classList.add("vertical"),g.updateDockSize()}static makeResizeable(){if(g.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=g.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),g.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),g.isResizing=!0,A(g,Jt,o.clientX),A(g,Kt,o.clientY),A(g,_t,parseInt(getComputedStyle(g.cameraContainer).bottom)||0),A(g,Zt,g.cameraContainer.offsetWidth),A(g,Qt,g.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(g,on)),e==null||e.addEventListener("mouseup",m(g,an))})}}static checkMinimizedState(){if(!g.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),f.log("Checking minimized state",[e,t]),g.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=g.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!g.cameraContainer)return;if(f.log("handleMinimizedState",[e]),e)g.cameraContainer.parentNode!==t&&(g.originalParent=g.cameraContainer.parentNode,t.prepend(g.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!g.originalParent)return;g.originalParent.prepend(g.cameraContainer),g.makeDraggable(),g.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),f.log("Restored camera position from settings",[g.currSettings])}const o=(a=g.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};nt=new WeakMap,Be=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,_t=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,ot=new WeakMap,on=new WeakMap,an=new WeakMap,T(g,nt,0),T(g,Be,0),y(g,"isDragging",!1),y(g,"cameraContainer"),y(g,"isResizing",!1),T(g,Jt,0),T(g,Kt,0),T(g,Zt,0),T(g,Qt,0),T(g,_t,0),y(g,"currSettings",{}),y(g,"positionIntervalId",null),y(g,"positionAttempts",5),y(g,"useFadeOut",!0),y(g,"enableFloatingDock",!0),T(g,en,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!g.isDragging||t)){if(f.log("mousemove",[window.innerHeight,e.clientY,m(g,Be)]),g.cameraContainer){let n=e.clientX-m(g,nt),o=window.innerHeight-e.clientY-m(g,Be);n+g.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-g.cameraContainer.offsetWidth),n<0&&(n=0),g.cameraContainer.style.left=`${n}px`,o+g.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-g.cameraContainer.offsetHeight),g.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(g,tn,e=>{var a,s;const t=S(),n={...g.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(g.isDragging&&!o){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=g.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=g.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),i==null||i.removeEventListener("mousemove",m(g,en)),i==null||i.removeEventListener("mouseup",m(g,tn)),g.isDragging=!1,e.stopPropagation()}}),T(g,nn,e=>{if(!(!g.isDragging||!e.touches[0])){if(g.cameraContainer){const t=e.touches[0];let n=t.clientX-m(g,nt),o=window.innerHeight-t.clientY-m(g,Be);n+g.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-g.cameraContainer.offsetWidth),n<0&&(n=0),g.cameraContainer.style.left=`${n}px`,o+g.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-g.cameraContainer.offsetHeight),g.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),T(g,ot,e=>{var o,a;const t=S(),n={...g.currSettings};if(g.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=g.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=g.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),E.set(t.dockPosX.tag,n.dockPosX),E.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",m(g,nn)),s==null||s.removeEventListener("touchend",m(g,ot)),s==null||s.removeEventListener("touchcancel",m(g,ot)),g.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),T(g,on,e=>{if(!g.isResizing)return;const t=m(g,Zt)+(e.clientX-m(g,Jt)),n=e.clientY-m(g,Kt),o=m(g,Qt)+n,a=m(g,_t)-n;g.cameraContainer.style.width=`${t}px`,g.cameraContainer.style.height=`${o}px`,g.cameraContainer.style.bottom=`${a}px`}),T(g,an,()=>{var o,a,s,i,r,c,d;const e=S(),t={...g.currSettings},n=document.querySelector("body.crlngn-ui");g.isResizing=!1,n==null||n.removeEventListener("mousemove",m(g,on)),n==null||n.removeEventListener("mouseup",m(g,an)),f.log("onStopResize",[(o=g.cameraContainer)==null?void 0:o.style.width,(a=g.cameraContainer)==null?void 0:a.style.height,(s=g.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((i=g.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((r=g.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((c=g.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((d=g.cameraContainer)==null?void 0:d.style.left)||0),E.set(e.dockWidth.tag,t.dockWidth),E.set(e.dockHeight.tag,t.dockHeight),E.set(e.dockPosY.tag,t.dockPosY),E.set(e.dockPosX.tag,t.dockPosX)});let ee=g;const Q=class Q{static init(){Hooks.on(D.RENDER_SIDE_BAR,Q.onRender),Hooks.on(D.COLLAPSE_SIDE_BAR,Q.onRender),Hooks.on(D.READY,Q.onRender)}static applyFadeOut(e){Q.useFadeOut=e,Q.handleFadeOut()}static applyCustomStyle(e){var t;Q.customStylesEnabled=e,f.log("applyCustomStyle",[Q.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||Q.addChatToggle(o),Q.handleFadeOut(e,o,n)}static handleFadeOut(e,t,n){f.log("handle FadeOut, ChatLogControls",[Q.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");t?t.querySelector("#roll-privacy"):document.querySelector("#ui-right #roll-privacy"),Q.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}};y(Q,"useFadeOut",!0),y(Q,"customStylesEnabled",!0),y(Q,"addChatToggle",async e=>{const t=await renderTemplate(`modules/${H}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t),n.querySelector("button[data-action=toggleChat]").addEventListener("click",Q.onToggleChatBox)}),y(Q,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),F.addCSSVars("--chat-input-height","0px")):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),F.addCSSVars("--chat-input-height","100px"))});let Vt=Q;const ke=class ke{static init(){const e=S();ke.enableChatStyles=E.get(e.enableChatStyles.tag),ke.chatBorderColor=E.get(e.chatBorderColor.tag)}};y(ke,"chatBorderColor"),y(ke,"enableChatStyles"),y(ke,"enrichCard",async(e,t)=>{var s,i,r,c,d,p,h,b;f.log("renderChatMessage",[ke.chatBorderColor,ke.enableChatStyles,yt.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(r=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:r.activity)==null?void 0:c.type)||((h=(p=(d=e.flags)==null?void 0:d.dnd5e)==null?void 0:p.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(n),o.classList.add("crlngn");const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(C=>{const I=C.querySelector(".visible-dc"),U=C.querySelector(".hidden-dc");f.log("enrichCard",[I,U]),I.setAttribute("data-ability",C.getAttribute("data-ability")||""),I.setAttribute("data-dc",C.getAttribute("data-dc")||""),U.setAttribute("data-ability",C.getAttribute("data-ability")||"")}),ke.chatBorderColor===yt.playerColor.name&&((b=e.author)!=null&&b.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let St=ke;var Ve,at,sn;const G=class G{static init(){f.log("LeftControls - init",[]),Hooks.on(D.RENDER_SCENE_CONTROLS,G.initSceneControls),Hooks.on(D.ACTIVATE_SCENE_CONTROLS,G.onActivateSceneControls),window.addEventListener("resize",G.onActivateSceneControls),G.initSceneControls()}static applyFadeOut(e){G.useFadeOut=e,f.log("applyFadeOut",[e]),G.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls");G.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("handle FadeOut",[G.customStylesEnabled,G.useFadeOut])}static applyCustomStyle(e){var t;G.customStylesEnabled=e,f.log("applyCustomStyle",[G.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){A(G,Ve,document.querySelector("#ui-left #controls")),A(G,at,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){f.log("initSceneControls",[]),G.resetLocalVars(),G.customStylesEnabled?m(G,at).classList.add("crlngn-controls"):m(G,at).classList.remove("crlngn-controls"),G.handleFadeOut(e,t,n)}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!m(G,Ve))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};A(G,sn,new ResizeObserver(n=>{t(()=>G.updateCSSVars(),250)})),m(G,sn).observe(m(G,Ve),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!m(G,Ve))return;let e=parseInt(m(G,at).offsetWidth),t=parseInt(m(G,Ve).offsetWidth),n=-e+t;f.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&F.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),f.log("onActivateSceneControls",[a,o.length,n.length])}};Ve=new WeakMap,at=new WeakMap,sn=new WeakMap,T(G,Ve),T(G,at),T(G,sn),y(G,"useFadeOut",!0),y(G,"customStylesEnabled",!0),y(G,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await loadTemplates(e),!0}catch(e){return f.log("Error loading navigation button templates:",[e]),!1}});let jt=G;const ie=class ie{static init(){Hooks.on(D.RENDER_HOTBAR,ie.onRender)}static applyFadeOut(e){ie.useFadeOut=e,ie.handleFadeOut()}static onRender(e,t,n){f.log("MacroHotbar onRender",[ie.customStylesEnabled]),ie.applyCustomStyle(ie.customStylesEnabled),ie.handleFadeOut(e,t,n)}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");ie.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("MacroHotbat handle fade out",[ie.useFadeOut])}static applyCustomStyle(e){ie.customStylesEnabled=e,f.log("applyCustomStyle",[ie.customStylesEnabled])}};y(ie,"useFadeOut",!0),y(ie,"customStylesEnabled",!0);let Wt=ie;var To;const he=class he{static init(){Hooks.on(D.RENDER_PLAYERS_LIST,he.checkPlayersList),Hooks.on(D.RENDER_HOTBAR,he.checkPlayersList),F.isModuleOn("foundry-taskbar")&&Hooks.on(D.UPDATE_USER,he.checkTaskbarLock),he.checkTaskbarLock(),he.addModuleClasses(),F.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0})}};To=new WeakMap,T(he,To),y(he,"addModuleClasses",()=>{const e=S(),t=E.get(e.otherModulesList.tag)||"",n=t.split(",");f.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+a)})}),y(he,"checkTaskbarLock",()=>{var a,s,i;const e=F.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(f.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(s=t.taskbarSettings)!=null&&s.locked?F.addCSSVars("--crlngn-sidebar-bottom",n?"50px":"0px"):F.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?F.addCSSVars("--crlngn-taskbar-height","50px"):F.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),he.checkPlayersList()}),y(he,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=F.isModuleOn("foundry-taskbar"),o=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,n,a,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.minimized")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let lt=he;const oe=class oe{static init(){Hooks.on(D.RENDER_PLAYERS_LIST,oe.onRender),oe.applyPlayersListSettings(),oe.handleFadeOut(),f.log("PlayersList init")}static applyFadeOut(e){oe.useFadeOut=e,oe.handleFadeOut()}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");oe.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("PlayersList handle fade out",[oe.useFadeOut])}static applyCustomStyle(e){oe.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){if(S(),oe.customStylesEnabled)t.classList.add("crlngn-ui");else{t.classList.remove("crlngn-ui");return}oe.applyPlayersListSettings(),oe.applyAvatars(),oe.handleFadeOut(e,t,n)}static applyPlayersListSettings(){var t,n;const e=S();f.log("applyPlayersListSettings",[E.get(e.autoHidePlayerList.tag)]),E.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("minimized"):(n=document.querySelector("#players"))==null||n.classList.remove("minimized"),lt.checkPlayersList()}static applyAvatars(){const e=S();f.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];E.get(e.playerListAvatars.tag)?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var p;const i=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),r=game.users.get(s.id),c=((p=r.character)==null?void 0:p.img)||"";f.log("player",[r]);const d=document.createElement("img");d.src=c||r.avatar||"",d.alt="*",d.classList.add("avatar"),i&&i.prepend(d)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(i=>{const r=i.querySelector("img.avatar");r==null||r.remove()}),t==null||t.classList.remove("crlngn-avatars")),lt.checkPlayersList()}};y(oe,"useFadeOut",!0),y(oe,"customStylesEnabled",!0);let Pe=oe;var W,rn,st,wo,ht,it,rt,ln,Io,cn,be,je,ve,kn,Mn,On;const u=class u{static applyFadeOut(e){u.useFadeOut=e,f.log("applyFadeOut",[e]),u.handleSceneFadeOut()}static applyCustomStyle(e){u.sceneNavEnabled=e,f.log("applyCustomStyle - TopNavigation",[u.sceneNavEnabled,ui.nav])}static resetLocalVars(){A(u,W,document.querySelector("#scene-navigation")),A(u,ht,document.querySelector("#scene-navigation-expand")),A(u,it,document.querySelector("#ui-left")),A(u,rn,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;f.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),u.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),u.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):u.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleBackButton(e,t,n){if(S(),f.log("handleBackButton",[e,t,n]),!u.useSceneBackButton)return;const o=t.querySelector("#scene-navigation-active"),a=document.createElement("button");a.id="crlngn-back-button",a.innerHTML="<i class='fa fa-turn-left'></i>",a.addEventListener("click",m(u,kn)),o.prepend(a)}static handleFolderList(e,t,n){S(),u.navFoldersEnabled&&ft.addFolderButtons(e,t,n)}static handleNavState(){S(),m(u,cn)&&(A(u,cn,!1),u.toggleNav(u.navStartCollapsed))}static toggleNav(e){clearTimeout(m(u,ln)),A(u,ln,setTimeout(()=>{u.resetLocalVars(),e===!0?(ui.nav.collapse(),u.isCollapsed=!0,f.log("toggleNav collapse",[e,u.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove())):e===!1&&(u.isCollapsed=!1,ui.nav.expand(),f.log("toggleNav expand",[e,u.navStartCollapsed]))},300))}static checkSceneNavCompat(){S(),document.querySelector("#ui-left")}static addListeners(){var e,t;(e=m(u,W))==null||e.addEventListener("mouseenter",n=>{if(f.log("TopNavigation mouseenter",[u.isCollapsed,u.showNavOnHover]),!u.isCollapsed||!u.showNavOnHover)return;n.stopPropagation(),clearTimeout(m(u,st)),document.querySelector("#scene-navigation").classList.add("expanded")}),(t=m(u,W))==null||t.addEventListener("mouseleave",n=>{f.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!u.showNavOnHover)&&(n.stopPropagation(),A(u,st,setTimeout(()=>{clearTimeout(m(u,st)),A(u,st,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))})}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=S();if(!m(u,W))return;const i=((o=m(u,W))==null?void 0:o.querySelectorAll("li.nav-item"))||[],r=0,c=e!==null?e:u.navPos||0,d=(a=m(u,W))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!d)return;const p=i[c],h=d.offsetWidth||0,b=parseInt(h)*c;f.log("setNavPosition",["position",c,b,m(u,W).scrollWidth]);const C=b-r;if(C>m(u,W).scrollWidth)return;u.navPos=c,E.set(s.sceneNavPos.tag,c),t?F.smoothScrollTo(m(u,W),C,"horizontal",n):m(u,W).scrollTo({left:C,behavior:"instant"})}catch(s){f.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}};W=new WeakMap,rn=new WeakMap,st=new WeakMap,wo=new WeakMap,ht=new WeakMap,it=new WeakMap,rt=new WeakMap,ln=new WeakMap,Io=new WeakMap,cn=new WeakMap,be=new WeakMap,je=new WeakMap,ve=new WeakMap,kn=new WeakMap,Mn=new WeakMap,On=new WeakMap,T(u,W),T(u,rn),T(u,st),T(u,wo),T(u,ht),T(u,it),y(u,"sceneFoldersTemplate"),y(u,"navButtonsTemplate"),T(u,rt),T(u,ln),T(u,Io),T(u,cn,!0),T(u,be,null),T(u,je,""),T(u,ve,[]),y(u,"useFadeOut",!0),y(u,"sceneNavEnabled"),y(u,"navFoldersEnabled"),y(u,"navFoldersForPlayers"),y(u,"navShowRootFolders"),y(u,"navStartCollapsed"),y(u,"showNavOnHover"),y(u,"useSceneIcons"),y(u,"useScenePreview"),y(u,"useSceneBackButton"),y(u,"sceneClickToView"),y(u,"isCollapsed"),y(u,"navPos"),y(u,"init",()=>{const e=S();u.checkSceneNavCompat(),u.preloadTemplates(),u.navStartCollapsed=E.get(e.navStartCollapsed.tag),u.showNavOnHover=E.get(e.showNavOnHover.tag),u.sceneNavEnabled=E.get(e.sceneNavEnabled.tag),u.useScenePreview=E.get(e.useScenePreview.tag),u.navFoldersEnabled=E.get(e.navFoldersEnabled.tag),u.navFoldersForPlayers=E.get(e.navFoldersForPlayers.tag),u.isCollapsed=u.navStartCollapsed,ft.init(),f.log("SCENE NAV INIT",[u.sceneNavEnabled]);const t=document.querySelector("#ui-left");if(u.sceneNavEnabled&&t)t.classList.add("crlngn-nav");else if(t){t.classList.remove("crlngn-nav");return}Hooks.on(D.READY,()=>{u.handleSceneFadeOut()}),Hooks.on(D.RENDER_SCENE_NAV,u.onRender),Hooks.on(D.CREATE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.UPDATE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.DELETE_SCENE,()=>{ui.nav.render()}),Hooks.on(D.CANVAS_INIT,()=>{var o,a;const n=(a=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:a.id;n!==m(u,ve)[m(u,ve).length-1]&&m(u,ve).push(n),u.handleSceneFadeOut()}),Hooks.on(D.COLLAPSE_SIDE_BAR,n=>{f.log(D.COLLAPSE_SIDE_BAR,[n]),n&&u.checkSideBar(n.expanded),u.placeNavButtons()}),Hooks.on(D.COLLAPSE_SCENE_NAV,(n,o)=>{clearTimeout(m(u,rt)),u.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(s=>s.remove()),A(u,rt,setTimeout(()=>{u.setCollapsedClass(o)},250))}),Hooks.on(D.RENDER_SCENE_DIRECTORY,n=>{f.log(D.RENDER_SCENE_DIRECTORY,[n]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(s=>{var r,c;const i=game.scenes.get(s.dataset.entryId);if(f.log(D.RENDER_SCENE_DIRECTORY,["directoryScenes",s.dataset.entryId,u.sceneClickToView]),u.sceneClickToView&&(s.addEventListener("dblclick",u.onActivateScene),s.addEventListener("click",u.onSelectScene)),u.useSceneIcons&&i&&((r=game.user)!=null&&r.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),i.ownership.default!==0?(i.active&&(d.classList.add("fa-bullseye"),s.prepend(d)),((c=game.scenes.current)==null?void 0:c.id)===i.id&&(d.classList.add("fa-star"),s.prepend(d))):(d.classList.add("fa-eye-slash"),s.prepend(d))}})}),ui.sidebar&&u.checkSideBar(ui.sidebar.expanded),u.placeNavButtons()}),y(u,"onRender",(e,t,n)=>{const o=S(),a=E.get(o.sceneNavPos.tag);f.log(D.RENDER_SCENE_NAV,[t]),u.resetLocalVars(),u.handleSceneFadeOut(e,t,n),u.sceneNavEnabled&&(u.handleBackButton(e,t,n),u.handleSceneList(e,t,n),u.handleFolderList(e,t,n),u.setNavPosition(a,!1),u.handleNavState()),u.addSceneListeners(t),u.addListeners(),u.resetLocalVars(),u.sceneNavEnabled&&u.navShowRootFolders&&(ft.init(),ft.renderFolderList()),f.log(D.RENDER_SCENE_NAV),u.sceneNavEnabled&&(clearTimeout(m(u,rt)),A(u,rt,setTimeout(()=>{f.log("NAV no transition remove"),u.placeNavButtons()},500)))}),y(u,"setCollapsedClass",e=>{e?m(u,it).classList.add("navigation-collapsed"):(m(u,it).classList.remove("navigation-collapsed"),u.placeNavButtons())}),y(u,"checkSideBar",e=>{u.placeNavButtons();const t=document.querySelector("body");e?t.classList.add("sidebar-expanded"):t.classList.remove("sidebar-expanded")}),y(u,"handleSceneList",async(e,t,n)=>{var o,a;if(u.sceneNavEnabled){f.log("handleSceneList",[e,t,n]);const s=t.querySelectorAll(".scene-navigation-menu li.scene");for(const i of s){const r=i.dataset.sceneId;if(u.useScenePreview){const c=game.scenes.find(p=>p.id===r);c.isGM=(o=game.user)==null?void 0:o.isGM;const d=await renderTemplate(`modules/${H}/templates/scene-nav-preview.hbs`,c);if(f.log("sceneData",[c]),i.classList.add("nav-item"),i.insertAdjacentHTML("beforeend",d),c.isGM&&m(u,je)===r){const p=new MouseEvent("mouseenter");i.dispatchEvent(p)}(a=game.user)!=null&&a.isGM&&u.addPreviewIconListeners(i,c)}u.useSceneIcons&&(i.classList.contains("active")||i.classList.contains("view"))&&i.classList.add("crlngn")}}if(u.sceneNavEnabled){const s=t.querySelector("#scene-navigation-expand"),i=document.querySelector("#ui-left-column-2"),r=document.querySelector("#crlngn-scene-navigation-expand");r&&r.remove();const c=s==null?void 0:s.cloneNode(!0);c.id="crlngn-scene-navigation-expand",c.addEventListener("click",()=>{s.click()}),f.log("toggle events",[e,c]),i.prepend(c)}}),T(u,kn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=m(u,ve).length,n=m(u,ve)[t-2];let o;f.log("#onBackButton before",[t,n,m(u,ve)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),m(u,ve).pop()),f.log("#onBackButton after",[m(u,ve)])}),y(u,"placeNavButtons",async()=>{var r;const e=document.querySelector("#scene-navigation");e.querySelector("#scene-navigation-inactive");const t=document.querySelectorAll("#ui-left .crlngn-btn");if(!e)return;const n=((r=m(u,ht))==null?void 0:r.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(f.log("placeNavButtons *",[u.isCollapsed,o,t]),t.forEach(c=>c.remove()),!o||u.isCollapsed||m(u,it).classList.contains("navigation-collapsed"))return;const a=await renderTemplate(`modules/${H}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=e.parentNode.querySelector("button.crlngn-btn.ui-nav-left"),i=e.parentNode.querySelector("button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",m(u,Mn)),i&&i.addEventListener("click",m(u,On))}),T(u,Mn,async e=>{const t=await u.getItemsPerPage(),n=u.navPos||0;if(!m(u,rn)||!m(u,W))return;let o=n-(t-1);f.log("onNavLast",["pos",o,m(u,W).scrollWidth]),o=o<0?0:o,u.setNavPosition(o)}),T(u,On,async e=>{var c,d;const t=await u.getItemsPerPage(),n=u.navPos||0,o=(c=m(u,W))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((d=m(u,W))==null?void 0:d.scrollWidth)||0;if(!a||!m(u,W))return;let i=n+(t-1),r=i*a;f.log("onNavNext",["pos",n,i,o==null?void 0:o.offsetWidth,r,s]),r>=s&&(i=Math.floor(s/a)),u.setNavPosition(i)}),y(u,"getItemsPerPage",async()=>{var e,t;try{f.log("getItemsPerPage",["Starting"]),u.resetLocalVars();const n=0,o=0,a=((e=m(u,ht))==null?void 0:e.offsetWidth)||0,s=(t=m(u,W))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!m(u,W))return f.log("getItemsPerPage",["No scene items found"]),0;const i=s.offsetWidth,r=m(u,W).offsetWidth;if(!r)return f.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((r-a*2)/i);return f.log("getItemsPerPage",["Calculated:",c,r,i]),c||0}catch(n){return f.log("getItemsPerPage",["Error:",n]),f.error("Error in getItemsPerPage:",n),0}}),y(u,"preloadTemplates",async()=>{try{const e=[`modules/${H}/templates/scene-nav-buttons.hbs`,`modules/${H}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),y(u,"getCurrScenePosition",async e=>{try{if(!m(u,W)||!e)return 0;const t=await u.getItemsPerPage()||1,n=m(u,W).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(r=>r.dataset.sceneId===e);if(a===-1)return 0;const s=a>=u.navPos&&a<=u.navPos+t,i=s?u.navPos:a;return f.log("getCurrScenePosition",["Final position:",i,"isVisible:",s]),i}catch(t){return f.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),y(u,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);f.log("onActivateScene",[o,a]),a.activate(),m(u,be)&&(clearTimeout(m(u,be)),A(u,be,null))}),y(u,"onSelectScene",e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);if(A(u,je,""),f.log("onSelectScene",[a,t,n]),a&&a.sheet){const s=a.sheet.render;f.log("onSelectScene - originalRender",[s]),a.sheet.render=function(){return this},setTimeout(()=>{a.sheet.render=s},250)}m(u,be)&&(clearTimeout(m(u,be)),A(u,be,null)),A(u,be,setTimeout(()=>{a.view(),A(u,be,null)},250))}),y(u,"onScenePreviewOn",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.dataset;A(u,je,n.sceneId),f.log("onScenePreviewOn",[m(u,je)]),t.querySelector(".scene-preview").classList.add("open")}),y(u,"onScenePreviewOff",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget;A(u,je,""),f.log("onScenePreviewOff",[]),t.querySelector(".scene-preview").classList.remove("open")}),y(u,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{n.classList.contains("folder"),n.querySelector(".scene-name").addEventListener("click",u.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",u.onActivateScene),n.addEventListener("mouseenter",u.onScenePreviewOn),n.addEventListener("mouseleave",u.onScenePreviewOff)})}),y(u,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.environment.globalLight.enabled;await n.update({"environment.globalLight.enabled":!d}),f.log("Toggled global illumination",[!d])});const s=o.querySelector(".token-vision");s&&s.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.tokenVision;await n.update({tokenVision:!d}),f.log("Toggled token vision",[!d])});const i=o.querySelector(".sound");i&&n.playlistSound&&i.addEventListener("click",async c=>{c.stopPropagation(),c.preventDefault();const d=n.playlistSound;if(d){const p=d.sound.playing;p?await d.sound.pause():await d.sound.play(),ui.nav.render(),f.log("Toggled playlist sound",[!p])}});const r=o.querySelector(".config");r&&r.addEventListener("click",c=>{c.stopPropagation(),c.preventDefault(),n.sheet.render(!0),f.log("Opened scene configuration")})});let q=u;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Po(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable})),t.push.apply(t,n)}return t}function Oe(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Po(Object(t),!0).forEach(function(n){Ja(l,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Po(Object(t)).forEach(function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(t,n))})}return l}function Sn(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sn=function(e){return typeof e}:Sn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(l)}function Ja(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Ge(){return Ge=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l},Ge.apply(this,arguments)}function Ka(l,e){if(l==null)return{};var t={},n=Object.keys(l),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=l[o]);return t}function Za(l,e){if(l==null)return{};var t=Ka(l,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(l,n)&&(t[n]=l[n])}return t}var Qa="1.15.6";function Fe(l){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(l)}var ze=Fe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),dn=Fe(/Edge/i),Fo=Fe(/firefox/i),Ft=Fe(/safari/i)&&!Fe(/chrome/i)&&!Fe(/android/i),Ro=Fe(/iP(ad|od|hone)/i),ga=Fe(/chrome/i)&&Fe(/android/i),fa={capture:!1,passive:!1};function z(l,e,t){l.addEventListener(e,t,!ze&&fa)}function P(l,e,t){l.removeEventListener(e,t,!ze&&fa)}function Nn(l,e){if(e){if(e[0]===">"&&(e=e.substring(1)),l)try{if(l.matches)return l.matches(e);if(l.msMatchesSelector)return l.msMatchesSelector(e);if(l.webkitMatchesSelector)return l.webkitMatchesSelector(e)}catch{return!1}return!1}}function pa(l){return l.host&&l!==document&&l.host.nodeType?l.host:l.parentNode}function Ce(l,e,t,n){if(l){t=t||document;do{if(e!=null&&(e[0]===">"?l.parentNode===t&&Nn(l,e):Nn(l,e))||n&&l===t)return l;if(l===t)break}while(l=pa(l))}return null}var Go=/\s+/g;function ge(l,e,t){if(l&&e)if(l.classList)l.classList[t?"add":"remove"](e);else{var n=(" "+l.className+" ").replace(Go," ").replace(" "+e+" "," ");l.className=(n+(t?" "+e:"")).replace(Go," ")}}function R(l,e,t){var n=l&&l.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(t=l.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function pt(l,e){var t="";if(typeof l=="string")t=l;else do{var n=R(l,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(l=l.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function ha(l,e,t){if(l){var n=l.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Me(){var l=document.scrollingElement;return l||document.documentElement}function J(l,e,t,n,o){if(!(!l.getBoundingClientRect&&l!==window)){var a,s,i,r,c,d,p;if(l!==window&&l.parentNode&&l!==Me()?(a=l.getBoundingClientRect(),s=a.top,i=a.left,r=a.bottom,c=a.right,d=a.height,p=a.width):(s=0,i=0,r=window.innerHeight,c=window.innerWidth,d=window.innerHeight,p=window.innerWidth),(e||t)&&l!==window&&(o=o||l.parentNode,!ze))do if(o&&o.getBoundingClientRect&&(R(o,"transform")!=="none"||t&&R(o,"position")!=="static")){var h=o.getBoundingClientRect();s-=h.top+parseInt(R(o,"border-top-width")),i-=h.left+parseInt(R(o,"border-left-width")),r=s+a.height,c=i+a.width;break}while(o=o.parentNode);if(n&&l!==window){var b=pt(o||l),C=b&&b.a,I=b&&b.d;b&&(s/=I,i/=C,p/=C,d/=I,r=s+d,c=i+p)}return{top:s,left:i,bottom:r,right:c,width:p,height:d}}}function zo(l,e,t){for(var n=$e(l,!0),o=J(l)[e];n;){var a=J(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Me())break;n=$e(n,!1)}return!1}function bt(l,e,t,n){for(var o=0,a=0,s=l.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==k.ghost&&(n||s[a]!==k.dragged)&&Ce(s[a],t.draggable,l,!1)){if(o===e)return s[a];o++}a++}return null}function ko(l,e){for(var t=l.lastElementChild;t&&(t===k.ghost||R(t,"display")==="none"||e&&!Nn(t,e));)t=t.previousElementSibling;return t||null}function me(l,e){var t=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)l.nodeName.toUpperCase()!=="TEMPLATE"&&l!==k.clone&&(!e||Nn(l,e))&&t++;return t}function xo(l){var e=0,t=0,n=Me();if(l)do{var o=pt(l),a=o.a,s=o.d;e+=l.scrollLeft*a,t+=l.scrollTop*s}while(l!==n&&(l=l.parentNode));return[e,t]}function _a(l,e){for(var t in l)if(l.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===l[t][n])return Number(t)}return-1}function $e(l,e){if(!l||!l.getBoundingClientRect)return Me();var t=l,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=R(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Me();if(n||e)return t;n=!0}}while(t=t.parentNode);return Me()}function es(l,e){if(l&&e)for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}function xn(l,e){return Math.round(l.top)===Math.round(e.top)&&Math.round(l.left)===Math.round(e.left)&&Math.round(l.height)===Math.round(e.height)&&Math.round(l.width)===Math.round(e.width)}var Gt;function ma(l,e){return function(){if(!Gt){var t=arguments,n=this;t.length===1?l.call(n,t[0]):l.apply(n,t),Gt=setTimeout(function(){Gt=void 0},e)}}}function ts(){clearTimeout(Gt),Gt=void 0}function ya(l,e,t){l.scrollLeft+=e,l.scrollTop+=t}function Sa(l){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(l).cloneNode(!0):t?t(l).clone(!0)[0]:l.cloneNode(!0)}function ba(l,e,t){var n={};return Array.from(l.children).forEach(function(o){var a,s,i,r;if(!(!Ce(o,e.draggable,l,!1)||o.animated||o===t)){var c=J(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((i=n.right)!==null&&i!==void 0?i:-1/0,c.right),n.bottom=Math.max((r=n.bottom)!==null&&r!==void 0?r:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var ce="Sortable"+new Date().getTime();function ns(){var l=[],e;return{captureAnimationState:function(){if(l=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(R(o,"display")==="none"||o===k.ghost)){l.push({target:o,rect:J(o)});var a=Oe({},l[l.length-1].rect);if(o.thisAnimationDuration){var s=pt(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){l.push(n)},removeAnimationState:function(n){l.splice(_a(l,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;l.forEach(function(i){var r=0,c=i.target,d=c.fromRect,p=J(c),h=c.prevFromRect,b=c.prevToRect,C=i.rect,I=pt(c,!0);I&&(p.top-=I.f,p.left-=I.e),c.toRect=p,c.thisAnimationDuration&&xn(h,p)&&!xn(d,p)&&(C.top-p.top)/(C.left-p.left)===(d.top-p.top)/(d.left-p.left)&&(r=as(C,h,b,o.options)),xn(p,d)||(c.prevFromRect=d,c.prevToRect=p,r||(r=o.options.animation),o.animate(c,C,p,r)),r&&(a=!0,s=Math.max(s,r),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},r),c.thisAnimationDuration=r)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),l=[]},animate:function(n,o,a,s){if(s){R(n,"transition",""),R(n,"transform","");var i=pt(this.el),r=i&&i.a,c=i&&i.d,d=(o.left-a.left)/(r||1),p=(o.top-a.top)/(c||1);n.animatingX=!!d,n.animatingY=!!p,R(n,"transform","translate3d("+d+"px,"+p+"px,0)"),this.forRepaintDummy=os(n),R(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),R(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){R(n,"transition",""),R(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function os(l){return l.offsetWidth}function as(l,e,t,n){return Math.sqrt(Math.pow(e.top-l.top,2)+Math.pow(e.left-l.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var ct=[],Un={initializeByDefault:!0},un={mount:function(e){for(var t in Un)Un.hasOwnProperty(t)&&!(t in e)&&(e[t]=Un[t]);ct.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ct.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";ct.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Oe({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Oe({sortable:t},n)))})},initializePlugins:function(e,t,n,o){ct.forEach(function(i){var r=i.pluginName;if(!(!e.options[r]&&!i.initializeByDefault)){var c=new i(e,t,e.options);c.sortable=e,c.options=e.options,e[r]=c,Ge(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return ct.forEach(function(o){typeof o.eventProperties=="function"&&Ge(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return ct.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function ss(l){var e=l.sortable,t=l.rootEl,n=l.name,o=l.targetEl,a=l.cloneEl,s=l.toEl,i=l.fromEl,r=l.oldIndex,c=l.newIndex,d=l.oldDraggableIndex,p=l.newDraggableIndex,h=l.originalEvent,b=l.putSortable,C=l.extraEventProperties;if(e=e||t&&t[ce],!!e){var I,U=e.options,B="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!ze&&!dn?I=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(I=document.createEvent("Event"),I.initEvent(n,!0,!0)),I.to=s||t,I.from=i||t,I.item=o||t,I.clone=a,I.oldIndex=r,I.newIndex=c,I.oldDraggableIndex=d,I.newDraggableIndex=p,I.originalEvent=h,I.pullMode=b?b.lastPutMode:void 0;var K=Oe(Oe({},C),un.getEventProperties(n,e));for(var ye in K)I[ye]=K[ye];t&&t.dispatchEvent(I),U[B]&&U[B].call(e,I)}}var is=["evt"],re=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=Za(n,is);un.pluginEvent.bind(k)(e,t,Oe({dragEl:v,parentEl:$,ghostEl:O,rootEl:V,nextEl:et,lastDownEl:bn,cloneEl:j,cloneHidden:He,dragStarted:At,putSortable:_,activeSortable:k.active,originalEvent:o,oldIndex:gt,oldDraggableIndex:zt,newIndex:fe,newDraggableIndex:qe,hideGhostForTarget:Na,unhideGhostForTarget:La,cloneNowHidden:function(){He=!0},cloneNowShown:function(){He=!1},dispatchSortableEvent:function(i){se({sortable:t,name:i,originalEvent:o})}},a))};function se(l){ss(Oe({putSortable:_,cloneEl:j,targetEl:v,rootEl:V,oldIndex:gt,oldDraggableIndex:zt,newIndex:fe,newDraggableIndex:qe},l))}var v,$,O,V,et,bn,j,He,gt,fe,zt,qe,pn,_,ut=!1,Ln=!1,Tn=[],Qe,Se,qn,Hn,Uo,qo,At,dt,xt,Ut=!1,hn=!1,vn,ne,Bn=[],lo=!1,wn=[],Fn=typeof document<"u",mn=Ro,Ho=dn||ze?"cssFloat":"float",rs=Fn&&!ga&&!Ro&&"draggable"in document.createElement("div"),va=function(){if(Fn){if(ze)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto",l.style.pointerEvents==="auto"}}(),Ca=function(e,t){var n=R(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=bt(e,0,t),s=bt(e,1,t),i=a&&R(a),r=s&&R(s),c=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+J(a).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+J(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&i.float&&i.float!=="none"){var p=i.float==="left"?"left":"right";return s&&(r.clear==="both"||r.clear===p)?"vertical":"horizontal"}return a&&(i.display==="block"||i.display==="flex"||i.display==="table"||i.display==="grid"||c>=o&&n[Ho]==="none"||s&&n[Ho]==="none"&&c+d>o)?"vertical":"horizontal"},ls=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,i=n?t.left:t.top,r=n?t.right:t.bottom,c=n?t.width:t.height;return o===i||a===r||o+s/2===i+c/2},cs=function(e,t){var n;return Tn.some(function(o){var a=o[ce].options.emptyInsertThreshold;if(!(!a||ko(o))){var s=J(o),i=e>=s.left-a&&e<=s.right+a,r=t>=s.top-a&&t<=s.bottom+a;if(i&&r)return n=o}}),n},Ea=function(e){function t(a,s){return function(i,r,c,d){var p=i.options.group.name&&r.options.group.name&&i.options.group.name===r.options.group.name;if(a==null&&(s||p))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(i,r,c,d),s)(i,r,c,d);var h=(s?i:r).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},o=e.group;(!o||Sn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},Na=function(){!va&&O&&R(O,"display","none")},La=function(){!va&&O&&R(O,"display","")};Fn&&!ga&&document.addEventListener("click",function(l){if(Ln)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),Ln=!1,!1},!0);var _e=function(e){if(v){e=e.touches?e.touches[0]:e;var t=cs(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[ce]._onDragOver(n)}}},ds=function(e){v&&v.parentNode[ce]._isOutsideThisEl(e.target)};function k(l,e){if(!(l&&l.nodeType&&l.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l,this.options=e=Ge({},e),l[ce]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ca(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,i){s.setData("Text",i.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:k.supportPointer!==!1&&"PointerEvent"in window&&(!Ft||Ro),emptyInsertThreshold:5};un.initializePlugins(this,l,t);for(var n in t)!(n in e)&&(e[n]=t[n]);Ea(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:rs,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(l,"pointerdown",this._onTapStart):(z(l,"mousedown",this._onTapStart),z(l,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(l,"dragover",this),z(l,"dragenter",this)),Tn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ge(this,ns())}k.prototype={constructor:k,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(dt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,v):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,i=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,r=(i||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=o.filter;if(Ss(n),!v&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Ft&&r&&r.tagName.toUpperCase()==="SELECT")&&(r=Ce(r,o.draggable,n,!1),!(r&&r.animated)&&bn!==r)){if(gt=me(r),zt=me(r,o.draggable),typeof d=="function"){if(d.call(this,e,r,this)){se({sortable:t,rootEl:c,name:"filter",targetEl:r,toEl:n,fromEl:n}),re("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(p){if(p=Ce(c,p.trim(),n,!1),p)return se({sortable:t,rootEl:p,name:"filter",targetEl:r,fromEl:n,toEl:n}),re("filter",t,{evt:e}),!0}),d)){a&&e.preventDefault();return}o.handle&&!Ce(c,o.handle,n,!1)||this._prepareDragStart(e,i,r)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,i=a.ownerDocument,r;if(n&&!v&&n.parentNode===a){var c=J(n);if(V=a,v=n,$=v.parentNode,et=v.nextSibling,bn=n,pn=s.group,k.dragged=v,Qe={target:v,clientX:(t||e).clientX,clientY:(t||e).clientY},Uo=Qe.clientX-c.left,qo=Qe.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,v.style["will-change"]="all",r=function(){if(re("delayEnded",o,{evt:e}),k.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Fo&&o.nativeDraggable&&(v.draggable=!0),o._triggerDragStart(e,t),se({sortable:o,name:"choose",originalEvent:e}),ge(v,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){ha(v,d.trim(),Vn)}),z(i,"dragover",_e),z(i,"mousemove",_e),z(i,"touchmove",_e),s.supportPointer?(z(i,"pointerup",o._onDrop),!this.nativeDraggable&&z(i,"pointercancel",o._onDrop)):(z(i,"mouseup",o._onDrop),z(i,"touchend",o._onDrop),z(i,"touchcancel",o._onDrop)),Fo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,v.draggable=!0),re("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(dn||ze))){if(k.eventCanceled){this._onDrop();return}s.supportPointer?(z(i,"pointerup",o._disableDelayedDrag),z(i,"pointercancel",o._disableDelayedDrag)):(z(i,"mouseup",o._disableDelayedDrag),z(i,"touchend",o._disableDelayedDrag),z(i,"touchcancel",o._disableDelayedDrag)),z(i,"mousemove",o._delayedDragTouchMoveHandler),z(i,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&z(i,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(r,s.delay)}else r()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){v&&Vn(v),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._disableDelayedDrag),P(e,"touchend",this._disableDelayedDrag),P(e,"touchcancel",this._disableDelayedDrag),P(e,"pointerup",this._disableDelayedDrag),P(e,"pointercancel",this._disableDelayedDrag),P(e,"mousemove",this._delayedDragTouchMoveHandler),P(e,"touchmove",this._delayedDragTouchMoveHandler),P(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):t?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(v,"dragend",this),z(V,"dragstart",this._onDragStart));try{document.selection?Cn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(ut=!1,V&&v){re("dragStarted",this,{evt:t}),this.nativeDraggable&&z(document,"dragover",ds);var n=this.options;!e&&ge(v,n.dragClass,!1),ge(v,n.ghostClass,!0),k.active=this,e&&this._appendGhost(),se({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Se){this._lastX=Se.clientX,this._lastY=Se.clientY,Na();for(var e=document.elementFromPoint(Se.clientX,Se.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Se.clientX,Se.clientY),e!==t);)t=e;if(v.parentNode[ce]._isOutsideThisEl(e),t)do{if(t[ce]){var n=void 0;if(n=t[ce]._onDragOver({clientX:Se.clientX,clientY:Se.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=pa(t));La()}},_onTouchMove:function(e){if(Qe){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=O&&pt(O,!0),i=O&&s&&s.a,r=O&&s&&s.d,c=mn&&ne&&xo(ne),d=(a.clientX-Qe.clientX+o.x)/(i||1)+(c?c[0]-Bn[0]:0)/(i||1),p=(a.clientY-Qe.clientY+o.y)/(r||1)+(c?c[1]-Bn[1]:0)/(r||1);if(!k.active&&!ut){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(O){s?(s.e+=d-(qn||0),s.f+=p-(Hn||0)):s={a:1,b:0,c:0,d:1,e:d,f:p};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");R(O,"webkitTransform",h),R(O,"mozTransform",h),R(O,"msTransform",h),R(O,"transform",h),qn=d,Hn=p,Se=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!O){var e=this.options.fallbackOnBody?document.body:V,t=J(v,!0,mn,!0,e),n=this.options;if(mn){for(ne=e;R(ne,"position")==="static"&&R(ne,"transform")==="none"&&ne!==document;)ne=ne.parentNode;ne!==document.body&&ne!==document.documentElement?(ne===document&&(ne=Me()),t.top+=ne.scrollTop,t.left+=ne.scrollLeft):ne=Me(),Bn=xo(ne)}O=v.cloneNode(!0),ge(O,n.ghostClass,!1),ge(O,n.fallbackClass,!0),ge(O,n.dragClass,!0),R(O,"transition",""),R(O,"transform",""),R(O,"box-sizing","border-box"),R(O,"margin",0),R(O,"top",t.top),R(O,"left",t.left),R(O,"width",t.width),R(O,"height",t.height),R(O,"opacity","0.8"),R(O,"position",mn?"absolute":"fixed"),R(O,"zIndex","100000"),R(O,"pointerEvents","none"),k.ghost=O,e.appendChild(O),R(O,"transform-origin",Uo/parseInt(O.style.width)*100+"% "+qo/parseInt(O.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(re("dragStart",this,{evt:e}),k.eventCanceled){this._onDrop();return}re("setupClone",this),k.eventCanceled||(j=Sa(v),j.removeAttribute("id"),j.draggable=!1,j.style["will-change"]="",this._hideClone(),ge(j,this.options.chosenClass,!1),k.clone=j),n.cloneId=Cn(function(){re("clone",n),!k.eventCanceled&&(n.options.removeCloneOnHide||V.insertBefore(j,v),n._hideClone(),se({sortable:n,name:"clone"}))}),!t&&ge(v,a.dragClass,!0),t?(Ln=!0,n._loopId=setInterval(n._emulateDragOver,50)):(P(document,"mouseup",n._onDrop),P(document,"touchend",n._onDrop),P(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,v)),z(document,"drop",n),R(v,"transform","translateZ(0)")),ut=!0,n._dragStartId=Cn(n._dragStarted.bind(n,t,e)),z(document,"selectstart",n),At=!0,window.getSelection().removeAllRanges(),Ft&&R(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,i=this.options,r=i.group,c=k.active,d=pn===r,p=i.sort,h=_||c,b,C=this,I=!1;if(lo)return;function U(Mt,Ia){re(Mt,C,Oe({evt:e,isOwner:d,axis:b?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:p,fromSortable:h,target:n,completed:K,onMove:function(Ao,Ra){return yn(V,t,v,o,Ao,J(Ao),e,Ra)},changed:ye},Ia))}function B(){U("dragOverAnimationCapture"),C.captureAnimationState(),C!==h&&h.captureAnimationState()}function K(Mt){return U("dragOverCompleted",{insertion:Mt}),Mt&&(d?c._hideClone():c._showClone(C),C!==h&&(ge(v,_?_.options.ghostClass:c.options.ghostClass,!1),ge(v,i.ghostClass,!0)),_!==C&&C!==k.active?_=C:C===k.active&&_&&(_=null),h===C&&(C._ignoreWhileAnimating=n),C.animateAll(function(){U("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===v&&!v.animated||n===t&&!n.animated)&&(dt=null),!i.dragoverBubble&&!e.rootEl&&n!==document&&(v.parentNode[ce]._isOutsideThisEl(e.target),!Mt&&_e(e)),!i.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),I=!0}function ye(){fe=me(v),qe=me(v,i.draggable),se({sortable:C,name:"change",toEl:t,newIndex:fe,newDraggableIndex:qe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Ce(n,i.draggable,t,!0),U("dragOver"),k.eventCanceled)return I;if(v.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||C._ignoreWhileAnimating===n)return K(!1);if(Ln=!1,c&&!i.disabled&&(d?p||(s=$!==V):_===this||(this.lastPutMode=pn.checkPull(this,c,v,e))&&r.checkPut(this,c,v,e))){if(b=this._getDirection(e,n)==="vertical",o=J(v),U("dragOverValid"),k.eventCanceled)return I;if(s)return $=V,B(),this._hideClone(),U("revert"),k.eventCanceled||(et?V.insertBefore(v,et):V.appendChild(v)),K(!0);var de=ko(t,i.draggable);if(!de||ps(e,b,this)&&!de.animated){if(de===v)return K(!1);if(de&&t===e.target&&(n=de),n&&(a=J(n)),yn(V,t,v,o,n,a,e,!!n)!==!1)return B(),de&&de.nextSibling?t.insertBefore(v,de.nextSibling):t.appendChild(v),$=t,ye(),K(!0)}else if(de&&fs(e,b,this)){var Je=bt(t,0,i,!0);if(Je===v)return K(!1);if(n=Je,a=J(n),yn(V,t,v,o,n,a,e,!1)!==!1)return B(),t.insertBefore(v,Je),$=t,ye(),K(!0)}else if(n.parentNode===t){a=J(n);var Ee=0,Ke,wt=v.parentNode!==t,ue=!ls(v.animated&&v.toRect||o,n.animated&&n.toRect||a,b),It=b?"top":"left",xe=zo(n,"top","top")||zo(v,"top","top"),Rt=xe?xe.scrollTop:void 0;dt!==n&&(Ke=a[It],Ut=!1,hn=!ue&&i.invertSwap||wt),Ee=hs(e,n,a,b,ue?1:i.swapThreshold,i.invertedSwapThreshold==null?i.swapThreshold:i.invertedSwapThreshold,hn,dt===n);var Ae;if(Ee!==0){var Ze=me(v);do Ze-=Ee,Ae=$.children[Ze];while(Ae&&(R(Ae,"display")==="none"||Ae===O))}if(Ee===0||Ae===n)return K(!1);dt=n,xt=Ee;var kt=n.nextElementSibling,Ue=!1;Ue=Ee===1;var gn=yn(V,t,v,o,n,a,e,Ue);if(gn!==!1)return(gn===1||gn===-1)&&(Ue=gn===1),lo=!0,setTimeout(gs,30),B(),Ue&&!kt?t.appendChild(v):n.parentNode.insertBefore(v,Ue?kt:n),xe&&ya(xe,0,Rt-xe.scrollTop),$=v.parentNode,Ke!==void 0&&!hn&&(vn=Math.abs(Ke-J(n)[It])),ye(),K(!0)}if(t.contains(v))return K(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){P(document,"mousemove",this._onTouchMove),P(document,"touchmove",this._onTouchMove),P(document,"pointermove",this._onTouchMove),P(document,"dragover",_e),P(document,"mousemove",_e),P(document,"touchmove",_e)},_offUpEvents:function(){var e=this.el.ownerDocument;P(e,"mouseup",this._onDrop),P(e,"touchend",this._onDrop),P(e,"pointerup",this._onDrop),P(e,"pointercancel",this._onDrop),P(e,"touchcancel",this._onDrop),P(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(fe=me(v),qe=me(v,n.draggable),re("drop",this,{evt:e}),$=v&&v.parentNode,fe=me(v),qe=me(v,n.draggable),k.eventCanceled){this._nulling();return}ut=!1,hn=!1,Ut=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),co(this.cloneId),co(this._dragStartId),this.nativeDraggable&&(P(document,"drop",this),P(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ft&&R(document.body,"user-select",""),R(v,"transform",""),e&&(At&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),O&&O.parentNode&&O.parentNode.removeChild(O),(V===$||_&&_.lastPutMode!=="clone")&&j&&j.parentNode&&j.parentNode.removeChild(j),v&&(this.nativeDraggable&&P(v,"dragend",this),Vn(v),v.style["will-change"]="",At&&!ut&&ge(v,_?_.options.ghostClass:this.options.ghostClass,!1),ge(v,this.options.chosenClass,!1),se({sortable:this,name:"unchoose",toEl:$,newIndex:null,newDraggableIndex:null,originalEvent:e}),V!==$?(fe>=0&&(se({rootEl:$,name:"add",toEl:$,fromEl:V,originalEvent:e}),se({sortable:this,name:"remove",toEl:$,originalEvent:e}),se({rootEl:$,name:"sort",toEl:$,fromEl:V,originalEvent:e}),se({sortable:this,name:"sort",toEl:$,originalEvent:e})),_&&_.save()):fe!==gt&&fe>=0&&(se({sortable:this,name:"update",toEl:$,originalEvent:e}),se({sortable:this,name:"sort",toEl:$,originalEvent:e})),k.active&&((fe==null||fe===-1)&&(fe=gt,qe=zt),se({sortable:this,name:"end",toEl:$,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){re("nulling",this),V=v=$=O=et=j=bn=He=Qe=Se=At=fe=qe=gt=zt=dt=xt=_=pn=k.dragged=k.ghost=k.clone=k.active=null,wn.forEach(function(e){e.checked=!0}),wn.length=qn=Hn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":v&&(this._onDragOver(e),us(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],Ce(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||ys(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var i=o.children[s];Ce(i,this.options.draggable,o,!1)&&(n[a]=i)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ce(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=un.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&Ea(n)},destroy:function(){re("destroy",this);var e=this.el;e[ce]=null,P(e,"mousedown",this._onTapStart),P(e,"touchstart",this._onTapStart),P(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(P(e,"dragover",this),P(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Tn.splice(Tn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!He){if(re("hideClone",this),k.eventCanceled)return;R(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),He=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(He){if(re("showClone",this),k.eventCanceled)return;v.parentNode==V&&!this.options.group.revertClone?V.insertBefore(j,v):et?V.insertBefore(j,et):V.appendChild(j),this.options.group.revertClone&&this.animate(v,j),R(j,"display",""),He=!1}}};function us(l){l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault()}function yn(l,e,t,n,o,a,s,i){var r,c=l[ce],d=c.options.onMove,p;return window.CustomEvent&&!ze&&!dn?r=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(r=document.createEvent("Event"),r.initEvent("move",!0,!0)),r.to=e,r.from=l,r.dragged=t,r.draggedRect=n,r.related=o||e,r.relatedRect=a||J(e),r.willInsertAfter=i,r.originalEvent=s,l.dispatchEvent(r),d&&(p=d.call(c,r,s)),p}function Vn(l){l.draggable=!1}function gs(){lo=!1}function fs(l,e,t){var n=J(bt(t.el,0,t.options,!0)),o=ba(t.el,t.options,O),a=10;return e?l.clientX<o.left-a||l.clientY<n.top&&l.clientX<n.right:l.clientY<o.top-a||l.clientY<n.bottom&&l.clientX<n.left}function ps(l,e,t){var n=J(ko(t.el,t.options.draggable)),o=ba(t.el,t.options,O),a=10;return e?l.clientX>o.right+a||l.clientY>n.bottom&&l.clientX>n.left:l.clientY>o.bottom+a||l.clientX>n.right&&l.clientY>n.top}function hs(l,e,t,n,o,a,s,i){var r=n?l.clientY:l.clientX,c=n?t.height:t.width,d=n?t.top:t.left,p=n?t.bottom:t.right,h=!1;if(!s){if(i&&vn<c*o){if(!Ut&&(xt===1?r>d+c*a/2:r<p-c*a/2)&&(Ut=!0),Ut)h=!0;else if(xt===1?r<d+vn:r>p-vn)return-xt}else if(r>d+c*(1-o)/2&&r<p-c*(1-o)/2)return ms(e)}return h=h||s,h&&(r<d+c*a/2||r>p-c*a/2)?r>d+c/2?1:-1:0}function ms(l){return me(v)<me(l)?1:-1}function ys(l){for(var e=l.tagName+l.className+l.src+l.href+l.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Ss(l){wn.length=0;for(var e=l.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&wn.push(n)}}function Cn(l){return setTimeout(l,0)}function co(l){return clearTimeout(l)}Fn&&z(document,"touchmove",function(l){(k.active||ut)&&l.cancelable&&l.preventDefault()});k.utils={on:z,off:P,css:R,find:ha,is:function(e,t){return!!Ce(e,t,e,!1)},extend:es,throttle:ma,closest:Ce,toggleClass:ge,clone:Sa,index:me,nextTick:Cn,cancelNextTick:co,detectDirection:Ca,getChild:bt,expando:ce};k.get=function(l){return l[ce]};k.mount=function(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(k.utils=Oe(Oe({},k.utils),n.utils)),un.mount(n)})};k.create=function(l,e){return new k(l,e)};k.version=Qa;var Y=[],Dt,uo,go=!1,jn,Wn,In,Pt;function bs(){function l(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return l.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):n.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?P(document,"dragover",this._handleAutoScroll):(P(document,"pointermove",this._handleFallbackAutoScroll),P(document,"touchmove",this._handleFallbackAutoScroll),P(document,"mousemove",this._handleFallbackAutoScroll)),Bo(),En(),ts()},nulling:function(){In=uo=Dt=go=Pt=jn=Wn=null,Y.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,i=document.elementFromPoint(a,s);if(In=t,n||this.options.forceAutoScrollFallback||dn||ze||Ft){$n(t,this.options,i,n);var r=$e(i,!0);go&&(!Pt||a!==jn||s!==Wn)&&(Pt&&Bo(),Pt=setInterval(function(){var c=$e(document.elementFromPoint(a,s),!0);c!==r&&(r=c,En()),$n(t,o.options,c,n)},10),jn=a,Wn=s)}else{if(!this.options.bubbleScroll||$e(i,!0)===Me()){En();return}$n(t,this.options,$e(i,!1),!1)}}},Ge(l,{pluginName:"scroll",initializeByDefault:!0})}function En(){Y.forEach(function(l){clearInterval(l.pid)}),Y=[]}function Bo(){clearInterval(Pt)}var $n=ma(function(l,e,t,n){if(e.scroll){var o=(l.touches?l.touches[0]:l).clientX,a=(l.touches?l.touches[0]:l).clientY,s=e.scrollSensitivity,i=e.scrollSpeed,r=Me(),c=!1,d;uo!==t&&(uo=t,En(),Dt=e.scroll,d=e.scrollFn,Dt===!0&&(Dt=$e(t,!0)));var p=0,h=Dt;do{var b=h,C=J(b),I=C.top,U=C.bottom,B=C.left,K=C.right,ye=C.width,de=C.height,Je=void 0,Ee=void 0,Ke=b.scrollWidth,wt=b.scrollHeight,ue=R(b),It=b.scrollLeft,xe=b.scrollTop;b===r?(Je=ye<Ke&&(ue.overflowX==="auto"||ue.overflowX==="scroll"||ue.overflowX==="visible"),Ee=de<wt&&(ue.overflowY==="auto"||ue.overflowY==="scroll"||ue.overflowY==="visible")):(Je=ye<Ke&&(ue.overflowX==="auto"||ue.overflowX==="scroll"),Ee=de<wt&&(ue.overflowY==="auto"||ue.overflowY==="scroll"));var Rt=Je&&(Math.abs(K-o)<=s&&It+ye<Ke)-(Math.abs(B-o)<=s&&!!It),Ae=Ee&&(Math.abs(U-a)<=s&&xe+de<wt)-(Math.abs(I-a)<=s&&!!xe);if(!Y[p])for(var Ze=0;Ze<=p;Ze++)Y[Ze]||(Y[Ze]={});(Y[p].vx!=Rt||Y[p].vy!=Ae||Y[p].el!==b)&&(Y[p].el=b,Y[p].vx=Rt,Y[p].vy=Ae,clearInterval(Y[p].pid),(Rt!=0||Ae!=0)&&(c=!0,Y[p].pid=setInterval((function(){n&&this.layer===0&&k.active._onTouchMove(In);var kt=Y[this.layer].vy?Y[this.layer].vy*i:0,Ue=Y[this.layer].vx?Y[this.layer].vx*i:0;typeof d=="function"&&d.call(k.dragged.parentNode[ce],Ue,kt,l,In,Y[this.layer].el)!=="continue"||ya(Y[this.layer].el,Ue,kt)}).bind({layer:p}),24))),p++}while(e.bubbleScroll&&h!==r&&(h=$e(h,!1)));go=c}},30),Ta=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,i=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var c=n||a;i();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,p=document.elementFromPoint(d.clientX,d.clientY);r(),c&&!c.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Mo(){}Mo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=bt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Ta};Ge(Mo,{pluginName:"revertOnSpill"});function Oo(){}Oo.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Ta};Ge(Oo,{pluginName:"removeOnSpill"});k.mount(new bs);k.mount(Oo,Mo);const Yn="root";var We,X,An,Dn,wa;const w=class w{static init(){if(w.noFolderView()||!ui.scenes)return;w.preloadTemplates(),game.user.getFlag(H,"activeSceneFolders")||game.user.setFlag(H,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(D.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;x(a=w,Dn,wa).call(a),ui.nav.render()})}static addFolderButtons(e,t,n){const o=S(),a=document.querySelector("#crlngn-scene-lookup"),s=document.querySelector("#crlngn-folder-toggle");if(a||s)return;const i=t.querySelector("#scene-navigation-active"),r=i.querySelector("li.scene:first-of-type"),c=document.createElement("div"),d=document.createElement("div");c.id="crlngn-scene-lookup",c.innerHTML=`<button class='folder-expand' tooltip='Search Scenes'>
      <i class='fa-solid fa-magnifying-glass'></i>
    </button>`,d.dataset.tooltip=q.navShowRootFolders?"Hide Scene Folders":"Show Scene Folders",d.id="crlngn-folder-toggle",d.innerHTML="<i class='fa-solid icon'></i>",q.navShowRootFolders?i.classList.add("with-folders"):i.classList.remove("with-folders"),c.querySelector(".folder-expand").addEventListener("click",w.toggleFolderLookup),d.addEventListener("click",()=>{q.setNavPosition(0),E.set(o.navShowRootFolders.tag,!q.navShowRootFolders),q.placeNavButtons()}),i.insertBefore(c,r),i.append(d),w.handleFolderLookup(e,t,n)}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),A(w,We,game.scenes.sortingMode),f.log("buildFolderData A",[e.name,e]),e.id===Yn?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=w.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},f.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),m(w,We)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};We=new WeakMap,X=new WeakMap,An=new WeakMap,Dn=new WeakSet,wa=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){A(w,We,game.scenes.sortingMode),ui.nav.render();return}}catch(e){console.error("Error checking scene directory sort mode:",e)}A(w,We,"a"),f.log("updateSortMode fallback",[m(w,We)])},T(w,Dn),y(w,"selectedFolder",Yn),T(w,We,"a"),T(w,X,[]),y(w,"searchValue",""),y(w,"renderFolderList",async e=>{A(w,X,game.user.getFlag(H,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:Yn},a=w.buildTemplateData(o),s=await renderTemplate(`modules/${H}/templates/scene-nav-folders.hbs`,a);f.log("renderFolderList",[o,m(w,X),s]),e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const i=t.querySelectorAll("li.folder");w.addFolderListeners(i),q.placeNavButtons()}),y(w,"handleFolderLookup",async()=>{const e=await renderTemplate(`modules/${H}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",w.onSearchInput),o.addEventListener("keydown",a=>{a.stopPropagation()})}),y(w,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",m(w,An));const o=n.dataset.folderId,a=t.get(o),s=m(w,X).includes(o);f.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),w.injectSubfolders(a,n))})}),T(w,An,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await w.injectSubfolders(a,t.parentNode),q.addSceneListeners(t.parentNode),f.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?w.updateActiveFolders(n,!0):w.updateActiveFolders(n,!1)}),y(w,"injectSubfolders",async(e,t)=>{const n=w.buildTemplateData(e),o=await renderTemplate(`modules/${H}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");w.addFolderListeners(s),q.addSceneListeners(t.querySelector(".contents"))}),y(w,"updateActiveFolders",async(e,t=!1)=>{const o=document.querySelector("#scene-navigation-inactive").querySelector(`li.folder[data-folder-id=${e}]`),a=m(w,X).indexOf(e);f.log("updateActiveFolders A",[a,e,game.user.getFlag(H,"activeSceneFolders"),m(w,X)]),t?(A(w,X,m(w,X).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):m(w,X).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(i=>{i!==o&&(A(w,X,m(w,X).filter(r=>r!==i.dataset.folderId)),i.classList.remove("crlngn-folder-active"))}),m(w,X).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(H,"activeSceneFolders",m(w,X)),f.log("updateActiveFolders B",[t,e,game.user.getFlag(H,"activeSceneFolders"),m(w,X)])}),y(w,"selectFolder",e=>w.getFolderById(e)||null),y(w,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!q.navFoldersForPlayers||!q.navFoldersEnabled||!q.sceneNavEnabled}),y(w,"preloadTemplates",async()=>{const e=[`modules/${H}/templates/scene-nav-folders.hbs`,`modules/${H}/templates/scene-nav-subfolders.hbs`,`modules/${H}/templates/scene-nav-lookup.hbs`];return await loadTemplates(e),!0}),y(w,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;w.searchValue=n,w.updateSearchResults(n)}),y(w,"updateSearchResults",e=>{var a,s;if(w.noFolderView())return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())&&i.permission>=2))||[];n.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase()));const o=((s=game.scenes)==null?void 0:s.folders.filter(i=>i.name.toLowerCase().includes(e.toLowerCase())))||[];if(o.sort((i,r)=>i.name.toLowerCase().localeCompare(r.name.toLowerCase())),t.classList.remove("hidden"),o.forEach(i=>{const r=document.createElement("li");r.className="search-folder",r.dataset.folderId=i.id,r.innerHTML=`<a><i class="fas fa-folder"></i> ${i.name}</a>`,r.addEventListener("click",w.onSelectSearchedFolder),t.appendChild(r)}),n.forEach(i=>{const r=document.createElement("li");r.className="search-scene",r.dataset.sceneId=i.id,r.innerHTML=`<a><i class="fas fa-map"></i> ${i.name}</a>`,r.querySelector(".scene-name").addEventListener("dblclick",q.onActivateScene),r.querySelector(".scene-name").addEventListener("click",q.onSelectScene),t.appendChild(r)}),o.length===0&&n.length===0){const i=document.createElement("li");i.className="no-results",i.textContent="No matching results found",t.appendChild(i)}}),y(w,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(q.navShowRootFolders||o.click(),!n)return;const i=[...ui.scenes.collection.folders.get(n).ancestors];A(w,X,[]);for(const r of i)m(w,X).push(r.id);m(w,X).push(n),await game.user.setFlag(H,"activeSceneFolders",m(w,X)),setTimeout(async()=>{ui.nav.render()},200)});let ft=w;const pe=class pe{static init(){Hooks.on(D.RENDER_SIDE_BAR,pe.onRender)}static applyFadeOut(e){pe.useFadeOut=e,pe.handleFadeOut()}static applyCustomStyle(e){var t;pe.customStylesEnabled=e,f.log("applyCustomStyle",[pe.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=document.querySelector("#ui-right");pe.customStylesEnabled?o.classList.add("crlngn-tabs"):o.classList.remove("crlngn-tabs"),pe.handleFadeOut(e,t,n)}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");pe.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),f.log("SidebarTabs handle fade out",[pe.useFadeOut])}};y(pe,"useFadeOut",!0),y(pe,"customStylesEnabled",!0);let $t=pe;var mt;const N=class N{static get(e,t=H){if(!e)return null;let n=!1;if(t===H)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,f.log("GET Setting",[a,n])}return n}static set(e,t,n=H){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),f.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){var o,a,s,i,r,c,d,p,h;const n=S();switch(t===void 0&&(t=N.get(e)),f.log("SettingsUtil.apply",[e,t,N.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:N.applyHotBarSettings();break;case n.playerListAvatars.tag:Pe.applyAvatars();break;case n.autoHidePlayerList.tag:Pe.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:N.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:N.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:ee.currSettings.dockHeight=t,N.applyCameraHeight(t);break;case n.dockWidth.tag:ee.currSettings.dockWidth=t,N.applyCameraWidth(t);break;case n.dockPosX.tag:ee.currSettings.dockPosX=t,N.applyCameraPosX(t);break;case n.dockPosY.tag:ee.currSettings.dockPosY=t,N.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:ee.currSettings.defaultVideoWidth=t,ee.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:ee.currSettings.dockResizeOnUserJoin=t,ee.applyDockResize(t);break;case n.chatBorderColor.tag:St.chatBorderColor=N.get(n.chatBorderColor.tag),N.applyBorderColors();break;case n.enableChatStyles.tag:St.enableChatStyles=N.get(n.enableChatStyles.tag),N.applyChatStyles();break;case n.debugMode.tag:N.applyDebugSettings();break;case n.navFoldersEnabled.tag:q.navFoldersEnabled=t;break;case n.navShowRootFolders.tag:q.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.sceneClickToView.tag:q.sceneClickToView=t,(a=ui.nav)==null||a.render(),(i=(s=game.scenes)==null?void 0:s.directory)==null||i.render();break;case n.useSceneIcons.tag:q.useSceneIcons=t,(r=ui.nav)==null||r.render(),(d=(c=game.scenes)==null?void 0:c.directory)==null||d.render();break;case n.useSceneBackButton.tag:q.useSceneBackButton=t,(p=ui.nav)==null||p.render();break;case n.useScenePreview.tag:q.useScenePreview=t,(h=ui.nav)==null||h.render();break;case n.navStartCollapsed.tag:q.navStartCollapsed=t;break;case n.showNavOnHover.tag:q.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:q.isCollapsed=N.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:N.applyThemeSettings();break;case n.customStyles.tag:N.applyCustomCSS();break;case n.adjustOtherModules.tag:N.applyModuleAdjustments();break;case n.otherModulesList.tag:N.applyOtherModulesList();break;case n.enablePlayerList.tag:Pe.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:q.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Wt.applyCustomStyle(t);break;case n.enableFloatingDock.tag:ee.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:$t.applyCustomStyle(t);break;case n.enableChatLogControls.tag:Vt.applyCustomStyle(t);break;case n.enableSceneControls.tag:jt.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:jt.applyFadeOut(t);break;case n.playerListFadeOut.tag:Pe.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:$t.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:ee.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Wt.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:Vt.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:q.applyFadeOut(t);break}}static applyBorderColors(){const e=S(),t=N.get(e.chatBorderColor.tag),n=document.querySelector("body");t===yt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===yt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=S(),t=N.get(e.enableChatStyles.tag),n=document.querySelector("body");f.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=S(),t=N.get(e.enableMacroLayout.tag);document.querySelector("body.crlngn-ui");const n=document.querySelector("#hotbar");n&&(t?n.classList.add("crlngn-macro"):n.classList.remove("crlngn-macro"))}static applyHotBarCollapse(){}static applyLeftControlsSettings(e,t){const n=S();N.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),f.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:N.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=S(),t=N.get(e.controlsIconSize.tag);document.querySelector("body");const n=Ot[t]?Ot[t].size:Ot.regular.size;function o(a){switch(a){case Ot.large.name:return"var(--font-size-18);";case Ot.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[n]),F.addCSSVars("--icon-font-size",o(t)),F.addCSSVars("--control-item-size",n),N.applyLeftControlsSettings()}static applySceneNavPos(e){const t=S();q.navPos=e||N.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=S(),n=N.get(t.dockPosX.tag),o=e||n;ee.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=S(),n=N.get(t.dockPosY.tag),o=e||n;ee.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=S(),n=N.get(t.dockWidth.tag),o=e||n;ee.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=S(),n=N.get(t.dockHeight.tag),o=e||n;ee.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=S(),o=n.customFontsMenu.fields,a={};switch(f.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=N.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:F.addCSSVars("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:F.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:F.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles.tag:F.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=S();f.debugOn=e||N.get(t.debugMode.tag)}};mt=new WeakMap,T(N,mt,!1),y(N,"firstLoad",!0),y(N,"registerSettings",async()=>{const e=S(),t=Object.entries(e);f.log("registerSettings - test",[t],!0),t.forEach(async d=>{const p=d[1];if(f.log("Registering... ",[d],!0),p.showOnRoot&&p.isMenu||!p.isMenu){const h={name:p.label,hint:p.hint,default:p.default,type:p.propType,scope:p.scope,config:p.config,requiresReload:p.requiresReload||!1,onChange:b=>N.apply(p.tag,b)};(p.choices||p.options)&&(h.choices=p.choices||p.options),await game.settings.register(H,p.tag,h),N.get(p.tag)===void 0&&(f.log("resetting...",[p.tag]),N.set(p.tag,p.default))}}),game.keybindings.register(H,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{N.hideInterface()},restricted:!1}),N.applyThemeSettings(),N.applyCustomCSS(),N.applyModuleAdjustments();const o=Object.entries(ro()).find(d=>d[0]==="moduleSettingsMenu");if(o){const d=o[1],p={name:d.tag,label:d.label,hint:d.hint,icon:d.icon,type:d.propType,restricted:d.restricted};await game.settings.registerMenu(H,d.tag,p)}Hooks.on(D.RENDER_SCENE_CONTROLS,N.applyLeftControlsSettings),Hooks.on(D.RENDER_PLAYERS_LIST,Pe.applyPlayersListSettings),Hooks.on(D.RENDER_HOTBAR,()=>{N.firstLoad&&(N.firstLoad=!1,N.applyHotBarCollapse()),N.applyHotBarSettings()}),N.applyDebugSettings(),N.applyChatStyles(),N.applyBorderColors(),e.sceneNavMenu.fields.forEach(d=>{N.apply(e[d].tag)}),e.cameraDockMenu.fields.forEach(d=>{N.apply(e[d].tag)}),e.customFontsMenu.fields.forEach(d=>{N.applyCustomFonts(e[d].tag)}),e.leftControlsMenu.fields.forEach(d=>{N.applyLeftControlsSettings(e[d].tag)}),e.interfaceOptionsMenu.fields.forEach(d=>{f.log("TEST",[d,e]),N.apply(e[d].tag)})}),y(N,"applyThemeSettings",e=>{const t=S(),n=e||N.get(t.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,n,N.get(t.colorTheme.tag)]),te.forEach(a=>{a.className&&o.classList.remove(a.className)}),n&&o.classList.add(n)}),y(N,"applyCustomCSS",e=>{const t=S(),n=e||N.get(t.customStyles.tag)||"";F.addCustomCSS(n)}),y(N,"applyModuleAdjustments",e=>{const t=S();(e||N.get(t.adjustOtherModules.tag)||!1)&&lt.addModuleClasses()}),y(N,"applyOtherModulesList",e=>{const t=S(),n=e||N.get(t.otherModulesList.tag);f.log("applyOtherModulesList",[n,n.split(",")]),n.split(",").length===0?N.set(t.adjustOtherModules.tag,!1):N.set(t.adjustOtherModules.tag,!0),lt.addModuleClasses()}),y(N,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");m(N,mt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),A(N,mt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),A(N,mt,!0))});let E=N;const Ht=class Ht{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"https://github.com/crlngn/crlngn-ui/releases/latest/download/module-updates.json";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=S();E.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=S();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const o=await E.get(e.lastUpdateId.tag),a=await Ht.getIdFromRawJson();if(f.log("checkForUpdates...",[a,o]),o===a)return;const s=await fetch(Ht.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!s.ok){f.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const i=await s.json();await this.displayUpdateNews(i),E.set(e.lastUpdateId.tag,i.id),f.log("checkForUpdates | SUCCESS",[i.id])}catch(o){clearTimeout(n),o.name==="AbortError"?f.warn("checkForUpdates | Request timed out",[o]):f.warn("checkForUpdates | Fetch error",[o.message])}}catch(t){f.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){const t=`
      <div class="crlngn-news">
        <h3>${e.title}</h3>
        ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
        ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
        <div class="crlngn-news-content">
        ${e.content}
        </div>
      </div>
    `;await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}})}};y(Ht,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/main/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let fo=Ht;class vs{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return f.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Pn;const Bt=class Bt{static init(){Hooks.once(D.INIT,()=>{var n,o;document.querySelector("body").classList.add(H),(n=document.querySelector("#ui-middle"))==null||n.classList.add(H),f.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},E.registerSettings();const e=S(),t=E.get(e.disableUI.tag);if(f.log(D.INIT,[t]),t){document.querySelector("body").classList.remove(H),(o=document.querySelector("#ui-middle"))==null||o.classList.remove(H);return}q.init(),ee.init(),jt.init(),Vt.init(),St.init(),$t.init(),Pe.init(),Wt.init(),Hooks.on(D.RENDER_CHAT_MESSAGE,m(Bt,Pn))}),Hooks.once(D.READY,()=>{f.log("Core Ready",[]);const e=S();var t=E.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),vs.init(),Pe.applyPlayersListSettings(),lt.init(),fo.init(),E.get(e.enableChatStyles.tag)&&Bt.addCSSLocalization()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";F.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),F.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),F.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),F.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),F.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),F.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),F.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),F.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),F.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),F.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Pn=new WeakMap,T(Bt,Pn,(e,t)=>{f.log(D.RENDER_CHAT_MESSAGE,[e,t]),St.enrichCard(e,t)});let po=Bt;po.init();
//# sourceMappingURL=crlngn-ui.js.map
