var gt=Object.defineProperty;var Je=k=>{throw TypeError(k)};var ft=(k,e,t)=>e in k?gt(k,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):k[e]=t;var N=(k,e,t)=>ft(k,typeof e!="symbol"?e+"":e,t),Oe=(k,e,t)=>e.has(k)||Je("Cannot "+t);var p=(k,e,t)=>(Oe(k,e,"read from private field"),t?t.call(k):e.get(k)),L=(k,e,t)=>e.has(k)?Je("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(k):e.set(k,t),M=(k,e,t,s)=>(Oe(k,e,"write to private field"),s?s.call(k,t):e.set(k,t),t),R=(k,e,t)=>(Oe(k,e,"access private method"),t);const w={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},q="crlngn-ui",Re=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Ge=class Ge{static log(e="",t=[],s=!1){try{const n=Ge.debugOn;if(!(s||n))return;console.log(...Re,e,...t)}catch{console.log(...Re,e,...t)}}static warn(e="",t=[]){console.warn(...Re,e,...t)}static logError(e,t){var s;t.ui&&((s=ui.notifications)==null||s.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Re,e)}};N(Ge,"debugOn",!1);let c=Ge;const E={select:"select",checkbox:"checkbox",text:"text",number:"number"},T={client:"client",world:"world"},pe={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},re={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},$=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function y(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:E.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:T.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:T.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:E.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:re.playerColor.name},scope:T.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:E.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:pe.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:T.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:E.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:E.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:E.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:E.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:E.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:E.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:T.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:E.button,fields:["sceneNavEnabled","navFoldersEnabled","navFoldersForPlayers","showFolderListOnClick","showNavOnHover"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navFoldersForPlayers:!1,showFolderListOnClick:!1,showNavOnHover:!1},scope:T.client,config:!1,requiresReload:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:T.client,config:!1},showFolderListOnClick:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:T.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:T.client,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:E.number,default:0,scope:T.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:E.checkbox,default:!1,scope:T.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:E.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:E.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:E.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:E.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:E.text,propType:String,default:"",scope:T.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:E.checkbox,propType:Boolean,default:!1,scope:T.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:E.text,propType:String,default:"",scope:T.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:E.text,default:re.playerColor.name,scope:T.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:E.checkbox,default:!0,scope:T.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:E.number,default:200,scope:T.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:E.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:pe.small.name,scope:T.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:E.checkbox,propType:Boolean,default:!1,scope:T.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:E.checkbox,propType:Boolean,default:!0,scope:T.client,config:!1}}}const{ApplicationV2:pt,HandlebarsApplicationMixin:mt}=foundry.applications.api;var de,Qe,_e;const Q=class Q extends mt(pt){static get DEFAULT_OPTIONS(){return{id:y().cameraDockMenu.tag,actions:{redefine:R(Q,de,_e)},form:{handler:R(Q,de,Qe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=y(),s={...S.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return c.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};de=new WeakSet,Qe=async function(e,t,s){const n=y();let o=S.get(n.cameraDockMenu.tag),l=o.enableFloatingDock;e.preventDefault(),e.stopPropagation();const a=foundry.utils.expandObject(s.object);await S.set(n.cameraDockMenu.tag,a),o=S.get(n.cameraDockMenu.tag),c.log("Saving settings:",[n.cameraDockMenu.tag,t,s.object,a,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.enableFloatingDock!=l&&location.reload()},_e=async function(e,t){const s=y(),o=this.element.querySelectorAll("input, select"),l=s.cameraDockMenu.default;o.forEach(a=>{a.value=l[a.name],a.type==="checkbox"&&(a.checked=l[a.name])}),c.log("#onReset",[e,t,s.cameraDockMenu.default])},L(Q,de),N(Q,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ue=Q;const{ApplicationV2:ht,HandlebarsApplicationMixin:yt}=foundry.applications.api;var ue,et,tt;const _=class _ extends yt(ht){static get DEFAULT_OPTIONS(){return{id:y().chatMessagesMenu.tag,actions:{redefine:R(_,ue,tt)},form:{handler:R(_,ue,et),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=y(),s=S.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,o={},l={},a={};n.forEach(i=>{if(c.log("_prepareContext",[t[i].oldName]),t[i]){const m=S.get(t[i].tag);o[i]=t[i],l[i]=m!==void 0?m:s[t[i].oldName]||t[i].default,a[i]=t[i].default}}),c.log("_prepareContext",[l,a]);const r={...l,default:{...a},isGM:game.user.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return c.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=y(),n=S.get(s.chatMessagesMenu.tag);c.log("_onRender",[e,t,n])}};ue=new WeakSet,et=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const o=n.chatMessagesMenu.fields,l=foundry.utils.expandObject(s.object),a=S.get(n.chatBorderColor.tag);c.log("Compared settings:",[l.chatBorderColor,a]),o.forEach(i=>{c.log("Saving setting >>",[n[i].tag,l[i]]),l[i]!==void 0&&S.set(n[i].tag,l[i])}),await S.set(n.chatMessagesMenu.tag,l),l.chatBorderColor!==a&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},tt=async function(e,t){const s=y(),o=this.element.querySelectorAll("input, select"),l=s.chatMessagesMenu.fields,a={};l.forEach(r=>{s[r]&&(s[r],a[r]=s[r].default)}),o.forEach(r=>{r.value=a[r.name]})},L(_,ue),N(_,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let xe=_;class C{static isModuleOn(e){var s;const t=(s=game.modules)==null?void 0:s.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(n=>typeof e[n]=="function"&&n!=="constructor"&&n!=="prototype"&&n!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(n=>{const o=e[n];e[n]=function(...l){return console.log(`TEST: Executing: ${e.name}.${n}`),o.apply(this,l)}});const s=Object.getOwnPropertyNames(e.prototype).filter(n=>typeof e.prototype[n]=="function"&&n!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,s),s.forEach(n=>{const o=e.prototype[n];e.prototype[n]=function(...l){return console.log(`TEST: Executing: ${e.name}.${n}`),o.apply(this,l)}})}}N(C,"getAllFonts",async()=>{var l;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},s=Object.entries(t).map(([a])=>a),n=new Set;for(const a of document.styleSheets)try{if(a.ownerNode){let r="";if(a.ownerNode.tagName==="STYLE")r=a.ownerNode.textContent;else if(a.ownerNode.tagName==="LINK")try{if((l=a.href)!=null&&l.startsWith(window.location.origin)){const b=a.cssRules||a.rules;r=Array.from(b).map(h=>h.cssText).join(`
`)}}catch(b){c.warn("Could not read stylesheet rules:",[b])}const i=/@import\s+url\(['"]([^'"]+)['"]\)/g;let m;for(;(m=i.exec(r))!==null;){const b=m[1];if(b.includes("fonts.googleapis.com")){const h=b.match(/family=([^&]+)/);h&&decodeURIComponent(h[1]).split("|").map(I=>I.split(":")[0].replace(/\+/g," ")).forEach(I=>{n.add(I)})}else try{const h=await fetch(b);h.ok?(css.match(/@font-face\s*{[^}]+}/g)||[]).forEach(I=>{const B=I.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(B){const Ie=B[1].trim();n.add(Ie)}}):h.status===404?c.warn("getAllFonts() - Resource not found (404)",[b]):c.warn("getAllFonts() - HTTP error",[h.status])}catch(h){c.warn("Error processing imported CSS:",[h])}}}if(!a.href||a.href.startsWith(window.location.origin))try{const r=a.cssRules||a.rules;for(const i of r)if(i instanceof CSSFontFaceRule){const m=i.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();n.add(m)}}catch(r){c.warn("Could not read stylesheet rules:",[r])}}catch(r){c.warn("Error processing stylesheet:",[r])}return c.log("Found fonts:",[{foundry:Array.from(e),custom:s,cssImported:Array.from(n)}]),Array.from(new Set([...e,...s,...n])).filter(a=>!a.includes("FontAwesome")&&!a.includes("Font Awesome")).map(a=>a.replace(/['"`]/g,"").trim()).sort((a,r)=>a.toLowerCase().localeCompare(r.toLowerCase()))}),N(C,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t}),N(C,"addCSSVars",(e,t)=>{let s=document.querySelector("#crlngn-ui-vars");if(!s){const h=document.querySelector("body");s=document.createElement("style"),s.id="crlngn-ui-vars",s.textContent=`body.crlngn-ui {
}
`,h.prepend(s)}let n=s.textContent,o=n.indexOf("body.crlngn-ui {"),l=n.indexOf("}",o);o===-1&&(n=`body.crlngn-ui {
}
`,o=0,l=n.indexOf("}"));const r=n.substring(o+16,l).split(";").map(h=>h.trim()).filter(h=>h!==""),i={};r.forEach(h=>{const v=h.split(":");if(v.length>=2){const I=v[0].trim(),B=v.slice(1).join(":").trim();I&&(i[I]=B)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),i[e]=t;const m=Object.entries(i).map(([h,v])=>`  ${h}: ${v};`).join(`
`),b=n.substring(0,o)+`body.crlngn-ui {
`+m+`
}`+n.substring(l+1);s.textContent=b}),N(C,"addCustomCSS",e=>{let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const s=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,s.appendChild(t)}t.textContent=e});const{ApplicationV2:St,HandlebarsApplicationMixin:bt}=foundry.applications.api;var K,W,st,nt,ot;const O=class O extends bt(St){static get DEFAULT_OPTIONS(){return{id:y().customFontsMenu.tag,actions:{redefine:R(O,W,ot)},form:{handler:R(O,W,st),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=y(),s=S.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,o={},l={},a={};return n.forEach(i=>{if(t[i]){const m=S.get(t[i].tag);o[i]=t[i],l[i]=m!==void 0?m:s[t[i].oldName]||t[i].default,a[i]=t[i].default}}),{...l,default:{...a},fontList:C.getAllFonts(),fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(O,K,this.element),p(O,K).querySelectorAll('input[type="text"]').forEach(o=>{const l=o.closest(".dropdown-wrapper"),a=l==null?void 0:l.querySelector(".dropdown-options");if(!l||!a)return;const r=()=>{var i;R(i=O,W,nt).call(i),a.classList.add("active")};o.addEventListener("focus",r),o.addEventListener("click",r),o.addEventListener("keydown",i=>{const m=a.classList.contains("active"),b=Array.from(a.querySelectorAll(".dropdown-option"));let h=b.findIndex(v=>v.classList.contains("highlighted"));i.key==="ArrowDown"||i.key==="ArrowUp"?(i.preventDefault(),m||a.classList.add("active"),b.forEach(v=>v.classList.remove("highlighted")),h===-1?h=i.key==="ArrowDown"?0:b.length-1:h=i.key==="ArrowDown"?(h+1)%b.length:(h-1+b.length)%b.length,b[h]&&(b[h].classList.add("highlighted"),b[h].scrollIntoView({block:"nearest"}))):i.key==="Enter"?(i.preventDefault(),m&&h!==-1&&b[h]&&b[h].click()):i.key==="Escape"&&a.classList.remove("active")}),document.addEventListener("click",i=>{l.contains(i.target)||a.classList.remove("active")})}),p(O,K).querySelectorAll(".dropdown-option").forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(a=>a.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",l=>{const a=o.closest(".dropdown-wrapper").querySelector("input");let r=o.dataset.value;r.includes(" ")&&!r.startsWith('"')?r=`"${r}"`:r.startsWith("&quot;")&&(r=r.replace(/&quot;/g,'"')),a.value=r,o.closest(".dropdown-options").classList.remove("active")})})}};K=new WeakMap,W=new WeakSet,st=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const o=n.customFontsMenu.fields,l=foundry.utils.expandObject(s.object);o.forEach(a=>{l[a]!==void 0&&(c.log("Saving setting:",[l[a]]),S.set(n[a].tag,l[a]))}),S.set(n.customFontsMenu.tag,l),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},nt=function(){p(O,K).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ot=async function(e,t){const s=y(),o=this.element.querySelectorAll("input[type=text]"),l=s.customFontsMenu.fields,a={};l.forEach(r=>{s[r]&&(s[r],a[r]=s[r].default)}),o.forEach(r=>{r.value=a[r.name]})},L(O,W),L(O,K),N(O,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let He=O;const{ApplicationV2:Nt,HandlebarsApplicationMixin:Ct}=foundry.applications.api;var ge,at,lt;const ee=class ee extends Ct(Nt){static get DEFAULT_OPTIONS(){return{id:y().leftControlsMenu.tag,actions:{redefine:R(ee,ge,lt)},form:{handler:R(ee,ge,at),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=y(),s=S.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,o={},l={},a={};n.forEach(i=>{if(t[i]){const m=S.get(t[i].tag);o[i]=t[i],l[i]=m!==void 0?m:s[t[i].oldName]||t[i].default,a[i]=t[i].default}});const r={...l,default:{...a},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return c.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=y(),n=S.get(s.leftControlsMenu.tag);c.log("_onRender",[e,t,n])}};ge=new WeakSet,at=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const o=n.leftControlsMenu.fields,l=foundry.utils.expandObject(s.object);o.forEach(a=>{l[a]!==void 0&&(c.log("Saving setting:",[l[a]]),S.set(n[a].tag,l[a]))}),await S.set(n.leftControlsMenu.tag,l),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},lt=async function(e,t){const s=y(),o=this.element.querySelectorAll("input, select"),l=s.leftControlsMenu.default;o.forEach(a=>{a.value=l[a.name],a.type==="checkbox"&&(a.checked=l[a.name])}),c.log("#onReset",[e,t,s.leftControlsMenu.default])},L(ee,ge),N(ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let qe=ee;const{ApplicationV2:Lt,HandlebarsApplicationMixin:vt}=foundry.applications.api;var fe,it,rt;const te=class te extends vt(Lt){static get DEFAULT_OPTIONS(){return{id:y().sceneNavMenu.tag,actions:{redefine:R(te,fe,rt)},form:{handler:R(te,fe,it),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=y(),s=S.get(t.sceneNavMenu.tag),n=t.sceneNavMenu.fields,o={},l={},a={};n.forEach(i=>{if(t[i]){const m=S.get(t[i].tag);o[i]=t[i],l[i]=m!==void 0?m:s[t[i].oldName]||t[i].default,a[i]=t[i].default}});const r={...l,default:{...a},fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return c.log("_prepareContext",[r,e]),r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};fe=new WeakSet,it=async function(e,t,s){e.preventDefault(),e.stopPropagation();const n=y(),o=n.sceneNavMenu.fields;let l=S.get(n.sceneNavEnabled.tag),a=S.get(n.navFoldersEnabled.tag);const r=foundry.utils.expandObject(s.object);o.forEach(b=>{r[b]!==void 0&&(c.log("Saving setting:",[r[b]]),S.set(n[b].tag,r[b]))});let i=S.get(n.sceneNavEnabled.tag),m=S.get(n.navFoldersEnabled.tag);c.log("Saving settings...",[t,s.object,r]),await S.set(n.sceneNavMenu.tag,r),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(l!==i||a!==m)&&location.reload()},rt=async function(e,t){const s=y(),o=this.element.querySelectorAll("input, select"),l=s.sceneNavMenu.default;o.forEach(a=>{a.value=l[a.name],a.type==="checkbox"&&(a.checked=l[a.name])}),c.log("#onReset",[e,t,s.sceneNavMenu.default])},L(te,fe),N(te,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Be=te;const{ApplicationV2:Et,HandlebarsApplicationMixin:Tt}=foundry.applications.api;var Z,Y,ct,dt,ut;const U=class U extends Tt(Et){static get DEFAULT_OPTIONS(){return{id:y().themeAndStylesMenu.tag,actions:{redefine:R(U,Y,ut)},form:{handler:R(U,Y,ct),closeOnSubmit:!0},position:{width:600,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=y();S.get(t.themeAndStylesMenu.tag);const s=t.themeAndStylesMenu.fields,n={},o={},l={};s.forEach(i=>{if(t[i]){const m=S.get(t[i].tag);n[i]=t[i],o[i]=m!==void 0?m:t[i].default,l[i]=t[i].default}});const a=$.find(i=>i.className===o.colorTheme);o.colorTheme=(a==null?void 0:a.label)||$[0].label;const r={...o,default:{...l},fields:{...n},selectedTheme:a,themes:$,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...o},r}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(U,Z,this.element),this._themes=$,p(U,Z).querySelectorAll('input[type="text"]').forEach(l=>{const a=l.closest(".dropdown-wrapper"),r=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!r)return;const i=()=>{var m;R(m=U,Y,dt).call(m),r.classList.add("active")};l.addEventListener("focus",i),l.addEventListener("click",i),l.addEventListener("keydown",m=>{const b=r.classList.contains("active"),h=Array.from(r.querySelectorAll(".dropdown-option"));let v=h.findIndex(I=>I.classList.contains("highlighted"));m.key==="ArrowDown"||m.key==="ArrowUp"?(m.preventDefault(),b||r.classList.add("active"),h.forEach(I=>I.classList.remove("highlighted")),v===-1?v=m.key==="ArrowDown"?0:h.length-1:v=m.key==="ArrowDown"?(v+1)%h.length:(v-1+h.length)%h.length,h[v]&&(h[v].classList.add("highlighted"),h[v].scrollIntoView({block:"nearest"}))):m.key==="Enter"?(m.preventDefault(),b&&v!==-1&&h[v]&&h[v].click()):m.key==="Escape"&&r.classList.remove("active")}),document.addEventListener("click",m=>{a.contains(m.target)||r.classList.remove("active")})});const n=p(U,Z).querySelectorAll(".dropdown-option"),o=this;n.forEach(l=>{l.addEventListener("mouseenter",()=>{l.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),l.classList.add("highlighted")}),l.addEventListener("click",function(a){c.log("option",[l,l.querySelector(".theme-name")]);const r=l.closest(".dropdown-wrapper").querySelector("input");let i=l.querySelector(".theme-name").innerHTML.toString();if(r.value=i,r.name==="colorTheme"){const b=o._themes.find(h=>h.label===i);o._selectedTheme=b,o._updateThemePreview(b)}l.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(c.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((s,n)=>{s.style.setProperty("background-color",e.colorPreview[n])})}};Z=new WeakMap,Y=new WeakSet,ct=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const o=n.themeAndStylesMenu.fields,l=foundry.utils.expandObject(s.object),a=$.find(r=>r.label===l.colorTheme);l.colorTheme=a?a.className:"",o.forEach(r=>{l[r]!==void 0&&(c.log("Saving setting:",[l[r]]),S.set(n[r].tag,l[r]))}),S.set(n.themeAndStylesMenu.tag,l),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},dt=function(){p(U,Z).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ut=async function(e,t){const s=y(),o=this.element.querySelectorAll("input[type=text]"),l=s.themeAndStylesMenu.fields,a={};l.forEach(i=>{s[i]&&(s[i],a[i]=s[i].default)});const r=$.find(i=>i.label===s.colorTheme.default);a.colorTheme=(r==null?void 0:r.label)||$[0].label,o.forEach(i=>{i.value=a[i.name]})},L(U,Y),L(U,Z),N(U,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ve=U;function Mt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:He,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-cog",propType:Ve,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:xe,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:qe,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Ue,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Be,restricted:!1}}}var he,ye,Se,be,Ne,Ce,Le,A,$e,je,We,Ye;const d=class d{static init(){const e=y(),t=S.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(w.RENDER_CAMERA_VIEWS,d.onRenderFloating),c.log("CameraUtil",[t]),d.onRenderFloating()):(Hooks.on(w.RENDER_CAMERA_VIEWS,d.onRenderPlain),d.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,l,a;const e=y(),t=S.get(e.cameraDockMenu.tag);(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),d.cameraContainer=document.querySelector("#camera-views .camera-container");const s=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");c.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),d.cameraContainer&&n&&s&&((l=d.cameraContainer)==null||l.insertBefore(s,n),(a=document.querySelector("#camera-views .camera-container"))==null||a.classList.add("visible")),d.makeDraggable(),d.makeResizeable(),d.resetPositionAndSize(),d.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(c.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const s=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,s)}static makeDraggable(){var e;(e=d.cameraContainer)==null||e.addEventListener("mousedown",t=>{var o,l;const s=document.querySelector("body.crlngn-ui");if((o=t.target.parentNode)!=null&&o.classList.contains("volume-bar"))return;s==null||s.addEventListener("mousemove",R(d,A,je)),s==null||s.addEventListener("mouseup",R(d,A,$e));const n=C.getOffsetBottom(d.cameraContainer);d.isDragging=!0,M(d,he,t.clientX-((l=d.cameraContainer)==null?void 0:l.offsetLeft)),M(d,ye,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(d.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),d.cameraContainer.append(t),t.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),d.isResizing=!0,M(d,Se,s.clientX),M(d,be,s.clientY),M(d,Le,parseInt(getComputedStyle(d.cameraContainer).bottom)||0),M(d,Ne,d.cameraContainer.offsetWidth),M(d,Ce,d.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",R(d,A,We)),e==null||e.addEventListener("mouseup",R(d,A,Ye))})}}static resetPositionAndSize({x:e,y:t,w:s,h:n}={x:null,y:null,w:null,h:null}){const o=y(),l=S.get(o.cameraDockMenu.tag);if(!(!l.enableFloatingDock||!d.cameraContainer))if(!e&&!t&&!s&&!n){const a=l.dockPosX||0,r=l.dockPosY||0,i=l.dockWidth||0,m=l.dockHeight||0;d.cameraContainer.style.left=`${a}px`,d.cameraContainer.style.bottom=`${r}px`,d.cameraContainer.style.width=`${i}px`,d.cameraContainer.style.height=`${m}px`}else e&&(d.cameraContainer.style.left=`${e}px`),t&&(d.cameraContainer.style.bottom=`${t}px`),s&&(d.cameraContainer.style.width=`${s}px`),n&&(d.cameraContainer.style.height=`${n}px`)}};he=new WeakMap,ye=new WeakMap,Se=new WeakMap,be=new WeakMap,Ne=new WeakMap,Ce=new WeakMap,Le=new WeakMap,A=new WeakSet,$e=function(e){var n,o;const t=y(),s={...S.get(t.cameraDockMenu.tag)};if(d.isDragging){const l=document.querySelector("body.crlngn-ui");s.dockPosX=parseInt((n=d.cameraContainer)==null?void 0:n.style.left)||0,s.dockPosY=parseInt((o=d.cameraContainer)==null?void 0:o.style.bottom)||0,s.dockPosY<=0&&(s.dockPosY=0),S.set(t.cameraDockMenu.tag,s),l==null||l.removeEventListener("mousemove",R(d,A,je)),l==null||l.removeEventListener("mouseup",R(d,A,$e)),d.isDragging=!1,e.stopPropagation()}},je=function(e){if(d.isDragging&&(c.log("mousemove",[e.target.parentNode]),d.cameraContainer)){let t=e.clientX-p(d,he),s=window.innerHeight-e.clientY-p(d,ye);t+d.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-d.cameraContainer.offsetWidt),d.cameraContainer.style.left=`${t}px`,s+d.cameraContainer.offsetHeight>window.innerHeight&&(s=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${s}px`}},We=function(e){if(!d.isResizing)return;const t=p(d,Ne)+(e.clientX-p(d,Se)),s=e.clientY-p(d,be),n=p(d,Ce)+s,o=p(d,Le)-s;d.cameraContainer.style.width=`${t}px`,d.cameraContainer.style.height=`${n}px`,d.cameraContainer.style.bottom=`${o}px`},Ye=function(){var n,o,l,a,r,i;const e=y(),t={...S.get(e.cameraDockMenu.tag)},s=document.querySelector("body.crlngn-ui");d.isResizing=!1,s==null||s.removeEventListener("mousemove",R(d,A,We)),s==null||s.removeEventListener("mouseup",R(d,A,Ye)),c.log("onStopResize",[(n=d.cameraContainer)==null?void 0:n.style.width,(o=d.cameraContainer)==null?void 0:o.style.height,(l=d.cameraContainer)==null?void 0:l.style.bottom]),t.dockWidth=parseInt(((a=d.cameraContainer)==null?void 0:a.style.width)||0),t.dockHeight=parseInt(((r=d.cameraContainer)==null?void 0:r.style.height)||0),t.dockPosY=parseInt(((i=d.cameraContainer)==null?void 0:i.style.bottom)||0),S.set(e.cameraDockMenu.tag,t)},L(d,A),L(d,he,0),L(d,ye,0),N(d,"isDragging",!1),N(d,"cameraContainer"),N(d,"isResizing",!1),L(d,Se,0),L(d,be,0),L(d,Ne,0),L(d,Ce,0),L(d,Le,0);let X=d;const H=class H{static init(){const e=y();H.enableChatStyles=S.get(e.enableChatStyles.tag),H.chatBorderColor=S.get(e.chatBorderColor.tag)}};N(H,"chatBorderColor"),N(H,"enableChatStyles"),N(H,"enrichCard",async(e,t)=>{var l,a,r,i,m,b,h,v;c.log("renderChatMessage",[H.chatBorderColor,H.enableChatStyles,re.playerColor.name,(l=e.author)==null?void 0:l.id]);const s=((i=(r=(a=e.flags)==null?void 0:a.dnd5e)==null?void 0:r.activity)==null?void 0:i.type)||((h=(b=(m=e.flags)==null?void 0:m.dnd5e)==null?void 0:b.roll)==null?void 0:h.type)||"custom";let n=t.get?t.get(0):t;if(!n)return;n.classList.add(s),n.classList.add("crlngn");const o=n.querySelectorAll(".card-buttons button[data-action=rollSave]");o.length>0&&o.forEach(I=>{const B=I.querySelector(".visible-dc"),Ie=I.querySelector(".hidden-dc");c.log("enrichCard",[B,Ie]),B.setAttribute("data-ability",I.getAttribute("data-ability")||""),B.setAttribute("data-dc",I.getAttribute("data-dc")||""),Ie.setAttribute("data-ability",I.getAttribute("data-ability")||"")}),H.chatBorderColor===re.playerColor.name&&((v=e.author)!=null&&v.id)&&n.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let ce=H;var ne;const z=class z{static init(){Hooks.on(w.RENDER_PLAYERS_LIST,z.checkPlayersList),Hooks.on(w.RENDER_HOTBAR,z.checkPlayersList),C.isModuleOn("foundry-taskbar")&&Hooks.on(w.UPDATE_USER,z.checkTaskbarLock),z.checkTaskbarLock()}};ne=new WeakMap,L(z,ne),N(z,"checkTaskbarLock",()=>{var o,l,a;const e=C.isModuleOn("foundry-taskbar"),t=(o=game.user.flags)==null?void 0:o["foundry-taskbar"];if(c.log("checkTaskbarLock",[t]),!e||!t)return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(l=t.taskbarSettings)!=null&&l.locked?C.addCSSVars("--crlngn-sidebar-bottom",s?"50px":"0px"):C.addCSSVars("--crlngn-sidebar-bottom","0px"),(a=t.taskbarSettings)!=null&&a.locked?C.addCSSVars("--crlngn-taskbar-height","50px"):C.addCSSVars("--crlngn-taskbar-height","10px");const n=document.querySelector("#ft-move-players-macro");n&&(n.innerHTML=""),z.checkPlayersList()}),N(z,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),s=C.isModuleOn("foundry-taskbar"),n=s?game.settings.get("foundry-taskbar","dockPlayersList"):!1,o=s?game.settings.get("foundry-taskbar","dockMacroBar"):!1;c.log("checkPlayersList",[n,s,o,game.settings]);let l=10;n&&(l=250);const a=document.querySelector("#hotbar");a&&a.style.setProperty("visibility","hidden"),clearTimeout(p(z,ne)),M(z,ne,setTimeout(()=>{n?(c.log("checkPlayersList TEST",[n]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),a&&a.style.removeProperty("visibility"),clearTimeout(p(z,ne))},l))});let we=z;var D,P,J,oe,ae,le,ve,Ee,Fe,Pe;const g=class g{static toggleNav(e){clearTimeout(p(g,Ee)),M(g,Ee,setTimeout(()=>{g.resetLocalVars(),e?(ui.nav.collapse(),p(g,le).classList.add("navigation-collapsed")):(ui.nav.expand(),p(g,le).classList.remove("navigation-collapsed"))},500))}static resetLocalVars(){M(g,D,document.querySelector("#navigation")),M(g,oe,document.querySelector("#navigation .nav-item.is-root")),M(g,ae,document.querySelector("#nav-toggle")),M(g,le,document.querySelector("#ui-middle")),g.folderNavEnabled?M(g,P,document.querySelector("#crlngn-scene-list")):M(g,P,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=p(g,D))==null||e.addEventListener("mouseenter",()=>{if(c.log("TopNavigation mouseenter",[]),!g.isCollapsed||!g.showNavOnHover)return;clearTimeout(p(this,J));const s=document.querySelector("#scene-list");s&&(s.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,D))==null||t.addEventListener("mouseleave",n=>{if(c.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)){if(!n)var n=window.event;n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),M(this,J,setTimeout(()=>{clearTimeout(p(this,J)),M(this,J,null);const o=document.querySelector("#scene-list");o&&(o.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var a,r,i,m,b,h,v;g.resetLocalVars();const e=(a=p(this,D))==null?void 0:a.querySelectorAll("button.crlngn-nav"),t=((r=p(this,P))==null?void 0:r.scrollWidth)>=((i=p(this,D))==null?void 0:i.offsetWidth);if(c.log("placeNavButtons",[t,e,(m=p(this,P))==null?void 0:m.scrollWidth,(b=p(this,D))==null?void 0:b.offsetWidth]),!t||e.length>0)return;const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-left");const n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-chevron-left"),s.addEventListener("click",p(this,Fe)),s.append(n);const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-right");const l=document.createElement("i");l.classList.add("fa"),l.classList.add("fa-chevron-right"),o.append(l),o.addEventListener("click",p(this,Pe)),(h=p(this,D))==null||h.appendChild(s),(v=p(this,D))==null||v.appendChild(o)}static setNavPosition(e){var l,a;const t=y();if(!p(this,P))return;const s=e!==void 0?e:g.navPos||0,n=((l=p(this,P))==null?void 0:l.querySelectorAll("li.nav-item"))||[],o=((a=n[s])==null?void 0:a.offsetLeft)*-1;p(this,P).style.marginLeft=o+"px",S.set(t.sceneNavPos.tag,s),c.log("setNavPosition",[e,s,n[s],o])}};D=new WeakMap,P=new WeakMap,J=new WeakMap,oe=new WeakMap,ae=new WeakMap,le=new WeakMap,ve=new WeakMap,Ee=new WeakMap,Fe=new WeakMap,Pe=new WeakMap,L(g,D),L(g,P),L(g,J),L(g,oe),L(g,ae),L(g,le),N(g,"sceneFoldersTemplate"),L(g,ve),L(g,Ee),N(g,"sceneNavEnabled"),N(g,"navFoldersEnabled"),N(g,"navFoldersForPlayers"),N(g,"showFolderListOnClick"),N(g,"showNavOnHover"),N(g,"isCollapsed"),N(g,"navPos"),N(g,"init",async()=>{const e=y();g.isCollapsed=S.get(e.sceneNavCollapsed.tag),g.navPos=S.get(e.sceneNavPos.tag),g.resetLocalVars();const t=document.querySelector("#ui-middle");if(c.log("SCENE NAV INIT",[g.sceneNavEnabled]),g.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}const s=C.isModuleOn("monks-scene-navigation");s&&g.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),S.set(e.sceneNavEnabled.tag,!1)),c.log("TopNavigation - init",[s]),s?t.classList.add("with-monks-scene"):(g.resetLocalVars(),se.renderSceneFolders(),g.setNavPosition(),g.placeNavButtons(),g.toggleNav(S.get(e.sceneNavCollapsed.tag))),Hooks.on(w.RENDER_SCENE_NAV,(n,o,l,a)=>{c.log("SCENE NAV",[n,o,l,a]);const r=y(),i=C.isModuleOn("monks-scene-navigation");c.log(w.RENDER_SCENE_NAV,[i]),i||(c.log("NAV no transition add"),g.navPos=S.get(r.sceneNavPos.tag),se.init(),g.resetLocalVars(),se.renderSceneFolders(),p(g,P)&&p(g,P).classList.add("no-transition"),c.log(w.RENDER_SCENE_NAV,[]),g.placeNavButtons(),g.addListeners(),g.setNavPosition(),g.toggleNav(S.get(r.sceneNavCollapsed.tag)),clearTimeout(p(g,ve)),M(g,ve,setTimeout(()=>{p(g,P)&&p(g,P).classList.remove("no-transition"),c.log("NAV no transition remove")},500))),c.log("SCENE NAV STATE",[S.get(r.sceneNavCollapsed.tag)])}),Hooks.on(w.COLLAPSE_SIDE_BAR,n=>{const o=C.isModuleOn("monks-scene-navigation");c.log(w.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",o]),o||g.placeNavButtons()}),Hooks.on(w.COLLAPSE_SCENE_NAV,(n,o)=>{const l=y();S.set(l.sceneNavCollapsed.tag,o),c.log("NAV toggle",[n,o]),g.isCollapsed=o,g.toggleNav(o)}),Hooks.on(w.EXPAND_SCENE_NAV,(n,o)=>{c.log("NAV expand",[n,!1])}),window.addEventListener("resize",()=>{C.isModuleOn("monks-scene-navigation")||g.placeNavButtons()}),c.log("TopNavigation - init",[g.sceneNavEnabled])}),L(g,Fe,e=>{var m,b,h,v,I;const t=(m=p(g,ae))==null?void 0:m.offsetWidth,s=C.isModuleOn("compact-scene-navigation")?(b=p(g,oe))==null?void 0:b.offsetWidth:0,n=(h=p(g,P))==null?void 0:h.querySelector("li.nav-item:not(.is-root)"),o=((v=p(g,P))==null?void 0:v.querySelectorAll("li.nav-item"))||[],l=n.offsetWidth,a=g.navPos||0,r=Math.floor((((I=p(g,D))==null?void 0:I.offsetWidth)-(a===0?s:0)-t*2)/l);c.log("onNavLast",["currPos",a,r]);let i=a-r;i=i<0?0:i,c.log("onNavLast",["sceneCount",o.length,a,i]),g.setNavPosition(i)}),L(g,Pe,e=>{var m,b,h,v,I;const t=(m=p(g,ae))==null?void 0:m.offsetWidth,s=C.isModuleOn("compact-scene-navigation")?(b=p(g,oe))==null?void 0:b.offsetWidth:0,n=(h=p(g,P))==null?void 0:h.querySelector("li.nav-item:not(.is-root)"),o=((v=p(g,P))==null?void 0:v.querySelectorAll("li.nav-item:not(.is-root)"))||[],l=n.offsetWidth,a=g.navPos||0,r=Math.floor((((I=p(g,D))==null?void 0:I.offsetWidth)-(a===0?s:0)-t*2)/l);c.log("onNavLast",["currPos",a,r]);let i=a+r;i=i>o.length?o.length:i,g.setNavPosition(i)});let F=g;const V="Favorites";var x,Te,Ae,ze;const f=class f{static init(){f.noFolderView()||((!f.folderData||f.folderData.length===0)&&(C.isModuleOn("monks-scene-navigation")||f.preloadTemplate(),c.log("SceneNavFolders",[ui.scenes]),f.folderData=f.getFolders(ui.scenes.folders),f.selectedFolder=f.selectFolder(V)),f.registerHooks())}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||V}static refreshFolderView(){f.noFolderView()||(f.folderData=f.getFolders(ui.scenes.folders),f.renderSceneFolders())}static registerHooks(){Hooks.on("createFolder",e=>{e.type==="Scene"&&f.refreshFolderView()}),Hooks.on("updateFolder",e=>{e.type==="Scene"&&f.refreshFolderView()}),Hooks.on("deleteFolder",e=>{e.type==="Scene"&&f.refreshFolderView()}),Hooks.on("createScene",()=>f.refreshFolderView()),Hooks.on("updateScene",()=>f.refreshFolderView()),Hooks.on("deleteScene",()=>f.refreshFolderView())}};x=new WeakMap,Te=new WeakMap,Ae=new WeakMap,ze=new WeakMap,N(f,"selectedFolder"),N(f,"folderList"),N(f,"folderData",[]),N(f,"searchValue",""),N(f,"getFolders",e=>{let t=e.filter(s=>s.folder===null);return t.sort((s,n)=>s.name.toLowerCase().localeCompare(n.name.toLowerCase())),t}),N(f,"selectFolder",e=>f.getFolderById(e)),N(f,"createFolderElem",()=>document.createElement("li")),N(f,"createListElement",e=>{const t=document.createElement("ol");return t.classList.add("folder-list"),e.forEach(s=>{const n=document.createElement("li");c.log("createListElement",[s]),s.children&&s.children.length>0?n.innerHTML=`<a class="with-subfolders">${s.name}</a>`:n.innerHTML=`<a>${s.name}</a>`,t.append(n)}),t}),N(f,"preloadTemplate",async()=>{const e=[`modules/${q}/templates/scene-folder-list.hbs`];return await loadTemplates(e),c.log("preloadTemplate",[!0]),!0}),N(f,"getFoldersData",e=>({...e,children:e.children.map(t=>f.getFoldersData(t)),hasSubfolders:e.children.length>0,id:e.id})),N(f,"renderSceneFolders",async()=>{if(f.noFolderView())return;let e,t;if(!f.selectedFolder)return;c.log("SCENE NAV renderSceneFolders",[]),e=document.querySelector("#crlngn-scene-list"),e&&e.remove();const s=f.getFolders(ui.scenes.folders);f.selectedFolder===V?t={favoritesId:V,folderList:s.map(a=>f.getFoldersData(a)),currFolder:{name:V,id:V},currIcon:"fa-star",scenes:ui.nav.scenes.filter(a=>a.permission>=2),users:game.users.contents,isGM:game.user.isGM,searchValue:f.searchValue,showSearchResults:!!f.searchValue}:t={favoritesId:V,folderList:s.map(a=>f.getFoldersData(a)),currFolder:f.selectedFolder,currIcon:"fa-folder",scenes:f.selectedFolder.contents,users:game.users.contents,isGM:game.user.isGM,searchValue:f.searchValue,showSearchResults:!!f.searchValue},c.log("SCENE NAV templateData",[t]);const n=await renderTemplate(`modules/${q}/templates/scene-folder-list.hbs`,t),o=document.querySelector("#scene-list");o.insertAdjacentHTML("beforebegin",n),e=document.querySelector("#crlngn-scene-list"),e.classList.remove("hidden"),o.classList.add("hidden");const l=o.previousElementSibling;f.activateListeners(l)}),N(f,"activateListeners",e=>{if(f.noFolderView())return;F.showFolderListOnClick?(e.querySelector(".scene-folders").removeEventListener("mouseover",p(f,x)),e.querySelector(".scene-folders").removeEventListener("mouseout",p(f,x)),e.querySelector(".scene-folders a.selected").addEventListener("click",p(f,x)),e.querySelector(".scene-folders a.selected").addEventListener("blur",p(f,x))):(e.querySelector(".scene-folders").addEventListener("mouseover",p(f,x)),e.querySelector(".scene-folders").addEventListener("mouseout",p(f,x)),e.querySelector(".scene-folders a.selected").removeEventListener("click",p(f,x)),e.querySelector(".scene-folders a.selected").removeEventListener("blur",p(f,x))),e.querySelectorAll("span.toggle").forEach(o=>{o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();const r=l.currentTarget.closest("li").querySelector("ol.subfolders");if(!r)return;!r.classList.contains("open")?(r.classList.add("open"),l.currentTarget.textContent="−"):(r.classList.remove("open"),l.currentTarget.textContent="+")})}),e.querySelectorAll(".folder-list li.folder").forEach(o=>{o.addEventListener("click",p(f,Te))}),e.querySelectorAll("#crlngn-scene-list li.nav-item").forEach(o=>{o.addEventListener("click",p(f,ze))});const n=e.querySelector(".search-container .input-scene-search");n.addEventListener("keyup",p(f,Ae)),n.addEventListener("keydown",o=>{o.stopPropagation()})}),N(f,"updateSearchResults",e=>{if(f.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const s=game.scenes.filter(o=>o.name.toLowerCase().includes(e.toLowerCase())&&o.permission>=2),n=game.scenes.folders.filter(o=>o.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),n.forEach(o=>{const l=document.createElement("li");l.className="folder",l.dataset.folderId=o.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${o.name}</a>`,l.addEventListener("click",p(f,Te)),t.appendChild(l)}),s.forEach(o=>{const l=document.createElement("li");l.className="scene",l.dataset.sceneId=o.id,l.innerHTML=`<a><i class="fas fa-compass"></i> ${o.name}</a>`,l.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),c.log("scene click",[o]);const r=o.folder;r?f.selectedFolder=r:f.selectedFolder=V,game.scenes.get(o.id).view(),f.refreshFolderView()}),t.appendChild(l)}),n.length===0&&s.length===0){const o=document.createElement("li");o.className="no-results",o.textContent="No matching results found",t.appendChild(o)}}),L(f,x,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,s=t==null?void 0:t.closest(".scene-folders");s!=null&&s.classList.contains("open")?s==null||s.classList.remove("open"):s==null||s.classList.add("open")}),L(f,Te,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset;f.selectedFolder=f.selectFolder(s.folderId||""),f.refreshFolderView()}),L(f,Ae,e=>{e.stopPropagation();const s=e.currentTarget.value;f.searchValue=s,f.updateSearchResults(s)}),L(f,ze,e=>{var s,n;e.preventDefault(),e.stopPropagation();let t=((n=(s=e.currentTarget)==null?void 0:s.dataset)==null?void 0:n.sceneId)||"";t&&game.scenes.get(t).view()}),N(f,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!F.navFoldersForPlayers||!F.navFoldersEnabled||!F.sceneNavEnabled});let se=f;var ie;const u=class u{static registerSettings(){const e=y();c.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(q),Object.entries(e).forEach(async l=>{const a=l[1];c.log("Registering... ",[l],!0);const r={name:a.label,hint:a.hint,default:a.default,type:a.propType,scope:a.scope,config:a.config,requiresReload:a.requiresReload||!1,onChange:i=>u.apply(a.tag,i)};a.choices&&(r.choices=a.choices),await game.settings.register(q,a.tag,r),u.get(a.tag)===void 0&&u.set(a.tag,a.default),game.keybindings.register(q,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{u.hideInterface()},restricted:!1})}),u.applyThemeSettings(),u.applyCustomCSS(),u.applyModuleAdjustments(),F.sceneNavEnabled=u.get(e.sceneNavEnabled.tag),F.navFoldersEnabled=u.get(e.navFoldersEnabled.tag),F.navFoldersForPlayers=u.get(e.navFoldersForPlayers.tag),F.showFolderListOnClick=u.get(e.showFolderListOnClick.tag),F.showNavOnHover=u.get(e.showNavOnHover.tag),Object.entries(Mt()).forEach(async l=>{const a=l[1],r={name:a.tag,label:a.label,hint:a.hint,icon:a.icon,type:a.propType,restricted:a.restricted};await game.settings.registerMenu(q,a.tag,r)}),Hooks.on(w.RENDER_SCENE_CONTROLS,u.applyLeftControlsSettings),Hooks.on(w.RENDER_PLAYERS_LIST,u.applyPlayersListSettings),Hooks.on(w.RENDER_HOTBAR,()=>{u.firstLoad&&(u.firstLoad=!1,u.applyHotBarCollapse()),u.applyHotBarSettings()}),u.applyDebugSettings(),u.applySceneNavPos(),u.applyChatStyles(),u.applyBorderColors(),e.customFontsMenu.fields.forEach(l=>{u.applyCustomFonts(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{u.applyLeftControlsSettings(e[l].tag)})}static get(e,t=q){if(!e)return null;let s=!1;if(t===q)s=game.settings.get(t,e);else{let o=game.settings.storage.get("client")[`${t}.${e}`];o===void 0&&(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),s=o==null?void 0:o.value,c.log("GET Setting",[o,s])}return s}static set(e,t,s=q){if(!e)return!1;let n=game.settings.storage.get("client")[`${s}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${s}.${e}`)),c.log("Setting",[e,n]);try{game.settings.set(s,e,t)}catch{c.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const s=y();switch(t===void 0&&(t=u.get(e)),c.log("SettingsUtil.apply",[e,t,u.get(e)]),e){case s.enableMacroLayout.tag:u.applyHotBarSettings();break;case s.collapseMacroBar.tag:u.applyHotBarCollapse();break;case s.autoHidePlayerList.tag:u.applyPlayersListSettings();break;case s.uiFontBody.tag:case s.uiFontTitles.tag:case s.journalFontBody.tag:case s.journalFontTitles.tag:u.applyCustomFonts(e,t);break;case s.controlsBottomBuffer.tag:case s.controlsIconSize.tag:case s.controlsAutoHide.tag:case s.hideFoundryLogo.tag:u.applyLeftControlsSettings(e,t);break;case s.cameraDockMenu.tag:u.applyCameraPosX(),u.applyCameraPosY(),u.applyCameraWidth(),u.applyCameraHeight();break;case s.chatBorderColor.tag:ce.chatBorderColor=u.get(s.chatBorderColor.tag),c.log("SettingsUtil.apply",[e]),u.applyBorderColors();break;case s.enableChatStyles.tag:ce.enableChatStyles=u.get(s.enableChatStyles.tag),c.log("SettingsUtil.apply",[e]),u.applyChatStyles();break;case s.enforceDarkMode.tag:u.resetFoundryThemeSettings();break;case s.debugMode.tag:u.applyDebugSettings();break;case s.sceneNavEnabled.tag:F.sceneNavEnabled=t;break;case s.navFoldersEnabled.tag:F.navFoldersEnabled=t;break;case s.navFoldersForPlayers.tag:F.navFoldersForPlayers=t;break;case s.showFolderListOnClick.tag:F.showFolderListOnClick=t,se.refreshFolderView();break;case s.showNavOnHover.tag:F.showNavOnHover=t;break;case s.sceneNavCollapsed.tag:F.isCollapsed=u.get(s.sceneNavCollapsed.tag);break;case s.sceneNavPos.tag:u.applySceneNavPos();break;case s.colorTheme.tag:u.applyThemeSettings();break;case s.customStyles.tag:u.applyCustomCSS();break;case s.adjustOtherModules.tag:u.applyModuleAdjustments();break}}static applyBorderColors(){const e=y(),t=u.get(e.chatBorderColor.tag),s=document.querySelector("body");t===re.playerColor.name?(s.classList.add("player-chat-borders"),s.classList.remove("roll-chat-borders")):t===re.rollType.name?(s.classList.add("roll-chat-borders"),s.classList.remove("player-chat-borders")):(s.classList.remove("player-chat-borders"),s.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=y(),t=u.get(e.enableChatStyles.tag),s=document.querySelector("body");c.log("applyChatStyles",[t,e]),t?s.classList.add("crlngn-chat"):s.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=y(),t=u.get(e.enableMacroLayout.tag),s=document.querySelector("#hotbar");!t&&s?s.classList.add("foundry-default"):s&&s.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=y();u.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const s=y(),n=u.get(s.sceneNavEnabled.tag),o=document.querySelector("#ui-left"),l=document.querySelector("#ui-left #logo"),a=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),c.log("applyLeftControlsSettings",[e]),e){case s.controlsAutoHide.tag:u.get(s.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break;case s.hideFoundryLogo.tag:const i=window.getComputedStyle(a).getPropertyValue("--top-nav-height")||"0px",m=parseFloat(i)||0,b=u.get(s.hideFoundryLogo.tag);c.log("applyLeftControlsSettings",[e,m,i]),b===void 0||b===!0?(l.classList.remove("visible"),C.addCSSVars("--ui-top-padding",`${m}px`),document.querySelector("body").classList.remove("logo-visible")):(l.classList.add("visible"),n?(C.addCSSVars("--ui-top-padding",`${72+m}px`),document.querySelector("body").classList.add("logo-visible")):C.addCSSVars("--ui-top-padding","72px"));break;case s.controlsBottomBuffer.tag:u.applyControlsBuffer();break;case s.controlsIconSize.tag:u.applyControlIconSize();break}}static applyControlIconSize(){const e=y(),t=u.get(e.controlsIconSize.tag);document.querySelector("body");const s=t==pe.small.name?pe.small.size:pe.regular.size;c.log("applyControlIconSize",[s]),C.addCSSVars("--left-control-item-size",s),u.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=y(),t=u.get(e.leftControlsMenu.tag),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;C.addCSSVars("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,s;const e=y();c.log("applyPlayersListSettings",[document.querySelector("#players"),u.get(e.autoHidePlayerList.tag)]),u.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(s=document.querySelector("#players"))==null||s.classList.remove("auto-hide"),we.checkPlayersList()}static applySceneNavPos(e){const t=y();u.set(t.sceneNavPos.tag,e||u.get(t.sceneNavPos.tag)),F.navPos=e||u.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=y(),s=u.get(t.cameraDockMenu.tag),n=e||s.dockPosX;X.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=y(),s=u.get(t.cameraDockMenu.tag),n=e||s.dockPosY;X.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=y(),s=u.get(t.cameraDockMenu.tag),n=e||s.dockWidth;X.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=y(),s=u.get(t.cameraDockMenu.tag),n=e||s.dockHeight;X.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const s=y(),n=s.customFontsMenu.fields,o={};switch(c.log("applyCustomFonts",[e,t]),n.forEach(l=>{o[l]=u.get(s[l].tag)}),document.querySelector("body.crlngn-ui"),e){case s.uiFontBody.tag:C.addCSSVars("--crlngn-font-family",t||o.uiFontBody||s.uiFontBody.default.uiFont||"");break;case s.uiFontTitles.tag:C.addCSSVars("--crlngn-font-titles",t||o.uiFontTitles||s.uiFontTitles.default.uiTitles||"");break;case s.journalFontBody.tag:C.addCSSVars("--crlngn-font-journal-body",t||o.journalFontBody||o.journalFontBody||"");break;case s.journalFontTitles.tag:C.addCSSVars("--crlngn-font-journal-title",t||o.journalFontTitles||o.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=y(),t=C.isModuleOn("monks-player-settings"),s=C.isModuleOn("force-client-settings"),n=u.get(e.enforceDarkMode.tag);if(n&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),u.set(e.enforceDarkMode.tag,!1));return}if(n&&s){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),u.set(e.enforceDarkMode.tag,!1));return}const o=game.settings.get("core","colorScheme");c.log("resetFoundryThemeSettings",[o,n]),o===!1&&n&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=y();c.debugOn=e||u.get(t.debugMode.tag)}};ie=new WeakMap,L(u,ie,!1),N(u,"firstLoad",!0),N(u,"applyThemeSettings",e=>{const t=y(),s=e||u.get(t.colorTheme.tag)||"",n=document.querySelector("body");c.log("applyThemeSettings",[e,s,u.get(t.colorTheme.tag)]),$.forEach(o=>{o.className&&n.classList.remove(o.className)}),s&&n.classList.add(s)}),N(u,"applyCustomCSS",e=>{const t=y(),s=e||u.get(t.customStyles.tag)||"";C.addCustomCSS(s)}),N(u,"applyModuleAdjustments",e=>{const t=y(),s=e||u.get(t.adjustOtherModules.tag)||!1,n=document.querySelector("body");s?n.classList.add("crlngn-enforce-styles"):n.classList.remove("crlngn-enforce-styles")}),N(u,"hideInterface",()=>{c.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),s=document.querySelector(".taskbar");p(u,ie)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&s.style.removeProperty("visibility"),M(u,ie,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),s&&s.style.setProperty("visibility","hidden"),M(u,ie,!0))});let S=u;class Ze{static init(){Hooks.on(w.RENDER_PLAYERS_LIST,Ze.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child"),s=e.offsetHeight;C.addCSSVars("--players-list-height",s+"px"),!(!e||!t)&&t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var j,Me,ke;const G=class G{static init(){c.log("LeftControls - init",[]),Hooks.on(w.RENDER_SCENE_CONTROLS,G.initSceneControls),G.initSceneControls()}static resetLocalVars(){M(G,j,document.querySelector("#ui-left #controls")),M(G,Me,document.querySelector("#ui-left"))}static initSceneControls(){c.log("initSceneControls",[]),G.resetLocalVars(),G.observeControlsWidth()}static observeControlsWidth(){if(c.log("observeControlsWidth",[]),!p(G,j))return;let e;const t=(s,n)=>{e||(e=setTimeout(()=>{s(),e=null},n))};M(G,ke,new ResizeObserver(s=>{t(()=>G.updateCSSVars(),250)},{box:"border-box"})),p(G,ke).observe(p(G,j)),G.updateCSSVars()}static updateCSSVars(){if(!p(G,j))return;let e=Number(p(G,Me).offsetWidth),t=Number(p(G,j).offsetWidth),s=-e+t+24;c.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&C.addCSSVars("--ui-controls-margin-left",s+"px")}};j=new WeakMap,Me=new WeakMap,ke=new WeakMap,L(G,j),L(G,Me),L(G,ke);let Xe=G;var De;const me=class me{static init(){Hooks.once(w.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(q),c.log("Initiating module...",[],!0),Hooks.on(w.RENDER_CHAT_MESSAGE,p(me,De)),S.registerSettings(),F.init(),X.init(),Ze.init(),Xe.init(),ce.init()}),Hooks.once(w.READY,()=>{c.log("Core Ready",[]);const e=y();var t=S.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),we.init(),S.get(e.enableChatStyles.tag)&&me.addCSSLocalization(),S.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";C.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),C.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),C.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),C.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),C.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),C.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),C.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),C.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),C.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),C.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};De=new WeakMap,L(me,De,(e,t)=>{c.log(w.RENDER_CHAT_MESSAGE,[e,t]),ce.enrichCard(e,t)});let Ke=me;Ke.init();
//# sourceMappingURL=crlngn-ui.js.map
