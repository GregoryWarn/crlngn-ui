var ot=Object.defineProperty;var qe=L=>{throw TypeError(L)};var st=(L,e,t)=>e in L?ot(L,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):L[e]=t;var v=(L,e,t)=>st(L,typeof e!="symbol"?e+"":e,t),Te=(L,e,t)=>e.has(L)||qe("Cannot "+t);var p=(L,e,t)=>(Te(L,e,"read from private field"),t?t.call(L):e.get(L)),b=(L,e,t)=>e.has(L)?qe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(L):e.set(L,t),T=(L,e,t,n)=>(Te(L,e,"write to private field"),n?n.call(L,t):e.set(L,t),t),M=(L,e,t)=>(Te(L,e,"access private method"),t);const E={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},O="crlngn-ui",be=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Ce=class Ce{static log(e="",t=[],n=!1){try{const s=Ce.debugOn;if(!(n||s))return;console.log(...be,e,...t)}catch{console.log(...be,e,...t)}}static warn(e="",t=[]){console.warn(...be,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...be,e)}};v(Ce,"debugOn",!1);let d=Ce;const N={select:"select",checkbox:"checkbox",text:"text",number:"number"},C={client:"client",world:"world"},ce={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},ne={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},H=[{label:"Carolingian",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Banana Dark Chocolate",className:"crlngn-theme-banana",colorPreview:["rgb(30, 22, 15)","rgb(205, 175, 0)"]},{label:"Purple Sorcery",className:"crlngn-theme-purple-sorcery",colorPreview:["rgb(58, 64, 94)","rgb(83, 67, 137)"]},{label:"Red Velvet",className:"crlngn-theme-red-velvet",colorPreview:["rgb(45, 30, 25)","rgb(165, 28, 28)"]}];function u(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:C.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","customStyles"],default:{colorTheme:"",customStyles:""},scope:C.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:N.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:ne.playerColor.name},scope:C.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:ce.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:C.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:C.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:C.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:C.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:C.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:C.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:C.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:C.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:C.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:N.text,propType:String,default:"",scope:C.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:N.text,propType:String,default:"",scope:C.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:N.text,default:ne.playerColor.name,scope:C.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:C.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:N.number,default:200,scope:C.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:ce.small.name,scope:C.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox,propType:Boolean,default:!1,scope:C.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:N.checkbox,propType:Boolean,default:!0,scope:C.client,config:!1}}}const{ApplicationV2:at,HandlebarsApplicationMixin:it}=foundry.applications.api;var se,He,$e;const Y=class Y extends it(at){static get DEFAULT_OPTIONS(){return{id:u().cameraDockMenu.tag,actions:{redefine:M(Y,se,$e)},form:{handler:M(Y,se,He),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=u(),n={...m.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return d.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};se=new WeakSet,He=async function(e,t,n){const s=u();let a=m.get(s.cameraDockMenu.tag),i=a.enableFloatingDock;e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);await m.set(s.cameraDockMenu.tag,o),a=m.get(s.cameraDockMenu.tag),d.log("Saving settings:",[s.cameraDockMenu.tag,t,n.object,o,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.enableFloatingDock!=i&&location.reload()},$e=async function(e,t){const n=u(),a=this.element.querySelectorAll("input, select"),i=n.cameraDockMenu.default;a.forEach(o=>{o.value=i[o.name],o.type==="checkbox"&&(o.checked=i[o.name])}),d.log("#onReset",[e,t,n.cameraDockMenu.default])},b(Y,se),v(Y,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ee=Y;const{ApplicationV2:lt,HandlebarsApplicationMixin:ct}=foundry.applications.api;var ae,We,je;const X=class X extends ct(lt){static get DEFAULT_OPTIONS(){return{id:u().chatMessagesMenu.tag,actions:{redefine:M(X,ae,je)},form:{handler:M(X,ae,We),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=u(),n=m.get(t.chatMessagesMenu.tag),s=t.chatMessagesMenu.fields,a={},i={},o={};s.forEach(l=>{if(d.log("_prepareContext",[t[l].oldName]),t[l]){const S=m.get(t[l].tag);a[l]=t[l],i[l]=S!==void 0?S:n[t[l].oldName]||t[l].default,o[l]=t[l].default}}),d.log("_prepareContext",[i,o]);const c={...i,default:{...o},isGM:game.user.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return d.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=u(),s=m.get(n.chatMessagesMenu.tag);d.log("_onRender",[e,t,s])}};ae=new WeakSet,We=async function(e,t,n){const s=u();e.preventDefault(),e.stopPropagation();const a=s.chatMessagesMenu.fields,i=foundry.utils.expandObject(n.object),o=m.get(s.chatBorderColor.tag);d.log("Compared settings:",[i.chatBorderColor,o]),a.forEach(l=>{d.log("Saving setting >>",[s[l].tag,i[l]]),i[l]!==void 0&&m.set(s[l].tag,i[l])}),await m.set(s.chatMessagesMenu.tag,i),i.chatBorderColor!==o&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},je=async function(e,t){const n=u(),a=this.element.querySelectorAll("input, select"),i=n.chatMessagesMenu.fields,o={};i.forEach(c=>{n[c]&&(n[c],o[c]=n[c].default)}),a.forEach(c=>{c.value=o[c.name]})},b(X,ae),v(X,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Re=X;class I{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,s=e.offsetParent;return(s?s.clientHeight:window.innerHeight)-(t+n)}static getAllFonts(){var i;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([o])=>o),s=new Set;for(const o of document.styleSheets)try{if(o.ownerNode){let c="";if(o.ownerNode.tagName==="STYLE")c=o.ownerNode.textContent;else if(o.ownerNode.tagName==="LINK")try{if((i=o.href)!=null&&i.startsWith(window.location.origin)){const y=o.cssRules||o.rules;c=Array.from(y).map(h=>h.cssText).join(`
`)}}catch(y){d.warn("Could not read stylesheet rules:",[y])}const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let S;for(;(S=l.exec(c))!==null;){const y=S[1];if(y.includes("fonts.googleapis.com")){const h=y.match(/family=([^&]+)/);h&&decodeURIComponent(h[1]).split("|").map(U=>U.split(":")[0].replace(/\+/g," ")).forEach(U=>{s.add(U)})}else try{fetch(y).then(h=>h.text()).then(h=>{(h.match(/@font-face\s*{[^}]+}/g)||[]).forEach(U=>{const Be=U.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(Be){const nt=Be[1].trim();s.add(nt)}})}).catch(h=>console.warn("Error loading imported CSS:",h))}catch(h){d.warn("Error processing imported CSS:",[h])}}}if(!o.href||o.href.startsWith(window.location.origin))try{const c=o.cssRules||o.rules;for(const l of c)if(l instanceof CSSFontFaceRule){const S=l.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();s.add(S)}}catch(c){d.warn("Could not read stylesheet rules:",[c])}}catch(c){d.warn("Error processing stylesheet:",[c])}return d.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(s)}]),Array.from(new Set([...e,...n,...s])).filter(o=>!o.includes("FontAwesome")&&!o.includes("Font Awesome")).map(o=>o.replace(/['"`]/g,"").trim()).sort((o,c)=>o.toLowerCase().localeCompare(c.toLowerCase()))}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(s=>typeof e[s]=="function"&&s!=="constructor"&&s!=="prototype"&&s!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(s=>{const a=e[s];e[s]=function(...i){return console.log(`TEST: Executing: ${e.name}.${s}`),a.apply(this,i)}});const n=Object.getOwnPropertyNames(e.prototype).filter(s=>typeof e.prototype[s]=="function"&&s!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,n),n.forEach(s=>{const a=e.prototype[s];e.prototype[s]=function(...i){return console.log(`TEST: Executing: ${e.name}.${s}`),a.apply(this,i)}})}}v(I,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:rt,HandlebarsApplicationMixin:dt}=foundry.applications.api;var W,B,Ve,Ye,Xe;const A=class A extends dt(rt){static get DEFAULT_OPTIONS(){return{id:u().customFontsMenu.tag,actions:{redefine:M(A,B,Xe)},form:{handler:M(A,B,Ve),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=u(),n=m.get(t.customFontsMenu.tag),s=t.customFontsMenu.fields,a={},i={},o={};return s.forEach(l=>{if(t[l]){const S=m.get(t[l].tag);a[l]=t[l],i[l]=S!==void 0?S:n[t[l].oldName]||t[l].default,o[l]=t[l].default}}),{...i,default:{...o},fontList:I.getAllFonts(),fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){T(A,W,this.element),p(A,W).querySelectorAll('input[type="text"]').forEach(a=>{const i=a.closest(".dropdown-wrapper"),o=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!o)return;const c=()=>{var l;M(l=A,B,Ye).call(l),o.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",l=>{const S=o.classList.contains("active"),y=Array.from(o.querySelectorAll(".dropdown-option"));let h=y.findIndex(k=>k.classList.contains("highlighted"));l.key==="ArrowDown"||l.key==="ArrowUp"?(l.preventDefault(),S||o.classList.add("active"),y.forEach(k=>k.classList.remove("highlighted")),h===-1?h=l.key==="ArrowDown"?0:y.length-1:h=l.key==="ArrowDown"?(h+1)%y.length:(h-1+y.length)%y.length,y[h]&&(y[h].classList.add("highlighted"),y[h].scrollIntoView({block:"nearest"}))):l.key==="Enter"?(l.preventDefault(),S&&h!==-1&&y[h]&&y[h].click()):l.key==="Escape"&&o.classList.remove("active")}),document.addEventListener("click",l=>{i.contains(l.target)||o.classList.remove("active")})}),p(A,W).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(o=>o.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",i=>{const o=a.closest(".dropdown-wrapper").querySelector("input");let c=a.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),o.value=c,a.closest(".dropdown-options").classList.remove("active")})})}};W=new WeakMap,B=new WeakSet,Ve=async function(e,t,n){const s=u();e.preventDefault(),e.stopPropagation();const a=s.customFontsMenu.fields,i=foundry.utils.expandObject(n.object);a.forEach(o=>{i[o]!==void 0&&(d.log("Saving setting:",[i[o]]),m.set(s[o].tag,i[o]))}),m.set(s.customFontsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ye=function(){p(A,W).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Xe=async function(e,t){const n=u(),a=this.element.querySelectorAll("input[type=text]"),i=n.customFontsMenu.fields,o={};i.forEach(c=>{n[c]&&(n[c],o[c]=n[c].default)}),a.forEach(c=>{c.value=o[c.name]})},b(A,B),b(A,W),v(A,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ke=A;const{ApplicationV2:gt,HandlebarsApplicationMixin:ut}=foundry.applications.api;var ie,Ke,Ze;const K=class K extends ut(gt){static get DEFAULT_OPTIONS(){return{id:u().leftControlsMenu.tag,actions:{redefine:M(K,ie,Ze)},form:{handler:M(K,ie,Ke),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=u(),n=m.get(t.leftControlsMenu.tag),s=t.leftControlsMenu.fields,a={},i={},o={};s.forEach(l=>{if(t[l]){const S=m.get(t[l].tag);a[l]=t[l],i[l]=S!==void 0?S:n[t[l].oldName]||t[l].default,o[l]=t[l].default}});const c={...i,default:{...o},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return d.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=u(),s=m.get(n.leftControlsMenu.tag);d.log("_onRender",[e,t,s])}};ie=new WeakSet,Ke=async function(e,t,n){const s=u();e.preventDefault(),e.stopPropagation();const a=s.leftControlsMenu.fields,i=foundry.utils.expandObject(n.object);a.forEach(o=>{i[o]!==void 0&&(d.log("Saving setting:",[i[o]]),m.set(s[o].tag,i[o]))}),await m.set(s.leftControlsMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ze=async function(e,t){const n=u(),a=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;a.forEach(o=>{o.value=i[o.name],o.type==="checkbox"&&(o.checked=i[o.name])}),d.log("#onReset",[e,t,n.leftControlsMenu.default])},b(K,ie),v(K,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ie=K;const{ApplicationV2:ft,HandlebarsApplicationMixin:pt}=foundry.applications.api;var le,Je,Qe;const Z=class Z extends pt(ft){static get DEFAULT_OPTIONS(){return{id:u().sceneNavMenu.tag,actions:{redefine:M(Z,le,Qe)},form:{handler:M(Z,le,Je),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=u(),n={...m.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return d.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};le=new WeakSet,Je=async function(e,t,n){const s=u();let a=m.get(s.sceneNavMenu.tag),i=a.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);await m.set(s.sceneNavMenu.tag,o),a=m.get(s.sceneNavMenu.tag),d.log("Saving settings...",[s.sceneNavMenu.tag,t,n.object,o,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.sceneNavEnabled!=i&&location.reload()},Qe=async function(e,t){const n=u(),a=this.element.querySelectorAll("input, select"),i=n.sceneNavMenu.default;a.forEach(o=>{o.value=i[o.name],o.type==="checkbox"&&(o.checked=i[o.name])}),d.log("#onReset",[e,t,n.sceneNavMenu.default])},b(Z,le),v(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ge=Z;const{ApplicationV2:mt,HandlebarsApplicationMixin:ht}=foundry.applications.api;var j,q,_e,et,tt;const D=class D extends ht(mt){static get DEFAULT_OPTIONS(){return{id:u().themeAndStylesMenu.tag,actions:{redefine:M(D,q,tt)},form:{handler:M(D,q,_e),closeOnSubmit:!0},position:{width:600,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=u();m.get(t.themeAndStylesMenu.tag);const n=t.themeAndStylesMenu.fields,s={},a={},i={};n.forEach(l=>{if(t[l]){const S=m.get(t[l].tag);s[l]=t[l],a[l]=S!==void 0?S:t[l].default,i[l]=t[l].default}});const o=H.find(l=>l.label===a.colorTheme);return a.colorTheme=(o==null?void 0:o.label)||H[0].label,{...a,default:{...i},fields:{...s},themes:H,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){T(D,j,this.element),p(D,j).querySelectorAll('input[type="text"]').forEach(a=>{const i=a.closest(".dropdown-wrapper"),o=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!o)return;const c=()=>{var l;M(l=D,q,et).call(l),o.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",l=>{const S=o.classList.contains("active"),y=Array.from(o.querySelectorAll(".dropdown-option"));let h=y.findIndex(k=>k.classList.contains("highlighted"));l.key==="ArrowDown"||l.key==="ArrowUp"?(l.preventDefault(),S||o.classList.add("active"),y.forEach(k=>k.classList.remove("highlighted")),h===-1?h=l.key==="ArrowDown"?0:y.length-1:h=l.key==="ArrowDown"?(h+1)%y.length:(h-1+y.length)%y.length,y[h]&&(y[h].classList.add("highlighted"),y[h].scrollIntoView({block:"nearest"}))):l.key==="Enter"?(l.preventDefault(),S&&h!==-1&&y[h]&&y[h].click()):l.key==="Escape"&&o.classList.remove("active")}),document.addEventListener("click",l=>{i.contains(l.target)||o.classList.remove("active")})}),p(D,j).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(o=>o.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",i=>{d.log("option",[a,a.querySelector(".theme-name")]);const o=a.closest(".dropdown-wrapper").querySelector("input");let c=a.querySelector(".theme-name").innerHTML.toString();o.value=c,a.closest(".dropdown-options").classList.remove("active")})})}};j=new WeakMap,q=new WeakSet,_e=async function(e,t,n){const s=u();e.preventDefault(),e.stopPropagation();const a=s.themeAndStylesMenu.fields,i=foundry.utils.expandObject(n.object),o=H.find(c=>c.label===i.colorTheme);i.colorTheme=o?o.className:"",a.forEach(c=>{i[c]!==void 0&&(d.log("Saving setting:",[i[c]]),m.set(s[c].tag,i[c]))}),m.set(s.themeAndStylesMenu.tag,i),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},et=function(){p(D,j).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},tt=async function(e,t){const n=u(),a=this.element.querySelectorAll("input[type=text]"),i=n.themeAndStylesMenu.fields,o={};i.forEach(l=>{n[l]&&(n[l],o[l]=n[l].default)});const c=H.find(l=>l.label===n.colorTheme.default);o.colorTheme=(c==null?void 0:c.label)||H[0].label,a.forEach(l=>{l.value=o[l.name]})},b(D,q),b(D,j),v(D,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let we=D;function yt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:ke,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-cog",propType:we,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:Re,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Ie,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Ee,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Ge,restricted:!1}}}var de,ge,ue,fe,pe,me,he,G,Pe,ze,Ae,De;const r=class r{static init(){const e=u(),t=m.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(E.RENDER_CAMERA_VIEWS,r.onRenderFloating),d.log("CameraUtil",[t]),r.onRenderFloating()):(Hooks.on(E.RENDER_CAMERA_VIEWS,r.onRenderPlain),r.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var a,i,o;const e=u(),t=m.get(e.cameraDockMenu.tag);(a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-ui"),r.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),s=document.querySelector("#camera-views .camera-grid");d.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),r.cameraContainer&&s&&n&&((i=r.cameraContainer)==null||i.insertBefore(n,s),(o=document.querySelector("#camera-views .camera-container"))==null||o.classList.add("visible")),r.makeDraggable(),r.makeResizeable(),r.resetPositionAndSize(),r.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(d.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),s=document.createElement("button");s.classList.add("crlngn-video-toggle"),s.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(s,n)}static makeDraggable(){var e;(e=r.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,i;const n=document.querySelector("body.crlngn-ui");if(d.log("mousedown",[t.target]),(a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",M(r,G,ze)),n==null||n.addEventListener("mouseup",M(r,G,Pe));const s=I.getOffsetBottom(r.cameraContainer);r.isDragging=!0,T(r,de,t.clientX-((i=r.cameraContainer)==null?void 0:i.offsetLeft)),T(r,ge,window.innerHeight-t.clientY-s),t.stopPropagation()})}static makeResizeable(){if(r.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),r.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),r.isResizing=!0,T(r,ue,n.clientX),T(r,fe,n.clientY),T(r,he,parseInt(getComputedStyle(r.cameraContainer).bottom)||0),T(r,pe,r.cameraContainer.offsetWidth),T(r,me,r.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",M(r,G,Ae)),e==null||e.addEventListener("mouseup",M(r,G,De))})}}static resetPositionAndSize({x:e,y:t,w:n,h:s}={x:null,y:null,w:null,h:null}){const a=u(),i=m.get(a.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!r.cameraContainer))if(!e&&!t&&!n&&!s){const o=i.dockPosX||0,c=i.dockPosY||0,l=i.dockWidth||0,S=i.dockHeight||0;r.cameraContainer.style.left=`${o}px`,r.cameraContainer.style.bottom=`${c}px`,r.cameraContainer.style.width=`${l}px`,r.cameraContainer.style.height=`${S}px`}else e&&(r.cameraContainer.style.left=`${e}px`),t&&(r.cameraContainer.style.bottom=`${t}px`),n&&(r.cameraContainer.style.width=`${n}px`),s&&(r.cameraContainer.style.height=`${s}px`)}};de=new WeakMap,ge=new WeakMap,ue=new WeakMap,fe=new WeakMap,pe=new WeakMap,me=new WeakMap,he=new WeakMap,G=new WeakSet,Pe=function(e){var s,a;const t=u(),n={...m.get(t.cameraDockMenu.tag)};if(r.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((s=r.cameraContainer)==null?void 0:s.style.left)||0,n.dockPosY=parseInt((a=r.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),m.set(t.cameraDockMenu.tag,n),i==null||i.removeEventListener("mousemove",M(r,G,ze)),i==null||i.removeEventListener("mouseup",M(r,G,Pe)),r.isDragging=!1,e.stopPropagation()}},ze=function(e){if(r.isDragging&&(d.log("mousemove",[e.target.parentNode]),r.cameraContainer)){let t=e.clientX-p(r,de),n=window.innerHeight-e.clientY-p(r,ge);t+r.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-r.cameraContainer.offsetWidt),r.cameraContainer.style.left=`${t}px`,n+r.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-r.cameraContainer.offsetHeight),r.cameraContainer.style.bottom=`${n}px`}},Ae=function(e){if(!r.isResizing)return;const t=p(r,pe)+(e.clientX-p(r,ue)),n=e.clientY-p(r,fe),s=p(r,me)+n,a=p(r,he)-n;r.cameraContainer.style.width=`${t}px`,r.cameraContainer.style.height=`${s}px`,r.cameraContainer.style.bottom=`${a}px`},De=function(){var s,a,i,o,c,l;const e=u(),t={...m.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");r.isResizing=!1,n==null||n.removeEventListener("mousemove",M(r,G,Ae)),n==null||n.removeEventListener("mouseup",M(r,G,De)),d.log("onStopResize",[(s=r.cameraContainer)==null?void 0:s.style.width,(a=r.cameraContainer)==null?void 0:a.style.height,(i=r.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((o=r.cameraContainer)==null?void 0:o.style.width)||0),t.dockHeight=parseInt(((c=r.cameraContainer)==null?void 0:c.style.height)||0),t.dockPosY=parseInt(((l=r.cameraContainer)==null?void 0:l.style.bottom)||0),m.set(e.cameraDockMenu.tag,t)},b(r,G),b(r,de,0),b(r,ge,0),v(r,"isDragging",!1),v(r,"cameraContainer"),v(r,"isResizing",!1),b(r,ue,0),b(r,fe,0),b(r,pe,0),b(r,me,0),b(r,he,0);let $=r;const x=class x{static init(){const e=u();x.enableChatStyles=m.get(e.enableChatStyles.tag),x.chatBorderColor=m.get(e.chatBorderColor.tag)}static enrichCard(e,t){var n,s,a,i,o,c,l,S;if(x.enableChatStyles){const y=((a=(s=(n=e.flags)==null?void 0:n.dnd5e)==null?void 0:s.activity)==null?void 0:a.type)||((c=(o=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:o.roll)==null?void 0:c.type)||"custom";let h=t.get?t.get(0):t;h.classList.add(y),d.log("enrichCard",[x.chatBorderColor,ne.playerColor.name,(l=e.author)==null?void 0:l.id]),x.chatBorderColor===ne.playerColor.name&&((S=e.author)!=null&&S.id)&&h.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}}};v(x,"chatBorderColor"),v(x,"enableChatStyles");let oe=x;var Q;const w=class w{static init(){Hooks.on(E.RENDER_PLAYERS_LIST,w.checkPlayersList),Hooks.on(E.RENDER_HOTBAR,w.checkPlayersList),I.isModuleOn("foundry-taskbar")&&Hooks.on(E.UPDATE_USER,w.checkTaskbarLock),w.checkTaskbarLock()}};Q=new WeakMap,b(w,Q),v(w,"checkTaskbarLock",()=>{var i,o,c;const e=I.isModuleOn("foundry-taskbar"),t=document.querySelector("body.crlngn-ui"),n=(i=game.user.flags)==null?void 0:i["foundry-taskbar"];if(d.log("checkTaskbarLock",[n]),!e||!n)return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(o=n.taskbarSettings)!=null&&o.locked?t.style.setProperty("--crlngn-sidebar-bottom",s?"50px":"0px"):t.style.setProperty("--crlngn-sidebar-bottom","0px"),(c=n.taskbarSettings)!=null&&c.locked?t.style.setProperty("--crlngn-taskbar-height","50px"):t.style.setProperty("--crlngn-taskbar-height","10px");const a=document.querySelector("#ft-move-players-macro");a&&(a.innerHTML=""),w.checkPlayersList()}),v(w,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),n=I.isModuleOn("foundry-taskbar"),s=n?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=n?game.settings.get("foundry-taskbar","dockMacroBar"):!1;d.log("checkPlayersList",[s,n,a,game.settings]);let i=10;s&&(i=250);const o=document.querySelector("#hotbar");o&&o.style.setProperty("visibility","hidden"),clearTimeout(p(w,Q)),T(w,Q,setTimeout(()=>{s?(d.log("checkPlayersList TEST",[s]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),o&&o.style.removeProperty("visibility"),clearTimeout(p(w,Q))},i))});let Ne=w;var P,z,V,_,ee,Oe,Le,ve;const f=class f{static init(){const e=u();f.navSettings=m.get(e.sceneNavMenu.tag),f.isCollapsed=m.get(e.sceneNavCollapsed.tag),f.navPos=m.get(e.sceneNavPos.tag);const t=document.querySelector("#ui-middle");let n=f.navSettings;if(n.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}f.resetLocalVars();const s=I.isModuleOn("monks-scene-navigation");s&&n.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),m.set(e.sceneNavMenu.tag,{...n,sceneNavEnabled:!1})),d.log("TopNavigation - init",[s]),s?t.classList.add("with-monks-scene"):(f.resetLocalVars(),f.addListeners(),f.setNavPosition(0),f.placeNavButtons(),m.get(e.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()),Hooks.on(E.RENDER_SCENE_NAV,()=>{const a=u(),i=I.isModuleOn("monks-scene-navigation");d.log(E.RENDER_SCENE_NAV,[i]),i||(f.resetLocalVars(),d.log(E.RENDER_SCENE_NAV,[]),f.placeNavButtons(),f.setNavPosition(),f.addListeners()),m.get(a.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(E.COLLAPSE_SIDE_BAR,a=>{const i=I.isModuleOn("monks-scene-navigation");d.log(E.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",i]),i||f.placeNavButtons()}),Hooks.on(E.COLLAPSE_SCENE_NAV,(a,i)=>{const o=u();m.set(o.sceneNavCollapsed.tag,i),d.log("NAV toggle",[a,i]);const c=document.querySelector("#ui-middle");i?c.classList.add("navigation-collapsed"):c.classList.remove("navigation-collapsed")}),Hooks.on(E.EXPAND_SCENE_NAV,(a,i)=>{d.log("NAV expand",[a,!1])}),window.addEventListener("resize",()=>{I.isModuleOn("monks-scene-navigation")||f.placeNavButtons()}),d.log("TopNavigation - init",[n.sceneNavEnabled])}static resetLocalVars(){T(f,P,document.querySelector("#navigation")),T(f,z,document.querySelector("#scene-list")),T(f,_,document.querySelector("#navigation .nav-item.is-root")),T(f,ee,document.querySelector("#nav-toggle"))}static addListeners(){var e,t;(e=p(f,P))==null||e.addEventListener("mouseenter",()=>{var a;if(d.log("TopNavigation mouseenter",[]),!f.isCollapsed||!((a=f.navSettings)!=null&&a.showNavOnHover))return;clearTimeout(p(this,V));const n=document.querySelector("#scene-list");n&&(n.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,P))==null||t.addEventListener("mouseleave",s=>{var a;if(d.log("TopNavigation mouseleave",[]),!(!f.isCollapsed||!((a=f.navSettings)!=null&&a.showNavOnHover))){if(!s)var s=window.event;s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation(),T(this,V,setTimeout(()=>{clearTimeout(p(this,V)),T(this,V,null);const i=document.querySelector("#scene-list");i&&(i.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var o,c,l,S,y,h,k;f.resetLocalVars();const e=(o=p(this,P))==null?void 0:o.querySelectorAll("button.crlngn-nav"),t=((c=p(this,z))==null?void 0:c.scrollWidth)>=((l=p(this,P))==null?void 0:l.offsetWidth);if(d.log("placeNavButtons",[t,e,(S=p(this,z))==null?void 0:S.scrollWidth,(y=p(this,P))==null?void 0:y.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),n.addEventListener("click",p(this,Le)),n.append(s);const a=document.createElement("button");a.classList.add("crlngn-nav"),a.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),a.append(i),a.addEventListener("click",p(this,ve)),(h=p(this,P))==null||h.appendChild(n),(k=p(this,P))==null||k.appendChild(a)}static setNavPosition(e){var i,o;const t=u();if(!p(this,z))return;const n=e!==void 0?e:f.navPos||0,s=((i=p(this,z))==null?void 0:i.querySelectorAll("li.nav-item"))||[],a=((o=s[n])==null?void 0:o.offsetLeft)*-1;p(this,z).style.marginLeft=a+"px",m.set(t.sceneNavPos.tag,n),d.log("setNavPosition",[e,n,s[n],a])}};P=new WeakMap,z=new WeakMap,V=new WeakMap,_=new WeakMap,ee=new WeakMap,Oe=new WeakMap,Le=new WeakMap,ve=new WeakMap,b(f,P),b(f,z),b(f,V),b(f,_),b(f,ee),b(f,Oe),v(f,"SETTINGS"),v(f,"navSettings"),v(f,"isCollapsed"),v(f,"navPos"),b(f,Le,e=>{var S,y,h,k,U;const t=(S=p(f,ee))==null?void 0:S.offsetWidth,n=I.isModuleOn("compact-scene-navigation")?(y=p(f,_))==null?void 0:y.offsetWidth:0,s=(h=p(f,z))==null?void 0:h.querySelector("li.nav-item:not(.is-root)"),a=((k=p(f,z))==null?void 0:k.querySelectorAll("li.nav-item"))||[],i=s.offsetWidth,o=f.navPos||0,c=Math.floor((((U=p(f,P))==null?void 0:U.offsetWidth)-(o===0?n:0)-t*2)/i);d.log("onNavLast",["currPos",o,c]);let l=o-c;l=l<0?0:l,d.log("onNavLast",["sceneCount",a.length,o,l]),f.setNavPosition(l)}),b(f,ve,e=>{var S,y,h,k,U;u();const t=(S=p(f,ee))==null?void 0:S.offsetWidth,n=I.isModuleOn("compact-scene-navigation")?(y=p(f,_))==null?void 0:y.offsetWidth:0,s=(h=p(f,z))==null?void 0:h.querySelector("li.nav-item:not(.is-root)"),a=((k=p(f,z))==null?void 0:k.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=s.offsetWidth,o=f.navPos||0,c=Math.floor((((U=p(f,P))==null?void 0:U.offsetWidth)-(o===0?n:0)-t*2)/i);d.log("onNavLast",["currPos",o,c]);let l=o+c;l=l>a.length?a.length:l,f.setNavPosition(l)});let J=f;var te;const g=class g{static registerSettings(){const e=u();d.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(O),Object.entries(e).forEach(async i=>{const o=i[1];d.log("Registering... ",[i],!0);const c={name:o.label,hint:o.hint,default:o.default,type:o.propType,scope:o.scope,config:o.config,requiresReload:o.requiresReload||!1,onChange:l=>g.apply(o.tag,l)};o.choices&&(c.choices=o.choices),await game.settings.register(O,o.tag,c),g.get(o.tag)===void 0&&g.set(o.tag,o.default),game.keybindings.register(O,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{g.hideInterface()},restricted:!1})}),g.applyThemeSettings(),Object.entries(yt()).forEach(async i=>{const o=i[1],c={name:o.tag,label:o.label,hint:o.hint,icon:o.icon,type:o.propType,restricted:o.restricted};await game.settings.registerMenu(O,o.tag,c)}),Hooks.on(E.RENDER_SCENE_CONTROLS,g.applyLeftControlsSettings),Hooks.on(E.RENDER_PLAYERS_LIST,g.applyPlayersListSettings),Hooks.on(E.RENDER_HOTBAR,()=>{g.firstLoad&&(g.firstLoad=!1,g.applyHotBarCollapse()),g.applyHotBarSettings()}),g.applyDebugSettings(),g.applySceneNavPos(),g.applyChatStyles(),g.applyBorderColors(),e.customFontsMenu.fields.forEach(i=>{g.applyCustomFonts(e[i].tag)}),e.leftControlsMenu.fields.forEach(i=>{g.applyLeftControlsSettings(e[i].tag)})}static get(e,t=O){if(!e)return null;let n=!1;if(t===O)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,d.log("GET Setting",[a,n])}return n}static set(e,t,n=O){if(!e)return!1;let s=game.settings.storage.get("client")[`${n}.${e}`];s||(s=game.settings.storage.get("world").getSetting(`${n}.${e}`)),d.log("Setting",[e,s]);try{game.settings.set(n,e,t)}catch{d.log("Unable to change setting",[e,s])}return!0}static apply(e,t=void 0){const n=u();switch(t===void 0&&(t=g.get(e)),d.log("SettingsUtil.apply",[e,t,g.get(e)]),e){case n.enableMacroLayout.tag:g.applyHotBarSettings();break;case n.collapseMacroBar.tag:g.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:g.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:g.applyCustomFonts(e,t);break;case n.controlsBottomBuffer.tag:case n.controlsIconSize.tag:case n.controlsAutoHide.tag:case n.hideFoundryLogo.tag:g.applyLeftControlsSettings(e,t);break;case n.cameraDockMenu.tag:g.applyCameraPosX(),g.applyCameraPosY(),g.applyCameraWidth(),g.applyCameraHeight();break;case n.chatBorderColor.tag:oe.chatBorderColor=g.get(n.chatBorderColor.tag),d.log("SettingsUtil.apply",[e]),g.applyBorderColors();break;case n.enableChatStyles.tag:oe.enableChatStyles=g.get(n.enableChatStyles.tag),d.log("SettingsUtil.apply",[e]),g.applyChatStyles();break;case n.enforceDarkMode.tag:g.resetFoundryThemeSettings();break;case n.debugMode.tag:g.applyDebugSettings();break;case n.sceneNavMenu.tag:J.navSettings=g.get(n.sceneNavMenu.tag);break;case n.sceneNavCollapsed.tag:J.isCollapsed=g.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:g.applyThemeSettings();break}}static applyBorderColors(){const e=u(),t=g.get(e.chatBorderColor.tag),n=document.querySelector("body");t===ne.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===ne.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=u(),t=g.get(e.enableChatStyles.tag),n=document.querySelector("body");d.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=u(),t=g.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=u();g.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const n=u(),s=g.get(n.sceneNavMenu.tag),a=document.querySelector("#ui-left"),i=document.querySelector("#ui-left #logo"),o=document.querySelector("body.crlngn-ui");switch(d.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:g.get(n.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break;case n.hideFoundryLogo.tag:const c=window.getComputedStyle(o),l=parseFloat(c.getPropertyValue("--top-nav-height")),S=g.get(n.hideFoundryLogo.tag);d.log("applyLeftControlsSettings",[e,l]),S===void 0||S===!0?(i.classList.remove("visible"),o.style.setProperty("--ui-top-padding",`${l}px`),document.querySelector("body").classList.remove("logo-visible")):(i.classList.add("visible"),s.sceneNavEnabled?(o.style.setProperty("--ui-top-padding",`${72+l}px`),document.querySelector("body").classList.add("logo-visible")):o.style.setProperty("--ui-top-padding","72px"));break;case n.controlsBottomBuffer.tag:g.applyControlsBuffer();break;case n.controlsIconSize.tag:g.applyControlIconSize();break}}static applyControlIconSize(){const e=u(),t=g.get(e.controlsIconSize.tag),n=document.querySelector("body"),s=t==ce.small.name?ce.small.size:ce.regular.size;d.log("applyControlIconSize",[s]),n.style.setProperty("--left-control-item-size",s),g.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=u(),t=g.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;n.style.setProperty("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,n;const e=u();d.log("applyPlayersListSettings",[document.querySelector("#players"),g.get(e.autoHidePlayerList.tag)]),g.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide"),Ne.checkPlayersList()}static applySceneNavPos(){const e=u();g.set(e.sceneNavPos.tag,0),J.navPos=0}static applyCameraPosX(e){const t=u(),n=g.get(t.cameraDockMenu.tag),s=e||n.dockPosX;$.resetPositionAndSize({x:s})}static applyCameraPosY(e){const t=u(),n=g.get(t.cameraDockMenu.tag),s=e||n.dockPosY;$.resetPositionAndSize({y:s})}static applyCameraWidth(e){const t=u(),n=g.get(t.cameraDockMenu.tag),s=e||n.dockWidth;$.resetPositionAndSize({w:s})}static applyCameraHeight(e){const t=u(),n=g.get(t.cameraDockMenu.tag),s=e||n.dockHeight;$.resetPositionAndSize({h:s})}static applyCustomFonts(e,t){const n=u(),s=n.customFontsMenu.fields,a={};d.log("applyCustomFonts",[e,t]),s.forEach(o=>{a[o]=g.get(n[o].tag)});const i=document.querySelector("body.crlngn-ui");switch(e){case n.uiFontBody.tag:i.style.setProperty("--crlngn-font-family",t||a.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:i.style.setProperty("--crlngn-font-titles",t||a.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:i.style.setProperty("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case n.journalFontTitles:i.style.setProperty("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=u(),t=I.isModuleOn("monks-player-settings"),n=I.isModuleOn("force-client-settings"),s=g.get(e.enforceDarkMode.tag);if(s&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),g.set(e.enforceDarkMode.tag,!1));return}if(s&&n){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),g.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","colorScheme");d.log("resetFoundryThemeSettings",[a,s]),a===!1&&s&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=u();d.debugOn=e||g.get(t.debugMode.tag)}};te=new WeakMap,b(g,te,!1),v(g,"firstLoad",!0),v(g,"applyThemeSettings",e=>{const t=u(),n=e||g.get(t.colorTheme.tag)||"",s=document.querySelector("body");H.forEach(a=>{a.className&&s.classList.remove(a.className)}),s.classList.add(n)}),v(g,"hideInterface",()=>{d.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");p(g,te)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),T(g,te,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),T(g,te,!0))});let m=g;class Fe{static init(){Hooks.on(E.RENDER_PLAYERS_LIST,Fe.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var F,ye,Se;const R=class R{static init(){d.log("LeftControls - init",[]),Hooks.on(E.RENDER_SCENE_CONTROLS,R.initSceneControls),R.initSceneControls()}static resetLocalVars(){T(R,F,document.querySelector("#ui-left #controls")),T(R,ye,document.querySelector("#ui-left"))}static initSceneControls(){d.log("initSceneControls",[]),R.resetLocalVars(),R.observeControlsWidth()}static observeControlsWidth(){if(d.log("observeControlsWidth",[]),!p(R,F))return;let e;const t=(n,s)=>{e||(e=setTimeout(()=>{n(),e=null},s))};T(R,Se,new ResizeObserver(n=>{t(()=>R.updateCSSVars(),250)},{box:"border-box"})),p(R,Se).observe(p(R,F)),R.updateCSSVars()}static updateCSSVars(){if(!p(R,F))return;let e=Number(p(R,ye).offsetWidth),t=Number(p(R,F).offsetWidth),n=-e+t+24;if(d.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const s=document.querySelector("body.crlngn-ui");s==null||s.style.setProperty("--ui-controls-margin-left",n+"px")}}};F=new WeakMap,ye=new WeakMap,Se=new WeakMap,b(R,F),b(R,ye),b(R,Se);let Ue=R;var Me;const re=class re{static init(){Hooks.once(E.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(O),d.log("Initiating module...",[],!0),Hooks.on(E.RENDER_CHAT_MESSAGE,p(re,Me)),m.registerSettings()}),Hooks.once(E.READY,()=>{d.log("Core Ready",[]);const e=u();var t=m.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),J.init(),$.init(),Fe.init(),Ue.init(),oe.init(),Ne.init(),m.get(e.enableChatStyles.tag)&&re.addCSSLocalization(),m.resetFoundryThemeSettings()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}};Me=new WeakMap,b(re,Me,(e,t)=>{d.log(E.RENDER_CHAT_MESSAGE,[e,t]),oe.enrichCard(e,t)});let xe=re;xe.init();
//# sourceMappingURL=crlngn-ui.js.map
