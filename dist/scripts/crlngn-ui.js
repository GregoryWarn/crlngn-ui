var Ke=Object.defineProperty;var Ue=C=>{throw TypeError(C)};var Ze=(C,e,t)=>e in C?Ke(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var v=(C,e,t)=>Ze(C,typeof e!="symbol"?e+"":e,t),Ce=(C,e,t)=>e.has(C)||Ue("Cannot "+t);var p=(C,e,t)=>(Ce(C,e,"read from private field"),t?t.call(C):e.get(C)),b=(C,e,t)=>e.has(C)?Ue("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(C):e.set(C,t),M=(C,e,t,o)=>(Ce(C,e,"write to private field"),o?o.call(C,t):e.set(C,t),t),E=(C,e,t)=>(Ce(C,e,"access private method"),t);const T={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},x="crlngn-ui",me=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],he=class he{static log(e="",t=[],o=!1){try{const n=he.debugOn;if(!(o||n))return;console.log(...me,e,...t)}catch{console.log(...me,e,...t)}}static warn(e="",t=[]){console.warn(...me,e,...t)}static logError(e,t){var o;t.ui&&((o=ui.notifications)==null||o.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...me,e)}};v(he,"debugOn",!1);let r=he;const N={select:"select",checkbox:"checkbox",text:"text",number:"number"},L={client:"client",world:"world"},se={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},Q={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}};function f(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:L.world,config:!1,requiresReload:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:N.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:Q.playerColor.name},scope:L.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:se.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:L.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:L.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:L.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:L.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:L.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:L.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:L.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:N.text,default:Q.playerColor.name,scope:L.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:L.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:N.number,default:200,scope:L.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:se.small.name,scope:L.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox,propType:Boolean,default:!1,scope:L.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:N.checkbox,propType:Boolean,default:!0,scope:L.client,config:!1}}}const{ApplicationV2:Je,HandlebarsApplicationMixin:Qe}=foundry.applications.api;var ee,xe,Oe;const $=class $ extends Qe(Je){static get DEFAULT_OPTIONS(){return{id:f().cameraDockMenu.tag,actions:{redefine:E($,ee,Oe)},form:{handler:E($,ee,xe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=f(),o={...m.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return r.log("_prepareContext",[o,e]),o}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};ee=new WeakSet,xe=async function(e,t,o){const n=f();let i=m.get(n.cameraDockMenu.tag),a=i.enableFloatingDock;e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(o.object);await m.set(n.cameraDockMenu.tag,s),i=m.get(n.cameraDockMenu.tag),r.log("Saving settings:",[n.cameraDockMenu.tag,t,o.object,s,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i.enableFloatingDock!=a&&location.reload()},Oe=async function(e,t){const o=f(),i=this.element.querySelectorAll("input, select"),a=o.cameraDockMenu.default;i.forEach(s=>{s.value=a[s.name],s.type==="checkbox"&&(s.checked=a[s.name])}),r.log("#onReset",[e,t,o.cameraDockMenu.default])},b($,ee),v($,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Le=$;const{ApplicationV2:_e,HandlebarsApplicationMixin:et}=foundry.applications.api;var te,Fe,Be;const W=class W extends et(_e){static get DEFAULT_OPTIONS(){return{id:f().chatMessagesMenu.tag,actions:{redefine:E(W,te,Be)},form:{handler:E(W,te,Fe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=f(),o=m.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,i={},a={},s={};n.forEach(c=>{if(r.log("_prepareContext",[t[c].oldName]),t[c]){const h=m.get(t[c].tag);i[c]=t[c],a[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}}),r.log("_prepareContext",[a,s]);const g={...a,default:{...s},isGM:game.user.isGM,fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return r.log("_prepareContext",[g,e]),g}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const o=f(),n=m.get(o.chatMessagesMenu.tag);r.log("_onRender",[e,t,n])}};te=new WeakSet,Fe=async function(e,t,o){const n=f();e.preventDefault(),e.stopPropagation();const i=n.chatMessagesMenu.fields,a=foundry.utils.expandObject(o.object),s=m.get(n.chatBorderColor.tag);r.log("Compared settings:",[a.chatBorderColor,s]),i.forEach(c=>{r.log("Saving setting >>",[n[c].tag,a[c]]),a[c]!==void 0&&m.set(n[c].tag,a[c])}),await m.set(n.chatMessagesMenu.tag,a),a.chatBorderColor!==s&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Be=async function(e,t){const o=f(),i=this.element.querySelectorAll("input, select"),a=o.chatMessagesMenu.fields,s={};a.forEach(g=>{o[g]&&(o[g],s[g]=o[g].default)}),i.forEach(g=>{g.value=s[g.name]})},b(W,te),v(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ve=W;class I{static isModuleOn(e){var o;const t=(o=game.modules)==null?void 0:o.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,o=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+o)}static getAllFonts(){var a;const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},o=Object.entries(t).map(([s])=>s),n=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){let g="";if(s.ownerNode.tagName==="STYLE")g=s.ownerNode.textContent;else if(s.ownerNode.tagName==="LINK")try{if((a=s.href)!=null&&a.startsWith(window.location.origin)){const S=s.cssRules||s.rules;g=Array.from(S).map(y=>y.cssText).join(`
`)}}catch(S){r.warn("Could not read stylesheet rules:",[S])}const c=/@import\s+url\(['"]([^'"]+)['"]\)/g;let h;for(;(h=c.exec(g))!==null;){const S=h[1];if(S.includes("fonts.googleapis.com")){const y=S.match(/family=([^&]+)/);y&&decodeURIComponent(y[1]).split("|").map(A=>A.split(":")[0].replace(/\+/g," ")).forEach(A=>{n.add(A)})}else try{fetch(S).then(y=>y.text()).then(y=>{(y.match(/@font-face\s*{[^}]+}/g)||[]).forEach(A=>{const Ae=A.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(Ae){const Xe=Ae[1].trim();n.add(Xe)}})}).catch(y=>console.warn("Error loading imported CSS:",y))}catch(y){r.warn("Error processing imported CSS:",[y])}}}if(!s.href||s.href.startsWith(window.location.origin))try{const g=s.cssRules||s.rules;for(const c of g)if(c instanceof CSSFontFaceRule){const h=c.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();n.add(h)}}catch(g){r.warn("Could not read stylesheet rules:",[g])}}catch(g){r.warn("Error processing stylesheet:",[g])}return r.log("Found fonts:",[{foundry:Array.from(e),custom:o,cssImported:Array.from(n)}]),Array.from(new Set([...e,...o,...n])).filter(s=>!s.includes("FontAwesome")&&!s.includes("Font Awesome")).map(s=>s.replace(/['"`]/g,"").trim()).sort((s,g)=>s.toLowerCase().localeCompare(g.toLowerCase()))}static addLoggingToClass(e){const t=Object.getOwnPropertyNames(e).filter(n=>typeof e[n]=="function"&&n!=="constructor"&&n!=="prototype"&&n!=="addLoggingToClass");console.log(`TEST: Adding logging to ${e.name} static methods:`,t),t.forEach(n=>{const i=e[n];e[n]=function(...a){return console.log(`TEST: Executing: ${e.name}.${n}`),i.apply(this,a)}});const o=Object.getOwnPropertyNames(e.prototype).filter(n=>typeof e.prototype[n]=="function"&&n!=="constructor");console.log(`TEST: Adding logging to ${e.name} prototype methods:`,o),o.forEach(n=>{const i=e.prototype[n];e.prototype[n]=function(...a){return console.log(`TEST: Executing: ${e.name}.${n}`),i.apply(this,a)}})}}v(I,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:tt,HandlebarsApplicationMixin:ot}=foundry.applications.api;var H,F,He,qe,$e;const D=class D extends ot(tt){static get DEFAULT_OPTIONS(){return{id:f().customFontsMenu.tag,actions:{redefine:E(D,F,$e)},form:{handler:E(D,F,He),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=f(),o=m.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,i={},a={},s={};return n.forEach(c=>{if(t[c]){const h=m.get(t[c].tag);i[c]=t[c],a[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}}),{...a,default:{...s},fontList:I.getAllFonts(),fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(D,H,this.element),p(D,H).querySelectorAll('input[type="text"]').forEach(i=>{const a=i.closest(".dropdown-wrapper"),s=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!s)return;const g=()=>{var c;E(c=D,F,qe).call(c),s.classList.add("active")};i.addEventListener("focus",g),i.addEventListener("click",g),i.addEventListener("keydown",c=>{const h=s.classList.contains("active"),S=Array.from(s.querySelectorAll(".dropdown-option"));let y=S.findIndex(R=>R.classList.contains("highlighted"));c.key==="ArrowDown"||c.key==="ArrowUp"?(c.preventDefault(),h||s.classList.add("active"),S.forEach(R=>R.classList.remove("highlighted")),y===-1?y=c.key==="ArrowDown"?0:S.length-1:y=c.key==="ArrowDown"?(y+1)%S.length:(y-1+S.length)%S.length,S[y]&&(S[y].classList.add("highlighted"),S[y].scrollIntoView({block:"nearest"}))):c.key==="Enter"?(c.preventDefault(),h&&y!==-1&&S[y]&&S[y].click()):c.key==="Escape"&&s.classList.remove("active")}),document.addEventListener("click",c=>{a.contains(c.target)||s.classList.remove("active")})}),p(D,H).querySelectorAll(".dropdown-option").forEach(i=>{i.addEventListener("mouseenter",()=>{i.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(s=>s.classList.remove("highlighted")),i.classList.add("highlighted")}),i.addEventListener("click",a=>{const s=i.closest(".dropdown-wrapper").querySelector("input");let g=i.dataset.value;g.includes(" ")&&!g.startsWith('"')?g=`"${g}"`:g.startsWith("&quot;")&&(g=g.replace(/&quot;/g,'"')),s.value=g,i.closest(".dropdown-options").classList.remove("active")})})}};H=new WeakMap,F=new WeakSet,He=async function(e,t,o){const n=f();e.preventDefault(),e.stopPropagation();const i=n.customFontsMenu.fields,a=foundry.utils.expandObject(o.object);i.forEach(s=>{a[s]!==void 0&&(r.log("Saving setting:",[a[s]]),m.set(n[s].tag,a[s]))}),m.set(n.customFontsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},qe=function(){p(D,H).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},$e=async function(e,t){const o=f(),i=this.element.querySelectorAll("input[type=text]"),a=o.customFontsMenu.fields,s={};a.forEach(g=>{o[g]&&(o[g],s[g]=o[g].default)}),i.forEach(g=>{g.value=s[g.name]})},b(D,F),b(D,H),v(D,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Me=D;const{ApplicationV2:nt,HandlebarsApplicationMixin:st}=foundry.applications.api;var oe,We,je;const j=class j extends st(nt){static get DEFAULT_OPTIONS(){return{id:f().leftControlsMenu.tag,actions:{redefine:E(j,oe,je)},form:{handler:E(j,oe,We),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=f(),o=m.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,i={},a={},s={};n.forEach(c=>{if(t[c]){const h=m.get(t[c].tag);i[c]=t[c],a[c]=h!==void 0?h:o[t[c].oldName]||t[c].default,s[c]=t[c].default}});const g={...a,default:{...s},fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return r.log("_prepareContext",[g,e]),g}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const o=f(),n=m.get(o.leftControlsMenu.tag);r.log("_onRender",[e,t,n])}};oe=new WeakSet,We=async function(e,t,o){const n=f();e.preventDefault(),e.stopPropagation();const i=n.leftControlsMenu.fields,a=foundry.utils.expandObject(o.object);i.forEach(s=>{a[s]!==void 0&&(r.log("Saving setting:",[a[s]]),m.set(n[s].tag,a[s]))}),await m.set(n.leftControlsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},je=async function(e,t){const o=f(),i=this.element.querySelectorAll("input, select"),a=o.leftControlsMenu.default;i.forEach(s=>{s.value=a[s.name],s.type==="checkbox"&&(s.checked=a[s.name])}),r.log("#onReset",[e,t,o.leftControlsMenu.default])},b(j,oe),v(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Te=j;const{ApplicationV2:at,HandlebarsApplicationMixin:it}=foundry.applications.api;var ne,Ve,Ye;const V=class V extends it(at){static get DEFAULT_OPTIONS(){return{id:f().sceneNavMenu.tag,actions:{redefine:E(V,ne,Ye)},form:{handler:E(V,ne,Ve),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=f(),o={...m.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return r.log("_prepareContext",[o,e]),o}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};ne=new WeakSet,Ve=async function(e,t,o){const n=f();let i=m.get(n.sceneNavMenu.tag),a=i.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(o.object);await m.set(n.sceneNavMenu.tag,s),i=m.get(n.sceneNavMenu.tag),r.log("Saving settings...",[n.sceneNavMenu.tag,t,o.object,s,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i.sceneNavEnabled!=a&&location.reload()},Ye=async function(e,t){const o=f(),i=this.element.querySelectorAll("input, select"),a=o.sceneNavMenu.default;i.forEach(s=>{s.value=a[s.name],s.type==="checkbox"&&(s.checked=a[s.name])}),r.log("#onReset",[e,t,o.sceneNavMenu.default])},b(V,ne),v(V,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ee=V;function lt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Me,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:ve,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Te,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Le,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Ee,restricted:!1}}}var ie,le,ce,re,ge,de,ue,G,ke,Re,Ie,Ge;const l=class l{static init(){const e=f(),t=m.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(T.RENDER_CAMERA_VIEWS,l.onRenderFloating),r.log("CameraUtil",[t]),l.onRenderFloating()):(Hooks.on(T.RENDER_CAMERA_VIEWS,l.onRenderPlain),l.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var i,a,s;const e=f(),t=m.get(e.cameraDockMenu.tag);(i=document.querySelector("#camera-views"))==null||i.classList.add("crlngn-ui"),l.cameraContainer=document.querySelector("#camera-views .camera-container");const o=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");r.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),l.cameraContainer&&n&&o&&((a=l.cameraContainer)==null||a.insertBefore(o,n),(s=document.querySelector("#camera-views .camera-container"))==null||s.classList.add("visible")),l.makeDraggable(),l.makeResizeable(),l.resetPositionAndSize(),l.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(r.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const o=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,o)}static makeDraggable(){var e;(e=l.cameraContainer)==null||e.addEventListener("mousedown",t=>{var i,a;const o=document.querySelector("body.crlngn-ui");if(r.log("mousedown",[t.target]),(i=t.target.parentNode)!=null&&i.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",E(l,G,Re)),o==null||o.addEventListener("mouseup",E(l,G,ke));const n=I.getOffsetBottom(l.cameraContainer);l.isDragging=!0,M(l,ie,t.clientX-((a=l.cameraContainer)==null?void 0:a.offsetLeft)),M(l,le,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(l.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),l.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),l.isResizing=!0,M(l,ce,o.clientX),M(l,re,o.clientY),M(l,ue,parseInt(getComputedStyle(l.cameraContainer).bottom)||0),M(l,ge,l.cameraContainer.offsetWidth),M(l,de,l.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",E(l,G,Ie)),e==null||e.addEventListener("mouseup",E(l,G,Ge))})}}static resetPositionAndSize({x:e,y:t,w:o,h:n}={x:null,y:null,w:null,h:null}){const i=f(),a=m.get(i.cameraDockMenu.tag);if(!(!a.enableFloatingDock||!l.cameraContainer))if(!e&&!t&&!o&&!n){const s=a.dockPosX||0,g=a.dockPosY||0,c=a.dockWidth||0,h=a.dockHeight||0;l.cameraContainer.style.left=`${s}px`,l.cameraContainer.style.bottom=`${g}px`,l.cameraContainer.style.width=`${c}px`,l.cameraContainer.style.height=`${h}px`}else e&&(l.cameraContainer.style.left=`${e}px`),t&&(l.cameraContainer.style.bottom=`${t}px`),o&&(l.cameraContainer.style.width=`${o}px`),n&&(l.cameraContainer.style.height=`${n}px`)}};ie=new WeakMap,le=new WeakMap,ce=new WeakMap,re=new WeakMap,ge=new WeakMap,de=new WeakMap,ue=new WeakMap,G=new WeakSet,ke=function(e){var n,i;const t=f(),o={...m.get(t.cameraDockMenu.tag)};if(l.isDragging){const a=document.querySelector("body.crlngn-ui");o.dockPosX=parseInt((n=l.cameraContainer)==null?void 0:n.style.left)||0,o.dockPosY=parseInt((i=l.cameraContainer)==null?void 0:i.style.bottom)||0,o.dockPosY<=0&&(o.dockPosY=0),m.set(t.cameraDockMenu.tag,o),a==null||a.removeEventListener("mousemove",E(l,G,Re)),a==null||a.removeEventListener("mouseup",E(l,G,ke)),l.isDragging=!1,e.stopPropagation()}},Re=function(e){if(l.isDragging&&(r.log("mousemove",[e.target.parentNode]),l.cameraContainer)){let t=e.clientX-p(l,ie),o=window.innerHeight-e.clientY-p(l,le);t+l.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-l.cameraContainer.offsetWidt),l.cameraContainer.style.left=`${t}px`,o+l.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-l.cameraContainer.offsetHeight),l.cameraContainer.style.bottom=`${o}px`}},Ie=function(e){if(!l.isResizing)return;const t=p(l,ge)+(e.clientX-p(l,ce)),o=e.clientY-p(l,re),n=p(l,de)+o,i=p(l,ue)-o;l.cameraContainer.style.width=`${t}px`,l.cameraContainer.style.height=`${n}px`,l.cameraContainer.style.bottom=`${i}px`},Ge=function(){var n,i,a,s,g,c;const e=f(),t={...m.get(e.cameraDockMenu.tag)},o=document.querySelector("body.crlngn-ui");l.isResizing=!1,o==null||o.removeEventListener("mousemove",E(l,G,Ie)),o==null||o.removeEventListener("mouseup",E(l,G,Ge)),r.log("onStopResize",[(n=l.cameraContainer)==null?void 0:n.style.width,(i=l.cameraContainer)==null?void 0:i.style.height,(a=l.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((s=l.cameraContainer)==null?void 0:s.style.width)||0),t.dockHeight=parseInt(((g=l.cameraContainer)==null?void 0:g.style.height)||0),t.dockPosY=parseInt(((c=l.cameraContainer)==null?void 0:c.style.bottom)||0),m.set(e.cameraDockMenu.tag,t)},b(l,G),b(l,ie,0),b(l,le,0),v(l,"isDragging",!1),v(l,"cameraContainer"),v(l,"isResizing",!1),b(l,ce,0),b(l,re,0),b(l,ge,0),b(l,de,0),b(l,ue,0);let B=l;const U=class U{static init(){const e=f();U.enableChatStyles=m.get(e.enableChatStyles.tag),U.chatBorderColor=m.get(e.chatBorderColor.tag)}static enrichCard(e,t){var o,n,i,a,s,g,c,h;if(U.enableChatStyles){const S=((i=(n=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:n.activity)==null?void 0:i.type)||((g=(s=(a=e.flags)==null?void 0:a.dnd5e)==null?void 0:s.roll)==null?void 0:g.type)||"custom";let y=t.get?t.get(0):t;y.classList.add(S),r.log("enrichCard",[U.chatBorderColor,Q.playerColor.name,(c=e.author)==null?void 0:c.id]),U.chatBorderColor===Q.playerColor.name&&((h=e.author)!=null&&h.id)&&y.style.setProperty("border-color",`var(--user-color-${e.author.id})`)}}};v(U,"chatBorderColor"),v(U,"enableChatStyles");let _=U;var X;const P=class P{static init(){Hooks.on(T.RENDER_PLAYERS_LIST,P.checkPlayersList),Hooks.on(T.RENDER_HOTBAR,P.checkPlayersList),I.isModuleOn("foundry-taskbar")&&Hooks.on(T.UPDATE_USER,P.checkTaskbarLock),P.checkTaskbarLock(),Hooks.on("renderApplication",(t,o,n)=>{o.closest("body").length&&console.log("An application was rendered that affected the body")})}};X=new WeakMap,b(P,X),v(P,"checkTaskbarLock",()=>{var a,s,g;const e=I.isModuleOn("foundry-taskbar"),t=document.querySelector("body.crlngn-ui"),o=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(r.log("checkTaskbarLock",[o]),!e||!o)return;const n=game.settings.get("foundry-taskbar","reduceSidebar");(s=o.taskbarSettings)!=null&&s.locked?t.style.setProperty("--crlngn-sidebar-bottom",n?"50px":"0px"):t.style.setProperty("--crlngn-sidebar-bottom","0px"),(g=o.taskbarSettings)!=null&&g.locked?t.style.setProperty("--crlngn-taskbar-height","50px"):t.style.setProperty("--crlngn-taskbar-height","10px");const i=document.querySelector("#ft-move-players-macro");i&&(i.innerHTML=""),P.checkPlayersList()}),v(P,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),o=I.isModuleOn("foundry-taskbar"),n=o?game.settings.get("foundry-taskbar","dockPlayersList"):!1,i=o?game.settings.get("foundry-taskbar","dockMacroBar"):!1;r.log("checkPlayersList",[n,o,i,game.settings]);let a=10;n&&(a=250);const s=document.querySelector("#hotbar");s&&s.style.setProperty("visibility","hidden"),clearTimeout(p(P,X)),M(P,X,setTimeout(()=>{n?(r.log("checkPlayersList TEST",[n]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),s&&s.style.removeProperty("visibility"),clearTimeout(p(P,X))},a))});let ye=P;var w,z,q,K,Z,ze,Se,be;const u=class u{static init(){const e=f();u.navSettings=m.get(e.sceneNavMenu.tag),u.isCollapsed=m.get(e.sceneNavCollapsed.tag),u.navPos=m.get(e.sceneNavPos.tag);const t=document.querySelector("#ui-middle");let o=u.navSettings;if(o.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}u.resetLocalVars();const n=I.isModuleOn("monks-scene-navigation");n&&o.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),m.set(e.sceneNavMenu.tag,{...o,sceneNavEnabled:!1})),r.log("TopNavigation - init",[n]),n?t.classList.add("with-monks-scene"):(u.resetLocalVars(),u.addListeners(),u.setNavPosition(0),u.placeNavButtons(),m.get(e.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()),Hooks.on(T.RENDER_SCENE_NAV,()=>{const i=f(),a=I.isModuleOn("monks-scene-navigation");r.log(T.RENDER_SCENE_NAV,[a]),a||(u.resetLocalVars(),r.log(T.RENDER_SCENE_NAV,[]),u.placeNavButtons(),u.setNavPosition(),u.addListeners()),m.get(i.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(T.COLLAPSE_SIDE_BAR,i=>{const a=I.isModuleOn("monks-scene-navigation");r.log(T.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",a]),a||u.placeNavButtons()}),Hooks.on(T.COLLAPSE_SCENE_NAV,(i,a)=>{const s=f();m.set(s.sceneNavCollapsed.tag,a),r.log("NAV toggle",[i,a]);const g=document.querySelector("#ui-middle");a?g.classList.add("navigation-collapsed"):g.classList.remove("navigation-collapsed")}),Hooks.on(T.EXPAND_SCENE_NAV,(i,a)=>{r.log("NAV expand",[i,!1])}),window.addEventListener("resize",()=>{I.isModuleOn("monks-scene-navigation")||u.placeNavButtons()}),r.log("TopNavigation - init",[o.sceneNavEnabled])}static resetLocalVars(){M(u,w,document.querySelector("#navigation")),M(u,z,document.querySelector("#scene-list")),M(u,K,document.querySelector("#navigation .nav-item.is-root")),M(u,Z,document.querySelector("#nav-toggle"))}static addListeners(){var e,t;(e=p(u,w))==null||e.addEventListener("mouseenter",()=>{var i;if(r.log("TopNavigation mouseenter",[]),!u.isCollapsed||!((i=u.navSettings)!=null&&i.showNavOnHover))return;clearTimeout(p(this,q));const o=document.querySelector("#scene-list");o&&(o.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=p(this,w))==null||t.addEventListener("mouseleave",n=>{var i;if(r.log("TopNavigation mouseleave",[]),!(!u.isCollapsed||!((i=u.navSettings)!=null&&i.showNavOnHover))){if(!n)var n=window.event;n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),M(this,q,setTimeout(()=>{clearTimeout(p(this,q)),M(this,q,null);const a=document.querySelector("#scene-list");a&&(a.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var s,g,c,h,S,y,R;u.resetLocalVars();const e=(s=p(this,w))==null?void 0:s.querySelectorAll("button.crlngn-nav"),t=((g=p(this,z))==null?void 0:g.scrollWidth)>=((c=p(this,w))==null?void 0:c.offsetWidth);if(r.log("placeNavButtons",[t,e,(h=p(this,z))==null?void 0:h.scrollWidth,(S=p(this,w))==null?void 0:S.offsetWidth]),!t||e.length>0)return;const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-chevron-left"),o.addEventListener("click",p(this,Se)),o.append(n);const i=document.createElement("button");i.classList.add("crlngn-nav"),i.classList.add("ui-nav-right");const a=document.createElement("i");a.classList.add("fa"),a.classList.add("fa-chevron-right"),i.append(a),i.addEventListener("click",p(this,be)),(y=p(this,w))==null||y.appendChild(o),(R=p(this,w))==null||R.appendChild(i)}static setNavPosition(e){var a,s;const t=f();if(!p(this,z))return;const o=e!==void 0?e:u.navPos||0,n=((a=p(this,z))==null?void 0:a.querySelectorAll("li.nav-item"))||[],i=((s=n[o])==null?void 0:s.offsetLeft)*-1;p(this,z).style.marginLeft=i+"px",m.set(t.sceneNavPos.tag,o),r.log("setNavPosition",[e,o,n[o],i])}};w=new WeakMap,z=new WeakMap,q=new WeakMap,K=new WeakMap,Z=new WeakMap,ze=new WeakMap,Se=new WeakMap,be=new WeakMap,b(u,w),b(u,z),b(u,q),b(u,K),b(u,Z),b(u,ze),v(u,"SETTINGS"),v(u,"navSettings"),v(u,"isCollapsed"),v(u,"navPos"),b(u,Se,e=>{var h,S,y,R,A;const t=(h=p(u,Z))==null?void 0:h.offsetWidth,o=I.isModuleOn("compact-scene-navigation")?(S=p(u,K))==null?void 0:S.offsetWidth:0,n=(y=p(u,z))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),i=((R=p(u,z))==null?void 0:R.querySelectorAll("li.nav-item"))||[],a=n.offsetWidth,s=u.navPos||0,g=Math.floor((((A=p(u,w))==null?void 0:A.offsetWidth)-(s===0?o:0)-t*2)/a);r.log("onNavLast",["currPos",s,g]);let c=s-g;c=c<0?0:c,r.log("onNavLast",["sceneCount",i.length,s,c]),u.setNavPosition(c)}),b(u,be,e=>{var h,S,y,R,A;f();const t=(h=p(u,Z))==null?void 0:h.offsetWidth,o=I.isModuleOn("compact-scene-navigation")?(S=p(u,K))==null?void 0:S.offsetWidth:0,n=(y=p(u,z))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),i=((R=p(u,z))==null?void 0:R.querySelectorAll("li.nav-item:not(.is-root)"))||[],a=n.offsetWidth,s=u.navPos||0,g=Math.floor((((A=p(u,w))==null?void 0:A.offsetWidth)-(s===0?o:0)-t*2)/a);r.log("onNavLast",["currPos",s,g]);let c=s+g;c=c>i.length?i.length:c,u.setNavPosition(c)});let Y=u;var J;const d=class d{static registerSettings(){const e=f();r.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(x),Object.entries(e).forEach(async a=>{const s=a[1];r.log("Registering... ",[a],!0);const g={name:s.label,hint:s.hint,default:s.default,type:s.propType,scope:s.scope,config:s.config,requiresReload:s.requiresReload||!1,onChange:c=>d.apply(s.tag,c)};s.choices&&(g.choices=s.choices),await game.settings.register(x,s.tag,g),d.get(s.tag)===void 0&&d.set(s.tag,s.default),game.keybindings.register(x,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{d.hideInterface()},restricted:!1})}),Object.entries(lt()).forEach(async a=>{const s=a[1],g={name:s.tag,label:s.label,hint:s.hint,icon:s.icon,type:s.propType,restricted:s.restricted};await game.settings.registerMenu(x,s.tag,g)}),Hooks.on(T.RENDER_SCENE_CONTROLS,d.applyLeftControlsSettings),Hooks.on(T.RENDER_PLAYERS_LIST,d.applyPlayersListSettings),Hooks.on(T.RENDER_HOTBAR,()=>{d.firstLoad&&(d.firstLoad=!1,d.applyHotBarCollapse()),d.applyHotBarSettings()}),d.applyDebugSettings(),d.applySceneNavPos(),d.applyChatStyles(),d.applyBorderColors(),e.customFontsMenu.fields.forEach(a=>{d.applyCustomFonts(e[a].tag)}),e.leftControlsMenu.fields.forEach(a=>{d.applyLeftControlsSettings(e[a].tag)})}static get(e,t=x){if(!e)return null;let o=!1;if(t===x)o=game.settings.get(t,e);else{let i=game.settings.storage.get("client")[`${t}.${e}`];i===void 0&&(i=game.settings.storage.get("world").getSetting(`${t}.${e}`)),o=i==null?void 0:i.value,r.log("GET Setting",[i,o])}return o}static set(e,t,o=x){if(!e)return!1;let n=game.settings.storage.get("client")[`${o}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${o}.${e}`)),r.log("Setting",[e,n]);try{game.settings.set(o,e,t)}catch{r.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const o=f();switch(t===void 0&&(t=d.get(e)),r.log("SettingsUtil.apply",[e,t,d.get(e)]),e){case o.enableMacroLayout.tag:d.applyHotBarSettings();break;case o.collapseMacroBar.tag:d.applyHotBarCollapse();break;case o.autoHidePlayerList.tag:d.applyPlayersListSettings();break;case o.uiFontBody.tag:case o.uiFontTitles.tag:case o.journalFontBody.tag:case o.journalFontTitles.tag:d.applyCustomFonts(e,t);break;case o.controlsBottomBuffer.tag:case o.controlsIconSize.tag:case o.controlsAutoHide.tag:case o.hideFoundryLogo.tag:d.applyLeftControlsSettings(e,t);break;case o.cameraDockMenu.tag:d.applyCameraPosX(),d.applyCameraPosY(),d.applyCameraWidth(),d.applyCameraHeight();break;case o.chatBorderColor.tag:_.chatBorderColor=d.get(o.chatBorderColor.tag),r.log("SettingsUtil.apply",[e]),d.applyBorderColors();break;case o.enableChatStyles.tag:_.enableChatStyles=d.get(o.enableChatStyles.tag),r.log("SettingsUtil.apply",[e]),d.applyChatStyles();break;case o.enforceDarkMode.tag:d.resetFoundryThemeSettings();break;case o.debugMode.tag:d.applyDebugSettings();break;case o.sceneNavMenu.tag:Y.navSettings=d.get(o.sceneNavMenu.tag);break;case o.sceneNavCollapsed.tag:Y.isCollapsed=d.get(o.sceneNavCollapsed.tag);break}}static applyBorderColors(){const e=f(),t=d.get(e.chatBorderColor.tag),o=document.querySelector("body");t===Q.playerColor.name?(o.classList.add("player-chat-borders"),o.classList.remove("roll-chat-borders")):t===Q.rollType.name?(o.classList.add("roll-chat-borders"),o.classList.remove("player-chat-borders")):(o.classList.remove("player-chat-borders"),o.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=f(),t=d.get(e.enableChatStyles.tag),o=document.querySelector("body");r.log("applyChatStyles",[t,e]),t?o.classList.add("crlngn-chat"):o.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=f(),t=d.get(e.enableMacroLayout.tag),o=document.querySelector("#hotbar");!t&&o?o.classList.add("foundry-default"):o&&o.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=f();d.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const o=f(),n=d.get(o.sceneNavMenu.tag),i=document.querySelector("#ui-left"),a=document.querySelector("#ui-left #logo"),s=document.querySelector("body.crlngn-ui");switch(r.log("applyLeftControlsSettings",[e]),e){case o.controlsAutoHide.tag:d.get(o.controlsAutoHide.tag)?i.classList.add("auto-hide"):i.classList.remove("auto-hide");break;case o.hideFoundryLogo.tag:const g=window.getComputedStyle(s),c=parseFloat(g.getPropertyValue("--top-nav-height")),h=d.get(o.hideFoundryLogo.tag);r.log("applyLeftControlsSettings",[e,c]),h===void 0||h===!0?(a.classList.remove("visible"),s.style.setProperty("--ui-top-padding",`${c}px`),document.querySelector("body").classList.remove("logo-visible")):(a.classList.add("visible"),n.sceneNavEnabled?(s.style.setProperty("--ui-top-padding",`${72+c}px`),document.querySelector("body").classList.add("logo-visible")):s.style.setProperty("--ui-top-padding","72px"));break;case o.controlsBottomBuffer.tag:d.applyControlsBuffer();break;case o.controlsIconSize.tag:d.applyControlIconSize();break}}static applyControlIconSize(){const e=f(),t=d.get(e.controlsIconSize.tag),o=document.querySelector("body"),n=t==se.small.name?se.small.size:se.regular.size;r.log("applyControlIconSize",[n]),o.style.setProperty("--left-control-item-size",n),d.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=f(),t=d.get(e.leftControlsMenu.tag),o=document.querySelector("body.crlngn-ui"),n=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;o.style.setProperty("--controls-bottom-buffer",`${n||0}px`)}static applyPlayersListSettings(){var t,o;const e=f();r.log("applyPlayersListSettings",[document.querySelector("#players"),d.get(e.autoHidePlayerList.tag)]),d.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(o=document.querySelector("#players"))==null||o.classList.remove("auto-hide"),ye.checkPlayersList()}static applySceneNavPos(){const e=f();d.set(e.sceneNavPos.tag,0),Y.navPos=0}static applyCameraPosX(e){const t=f(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockPosX;B.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=f(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockPosY;B.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=f(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockWidth;B.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=f(),o=d.get(t.cameraDockMenu.tag),n=e||o.dockHeight;B.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const o=f(),n=o.customFontsMenu.fields,i={};r.log("applyCustomFonts",[e,t]),n.forEach(s=>{i[s]=d.get(o[s].tag)});const a=document.querySelector("body.crlngn-ui");switch(e){case o.uiFontBody.tag:a.style.setProperty("--crlngn-font-family",t||i.uiFontBody||o.uiFontBody.default.uiFont||"");break;case o.uiFontTitles.tag:a.style.setProperty("--crlngn-font-titles",t||i.uiFontTitles||o.uiFontTitles.default.uiTitles||"");break;case o.journalFontBody.tag:a.style.setProperty("--crlngn-font-journal-body",t||i.journalFontBody||i.journalFontBody||"");break;case o.journalFontTitles:a.style.setProperty("--crlngn-font-journal-title",t||i.journalFontTitles||i.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=f(),t=I.isModuleOn("monks-player-settings"),o=I.isModuleOn("force-client-settings"),n=d.get(e.enforceDarkMode.tag);if(n&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),d.set(e.enforceDarkMode.tag,!1));return}if(n&&o){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),d.set(e.enforceDarkMode.tag,!1));return}const i=game.settings.get("core","colorScheme");r.log("resetFoundryThemeSettings",[i,n]),i===!1&&n&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=f();r.debugOn=e||d.get(t.debugMode.tag)}};J=new WeakMap,b(d,J,!1),v(d,"firstLoad",!0),v(d,"hideInterface",()=>{r.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),o=document.querySelector(".taskbar");p(d,J)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&o.style.removeProperty("visibility"),M(d,J,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),o&&o.style.setProperty("visibility","hidden"),M(d,J,!0))});let m=d;class De{static init(){Hooks.on(T.RENDER_PLAYERS_LIST,De.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),o=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",o+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var O,fe,pe;const k=class k{static init(){r.log("LeftControls - init",[]),Hooks.on(T.RENDER_SCENE_CONTROLS,k.initSceneControls),k.initSceneControls()}static resetLocalVars(){M(k,O,document.querySelector("#ui-left #controls")),M(k,fe,document.querySelector("#ui-left"))}static initSceneControls(){r.log("initSceneControls",[]),k.resetLocalVars(),k.observeControlsWidth()}static observeControlsWidth(){if(r.log("observeControlsWidth",[]),!p(k,O))return;let e;const t=(o,n)=>{e||(e=setTimeout(()=>{o(),e=null},n))};M(k,pe,new ResizeObserver(o=>{t(()=>k.updateCSSVars(),250)},{box:"border-box"})),p(k,pe).observe(p(k,O)),k.updateCSSVars()}static updateCSSVars(){if(!p(k,O))return;let e=Number(p(k,fe).offsetWidth),t=Number(p(k,O).offsetWidth),o=-e+t+24;if(r.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const n=document.querySelector("body.crlngn-ui");n==null||n.style.setProperty("--ui-controls-margin-left",o+"px")}}};O=new WeakMap,fe=new WeakMap,pe=new WeakMap,b(k,O),b(k,fe),b(k,pe);let Pe=k;var Ne;const ae=class ae{static init(){Hooks.once(T.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(x),r.log("Initiating module...",[],!0),Hooks.on(T.RENDER_CHAT_MESSAGE,p(ae,Ne)),m.registerSettings()}),Hooks.once(T.READY,()=>{r.log("Core Ready",[]);const e=f();var t=m.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Y.init(),B.init(),De.init(),Pe.init(),_.init(),ye.init(),m.get(e.enableChatStyles.tag)&&ae.addCSSLocalization(),m.resetFoundryThemeSettings()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}};Ne=new WeakMap,b(ae,Ne,(e,t)=>{r.log(T.RENDER_CHAT_MESSAGE,[e,t]),_.enrichCard(e,t)});let we=ae;we.init();
//# sourceMappingURL=crlngn-ui.js.map
