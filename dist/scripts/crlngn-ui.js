var at=Object.defineProperty;var je=E=>{throw TypeError(E)};var it=(E,e,t)=>e in E?at(E,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[e]=t;var v=(E,e,t)=>it(E,typeof e!="symbol"?e+"":e,t),Ge=(E,e,t)=>e.has(E)||je("Cannot "+t);var f=(E,e,t)=>(Ge(E,e,"read from private field"),t?t.call(E):e.get(E)),C=(E,e,t)=>e.has(E)?je("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(E):e.set(E,t),M=(E,e,t,s)=>(Ge(E,e,"write to private field"),s?s.call(E,t):e.set(E,t),t),R=(E,e,t)=>(Ge(E,e,"access private method"),t);const k={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},F="crlngn-ui",Te=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],Ee=class Ee{static log(e="",t=[],s=!1){try{const o=Ee.debugOn;if(!(s||o))return;console.log(...Te,e,...t)}catch{console.log(...Te,e,...t)}}static warn(e="",t=[]){console.warn(...Te,e,...t)}static logError(e,t){var s;t.ui&&((s=ui.notifications)==null||s.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Te,e)}};v(Ee,"debugOn",!1);let r=Ee;const L={select:"select",checkbox:"checkbox",text:"text",number:"number"},T={client:"client",world:"world"},de={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},oe={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},B=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function m(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:L.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:T.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:T.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:L.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:oe.playerColor.name},scope:T.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:L.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:de.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:T.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:L.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:L.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:L.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:L.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:L.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:L.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:T.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:L.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:L.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:L.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:T.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:L.number,default:0,scope:T.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:L.checkbox,default:!1,scope:T.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:L.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:L.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:L.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:L.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:L.text,propType:String,default:"",scope:T.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:L.checkbox,propType:Boolean,default:!1,scope:T.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:L.text,propType:String,default:"",scope:T.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:L.text,default:oe.playerColor.name,scope:T.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:L.checkbox,default:!0,scope:T.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:L.number,default:200,scope:T.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:L.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:de.small.name,scope:T.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:L.checkbox,propType:Boolean,default:!1,scope:T.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:L.checkbox,propType:Boolean,default:!0,scope:T.client,config:!1}}}const{ApplicationV2:lt,HandlebarsApplicationMixin:ct}=foundry.applications.api;var ie,$e,We;const X=class X extends ct(lt){static get DEFAULT_OPTIONS(){return{id:m().cameraDockMenu.tag,actions:{redefine:R(X,ie,We)},form:{handler:R(X,ie,$e),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=m(),s={...h.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return r.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};ie=new WeakSet,$e=async function(e,t,s){const o=m();let i=h.get(o.cameraDockMenu.tag),n=i.enableFloatingDock;e.preventDefault(),e.stopPropagation();const a=foundry.utils.expandObject(s.object);await h.set(o.cameraDockMenu.tag,a),i=h.get(o.cameraDockMenu.tag),r.log("Saving settings:",[o.cameraDockMenu.tag,t,s.object,a,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i.enableFloatingDock!=n&&location.reload()},We=async function(e,t){const s=m(),i=this.element.querySelectorAll("input, select"),n=s.cameraDockMenu.default;i.forEach(a=>{a.value=n[a.name],a.type==="checkbox"&&(a.checked=n[a.name])}),r.log("#onReset",[e,t,s.cameraDockMenu.default])},C(X,ie),v(X,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let we=X;const{ApplicationV2:rt,HandlebarsApplicationMixin:dt}=foundry.applications.api;var le,Ye,Xe;const K=class K extends dt(rt){static get DEFAULT_OPTIONS(){return{id:m().chatMessagesMenu.tag,actions:{redefine:R(K,le,Xe)},form:{handler:R(K,le,Ye),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=m(),s=h.get(t.chatMessagesMenu.tag),o=t.chatMessagesMenu.fields,i={},n={},a={};o.forEach(l=>{if(r.log("_prepareContext",[t[l].oldName]),t[l]){const p=h.get(t[l].tag);i[l]=t[l],n[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,a[l]=t[l].default}}),r.log("_prepareContext",[n,a]);const c={...n,default:{...a},isGM:game.user.isGM,fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return r.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=m(),o=h.get(s.chatMessagesMenu.tag);r.log("_onRender",[e,t,o])}};le=new WeakSet,Ye=async function(e,t,s){const o=m();e.preventDefault(),e.stopPropagation();const i=o.chatMessagesMenu.fields,n=foundry.utils.expandObject(s.object),a=h.get(o.chatBorderColor.tag);r.log("Compared settings:",[n.chatBorderColor,a]),i.forEach(l=>{r.log("Saving setting >>",[o[l].tag,n[l]]),n[l]!==void 0&&h.set(o[l].tag,n[l])}),await h.set(o.chatMessagesMenu.tag,n),n.chatBorderColor!==a&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Xe=async function(e,t){const s=m(),i=this.element.querySelectorAll("input, select"),n=s.chatMessagesMenu.fields,a={};n.forEach(c=>{s[c]&&(s[c],a[c]=s[c].default)}),i.forEach(c=>{c.value=a[c.name]})},C(K,le),v(K,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ze=K;class b{static isModuleOn(e){var s;const t=(s=game.modules)==null?void 0:s.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+s)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=h.get("fonts","core")||{},s=Object.entries(t).map(([n])=>n),o=new Set;return await this.processStyleSheets(o),r.log("Found fonts:",[{foundry:Array.from(e),custom:s,cssImported:Array.from(o)}]),Array.from(new Set([...e,...s,...o])).filter(n=>!/FontAwesome|Font Awesome|FoundryVTT/.test(n)).map(n=>n.replace(/['"`]/g,"").trim()).sort((n,a)=>n.toLowerCase().localeCompare(a.toLowerCase()))||[]}static wrapFontName(e){const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t}static addCSSVars(e,t){let s=document.querySelector("#crlngn-ui-vars");if(!s){const y=document.querySelector("body");s=document.createElement("style"),s.id="crlngn-ui-vars",s.textContent=`body.crlngn-ui {
}
`,y.prepend(s)}let o=s.textContent,i=o.indexOf("body.crlngn-ui {"),n=o.indexOf("}",i);i===-1&&(o=`body.crlngn-ui {
}
`,i=0,n=o.indexOf("}"));const c=o.substring(i+16,n).split(";").map(y=>y.trim()).filter(y=>y!==""),l={};c.forEach(y=>{const N=y.split(":");if(N.length>=2){const I=N[0].trim(),O=N.slice(1).join(":").trim();I&&(l[I]=O)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),l[e]=t;const p=Object.entries(l).map(([y,N])=>`  ${y}: ${N};`).join(`
`),S=o.substring(0,i)+`body.crlngn-ui {
`+p+`
}`+o.substring(n+1);s.textContent=S}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const s=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,s.appendChild(t)}t.textContent=e}}v(b,"processStyleSheets",async e=>{for(const t of document.styleSheets)try{if(t.ownerNode){const s=t.href||"",o=s.includes("/css/")||s.includes("/styles/"),i=s.includes("/modules/crlngn-ui/");if(s&&!o&&!i){r.log("Skipping non-core/module stylesheet:",[s]);continue}let n="";if(t.ownerNode instanceof Element){if(t.ownerNode.tagName==="STYLE")n=t.ownerNode.textContent;else if(t.ownerNode.tagName==="LINK")try{const l=t.cssRules||t.rules;n=Array.from(l).map(p=>p.cssText).join(`
`)}catch(l){r.warn("Could not read stylesheet rules:",[l])}}r.log("Processing stylesheet:",[s||"inline style"]);const a=/@import\s+url\(['"]([^'"]+)['"]\)/g;let c;for(;(c=a.exec(n))!==null;){let l=c[1];if(l.includes("fonts.googleapis.com")){const p=l.match(/family=([^&]+)/);p&&decodeURIComponent(p[1]).split("|").map(y=>y.split(":")[0].replace(/\+/g," ")).forEach(y=>{e.add(y)})}else{if(l.startsWith("./")||l.startsWith("../")){r.log("Skipping relative import:",[l]);continue}let p=l;try{const S=await fetch(p);if(!S.ok){r.warn("Error loading imported CSS:",[S.status]);continue}const N=(await S.text()).match(/@font-face\s*{[^}]+}/g);if(!N)continue;N.forEach(I=>{const O=I.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(O&&O[1]){const ve=O[1].trim();e.add(ve)}})}catch(S){r.warn("Error processing imported CSS:",[S])}}}}if(!t.href||t.href.startsWith(window.location.origin))try{const s=t.cssRules||t.rules;for(const o of s)if(o instanceof CSSFontFaceRule){const i=o.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();e.add(i)}}catch(s){r.warn("Could not read stylesheet rules:",[s])}}catch(s){r.warn("Error processing stylesheet:",[s])}return[]});const{ApplicationV2:ut,HandlebarsApplicationMixin:gt}=foundry.applications.api;var $,H,Ke,Ze,Je;const D=class D extends gt(ut){static get DEFAULT_OPTIONS(){return{id:m().customFontsMenu.tag,actions:{redefine:R(D,H,Je)},form:{handler:R(D,H,Ke),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=m(),s=h.get(t.customFontsMenu.tag),o=t.customFontsMenu.fields,i={},n={},a={};return o.forEach(l=>{if(t[l]){const p=h.get(t[l].tag);i[l]=t[l],n[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,a[l]=t[l].default}}),{...n,default:{...a},fontList:await b.getAllFonts(),fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(D,$,this.element),f(D,$).querySelectorAll('input[type="text"]').forEach(i=>{const n=i.closest(".dropdown-wrapper"),a=n==null?void 0:n.querySelector(".dropdown-options");if(!n||!a)return;const c=()=>{var l;R(l=D,H,Ze).call(l),a.classList.add("active")};i.addEventListener("focus",c),i.addEventListener("click",c),i.addEventListener("keydown",l=>{const p=a.classList.contains("active"),S=Array.from(a.querySelectorAll(".dropdown-option"));let y=S.findIndex(N=>N.classList.contains("highlighted"));l.key==="ArrowDown"||l.key==="ArrowUp"?(l.preventDefault(),p||a.classList.add("active"),S.forEach(N=>N.classList.remove("highlighted")),y===-1?y=l.key==="ArrowDown"?0:S.length-1:y=l.key==="ArrowDown"?(y+1)%S.length:(y-1+S.length)%S.length,S[y]&&(S[y].classList.add("highlighted"),S[y].scrollIntoView({block:"nearest"}))):l.key==="Enter"?(l.preventDefault(),p&&y!==-1&&S[y]&&S[y].click()):l.key==="Escape"&&a.classList.remove("active")}),document.addEventListener("click",l=>{n.contains(l.target)||a.classList.remove("active")})}),f(D,$).querySelectorAll(".dropdown-option").forEach(i=>{i.addEventListener("mouseenter",()=>{i.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(a=>a.classList.remove("highlighted")),i.classList.add("highlighted")}),i.addEventListener("click",n=>{const a=i.closest(".dropdown-wrapper").querySelector("input");let c=i.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),a.value=c,i.closest(".dropdown-options").classList.remove("active")})})}};$=new WeakMap,H=new WeakSet,Ke=async function(e,t,s){const o=m();e.preventDefault(),e.stopPropagation();const i=o.customFontsMenu.fields,n=foundry.utils.expandObject(s.object);i.forEach(a=>{n[a]!==void 0&&(r.log("Saving setting:",[n[a]]),h.set(o[a].tag,n[a]))}),h.set(o.customFontsMenu.tag,n),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ze=function(){f(D,$).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Je=async function(e,t){const s=m(),i=this.element.querySelectorAll("input[type=text]"),n=s.customFontsMenu.fields,a={};n.forEach(c=>{s[c]&&(s[c],a[c]=s[c].default)}),i.forEach(c=>{c.value=a[c.name]})},C(D,H),C(D,$),v(D,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ae=D;const{ApplicationV2:ft,HandlebarsApplicationMixin:mt}=foundry.applications.api;var ce,Qe,_e;const Z=class Z extends mt(ft){static get DEFAULT_OPTIONS(){return{id:m().leftControlsMenu.tag,actions:{redefine:R(Z,ce,_e)},form:{handler:R(Z,ce,Qe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=m(),s=h.get(t.leftControlsMenu.tag),o=t.leftControlsMenu.fields,i={},n={},a={};o.forEach(l=>{if(t[l]){const p=h.get(t[l].tag);i[l]=t[l],n[l]=p!==void 0?p:s[t[l].oldName]||t[l].default,a[l]=t[l].default}});const c={...n,default:{...a},fields:{...i},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return r.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=m(),o=h.get(s.leftControlsMenu.tag);r.log("_onRender",[e,t,o])}};ce=new WeakSet,Qe=async function(e,t,s){const o=m();e.preventDefault(),e.stopPropagation();const i=o.leftControlsMenu.fields,n=foundry.utils.expandObject(s.object);i.forEach(a=>{n[a]!==void 0&&(r.log("Saving setting:",[n[a]]),h.set(o[a].tag,n[a]))}),await h.set(o.leftControlsMenu.tag,n),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},_e=async function(e,t){const s=m(),i=this.element.querySelectorAll("input, select"),n=s.leftControlsMenu.default;i.forEach(a=>{a.value=n[a.name],a.type==="checkbox"&&(a.checked=n[a.name])}),r.log("#onReset",[e,t,s.leftControlsMenu.default])},C(Z,ce),v(Z,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Pe=Z;const{ApplicationV2:pt,HandlebarsApplicationMixin:ht}=foundry.applications.api;var re,et,tt;const J=class J extends ht(pt){static get DEFAULT_OPTIONS(){return{id:m().sceneNavMenu.tag,actions:{redefine:R(J,re,tt)},form:{handler:R(J,re,et),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=m(),s={...h.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return r.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,r.log("_preparePartContext",[e,t]),t}_onRender(e,t){r.log("_onRender",[e,t])}};re=new WeakSet,et=async function(e,t,s){const o=m();let i=h.get(o.sceneNavMenu.tag),n=i.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const a=foundry.utils.expandObject(s.object);await h.set(o.sceneNavMenu.tag,a),i=h.get(o.sceneNavMenu.tag),r.log("Saving settings...",[o.sceneNavMenu.tag,t,s.object,a,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i.sceneNavEnabled!=n&&location.reload()},tt=async function(e,t){const s=m(),i=this.element.querySelectorAll("input, select"),n=s.sceneNavMenu.default;i.forEach(a=>{a.value=n[a.name],a.type==="checkbox"&&(a.checked=n[a.name])}),r.log("#onReset",[e,t,s.sceneNavMenu.default])},C(J,re),v(J,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let De=J;const{ApplicationV2:yt,HandlebarsApplicationMixin:St}=foundry.applications.api;var W,V,st,nt,ot;const U=class U extends St(yt){static get DEFAULT_OPTIONS(){return{id:m().themeAndStylesMenu.tag,actions:{redefine:R(U,V,ot)},form:{handler:R(U,V,st),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=m();h.get(t.themeAndStylesMenu.tag);const s=t.themeAndStylesMenu.fields,o={},i={},n={};s.forEach(l=>{if(t[l]){const p=h.get(t[l].tag);o[l]=t[l],i[l]=p!==void 0?p:t[l].default,n[l]=t[l].default}});const a=B.find(l=>l.className===i.colorTheme);i.colorTheme=(a==null?void 0:a.label)||B[0].label;const c={...i,default:{...n},fields:{...o},selectedTheme:a,themes:B,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...i},c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){M(U,W,this.element),this._themes=B,f(U,W).querySelectorAll('input[type="text"]').forEach(n=>{const a=n.closest(".dropdown-wrapper"),c=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!c)return;const l=()=>{var p;R(p=U,V,nt).call(p),c.classList.add("active")};n.addEventListener("focus",l),n.addEventListener("click",l),n.addEventListener("keydown",p=>{const S=c.classList.contains("active"),y=Array.from(c.querySelectorAll(".dropdown-option"));let N=y.findIndex(I=>I.classList.contains("highlighted"));p.key==="ArrowDown"||p.key==="ArrowUp"?(p.preventDefault(),S||c.classList.add("active"),y.forEach(I=>I.classList.remove("highlighted")),N===-1?N=p.key==="ArrowDown"?0:y.length-1:N=p.key==="ArrowDown"?(N+1)%y.length:(N-1+y.length)%y.length,y[N]&&(y[N].classList.add("highlighted"),y[N].scrollIntoView({block:"nearest"}))):p.key==="Enter"?(p.preventDefault(),S&&N!==-1&&y[N]&&y[N].click()):p.key==="Escape"&&c.classList.remove("active")}),document.addEventListener("click",p=>{a.contains(p.target)||c.classList.remove("active")})});const o=f(U,W).querySelectorAll(".dropdown-option"),i=this;o.forEach(n=>{n.addEventListener("mouseenter",()=>{n.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(c=>c.classList.remove("highlighted")),n.classList.add("highlighted")}),n.addEventListener("click",function(a){r.log("option",[n,n.querySelector(".theme-name")]);const c=n.closest(".dropdown-wrapper").querySelector("input");let l=n.querySelector(".theme-name").innerHTML.toString();if(c.value=l,c.name==="colorTheme"){const S=i._themes.find(y=>y.label===l);i._selectedTheme=S,i._updateThemePreview(S)}n.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(r.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((s,o)=>{s.style.setProperty("background-color",e.colorPreview[o])})}};W=new WeakMap,V=new WeakSet,st=async function(e,t,s){const o=m();e.preventDefault(),e.stopPropagation();const i=o.themeAndStylesMenu.fields,n=foundry.utils.expandObject(s.object),a=B.find(c=>c.label===n.colorTheme);n.colorTheme=a?a.className:"",i.forEach(c=>{n[c]!==void 0&&(r.log("Saving setting:",[n[c]]),h.set(o[c].tag,n[c]))}),h.set(o.themeAndStylesMenu.tag,n),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},nt=function(){f(U,W).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ot=async function(e,t){const s=m(),i=this.element.querySelectorAll("input[type=text]"),n=s.themeAndStylesMenu.fields,a={};n.forEach(l=>{s[l]&&(s[l],a[l]=s[l].default)});const c=B.find(l=>l.label===s.colorTheme.default);a.colorTheme=(c==null?void 0:c.label)||B[0].label,i.forEach(l=>{l.value=a[l.name]})},C(U,V),C(U,W),v(U,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ue=U;function bt(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Ae,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:Ue,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:ze,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Pe,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:we,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:De,restricted:!1}}}var ge,fe,me,pe,he,ye,Se,z,xe,Oe,Fe,Be;const d=class d{static init(){const e=m(),t=h.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(k.RENDER_CAMERA_VIEWS,d.onRenderFloating),r.log("CameraUtil",[t]),d.onRenderFloating()):(Hooks.on(k.RENDER_CAMERA_VIEWS,d.onRenderPlain),d.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var i,n,a;const e=m(),t=h.get(e.cameraDockMenu.tag);(i=document.querySelector("#camera-views"))==null||i.classList.add("crlngn-ui"),d.cameraContainer=document.querySelector("#camera-views .camera-container");const s=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");r.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),d.cameraContainer&&o&&s&&((n=d.cameraContainer)==null||n.insertBefore(s,o),(a=document.querySelector("#camera-views .camera-container"))==null||a.classList.add("visible")),d.makeDraggable(),d.makeResizeable(),d.resetPositionAndSize(),d.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(r.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const s=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,s)}static makeDraggable(){var e;(e=d.cameraContainer)==null||e.addEventListener("mousedown",t=>{var i,n;const s=document.querySelector("body.crlngn-ui");if(r.log("mousedown",[t.target]),(i=t.target.parentNode)!=null&&i.classList.contains("volume-bar"))return;s==null||s.addEventListener("mousemove",R(d,z,Oe)),s==null||s.addEventListener("mouseup",R(d,z,xe));const o=b.getOffsetBottom(d.cameraContainer);d.isDragging=!0,M(d,ge,t.clientX-((n=d.cameraContainer)==null?void 0:n.offsetLeft)),M(d,fe,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(d.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),d.cameraContainer.append(t),t.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),d.isResizing=!0,M(d,me,s.clientX),M(d,pe,s.clientY),M(d,Se,parseInt(getComputedStyle(d.cameraContainer).bottom)||0),M(d,he,d.cameraContainer.offsetWidth),M(d,ye,d.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",R(d,z,Fe)),e==null||e.addEventListener("mouseup",R(d,z,Be))})}}static resetPositionAndSize({x:e,y:t,w:s,h:o}={x:null,y:null,w:null,h:null}){const i=m(),n=h.get(i.cameraDockMenu.tag);if(!(!n.enableFloatingDock||!d.cameraContainer))if(!e&&!t&&!s&&!o){const a=n.dockPosX||0,c=n.dockPosY||0,l=n.dockWidth||0,p=n.dockHeight||0;d.cameraContainer.style.left=`${a}px`,d.cameraContainer.style.bottom=`${c}px`,d.cameraContainer.style.width=`${l}px`,d.cameraContainer.style.height=`${p}px`}else e&&(d.cameraContainer.style.left=`${e}px`),t&&(d.cameraContainer.style.bottom=`${t}px`),s&&(d.cameraContainer.style.width=`${s}px`),o&&(d.cameraContainer.style.height=`${o}px`)}};ge=new WeakMap,fe=new WeakMap,me=new WeakMap,pe=new WeakMap,he=new WeakMap,ye=new WeakMap,Se=new WeakMap,z=new WeakSet,xe=function(e){var o,i;const t=m(),s={...h.get(t.cameraDockMenu.tag)};if(d.isDragging){const n=document.querySelector("body.crlngn-ui");s.dockPosX=parseInt((o=d.cameraContainer)==null?void 0:o.style.left)||0,s.dockPosY=parseInt((i=d.cameraContainer)==null?void 0:i.style.bottom)||0,s.dockPosY<=0&&(s.dockPosY=0),h.set(t.cameraDockMenu.tag,s),n==null||n.removeEventListener("mousemove",R(d,z,Oe)),n==null||n.removeEventListener("mouseup",R(d,z,xe)),d.isDragging=!1,e.stopPropagation()}},Oe=function(e){if(d.isDragging&&(r.log("mousemove",[e.target.parentNode]),d.cameraContainer)){let t=e.clientX-f(d,ge),s=window.innerHeight-e.clientY-f(d,fe);t+d.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-d.cameraContainer.offsetWidt),d.cameraContainer.style.left=`${t}px`,s+d.cameraContainer.offsetHeight>window.innerHeight&&(s=window.innerHeight-d.cameraContainer.offsetHeight),d.cameraContainer.style.bottom=`${s}px`}},Fe=function(e){if(!d.isResizing)return;const t=f(d,he)+(e.clientX-f(d,me)),s=e.clientY-f(d,pe),o=f(d,ye)+s,i=f(d,Se)-s;d.cameraContainer.style.width=`${t}px`,d.cameraContainer.style.height=`${o}px`,d.cameraContainer.style.bottom=`${i}px`},Be=function(){var o,i,n,a,c,l;const e=m(),t={...h.get(e.cameraDockMenu.tag)},s=document.querySelector("body.crlngn-ui");d.isResizing=!1,s==null||s.removeEventListener("mousemove",R(d,z,Fe)),s==null||s.removeEventListener("mouseup",R(d,z,Be)),r.log("onStopResize",[(o=d.cameraContainer)==null?void 0:o.style.width,(i=d.cameraContainer)==null?void 0:i.style.height,(n=d.cameraContainer)==null?void 0:n.style.bottom]),t.dockWidth=parseInt(((a=d.cameraContainer)==null?void 0:a.style.width)||0),t.dockHeight=parseInt(((c=d.cameraContainer)==null?void 0:c.style.height)||0),t.dockPosY=parseInt(((l=d.cameraContainer)==null?void 0:l.style.bottom)||0),h.set(e.cameraDockMenu.tag,t)},C(d,z),C(d,ge,0),C(d,fe,0),v(d,"isDragging",!1),v(d,"cameraContainer"),v(d,"isResizing",!1),C(d,me,0),C(d,pe,0),C(d,he,0),C(d,ye,0),C(d,Se,0);let j=d;const x=class x{static init(){const e=m();x.enableChatStyles=h.get(e.enableChatStyles.tag),x.chatBorderColor=h.get(e.chatBorderColor.tag)}};v(x,"chatBorderColor"),v(x,"enableChatStyles"),v(x,"enrichCard",async(e,t)=>{var n,a,c,l,p,S,y,N;r.log("renderChatMessage",[x.chatBorderColor,x.enableChatStyles,oe.playerColor.name,(n=e.author)==null?void 0:n.id]);const s=((l=(c=(a=e.flags)==null?void 0:a.dnd5e)==null?void 0:c.activity)==null?void 0:l.type)||((y=(S=(p=e.flags)==null?void 0:p.dnd5e)==null?void 0:S.roll)==null?void 0:y.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;o.classList.add(s),o.classList.add("crlngn");const i=o.querySelectorAll(".card-buttons button[data-action=rollSave]");i.length>0&&i.forEach(I=>{const O=I.querySelector(".visible-dc"),ve=I.querySelector(".hidden-dc");r.log("enrichCard",[O,ve]),O.setAttribute("data-ability",I.getAttribute("data-ability")||""),O.setAttribute("data-dc",I.getAttribute("data-dc")||""),ve.setAttribute("data-ability",I.getAttribute("data-ability")||"")}),x.chatBorderColor===oe.playerColor.name&&((N=e.author)!=null&&N.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let ae=x;var _;const A=class A{static init(){Hooks.on(k.RENDER_PLAYERS_LIST,A.checkPlayersList),Hooks.on(k.RENDER_HOTBAR,A.checkPlayersList),b.isModuleOn("foundry-taskbar")&&Hooks.on(k.UPDATE_USER,A.checkTaskbarLock),A.checkTaskbarLock()}};_=new WeakMap,C(A,_),v(A,"checkTaskbarLock",()=>{var i,n,a;const e=b.isModuleOn("foundry-taskbar"),t=(i=game.user.flags)==null?void 0:i["foundry-taskbar"];if(r.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(n=t.taskbarSettings)!=null&&n.locked?b.addCSSVars("--crlngn-sidebar-bottom",s?"50px":"0px"):b.addCSSVars("--crlngn-sidebar-bottom","0px"),(a=t.taskbarSettings)!=null&&a.locked?b.addCSSVars("--crlngn-taskbar-height","50px"):b.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),A.checkPlayersList()}),v(A,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),s=b.isModuleOn("foundry-taskbar"),o=s?game.settings.get("foundry-taskbar","dockPlayersList"):!1,i=s?game.settings.get("foundry-taskbar","dockMacroBar"):!1;r.log("checkPlayersList",[o,s,i,game.settings]);let n=10;o&&(n=250);const a=document.querySelector("#hotbar");a&&a instanceof HTMLElement&&a.style.setProperty("visibility","hidden"),clearTimeout(f(A,_)),M(A,_,setTimeout(()=>{o?(r.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),a&&a instanceof HTMLElement&&a.style.removeProperty("visibility"),clearTimeout(f(A,_))},n))});let Me=A;var P,w,Y,ee,te,se,be,Ne,Re,ke;const g=class g{static init(){const e=m();g.navSettings=h.get(e.sceneNavMenu.tag),g.isCollapsed=h.get(e.sceneNavCollapsed.tag),g.navPos=h.get(e.sceneNavPos.tag),g.resetLocalVars();const t=document.querySelector("#ui-middle");let s=g.navSettings;if(s.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}const o=b.isModuleOn("monks-scene-navigation");o&&s.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),h.set(e.sceneNavMenu.tag,{...s,sceneNavEnabled:!1})),r.log("TopNavigation - init",[o]),o?t.classList.add("with-monks-scene"):(g.resetLocalVars(),g.addListeners(),g.setNavPosition(),g.placeNavButtons(),g.toggleNav(h.get(e.sceneNavCollapsed.tag))),Hooks.on(k.RENDER_SCENE_NAV,(i,n)=>{const a=m(),c=b.isModuleOn("monks-scene-navigation");r.log(k.RENDER_SCENE_NAV,[c]),c||(r.log("NAV no transition add"),g.navPos=h.get(a.sceneNavPos.tag),g.resetLocalVars(),f(this,w)&&f(this,w).classList.add("no-transition"),r.log(k.RENDER_SCENE_NAV,[]),g.placeNavButtons(),g.addListeners(),g.setNavPosition(),g.toggleNav(h.get(a.sceneNavCollapsed.tag)),clearTimeout(f(g,be)),M(g,be,setTimeout(()=>{f(this,w)&&f(this,w).classList.remove("no-transition"),r.log("NAV no transition remove")},500))),r.log("SCENE NAV STATE",[h.get(a.sceneNavCollapsed.tag)])}),Hooks.on(k.COLLAPSE_SIDE_BAR,i=>{const n=b.isModuleOn("monks-scene-navigation");r.log(k.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",n]),n||g.placeNavButtons()}),Hooks.on(k.COLLAPSE_SCENE_NAV,(i,n)=>{const a=m();h.set(a.sceneNavCollapsed.tag,n),r.log("NAV toggle",[i,n]),g.isCollapsed=n,g.toggleNav(n)}),Hooks.on(k.EXPAND_SCENE_NAV,(i,n)=>{r.log("NAV expand",[i,!1])}),window.addEventListener("resize",()=>{b.isModuleOn("monks-scene-navigation")||g.placeNavButtons()}),r.log("TopNavigation - init",[s.sceneNavEnabled])}static toggleNav(e){clearTimeout(f(g,Ne)),M(g,Ne,setTimeout(()=>{g.resetLocalVars(),e?(ui.nav.collapse(),f(g,se).classList.add("navigation-collapsed")):(ui.nav.expand(),f(g,se).classList.remove("navigation-collapsed"))},500))}static resetLocalVars(){M(g,P,document.querySelector("#navigation")),M(g,w,document.querySelector("#scene-list")),M(g,ee,document.querySelector("#navigation .nav-item.is-root")),M(g,te,document.querySelector("#nav-toggle")),M(g,se,document.querySelector("#ui-middle"))}static addListeners(){var e,t;(e=f(g,P))==null||e.addEventListener("mouseenter",s=>{var n;if(r.log("TopNavigation mouseenter",[]),!g.isCollapsed||!((n=g.navSettings)!=null&&n.showNavOnHover))return;s.stopPropagation(),clearTimeout(f(g,Y));const o=document.querySelector("#scene-list");o&&(o.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=f(this,P))==null||t.addEventListener("mouseleave",s=>{var o;r.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!((o=g.navSettings)!=null&&o.showNavOnHover))&&(s.stopPropagation(),M(this,Y,setTimeout(()=>{clearTimeout(f(this,Y)),M(this,Y,null);const i=document.querySelector("#scene-list");i&&(i.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){var a,c,l,p,S,y,N;g.resetLocalVars();const e=(a=f(this,P))==null?void 0:a.querySelectorAll("button.crlngn-nav"),t=((c=f(this,w))==null?void 0:c.scrollWidth)>=((l=f(this,P))==null?void 0:l.offsetWidth);if(r.log("placeNavButtons",[t,e,(p=f(this,w))==null?void 0:p.scrollWidth,(S=f(this,P))==null?void 0:S.offsetWidth]),!t||e.length>0)return;const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),s.addEventListener("click",f(this,Re)),s.append(o);const i=document.createElement("button");i.classList.add("crlngn-nav"),i.classList.add("ui-nav-right");const n=document.createElement("i");n.classList.add("fa"),n.classList.add("fa-chevron-right"),i.append(n),i.addEventListener("click",f(this,ke)),(y=f(this,P))==null||y.appendChild(s),(N=f(this,P))==null||N.appendChild(i)}static setNavPosition(e){var n,a;const t=m();if(!f(this,w))return;const s=e!==void 0?e:g.navPos||0,o=((n=f(this,w))==null?void 0:n.querySelectorAll("li.nav-item"))||[],i=((a=o[s])==null?void 0:a.offsetLeft)*-1;f(this,w).style.marginLeft=i+"px",h.set(t.sceneNavPos.tag,s),r.log("setNavPosition",[e,s,o[s],i])}};P=new WeakMap,w=new WeakMap,Y=new WeakMap,ee=new WeakMap,te=new WeakMap,se=new WeakMap,be=new WeakMap,Ne=new WeakMap,Re=new WeakMap,ke=new WeakMap,C(g,P),C(g,w),C(g,Y),C(g,ee),C(g,te),C(g,se),v(g,"SETTINGS"),v(g,"navSettings"),v(g,"isCollapsed"),v(g,"navPos"),C(g,be),C(g,Ne),C(g,Re,e=>{var p,S,y,N,I;const t=(p=f(g,te))==null?void 0:p.offsetWidth,s=b.isModuleOn("compact-scene-navigation")?(S=f(g,ee))==null?void 0:S.offsetWidth:0,o=(y=f(g,w))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),i=((N=f(g,w))==null?void 0:N.querySelectorAll("li.nav-item"))||[],n=o.offsetWidth,a=g.navPos||0,c=Math.floor((((I=f(g,P))==null?void 0:I.offsetWidth)-(a===0?s:0)-t*2)/n);r.log("onNavLast",["currPos",a,c]);let l=a-c;l=l<0?0:l,r.log("onNavLast",["sceneCount",i.length,a,l]),g.setNavPosition(l)}),C(g,ke,e=>{var p,S,y,N,I;const t=(p=f(g,te))==null?void 0:p.offsetWidth,s=b.isModuleOn("compact-scene-navigation")?(S=f(g,ee))==null?void 0:S.offsetWidth:0,o=(y=f(g,w))==null?void 0:y.querySelector("li.nav-item:not(.is-root)"),i=((N=f(g,w))==null?void 0:N.querySelectorAll("li.nav-item:not(.is-root)"))||[],n=o.offsetWidth,a=g.navPos||0,c=Math.floor((((I=f(g,P))==null?void 0:I.offsetWidth)-(a===0?s:0)-t*2)/n);r.log("onNavLast",["currPos",a,c]);let l=a+c;l=l>i.length?i.length:l,g.setNavPosition(l)});let Q=g;var ne;const u=class u{static registerSettings(){const e=m();r.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(F),Object.entries(e).forEach(async n=>{const a=n[1];r.log("Registering... ",[n],!0);const c={name:a.label,hint:a.hint,default:a.default,type:a.propType,scope:a.scope,config:a.config,requiresReload:a.requiresReload||!1,onChange:l=>u.apply(a.tag,l)};a.choices&&(c.choices=a.choices),await game.settings.register(F,a.tag,c),u.get(a.tag)===void 0&&u.set(a.tag,a.default),game.keybindings.register(F,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{u.hideInterface()},restricted:!1})}),u.applyThemeSettings(),u.applyCustomCSS(),u.applyModuleAdjustments(),Object.entries(bt()).forEach(async n=>{const a=n[1],c={name:a.tag,label:a.label,hint:a.hint,icon:a.icon,type:a.propType,restricted:a.restricted};await game.settings.registerMenu(F,a.tag,c)}),Hooks.on(k.RENDER_SCENE_CONTROLS,u.applyLeftControlsSettings),Hooks.on(k.RENDER_PLAYERS_LIST,u.applyPlayersListSettings),Hooks.on(k.RENDER_HOTBAR,()=>{u.firstLoad&&(u.firstLoad=!1,u.applyHotBarCollapse()),u.applyHotBarSettings()}),u.applyDebugSettings(),u.applySceneNavPos(),u.applyChatStyles(),u.applyBorderColors(),e.customFontsMenu.fields.forEach(n=>{u.applyCustomFonts(e[n].tag)}),e.leftControlsMenu.fields.forEach(n=>{u.applyLeftControlsSettings(e[n].tag)})}static get(e,t=F){if(!e)return null;let s=!1;if(t===F)s=game.settings.get(t,e);else{let i=game.settings.storage.get("client")[`${t}.${e}`];i===void 0&&(i=game.settings.storage.get("world").getSetting(`${t}.${e}`)),s=i==null?void 0:i.value,r.log("GET Setting",[i,s])}return s}static set(e,t,s=F){if(!e)return!1;let o=game.settings.storage.get("client")[`${s}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${s}.${e}`)),r.log("Setting",[e,o]);try{game.settings.set(s,e,t)}catch{r.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){const s=m();switch(t===void 0&&(t=u.get(e)),r.log("SettingsUtil.apply",[e,t,u.get(e)]),e){case s.enableMacroLayout.tag:u.applyHotBarSettings();break;case s.collapseMacroBar.tag:u.applyHotBarCollapse();break;case s.autoHidePlayerList.tag:u.applyPlayersListSettings();break;case s.uiFontBody.tag:case s.uiFontTitles.tag:case s.journalFontBody.tag:case s.journalFontTitles.tag:u.applyCustomFonts(e,t);break;case s.controlsBottomBuffer.tag:case s.controlsIconSize.tag:case s.controlsAutoHide.tag:case s.hideFoundryLogo.tag:u.applyLeftControlsSettings(e,t);break;case s.cameraDockMenu.tag:u.applyCameraPosX(),u.applyCameraPosY(),u.applyCameraWidth(),u.applyCameraHeight();break;case s.chatBorderColor.tag:ae.chatBorderColor=u.get(s.chatBorderColor.tag),r.log("SettingsUtil.apply",[e]),u.applyBorderColors();break;case s.enableChatStyles.tag:ae.enableChatStyles=u.get(s.enableChatStyles.tag),r.log("SettingsUtil.apply",[e]),u.applyChatStyles();break;case s.enforceDarkMode.tag:u.resetFoundryThemeSettings();break;case s.debugMode.tag:u.applyDebugSettings();break;case s.sceneNavMenu.tag:Q.navSettings=u.get(s.sceneNavMenu.tag);break;case s.sceneNavCollapsed.tag:Q.isCollapsed=u.get(s.sceneNavCollapsed.tag);break;case s.sceneNavPos.tag:u.applySceneNavPos();break;case s.colorTheme.tag:u.applyThemeSettings();break;case s.customStyles.tag:u.applyCustomCSS();break;case s.adjustOtherModules.tag:u.applyModuleAdjustments();break}}static applyBorderColors(){const e=m(),t=u.get(e.chatBorderColor.tag),s=document.querySelector("body");t===oe.playerColor.name?(s.classList.add("player-chat-borders"),s.classList.remove("roll-chat-borders")):t===oe.rollType.name?(s.classList.add("roll-chat-borders"),s.classList.remove("player-chat-borders")):(s.classList.remove("player-chat-borders"),s.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=m(),t=u.get(e.enableChatStyles.tag),s=document.querySelector("body");r.log("applyChatStyles",[t,e]),t?s.classList.add("crlngn-chat"):s.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=m(),t=u.get(e.enableMacroLayout.tag),s=document.querySelector("#hotbar");!t&&s?s.classList.add("foundry-default"):s&&s.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=m();u.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const s=m(),o=u.get(s.sceneNavMenu.tag),i=document.querySelector("#ui-left"),n=document.querySelector("#ui-left #logo"),a=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),r.log("applyLeftControlsSettings",[e]),e){case s.controlsAutoHide.tag:u.get(s.controlsAutoHide.tag)?i.classList.add("auto-hide"):i.classList.remove("auto-hide");break;case s.hideFoundryLogo.tag:const l=window.getComputedStyle(a).getPropertyValue("--top-nav-height")||"0px",p=parseFloat(l)||0,S=u.get(s.hideFoundryLogo.tag);r.log("applyLeftControlsSettings",[e,p,l]),S===void 0||S===!0?(n.classList.remove("visible"),b.addCSSVars("--ui-top-padding",`${p}px`),document.querySelector("body").classList.remove("logo-visible")):(n.classList.add("visible"),o.sceneNavEnabled?(b.addCSSVars("--ui-top-padding",`${72+p}px`),document.querySelector("body").classList.add("logo-visible")):b.addCSSVars("--ui-top-padding","72px"));break;case s.controlsBottomBuffer.tag:u.applyControlsBuffer();break;case s.controlsIconSize.tag:u.applyControlIconSize();break}}static applyControlIconSize(){const e=m(),t=u.get(e.controlsIconSize.tag);document.querySelector("body");const s=t==de.small.name?de.small.size:de.regular.size;r.log("applyControlIconSize",[s]),b.addCSSVars("--left-control-item-size",s),u.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=m(),t=u.get(e.leftControlsMenu.tag),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;b.addCSSVars("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,s;const e=m();r.log("applyPlayersListSettings",[document.querySelector("#players"),u.get(e.autoHidePlayerList.tag)]),u.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(s=document.querySelector("#players"))==null||s.classList.remove("auto-hide"),Me.checkPlayersList()}static applySceneNavPos(e){const t=m();u.set(t.sceneNavPos.tag,e||u.get(t.sceneNavPos.tag)),Q.navPos=e||u.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=m(),s=u.get(t.cameraDockMenu.tag),o=e||s.dockPosX;j.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=m(),s=u.get(t.cameraDockMenu.tag),o=e||s.dockPosY;j.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=m(),s=u.get(t.cameraDockMenu.tag),o=e||s.dockWidth;j.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=m(),s=u.get(t.cameraDockMenu.tag),o=e||s.dockHeight;j.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const s=m(),o=s.customFontsMenu.fields,i={};switch(r.log("applyCustomFonts",[e,t]),o.forEach(n=>{i[n]=u.get(s[n].tag)}),document.querySelector("body.crlngn-ui"),e){case s.uiFontBody.tag:b.addCSSVars("--crlngn-font-family",t||i.uiFontBody||s.uiFontBody.default.uiFont||"");break;case s.uiFontTitles.tag:b.addCSSVars("--crlngn-font-titles",t||i.uiFontTitles||s.uiFontTitles.default.uiTitles||"");break;case s.journalFontBody.tag:b.addCSSVars("--crlngn-font-journal-body",t||i.journalFontBody||i.journalFontBody||"");break;case s.journalFontTitles.tag:b.addCSSVars("--crlngn-font-journal-title",t||i.journalFontTitles||i.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=m(),t=b.isModuleOn("monks-player-settings"),s=b.isModuleOn("force-client-settings"),o=u.get(e.enforceDarkMode.tag);if(o&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),u.set(e.enforceDarkMode.tag,!1));return}if(o&&s){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),u.set(e.enforceDarkMode.tag,!1));return}const i=game.settings.get("core","colorScheme");r.log("resetFoundryThemeSettings",[i,o]),i===!1&&o&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=m();r.debugOn=e||u.get(t.debugMode.tag)}};ne=new WeakMap,C(u,ne,!1),v(u,"firstLoad",!0),v(u,"applyThemeSettings",e=>{const t=m(),s=e||u.get(t.colorTheme.tag)||"",o=document.querySelector("body");r.log("applyThemeSettings",[e,s,u.get(t.colorTheme.tag)]),B.forEach(i=>{i.className&&o.classList.remove(i.className)}),s&&o.classList.add(s)}),v(u,"applyCustomCSS",e=>{const t=m(),s=e||u.get(t.customStyles.tag)||"";b.addCustomCSS(s)}),v(u,"applyModuleAdjustments",e=>{const t=m(),s=e||u.get(t.adjustOtherModules.tag)||!1,o=document.querySelector("body");s?o.classList.add("crlngn-enforce-styles"):o.classList.remove("crlngn-enforce-styles")}),v(u,"hideInterface",()=>{r.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),s=document.querySelector(".taskbar");f(u,ne)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&s.style.removeProperty("visibility"),M(u,ne,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),s&&s.style.setProperty("visibility","hidden"),M(u,ne,!0))});let h=u;class Ve{static init(){Hooks.on(k.RENDER_PLAYERS_LIST,Ve.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const s=e.offsetHeight;b.addCSSVars("--players-list-height",s+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var q,Ce,Le;const G=class G{static init(){r.log("LeftControls - init",[]),Hooks.on(k.RENDER_SCENE_CONTROLS,G.initSceneControls),G.initSceneControls()}static resetLocalVars(){M(G,q,document.querySelector("#ui-left #controls")),M(G,Ce,document.querySelector("#ui-left"))}static initSceneControls(){r.log("initSceneControls",[]),G.resetLocalVars(),G.observeControlsWidth()}static observeControlsWidth(){if(r.log("observeControlsWidth",[]),!f(G,q))return;let e;const t=(s,o)=>{e||(e=setTimeout(()=>{s(),e=null},o))};M(G,Le,new ResizeObserver(s=>{t(()=>G.updateCSSVars(),250)})),f(G,Le).observe(f(G,q),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!f(G,q))return;let e=Number(f(G,Ce).offsetWidth),t=Number(f(G,q).offsetWidth),s=-e+t+24;r.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&b.addCSSVars("--ui-controls-margin-left",s+"px")}};q=new WeakMap,Ce=new WeakMap,Le=new WeakMap,C(G,q),C(G,Ce),C(G,Le);let qe=G;var Ie;const ue=class ue{static init(){Hooks.once(k.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(F),r.log("Initiating module...",[],!0),Hooks.on(k.RENDER_CHAT_MESSAGE,f(ue,Ie)),h.registerSettings(),Q.init(),j.init(),Ve.init(),qe.init(),ae.init()}),Hooks.once(k.READY,()=>{r.log("Core Ready",[]);const e=m();var t=h.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Me.init(),h.get(e.enableChatStyles.tag)&&ue.addCSSLocalization(),h.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";b.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),b.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),b.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),b.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),b.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),b.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),b.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),b.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),b.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),b.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Ie=new WeakMap,C(ue,Ie,(e,t)=>{r.log(k.RENDER_CHAT_MESSAGE,[e,t]),ae.enrichCard(e,t)});let He=ue;He.init();
//# sourceMappingURL=crlngn-ui.js.map
