var rs=Object.defineProperty;var mo=i=>{throw TypeError(i)};var ls=(i,e,n)=>e in i?rs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n;var S=(i,e,n)=>ls(i,typeof e!="symbol"?e+"":e,n),vn=(i,e,n)=>e.has(i)||mo("Cannot "+n);var T=(i,e,n)=>(vn(i,e,"read from private field"),n?n.call(i):e.get(i)),I=(i,e,n)=>e.has(i)?mo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,n),F=(i,e,n,t)=>(vn(i,e,"write to private field"),t?t.call(i,n):e.set(i,n),n),A=(i,e,n)=>(vn(i,e,"access private method"),n);const U={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_SIDE_BAR:"renderSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",COMBAT_START:"combatStart",COMBAT_ROUND_START:"combatRound",RENDER_ACTOR_SHEET:"renderActorSheet",RENDER_COMPENDIUM_BROWSER:"renderCompendiumBrowser"},B="crlngn-ui",Zt=["%cCarolingian UI","color:rgb(123, 77, 179); font-weight: bold;","|"],fn=class fn{static log(e="",n=[],t=!1){try{const o=fn.debugOn;if(!(t||o))return;console.log(...Zt,e,...n)}catch{console.log(...Zt,e,...n)}}static warn(e="",n=[]){console.warn(...Zt,e,...n)}static error(e,n){var t;n.ui&&((t=ui.notifications)==null||t.error(e,{localize:!0,permanent:n.permanent})),n.console&&console.error(...Zt,e)}};S(fn,"debugOn",!1);let f=fn;const R={select:"select",checkbox:"checkbox",text:"text",number:"number"},N={client:"client",world:"world"},Oe={small:{name:"small",size:"38px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},rn={small:{name:"small"},regular:{name:"regular"},large:{name:"large"}},ot={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},Xe={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},ho=140,De=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(49, 140, 231)"]}],So={useHorizontalSheetTabs:!0,applyThemeToSheets:!0,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:145,dockWasResized:!1,dockResizeOnUserJoin:Xe.horizontal.name,controlsIconSize:Oe.regular.name,controlsAutoHide:!1,hideFoundryLogo:!0,controlsBottomBuffer:200,enableChatStyles:!0,useLeftChatBorder:!1,chatBorderColor:ot.playerColor.name,autoHidePlayerList:!1,collapseMacroBar:!1,enableFloatingDock:!0,enableMacroLayout:!0,sceneNavCollapsed:!1,showNavOnHover:!1,sceneNavEnabled:!0,sceneItemWidth:150,navStartCollapsed:!1,uiScale:rn.regular.name};function v(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:R.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:N.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","otherModulesList","customStyles","useHorizontalSheetTabs","applyThemeToSheets"],default:{colorTheme:"",adjustOtherModules:!0,otherModulesList:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock','touch-vtt'",customStyles:"",useHorizontalSheetTabs:!0,applyThemeToSheets:!0},scope:N.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:R.button,fields:["enableChatStyles","chatBorderColor","useLeftChatBorder"],default:{enableChatStyles:!0,chatBorderColor:ot.playerColor.name,useLeftChatBorder:!1},scope:N.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:R.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:Oe.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:N.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:R.button,fields:["enableFloatingDock","dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{enableFloatingDock:!0,dockResizeOnUserJoin:Xe.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:N.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:R.button,fields:["sceneNavEnabled","useSceneFolders","navShowSceneFolders","openFolderOnSceneLoad","sceneClickToView","useSceneIcons","navStartCollapsed","showNavOnHover","useSceneBackButton","useSceneLookup","useScenePreview","sceneItemWidth"],default:{sceneNavEnabled:!0,useSceneFolders:!0,navStartCollapsed:!1,sceneClickToView:!0,useSceneIcons:!1,navShowSceneFolders:!1,openFolderOnSceneLoad:!1,showNavOnHover:!1,useScenePreview:!0,useSceneLookup:!0,useSceneBackButton:!0,sceneItemWidth:150},scope:N.client,config:!1,requiresReload:!0},enforceGMSettings:{tag:"enforce-gm-settings",label:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.hint"),propType:Boolean,default:!1,scope:N.world,config:!0,requiresReload:!1},defaultSettings:{tag:"default-settings",label:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.hint"),propType:Object,default:null,scope:N.world,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:N.client,config:!0,default:!1},uiScale:{tag:"ui-scale",label:game.i18n.localize("CRLNGN_UI.settings.uiScale.label"),hint:game.i18n.localize("CRLNGN_UI.settings.uiScale.hint"),choices:{small:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.uiScale.options.large")},inputType:R.select,propType:String,default:rn.regular.name,scope:N.client,config:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!1},sceneItemWidth:{tag:"scene-item-width",oldName:"sceneItemWidth",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.hint"),propType:Number,inputType:R.number,default:150,scope:N.client,config:!1},useSceneFolders:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.world,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.world,config:!1},openFolderOnSceneLoad:{tag:"open-folder-on-scene-load",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.openFolderOnSceneLoad.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.openFolderOnSceneLoad.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.world,config:!1},navStartCollapsed:{tag:"nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.client,config:!1},navShowSceneFolders:{tag:"v1-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowSceneFolders.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.client,config:!1},sceneClickToView:{tag:"scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.world,config:!1},useSceneIcons:{tag:"use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.world,config:!1},useSceneBackButton:{tag:"v1-use-nav-back-button",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.world,config:!1},useSceneLookup:{tag:"use-scene-lookup",oldName:"useNavBackButton",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.world,config:!1},useScenePreview:{tag:"use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.world,config:!1},sceneNavAlias:{tag:"scene-nav-alias",oldName:"sceneNavAlias",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavAlias.hint"),propType:String,inputType:R.text,default:"",scope:N.world,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:R.number,default:0,scope:N.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.world,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:R.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:N.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:R.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:N.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:R.text,propType:String,default:"",scope:N.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:N.world,config:!1},otherModulesList:{tag:"other-modules-list",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),inputType:R.select,propType:String,default:"'monks-scene-nav','combat-carousel','dice-tray','crux','party-monitor-dock','touch-vtt'",options:{"Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Monks Scene Navigation":"'monks-scene-nav'","Party HUD":"'party-monitor-dock'","Touch VTT":"'touch-vtt'"},scope:N.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:R.text,propType:String,default:"",scope:N.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:R.text,default:ot.playerColor.name,scope:N.client,config:!1,requiresReload:!0},useLeftChatBorder:{tag:"use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:R.checkbox,default:!1,scope:N.client,config:!1,requiresReload:!0},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:R.checkbox,default:!0,scope:N.client,config:!1,requiresReload:!1},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:R.number,default:200,scope:N.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:R.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular"),large:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.large")},propType:String,default:Oe.small.name,scope:N.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:N.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:R.checkbox,propType:Boolean,default:!0,scope:N.client,config:!1},enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:R.checkbox,propType:Boolean,default:!0,scope:N.client,config:!1},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:R.number,propType:Number,default:0,scope:N.client,config:!1},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:R.number,propType:Number,default:120,scope:N.client,config:!1},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:R.number,propType:Number,default:160,scope:N.client,config:!1},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:R.number,propType:Number,default:145,scope:N.client,config:!1},dockWasResized:{tag:"dock-was-resized",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWasResized.hint"),inputType:R.checkbox,propType:Boolean,default:!1,scope:N.client,config:!1},dockResizeOnUserJoin:{tag:"dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),inputType:R.select,options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:Xe.horizontal.name,scope:N.client,config:!1},defaultVideoWidth:{tag:"default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),inputType:R.number,propType:Number,default:160,scope:N.client,config:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:N.world,config:!1,default:""},applyThemeToSheets:{tag:"v1-apply-theme-and-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyThemeToSheets.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyThemeToSheets.hint"),propType:Boolean,default:!0,scope:N.world,config:!1,requiresReload:!1},useHorizontalSheetTabs:{tag:"v1-use-horizontal-tabs",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useHorizontalSheetTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useHorizontalSheetTabs.hint"),propType:Boolean,default:!0,scope:N.client,config:!1,requiresReload:!1}}}class w{static isModuleOn(e){var t;const n=(t=game.modules)==null?void 0:t.get(e);return!!(n!=null&&n.active)}static html(e,n){return e.querySelector(n)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const n=e.offsetTop,t=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(n+t)}static getOffsetBottom(e){const n=e.offsetTop,t=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(n+t)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),n=game.settings.get("core","fonts")||{},t=Object.entries(n).map(([a])=>a),o=await this.processStyleSheets();return f.log("Found fonts:",[{foundry:Array.from(e),custom:t,cssImported:Array.from(o)}]),Array.from(new Set([...e,...t,...o])).filter(a=>!/FontAwesome|Font Awesome|FoundryVTT/.test(a)).map(a=>a.replace(/['"]/g,"").trim()).sort((a,r)=>a.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,n){let t=document.querySelector("#crlngn-ui-vars");if(!t){const m=document.querySelector("body.crlngn-ui");t=document.createElement("style"),t.id="crlngn-ui-vars",t.textContent=`body.crlngn-ui {
}
`,m.prepend(t)}let o=t.textContent,s=o.indexOf("body.crlngn-ui {"),a=o.indexOf("}",s);s===-1&&(o=`body.crlngn-ui {
}
`,s=0,a=o.indexOf("}"));const l=o.substring(s+16,a).split(";").map(m=>m.trim()).filter(m=>m!==""),d={};l.forEach(m=>{const y=m.split(":");if(y.length>=2){const E=y[0].trim(),k=y.slice(1).join(":").trim();E&&(d[E]=k)}}),e.includes("i18n")&&typeof n=="string"&&!n.startsWith('"')&&!n.startsWith("'")&&!n.match(/^url\(|^rgba?\(|^hsla?\(/)&&(n=`"${n}"`),d[e]=n;const u=Object.entries(d).map(([m,y])=>`  ${m}: ${y};`).join(`
`),g=o.substring(0,s)+`body.crlngn-ui {
`+u+`
}`+o.substring(a+1);t.textContent=g}static addCustomCSS(e){let n=document.querySelector("#crlngn-ui-custom-css");if(!n){const t=document.querySelector("body");n=document.createElement("style"),n.id="crlngn-ui-custom-css",n.textContent=`body.crlngn-ui {
}
`,t.appendChild(n)}n.textContent=e}static smoothScrollTo(e,n,t="horizontal",o=300,s=null){const a=e.dataset.scrollAnimationId;a&&cancelAnimationFrame(Number(a));const r=t==="horizontal",l=r?e.scrollLeft:e.scrollTop,d=n-l;if(d===0)return s&&s(),null;const u=performance.now(),g=y=>{const E=y-u;if(E>=o){r?e.scrollLeft=n:e.scrollTop=n,delete e.dataset.scrollAnimationId,s&&s();return}const k=E/o,z=k<.5?2*k*k:1-Math.pow(-2*k+2,2)/2;r?e.scrollLeft=l+d*z:e.scrollTop=l+d*z;const q=requestAnimationFrame(g);return e.dataset.scrollAnimationId=q,q},m=requestAnimationFrame(g);return e.dataset.scrollAnimationId=m,m}static async showReloadDialog(){var a,r;const e=game.i18n.localize("CRLNGN_UI.ui.notifications.reloadConfirmTitle"),n=game.i18n.localize("CRLNGN_UI.ui.notifications.reloadConfirm"),t=game.i18n.localize("CRLNGN_UI.ui.notifications.reloadConfirmYes"),o=game.i18n.localize("CRLNGN_UI.ui.notifications.reloadConfirmNo");let s;try{typeof foundry<"u"&&((r=(a=foundry.applications)==null?void 0:a.api)!=null&&r.DialogV2)?s=await foundry.applications.api.DialogV2.confirm({window:{title:e},content:`<p>${n}</p>`}):typeof Dialog<"u"?s=await Dialog.confirm({title:e,content:`<p>${n}</p>`,yes:t,no:o,defaultYes:!1}):s=window.confirm(n)}catch(l){console.error("Error showing reload dialog:",l),s=window.confirm(n)}return s?window.location.reload():C.reloadRequired=!1,s}}S(w,"processStyleSheets",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([t])=>t);const n=new Set;for(const t of document.styleSheets)try{if(t.ownerNode){const o=t.href||"",s=o.includes("/css/")||o.includes("/styles/"),a=o.includes("/modules/crlngn-ui/");if(o&&!s&&!a){f.log("Skipping non-core/module stylesheet:",[o]);continue}let r="";if(t.ownerNode instanceof Element){if(t.ownerNode.tagName==="STYLE")r=t.ownerNode.textContent;else if(t.ownerNode.tagName==="LINK")try{const u=t.cssRules||t.rules;r=Array.from(u).map(g=>g.cssText).join(`
`)}catch(u){f.warn("Could not read stylesheet rules:",[u])}}f.log("Processing stylesheet:",[o||"inline style"]);const l=/@import\s+url\(['"]([^'"]+)['"]\)/g;let d;for(;(d=l.exec(r))!==null;){let u=d[1];if(u.includes("fonts.googleapis.com")){const g=u.match(/family=([^&]+)/);g&&decodeURIComponent(g[1]).split("|").map(y=>y.split(":")[0].replace(/\+/g," ")).forEach(y=>{n.add(y)})}else{if(u.startsWith("./")||u.startsWith("../")){f.log("Skipping relative import:",[u]);continue}let g=u;try{const m=await fetch(g);if(!m.ok){f.warn("Error loading imported CSS:",[m.status]);continue}const E=(await m.text()).match(/@font-face\s*{[^}]+}/g);if(!E)continue;E.forEach(k=>{const z=k.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(z&&z[1]){const q=z[1].trim();n.add(q)}})}catch(m){f.warn("Error processing imported CSS:",[m])}}}}if(!t.href||t.href.startsWith(window.location.origin))try{const o=t.cssRules||t.rules;for(const s of o)if(s instanceof CSSFontFaceRule){const a=s.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();n.add(a)}}catch(o){f.warn("Could not read stylesheet rules:",[o])}}catch(o){f.warn("Error processing stylesheet:",[o])}return n}),S(w,"wrapFontName",e=>{const n=e.replace(/['"`]/g,"");return n.includes(" ")?`"${n}"`:n});const{ApplicationV2:cs,HandlebarsApplicationMixin:ds}=foundry.applications.api;var pt,ko,Io,Gt,Pn;const be=class be extends ds(cs){constructor(){super(...arguments);I(this,Gt)}static get DEFAULT_OPTIONS(){return{id:v().cameraDockMenu.tag,actions:{redefine:A(be,pt,Io)},form:{handler:A(be,pt,ko),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(n){var u;const t=v(),o=t.cameraDockMenu.fields,s={},a={},r={},l=game.user.isGM;o.forEach(g=>{let m=l||t[g].scope===N.client;if(t[g]&&m){const y=C.get(t[g].tag);f.log("_prepareContext",[g,y]),s[g]=t[g],a[g]=y!==void 0?y:t[g].default,r[g]=t[g].default}});const d={...a,default:{...r},isGM:(u=game.user)==null?void 0:u.isGM,fields:{...s},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return f.log("_prepareContext",[d,n]),d}async _preparePartContext(n,t){return t.partId=`${n}-${this.id}`,f.log("_preparePartContext",[n,t]),t}_onRender(n,t){var a;f.log("_onRender",[n,t]),be.element=this.element,be.element.querySelector(".toggle-hint").addEventListener("click",()=>{be.element.querySelectorAll("p.hint").forEach(r=>r.classList.toggle("shown"))});const s=(a=this.element)==null?void 0:a.querySelector('input[name="enableFloatingDock"]');f.log("_onRender",[this.element,s]),s&&(s.addEventListener("change",A(this,Gt,Pn).bind(this)),A(this,Gt,Pn).call(this,{target:s}))}};pt=new WeakSet,ko=async function(n,t,o){const s=v();n.preventDefault(),n.stopPropagation();const a=s.cameraDockMenu.fields,r=o.object;a.forEach(g=>{s[g].inputType==="checkbox"&&!r.hasOwnProperty(g)&&(r[g]=!1)});const l=foundry.utils.expandObject(r),d=C.get(s.enableFloatingDock.tag);f.log("Compared settings:",[l.enableFloatingDock,d]),a.forEach(g=>{f.log("Saving setting >>",[s[g].tag,l[g]]),l[g]!==void 0&&C.set(s[g].tag,l[g])}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),l.enableFloatingDock!==d&&w.showReloadDialog()},Io=async function(n,t){const o=v(),a=this.element.querySelectorAll("input, select"),r=o.cameraDockMenu.fields,l={};r.forEach(d=>{o[d]&&(o[d],l[d]=o[d].default)}),a.forEach(d=>{d.value=l[d.name]}),f.log("#onReset",[n,t,o.cameraDockMenu.default])},Gt=new WeakSet,Pn=function(n){var s,a;const t=(s=this.element)==null?void 0:s.querySelectorAll('input:not([name="enableFloatingDock"])');t.forEach(r=>r.disabled=!n.target.checked);const o=(a=this.element)==null?void 0:a.querySelectorAll("select");o.forEach(r=>r.disabled=!n.target.checked),f.log("onDockEnabledChange",[this.element,t,o])},I(be,pt),S(be,"element"),S(be,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Dn=be;const{ApplicationV2:us,HandlebarsApplicationMixin:gs}=foundry.applications.api;var _n,mt,Ro,Mo;const ve=class ve extends gs(us){static get DEFAULT_OPTIONS(){return{id:v().chatMessagesMenu.tag,actions:{redefine:A(ve,mt,Mo)},form:{handler:A(ve,mt,Ro),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){var d;const n=v(),t=n.chatMessagesMenu.fields,o={},s={},a={},r=game.user.isGM;t.forEach(u=>{let g=r||n[u].scope===N.client;if(f.log("_prepareContext",[n[u].oldName]),n[u]&&g){const m=C.get(n[u].tag);o[u]=n[u],s[u]=m!==void 0?m:n[u].default,a[u]=n[u].default}}),f.log("_prepareContext",[s,a]);const l={...s,default:{...a},isGM:(d=game.user)==null?void 0:d.isGM,fields:{...o},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return f.log("_prepareContext",[l,e]),l}async _preparePartContext(e,n){return n.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,n]),n}_onRender(e,n){const t=v();ve.element=this.element,ve.element.querySelector(".toggle-hint").addEventListener("click",()=>{ve.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=C.get(t.chatMessagesMenu.tag);f.log("_onRender",[e,n,s])}};_n=new WeakMap,mt=new WeakSet,Ro=async function(e,n,t){const o=v();e.preventDefault(),e.stopPropagation();const s=o.chatMessagesMenu.fields,a=t.object;s.forEach(u=>{o[u].inputType==="checkbox"&&!a.hasOwnProperty(u)&&(a[u]=!1)});const r=foundry.utils.expandObject(a),l=C.get(o.chatBorderColor.tag);f.log("Compared settings:",[r.chatBorderColor,l]),s.forEach(u=>{f.log("Saving setting >>",[o[u].tag,r[u]]),r[u]!==void 0&&C.set(o[u].tag,r[u])}),r.chatBorderColor!==l&&w.showReloadDialog(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Mo=async function(e,n){const t=v(),s=this.element.querySelectorAll("input, select"),a=t.chatMessagesMenu.fields,r={};a.forEach(l=>{t[l]&&(t[l],r[l]=t[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(ve,mt),I(ve,_n),S(ve,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Gn=ve;const{ApplicationV2:fs,HandlebarsApplicationMixin:ps}=foundry.applications.api;var eo,Be,Do,Po,Go;const ae=class ae extends ps(fs){static get DEFAULT_OPTIONS(){return{id:v().customFontsMenu.tag,actions:{redefine:A(ae,Be,Go)},form:{handler:A(ae,Be,Do),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){var d;const n=v(),t=n.customFontsMenu.fields,o={},s={},a={},r=game.user.isGM;return t.forEach(u=>{let g=r||n[u].scope===N.client;if(n[u]&&g){const m=C.get(n[u].tag);o[u]=n[u],s[u]=m!==void 0?m:n[u].default,a[u]=n[u].default}}),{...s,default:{...a},fontList:await w.getAllFonts(),fields:{...o},isGM:(d=game.user)==null?void 0:d.isGM,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,n){return n.partId=`${e}-${this.id}`,n}_onRender(e,n){ae.element=this.element,ae.element.querySelector(".toggle-hint").addEventListener("click",()=>{ae.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))}),ae.element.querySelectorAll('input[type="text"]').forEach(a=>{const r=a.closest(".dropdown-wrapper"),l=r==null?void 0:r.querySelector(".dropdown-options");if(!r||!l)return;const d=()=>{var u;A(u=ae,Be,Po).call(u),l.classList.add("active")};a.addEventListener("focus",d),a.addEventListener("click",d),a.addEventListener("keydown",u=>{const g=l.classList.contains("active"),m=Array.from(l.querySelectorAll(".dropdown-option"));let y=m.findIndex(E=>E.classList.contains("highlighted"));u.key==="ArrowDown"||u.key==="ArrowUp"?(u.preventDefault(),g||l.classList.add("active"),m.forEach(E=>E.classList.remove("highlighted")),y===-1?y=u.key==="ArrowDown"?0:m.length-1:y=u.key==="ArrowDown"?(y+1)%m.length:(y-1+m.length)%m.length,m[y]&&(m[y].classList.add("highlighted"),m[y].scrollIntoView({block:"nearest"}))):u.key==="Enter"?(u.preventDefault(),g&&y!==-1&&m[y]&&m[y].click()):u.key==="Escape"&&l.classList.remove("active")}),document.addEventListener("click",u=>{r.contains(u.target)||l.classList.remove("active")})}),ae.element.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(l=>l.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",r=>{const l=a.closest(".dropdown-wrapper").querySelector("input");let d=a.dataset.value;d.includes(" ")&&!d.startsWith('"')?d=`"${d}"`:d.startsWith("&quot;")&&(d=d.replace(/&quot;/g,'"')),l.value=d,a.closest(".dropdown-options").classList.remove("active")})})}};eo=new WeakMap,Be=new WeakSet,Do=async function(e,n,t){const o=v();e.preventDefault(),e.stopPropagation();const s=o.customFontsMenu.fields,a=foundry.utils.expandObject(t.object);s.forEach(r=>{a[r]!==void 0&&(f.log("Saving setting:",[a[r]]),C.set(o[r].tag,a[r]))}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Po=function(){ae.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Go=async function(e,n){const t=v(),s=this.element.querySelectorAll("input[type=text]"),a=t.customFontsMenu.fields,r={};a.forEach(l=>{t[l]&&(t[l],r[l]=t[l].default)}),s.forEach(l=>{l.value=r[l.name]})},I(ae,Be),I(ae,eo),S(ae,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let An=ae;const{ApplicationV2:ms,HandlebarsApplicationMixin:hs}=foundry.applications.api;var to,ht,Ao,zo;const Ee=class Ee extends hs(ms){static get DEFAULT_OPTIONS(){return{id:v().leftControlsMenu.tag,actions:{redefine:A(Ee,ht,zo)},form:{handler:A(Ee,ht,Ao),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){var d;const n=v(),t=n.leftControlsMenu.fields,o={},s={},a={},r=game.user.isGM;t.forEach(u=>{let g=r||n[u].scope===N.client;if(n[u]&&g){const m=C.get(n[u].tag);o[u]=n[u],s[u]=m!==void 0?m:n[u].default,a[u]=n[u].default}});const l={...s,default:{...a},fields:{...o},isGM:(d=game.user)==null?void 0:d.isGM,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return f.log("_prepareContext",[l,e]),l}async _preparePartContext(e,n){return n.partId=`${e}-${this.id}`,f.log("_preparePartContext",[e,n]),n}_onRender(e,n){const t=v();Ee.element=this.element,Ee.element.querySelector(".toggle-hint").addEventListener("click",()=>{Ee.element.querySelectorAll("p.hint").forEach(a=>a.classList.toggle("shown"))});const s=C.get(t.leftControlsMenu.tag);f.log("_onRender",[e,n,s])}};to=new WeakMap,ht=new WeakSet,Ao=async function(e,n,t){const o=v();e.preventDefault(),e.stopPropagation();const s=o.leftControlsMenu.fields,a=foundry.utils.expandObject(t.object);s.forEach(r=>{a[r]!==void 0&&(f.log("Saving setting:",[a[r]]),C.set(o[r].tag,a[r]))}),await C.set(o.leftControlsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},zo=async function(e,n){const t=v(),s=this.element.querySelectorAll("input, select"),a=t.leftControlsMenu.default;s.forEach(r=>{r.value=a[r.name],r.type==="checkbox"&&(r.checked=a[r.name])}),f.log("#onReset",[e,n,t.leftControlsMenu.default])},I(Ee,ht),I(Ee,to),S(Ee,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let zn=Ee;const{ApplicationV2:Ss,HandlebarsApplicationMixin:ys}=foundry.applications.api;var no,St,Oo,Fo,At,Fn;const Ae=class Ae extends ys(Ss){constructor(){super(...arguments);I(this,At)}static get DEFAULT_OPTIONS(){return{id:v().sceneNavMenu.tag,actions:{redefine:A(Ae,St,Fo)},form:{handler:A(Ae,St,Oo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-map",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(n){var u;const t=v(),o=t.sceneNavMenu.fields,s={},a={},r={},l=game.user.isGM;o.forEach(g=>{let m=l||t[g].scope===N.client;if(t[g]&&m){const y=C.get(t[g].tag);s[g]=t[g],a[g]=y!==void 0?y:t[g].default,r[g]=t[g].default}});const d={...a,default:{...r},fields:{...s},isGM:(u=game.user)==null?void 0:u.isGM,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return f.log("_prepareContext",[d,n]),d}async _preparePartContext(n,t){return t.partId=`${n}-${this.id}`,f.log("_preparePartContext",[n,t]),t}_onRender(n,t){super._onRender(n,t),f.log("_onRender",[n,t]),Ae.element=this.element;const o=this.element,s=o.querySelector('input[type="range"][name="sceneItemWidth"]'),a=o.querySelector('input[type="number"].range-value-input[name="sceneItemWidth_value"]');if(s&&a){const d=parseInt(s.min,10),u=parseInt(s.max,10);s.addEventListener("input",()=>{a.value=s.value}),a.addEventListener("input",()=>{const g=a.value;if(g===""||g==="-")return;const m=parseInt(g,10);!isNaN(m)&&m>=d&&m<=u&&(s.value=m)}),a.addEventListener("change",()=>{let g=parseInt(a.value,10);isNaN(g)||g<d?g=d:g>u&&(g=u),a.value=g,s.value=g}),a.value=s.value}const r=o.querySelector(".toggle-hint");r&&r.addEventListener("click",()=>{o.querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))});const l=o.querySelector('input[name="sceneNavEnabled"]');f.log("_onRender sceneNavCheckbox",[o,l]),l&&(l.addEventListener("change",A(this,At,Fn).bind(this)),A(this,At,Fn).call(this,{target:l}))}};no=new WeakMap,St=new WeakSet,Oo=async function(n,t,o){n.preventDefault(),n.stopPropagation();const s=v(),a=s.sceneNavMenu.fields;let r=C.get(s.sceneNavEnabled.tag),l=C.get(s.useSceneFolders.tag);const d=foundry.utils.expandObject(o.object);a.forEach(m=>{d[m]!==void 0&&(f.log("Saving setting:",[m,d[m]]),C.set(s[m].tag,d[m]))});let u=C.get(s.sceneNavEnabled.tag),g=C.get(s.useSceneFolders.tag);f.log("Saving settings...",[r,u]),await C.set(s.sceneNavMenu.tag,d),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(r!==u||l!==g)&&w.showReloadDialog()},Fo=async function(n,t){const o=v(),a=this.element.querySelectorAll("input, select"),r=o.sceneNavMenu.default;a.forEach(l=>{l.value=r[l.name],l.type==="checkbox"&&(l.checked=r[l.name])}),f.log("#onReset",[n,t,o.sceneNavMenu.default])},At=new WeakSet,Fn=function(n){var o;const t=(o=this.element)==null?void 0:o.querySelectorAll('input:not([name="sceneNavEnabled"])');t.forEach(s=>s.disabled=!n.target.checked),f.log("onSceneNavEnabledChange",[this.element,t])},I(Ae,St),I(Ae,no),S(Ae,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let On=Ae;const{ApplicationV2:bs,HandlebarsApplicationMixin:vs}=foundry.applications.api;var oo,so,qe,xo,Uo,Bo;const Q=class Q extends vs(bs){static get DEFAULT_OPTIONS(){return{id:v().themeAndStylesMenu.tag,actions:{redefine:A(Q,qe,Bo)},form:{handler:A(Q,qe,xo),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){var u;const n=v(),t=n.themeAndStylesMenu.fields,o={},s={},a={},r=game.user.isGM;t.forEach(g=>{let m=r||n[g].scope===N.client;if(n[g]&&m){const y=C.get(n[g].tag);o[g]=n[g],s[g]=y!==void 0?y:n[g].default,a[g]=n[g].default}});const l=De.find(g=>g.className===s.colorTheme);s.colorTheme=(l==null?void 0:l.label)||De[0].label;const d={...s,default:{...a},fields:{...o},isGM:(u=game.user)==null?void 0:u.isGM,selectedTheme:l,themes:De,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...s},d}async _preparePartContext(e,n){return n.partId=`${e}-${this.id}`,n}_onRender(e,n){Q.element=this.element,Q.element.querySelector(".toggle-hint").addEventListener("click",()=>{Q.element.querySelectorAll("p.hint").forEach(u=>u.classList.toggle("shown"))}),this._themes=De,Q.element.querySelectorAll('input[type="text"]:not([hidden])').forEach(u=>{const g=u.closest(".dropdown-wrapper"),m=g==null?void 0:g.querySelector(".dropdown-options");if(!g||!m)return;const y=()=>{var E;A(E=Q,qe,Uo).call(E),m.classList.add("active")};u.addEventListener("focus",y),u.addEventListener("click",y),u.addEventListener("keydown",E=>{const k=m.classList.contains("active"),z=Array.from(m.querySelectorAll(".dropdown-option"));let q=z.findIndex(V=>V.classList.contains("highlighted"));E.key==="ArrowDown"||E.key==="ArrowUp"?(E.preventDefault(),k||m.classList.add("active"),z.forEach(V=>V.classList.remove("highlighted")),q===-1?q=E.key==="ArrowDown"?0:z.length-1:q=E.key==="ArrowDown"?(q+1)%z.length:(q-1+z.length)%z.length,z[q]&&(z[q].classList.add("highlighted"),z[q].scrollIntoView({block:"nearest"}))):E.key==="Enter"?(E.preventDefault(),k&&q!==-1&&z[q]&&z[q].click()):E.key==="Escape"&&m.classList.remove("active")}),document.addEventListener("click",E=>{g.contains(E.target)||m.classList.remove("active")})});const s=Q.element.querySelectorAll(".dropdown-option"),a=this;s.forEach(u=>{u.addEventListener("mouseenter",()=>{u.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(m=>m.classList.remove("highlighted")),u.classList.add("highlighted")}),u.addEventListener("click",function(g){f.log("option",[u,u.querySelector(".theme-name")]);const m=u.closest(".dropdown-wrapper").querySelector("input");let y=u.querySelector(".theme-name").innerHTML.toString();if(m.value=y,m.name==="colorTheme"){const k=a._themes.find(z=>z.label===y);a._selectedTheme=k,a._updateThemePreview(k)}u.closest(".dropdown-options").classList.remove("active")})});const r=Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),l=Q.element.querySelector("input.otherModulesList");r.forEach(u=>{u.addEventListener("change",g=>{const m=g.currentTarget;let E=`${l.value}`.split(",")||[],k=E.indexOf(m.value);!g.currentTarget.checked&&k>-1?E.splice(k,1):g.currentTarget.checked&&k===-1&&E.push(m.value),l.value=E.join(","),f.log("checkbox changed",[E,l.value])})}),Q.element.querySelector("input.adjustOtherModules").addEventListener("change",u=>{Q.element.querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(m=>{m.checked=u.currentTarget.checked;const y=new Event("change",{bubbles:!0});m.dispatchEvent(y)})})}_updateThemePreview(e){if(f.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((t,o)=>{t.style.setProperty("background-color",e.colorPreview[o])})}};oo=new WeakMap,so=new WeakMap,qe=new WeakSet,xo=async function(e,n,t){const o=v();e.preventDefault(),e.stopPropagation();const s=o.themeAndStylesMenu.fields,a=foundry.utils.expandObject(t.object),r=De.find(l=>l.label===a.colorTheme);a.colorTheme=r?r.className:"",s.forEach(l=>{a[l]!==void 0&&(f.log("Saving setting:",[a[l]]),C.set(o[l].tag,a[l]))}),C.set(o.themeAndStylesMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Uo=function(){Q.element.querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Bo=async function(e,n){const t=v(),s=this.element.querySelectorAll("input[type=text]"),a=t.themeAndStylesMenu.fields,r={};a.forEach(d=>{t[d]&&(t[d],r[d]=t[d].default)});const l=De.find(d=>d.label===t.colorTheme.default);r.colorTheme=(l==null?void 0:l.label)||De[0].label,s.forEach(d=>{d.value=r[d.name]})},I(Q,qe),I(Q,oo),I(Q,so,!1),S(Q,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let xn=Q;function Es(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:An,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:xn,restricted:!1},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-comment",propType:Gn,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-gear",propType:zn,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Dn,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-map",propType:On,restricted:!1}}}var Ze,Ke,zt,Ot,Ft,xt,Ut,$,Un,Nt,Bn,qn,Hn,Wn;const p=class p{static init(){const e=v();p.currSettings={enableFloatingDock:C.get(e.enableFloatingDock.tag),defaultVideoWidth:C.get(e.defaultVideoWidth.tag),dockHeight:C.get(e.dockHeight.tag),dockWidth:C.get(e.dockWidth.tag),dockPosX:C.get(e.dockPosX.tag),dockPosY:C.get(e.dockPosY.tag),dockWasResized:C.get(e.dockWasResized.tag),dockResizeOnUserJoin:C.get(e.dockResizeOnUserJoin.tag)},p.currSettings.enableFloatingDock?(Hooks.on(U.RENDER_CAMERA_VIEWS,p.onRenderFloating),f.log("CameraUtil settings",[p.currSettings]),p.onRenderFloating()):(Hooks.on(U.RENDER_CAMERA_VIEWS,p.onRenderPlain),p.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,s,a;v();const e=p.currSettings;(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),p.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),t=document.querySelector("#camera-views .camera-grid");f.log("CameraUtil.onRender",[e.dockPosX,e.dockPosY]),p.cameraContainer&&t&&n&&((s=p.cameraContainer)==null||s.insertBefore(n,t),(a=document.querySelector("#camera-views .camera-container"))==null||a.classList.add("visible")),p.makeDraggable(),p.makeResizeable(),p.resetPositionAndSize(),p.placeControlsToggle(),p.applyDockResize(),p.applyVideoWidth()}static applyDockResize(e){var t,o,s,a,r,l;const n=e||p.currSettings.dockResizeOnUserJoin;n===Xe.horizontal.name?((t=document.querySelector("#camera-views"))==null||t.classList.add("crlngn-horizontal"),(o=document.querySelector("#camera-views"))==null||o.classList.remove("crlngn-vertical")):n===Xe.vertical.name?((s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-vertical"),(a=document.querySelector("#camera-views"))==null||a.classList.remove("crlngn-horizontal")):((r=document.querySelector("#camera-views"))==null||r.classList.remove("crlngn-vertical"),(l=document.querySelector("#camera-views"))==null||l.classList.remove("crlngn-horizontal"))}static applyVideoWidth(e){const n=v(),t=C.get(n.defaultVideoWidth.tag);let o=e||t;if(o<ho)o=ho,C.set(n.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){p.currSettings.defaultVideoWidth=o;const s=document.querySelector("#camera-views.crlngn-ui.webrtc-dock-minimized"),a=document.querySelector("#camera-views.crlngn-ui");!s&&a?a.style.setProperty("--av-width",o+"px"):a&&a.style.removeProperty("--av-width"),p.resizeDock()}}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),n=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(f.log("placeControlsToggle",[e,n]),(n==null?void 0:n.length)>0)return;const t=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,t)}static makeDraggable(){var e,n;(e=p.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,r;if(t.button!==0)return;const o=document.querySelector("body.crlngn-ui");if((a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",A(p,$,Bn)),o==null||o.addEventListener("mouseup",A(p,$,Un));const s=w.getOffsetBottom(p.cameraContainer);p.isDragging=!0,F(p,Ze,t.clientX-((r=p.cameraContainer)==null?void 0:r.offsetLeft)),F(p,Ke,window.innerHeight-t.clientY-s),t.preventDefault(),t.stopPropagation()}),(n=p.cameraContainer)==null||n.addEventListener("touchstart",t=>{var r,l;if(t.touches.length>1)return;const o=document.querySelector("body.crlngn-ui");if((r=t.target.parentNode)!=null&&r.classList.contains("volume-bar"))return;o==null||o.addEventListener("touchmove",A(p,$,qn)),o==null||o.addEventListener("touchend",A(p,$,Nt)),o==null||o.addEventListener("touchcancel",A(p,$,Nt));const s=t.touches[0],a=w.getOffsetBottom(p.cameraContainer);p.isDragging=!0,F(p,Ze,s.clientX-((l=p.cameraContainer)==null?void 0:l.offsetLeft)),F(p,Ke,window.innerHeight-s.clientY-a),t.preventDefault(),t.stopPropagation()})}static makeResizeable(){if(p.cameraContainer){const e=document.querySelector("body.crlngn-ui"),n=document.createElement("div");n.classList.add("resize-handle"),p.cameraContainer.append(n),n.addEventListener("mousedown",t=>{t.preventDefault(),t.stopPropagation(),p.isResizing=!0,F(p,zt,t.clientX),F(p,Ot,t.clientY),F(p,Ut,parseInt(getComputedStyle(p.cameraContainer).bottom)||0),F(p,Ft,p.cameraContainer.offsetWidth),F(p,xt,p.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",A(p,$,Hn)),e==null||e.addEventListener("mouseup",A(p,$,Wn))})}}static resetPositionAndSize({x:e,y:n,w:t,h:o}={x:null,y:null,w:null,h:null}){v();const s=p.currSettings;if(!(!s.enableFloatingDock||!p.cameraContainer))if(!e&&!n&&!t&&!o){const a=s.dockPosX||0,r=s.dockPosY||0;if(p.cameraContainer.style.left=`${a}px`,p.cameraContainer.style.bottom=`${r}px`,p.currSettings.dockResizeOnUserJoin===Xe.off.name){const l=s.dockWidth||0,d=s.dockHeight||0;p.cameraContainer.style.width=`${l}px`,p.cameraContainer.style.height=`${d}px`}}else e&&(p.cameraContainer.style.left=`${e}px`),n&&(p.cameraContainer.style.bottom=`${n}px`),p.currSettings.dockResizeOnUserJoin===Xe.horizontal.name&&(t&&(p.cameraContainer.style.width=`${t}px`),o&&(p.cameraContainer.style.height=`${o}px`))}};Ze=new WeakMap,Ke=new WeakMap,zt=new WeakMap,Ot=new WeakMap,Ft=new WeakMap,xt=new WeakMap,Ut=new WeakMap,$=new WeakSet,Un=function(e){var o,s;const n=v(),t={...p.currSettings};if(p.isDragging){const a=document.querySelector("body.crlngn-ui");t.dockPosX=parseInt((o=p.cameraContainer)==null?void 0:o.style.left)||0,t.dockPosY=parseInt((s=p.cameraContainer)==null?void 0:s.style.bottom)||0,t.dockPosY<=0&&(t.dockPosY=0),C.set(n.dockPosX.tag,t.dockPosX),C.set(n.dockPosY.tag,t.dockPosY),a==null||a.removeEventListener("mousemove",A(p,$,Bn)),a==null||a.removeEventListener("mouseup",A(p,$,Un)),p.isDragging=!1,e.stopPropagation()}},Nt=function(e){var o,s;const n=v(),t={...p.currSettings};if(p.isDragging){const a=document.querySelector("body.crlngn-ui");t.dockPosX=parseInt((o=p.cameraContainer)==null?void 0:o.style.left)||0,t.dockPosY=parseInt((s=p.cameraContainer)==null?void 0:s.style.bottom)||0,t.dockPosY<=0&&(t.dockPosY=0),C.set(n.dockPosX.tag,t.dockPosX),C.set(n.dockPosY.tag,t.dockPosY),a==null||a.removeEventListener("touchmove",A(p,$,qn)),a==null||a.removeEventListener("touchend",A(p,$,Nt)),a==null||a.removeEventListener("touchcancel",A(p,$,Nt)),p.isDragging=!1,e.preventDefault(),e.stopPropagation()}},Bn=function(e){if(p.isDragging){if(f.log("mousemove",[e.target.parentNode]),p.cameraContainer){let n=e.clientX-T(p,Ze),t=window.innerHeight-e.clientY-T(p,Ke);n+p.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-p.cameraContainer.offsetWidth),p.cameraContainer.style.left=`${n}px`,t+p.cameraContainer.offsetHeight>window.innerHeight&&(t=window.innerHeight-p.cameraContainer.offsetHeight),p.cameraContainer.style.bottom=`${t}px`}e.preventDefault(),e.stopPropagation()}},qn=function(e){if(!(!p.isDragging||!e.touches[0])){if(p.cameraContainer){const n=e.touches[0];let t=n.clientX-T(p,Ze),o=window.innerHeight-n.clientY-T(p,Ke);t+p.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-p.cameraContainer.offsetWidth),p.cameraContainer.style.left=`${t}px`,o+p.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-p.cameraContainer.offsetHeight),p.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}},Hn=function(e){if(!p.isResizing)return;const n=T(p,Ft)+(e.clientX-T(p,zt)),t=e.clientY-T(p,Ot),o=T(p,xt)+t,s=T(p,Ut)-t;p.cameraContainer.style.width=`${n}px`,p.cameraContainer.style.height=`${o}px`,p.cameraContainer.style.bottom=`${s}px`},Wn=function(){var o,s,a,r,l,d;const e=v(),n={...p.currSettings},t=document.querySelector("body.crlngn-ui");p.isResizing=!1,t==null||t.removeEventListener("mousemove",A(p,$,Hn)),t==null||t.removeEventListener("mouseup",A(p,$,Wn)),f.log("onStopResize",[(o=p.cameraContainer)==null?void 0:o.style.width,(s=p.cameraContainer)==null?void 0:s.style.height,(a=p.cameraContainer)==null?void 0:a.style.bottom]),n.dockWidth=parseInt(((r=p.cameraContainer)==null?void 0:r.style.width)||0),n.dockHeight=parseInt(((l=p.cameraContainer)==null?void 0:l.style.height)||0),n.dockPosY=parseInt(((d=p.cameraContainer)==null?void 0:d.style.bottom)||0),C.set(e.dockWidth.tag,n.dockWidth),C.set(e.dockHeight.tag,n.dockHeight),C.set(e.dockPosY.tag,n.dockPosY),C.set(e.dockWasResized.tag,!0)},I(p,$),I(p,Ze,0),I(p,Ke,0),S(p,"isDragging",!1),S(p,"cameraContainer"),S(p,"isResizing",!1),I(p,zt,0),I(p,Ot,0),I(p,Ft,0),I(p,xt,0),I(p,Ut,0),S(p,"currSettings",{}),S(p,"resizeDock",()=>{v(),!p.currSettings.enableFloatingDock||p.cameraContainer});let ne=p;const ue=class ue{static init(){const e=v();ue.enableChatStyles=C.get(e.enableChatStyles.tag),ue.chatBorderColor=C.get(e.chatBorderColor.tag),ue.useLeftChatBorder=C.get(e.useLeftChatBorder.tag)}};S(ue,"chatBorderColor"),S(ue,"enableChatStyles"),S(ue,"useLeftChatBorder"),S(ue,"enrichCard",async(e,n)=>{var a,r,l,d,u,g,m,y;f.log("renderChatMessage",[ue.chatBorderColor,ue.enableChatStyles,ot.playerColor.name,(a=e.author)==null?void 0:a.id]);const t=((d=(l=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:l.activity)==null?void 0:d.type)||((m=(g=(u=e.flags)==null?void 0:u.dnd5e)==null?void 0:g.roll)==null?void 0:m.type)||"custom";let o=n.get?n.get(0):n;if(!o)return;o.classList.add(t),o.classList.add("crlngn"),ue.useLeftChatBorder&&o.classList.add("left-border");const s=o.querySelectorAll(".card-buttons button[data-action=rollSave]");s.length>0&&s.forEach(E=>{const k=E.querySelector(".visible-dc"),z=E.querySelector(".hidden-dc");f.log("enrichCard",[k,z]),k.setAttribute("data-ability",E.getAttribute("data-ability")||""),k.setAttribute("data-dc",E.getAttribute("data-dc")||""),z.setAttribute("data-ability",E.getAttribute("data-ability")||"")}),ue.chatBorderColor===ot.playerColor.name&&((y=e.author)!=null&&y.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let gt=ue;var ao;const fe=class fe{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,fe.checkPlayersList),Hooks.on(U.RENDER_HOTBAR,fe.checkPlayersList),w.isModuleOn("foundry-taskbar")&&Hooks.on(U.UPDATE_USER,fe.checkTaskbarLock),fe.checkTaskbarLock(),fe.addModuleClasses()}};ao=new WeakMap,I(fe,ao),S(fe,"addModuleClasses",()=>{const e=v(),n=C.get(e.otherModulesList.tag)||"",t=n.split(",");f.log("addModuleClasses",[t,n]),Object.entries(e.otherModulesList.options).forEach(o=>{const s=o[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+s)}),t.forEach(o=>{const s=o.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+s)})}),S(fe,"checkTaskbarLock",()=>{var s,a,r;const e=w.isModuleOn("foundry-taskbar"),n=(s=game.user.flags)==null?void 0:s["foundry-taskbar"];if(f.log("checkTaskbarLock",[n]),!e||!(n!=null&&n.taskbarSettings))return;const t=game.settings.get("foundry-taskbar","reduceSidebar");(a=n.taskbarSettings)!=null&&a.locked?w.addCSSVars("--crlngn-sidebar-bottom",t?"50px":"0px"):w.addCSSVars("--crlngn-sidebar-bottom","0px"),(r=n.taskbarSettings)!=null&&r.locked?w.addCSSVars("--crlngn-taskbar-height","50px"):w.addCSSVars("--crlngn-taskbar-height","10px");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML=""),fe.checkPlayersList()}),S(fe,"checkPlayersList",()=>{const e=document.querySelector("body"),n=document.querySelector("#players"),t=w.isModuleOn("foundry-taskbar"),o=t?game.settings.get("foundry-taskbar","dockPlayersList"):!1,s=t?game.settings.get("foundry-taskbar","dockMacroBar"):!1;f.log("checkPlayersList",[o,t,s,game.settings]),document.querySelector("#hotbar"),o?(f.log("checkPlayersList TEST",[o]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):n&&(e.classList.add("with-players"),e.classList.remove("with-players-hide")))});let lt=fe;var Qe,io,Le,Bt,_e,qt,ro,Ht,et,dt,tt,he,pn,mn,hn,Wt;const c=class c{static applyCustomStyle(e){c.sceneNavEnabled=e,f.log("applyCustomStyle - TopNavigation",[c.sceneNavEnabled,ui.nav])}static applyButtonSettings(){var n,t;v();let e=1;(n=game.user)!=null&&n.isGM&&c.useSceneBackButton&&e++,(t=game.user)!=null&&t.isGM&&c.useSceneLookup&&e++,w.addCSSVars("--scene-list-left",`calc(var(--left-control-item-size) * ${e})`)}static resetLocalVars(e){let n=(e==null?void 0:e[0])||e||document.querySelector("#navigation");c.navElem=n,F(c,Le,n.querySelector("#nav-toggle")),F(c,Bt,n.querySelector("#ui-left")),c.scenesList=n.querySelector("#scene-list")}static handleFolderList(e,n,t){v(),c.useSceneFolders&&Ge.addFolderButtons(e,n,t)}static handleNavState(e){const n=v();if(e=e[0]||e,T(c,Ht)){F(c,Ht,!1),c.toggleNav(c.navStartCollapsed);const t=e.querySelector("#scene-list > li.scene.active"),o=t?t.offsetLeft:0,s=(t==null?void 0:t.offsetWidth)||0,a=Math.floor(o/s);f.log("onLoad - scenePos",[o,a]),c.navPos=a,C.set(n.sceneNavPos.tag,a)}}static toggleNav(e){clearTimeout(T(c,qt)),F(c,qt,setTimeout(()=>{var n,t;c.resetLocalVars(),e===!0?((n=ui.nav)==null||n.collapse(),c.isCollapsed=!0,f.log("toggleNav collapse",[ui.nav,e,c.navStartCollapsed]),document.querySelectorAll("#ui-top .crlngn-btn").forEach(s=>s.remove())):e===!1&&(c.isCollapsed=!1,(t=ui.nav)==null||t.expand(),f.log("toggleNav expand",[e,c.navStartCollapsed]))},300))}static checkSceneNavCompat(){var t,o;const e=v(),n=document.querySelector("#ui-middle");this.isMonksSceneNavOn=w.isModuleOn("monks-scene-navigation"),this.isRipperSceneNavOn=w.isModuleOn("compact-scene-navigation"),this.isRipperSceneNavOn&&c.useSceneFolders&&(t=game.user)!=null&&t.isGM&&this.isRipperSceneNavOn&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesCompat"),{permanent:!0}),this.isMonksSceneNavOn&&c.sceneNavEnabled&&(n.classList.remove("crlngn-ui"),game.ready&&(C.set(e.sceneNavEnabled.tag,!1),c.sceneNavEnabled=!1),f.log("checkSceneNavCompat",[c.isMonksSceneNavOn,c.isRipperSceneNavOn]),(o=game.user)!=null&&o.isGM&&c.isMonksSceneNavOn&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}))}static addListeners(){var e,n;(e=c.navElem)==null||e.addEventListener("mouseenter",t=>{if(f.log("TopNavigation mouseenter",[c.isCollapsed,c.showNavOnHover]),!c.isCollapsed||!c.showNavOnHover)return;t.preventDefault(),t.stopPropagation(),clearTimeout(T(c,Qe)),document.querySelector("#navigation").classList.remove("collapsed")}),(n=c.navElem)==null||n.addEventListener("mouseleave",t=>{var o,s;if(!(!c.isCollapsed||!c.showNavOnHover)){if(t.relatedTarget&&c.navElem.contains(t.relatedTarget)){f.log("TopNavigation mouseleave: relatedTarget is within navElem, not starting collapse timeout.",[((o=t.relatedTarget)==null?void 0:o.id)||((s=t.relatedTarget)==null?void 0:s.tagName)]);return}t.preventDefault(),t.stopPropagation(),F(c,Qe,setTimeout(()=>{clearTimeout(T(c,Qe)),F(c,Qe,null);const a=document.querySelector("#navigation");c.isCollapsed&&c.showNavOnHover&&a.classList.add("collapsed")},700))}})}static setNavPosition(e=null,n=!0,t=400){var o,s,a,r,l;try{const d=v();if(f.log("setNavPosition #1",[e,c.navElem]),!c.navElem)return;const u=(o=c.navElem)==null?void 0:o.querySelector("#folders-group"),g=(s=c.navElem)==null?void 0:s.querySelector("#crlngn-folder-toggle"),m=((a=c.navElem)==null?void 0:a.querySelectorAll("#scene-list > li.scene"))||[],y=Array.from(m)[0],E=(y==null?void 0:y.offsetWidth)||0,k=c.navShowSceneFolders?((u==null?void 0:u.offsetWidth)||0)+((g==null?void 0:g.offsetWidth)||0):0;let z=e!==null?e:c.navPos||0;if(!y)return;c.navPos=z,C.set(d.sceneNavPos.tag,z);const q=(y==null?void 0:y.offsetWidth)||0,V=parseInt(q)*z;f.log("setNavPosition #2",[e,z,q,V,k,E]);let ee=V;ee>((r=c.navElem)==null?void 0:r.scrollWidth)&&(ee=(l=c.navElem)==null?void 0:l.scrollWidth),n?w.smoothScrollTo(c.navElem,ee,"horizontal",t):c.navElem.scrollTo({left:ee,behavior:"instant"})}catch(d){f.log("setNavPosition",["Error:",d]),console.error("Error in setNavPosition:",d)}}};Qe=new WeakMap,io=new WeakMap,Le=new WeakMap,Bt=new WeakMap,_e=new WeakMap,qt=new WeakMap,ro=new WeakMap,Ht=new WeakMap,et=new WeakMap,dt=new WeakMap,tt=new WeakMap,he=new WeakMap,pn=new WeakMap,mn=new WeakMap,hn=new WeakMap,Wt=new WeakMap,S(c,"navElem"),S(c,"scenesList"),I(c,Qe),I(c,io),I(c,Le),I(c,Bt),S(c,"sceneFoldersTemplate"),S(c,"navButtonsTemplate"),I(c,_e),I(c,qt),I(c,ro),I(c,Ht,!0),I(c,et,null),I(c,dt,null),I(c,tt,""),I(c,he,[]),S(c,"preventReposition",!1),S(c,"preventRerender",!1),S(c,"sceneNavEnabled"),S(c,"useSceneFolders"),S(c,"openFolderOnSceneLoad"),S(c,"navFoldersForPlayers"),S(c,"navShowSceneFolders"),S(c,"navStartCollapsed"),S(c,"showNavOnHover"),S(c,"useSceneIcons"),S(c,"useScenePreview"),S(c,"useSceneBackButton"),S(c,"sceneClickToView"),S(c,"isCollapsed"),S(c,"navPos"),S(c,"isMonksSceneNavOn",!1),S(c,"isRipperSceneNavOn",!1),S(c,"init",()=>{const e=v();if(c.isMonksSceneNavOn=w.isModuleOn("monks-scene-navigation"),c.isRipperSceneNavOn=w.isModuleOn("compact-scene-navigation"),c.sceneNavEnabled&&(c.checkSceneNavCompat(),c.isMonksSceneNavOn))return;Hooks.on(U.RENDER_SCENE_NAV,c.onRender),c.navStartCollapsed=C.get(e.navStartCollapsed.tag),c.showNavOnHover=C.get(e.showNavOnHover.tag),c.sceneNavEnabled=C.get(e.sceneNavEnabled.tag),c.useScenePreview=C.get(e.useScenePreview.tag),c.useSceneFolders=C.get(e.useSceneFolders.tag),c.navFoldersForPlayers=C.get(e.navFoldersForPlayers.tag),c.useSceneIcons=C.get(e.useSceneIcons.tag),c.isCollapsed=c.navStartCollapsed,c.isCollapsed&&c.toggleNav(c.isCollapsed),f.log("SCENE NAV INIT",[c.sceneNavEnabled],!0);const n=document.querySelector("body");c.sceneNavEnabled?n.classList.add("crlngn-scene-nav"):n.classList.remove("crlngn-scene-nav"),c.sceneNavEnabled&&(c.preloadTemplates(),Ge.init(),Hooks.on(U.READY,()=>{w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",t=>t.top=42),f.log(U.READY,[ui.sidebar]),c.checkSideBar(!ui.sidebar._collapsed)}),Hooks.on(U.COLLAPSE_SIDE_BAR,t=>{f.log(U.COLLAPSE_SIDE_BAR,[t,t.expanded,t._collapsed]),t&&c.checkSideBar(!t._collapsed)}),Hooks.on(U.COLLAPSE_SCENE_NAV,(t,o)=>{clearTimeout(T(c,_e)),c.isCollapsed=o,o&&document.querySelectorAll("#ui-top .crlngn-btn").forEach(a=>a.remove()),c.setCollapsedClass(o),F(c,_e,setTimeout(()=>{c.setCollapsedClass(o)},500))}),ui.sidebar&&c.checkSideBar(ui.sidebar.expanded),c.placeNavButtons()),Hooks.on(U.CREATE_SCENE,(t,o)=>{var s;c.preventReposition=!0,f.log("CREATE_SCENE",[t,o]),(s=ui.nav)==null||s.render()}),Hooks.on(U.UPDATE_SCENE,(t,o)=>{var s;c.preventReposition=!0,f.log("UPDATE_SCENE",[t,o]),c.preventRerender?c.preventRerender=!1:(s=ui.nav)==null||s.render()}),Hooks.on(U.DELETE_SCENE,(t,o)=>{var s;c.preventReposition=!0,f.log("DELETE_SCENE",[t,o]),(s=ui.nav)==null||s.render()}),Hooks.on(U.CANVAS_INIT,()=>{var o,s,a;const t=(s=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:s.id;if(t!==T(c,he)[T(c,he).length-1]&&(T(c,he).push(t),c.useSceneFolders&&c.openFolderOnSceneLoad)){const r=game.scenes.get(t);f.log(U.CANVAS_INIT,[r]),r!=null&&r.folder&&((a=game.user)!=null&&a.isGM)&&Ge.activateFolder(r.folder.id)}}),Hooks.on(U.RENDER_SCENE_DIRECTORY,t=>{f.log(U.RENDER_SCENE_DIRECTORY,[t]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(a=>{var l,d;const r=game.scenes.get(a.dataset.entryId);if(c.sceneClickToView&&(a.addEventListener("dblclick",c.onActivateScene),a.addEventListener("click",c.onSelectScene)),c.useSceneIcons&&r&&((l=game.user)!=null&&l.isGM)){let u=document.createElement("i");u.classList.add("fas"),u.classList.add("icon"),r.ownership.default!==0?(r.active&&(u.classList.add("fa-bullseye"),a.prepend(u)),((d=game.scenes.current)==null?void 0:d.id)===r.id&&(u.classList.add("fa-star"),a.prepend(u))):(u.classList.add("fa-eye-slash"),a.prepend(u))}})})}),S(c,"onRender",async(e,n,t)=>{var a,r;if(c.isMonksSceneNavOn)return;f.log("onRender",[]),n=(n==null?void 0:n[0])||n;const o=v(),s=c.navPos;c.resetLocalVars(n),c.sceneNavEnabled&&(c.handleExtraButtons(e,n,t),c.handleFolderList(e,n,t),c.handleSceneList(e,n,t),c.navShowSceneFolders&&(Ge.init(),await Ge.renderFolderList()),c.handleNavState(n)),(!c.useSceneFolders||!((a=game.user)!=null&&a.isGM))&&document.body.classList.add("crlngn-no-folders"),c.addSceneListeners(n),c.resetLocalVars(n),c.sceneNavEnabled&&(c.addListeners(),f.log("onRender - preventReposition?",[c.preventReposition]),c.preventReposition?c.preventReposition=!1:c.setNavPosition(s,!1),clearTimeout(T(c,_e)),F(c,_e,setTimeout(()=>{c.placeNavButtons()},500))),c.applyButtonSettings(),T(c,Le)&&(T(c,Le).dataset.tooltipDirection="RIGHT"),(r=c.navElem)==null||r.addEventListener("scrollend",()=>{var g;const d=((g=c.navElem)==null?void 0:g.querySelector("#scene-list > li.scene.view")).offsetWidth,u=Math.round(c.navElem.scrollLeft/d);c.navPos=u,C.set(o.sceneNavPos.tag,u)})}),S(c,"setCollapsedClass",e=>{var t,o;const n=document.querySelector("body");e?((t=c.navElem)==null||t.classList.add("collapsed"),n.classList.add("navigation-collapsed"),w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",s=>s.top=10)):((o=c.navElem)==null||o.classList.remove("collapsed"),n.classList.remove("navigation-collapsed"),c.placeNavButtons(),w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",s=>s.top=42))}),S(c,"checkSideBar",e=>{c.placeNavButtons();const n=document.querySelector("body");e?n.classList.add("sidebar-expanded"):n.classList.remove("sidebar-expanded")}),S(c,"handleSceneList",async(e,n,t)=>{var o,s;if(n=n[0]||n,c.sceneNavEnabled){f.log("handleSceneList",[e,n,t]);const a=n.querySelectorAll("#scene-list li.scene");for(const r of a){const l=r.dataset.sceneId;if(c.useScenePreview){const d=game.scenes.find(g=>g.id===l);d.isGM=(o=game.user)==null?void 0:o.isGM,d.thumb=d.thumb||null;const u=await renderTemplate(`modules/${B}/templates/scene-nav-preview.hbs`,d);if(r.classList.add("nav-item"),r.insertAdjacentHTML("beforeend",u),d.isGM&&T(c,tt)===l){const g=new MouseEvent("mouseenter");r.dispatchEvent(g)}(s=game.user)!=null&&s.isGM&&c.addPreviewIconListeners(r,d)}c.useSceneIcons&&r.classList.add("crlngn-icons")}}}),S(c,"handleExtraButtons",async(e,n,t)=>{var a;v(),n=n[0]||n,f.log("handleExtraButtons",[e,n,t]);const o=await renderTemplate(`modules/${B}/templates/scene-nav-extra-buttons.hbs`,{useSceneBackButton:game.user.isGM?c.useSceneBackButton:!1,useSceneFolders:game.user.isGM?c.useSceneFolders:!1,useSceneLookup:game.user.isGM?c.useSceneLookup:!1,backButtonTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.backButtonTooltip"),sceneLookupTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.sceneLookupTooltip"),isGM:(a=game.user)==null?void 0:a.isGM});n.querySelector("#nav-toggle").insertAdjacentHTML("afterend",o);const s=n.querySelector("#crlngn-back-button");s&&s.addEventListener("click",T(c,pn)),c.sceneNavEnabled&&c.useSceneLookup&&game.user.isGM&&Ge.handleFolderLookup(e,n,t)}),I(c,pn,e=>{var s;e.stopPropagation(),e.preventDefault();const n=T(c,he).length,t=T(c,he)[n-2];let o;f.log("#onBackButton before",[n,t,T(c,he)]),t&&t!==((s=game.scenes.current)==null?void 0:s.id)&&(o=game.scenes.get(t),o&&o.view(),T(c,he).pop()),f.log("#onBackButton after",[T(c,he)])}),S(c,"placeNavButtons",async()=>{var l,d;const e=document.querySelector("#navigation");if(f.log("placeNavButtons #1",[e]),!e||e.nodeName=="TEMPLATE")return;c.resetLocalVars(),e.querySelector("#scene-list");let n=document.querySelectorAll("button.crlngn-btn");const t=((l=T(c,Le))==null?void 0:l.offsetWidth)*2||0,o=e.offsetWidth-t<e.scrollWidth;if(f.log("placeNavButtons #2",[e.offsetWidth,t,e.scrollWidth]),!o||c.isCollapsed||(d=T(c,Bt))!=null&&d.classList.contains("navigation-collapsed")){n.forEach(u=>{f.log("placeNavButtons remove",[u.remove,u]),u.remove()}),n=[];return}if(n.length>0)return;const s=await renderTemplate(`modules/${B}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",s);const a=document.querySelector("#ui-top .crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-top .crlngn-btn.ui-nav-right");f.log("placeNavButtons #3",[a,r]),a==null||a.addEventListener("click",T(c,mn)),r==null||r.addEventListener("click",T(c,hn))}),I(c,mn,async e=>{if(c.navElem.scrollLeft<=0)return;e.preventDefault();const n=await c.getItemsPerPage(),t=document.querySelector("#navigation"),o=(t==null?void 0:t.querySelectorAll("li.nav-item"))||[],s=Array.from(o)[0];document.querySelector("#scene-list > li.scene.active");const a=(s==null?void 0:s.offsetWidth)||0,r=c.navPos||0;if(c.navPos=r,!c.scenesList||!c.navElem)return;let l=r-(n-1),d=l*a;f.log("onNavLast",[r,l,d]),c.setNavPosition(l)}),I(c,hn,async e=>{var g;if(e.preventDefault(),c.navElem.scrollLeft>=c.navElem.scrollWidth)return;const n=await c.getItemsPerPage(),t=document.querySelector("#navigation"),o=(t==null?void 0:t.querySelectorAll("li.nav-item"))||[],s=Array.from(o)[0]||null;document.querySelector("#scene-list > li.scene.active");const a=(s==null?void 0:s.offsetWidth)||0,r=c.navPos||0,l=((g=c.navElem)==null?void 0:g.scrollWidth)||0;if(f.log("onNavNext",[n,a,s,l]),!a||!c.navElem)return;let d=r+(n-1),u=d*a;f.log("onNavNext",["pos",r,d,a,u,l]),c.setNavPosition(d)}),S(c,"getItemsPerPage",()=>{var e,n;try{const s=((e=T(c,Le))==null?void 0:e.offsetWidth)||((n=T(c,Le))==null?void 0:n.clientWidth)||0,a=document.querySelector("#navigation li.nav-item.scene.active");if(!a)return f.log("getItemsPerPage",["No scene items found"]),1;const r=a.offsetWidth,l=document.querySelector("#navigation").offsetWidth;if(!l)return f.log("getItemsPerPage",["Nav element has no width"]),1;const d=Math.floor((l-s*2)/r);return f.log("getItemsPerPage",["Calculated:",d]),d||1}catch(t){return f.log("getItemsPerPage",["Error:",t]),f.error("Error in getItemsPerPage:",t),1}}),S(c,"preloadTemplates",async()=>{try{const e=[`modules/${B}/templates/scene-nav-buttons.hbs`,`modules/${B}/templates/scene-nav-preview.hbs`,`modules/${B}/templates/scene-nav-extra-buttons.hbs`];return await loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),S(c,"getCurrScenePosition",async e=>{try{if(!c.navElem||!e)return 0;const n=await c.getItemsPerPage()||1,t=c.navElem.querySelectorAll("li.nav-item");if(!t||t.length===0)return 0;const s=Array.from(t).findIndex(l=>l.dataset.sceneId===e);if(s===-1)return 0;const a=s>=c.navPos&&s<=c.navPos+n,r=a?c.navPos:s;return f.log("getCurrScenePosition",["Final position:",r,"isVisible:",a]),r}catch(n){return f.log("getCurrScenePosition",["Error:",n]),console.error("Error in getCurrScenePosition:",n),0}}),S(c,"onActivateScene",e=>{var r;e.stopPropagation(),e.preventDefault();const n=e.currentTarget,t=n.classList.contains("scene-name"),o=t?n.parentNode.dataset:n.dataset,s=t?n.parentNode.classList.contains("on-folder"):n.classList.contains("on-folder"),a=game.scenes.get(o.entryId||o.sceneId);if(f.log("onActivateScene",[o,a,e.currentTarget.classList,e.target.classList]),!a){console.error("Scene not found for activation",o);return}s&&(c.preventReposition=!0),a.activate(),(r=ui.nav)==null||r.render(),clearTimeout(T(c,et))}),S(c,"onSelectScene",e=>{var r;e.preventDefault();const n=e.currentTarget,t=n.classList.contains("scene-name"),o=t?n.parentNode.dataset:n.dataset,s=t?n.parentNode.classList.contains("on-folder"):n.classList.contains("on-folder"),a=game.scenes.get(o.entryId||o.sceneId);if(!a){console.error("Scene not found for selection",o);return}if(F(c,tt,""),a&&a.sheet){f.log("onSelectScene",[(r=a.sheet)==null?void 0:r.render]);const l=a.sheet.render;a.sheet.render=()=>{},setTimeout(()=>{a.sheet.render=l},500)}clearTimeout(T(c,et)),F(c,et,setTimeout(()=>{s&&(c.preventReposition=!0),a.view(),F(c,et,null)},350))}),S(c,"onScenePreviewOn",e=>{if(e.stopPropagation(),e.preventDefault(),f.log("onScenePreviewOn",[c.useScenePreview]),!c.showNavOnHover)return;const n=e.currentTarget,t=n.dataset;F(c,tt,t.sceneId),F(c,dt,setTimeout(()=>{clearTimeout(T(c,dt)),n.querySelector(".scene-preview").classList.add("open")},200))}),S(c,"onScenePreviewOff",e=>{if(e.stopPropagation(),e.preventDefault(),clearTimeout(T(c,dt)),!c.showNavOnHover)return;const n=e.currentTarget;F(c,tt,""),n.querySelector(".scene-preview").classList.remove("open")}),S(c,"updateScenePreview",async(e,n)=>{var d,u,g,m;if(!c.sceneNavEnabled||!e||!n)return;const t=game.scenes.get(n);if(!t)return;const o=e.querySelector(".scene-preview");if(!o)return;const s=o.classList.contains("open");f.log("Scene data for preview",[n,(u=(d=t.environment)==null?void 0:d.globalLight)==null?void 0:u.enabled,t.tokenVision]);const a={id:t.id,name:t.name,thumb:t.thumb||null,environment:t.environment,tokenVision:t.tokenVision,isGM:(g=game.user)==null?void 0:g.isGM},r=await renderTemplate(`modules/${B}/templates/scene-nav-preview.hbs`,a);o.outerHTML=r;const l=e.querySelector(".scene-preview");s&&l&&l.classList.add("open"),c.sceneNavEnabled&&c.useScenePreview?(e.removeEventListener("mouseenter",c.onScenePreviewOn),e.removeEventListener("mouseleave",c.onScenePreviewOff),e.addEventListener("mouseenter",c.onScenePreviewOn),e.addEventListener("mouseleave",c.onScenePreviewOff),(m=game.user)!=null&&m.isGM&&c.addPreviewIconListeners(e,a)):(e.removeEventListener("mouseenter",c.onScenePreviewOn),e.removeEventListener("mouseleave",c.onScenePreviewOff))}),S(c,"addSceneListeners",e=>{if(!c.sceneNavEnabled)return;e=e[0]||e,e.querySelectorAll("li.scene").forEach(t=>{var o;if(t.classList.contains("folder"),t.querySelector(".scene-name").removeEventListener("click",c.onSelectScene),t.querySelector(".scene-name").removeEventListener("dblclick",c.onActivateScene),t.querySelector(".scene-name").addEventListener("click",c.onSelectScene),t.querySelector(".scene-name").addEventListener("dblclick",c.onActivateScene),c.useScenePreview){t.removeEventListener("mouseenter",c.onScenePreviewOn),t.removeEventListener("mouseleave",c.onScenePreviewOff),t.addEventListener("mouseenter",c.onScenePreviewOn),t.addEventListener("mouseleave",c.onScenePreviewOff);const s=t.dataset.sceneId,a=game.scenes.find(r=>r.id===s);(o=game.user)!=null&&o.isGM&&c.addPreviewIconListeners(t,a)}})}),S(c,"getSceneFromElement",e=>{const n=e.dataset.sceneId;return game.scenes.get(n)}),I(c,Wt,e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.closest("li.scene"),t=c.getSceneFromElement(n);game.scenes.preload(t.id,!0),f.log("Preloaded scene")}),S(c,"onSceneConfigClick",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.closest("li.scene");game.scenes.get(n.dataset.sceneId).sheet.render(!0)}),S(c,"onIlumClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const n=e.currentTarget.closest("li.scene");let t=c.getSceneFromElement(n);const o=t.environment.globalLight.enabled;await t.update({"environment.globalLight.enabled":!o}),t=game.scenes.get(t.id),f.log("Toggled global illumination",[!o,t.environment.globalLight.enabled]),await c.updateScenePreview(n,t.id)}),S(c,"onTokenVisionClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const n=e.currentTarget.closest("li.scene");let t=c.getSceneFromElement(n);const o=t.tokenVision;await t.update({tokenVision:!o}),t=game.scenes.get(t.id),f.log("Toggled token vision",[!o,t.tokenVision]),await c.updateScenePreview(n,t.id)}),S(c,"onGenerateThumbnailClick",async e=>{e.stopPropagation(),e.preventDefault(),c.preventRerender=!0;const n=e.currentTarget.closest("li.scene");let t=c.getSceneFromElement(n);await t.createThumbnail(),t=game.scenes.get(t.id),f.log("Generated thumbnail",[t.thumb?"Thumbnail created":"No thumbnail"]),await c.updateScenePreview(n,t.id)}),S(c,"addPreviewIconListeners",(e,n)=>{if(!e||!n||!game.scenes.get(n.id))return;const o=e.querySelector(".scene-preview");if(!o)return;const s=o.querySelector(".ilum");s&&(s.removeEventListener("click",c.onIlumClick),s.addEventListener("click",c.onIlumClick));const a=o.querySelector(".token-vision");a&&(a.removeEventListener("click",c.onTokenVisionClick),a.addEventListener("click",c.onTokenVisionClick));const r=o.querySelector(".preload");r&&(r.removeEventListener("click",T(c,Wt)),r.addEventListener("click",T(c,Wt)));const l=o.querySelector(".config");l&&(l.removeEventListener("click",c.onSceneConfigClick),l.addEventListener("click",c.onSceneConfigClick));const d=o.querySelector(".gen-thumb");d&&d.addEventListener("click",c.onGenerateThumbnailClick)}),S(c,"applySceneItemWidth",()=>{const e=v(),n=C.get(e.sceneItemWidth.tag)||150;w.addCSSVars("--scene-nav-item-width",`${n}px`)});let P=c;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function yo(i,e){var n=Object.keys(i);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(i);e&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(i,o).enumerable})),n.push.apply(n,t)}return n}function Ne(i){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yo(Object(n),!0).forEach(function(t){Cs(i,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):yo(Object(n)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})}return i}function tn(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tn=function(e){return typeof e}:tn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(i)}function Cs(i,e,n){return e in i?Object.defineProperty(i,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[e]=n,i}function ke(){return ke=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(i[t]=n[t])}return i},ke.apply(this,arguments)}function Ns(i,e){if(i==null)return{};var n={},t=Object.keys(i),o,s;for(s=0;s<t.length;s++)o=t[s],!(e.indexOf(o)>=0)&&(n[o]=i[o]);return n}function Ts(i,e){if(i==null)return{};var n=Ns(i,e),t,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);for(o=0;o<s.length;o++)t=s[o],!(e.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(i,t)&&(n[t]=i[t])}return n}var Ls="1.15.6";function we(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var Ie=we(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Yt=we(/Edge/i),bo=we(/firefox/i),kt=we(/safari/i)&&!we(/chrome/i)&&!we(/android/i),lo=we(/iP(ad|od|hone)/i),qo=we(/chrome/i)&&we(/android/i),Ho={capture:!1,passive:!1};function x(i,e,n){i.addEventListener(e,n,!Ie&&Ho)}function O(i,e,n){i.removeEventListener(e,n,!Ie&&Ho)}function ln(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch{return!1}return!1}}function Wo(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function Se(i,e,n,t){if(i){n=n||document;do{if(e!=null&&(e[0]===">"?i.parentNode===n&&ln(i,e):ln(i,e))||t&&i===n)return i;if(i===n)break}while(i=Wo(i))}return null}var vo=/\s+/g;function ce(i,e,n){if(i&&e)if(i.classList)i.classList[n?"add":"remove"](e);else{var t=(" "+i.className+" ").replace(vo," ").replace(" "+e+" "," ");i.className=(t+(n?" "+e:"")).replace(vo," ")}}function M(i,e,n){var t=i&&i.style;if(t){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(n=i.currentStyle),e===void 0?n:n[e];!(e in t)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),t[e]=n+(typeof n=="string"?"":"px")}}function ct(i,e){var n="";if(typeof i=="string")n=i;else do{var t=M(i,"transform");t&&t!=="none"&&(n=t+" "+n)}while(!e&&(i=i.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(n)}function Vo(i,e,n){if(i){var t=i.getElementsByTagName(e),o=0,s=t.length;if(n)for(;o<s;o++)n(t[o],o);return t}return[]}function Ce(){var i=document.scrollingElement;return i||document.documentElement}function K(i,e,n,t,o){if(!(!i.getBoundingClientRect&&i!==window)){var s,a,r,l,d,u,g;if(i!==window&&i.parentNode&&i!==Ce()?(s=i.getBoundingClientRect(),a=s.top,r=s.left,l=s.bottom,d=s.right,u=s.height,g=s.width):(a=0,r=0,l=window.innerHeight,d=window.innerWidth,u=window.innerHeight,g=window.innerWidth),(e||n)&&i!==window&&(o=o||i.parentNode,!Ie))do if(o&&o.getBoundingClientRect&&(M(o,"transform")!=="none"||n&&M(o,"position")!=="static")){var m=o.getBoundingClientRect();a-=m.top+parseInt(M(o,"border-top-width")),r-=m.left+parseInt(M(o,"border-left-width")),l=a+s.height,d=r+s.width;break}while(o=o.parentNode);if(t&&i!==window){var y=ct(o||i),E=y&&y.a,k=y&&y.d;y&&(a/=k,r/=E,g/=E,u/=k,l=a+u,d=r+g)}return{top:a,left:r,bottom:l,right:d,width:g,height:u}}}function Eo(i,e,n){for(var t=Ue(i,!0),o=K(i)[e];t;){var s=K(t)[n],a=void 0;if(a=o>=s,!a)return t;if(t===Ce())break;t=Ue(t,!1)}return!1}function ft(i,e,n,t){for(var o=0,s=0,a=i.children;s<a.length;){if(a[s].style.display!=="none"&&a[s]!==D.ghost&&(t||a[s]!==D.dragged)&&Se(a[s],n.draggable,i,!1)){if(o===e)return a[s];o++}s++}return null}function co(i,e){for(var n=i.lastElementChild;n&&(n===D.ghost||M(n,"display")==="none"||e&&!ln(n,e));)n=n.previousElementSibling;return n||null}function pe(i,e){var n=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==D.clone&&(!e||ln(i,e))&&n++;return n}function Co(i){var e=0,n=0,t=Ce();if(i)do{var o=ct(i),s=o.a,a=o.d;e+=i.scrollLeft*s,n+=i.scrollTop*a}while(i!==t&&(i=i.parentNode));return[e,n]}function ws(i,e){for(var n in i)if(i.hasOwnProperty(n)){for(var t in e)if(e.hasOwnProperty(t)&&e[t]===i[n][t])return Number(n)}return-1}function Ue(i,e){if(!i||!i.getBoundingClientRect)return Ce();var n=i,t=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=M(n);if(n.clientWidth<n.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Ce();if(t||e)return n;t=!0}}while(n=n.parentNode);return Ce()}function ks(i,e){if(i&&e)for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}function En(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var It;function jo(i,e){return function(){if(!It){var n=arguments,t=this;n.length===1?i.call(t,n[0]):i.apply(t,n),It=setTimeout(function(){It=void 0},e)}}}function Is(){clearTimeout(It),It=void 0}function $o(i,e,n){i.scrollLeft+=e,i.scrollTop+=n}function Yo(i){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):n?n(i).clone(!0)[0]:i.cloneNode(!0)}function Xo(i,e,n){var t={};return Array.from(i.children).forEach(function(o){var s,a,r,l;if(!(!Se(o,e.draggable,i,!1)||o.animated||o===n)){var d=K(o);t.left=Math.min((s=t.left)!==null&&s!==void 0?s:1/0,d.left),t.top=Math.min((a=t.top)!==null&&a!==void 0?a:1/0,d.top),t.right=Math.max((r=t.right)!==null&&r!==void 0?r:-1/0,d.right),t.bottom=Math.max((l=t.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}var ie="Sortable"+new Date().getTime();function Rs(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var t=[].slice.call(this.el.children);t.forEach(function(o){if(!(M(o,"display")==="none"||o===D.ghost)){i.push({target:o,rect:K(o)});var s=Ne({},i[i.length-1].rect);if(o.thisAnimationDuration){var a=ct(o,!0);a&&(s.top-=a.f,s.left-=a.e)}o.fromRect=s}})}},addAnimationState:function(t){i.push(t)},removeAnimationState:function(t){i.splice(ws(i,{target:t}),1)},animateAll:function(t){var o=this;if(!this.options.animation){clearTimeout(e),typeof t=="function"&&t();return}var s=!1,a=0;i.forEach(function(r){var l=0,d=r.target,u=d.fromRect,g=K(d),m=d.prevFromRect,y=d.prevToRect,E=r.rect,k=ct(d,!0);k&&(g.top-=k.f,g.left-=k.e),d.toRect=g,d.thisAnimationDuration&&En(m,g)&&!En(u,g)&&(E.top-g.top)/(E.left-g.left)===(u.top-g.top)/(u.left-g.left)&&(l=Ds(E,m,y,o.options)),En(g,u)||(d.prevFromRect=u,d.prevToRect=g,l||(l=o.options.animation),o.animate(d,E,g,l)),l&&(s=!0,a=Math.max(a,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(e),s?e=setTimeout(function(){typeof t=="function"&&t()},a):typeof t=="function"&&t(),i=[]},animate:function(t,o,s,a){if(a){M(t,"transition",""),M(t,"transform","");var r=ct(this.el),l=r&&r.a,d=r&&r.d,u=(o.left-s.left)/(l||1),g=(o.top-s.top)/(d||1);t.animatingX=!!u,t.animatingY=!!g,M(t,"transform","translate3d("+u+"px,"+g+"px,0)"),this.forRepaintDummy=Ms(t),M(t,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),M(t,"transform","translate3d(0,0,0)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){M(t,"transition",""),M(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},a)}}}}function Ms(i){return i.offsetWidth}function Ds(i,e,n,t){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*t.animation}var st=[],Cn={initializeByDefault:!0},Xt={mount:function(e){for(var n in Cn)Cn.hasOwnProperty(n)&&!(n in e)&&(e[n]=Cn[n]);st.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),st.push(e)},pluginEvent:function(e,n,t){var o=this;this.eventCanceled=!1,t.cancel=function(){o.eventCanceled=!0};var s=e+"Global";st.forEach(function(a){n[a.pluginName]&&(n[a.pluginName][s]&&n[a.pluginName][s](Ne({sortable:n},t)),n.options[a.pluginName]&&n[a.pluginName][e]&&n[a.pluginName][e](Ne({sortable:n},t)))})},initializePlugins:function(e,n,t,o){st.forEach(function(r){var l=r.pluginName;if(!(!e.options[l]&&!r.initializeByDefault)){var d=new r(e,n,e.options);d.sortable=e,d.options=e.options,e[l]=d,ke(t,d.defaults)}});for(var s in e.options)if(e.options.hasOwnProperty(s)){var a=this.modifyOption(e,s,e.options[s]);typeof a<"u"&&(e.options[s]=a)}},getEventProperties:function(e,n){var t={};return st.forEach(function(o){typeof o.eventProperties=="function"&&ke(t,o.eventProperties.call(n[o.pluginName],e))}),t},modifyOption:function(e,n,t){var o;return st.forEach(function(s){e[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[n]=="function"&&(o=s.optionListeners[n].call(e[s.pluginName],t))}),o}};function Ps(i){var e=i.sortable,n=i.rootEl,t=i.name,o=i.targetEl,s=i.cloneEl,a=i.toEl,r=i.fromEl,l=i.oldIndex,d=i.newIndex,u=i.oldDraggableIndex,g=i.newDraggableIndex,m=i.originalEvent,y=i.putSortable,E=i.extraEventProperties;if(e=e||n&&n[ie],!!e){var k,z=e.options,q="on"+t.charAt(0).toUpperCase()+t.substr(1);window.CustomEvent&&!Ie&&!Yt?k=new CustomEvent(t,{bubbles:!0,cancelable:!0}):(k=document.createEvent("Event"),k.initEvent(t,!0,!0)),k.to=a||n,k.from=r||n,k.item=o||n,k.clone=s,k.oldIndex=l,k.newIndex=d,k.oldDraggableIndex=u,k.newDraggableIndex=g,k.originalEvent=m,k.pullMode=y?y.lastPutMode:void 0;var V=Ne(Ne({},E),Xt.getEventProperties(t,e));for(var ee in V)k[ee]=V[ee];n&&n.dispatchEvent(k),z[q]&&z[q].call(e,k)}}var Gs=["evt"],se=function(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=t.evt,s=Ts(t,Gs);Xt.pluginEvent.bind(D)(e,n,Ne({dragEl:b,parentEl:j,ghostEl:G,rootEl:H,nextEl:Ye,lastDownEl:nn,cloneEl:W,cloneHidden:Fe,dragStarted:Tt,putSortable:_,activeSortable:D.active,originalEvent:o,oldIndex:rt,oldDraggableIndex:Rt,newIndex:de,newDraggableIndex:Pe,hideGhostForTarget:Qo,unhideGhostForTarget:_o,cloneNowHidden:function(){Fe=!0},cloneNowShown:function(){Fe=!1},dispatchSortableEvent:function(r){oe({sortable:n,name:r,originalEvent:o})}},s))};function oe(i){Ps(Ne({putSortable:_,cloneEl:W,targetEl:b,rootEl:H,oldIndex:rt,oldDraggableIndex:Rt,newIndex:de,newDraggableIndex:Pe},i))}var b,j,G,H,Ye,nn,W,Fe,rt,de,Rt,Pe,Kt,_,it=!1,cn=!1,dn=[],je,me,Nn,Tn,No,To,Tt,at,Mt,Dt=!1,Qt=!1,on,te,Ln=[],Vn=!1,un=[],bn=typeof document<"u",_t=lo,Lo=Yt||Ie?"cssFloat":"float",As=bn&&!qo&&!lo&&"draggable"in document.createElement("div"),Jo=function(){if(bn){if(Ie)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Zo=function(e,n){var t=M(e),o=parseInt(t.width)-parseInt(t.paddingLeft)-parseInt(t.paddingRight)-parseInt(t.borderLeftWidth)-parseInt(t.borderRightWidth),s=ft(e,0,n),a=ft(e,1,n),r=s&&M(s),l=a&&M(a),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+K(s).width,u=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+K(a).width;if(t.display==="flex")return t.flexDirection==="column"||t.flexDirection==="column-reverse"?"vertical":"horizontal";if(t.display==="grid")return t.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&r.float&&r.float!=="none"){var g=r.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===g)?"vertical":"horizontal"}return s&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=o&&t[Lo]==="none"||a&&t[Lo]==="none"&&d+u>o)?"vertical":"horizontal"},zs=function(e,n,t){var o=t?e.left:e.top,s=t?e.right:e.bottom,a=t?e.width:e.height,r=t?n.left:n.top,l=t?n.right:n.bottom,d=t?n.width:n.height;return o===r||s===l||o+a/2===r+d/2},Os=function(e,n){var t;return dn.some(function(o){var s=o[ie].options.emptyInsertThreshold;if(!(!s||co(o))){var a=K(o),r=e>=a.left-s&&e<=a.right+s,l=n>=a.top-s&&n<=a.bottom+s;if(r&&l)return t=o}}),t},Ko=function(e){function n(s,a){return function(r,l,d,u){var g=r.options.group.name&&l.options.group.name&&r.options.group.name===l.options.group.name;if(s==null&&(a||g))return!0;if(s==null||s===!1)return!1;if(a&&s==="clone")return s;if(typeof s=="function")return n(s(r,l,d,u),a)(r,l,d,u);var m=(a?r:l).options.group.name;return s===!0||typeof s=="string"&&s===m||s.join&&s.indexOf(m)>-1}}var t={},o=e.group;(!o||tn(o)!="object")&&(o={name:o}),t.name=o.name,t.checkPull=n(o.pull,!0),t.checkPut=n(o.put),t.revertClone=o.revertClone,e.group=t},Qo=function(){!Jo&&G&&M(G,"display","none")},_o=function(){!Jo&&G&&M(G,"display","")};bn&&!qo&&document.addEventListener("click",function(i){if(cn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),cn=!1,!1},!0);var $e=function(e){if(b){e=e.touches?e.touches[0]:e;var n=Os(e.clientX,e.clientY);if(n){var t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.target=t.rootEl=n,t.preventDefault=void 0,t.stopPropagation=void 0,n[ie]._onDragOver(t)}}},Fs=function(e){b&&b.parentNode[ie]._isOutsideThisEl(e.target)};function D(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=ke({},e),i[ie]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Zo(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,r){a.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:D.supportPointer!==!1&&"PointerEvent"in window&&(!kt||lo),emptyInsertThreshold:5};Xt.initializePlugins(this,i,n);for(var t in n)!(t in e)&&(e[t]=n[t]);Ko(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:As,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(i,"pointerdown",this._onTapStart):(x(i,"mousedown",this._onTapStart),x(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(i,"dragover",this),x(i,"dragenter",this)),dn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ke(this,Rs())}D.prototype={constructor:D,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(at=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,b):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,t=this.el,o=this.options,s=o.preventOnFilter,a=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(r||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,u=o.filter;if(js(t),!b&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||o.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&kt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Se(l,o.draggable,t,!1),!(l&&l.animated)&&nn!==l)){if(rt=pe(l),Rt=pe(l,o.draggable),typeof u=="function"){if(u.call(this,e,l,this)){oe({sortable:n,rootEl:d,name:"filter",targetEl:l,toEl:t,fromEl:t}),se("filter",n,{evt:e}),s&&e.preventDefault();return}}else if(u&&(u=u.split(",").some(function(g){if(g=Se(d,g.trim(),t,!1),g)return oe({sortable:n,rootEl:g,name:"filter",targetEl:l,fromEl:t,toEl:t}),se("filter",n,{evt:e}),!0}),u)){s&&e.preventDefault();return}o.handle&&!Se(d,o.handle,t,!1)||this._prepareDragStart(e,r,l)}}},_prepareDragStart:function(e,n,t){var o=this,s=o.el,a=o.options,r=s.ownerDocument,l;if(t&&!b&&t.parentNode===s){var d=K(t);if(H=s,b=t,j=b.parentNode,Ye=b.nextSibling,nn=t,Kt=a.group,D.dragged=b,je={target:b,clientX:(n||e).clientX,clientY:(n||e).clientY},No=je.clientX-d.left,To=je.clientY-d.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,b.style["will-change"]="all",l=function(){if(se("delayEnded",o,{evt:e}),D.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!bo&&o.nativeDraggable&&(b.draggable=!0),o._triggerDragStart(e,n),oe({sortable:o,name:"choose",originalEvent:e}),ce(b,a.chosenClass,!0)},a.ignore.split(",").forEach(function(u){Vo(b,u.trim(),wn)}),x(r,"dragover",$e),x(r,"mousemove",$e),x(r,"touchmove",$e),a.supportPointer?(x(r,"pointerup",o._onDrop),!this.nativeDraggable&&x(r,"pointercancel",o._onDrop)):(x(r,"mouseup",o._onDrop),x(r,"touchend",o._onDrop),x(r,"touchcancel",o._onDrop)),bo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),se("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Yt||Ie))){if(D.eventCanceled){this._onDrop();return}a.supportPointer?(x(r,"pointerup",o._disableDelayedDrag),x(r,"pointercancel",o._disableDelayedDrag)):(x(r,"mouseup",o._disableDelayedDrag),x(r,"touchend",o._disableDelayedDrag),x(r,"touchcancel",o._disableDelayedDrag)),x(r,"mousemove",o._delayedDragTouchMoveHandler),x(r,"touchmove",o._delayedDragTouchMoveHandler),a.supportPointer&&x(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){b&&wn(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._disableDelayedDrag),O(e,"touchend",this._disableDelayedDrag),O(e,"touchcancel",this._disableDelayedDrag),O(e,"pointerup",this._disableDelayedDrag),O(e,"pointercancel",this._disableDelayedDrag),O(e,"mousemove",this._delayedDragTouchMoveHandler),O(e,"touchmove",this._delayedDragTouchMoveHandler),O(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):n?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(b,"dragend",this),x(H,"dragstart",this._onDragStart));try{document.selection?sn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(it=!1,H&&b){se("dragStarted",this,{evt:n}),this.nativeDraggable&&x(document,"dragover",Fs);var t=this.options;!e&&ce(b,t.dragClass,!1),ce(b,t.ghostClass,!0),D.active=this,e&&this._appendGhost(),oe({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(me){this._lastX=me.clientX,this._lastY=me.clientY,Qo();for(var e=document.elementFromPoint(me.clientX,me.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(me.clientX,me.clientY),e!==n);)n=e;if(b.parentNode[ie]._isOutsideThisEl(e),n)do{if(n[ie]){var t=void 0;if(t=n[ie]._onDragOver({clientX:me.clientX,clientY:me.clientY,target:e,rootEl:n}),t&&!this.options.dragoverBubble)break}e=n}while(n=Wo(n));_o()}},_onTouchMove:function(e){if(je){var n=this.options,t=n.fallbackTolerance,o=n.fallbackOffset,s=e.touches?e.touches[0]:e,a=G&&ct(G,!0),r=G&&a&&a.a,l=G&&a&&a.d,d=_t&&te&&Co(te),u=(s.clientX-je.clientX+o.x)/(r||1)+(d?d[0]-Ln[0]:0)/(r||1),g=(s.clientY-je.clientY+o.y)/(l||1)+(d?d[1]-Ln[1]:0)/(l||1);if(!D.active&&!it){if(t&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<t)return;this._onDragStart(e,!0)}if(G){a?(a.e+=u-(Nn||0),a.f+=g-(Tn||0)):a={a:1,b:0,c:0,d:1,e:u,f:g};var m="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");M(G,"webkitTransform",m),M(G,"mozTransform",m),M(G,"msTransform",m),M(G,"transform",m),Nn=u,Tn=g,me=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!G){var e=this.options.fallbackOnBody?document.body:H,n=K(b,!0,_t,!0,e),t=this.options;if(_t){for(te=e;M(te,"position")==="static"&&M(te,"transform")==="none"&&te!==document;)te=te.parentNode;te!==document.body&&te!==document.documentElement?(te===document&&(te=Ce()),n.top+=te.scrollTop,n.left+=te.scrollLeft):te=Ce(),Ln=Co(te)}G=b.cloneNode(!0),ce(G,t.ghostClass,!1),ce(G,t.fallbackClass,!0),ce(G,t.dragClass,!0),M(G,"transition",""),M(G,"transform",""),M(G,"box-sizing","border-box"),M(G,"margin",0),M(G,"top",n.top),M(G,"left",n.left),M(G,"width",n.width),M(G,"height",n.height),M(G,"opacity","0.8"),M(G,"position",_t?"absolute":"fixed"),M(G,"zIndex","100000"),M(G,"pointerEvents","none"),D.ghost=G,e.appendChild(G),M(G,"transform-origin",No/parseInt(G.style.width)*100+"% "+To/parseInt(G.style.height)*100+"%")}},_onDragStart:function(e,n){var t=this,o=e.dataTransfer,s=t.options;if(se("dragStart",this,{evt:e}),D.eventCanceled){this._onDrop();return}se("setupClone",this),D.eventCanceled||(W=Yo(b),W.removeAttribute("id"),W.draggable=!1,W.style["will-change"]="",this._hideClone(),ce(W,this.options.chosenClass,!1),D.clone=W),t.cloneId=sn(function(){se("clone",t),!D.eventCanceled&&(t.options.removeCloneOnHide||H.insertBefore(W,b),t._hideClone(),oe({sortable:t,name:"clone"}))}),!n&&ce(b,s.dragClass,!0),n?(cn=!0,t._loopId=setInterval(t._emulateDragOver,50)):(O(document,"mouseup",t._onDrop),O(document,"touchend",t._onDrop),O(document,"touchcancel",t._onDrop),o&&(o.effectAllowed="move",s.setData&&s.setData.call(t,o,b)),x(document,"drop",t),M(b,"transform","translateZ(0)")),it=!0,t._dragStartId=sn(t._dragStarted.bind(t,n,e)),x(document,"selectstart",t),Tt=!0,window.getSelection().removeAllRanges(),kt&&M(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,t=e.target,o,s,a,r=this.options,l=r.group,d=D.active,u=Kt===l,g=r.sort,m=_||d,y,E=this,k=!1;if(Vn)return;function z(Ct,as){se(Ct,E,Ne({evt:e,isOwner:u,axis:y?"vertical":"horizontal",revert:a,dragRect:o,targetRect:s,canSort:g,fromSortable:m,target:t,completed:V,onMove:function(po,is){return en(H,n,b,o,po,K(po),e,is)},changed:ee},as))}function q(){z("dragOverAnimationCapture"),E.captureAnimationState(),E!==m&&m.captureAnimationState()}function V(Ct){return z("dragOverCompleted",{insertion:Ct}),Ct&&(u?d._hideClone():d._showClone(E),E!==m&&(ce(b,_?_.options.ghostClass:d.options.ghostClass,!1),ce(b,r.ghostClass,!0)),_!==E&&E!==D.active?_=E:E===D.active&&_&&(_=null),m===E&&(E._ignoreWhileAnimating=t),E.animateAll(function(){z("dragOverAnimationComplete"),E._ignoreWhileAnimating=null}),E!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(t===b&&!b.animated||t===n&&!t.animated)&&(at=null),!r.dragoverBubble&&!e.rootEl&&t!==document&&(b.parentNode[ie]._isOutsideThisEl(e.target),!Ct&&$e(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),k=!0}function ee(){de=pe(b),Pe=pe(b,r.draggable),oe({sortable:E,name:"change",toEl:n,newIndex:de,newDraggableIndex:Pe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),t=Se(t,r.draggable,n,!0),z("dragOver"),D.eventCanceled)return k;if(b.contains(e.target)||t.animated&&t.animatingX&&t.animatingY||E._ignoreWhileAnimating===t)return V(!1);if(cn=!1,d&&!r.disabled&&(u?g||(a=j!==H):_===this||(this.lastPutMode=Kt.checkPull(this,d,b,e))&&l.checkPut(this,d,b,e))){if(y=this._getDirection(e,t)==="vertical",o=K(b),z("dragOverValid"),D.eventCanceled)return k;if(a)return j=H,q(),this._hideClone(),z("revert"),D.eventCanceled||(Ye?H.insertBefore(b,Ye):H.appendChild(b)),V(!0);var re=co(n,r.draggable);if(!re||qs(e,y,this)&&!re.animated){if(re===b)return V(!1);if(re&&n===e.target&&(t=re),t&&(s=K(t)),en(H,n,b,o,t,s,e,!!t)!==!1)return q(),re&&re.nextSibling?n.insertBefore(b,re.nextSibling):n.appendChild(b),j=n,ee(),V(!0)}else if(re&&Bs(e,y,this)){var He=ft(n,0,r,!0);if(He===b)return V(!1);if(t=He,s=K(t),en(H,n,b,o,t,s,e,!1)!==!1)return q(),n.insertBefore(b,He),j=n,ee(),V(!0)}else if(t.parentNode===n){s=K(t);var ye=0,We,yt=b.parentNode!==n,le=!zs(b.animated&&b.toRect||o,t.animated&&t.toRect||s,y),bt=y?"top":"left",Re=Eo(t,"top","top")||Eo(b,"top","top"),vt=Re?Re.scrollTop:void 0;at!==t&&(We=s[bt],Dt=!1,Qt=!le&&r.invertSwap||yt),ye=Hs(e,t,s,y,le?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,Qt,at===t);var Te;if(ye!==0){var Ve=pe(b);do Ve-=ye,Te=j.children[Ve];while(Te&&(M(Te,"display")==="none"||Te===G))}if(ye===0||Te===t)return V(!1);at=t,Mt=ye;var Et=t.nextElementSibling,Me=!1;Me=ye===1;var Jt=en(H,n,b,o,t,s,e,Me);if(Jt!==!1)return(Jt===1||Jt===-1)&&(Me=Jt===1),Vn=!0,setTimeout(Us,30),q(),Me&&!Et?n.appendChild(b):t.parentNode.insertBefore(b,Me?Et:t),Re&&$o(Re,0,vt-Re.scrollTop),j=b.parentNode,We!==void 0&&!Qt&&(on=Math.abs(We-K(t)[bt])),ee(),V(!0)}if(n.contains(b))return V(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){O(document,"mousemove",this._onTouchMove),O(document,"touchmove",this._onTouchMove),O(document,"pointermove",this._onTouchMove),O(document,"dragover",$e),O(document,"mousemove",$e),O(document,"touchmove",$e)},_offUpEvents:function(){var e=this.el.ownerDocument;O(e,"mouseup",this._onDrop),O(e,"touchend",this._onDrop),O(e,"pointerup",this._onDrop),O(e,"pointercancel",this._onDrop),O(e,"touchcancel",this._onDrop),O(document,"selectstart",this)},_onDrop:function(e){var n=this.el,t=this.options;if(de=pe(b),Pe=pe(b,t.draggable),se("drop",this,{evt:e}),j=b&&b.parentNode,de=pe(b),Pe=pe(b,t.draggable),D.eventCanceled){this._nulling();return}it=!1,Qt=!1,Dt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),jn(this.cloneId),jn(this._dragStartId),this.nativeDraggable&&(O(document,"drop",this),O(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),kt&&M(document.body,"user-select",""),M(b,"transform",""),e&&(Tt&&(e.cancelable&&e.preventDefault(),!t.dropBubble&&e.stopPropagation()),G&&G.parentNode&&G.parentNode.removeChild(G),(H===j||_&&_.lastPutMode!=="clone")&&W&&W.parentNode&&W.parentNode.removeChild(W),b&&(this.nativeDraggable&&O(b,"dragend",this),wn(b),b.style["will-change"]="",Tt&&!it&&ce(b,_?_.options.ghostClass:this.options.ghostClass,!1),ce(b,this.options.chosenClass,!1),oe({sortable:this,name:"unchoose",toEl:j,newIndex:null,newDraggableIndex:null,originalEvent:e}),H!==j?(de>=0&&(oe({rootEl:j,name:"add",toEl:j,fromEl:H,originalEvent:e}),oe({sortable:this,name:"remove",toEl:j,originalEvent:e}),oe({rootEl:j,name:"sort",toEl:j,fromEl:H,originalEvent:e}),oe({sortable:this,name:"sort",toEl:j,originalEvent:e})),_&&_.save()):de!==rt&&de>=0&&(oe({sortable:this,name:"update",toEl:j,originalEvent:e}),oe({sortable:this,name:"sort",toEl:j,originalEvent:e})),D.active&&((de==null||de===-1)&&(de=rt,Pe=Rt),oe({sortable:this,name:"end",toEl:j,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){se("nulling",this),H=b=j=G=Ye=W=nn=Fe=je=me=Tt=de=Pe=rt=Rt=at=Mt=_=Kt=D.dragged=D.ghost=D.clone=D.active=null,un.forEach(function(e){e.checked=!0}),un.length=Nn=Tn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":b&&(this._onDragOver(e),xs(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,t=this.el.children,o=0,s=t.length,a=this.options;o<s;o++)n=t[o],Se(n,a.draggable,this.el,!1)&&e.push(n.getAttribute(a.dataIdAttr)||Vs(n));return e},sort:function(e,n){var t={},o=this.el;this.toArray().forEach(function(s,a){var r=o.children[a];Se(r,this.options.draggable,o,!1)&&(t[s]=r)},this),n&&this.captureAnimationState(),e.forEach(function(s){t[s]&&(o.removeChild(t[s]),o.appendChild(t[s]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return Se(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var t=this.options;if(n===void 0)return t[e];var o=Xt.modifyOption(this,e,n);typeof o<"u"?t[e]=o:t[e]=n,e==="group"&&Ko(t)},destroy:function(){se("destroy",this);var e=this.el;e[ie]=null,O(e,"mousedown",this._onTapStart),O(e,"touchstart",this._onTapStart),O(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(O(e,"dragover",this),O(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),dn.splice(dn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Fe){if(se("hideClone",this),D.eventCanceled)return;M(W,"display","none"),this.options.removeCloneOnHide&&W.parentNode&&W.parentNode.removeChild(W),Fe=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Fe){if(se("showClone",this),D.eventCanceled)return;b.parentNode==H&&!this.options.group.revertClone?H.insertBefore(W,b):Ye?H.insertBefore(W,Ye):H.appendChild(W),this.options.group.revertClone&&this.animate(b,W),M(W,"display",""),Fe=!1}}};function xs(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function en(i,e,n,t,o,s,a,r){var l,d=i[ie],u=d.options.onMove,g;return window.CustomEvent&&!Ie&&!Yt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=i,l.dragged=n,l.draggedRect=t,l.related=o||e,l.relatedRect=s||K(e),l.willInsertAfter=r,l.originalEvent=a,i.dispatchEvent(l),u&&(g=u.call(d,l,a)),g}function wn(i){i.draggable=!1}function Us(){Vn=!1}function Bs(i,e,n){var t=K(ft(n.el,0,n.options,!0)),o=Xo(n.el,n.options,G),s=10;return e?i.clientX<o.left-s||i.clientY<t.top&&i.clientX<t.right:i.clientY<o.top-s||i.clientY<t.bottom&&i.clientX<t.left}function qs(i,e,n){var t=K(co(n.el,n.options.draggable)),o=Xo(n.el,n.options,G),s=10;return e?i.clientX>o.right+s||i.clientY>t.bottom&&i.clientX>t.left:i.clientY>o.bottom+s||i.clientX>t.right&&i.clientY>t.top}function Hs(i,e,n,t,o,s,a,r){var l=t?i.clientY:i.clientX,d=t?n.height:n.width,u=t?n.top:n.left,g=t?n.bottom:n.right,m=!1;if(!a){if(r&&on<d*o){if(!Dt&&(Mt===1?l>u+d*s/2:l<g-d*s/2)&&(Dt=!0),Dt)m=!0;else if(Mt===1?l<u+on:l>g-on)return-Mt}else if(l>u+d*(1-o)/2&&l<g-d*(1-o)/2)return Ws(e)}return m=m||a,m&&(l<u+d*s/2||l>g-d*s/2)?l>u+d/2?1:-1:0}function Ws(i){return pe(b)<pe(i)?1:-1}function Vs(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,n=e.length,t=0;n--;)t+=e.charCodeAt(n);return t.toString(36)}function js(i){un.length=0;for(var e=i.getElementsByTagName("input"),n=e.length;n--;){var t=e[n];t.checked&&un.push(t)}}function sn(i){return setTimeout(i,0)}function jn(i){return clearTimeout(i)}bn&&x(document,"touchmove",function(i){(D.active||it)&&i.cancelable&&i.preventDefault()});D.utils={on:x,off:O,css:M,find:Vo,is:function(e,n){return!!Se(e,n,e,!1)},extend:ks,throttle:jo,closest:Se,toggleClass:ce,clone:Yo,index:pe,nextTick:sn,cancelNextTick:jn,detectDirection:Zo,getChild:ft,expando:ie};D.get=function(i){return i[ie]};D.mount=function(){for(var i=arguments.length,e=new Array(i),n=0;n<i;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(D.utils=Ne(Ne({},D.utils),t.utils)),Xt.mount(t)})};D.create=function(i,e){return new D(i,e)};D.version=Ls;var J=[],Lt,$n,Yn=!1,kn,In,gn,wt;function $s(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(n){var t=n.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):t.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var t=n.originalEvent;!this.options.dragOverBubble&&!t.rootEl&&this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?O(document,"dragover",this._handleAutoScroll):(O(document,"pointermove",this._handleFallbackAutoScroll),O(document,"touchmove",this._handleFallbackAutoScroll),O(document,"mousemove",this._handleFallbackAutoScroll)),wo(),an(),Is()},nulling:function(){gn=$n=Lt=Yn=wt=kn=In=null,J.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,t){var o=this,s=(n.touches?n.touches[0]:n).clientX,a=(n.touches?n.touches[0]:n).clientY,r=document.elementFromPoint(s,a);if(gn=n,t||this.options.forceAutoScrollFallback||Yt||Ie||kt){Rn(n,this.options,r,t);var l=Ue(r,!0);Yn&&(!wt||s!==kn||a!==In)&&(wt&&wo(),wt=setInterval(function(){var d=Ue(document.elementFromPoint(s,a),!0);d!==l&&(l=d,an()),Rn(n,o.options,d,t)},10),kn=s,In=a)}else{if(!this.options.bubbleScroll||Ue(r,!0)===Ce()){an();return}Rn(n,this.options,Ue(r,!1),!1)}}},ke(i,{pluginName:"scroll",initializeByDefault:!0})}function an(){J.forEach(function(i){clearInterval(i.pid)}),J=[]}function wo(){clearInterval(wt)}var Rn=jo(function(i,e,n,t){if(e.scroll){var o=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,a=e.scrollSensitivity,r=e.scrollSpeed,l=Ce(),d=!1,u;$n!==n&&($n=n,an(),Lt=e.scroll,u=e.scrollFn,Lt===!0&&(Lt=Ue(n,!0)));var g=0,m=Lt;do{var y=m,E=K(y),k=E.top,z=E.bottom,q=E.left,V=E.right,ee=E.width,re=E.height,He=void 0,ye=void 0,We=y.scrollWidth,yt=y.scrollHeight,le=M(y),bt=y.scrollLeft,Re=y.scrollTop;y===l?(He=ee<We&&(le.overflowX==="auto"||le.overflowX==="scroll"||le.overflowX==="visible"),ye=re<yt&&(le.overflowY==="auto"||le.overflowY==="scroll"||le.overflowY==="visible")):(He=ee<We&&(le.overflowX==="auto"||le.overflowX==="scroll"),ye=re<yt&&(le.overflowY==="auto"||le.overflowY==="scroll"));var vt=He&&(Math.abs(V-o)<=a&&bt+ee<We)-(Math.abs(q-o)<=a&&!!bt),Te=ye&&(Math.abs(z-s)<=a&&Re+re<yt)-(Math.abs(k-s)<=a&&!!Re);if(!J[g])for(var Ve=0;Ve<=g;Ve++)J[Ve]||(J[Ve]={});(J[g].vx!=vt||J[g].vy!=Te||J[g].el!==y)&&(J[g].el=y,J[g].vx=vt,J[g].vy=Te,clearInterval(J[g].pid),(vt!=0||Te!=0)&&(d=!0,J[g].pid=setInterval((function(){t&&this.layer===0&&D.active._onTouchMove(gn);var Et=J[this.layer].vy?J[this.layer].vy*r:0,Me=J[this.layer].vx?J[this.layer].vx*r:0;typeof u=="function"&&u.call(D.dragged.parentNode[ie],Me,Et,i,gn,J[this.layer].el)!=="continue"||$o(J[this.layer].el,Me,Et)}).bind({layer:g}),24))),g++}while(e.bubbleScroll&&m!==l&&(m=Ue(m,!1)));Yn=d}},30),es=function(e){var n=e.originalEvent,t=e.putSortable,o=e.dragEl,s=e.activeSortable,a=e.dispatchSortableEvent,r=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(n){var d=t||s;r();var u=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,g=document.elementFromPoint(u.clientX,u.clientY);l(),d&&!d.el.contains(g)&&(a("spill"),this.onSpill({dragEl:o,putSortable:t}))}};function uo(){}uo.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,t=e.putSortable;this.sortable.captureAnimationState(),t&&t.captureAnimationState();var o=ft(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(n,o):this.sortable.el.appendChild(n),this.sortable.animateAll(),t&&t.animateAll()},drop:es};ke(uo,{pluginName:"revertOnSpill"});function go(){}go.prototype={onSpill:function(e){var n=e.dragEl,t=e.putSortable,o=t||this.sortable;o.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),o.animateAll()},drop:es};ke(go,{pluginName:"removeOnSpill"});D.mount(new $s);D.mount(go,uo);const Mn="root";var nt,Z,Sn,Vt,Xn;const L=class L{static init(){if(L.noFolderView()||!ui.scenes)return;L.preloadTemplates(),game.user.getFlag(B,"activeSceneFoldersV1")||game.user.setFlag(B,"activeSceneFoldersV1",[]);const e=document.querySelector("#navigation #scene-list");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(t=>{t.remove()}),Hooks.on(U.RENDER_SCENE_DIRECTORY,(t,o)=>{var s;A(s=L,Vt,Xn).call(s)})}static addFolderButtons(e,n,t){if(f.log("addFolderButtons",[P.useSceneFolders,game.scenes.size,game.scenes.folders.size]),!P.useSceneFolders||P.isRipperSceneNavOn||P.isMonksSceneNavOn||game.user.isGM===!1||game.scenes.size<2||game.scenes.folders.size<1)return;const o=v();if(document.querySelector("#crlngn-folder-toggle"))return;const a=document.querySelector("#navigation"),r=a.querySelector("#scene-list"),l=document.createElement("div");l.dataset.tooltip=P.navShowSceneFolders?"Hide Scene Folders":"Show Scene Folders",l.dataset.tooltipDirection="DOWN",l.id="crlngn-folder-toggle",l.innerHTML="<i class='fa-solid icon'></i>",P.navShowSceneFolders?a.classList.add("with-folders"):a.classList.remove("with-folders"),l.addEventListener("click",d=>{var u;d.stopPropagation(),d.preventDefault(),P.setNavPosition(0),C.set(o.navShowSceneFolders.tag,!P.navShowSceneFolders),P.preventReposition=!0,(u=ui.nav)==null||u.render()}),a.insertBefore(l,r)}static toggleFolderLookup(e){const n=e.target.parentNode;e.stopPropagation(),e.preventDefault(),f.log("toggleFolderLookup",[e,n]),n.classList.contains("open")?n.classList.remove("open"):n.classList.add("open")}static buildTemplateData(e){var r,l;if(!e||!ui.scenes)return{};const n=ui.scenes.collection.folders;let t={},o=[],s=e.contents?[...e.contents]:[];s=s.filter(d=>d.permission>=2);let a="a";return f.log("buildFolderData A",[e.name,s]),e.id===Mn?(o=n.filter(d=>d.folder===null)||[],A(r=L,Vt,Xn).call(r),a=T(L,nt)):(o=e.children,a=e.sorting),o=L.sortFolderList(o,a),s=L.sortFolderScenes(s,a),s=s.map(d=>{var u,g;return{id:d.id,name:d.name,active:d.active,isView:((u=game.scenes.viewed)==null?void 0:u.id)===d.id,thumb:d.thumb||null,environment:d.environment,tokenVision:d.tokenVision,isGM:(g=game.user)==null?void 0:g.isGM,usePreview:P.useScenePreview}}),t={currentFolder:e,folders:o,scenes:s,useIcons:P.useSceneIcons,usePreview:P.useScenePreview,viewedSceneId:(l=game.scenes.viewed)==null?void 0:l.id},f.log("buildFolderData",[o,t]),t}static sortFolderList(e,n="a"){return e=e.map((t,o)=>t.folder?t.folder:t),f.log("sortFolderList",[n,e]),n==="a"?e.sort((t,o)=>t.name.toLowerCase().localeCompare(o.name.toLowerCase())):e.sort((t,o)=>t.sort-o.sort),e}static sortFolderScenes(e,n="a"){return n==="a"?e.sort((t,o)=>t.name.toLowerCase().localeCompare(o.name.toLowerCase())):e.sort((t,o)=>t.sort-o.sort),e}};nt=new WeakMap,Z=new WeakMap,Sn=new WeakMap,Vt=new WeakSet,Xn=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){F(L,nt,game.scenes.sortingMode);return}}catch(e){console.error("Error checking scene directory sort mode:",e)}F(L,nt,"a"),f.log("updateSortMode fallback",[T(gSceneNavFolders,nt)])},I(L,Vt),S(L,"selectedFolder",Mn),I(L,nt,"a"),I(L,Z,[]),S(L,"searchValue",""),S(L,"renderFolderList",async e=>{F(L,Z,game.user.getFlag(B,"activeSceneFoldersV1")||[]);let n;const t=ui.scenes.collection.folders,o=e?t.get(e.dataset.folderId):{name:"",id:Mn},s=L.buildTemplateData(o),a=await renderTemplate(`modules/${B}/templates/scene-nav-folders.hbs`,s);f.log("renderFolderList",[o,T(L,Z)]),e?n=e.parentNode:n=P.scenesList,n.insertAdjacentHTML("afterbegin",a);const r=n.querySelectorAll("li.crlngn-folder");L.addFolderListeners(r),P.placeNavButtons()}),S(L,"handleFolderLookup",async()=>{var a;const e=await renderTemplate(`modules/${B}/templates/scene-nav-lookup.hbs`,{}),n=document.querySelector("#crlngn-lookup-list");n&&n.remove();const t=document.querySelector("#crlngn-scene-lookup");t?t.insertAdjacentHTML("beforeend",e):(a=document.querySelector("#scene-list"))==null||a.insertAdjacentHTML("beforebegin",e);const o=t==null?void 0:t.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",L.onSearchInput),o.addEventListener("keydown",r=>{r.stopPropagation()});const s=t==null?void 0:t.querySelector(".scene-lookup-toggle");s&&s.addEventListener("click",L.toggleFolderLookup)}),S(L,"addFolderListeners",e=>{const n=ui.scenes.collection.folders;e&&e.forEach(t=>{t.querySelector(".folder-item").addEventListener("click",T(L,Sn));const o=t.dataset.folderId,s=n.get(o);T(L,Z).includes(o)&&(t.classList.add("crlngn-folder-active"),L.injectSubfolders(s,t))})}),I(L,Sn,async e=>{e.preventDefault(),e.stopPropagation();const n=e.currentTarget;n.offsetLeft,n.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const t=n.dataset.folderId||n.parentNode.dataset.folderId,o=ui.scenes.collection.folders,s=t?o.get(t):null;if(!s)return;await L.injectSubfolders(s,n.parentNode),P.addSceneListeners(n.parentNode),f.log("onNavFolderClick",[n,n.parentNode,n.parentNode.dataset]),n.classList.contains("crlngn-folder-active")||n.parentNode.classList.contains("crlngn-folder-active")?L.updateActiveFolders(t,!0):L.updateActiveFolders(t,!1)}),S(L,"injectSubfolders",async(e,n)=>{const t=L.buildTemplateData(e),o=await renderTemplate(`modules/${B}/templates/scene-nav-subfolders.hbs`,t),s=n.querySelector(".contents");s&&s.remove(),n.insertAdjacentHTML("beforeend",o);const a=n.querySelectorAll("li.crlngn-folder");L.addFolderListeners(a),P.addSceneListeners(n.querySelector(".contents"))}),S(L,"updateActiveFolders",async(e,n=!1)=>{const t=document.querySelector("#scene-list"),o=t==null?void 0:t.querySelector(`li.crlngn-folder[data-folder-id="${e}"]`),s=T(L,Z).indexOf(e);f.log("updateActiveFolders A",[s,e,game.user.getFlag(B,"activeSceneFoldersV1"),T(L,Z)]),n?(F(L,Z,T(L,Z).filter(a=>a!==e)),o.classList.remove("crlngn-folder-active")):T(L,Z).includes(e)||(o.parentNode.querySelectorAll("li.crlngn-folder").forEach(r=>{r!==o&&(F(L,Z,T(L,Z).filter(l=>l!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),T(L,Z).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(B,"activeSceneFoldersV1",T(L,Z)),f.log("updateActiveFolders B",[n,e,game.user.getFlag(B,"activeSceneFoldersV1"),T(L,Z)])}),S(L,"selectFolder",e=>L.getFolderById(e)||null),S(L,"noFolderView",()=>{var n;return!((n=game==null?void 0:game.user)==null?void 0:n.isGM)&&!P.navFoldersForPlayers||!P.useSceneFolders||!P.sceneNavEnabled}),S(L,"preloadTemplates",async()=>{const e=[`modules/${B}/templates/scene-nav-folders.hbs`,`modules/${B}/templates/scene-nav-subfolders.hbs`,`modules/${B}/templates/scene-nav-lookup.hbs`,`modules/${B}/templates/scene-nav-preview.hbs`];return await loadTemplates(e),!0}),S(L,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget,t=n.value;f.log("onSearchInput",[n.value]),L.searchValue=t,L.updateSearchResults(t)}),S(L,"updateSearchResults",e=>{var s,a;const n=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!n)return;if(n.innerHTML="",!e){n.classList.add("hidden");return}const t=((s=game.scenes)==null?void 0:s.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];t.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase()));let o=[];if(P.useSceneFolders&&(o=((a=game.scenes)==null?void 0:a.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[],o.sort((r,l)=>r.name.toLowerCase().localeCompare(l.name.toLowerCase())),o.forEach(r=>{const l=document.createElement("li");l.className="search-folder",l.dataset.folderId=r.id,l.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,l.addEventListener("click",L.onSelectSearchedFolder),n.appendChild(l)})),t.forEach(r=>{const l=document.createElement("li");l.className="search-scene",l.dataset.sceneId=r.id,l.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,l.addEventListener("dblclick",P.onActivateScene),l.addEventListener("click",P.onSelectScene),n.appendChild(l)}),o.length===0&&t.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",n.appendChild(r)}n.classList.remove("hidden")}),S(L,"onSelectSearchedFolder",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");P.navShowSceneFolders||o.click(),t&&L.activateFolder(t)}),S(L,"activateFolder",async e=>{const o=[...ui.scenes.collection.folders.get(e).ancestors];F(L,Z,[]);for(const s of o)T(L,Z).push(s.id);T(L,Z).push(e),await game.user.setFlag(B,"activeSceneFoldersV1",T(L,Z)),setTimeout(async()=>{P.preventReposition=!0,ui.nav.render()},200)});let Ge=L;var ge,ts,ns,os,Jn,ss;const Y=class Y{static init(){const e=v();f.log("SheetsUtil.init",[]),game.system.id==="dnd5e"&&(Y.themeStylesEnabled=C.get(e.applyThemeToSheets.tag),Y.horizontalSheetTabsEnabled=C.get(e.useHorizontalSheetTabs.tag),Hooks.on(U.RENDER_ACTOR_SHEET,A(Y,ge,ts)),Hooks.on(U.RENDER_COMPENDIUM_BROWSER,A(Y,ge,ns)))}static applyThemeToSheets(e){Y.themeStylesEnabled=e,e?document.body.classList.add("crlngn-sheets"):document.body.classList.remove("crlngn-sheets")}static applyHorizontalSheetTabs(e){var n,t;Y.horizontalSheetTabsEnabled=e,e?(document.body.classList.add("crlngn-sheet-tabs"),A(n=Y,ge,Jn).call(n)):(document.body.classList.remove("crlngn-sheet-tabs"),A(t=Y,ge,ss).call(t))}};ge=new WeakSet,ts=function(e,n,t){var s;n=n[0]||n,f.log(U.RENDER_ACTOR_SHEET,[e,n.querySelector(".sheet-body"),t]),(s=n.querySelector(".sheet-body .main-content"))==null||s.addEventListener("scroll",A(Y,ge,os));const o=n.querySelectorAll("nav.tabs > a.item");for(const a of o){const r=game.i18n.localize(a.getAttribute("aria-label"));a.setAttribute("data-label",r),a.removeAttribute("data-tooltip"),a.removeAttribute("data-tooltip-delay")}Y.applyThemeToSheets(Y.themeStylesEnabled),Y.applyHorizontalSheetTabs(Y.horizontalSheetTabsEnabled)},ns=function(e,n,t){f.log(U.RENDER_COMPENDIUM_BROWSER,[e,n,t]),Y.horizontalSheetTabsEnabled&&setTimeout(()=>{var o;A(o=Y,ge,Jn).call(o)},100)},os=function(e){const n=e.target.closest(".window-content"),t=n==null?void 0:n.querySelector(".ability-scores");t&&(e.target.scrollTop>30?t.classList.add("fadeout"):t.classList.remove("fadeout"))},Jn=function(){document.querySelectorAll(".dnd5e2.vertical-tabs nav.tabs").forEach(n=>{const t=n.parentElement;if(t.querySelector(".crlngn-tab-scroll-btn"))return;const o=document.createElement("div");o.className="crlngn-tab-scroll-wrapper";const s=document.createElement("button");s.className="crlngn-tab-scroll-btn crlngn-tab-scroll-prev",s.innerHTML='<i class="fas fa-caret-left"></i>',s.addEventListener("click",r=>{r.preventDefault(),n.scrollBy({left:-150,behavior:"smooth"})});const a=document.createElement("button");a.className="crlngn-tab-scroll-btn crlngn-tab-scroll-next",a.innerHTML='<i class="fas fa-caret-right"></i>',a.addEventListener("click",r=>{r.preventDefault(),n.scrollBy({left:150,behavior:"smooth"})}),t.insertBefore(o,n),o.appendChild(s),o.appendChild(n),o.appendChild(a)})},ss=function(){document.querySelectorAll(".crlngn-tab-scroll-wrapper").forEach(n=>{const t=n.querySelector("nav.tabs");t&&n.parentElement&&(n.parentElement.insertBefore(t,n),n.remove())})},I(Y,ge),S(Y,"themeStylesEnabled",!0),S(Y,"horizontalSheetTabsEnabled",!0);let Je=Y;var ut;const h=class h{static registerSettings(){const e=v();f.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async s=>{s[0];const a=s[1];f.log("Registering... ",[s,a.label,a.scope],!0);const r={name:a.label,hint:a.hint,default:a.default,type:a.propType,scope:a.scope,config:a.config,requiresReload:a.requiresReload||!1,onChange:l=>h.apply(a.tag,l)};(a.choices||a.options)&&(r.choices=a.choices||a.options),await game.settings.register(B,a.tag,r)}),game.keybindings.register(B,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{h.hideInterface()},restricted:!1}),Object.entries(Es()).forEach(async s=>{const a=s[1],r={name:a.tag,label:a.label,hint:a.hint,icon:a.icon,type:a.propType,restricted:a.restricted};await game.settings.registerMenu(B,a.tag,r)}),Hooks.on(U.RENDER_SCENE_CONTROLS,h.applyLeftControlsSettings),Hooks.on(U.RENDER_PLAYERS_LIST,h.applyPlayersListSettings),Hooks.on(U.RENDER_HOTBAR,()=>{h.firstLoad&&h.applyHotBarCollapse(),h.applyHotBarSettings()}),h.applyThemeSettings(),h.applyChatStyles(),e.customFontsMenu.fields.forEach(s=>{h.applyCustomFonts(e[s].tag)})}static applySettings(){var r;const e=v();if(f.log("registerSettings - test",[e],!0),Object.entries(e).forEach(async l=>{l[0];const d=l[1];h.get(d.tag)===void 0&&h.set(d.tag,d.default)}),h.applyDebugSettings(),h.applyBorderColors(),e.sceneNavMenu.fields.forEach(l=>{h.apply(e[l].tag)}),e.leftControlsMenu.fields.forEach(l=>{h.applyLeftControlsSettings(e[l].tag)}),h.applyUiScale(),h.applyCustomCSS(),h.applyModuleAdjustments(),Je.applyThemeToSheets(h.get(e.applyThemeToSheets.tag)),Je.applyHorizontalSheetTabs(h.get(e.useHorizontalSheetTabs.tag)),e.cameraDockMenu.fields.forEach(l=>{h.apply(e[l].tag)}),!((r=game.user)!=null&&r.isGM)&&h.get(e.enforceGMSettings.tag)){h.enforceGMSettings();const l=h.get(e.sceneNavEnabled.tag);P.sceneNavEnabled=l}}static get(e,n=B){if(!e)return null;let t=!1;if(n===B)t=game.settings.get(n,e);else{let s=game.settings.storage.get("client")[`${n}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${n}.${e}`)),t=s==null?void 0:s.value,f.log("GET Setting",[s,t])}return t}static set(e,n,t=B){if(!e)return!1;let o=game.settings.storage.get("client")[`${t}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),f.log("Setting",[e,o]);try{game.settings.set(t,e,n)}catch{f.log("Unable to change setting",[e,o])}return!0}static apply(e,n=void 0){var o,s,a,r,l,d,u;const t=v();if(n===void 0&&(n=h.get(e)),n!==void 0&&!h.firstLoad){const g=Object.keys(t).find(m=>t[m].tag===e);h.saveDefaultSettings(g,n)}switch(f.log("SettingsUtil.apply",[e,n,h.get(e)]),e){case t.disableUI.tag:h.reloadRequired=!h.firstLoad;break;case t.enableMacroLayout.tag:h.applyHotBarSettings();break;case t.collapseMacroBar.tag:h.applyHotBarCollapse();break;case t.autoHidePlayerList.tag:h.applyPlayersListSettings();break;case t.uiFontBody.tag:case t.uiFontTitles.tag:case t.journalFontBody.tag:case t.journalFontTitles.tag:h.applyCustomFonts(e,n);break;case t.controlsBottomBuffer.tag:case t.controlsIconSize.tag:case t.controlsAutoHide.tag:case t.hideFoundryLogo.tag:h.applyLeftControlsSettings(e,n);break;case t.enableFloatingDock.tag:ne.currSettings.enableFloatingDock=n;break;case t.dockHeight.tag:ne.currSettings.dockHeight=n,h.applyCameraHeight(n);break;case t.dockWidth.tag:ne.currSettings.dockWidth=n,h.applyCameraWidth(n);break;case t.dockPosX.tag:ne.currSettings.dockPosX=n,h.applyCameraPosX(n);break;case t.dockPosY.tag:ne.currSettings.dockPosY=n,h.applyCameraPosY(n);break;case t.defaultVideoWidth.tag:ne.currSettings.defaultVideoWidth=n,ne.applyVideoWidth(n);break;case t.dockResizeOnUserJoin.tag:ne.currSettings.dockResizeOnUserJoin=n,ne.applyDockResize(n);break;case t.chatBorderColor.tag:gt.chatBorderColor=h.get(t.chatBorderColor.tag),h.applyBorderColors(),h.reloadRequired=!h.firstLoad;break;case t.enableChatStyles.tag:gt.enableChatStyles=h.get(t.enableChatStyles.tag),h.applyChatStyles();break;case t.enforceDarkMode.tag:h.resetFoundryThemeSettings();break;case t.debugMode.tag:h.applyDebugSettings();break;case t.sceneNavEnabled.tag:P.sceneNavEnabled=n,n===!1&&((o=game.user)!=null&&o.isGM)&&h.set(t.useSceneFolders.tag,!1),P.applyButtonSettings(),h.reloadRequired=!h.firstLoad;break;case t.sceneItemWidth.tag:P.sceneItemWidth=n||100,P.applySceneItemWidth();break;case t.useSceneFolders.tag:P.useSceneFolders=n,n===!1&&h.set(t.navShowSceneFolders.tag,!1);break;case t.navShowSceneFolders.tag:P.navShowSceneFolders=n;break;case t.sceneClickToView.tag:P.sceneClickToView=n,(s=game.scenes)==null||s.directory.render();break;case t.useSceneIcons.tag:P.useSceneIcons=n,(a=ui.nav)==null||a.render(),(r=game.scenes)==null||r.directory.render();break;case t.useSceneBackButton.tag:P.useSceneBackButton=n,(l=ui.nav)==null||l.render();break;case t.useSceneLookup.tag:P.useSceneLookup=n,P.applyButtonSettings(),(d=ui.nav)==null||d.render();break;case t.useScenePreview.tag:P.useScenePreview=n,(u=ui.nav)==null||u.render();break;case t.sceneNavAlias.tag:P.sceneNavAlias=n;break;case t.navStartCollapsed.tag:P.navStartCollapsed=n;break;case t.openFolderOnSceneLoad.tag:P.openFolderOnSceneLoad=n;break;case t.showNavOnHover.tag:P.showNavOnHover=n;break;case t.sceneNavCollapsed.tag:P.isCollapsed=h.get(t.sceneNavCollapsed.tag);break;case t.sceneNavPos.tag:h.applySceneNavPos();break;case t.colorTheme.tag:h.applyThemeSettings();break;case t.customStyles.tag:h.applyCustomCSS();break;case t.adjustOtherModules.tag:h.applyModuleAdjustments();break;case t.otherModulesList.tag:h.applyOtherModulesList();break;case t.uiScale.tag:h.applyUiScale(n);break;case t.applyThemeToSheets.tag:Je.applyThemeToSheets(n);break;case t.useHorizontalSheetTabs.tag:Je.applyHorizontalSheetTabs(n);break;case t.enforceGMSettings.tag:n&&Object.entries(t).forEach(([g,m])=>{m.scope===N.client&&So[g]!==void 0&&h.saveDefaultSettings(g,h.get(m.tag))});break}h.reloadRequired&&(clearTimeout(h.reloadTimeout),h.reloadTimeout=setTimeout(()=>{w.showReloadDialog()},1e3))}static applyBorderColors(){const e=v(),n=h.get(e.chatBorderColor.tag),t=document.querySelector("body");n===ot.playerColor.name?(t.classList.add("player-chat-borders"),t.classList.remove("roll-chat-borders")):n===ot.rollType.name?(t.classList.add("roll-chat-borders"),t.classList.remove("player-chat-borders")):(t.classList.remove("player-chat-borders"),t.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=v(),n=h.get(e.enableChatStyles.tag),t=document.querySelector("body");f.log("applyChatStyles",[n,e]),n?t.classList.add("crlngn-chat"):t.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=v(),n=h.get(e.enableMacroLayout.tag),t=document.querySelector("#hotbar");!n&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){var t;const e=v();h.get(e.collapseMacroBar.tag)&&((t=ui.hotbar)==null||t.collapse())}static applyLeftControlsSettings(e,n){const t=v(),o=h.get(t.sceneNavEnabled.tag),s=document.querySelector("#ui-left"),a=document.querySelector("#ui-left #logo"),r=document.querySelector("body.crlngn-ui");if(document.querySelector("#crlngn-ui-vars"),!!r)switch(f.log("applyLeftControlsSettings",[e]),e){case t.controlsAutoHide.tag:h.get(t.controlsAutoHide.tag)?s.classList.add("auto-hide"):s.classList.remove("auto-hide");break;case t.hideFoundryLogo.tag:const d=window.getComputedStyle(r).getPropertyValue("--top-nav-height")||"0px",u=parseFloat(d)||0,g=h.get(t.hideFoundryLogo.tag);f.log("applyLeftControlsSettings",[e,u,d]),g===void 0||g===!0?(a.classList.remove("visible"),w.addCSSVars("--ui-top-padding",`${u}px`),document.querySelector("body").classList.remove("logo-visible")):(a.classList.add("visible"),o?(w.addCSSVars("--ui-top-padding",`${72+u}px`),document.querySelector("body").classList.add("logo-visible")):w.addCSSVars("--ui-top-padding","72px"));break;case t.controlsBottomBuffer.tag:h.applyControlsBuffer();break;case t.controlsIconSize.tag:h.applyControlIconSize();break}}static applyControlIconSize(){const e=v(),n=h.get(e.controlsIconSize.tag);document.querySelector("body");const t=Oe[n]?Oe[n].size:Oe.regular.size;function o(s){switch(s){case Oe.large.name:return"var(--font-size-18);";case Oe.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}f.log("applyControlIconSize",[t]),w.addCSSVars("--icon-font-size",o(n)),w.addCSSVars("--left-control-item-size",t),h.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyUiScale(e){var o,s,a,r,l,d;const n=v(),t=e||h.get(n.uiScale.tag);t===rn.regular.name?((o=document.querySelector("#interface"))==null||o.classList.add("scale-regular"),(s=document.querySelector("#interface"))==null||s.classList.remove("scale-large"),h.set(n.controlsIconSize.tag,t),w.addCSSVars("--macro-size","50px")):t===rn.large.name?((a=document.querySelector("#interface"))==null||a.classList.remove("scale-regular"),(r=document.querySelector("#interface"))==null||r.classList.add("scale-large"),h.set(n.controlsIconSize.tag,t),w.addCSSVars("--macro-size","54px")):((l=document.querySelector("#interface"))==null||l.classList.remove("scale-regular"),(d=document.querySelector("#interface"))==null||d.classList.remove("scale-large"),h.set(n.controlsIconSize.tag,t),w.addCSSVars("--macro-size","42px"))}static applyControlsBuffer(){const e=v(),n=h.get(e.controlsBottomBuffer.tag),t=isNaN(n)?e.controlsBottomBuffer.default:n;f.log("applyControlsBuffer",[t,n]),w.addCSSVars("--controls-bottom-buffer",`${t||0}px`)}static applyPlayersListSettings(){var n,t;const e=v();f.log("applyPlayersListSettings",[document.querySelector("#players"),h.get(e.autoHidePlayerList.tag)]),h.get(e.autoHidePlayerList.tag)?(n=document.querySelector("#players"))==null||n.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide"),lt.checkPlayersList()}static applySceneNavPos(e){const n=v();P.navPos=e||h.get(n.sceneNavPos.tag)}static applyCameraPosX(e){const n=v(),t=h.get(n.dockPosX.tag),o=e||t;ne.resetPositionAndSize({x:o})}static applyCameraPosY(e){const n=v(),t=h.get(n.dockPosY.tag),o=e||t;ne.resetPositionAndSize({y:o})}static applyCameraWidth(e){const n=v(),t=h.get(n.dockWidth.tag),o=e||t;ne.resetPositionAndSize({w:o})}static applyCameraHeight(e){const n=v(),t=h.get(n.dockHeight.tag),o=e||t;ne.resetPositionAndSize({h:o})}static applyCustomFonts(e,n){const t=v(),o=t.customFontsMenu.fields,s={};switch(f.log("applyCustomFonts",[e,n]),o.forEach(a=>{s[a]=h.get(t[a].tag)}),document.querySelector("body.crlngn-ui"),e){case t.uiFontBody.tag:w.addCSSVars("--crlngn-font-family",n||s.uiFontBody||t.uiFontBody.default.uiFont||"");break;case t.uiFontTitles.tag:w.addCSSVars("--crlngn-font-titles",n||s.uiFontTitles||t.uiFontTitles.default.uiTitles||"");break;case t.journalFontBody.tag:w.addCSSVars("--crlngn-font-journal-body",n||s.journalFontBody||s.journalFontBody||"");break;case t.journalFontTitles.tag:w.addCSSVars("--crlngn-font-journal-title",n||s.journalFontTitles||s.journalFontTitles||"");break}}static resetFoundryThemeSettings(){var a,r;const e=v(),n=w.isModuleOn("monks-player-settings"),t=w.isModuleOn("force-client-settings"),o=h.get(e.enforceDarkMode.tag);if(o&&n){(a=game.user)!=null&&a.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),h.set(e.enforceDarkMode.tag,!1));return}if(o&&t){(r=game.user)!=null&&r.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),h.set(e.enforceDarkMode.tag,!1));return}const s=game.settings.get("core","colorScheme");f.log("resetFoundryThemeSettings",["color scheme",s," / dark mode",o]),!s&&o&&game.settings.set("core","colorScheme","dark")}static enforceGMSettings(){f.log("enforceGMSettings - start",[]);const e=v();w.isModuleOn("monks-player-settings"),w.isModuleOn("force-client-settings");const n=h.get(e.enforceGMSettings.tag),t=h.get(e.defaultSettings.tag);if(!n||!t){f.log("enforceGMSettings - disabled",[n,t]);return}for(const o in t){const s=t[o];e[o]&&e[o].scope===N.client&&(h.set(e[o].tag,s),f.log("enforcedGMSettings - setting",[o,e[o].tag,s]))}}static saveDefaultSettings(e,n){var s,a;const t=v();if(!((s=game.user)!=null&&s.isGM)||e===t.defaultSettings.tag)return;const o={...h.get(t.defaultSettings.tag)||{}};So[e]!==void 0&&(o[e]=n),f.log("saveDefaultSettings",[e]),(a=game.user)!=null&&a.isGM&&h.set(t.defaultSettings.tag,o)}static applyDebugSettings(e){const n=v();f.debugOn=e||h.get(n.debugMode.tag)}};ut=new WeakMap,I(h,ut,!1),S(h,"firstLoad",!0),S(h,"reloadRequired",!1),S(h,"reloadTimeout",null),S(h,"applyThemeSettings",e=>{const n=v(),t=e||h.get(n.colorTheme.tag)||"",o=document.querySelector("body");f.log("applyThemeSettings",[e,t,h.get(n.colorTheme.tag)]),De.forEach(s=>{s.className&&o.classList.remove(s.className)}),t&&o.classList.add(t)}),S(h,"applyCustomCSS",e=>{const n=v(),t=e||h.get(n.customStyles.tag)||"";w.addCustomCSS(t)}),S(h,"applyModuleAdjustments",e=>{const n=v();(e||h.get(n.adjustOtherModules.tag)||!1)&&lt.addModuleClasses()}),S(h,"applyOtherModulesList",e=>{const n=v(),t=e||h.get(n.otherModulesList.tag);f.log("applyOtherModulesList",[t,t.split(",")]),t.split(",").length===0?h.set(n.adjustOtherModules.tag,!1):h.set(n.adjustOtherModules.tag,!0),lt.addModuleClasses()}),S(h,"hideInterface",()=>{f.log("hideInterface");const e=document.querySelector("#interface"),n=document.querySelector("#camera-views"),t=document.querySelector(".taskbar");T(h,ut)?(e&&e.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),F(h,ut,!1)):(e&&e.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),F(h,ut,!0))});let C=h;class fo{static init(){Hooks.on(U.RENDER_PLAYERS_LIST,fo.onRender)}static onRender(){const e=document.querySelector("aside#players"),n=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!n)return;const t=e.offsetHeight;w.addCSSVars("--players-list-height",t+"px"),n.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var xe,jt,$t;const X=class X{static init(){f.log("LeftControls - init",[]),Hooks.on(U.RENDER_SCENE_CONTROLS,X.initSceneControls),X.initSceneControls()}static resetLocalVars(){F(X,xe,document.querySelector("#ui-left #controls")),F(X,jt,document.querySelector("#ui-left"))}static initSceneControls(){f.log("initSceneControls",[]),X.resetLocalVars(),X.observeControlsWidth()}static observeControlsWidth(){if(f.log("observeControlsWidth",[]),!T(X,xe))return;let e;const n=(t,o)=>{e||(e=setTimeout(()=>{t(),e=null},o))};F(X,$t,new ResizeObserver(t=>{n(()=>X.updateCSSVars(),250)})),T(X,$t).observe(T(X,xe),{box:"border-box"}),X.updateCSSVars()}static updateCSSVars(){if(!T(X,xe))return;let e=parseInt(T(X,jt).offsetWidth),n=parseInt(T(X,xe).offsetWidth),t=-e+n;f.log("updateCSSVars",[n,e]),!isNaN(n)&&!isNaN(e)&&w.addCSSVars("--ui-controls-margin-left",t+"px")}};xe=new WeakMap,jt=new WeakMap,$t=new WeakMap,I(X,xe),I(X,jt),I(X,$t);let Zn=X;const Pt=class Pt{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version;if(f.log("getUpdateNewsUrl",[e]),e){const t=`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`;return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}else return""}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=v();C.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=v();try{const n=Pt.getUpdateNewsUrl();if(!n)return;const t=new AbortController,o=setTimeout(()=>t.abort(),1e4);try{const s=await C.get(e.lastUpdateId.tag),a=await Pt.getIdFromRawJson();if(f.log("checkForUpdates...",[a,s]),s===a)return;const r=await fetch(n,{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(o),!r.ok){f.warn("checkForUpdates | Failed to fetch update news",[r.status,r.statusText]);return}const l=await r.json();await this.displayUpdateNews(l),C.set(e.lastUpdateId.tag,l.id),f.log("checkForUpdates | SUCCESS",[l.id])}catch(s){clearTimeout(o),s.name==="AbortError"?f.warn("checkForUpdates | Request timed out",[s]):f.warn("checkForUpdates | Fetch error",[s.message])}}catch(n){f.warn("checkForUpdates | Unexpected error",[n])}}static async displayUpdateNews(e){try{const n=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;f.error("displayUpdateNews | Chat message created",[e]);const t=await ChatMessage.create({content:n,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});f.error("displayUpdateNews | Chat message created",[t,e])}catch(n){f.error("displayUpdateNews | Error creating chat message",[n])}}};S(Pt,"getIdFromRawJson",async()=>{const n=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/main/news/module-updates.json"),t=n.ok?await n.json():null;return t&&t.id||""});let Kn=Pt;class Ys{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,n){return f.log("CustomHandlebarsHelpers",[e,n,e==null?void 0:e.includes(n)]),e==null?void 0:e.includes(n)})}}var yn;const ze=class ze{static init(){Hooks.once(U.INIT,()=>{var s,a;const e=game.data.version,n=+"12.999";if(e>n){ze.isIncompatible=!0;return}document.querySelector("body").classList.add(B),(s=document.querySelector("#ui-middle"))==null||s.classList.add(B),document.querySelector("body").classList.add("crlngn-sheets"),f.log("Initiating module...",[],!0),C.registerSettings();const t=v(),o=C.get(t.disableUI.tag);if(f.log(U.INIT,[o]),o){document.querySelector("body").classList.remove(B),(a=document.querySelector("#ui-middle"))==null||a.classList.remove(B);return}P.init(),ne.init(),fo.init(),Zn.init(),gt.init(),Hooks.on(U.RENDER_CHAT_MESSAGE,T(ze,yn))}),Hooks.once(U.READY,()=>{if(f.log("Core Ready",[]),ze.isIncompatible){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion"));return}const e=v();C.applySettings();var n=C.get(e.debugMode.tag);n&&(CONFIG.debug.hooks=!0),Ys.init(),lt.init(),P.checkSceneNavCompat(),Kn.init(),Je.init(),C.get(e.enableChatStyles.tag)&&ze.addCSSLocalization(),C.resetFoundryThemeSettings(),C.applyOtherModulesList(),w.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),C.firstLoad=!1})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";w.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),w.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),w.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),w.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),w.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),w.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),w.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),w.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),w.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),w.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};yn=new WeakMap,S(ze,"isIncompatible",!1),I(ze,yn,(e,n)=>{f.log(U.RENDER_CHAT_MESSAGE,[e,n]),gt.enrichCard(e,n)});let Qn=ze;Qn.init();
//# sourceMappingURL=crlngn-ui.js.map
