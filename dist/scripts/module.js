var Ce=Object.defineProperty;var me=m=>{throw TypeError(m)};var be=(m,e,t)=>e in m?Ce(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var P=(m,e,t)=>be(m,typeof e!="symbol"?e+"":e,t),ne=(m,e,t)=>e.has(m)||me("Cannot "+t);var u=(m,e,t)=>(ne(m,e,"read from private field"),t?t.call(m):e.get(m)),f=(m,e,t)=>e.has(m)?me("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(m):e.set(m,t),b=(m,e,t,n)=>(ne(m,e,"write to private field"),n?n.call(m,t):e.set(m,t),t),C=(m,e,t)=>(ne(m,e,"access private method"),t);const y={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},U="crlngn-ui",Ee="crlngn-ui",J=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],N={select:"select",checkbox:"checkbox",text:"text",number:"number"},R={client:"client",world:"world"},Q={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}};function h(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),propType:Object,inputType:N.button,default:{uiFont:'"Work Sans", Arial, sans-serif',journalBodyFont:'"Roboto Condensed", Arial, sans-serif',journalTitleFont:'"Roboto Condensed", Arial, sans-serif'},scope:R.world,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:{iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox}},default:{iconSize:Q.small.name,autoHideSecondary:!1},scope:R.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:R.client,config:!1,requiresReload:!1},enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!1},sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavEnabled.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!0},showSceneNavOnHover:{tag:"show-scene-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.showSceneNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.showSceneNavOnHover.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:R.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:R.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:R.client,config:!0}}}const{ApplicationV2:Te,HandlebarsApplicationMixin:Le}=foundry.applications.api;var q,pe,fe;const w=class w extends Le(Te){static get DEFAULT_OPTIONS(){return{id:h().cameraDockMenu.tag,actions:{redefine:C(w,q,fe)},form:{handler:C(w,q,pe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=h(),n={...s.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=h(),o=s.get(n.cameraDockMenu.tag);c.log("_onRender",[e,t,o])}};q=new WeakSet,pe=async function(e,t,n){const o=h();let i=s.get(o.cameraDockMenu.tag),l=i.enableFloatingDock;e.preventDefault(),e.stopPropagation();const g=foundry.utils.expandObject(n.object);await s.set(o.cameraDockMenu.tag,g),i=s.get(o.cameraDockMenu.tag),c.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,g,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),i.enableFloatingDock!=l&&location.reload()},fe=async function(e,t){const n=h(),i=this.element.querySelectorAll("input, select"),l=n.cameraDockMenu.default;i.forEach(g=>{g.value=l[g.name],g.type==="checkbox"&&(g.checked=l[g.name])}),c.log("#onReset",[e,t,n.cameraDockMenu.default])},f(w,q),P(w,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let oe=w;const{ApplicationV2:Re,HandlebarsApplicationMixin:Ie}=foundry.applications.api;var B,he,Ne;const H=class H extends Ie(Re){static get DEFAULT_OPTIONS(){return{id:r.SETTINGS.customFontsMenu.tag,actions:{redefine:C(H,B,Ne)},form:{handler:C(H,B,he),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),contentClasses:["standard-form"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title")}_prepareContext(e){const t={...s.get(r.SETTINGS.customFontsMenu.tag),default:{...r.SETTINGS.customFontsMenu.default},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsDialog.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsDialog.save"}]};return c.log("_prepareContext",[t,e]),t}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};B=new WeakSet,he=async function(e,t,n){e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);c.log("Saving settings:",[o]),s.set(r.SETTINGS.customFontsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ne=async function(e,t){const o=this.element.querySelectorAll("input[type=text]"),i=r.SETTINGS.customFontsMenu.default;o.forEach(l=>{l.value=i[l.name]}),c.log("#onReset",[e,t,r.SETTINGS.customFontsMenu.default])},f(H,B),P(H,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ae=H;const{ApplicationV2:ve,HandlebarsApplicationMixin:ke}=foundry.applications.api;var W,Se,ye;const x=class x extends ke(ve){static get DEFAULT_OPTIONS(){return{id:h().leftControlsMenu.tag,actions:{redefine:C(x,W,ye)},form:{handler:C(x,W,Se),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=h(),n={...s.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=h(),o=s.get(n.leftControlsMenu.tag);c.log("_onRender",[e,t,o])}};W=new WeakSet,Se=async function(e,t,n){const o=h();e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await s.set(o.leftControlsMenu.tag,i);const l=s.get(o.leftControlsMenu.tag);c.log("Saving settings:",[o.leftControlsMenu.tag,t,n.object,i,l]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ye=async function(e,t){const n=h(),i=this.element.querySelectorAll("input, select"),l=n.leftControlsMenu.default;i.forEach(g=>{g.value=l[g.name],g.type==="checkbox"&&(g.checked=l[g.name])}),c.log("#onReset",[e,t,n.leftControlsMenu.default])},f(x,W),P(x,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let se=x;function Ge(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:ae,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:se,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:oe,restricted:!1}}}class ie{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}}var $,Y,j,V,X,K,Z,E,le,ce,re,ge;const a=class a{static init(){const e=h(),t=s.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(y.RENDER_CAMERA_VIEWS,a.onRenderFloating),c.log("CameraUtil",[t]),a.onRenderFloating()):(Hooks.on(y.RENDER_CAMERA_VIEWS,a.onRenderPlain),a.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var i,l,g;const e=h(),t=s.get(e.cameraDockMenu.tag);(i=document.querySelector("#camera-views"))==null||i.classList.add("crlngn-ui"),a.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");c.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),a.cameraContainer&&o&&n&&((l=a.cameraContainer)==null||l.insertBefore(n,o),(g=document.querySelector("#camera-views .camera-container"))==null||g.classList.add("visible")),a.makeDraggable(),a.makeResizeable(),a.resetPositionAndSize(),a.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(c.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=a.cameraContainer)==null||e.addEventListener("mousedown",t=>{var i,l;const n=document.querySelector("body.crlngn-ui");if(c.log("mousedown",[t.target]),(i=t.target.parentNode)!=null&&i.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",C(a,E,ce)),n==null||n.addEventListener("mouseup",C(a,E,le));const o=ie.getOffsetBottom(a.cameraContainer);a.isDragging=!0,b(a,$,t.clientX-((l=a.cameraContainer)==null?void 0:l.offsetLeft)),b(a,Y,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(a.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),a.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),a.isResizing=!0,b(a,j,n.clientX),b(a,V,n.clientY),b(a,Z,parseInt(getComputedStyle(a.cameraContainer).bottom)||0),b(a,X,a.cameraContainer.offsetWidth),b(a,K,a.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",C(a,E,re)),e==null||e.addEventListener("mouseup",C(a,E,ge))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const i=h(),l=s.get(i.cameraDockMenu.tag);if(!(!l.enableFloatingDock||!a.cameraContainer))if(!e&&!t&&!n&&!o){const g=l.dockPosX||0,S=l.dockPosY||0,p=l.dockWidth||0,T=l.dockHeight||0;a.cameraContainer.style.left=`${g}px`,a.cameraContainer.style.bottom=`${S}px`,a.cameraContainer.style.width=`${p}px`,a.cameraContainer.style.height=`${T}px`}else e&&(a.cameraContainer.style.left=`${e}px`),t&&(a.cameraContainer.style.bottom=`${t}px`),n&&(a.cameraContainer.style.width=`${n}px`),o&&(a.cameraContainer.style.height=`${o}px`)}};$=new WeakMap,Y=new WeakMap,j=new WeakMap,V=new WeakMap,X=new WeakMap,K=new WeakMap,Z=new WeakMap,E=new WeakSet,le=function(e){var o,i;const t=h(),n={...s.get(t.cameraDockMenu.tag)};if(a.isDragging){const l=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=a.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((i=a.cameraContainer)==null?void 0:i.style.bottom)||0,s.set(t.cameraDockMenu.tag,n),l==null||l.removeEventListener("mousemove",C(a,E,ce)),l==null||l.removeEventListener("mouseup",C(a,E,le)),a.isDragging=!1,e.stopPropagation()}},ce=function(e){if(a.isDragging&&(c.log("mousemove",[e.target.parentNode]),a.cameraContainer)){let t=e.clientX-u(a,$),n=window.innerHeight-e.clientY-u(a,Y);t+a.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-a.cameraContainer.offsetWidt),a.cameraContainer.style.left=`${t}px`,n+a.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-a.cameraContainer.offsetHeight),a.cameraContainer.style.bottom=`${n}px`}},re=function(e){if(!a.isResizing)return;const t=u(a,X)+(e.clientX-u(a,j)),n=e.clientY-u(a,V),o=u(a,K)+n,i=u(a,Z)-n;a.cameraContainer.style.width=`${t}px`,a.cameraContainer.style.height=`${o}px`,a.cameraContainer.style.bottom=`${i}px`},ge=function(){var o,i,l,g,S,p;const e=h(),t={...s.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");a.isResizing=!1,n==null||n.removeEventListener("mousemove",C(a,E,re)),n==null||n.removeEventListener("mouseup",C(a,E,ge)),c.log("onStopResize",[(o=a.cameraContainer)==null?void 0:o.style.width,(i=a.cameraContainer)==null?void 0:i.style.height,(l=a.cameraContainer)==null?void 0:l.style.bottom]),t.dockWidth=parseInt(((g=a.cameraContainer)==null?void 0:g.style.width)||0),t.dockHeight=parseInt(((S=a.cameraContainer)==null?void 0:S.style.height)||0),t.dockPosY=parseInt(((p=a.cameraContainer)==null?void 0:p.style.bottom)||0),s.set(r.SETTINGS.cameraDockMenu.tag,t)},f(a,E),f(a,$,0),f(a,Y,0),P(a,"isDragging",!1),P(a,"cameraContainer"),P(a,"isResizing",!1),f(a,j,0),f(a,V,0),f(a,X,0),f(a,K,0),f(a,Z,0);let D=a;class s{static registerSettings(){document.querySelector("body").classList.add(Ee),Object.entries(r.SETTINGS).forEach(async n=>{const o=n[1];c.log("Registering... ",[n]);const i={name:o.label,hint:o.hint,default:o.default,type:o.propType,scope:o.scope,config:o.config,requiresReload:o.requiresReload||!1,onChange:l=>s.apply(o.tag,l)};o.choices&&(i.choices=o.choices),await game.settings.register(U,o.tag,i),s.get(o.tag)===void 0&&s.set(o.tag,o.default),c.log("registerSettings",[o.tag,s.get(o.tag)])}),Object.entries(Ge()).forEach(async n=>{const o=n[1],i={name:o.tag,label:o.label,hint:o.hint,icon:o.icon,type:o.propType,restricted:o.restricted};await game.settings.registerMenu(U,o.tag,i)}),Hooks.on(y.RENDER_SCENE_CONTROLS,s.applyLeftControlsSettings),Hooks.on(y.RENDER_PLAYERS_LIST,s.applyPlayersListSettings),Hooks.on(y.RENDER_HOTBAR,()=>{s.applyHotBarSettings(),s.applyHotBarCollapse()}),s.applySceneNavSettings(),s.get(r.SETTINGS.enableChatStyles.tag)&&document.querySelector("body").classList.add("crlngn-chat"),s.applyCustomFonts(),s.applyLeftControlsSettings(),s.applyControlIconSize()}static get(e,t=U){if(!e)return null;let n=!1;if(t===U)n=game.settings.get(t,e);else{let i=game.settings.storage.get("client")[`${t}.${e}`];i===void 0&&(i=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=i==null?void 0:i.value,c.log("GET Setting",[i,n])}return n}static set(e,t,n=U){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),c.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{c.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){const n=h();switch(t===void 0&&(t=s.get(e)),c.log("SettingsUtil.apply",[e,t,s.get(e)]),e){case n.enableMacroLayout.tag:s.applyHotBarSettings();break;case n.collapseMacroBar.tag:s.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:s.applyPlayersListSettings();break;case n.customFontsMenu.tag:s.applyCustomFonts(t);case n.leftControlsMenu.tag:s.applyLeftControlsSettings(),s.applyControlIconSize();break;case n.cameraDockMenu.tag:s.applyCameraPosX(),s.applyCameraPosY(),s.applyCameraWidth(),s.applyCameraHeight();break}}static applySettings(){}static applyHotBarSettings(){const e=s.get(r.SETTINGS.enableMacroLayout.tag),t=document.querySelector("#hotbar");!e&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){s.get(r.SETTINGS.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=h(),t=s.get(e.leftControlsMenu.tag),n=document.querySelector("#ui-left");t.autoHideSecondary?n.classList.add("auto-hide"):n.classList.remove("auto-hide")}static applyControlIconSize(){const e=h(),t=s.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=t.iconSize==Q.small.name?Q.small.size:Q.regular.size;n.style.setProperty("--left-control-item-size",o)}static applyPlayersListSettings(){var e,t;c.log("applyPlayersListSettings",[document.querySelector("#players"),s.get(r.SETTINGS.autoHidePlayerList.tag)]),s.get(r.SETTINGS.autoHidePlayerList.tag)?(e=document.querySelector("#players"))==null||e.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide")}static applySceneNavSettings(){s.set(r.SETTINGS.sceneNavPos.tag,0)}static applyCameraPosX(e){const t=s.get(r.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosX;D.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=s.get(r.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosY;D.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=s.get(r.SETTINGS.cameraDockMenu.tag),n=e||t.dockWidth;D.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=s.get(r.SETTINGS.cameraDockMenu.tag),n=e||t.dockHeight;D.resetPositionAndSize({h:n})}static applyCustomFonts(){const e=s.get(r.SETTINGS.customFontsMenu.tag);if(c.log("applyCustomFonts",[e]),e){const t=document.querySelector("body.crlngn-ui");e.uiFont!==void 0&&t.style.setProperty("--crlngn-font-family",e.uiFont||""),e.journalBodyFont!==void 0&&t.style.setProperty("--crlngn-font-journal-body",e.journalBodyFont||""),e.journalTitleFont!==void 0&&t.style.setProperty("--crlngn-font-journal-title",e.journalTitleFont||"")}}}class c{static log(e="",t=[],n=!1){try{const o=s.get(r.SETTINGS.debugMode.tag);if(!(n||o))return;console.log(...J,e,...t)}catch{console.log(...J,e,...t)}}static warn(e="",t=[]){console.warn(...J,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...J,e)}}var L,v,z,A,O,_,ee;const d=class d{static init(){const e=document.querySelector("#ui-middle");if(s.get(r.SETTINGS.sceneNavEnabled.tag)&&e)e.classList.add("crlngn-ui");else if(e){e.classList.remove("crlngn-ui");return}d.addListeners(),c.log(y.RENDER_SCENE_NAV,[ui.nav,s.get(r.SETTINGS.sceneNavCollapsed.tag)]),d.setNavPosition(0),d.placeNavButtons(),s.get(r.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand(),Hooks.on(y.RENDER_SCENE_NAV,()=>{d.addListeners(),c.log(y.RENDER_SCENE_NAV,[ui.nav,s.get(r.SETTINGS.sceneNavCollapsed.tag)]),d.setNavPosition(),d.placeNavButtons(),s.get(r.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(y.COLLAPSE_SIDE_BAR,t=>{d.placeNavButtons()}),Hooks.on(y.COLLAPSE_SCENE_NAV,(t,n)=>{s.set(r.SETTINGS.sceneNavCollapsed.tag,n),c.log("NAV toggle",[t,n])}),Hooks.on(y.EXPAND_SCENE_NAV,(t,n)=>{s.set(r.SETTINGS.sceneNavCollapsed.tag,!1),c.log("NAV expand",[t,!1])}),s.apply(r.SETTINGS.sceneNavCollapsed.tag)}static addListeners(){var e,t;b(this,L,document.querySelector("#navigation")),b(this,v,document.querySelector("#scene-list")),b(this,A,document.querySelector("#navigation .nav-item.is-root")),b(this,O,document.querySelector("#nav-toggle")),(e=u(this,L))==null||e.addEventListener("mouseenter",()=>{if(!s.get(r.SETTINGS.sceneNavCollapsed.tag)||!s.get(r.SETTINGS.showSceneNavOnHover.tag))return;clearTimeout(u(this,z));const n=document.querySelector("#scene-list");n.style.display="flex",document.querySelector("#navigation").classList.remove("collapsed")}),(t=u(this,L))==null||t.addEventListener("mouseleave",o=>{if(!(!s.get(r.SETTINGS.sceneNavCollapsed.tag)||!s.get(r.SETTINGS.showSceneNavOnHover.tag))){if(!o)var o=window.event;o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),b(this,z,setTimeout(()=>{clearTimeout(u(this,z)),b(this,z,null);const i=document.querySelector("#scene-list");i.style.display="none",document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var g,S,p,T,k,G,M;const e=(g=u(this,L))==null?void 0:g.querySelectorAll("button.crlngn-nav"),t=((S=u(this,v))==null?void 0:S.scrollWidth)>=((p=u(this,L))==null?void 0:p.offsetWidth);if(c.log("placeNavButtons",[t,e,(T=u(this,v))==null?void 0:T.scrollWidth,(k=u(this,L))==null?void 0:k.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),n.addEventListener("click",u(this,_)),n.append(o);const i=document.createElement("button");i.classList.add("crlngn-nav"),i.classList.add("ui-nav-right");const l=document.createElement("i");l.classList.add("fa"),l.classList.add("fa-chevron-right"),i.append(l),i.addEventListener("click",u(this,ee)),(G=u(this,L))==null||G.appendChild(n),(M=u(this,L))==null||M.appendChild(i)}static setNavPosition(e){var i,l;const t=e!==void 0?e:s.get(r.SETTINGS.sceneNavPos.tag),n=((i=u(this,v))==null?void 0:i.querySelectorAll("li.nav-item"))||[],o=((l=n[t])==null?void 0:l.offsetLeft)*-1;u(this,v).style.marginLeft=o+"px",s.set(r.SETTINGS.sceneNavPos.tag,t),c.log("setNavPosition",[e,t,n[t],o])}};L=new WeakMap,v=new WeakMap,z=new WeakMap,A=new WeakMap,O=new WeakMap,_=new WeakMap,ee=new WeakMap,f(d,L),f(d,v),f(d,z),f(d,A),f(d,O),f(d,_,e=>{var T,k,G,M,F;const t=(T=u(d,O))==null?void 0:T.offsetWidth,n=ie.isModuleOn("compact-scene-navigation")?(k=u(d,A))==null?void 0:k.offsetWidth:0,o=(G=u(d,v))==null?void 0:G.querySelector("li.nav-item:not(.is-root)"),i=((M=u(d,v))==null?void 0:M.querySelectorAll("li.nav-item"))||[],l=o.offsetWidth,g=s.get(r.SETTINGS.sceneNavPos.tag)||0,S=Math.floor((((F=u(d,L))==null?void 0:F.offsetWidth)-(g===0?n:0)-t*2)/l);c.log("onNavLast",["currPos",g,S]);let p=g-S;p=p<0?0:p,c.log("onNavLast",["sceneCount",i.length,g,p]),d.setNavPosition(p)}),f(d,ee,e=>{var T,k,G,M,F;const t=(T=u(d,O))==null?void 0:T.offsetWidth,n=ie.isModuleOn("compact-scene-navigation")?(k=u(d,A))==null?void 0:k.offsetWidth:0,o=(G=u(d,v))==null?void 0:G.querySelector("li.nav-item:not(.is-root)"),i=((M=u(d,v))==null?void 0:M.querySelectorAll("li.nav-item:not(.is-root)"))||[],l=o.offsetWidth,g=s.get(r.SETTINGS.sceneNavPos.tag)||0,S=Math.floor((((F=u(d,L))==null?void 0:F.offsetWidth)-(g===0?n:0)-t*2)/l);c.log("onNavLast",["currPos",g,S]);let p=g+S;p=p>i.length?i.length:p,d.setNavPosition(p)});let ue=d;class Me{static enrichCard(e,t){var n,o,i,l,g,S;if(h(),s.get(r.SETTINGS.enableChatStyles.tag)){const p=((i=(o=(n=e.flags)==null?void 0:n.dnd5e)==null?void 0:o.activity)==null?void 0:i.type)||((S=(g=(l=e.flags)==null?void 0:l.dnd5e)==null?void 0:g.roll)==null?void 0:S.type)||"custom",T=t.get(0);T.classList.add("crlngn"),T.classList.add(p)}}}class de{static init(){Hooks.on(y.RENDER_PLAYERS_LIST,de.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var te;const I=class I{static init(){Hooks.once(y.INIT,()=>{var e;I.SETTINGS=h(),(e=document.querySelector("#ui-middle"))==null||e.classList.add("crlngn-ui"),c.log("Initiating module",[],!0),s.registerSettings(),Hooks.on(y.RENDER_CHAT_MESSAGE,u(I,te))}),Hooks.once(y.READY,()=>{var e=s.get("debug-mode");e&&(CONFIG.debug.hooks=!0);const t=loadTemplates(["modules/crlngn-ui/templates/custom-fonts-settings.hbs"]).then(n=>{c.log("Loaded template",[n])});c.log("Core Ready",[t]),ue.init(),D.init(),de.init()})}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;I.keysPressed.indexOf(t)<0&&I.keysPressed.push(t),c.log("Keydown",[I.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,n=I.keysPressed.indexOf(t);n>=0&&I.keysPressed.splice(n,1),c.log("Keyup",[I.keysPressed])})}};te=new WeakMap,P(I,"SETTINGS"),f(I,te,(e,t)=>{c.log(y.RENDER_CHAT_MESSAGE,[e,t]),Me.enrichCard(e,t)});let r=I;r.init();
//# sourceMappingURL=module.js.map
