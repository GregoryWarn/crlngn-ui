var qe=Object.defineProperty;var Pe=b=>{throw TypeError(b)};var Be=(b,e,t)=>e in b?qe(b,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[e]=t;var A=(b,e,t)=>Be(b,typeof e!="symbol"?e+"":e,t),Ne=(b,e,t)=>e.has(b)||Pe("Cannot "+t);var u=(b,e,t)=>(Ne(b,e,"read from private field"),t?t.call(b):e.get(b)),y=(b,e,t)=>e.has(b)?Pe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(b):e.set(b,t),L=(b,e,t,n)=>(Ne(b,e,"write to private field"),n?n.call(b,t):e.set(b,t),t),M=(b,e,t)=>(Ne(b,e,"access private method"),t);const R={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},F="crlngn-ui",ce=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],C={select:"select",checkbox:"checkbox",text:"text",number:"number"},D={client:"client",world:"world"},re={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}};function S(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:C.button,fields:{uiFont:{tag:"ui-font",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.hint"),inputType:C.text},uiTitles:{tag:"ui-titles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:C.text},journalBody:{tag:"journal-body",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:C.text},journalTitles:{tag:"journal-title",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:C.text}},default:{uiFont:'"Work Sans", Arial, sans-serif',uiTitles:'"Roboto Slab", Arial, sans-serif',journalBody:'"Work Sans", Arial, sans-serif',journalTitles:'"Roboto Condensed", Arial, sans-serif'},scope:D.world,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:C.button,fields:{bottomBuffer:{tag:"control-bottom-buffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),inputType:C.number},iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:C.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:C.checkbox},hideFoundryLogo:{tag:"hide-foundry-logo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:C.checkbox}},default:{bottomBuffer:200,iconSize:re.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:D.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:C.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:C.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:C.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:C.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:C.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:C.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:D.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:C.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:C.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:C.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:D.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:C.checkbox,default:!0,scope:D.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:C.number,default:0,scope:D.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.hint"),propType:Boolean,inputType:C.checkbox,default:!0,scope:D.client,config:!0,requiresReload:!0},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:C.checkbox,default:!0,scope:D.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:C.checkbox,default:!0,scope:D.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:C.checkbox,default:!0,scope:D.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:C.checkbox,default:!1,scope:D.client,config:!0}}}const{ApplicationV2:We,HandlebarsApplicationMixin:je}=foundry.applications.api;var X,we,ze;const W=class W extends je(We){static get DEFAULT_OPTIONS(){return{id:S().cameraDockMenu.tag,actions:{redefine:M(W,X,ze)},form:{handler:M(W,X,we),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=S(),n={...g.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t,controlSettings])}};X=new WeakSet,we=async function(e,t,n){const o=S();let s=g.get(o.cameraDockMenu.tag),l=s.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await g.set(o.cameraDockMenu.tag,i),s=g.get(o.cameraDockMenu.tag),c.log("Saving settings:",[o.cameraDockMenu.tag,t,n.object,i,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.enableFloatingDock!=l&&location.reload()},ze=async function(e,t){const n=S(),s=this.element.querySelectorAll("input, select"),l=n.cameraDockMenu.default;s.forEach(i=>{i.value=l[i.name],i.type==="checkbox"&&(i.checked=l[i.name])}),c.log("#onReset",[e,t,n.cameraDockMenu.default])},y(W,X),A(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let he=W;class U{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,o=e.offsetParent;return(o?o.clientHeight:window.innerHeight)-(t+n)}static getAllFonts(){var l;const e=new Set(Object.keys(CONFIG.fontDefinitions));c.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i);c.log("Custom fonts from settings:",[n]);const o=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){let m="";if(i.ownerNode.tagName==="STYLE")m=i.ownerNode.textContent;else if(i.ownerNode.tagName==="LINK")try{if((l=i.href)!=null&&l.startsWith(window.location.origin)){const p=i.cssRules||i.rules;m=Array.from(p).map(f=>f.cssText).join(`
`)}}catch(p){console.warn("Could not read stylesheet rules:",p)}c.log("Processing stylesheet text:",[m.slice(0,200)+"..."]);const N=/@import\s+url\(['"]([^'"]+)['"]\)/g;let E;for(;(E=N.exec(m))!==null;){const p=E[1];if(c.log("Found import URL:",p),p.includes("fonts.googleapis.com")){const f=p.match(/family=([^&]+)/);f&&decodeURIComponent(f[1]).split("|").map(P=>P.split(":")[0].replace(/\+/g," ")).forEach(P=>{o.add(P),c.log("Added Google Font family:",P)})}else try{fetch(p).then(f=>f.text()).then(f=>{(f.match(/@font-face\s*{[^}]+}/g)||[]).forEach(P=>{const ke=P.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(ke){const Ge=ke[1].trim();o.add(Ge),c.log("Added font family from @font-face:",Ge)}})}).catch(f=>console.warn("Error loading imported CSS:",f))}catch(f){console.warn("Error processing imported CSS:",f)}}}if(!i.href||i.href.startsWith(window.location.origin))try{const m=i.cssRules||i.rules;for(const N of m)if(N instanceof CSSFontFaceRule){const E=N.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();o.add(E),c.log("Found font-face rule for:",E)}}catch(m){console.warn("Could not read stylesheet rules:",m)}}catch(m){console.warn("Error processing stylesheet:",m)}return c.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(i=>!i.includes("FontAwesome")&&!i.includes("Font Awesome")).map(i=>i.replace(/['"`]/g,"").trim()).sort((i,m)=>i.toLowerCase().localeCompare(m.toLowerCase()))}}A(U,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:$e,HandlebarsApplicationMixin:Ve}=foundry.applications.api;var q,O,Ae,De,Ue;const w=class w extends Ve($e){static get DEFAULT_OPTIONS(){return{id:S().customFontsMenu.tag,actions:{redefine:M(w,O,Ue)},form:{handler:M(w,O,Ae),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=S(),n=g.get(t.customFontsMenu.tag),o={uiFont:n.uiFont||t.customFontsMenu.default.uiFont,uiTitles:n.uiTitles||t.customFontsMenu.default.uiTitles,journalBody:n.journalBody||n.journalBodyFont||t.customFontsMenu.default.journalBody,journalTitles:n.journalTitles||n.journalTitleFont||t.customFontsMenu.default.journalTitles,default:{...t.customFontsMenu.default},fontList:U.getAllFonts(),fields:{...t.customFontsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]};return c.log("_prepareContext",[o,e]),o}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){L(w,q,this.element),u(w,q).querySelectorAll('input[type="text"]').forEach(s=>{const l=s.closest(".dropdown-wrapper"),i=l==null?void 0:l.querySelector(".dropdown-options");if(!l||!i)return;const m=()=>{var N;M(N=w,O,De).call(N),i.classList.add("active")};s.addEventListener("focus",m),s.addEventListener("click",m),s.addEventListener("keydown",N=>{const E=i.classList.contains("active"),p=Array.from(i.querySelectorAll(".dropdown-option"));let f=p.findIndex(I=>I.classList.contains("highlighted"));N.key==="ArrowDown"||N.key==="ArrowUp"?(N.preventDefault(),E||i.classList.add("active"),p.forEach(I=>I.classList.remove("highlighted")),f===-1?f=N.key==="ArrowDown"?0:p.length-1:f=N.key==="ArrowDown"?(f+1)%p.length:(f-1+p.length)%p.length,p[f]&&(p[f].classList.add("highlighted"),p[f].scrollIntoView({block:"nearest"}))):N.key==="Enter"?(N.preventDefault(),E&&f!==-1&&p[f]&&p[f].click()):N.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",N=>{l.contains(N.target)||i.classList.remove("active")})}),u(w,q).querySelectorAll(".dropdown-option").forEach(s=>{s.addEventListener("mouseenter",()=>{s.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),s.classList.add("highlighted")}),s.addEventListener("click",l=>{const i=s.closest(".dropdown-wrapper").querySelector("input");let m=s.dataset.value;c.log("Option clicked:",[m,s.dataset]),m.includes(" ")&&!m.startsWith('"')?m=`"${m}"`:m.startsWith("&quot;")&&(m=m.replace(/&quot;/g,'"')),i.value=m,s.closest(".dropdown-options").classList.remove("active"),i.focus()})})}};q=new WeakMap,O=new WeakSet,Ae=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(n.object);c.log("Saving settings:",[s]),g.set(o.customFontsMenu.tag,s),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},De=function(){u(w,q).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},Ue=async function(e,t){const n=S(),s=this.element.querySelectorAll("input[type=text]"),l=n.customFontsMenu.default;s.forEach(i=>{i.value=l[i.name]}),c.log("#onReset",[e,t,n.customFontsMenu.default])},y(w,O),y(w,q),A(w,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ye=w;const{ApplicationV2:Ye,HandlebarsApplicationMixin:Xe}=foundry.applications.api;var K,xe,Oe;const j=class j extends Xe(Ye){static get DEFAULT_OPTIONS(){return{id:S().leftControlsMenu.tag,actions:{redefine:M(j,K,Oe)},form:{handler:M(j,K,xe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=S(),n={...g.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=S(),o=g.get(n.leftControlsMenu.tag);c.log("_onRender",[e,t,o])}};K=new WeakSet,xe=async function(e,t,n){const o=S();e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(n.object);(s.bottomBuffer===void 0||s.bottomBuffer==="")&&(s.bottomBuffer=o.leftControlsMenu.default.bottomBuffer);const l=g.get(o.leftControlsMenu.tag);l.hideFoundryLogo===void 0&&(s.hideFoundryLogo=o.leftControlsMenu.default.hideFoundryLogo),await g.set(o.leftControlsMenu.tag,s);const i=g.get(o.leftControlsMenu.tag);c.log("Saving settings:",[l,s,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oe=async function(e,t){const n=S(),s=this.element.querySelectorAll("input, select"),l=n.leftControlsMenu.default;s.forEach(i=>{i.value=l[i.name],i.type==="checkbox"&&(i.checked=l[i.name])}),c.log("#onReset",[e,t,n.leftControlsMenu.default])},y(j,K),A(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Se=j;const{ApplicationV2:Ke,HandlebarsApplicationMixin:Ze}=foundry.applications.api;var Z,Fe,He;const $=class $ extends Ze(Ke){static get DEFAULT_OPTIONS(){return{id:S().sceneNavMenu.tag,actions:{redefine:M($,Z,He)},form:{handler:M($,Z,Fe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=S(),n={...g.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};Z=new WeakSet,Fe=async function(e,t,n){const o=S();let s=g.get(o.sceneNavMenu.tag),l=s.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await g.set(o.sceneNavMenu.tag,i),s=g.get(o.sceneNavMenu.tag),c.log("Saving settings...",[o.sceneNavMenu.tag,t,n.object,i,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.sceneNavEnabled!=l&&location.reload()},He=async function(e,t){const n=S(),s=this.element.querySelectorAll("input, select"),l=n.sceneNavMenu.default;s.forEach(i=>{i.value=l[i.name],i.type==="checkbox"&&(i.checked=l[i.name])}),c.log("#onReset",[e,t,n.sceneNavMenu.default])},y($,Z),A($,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let be=$;function Je(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:ye,restricted:!0},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Se,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:he,restricted:!0},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:be,restricted:!1}}}var J,Q,_,ee,te,ne,oe,k,Ce,ve,Le,Ee;const a=class a{static init(){const e=S(),t=g.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(R.RENDER_CAMERA_VIEWS,a.onRenderFloating),c.log("CameraUtil",[t]),a.onRenderFloating()):(Hooks.on(R.RENDER_CAMERA_VIEWS,a.onRenderPlain),a.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var s,l,i;const e=S(),t=g.get(e.cameraDockMenu.tag);(s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-ui"),a.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),o=document.querySelector("#camera-views .camera-grid");c.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),a.cameraContainer&&o&&n&&((l=a.cameraContainer)==null||l.insertBefore(n,o),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),a.makeDraggable(),a.makeResizeable(),a.resetPositionAndSize(),a.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(c.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),o=document.createElement("button");o.classList.add("crlngn-video-toggle"),o.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(o,n)}static makeDraggable(){var e;(e=a.cameraContainer)==null||e.addEventListener("mousedown",t=>{var s,l;const n=document.querySelector("body.crlngn-ui");if(c.log("mousedown",[t.target]),(s=t.target.parentNode)!=null&&s.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",M(a,k,ve)),n==null||n.addEventListener("mouseup",M(a,k,Ce));const o=U.getOffsetBottom(a.cameraContainer);a.isDragging=!0,L(a,J,t.clientX-((l=a.cameraContainer)==null?void 0:l.offsetLeft)),L(a,Q,window.innerHeight-t.clientY-o),t.stopPropagation()})}static makeResizeable(){if(a.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),a.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),a.isResizing=!0,L(a,_,n.clientX),L(a,ee,n.clientY),L(a,oe,parseInt(getComputedStyle(a.cameraContainer).bottom)||0),L(a,te,a.cameraContainer.offsetWidth),L(a,ne,a.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",M(a,k,Le)),e==null||e.addEventListener("mouseup",M(a,k,Ee))})}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){const s=S(),l=g.get(s.cameraDockMenu.tag);if(!(!l.enableFloatingDock||!a.cameraContainer))if(!e&&!t&&!n&&!o){const i=l.dockPosX||0,m=l.dockPosY||0,N=l.dockWidth||0,E=l.dockHeight||0;a.cameraContainer.style.left=`${i}px`,a.cameraContainer.style.bottom=`${m}px`,a.cameraContainer.style.width=`${N}px`,a.cameraContainer.style.height=`${E}px`}else e&&(a.cameraContainer.style.left=`${e}px`),t&&(a.cameraContainer.style.bottom=`${t}px`),n&&(a.cameraContainer.style.width=`${n}px`),o&&(a.cameraContainer.style.height=`${o}px`)}};J=new WeakMap,Q=new WeakMap,_=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,oe=new WeakMap,k=new WeakSet,Ce=function(e){var o,s;const t=S(),n={...g.get(t.cameraDockMenu.tag)};if(a.isDragging){const l=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=a.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=a.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),g.set(t.cameraDockMenu.tag,n),l==null||l.removeEventListener("mousemove",M(a,k,ve)),l==null||l.removeEventListener("mouseup",M(a,k,Ce)),a.isDragging=!1,e.stopPropagation()}},ve=function(e){if(a.isDragging&&(c.log("mousemove",[e.target.parentNode]),a.cameraContainer)){let t=e.clientX-u(a,J),n=window.innerHeight-e.clientY-u(a,Q);t+a.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-a.cameraContainer.offsetWidt),a.cameraContainer.style.left=`${t}px`,n+a.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-a.cameraContainer.offsetHeight),a.cameraContainer.style.bottom=`${n}px`}},Le=function(e){if(!a.isResizing)return;const t=u(a,te)+(e.clientX-u(a,_)),n=e.clientY-u(a,ee),o=u(a,ne)+n,s=u(a,oe)-n;a.cameraContainer.style.width=`${t}px`,a.cameraContainer.style.height=`${o}px`,a.cameraContainer.style.bottom=`${s}px`},Ee=function(){var o,s,l,i,m,N;const e=S(),t={...g.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");a.isResizing=!1,n==null||n.removeEventListener("mousemove",M(a,k,Le)),n==null||n.removeEventListener("mouseup",M(a,k,Ee)),c.log("onStopResize",[(o=a.cameraContainer)==null?void 0:o.style.width,(s=a.cameraContainer)==null?void 0:s.style.height,(l=a.cameraContainer)==null?void 0:l.style.bottom]),t.dockWidth=parseInt(((i=a.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((m=a.cameraContainer)==null?void 0:m.style.height)||0),t.dockPosY=parseInt(((N=a.cameraContainer)==null?void 0:N.style.bottom)||0),g.set(h.SETTINGS.cameraDockMenu.tag,t)},y(a,k),y(a,J,0),y(a,Q,0),A(a,"isDragging",!1),A(a,"cameraContainer"),A(a,"isResizing",!1),y(a,_,0),y(a,ee,0),y(a,te,0),y(a,ne,0),y(a,oe,0);let H=a;const d=class d{static registerSettings(){document.querySelector("body").classList.add(F),Object.entries(h.SETTINGS).forEach(async n=>{const o=n[1];c.log("Registering... ",[n]);const s={name:o.label,hint:o.hint,default:o.default,type:o.propType,scope:o.scope,config:o.config,requiresReload:o.requiresReload||!1,onChange:l=>d.apply(o.tag,l)};o.choices&&(s.choices=o.choices),await game.settings.register(F,o.tag,s),d.get(o.tag)===void 0&&d.set(o.tag,o.default),c.log("registerSettings",[o.tag,d.get(o.tag)])}),Object.entries(Je()).forEach(async n=>{const o=n[1],s={name:o.tag,label:o.label,hint:o.hint,icon:o.icon,type:o.propType,restricted:o.restricted};await game.settings.registerMenu(F,o.tag,s)}),Hooks.on(R.RENDER_SCENE_CONTROLS,d.applyLeftControlsSettings),Hooks.on(R.RENDER_PLAYERS_LIST,d.applyPlayersListSettings),Hooks.on(R.RENDER_HOTBAR,()=>{d.firstLoad&&(d.firstLoad=!1,d.applyHotBarCollapse()),d.applyHotBarSettings()}),d.applySceneNavPos(),d.get(h.SETTINGS.enableChatStyles.tag)&&document.querySelector("body").classList.add("crlngn-chat"),d.applyCustomFonts(),d.applyLeftControlsSettings(),d.applyControlIconSize(),d.applyControlsBuffer()}static get(e,t=F){if(!e)return null;let n=!1;if(t===F)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,c.log("GET Setting",[s,n])}return n}static set(e,t,n=F){if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`];o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),c.log("Setting",[e,o]);try{game.settings.set(n,e,t)}catch{c.log("Unable to change setting",[e,o])}return!0}static apply(e,t=void 0){const n=S();switch(t===void 0&&(t=d.get(e)),c.log("SettingsUtil.apply",[e,t,d.get(e)]),e){case n.enableMacroLayout.tag:d.applyHotBarSettings();break;case n.collapseMacroBar.tag:d.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:d.applyPlayersListSettings();break;case n.customFontsMenu.tag:d.applyCustomFonts(t);case n.leftControlsMenu.tag:d.applyLeftControlsSettings(),d.applyControlIconSize(),d.applyControlsBuffer();break;case n.cameraDockMenu.tag:d.applyCameraPosX(),d.applyCameraPosY(),d.applyCameraWidth(),d.applyCameraHeight();break}}static applySettings(){}static applyHotBarSettings(){const e=d.get(h.SETTINGS.enableMacroLayout.tag),t=document.querySelector("#hotbar");!e&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){d.get(h.SETTINGS.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=S(),t=d.get(e.leftControlsMenu.tag),n=document.querySelector("#ui-left"),o=document.querySelector("#ui-left #logo");t.autoHideSecondary?n.classList.add("auto-hide"):n.classList.remove("auto-hide"),t.hideFoundryLogo===void 0||t.hideFoundryLogo===!0?o.classList.remove("visible"):o.classList.add("visible")}static applyControlIconSize(){const e=S(),t=d.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=t.iconSize==re.small.name?re.small.size:re.regular.size;n.style.setProperty("--left-control-item-size",o)}static applyControlsBuffer(){const e=S(),t=d.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),o=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;n.style.setProperty("--controls-bottom-buffer",`${o||0}px`)}static applyPlayersListSettings(){var e,t;c.log("applyPlayersListSettings",[document.querySelector("#players"),d.get(h.SETTINGS.autoHidePlayerList.tag)]),d.get(h.SETTINGS.autoHidePlayerList.tag)?(e=document.querySelector("#players"))==null||e.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide")}static applySceneNavPos(){d.set(h.SETTINGS.sceneNavPos.tag,0)}static applyCameraPosX(e){const t=d.get(h.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosX;H.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=d.get(h.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosY;H.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=d.get(h.SETTINGS.cameraDockMenu.tag),n=e||t.dockWidth;H.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=d.get(h.SETTINGS.cameraDockMenu.tag),n=e||t.dockHeight;H.resetPositionAndSize({h:n})}static applyCustomFonts(){const e=S(),t=d.get(e.customFontsMenu.tag);if(c.log("applyCustomFonts",[t]),t){const n=document.querySelector("body.crlngn-ui");n.style.setProperty("--crlngn-font-family",t.uiFont||e.customFontsMenu.default.uiFont||""),n.style.setProperty("--crlngn-font-titles",t.uiTitles||e.customFontsMenu.default.uiTitles||""),n.style.setProperty("--crlngn-font-journal-body",t.journalBody||t.journalBodyFont||e.customFontsMenu.default.journalBody||""),n.style.setProperty("--crlngn-font-journal-title",t.journalTitles||t.journalTitleFont||e.customFontsMenu.default.journalTitles||"")}}};A(d,"firstLoad",!0);let g=d;class c{static log(e="",t=[],n=!1){const o=S();try{const s=g.get(o.debugMode.tag);if(!(n||s))return;console.log(...ce,e,...t)}catch{console.log(...ce,e,...t)}}static warn(e="",t=[]){console.warn(...ce,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ce,e)}}var T,G,B,V,Y,se,ae,Me,ue,ge;const r=class r{static init(){const e=document.querySelector("#ui-middle");let t=g.get(h.SETTINGS.sceneNavMenu.tag);r.resetLocalVars();const n=U.isModuleOn("monks-scene-navigation");if(n&&t.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),e.classList.remove("crlngn-ui"),g.set(h.SETTINGS.sceneNavMenu.tag,{...t,sceneNavEnabled:!1})),t=g.get(h.SETTINGS.sceneNavMenu.tag),t.sceneNavEnabled&&e)e.classList.add("crlngn-ui");else if(e){e.classList.remove("crlngn-ui");return}c.log("TopNavigation - init",[n]),n||(r.resetLocalVars(),r.addListeners(),c.log(R.RENDER_SCENE_NAV,[ui.nav,g.get(h.SETTINGS.sceneNavCollapsed.tag)]),r.setNavPosition(0),r.placeNavButtons()),Hooks.on(R.RENDER_SCENE_NAV,()=>{const o=U.isModuleOn("monks-scene-navigation");c.log(R.RENDER_SCENE_NAV,[o]),o||(r.resetLocalVars(),c.log(R.RENDER_SCENE_NAV,[ui.nav,g.get(h.SETTINGS.sceneNavCollapsed.tag)]),r.placeNavButtons(),r.setNavPosition(),r.addListeners())}),Hooks.on(R.COLLAPSE_SIDE_BAR,o=>{const s=U.isModuleOn("monks-scene-navigation");c.log(R.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",s]),s||r.placeNavButtons()}),Hooks.on(R.COLLAPSE_SCENE_NAV,(o,s)=>{g.set(h.SETTINGS.sceneNavCollapsed.tag,s),c.log("NAV toggle",[o,s])}),Hooks.on(R.EXPAND_SCENE_NAV,(o,s)=>{g.set(h.SETTINGS.sceneNavCollapsed.tag,!1),c.log("NAV expand",[o,!1])}),g.apply(h.SETTINGS.sceneNavCollapsed.tag),window.addEventListener("resize",()=>{U.isModuleOn("monks-scene-navigation")||r.placeNavButtons()}),c.log("TopNavigation - init",[t.sceneNavEnabled]),t.sceneNavEnabled&&r.observeNavOffset()}static resetLocalVars(){L(r,T,document.querySelector("#navigation")),L(r,G,document.querySelector("#scene-list")),L(r,V,document.querySelector("#navigation .nav-item.is-root")),L(r,Y,document.querySelector("#nav-toggle")),L(r,se,document.querySelector("#ui-left #controls"))}static addListeners(){var e,t;(e=u(r,T))==null||e.addEventListener("mouseenter",()=>{const n=g.get(h.SETTINGS.sceneNavMenu.tag);if(!g.get(h.SETTINGS.sceneNavCollapsed.tag)||!(n!=null&&n.showNavOnHover))return;clearTimeout(u(this,B));const o=document.querySelector("#scene-list");o&&(o.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=u(this,T))==null||t.addEventListener("mouseleave",s=>{const o=g.get(h.SETTINGS.sceneNavMenu.tag);if(!(!g.get(h.SETTINGS.sceneNavCollapsed.tag)||!(o!=null&&o.showNavOnHover))){if(!s)var s=window.event;s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation(),L(this,B,setTimeout(()=>{clearTimeout(u(this,B)),L(this,B,null);const l=document.querySelector("#scene-list");l&&(l.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var i,m,N,E,p,f,I;r.resetLocalVars();const e=(i=u(this,T))==null?void 0:i.querySelectorAll("button.crlngn-nav"),t=((m=u(this,G))==null?void 0:m.scrollWidth)>=((N=u(this,T))==null?void 0:N.offsetWidth);if(c.log("placeNavButtons",[t,e,(E=u(this,G))==null?void 0:E.scrollWidth,(p=u(this,T))==null?void 0:p.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const o=document.createElement("i");o.classList.add("fa"),o.classList.add("fa-chevron-left"),n.addEventListener("click",u(this,ue)),n.append(o);const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-right");const l=document.createElement("i");l.classList.add("fa"),l.classList.add("fa-chevron-right"),s.append(l),s.addEventListener("click",u(this,ge)),(f=u(this,T))==null||f.appendChild(n),(I=u(this,T))==null||I.appendChild(s)}static setNavPosition(e){var s,l;if(!u(this,G))return;const t=e!==void 0?e:g.get(h.SETTINGS.sceneNavPos.tag),n=((s=u(this,G))==null?void 0:s.querySelectorAll("li.nav-item"))||[],o=((l=n[t])==null?void 0:l.offsetLeft)*-1;u(this,G).style.marginLeft=o+"px",g.set(h.SETTINGS.sceneNavPos.tag,t),c.log("setNavPosition",[e,t,n[t],o])}static observeNavOffset(){if(c.log("observeNavOffset A",[]),!u(r,T)||!u(r,se))return;const e=U.isModuleOn("monks-scene-navigation");c.log("observeNavOffset B",[]);function t(){if(L(r,T,document.querySelector("#navigation")),!u(r,T))return;const n=g.get(h.SETTINGS.sceneNavCollapsed.tag);n||u(r,T).offsetHeight;let o=e?0:u(r,T).offsetTop;const s=document.querySelector("body.crlngn-ui");s==null||s.style.setProperty("--crlngn-top-offset",o+"px"),c.log("TopNavigation updateCSSVars",[e,n,o,u(r,T).offsetTop,u(r,T).offsetHeight])}L(r,ae,new MutationObserver(t)),e||u(r,ae).observe(u(r,T).parentNode,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),t()}};T=new WeakMap,G=new WeakMap,B=new WeakMap,V=new WeakMap,Y=new WeakMap,se=new WeakMap,ae=new WeakMap,Me=new WeakMap,ue=new WeakMap,ge=new WeakMap,y(r,T),y(r,G),y(r,B),y(r,V),y(r,Y),y(r,se),y(r,ae),y(r,Me),y(r,ue,e=>{var E,p,f,I,P;const t=(E=u(r,Y))==null?void 0:E.offsetWidth,n=U.isModuleOn("compact-scene-navigation")?(p=u(r,V))==null?void 0:p.offsetWidth:0,o=(f=u(r,G))==null?void 0:f.querySelector("li.nav-item:not(.is-root)"),s=((I=u(r,G))==null?void 0:I.querySelectorAll("li.nav-item"))||[],l=o.offsetWidth,i=g.get(h.SETTINGS.sceneNavPos.tag)||0,m=Math.floor((((P=u(r,T))==null?void 0:P.offsetWidth)-(i===0?n:0)-t*2)/l);c.log("onNavLast",["currPos",i,m]);let N=i-m;N=N<0?0:N,c.log("onNavLast",["sceneCount",s.length,i,N]),r.setNavPosition(N)}),y(r,ge,e=>{var E,p,f,I,P;const t=(E=u(r,Y))==null?void 0:E.offsetWidth,n=U.isModuleOn("compact-scene-navigation")?(p=u(r,V))==null?void 0:p.offsetWidth:0,o=(f=u(r,G))==null?void 0:f.querySelector("li.nav-item:not(.is-root)"),s=((I=u(r,G))==null?void 0:I.querySelectorAll("li.nav-item:not(.is-root)"))||[],l=o.offsetWidth,i=g.get(h.SETTINGS.sceneNavPos.tag)||0,m=Math.floor((((P=u(r,T))==null?void 0:P.offsetWidth)-(i===0?n:0)-t*2)/l);c.log("onNavLast",["currPos",i,m]);let N=i+m;N=N>s.length?s.length:N,r.setNavPosition(N)});let Te=r;class Qe{static enrichCard(e,t){var o,s,l,i,m,N;const n=S();if(g.get(n.enableChatStyles.tag)){const E=((l=(s=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:s.activity)==null?void 0:l.type)||((N=(m=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:m.roll)==null?void 0:N.type)||"custom";let p=t.get?t.get(0):t;const f="CRLNGN_UI.dnd5e.chatCard.buttons";p.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${f}.attack`)),p.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${f}.damage`)),p.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${f}.summons`)),p.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${f}.healing`)),p.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${f}.template`)),p.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${f}.consume`)),p.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${f}.refund`)),p.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${f}.macro`)),p.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${f}.savedc`)),p.classList.add("crlngn"),p.classList.add(E)}}}class Ie{static init(){Hooks.on(R.RENDER_PLAYERS_LIST,Ie.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var de,x,fe,ie,le,me;const v=class v{static init(){c.log("LeftControls - init",[]),Hooks.on(R.RENDER_SCENE_CONTROLS,v.initSceneControls),v.initSceneControls()}static resetLocalVars(){L(v,de,document.querySelector("#ui-top #navigation")),L(v,x,document.querySelector("#ui-left #controls")),L(v,fe,document.querySelector("#ui-middle")),L(v,ie,document.querySelector("#ui-left"))}static initSceneControls(){c.log("initSceneControls",[]),v.resetLocalVars(),v.observeControlsWidth()}static observeControlsWidth(){c.log("observeControlsWidth",[]),u(v,x)&&(L(v,le,new ResizeObserver(e=>{v.updateCSSVars()},{box:"border-box"})),u(v,le).observe(u(v,x)),v.updateCSSVars())}static updateCSSVars(){if(!u(v,x))return;let e=Number(u(v,ie).offsetWidth),t=Number(u(v,x).offsetWidth),n=-e+t+24;if(c.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const o=document.querySelector("body.crlngn-ui");o==null||o.style.setProperty("--ui-controls-margin-left",n+"px")}L(v,me,t)}};de=new WeakMap,x=new WeakMap,fe=new WeakMap,ie=new WeakMap,le=new WeakMap,me=new WeakMap,y(v,de),y(v,x),y(v,fe),y(v,ie),y(v,le),y(v,me);let Re=v;var pe;const z=class z{static init(){Hooks.once(R.INIT,()=>{var e;z.SETTINGS=S(),(e=document.querySelector("#ui-middle"))==null||e.classList.add(F),c.log("Initiating module",[],!0),g.registerSettings(),Hooks.on(R.RENDER_CHAT_MESSAGE,u(z,pe))}),Hooks.once(R.READY,()=>{var e=g.get("debug-mode");e&&(CONFIG.debug.hooks=!0);const t=CONFIG.fontFamilies||[],n=g.get("fonts","core");c.log("Core Ready",[CONFIG,t,n]),Te.init(),H.init(),Ie.init(),Re.init(),c.log("GAME",[game.collections.find(o=>o.key=="Scene"),game.collections.get("Scene"),ui])})}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;z.keysPressed.indexOf(t)<0&&z.keysPressed.push(t),c.log("Keydown",[z.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,n=z.keysPressed.indexOf(t);n>=0&&z.keysPressed.splice(n,1),c.log("Keyup",[z.keysPressed])})}};pe=new WeakMap,A(z,"SETTINGS"),y(z,pe,(e,t)=>{c.log(R.RENDER_CHAT_MESSAGE,[e,t]),Qe.enrichCard(e,t)});let h=z;h.init();
//# sourceMappingURL=module.js.map
