var be=Object.defineProperty;var pe=p=>{throw TypeError(p)};var Ee=(p,e,t)=>e in p?be(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var G=(p,e,t)=>Ee(p,typeof e!="symbol"?e+"":e,t),ae=(p,e,t)=>e.has(p)||pe("Cannot "+t);var d=(p,e,t)=>(ae(p,e,"read from private field"),t?t.call(p):e.get(p)),S=(p,e,t)=>e.has(p)?pe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(p):e.set(p,t),E=(p,e,t,n)=>(ae(p,e,"write to private field"),n?n.call(p,t):e.set(p,t),t),b=(p,e,t)=>(ae(p,e,"access private method"),t);const C={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},$="crlngn-ui",Te="crlngn-ui",Q=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],N={select:"select",checkbox:"checkbox",text:"text",number:"number"},I={client:"client",world:"world"},_={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}};function h(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),propType:Object,inputType:N.button,default:{uiFont:'"Work Sans", Arial, sans-serif',journalBodyFont:'"Work Sans", Arial, sans-serif',journalTitleFont:'"Roboto Condensed", Arial, sans-serif'},scope:I.world,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:{iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox}},default:{iconSize:_.small.name,autoHideSecondary:!1},scope:I.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:I.client,config:!1,requiresReload:!1},enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!1},sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavEnabled.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!0},showSceneNavOnHover:{tag:"show-scene-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.showSceneNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.showSceneNavOnHover.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:I.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:I.client,config:!0}}}const{ApplicationV2:Le,HandlebarsApplicationMixin:Re}=foundry.applications.api;var q,fe,Se;const H=class H extends Re(Le){static get DEFAULT_OPTIONS(){return{id:h().cameraDockMenu.tag,actions:{redefine:b(H,q,Se)},form:{handler:b(H,q,fe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=h(),n={...r.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return l.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=h(),a=r.get(n.cameraDockMenu.tag);l.log("_onRender",[e,t,a])}};q=new WeakSet,fe=async function(e,t,n){const a=h();let s=r.get(a.cameraDockMenu.tag),i=s.enableFloatingDock;e.preventDefault(),e.stopPropagation();const u=foundry.utils.expandObject(n.object);await r.set(a.cameraDockMenu.tag,u),s=r.get(a.cameraDockMenu.tag),l.log("Saving settings:",[a.cameraDockMenu.tag,t,n.object,u,s]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),s.enableFloatingDock!=i&&location.reload()},Se=async function(e,t){const n=h(),s=this.element.querySelectorAll("input, select"),i=n.cameraDockMenu.default;s.forEach(u=>{u.value=i[u.name],u.type==="checkbox"&&(u.checked=i[u.name])}),l.log("#onReset",[e,t,n.cameraDockMenu.default])},S(H,q),G(H,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let oe=H;const{ApplicationV2:Ie,HandlebarsApplicationMixin:ve}=foundry.applications.api;var B,he,Ne;const x=class x extends ve(Ie){static get DEFAULT_OPTIONS(){return{id:g.SETTINGS.customFontsMenu.tag,actions:{redefine:b(x,B,Ne)},form:{handler:b(x,B,he),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),contentClasses:["standard-form"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title")}_prepareContext(e){const t={...r.get(g.SETTINGS.customFontsMenu.tag),default:{...g.SETTINGS.customFontsMenu.default},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsDialog.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsDialog.save"}]};return l.log("_prepareContext",[t,e]),t}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){l.log("_onRender",[e,t])}};B=new WeakSet,he=async function(e,t,n){e.preventDefault(),e.stopPropagation();const a=foundry.utils.expandObject(n.object);l.log("Saving settings:",[a]),r.set(g.SETTINGS.customFontsMenu.tag,a),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ne=async function(e,t){const a=this.element.querySelectorAll("input[type=text]"),s=g.SETTINGS.customFontsMenu.default;a.forEach(i=>{i.value=s[i.name]}),l.log("#onReset",[e,t,g.SETTINGS.customFontsMenu.default])},S(x,B),G(x,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let se=x;const{ApplicationV2:ke,HandlebarsApplicationMixin:Ge}=foundry.applications.api;var W,ye,Ce;const A=class A extends Ge(ke){static get DEFAULT_OPTIONS(){return{id:h().leftControlsMenu.tag,actions:{redefine:b(A,W,Ce)},form:{handler:b(A,W,ye),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=h(),n={...r.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return l.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=h(),a=r.get(n.leftControlsMenu.tag);l.log("_onRender",[e,t,a])}};W=new WeakSet,ye=async function(e,t,n){const a=h();e.preventDefault(),e.stopPropagation();const s=foundry.utils.expandObject(n.object);await r.set(a.leftControlsMenu.tag,s);const i=r.get(a.leftControlsMenu.tag);l.log("Saving settings:",[a.leftControlsMenu.tag,t,n.object,s,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Ce=async function(e,t){const n=h(),s=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;s.forEach(u=>{u.value=i[u.name],u.type==="checkbox"&&(u.checked=i[u.name])}),l.log("#onReset",[e,t,n.leftControlsMenu.default])},S(A,W),G(A,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ie=A;function Me(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsDialog.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:se,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:ie,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:oe,restricted:!1}}}class le{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,a=e.offsetParent;return(a?a.clientHeight:window.innerHeight)-(t+n)}}var Y,j,V,X,K,Z,J,T,ce,re,ge,ue;const o=class o{static init(){const e=h(),t=r.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(C.RENDER_CAMERA_VIEWS,o.onRenderFloating),l.log("CameraUtil",[t]),o.onRenderFloating()):(Hooks.on(C.RENDER_CAMERA_VIEWS,o.onRenderPlain),o.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var s,i,u;const e=h(),t=r.get(e.cameraDockMenu.tag);(s=document.querySelector("#camera-views"))==null||s.classList.add("crlngn-ui"),o.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),a=document.querySelector("#camera-views .camera-grid");l.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),o.cameraContainer&&a&&n&&((i=o.cameraContainer)==null||i.insertBefore(n,a),(u=document.querySelector("#camera-views .camera-container"))==null||u.classList.add("visible")),o.makeDraggable(),o.makeResizeable(),o.resetPositionAndSize(),o.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(l.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),a=document.createElement("button");a.classList.add("crlngn-video-toggle"),a.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(a,n)}static makeDraggable(){var e;(e=o.cameraContainer)==null||e.addEventListener("mousedown",t=>{var s,i;const n=document.querySelector("body.crlngn-ui");if(l.log("mousedown",[t.target]),(s=t.target.parentNode)!=null&&s.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",b(o,T,re)),n==null||n.addEventListener("mouseup",b(o,T,ce));const a=le.getOffsetBottom(o.cameraContainer);o.isDragging=!0,E(o,Y,t.clientX-((i=o.cameraContainer)==null?void 0:i.offsetLeft)),E(o,j,window.innerHeight-t.clientY-a),t.stopPropagation()})}static makeResizeable(){if(o.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),o.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),o.isResizing=!0,E(o,V,n.clientX),E(o,X,n.clientY),E(o,J,parseInt(getComputedStyle(o.cameraContainer).bottom)||0),E(o,K,o.cameraContainer.offsetWidth),E(o,Z,o.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",b(o,T,ge)),e==null||e.addEventListener("mouseup",b(o,T,ue))})}}static resetPositionAndSize({x:e,y:t,w:n,h:a}={x:null,y:null,w:null,h:null}){const s=h(),i=r.get(s.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!o.cameraContainer))if(!e&&!t&&!n&&!a){const u=i.dockPosX||0,y=i.dockPosY||0,f=i.dockWidth||0,L=i.dockHeight||0;o.cameraContainer.style.left=`${u}px`,o.cameraContainer.style.bottom=`${y}px`,o.cameraContainer.style.width=`${f}px`,o.cameraContainer.style.height=`${L}px`}else e&&(o.cameraContainer.style.left=`${e}px`),t&&(o.cameraContainer.style.bottom=`${t}px`),n&&(o.cameraContainer.style.width=`${n}px`),a&&(o.cameraContainer.style.height=`${a}px`)}};Y=new WeakMap,j=new WeakMap,V=new WeakMap,X=new WeakMap,K=new WeakMap,Z=new WeakMap,J=new WeakMap,T=new WeakSet,ce=function(e){var a,s;const t=h(),n={...r.get(t.cameraDockMenu.tag)};if(o.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=o.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=o.cameraContainer)==null?void 0:s.style.bottom)||0,r.set(t.cameraDockMenu.tag,n),i==null||i.removeEventListener("mousemove",b(o,T,re)),i==null||i.removeEventListener("mouseup",b(o,T,ce)),o.isDragging=!1,e.stopPropagation()}},re=function(e){if(o.isDragging&&(l.log("mousemove",[e.target.parentNode]),o.cameraContainer)){let t=e.clientX-d(o,Y),n=window.innerHeight-e.clientY-d(o,j);t+o.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-o.cameraContainer.offsetWidt),o.cameraContainer.style.left=`${t}px`,n+o.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-o.cameraContainer.offsetHeight),o.cameraContainer.style.bottom=`${n}px`}},ge=function(e){if(!o.isResizing)return;const t=d(o,K)+(e.clientX-d(o,V)),n=e.clientY-d(o,X),a=d(o,Z)+n,s=d(o,J)-n;o.cameraContainer.style.width=`${t}px`,o.cameraContainer.style.height=`${a}px`,o.cameraContainer.style.bottom=`${s}px`},ue=function(){var a,s,i,u,y,f;const e=h(),t={...r.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");o.isResizing=!1,n==null||n.removeEventListener("mousemove",b(o,T,ge)),n==null||n.removeEventListener("mouseup",b(o,T,ue)),l.log("onStopResize",[(a=o.cameraContainer)==null?void 0:a.style.width,(s=o.cameraContainer)==null?void 0:s.style.height,(i=o.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((u=o.cameraContainer)==null?void 0:u.style.width)||0),t.dockHeight=parseInt(((y=o.cameraContainer)==null?void 0:y.style.height)||0),t.dockPosY=parseInt(((f=o.cameraContainer)==null?void 0:f.style.bottom)||0),r.set(g.SETTINGS.cameraDockMenu.tag,t)},S(o,T),S(o,Y,0),S(o,j,0),G(o,"isDragging",!1),G(o,"cameraContainer"),G(o,"isResizing",!1),S(o,V,0),S(o,X,0),S(o,K,0),S(o,Z,0),S(o,J,0);let D=o;const c=class c{static registerSettings(){document.querySelector("body").classList.add(Te),Object.entries(g.SETTINGS).forEach(async n=>{const a=n[1];l.log("Registering... ",[n]);const s={name:a.label,hint:a.hint,default:a.default,type:a.propType,scope:a.scope,config:a.config,requiresReload:a.requiresReload||!1,onChange:i=>c.apply(a.tag,i)};a.choices&&(s.choices=a.choices),await game.settings.register($,a.tag,s),c.get(a.tag)===void 0&&c.set(a.tag,a.default),l.log("registerSettings",[a.tag,c.get(a.tag)])}),Object.entries(Me()).forEach(async n=>{const a=n[1],s={name:a.tag,label:a.label,hint:a.hint,icon:a.icon,type:a.propType,restricted:a.restricted};await game.settings.registerMenu($,a.tag,s)}),Hooks.on(C.RENDER_SCENE_CONTROLS,c.applyLeftControlsSettings),Hooks.on(C.RENDER_PLAYERS_LIST,c.applyPlayersListSettings),Hooks.on(C.RENDER_HOTBAR,()=>{c.firstLoad&&(c.firstLoad=!1,c.applyHotBarCollapse()),c.applyHotBarSettings()}),c.applySceneNavSettings(),c.get(g.SETTINGS.enableChatStyles.tag)&&document.querySelector("body").classList.add("crlngn-chat"),c.applyCustomFonts(),c.applyLeftControlsSettings(),c.applyControlIconSize()}static get(e,t=$){if(!e)return null;let n=!1;if(t===$)n=game.settings.get(t,e);else{let s=game.settings.storage.get("client")[`${t}.${e}`];s===void 0&&(s=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=s==null?void 0:s.value,l.log("GET Setting",[s,n])}return n}static set(e,t,n=$){if(!e)return!1;let a=game.settings.storage.get("client")[`${n}.${e}`];a||(a=game.settings.storage.get("world").getSetting(`${n}.${e}`)),l.log("Setting",[e,a]);try{game.settings.set(n,e,t)}catch{l.log("Unable to change setting",[e,a])}return!0}static apply(e,t=void 0){const n=h();switch(t===void 0&&(t=c.get(e)),l.log("SettingsUtil.apply",[e,t,c.get(e)]),e){case n.enableMacroLayout.tag:c.applyHotBarSettings();break;case n.collapseMacroBar.tag:c.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:c.applyPlayersListSettings();break;case n.customFontsMenu.tag:c.applyCustomFonts(t);case n.leftControlsMenu.tag:c.applyLeftControlsSettings(),c.applyControlIconSize();break;case n.cameraDockMenu.tag:c.applyCameraPosX(),c.applyCameraPosY(),c.applyCameraWidth(),c.applyCameraHeight();break}}static applySettings(){}static applyHotBarSettings(){const e=c.get(g.SETTINGS.enableMacroLayout.tag),t=document.querySelector("#hotbar");!e&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){c.get(g.SETTINGS.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=h(),t=c.get(e.leftControlsMenu.tag),n=document.querySelector("#ui-left");t.autoHideSecondary?n.classList.add("auto-hide"):n.classList.remove("auto-hide")}static applyControlIconSize(){const e=h(),t=c.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),a=t.iconSize==_.small.name?_.small.size:_.regular.size;n.style.setProperty("--left-control-item-size",a)}static applyPlayersListSettings(){var e,t;l.log("applyPlayersListSettings",[document.querySelector("#players"),c.get(g.SETTINGS.autoHidePlayerList.tag)]),c.get(g.SETTINGS.autoHidePlayerList.tag)?(e=document.querySelector("#players"))==null||e.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide")}static applySceneNavSettings(){c.set(g.SETTINGS.sceneNavPos.tag,0)}static applyCameraPosX(e){const t=c.get(g.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosX;D.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=c.get(g.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosY;D.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=c.get(g.SETTINGS.cameraDockMenu.tag),n=e||t.dockWidth;D.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=c.get(g.SETTINGS.cameraDockMenu.tag),n=e||t.dockHeight;D.resetPositionAndSize({h:n})}static applyCustomFonts(){const e=c.get(g.SETTINGS.customFontsMenu.tag);if(l.log("applyCustomFonts",[e]),e){const t=document.querySelector("body.crlngn-ui");e.uiFont!==void 0&&t.style.setProperty("--crlngn-font-family",e.uiFont||""),e.journalBodyFont!==void 0&&t.style.setProperty("--crlngn-font-journal-body",e.journalBodyFont||""),e.journalTitleFont!==void 0&&t.style.setProperty("--crlngn-font-journal-title",e.journalTitleFont||"")}}};G(c,"firstLoad",!0);let r=c;class l{static log(e="",t=[],n=!1){try{const a=r.get(g.SETTINGS.debugMode.tag);if(!(n||a))return;console.log(...Q,e,...t)}catch{console.log(...Q,e,...t)}}static warn(e="",t=[]){console.warn(...Q,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...Q,e)}}var R,k,w,U,O,ee,te;const m=class m{static init(){const e=document.querySelector("#ui-middle");if(r.get(g.SETTINGS.sceneNavEnabled.tag)&&e)e.classList.add("crlngn-ui");else if(e){e.classList.remove("crlngn-ui");return}m.addListeners(),l.log(C.RENDER_SCENE_NAV,[ui.nav,r.get(g.SETTINGS.sceneNavCollapsed.tag)]),m.setNavPosition(0),m.placeNavButtons(),r.get(g.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand(),Hooks.on(C.RENDER_SCENE_NAV,()=>{m.addListeners(),l.log(C.RENDER_SCENE_NAV,[ui.nav,r.get(g.SETTINGS.sceneNavCollapsed.tag)]),m.setNavPosition(),m.placeNavButtons(),r.get(g.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(C.COLLAPSE_SIDE_BAR,t=>{m.placeNavButtons()}),Hooks.on(C.COLLAPSE_SCENE_NAV,(t,n)=>{r.set(g.SETTINGS.sceneNavCollapsed.tag,n),l.log("NAV toggle",[t,n])}),Hooks.on(C.EXPAND_SCENE_NAV,(t,n)=>{r.set(g.SETTINGS.sceneNavCollapsed.tag,!1),l.log("NAV expand",[t,!1])}),r.apply(g.SETTINGS.sceneNavCollapsed.tag),window.addEventListener("resize",()=>{m.placeNavButtons()})}static addListeners(){var e,t;E(this,R,document.querySelector("#navigation")),E(this,k,document.querySelector("#scene-list")),E(this,U,document.querySelector("#navigation .nav-item.is-root")),E(this,O,document.querySelector("#nav-toggle")),(e=d(this,R))==null||e.addEventListener("mouseenter",()=>{if(!r.get(g.SETTINGS.sceneNavCollapsed.tag)||!r.get(g.SETTINGS.showSceneNavOnHover.tag))return;clearTimeout(d(this,w));const n=document.querySelector("#scene-list");n.style.display="flex",document.querySelector("#navigation").classList.remove("collapsed")}),(t=d(this,R))==null||t.addEventListener("mouseleave",a=>{if(!(!r.get(g.SETTINGS.sceneNavCollapsed.tag)||!r.get(g.SETTINGS.showSceneNavOnHover.tag))){if(!a)var a=window.event;a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),E(this,w,setTimeout(()=>{clearTimeout(d(this,w)),E(this,w,null);const s=document.querySelector("#scene-list");s.style.display="none",document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var u,y,f,L,M,P,z;const e=(u=d(this,R))==null?void 0:u.querySelectorAll("button.crlngn-nav"),t=((y=d(this,k))==null?void 0:y.scrollWidth)>=((f=d(this,R))==null?void 0:f.offsetWidth);if(l.log("placeNavButtons",[t,e,(L=d(this,k))==null?void 0:L.scrollWidth,(M=d(this,R))==null?void 0:M.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const a=document.createElement("i");a.classList.add("fa"),a.classList.add("fa-chevron-left"),n.addEventListener("click",d(this,ee)),n.append(a);const s=document.createElement("button");s.classList.add("crlngn-nav"),s.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),s.append(i),s.addEventListener("click",d(this,te)),(P=d(this,R))==null||P.appendChild(n),(z=d(this,R))==null||z.appendChild(s)}static setNavPosition(e){var s,i;const t=e!==void 0?e:r.get(g.SETTINGS.sceneNavPos.tag),n=((s=d(this,k))==null?void 0:s.querySelectorAll("li.nav-item"))||[],a=((i=n[t])==null?void 0:i.offsetLeft)*-1;d(this,k).style.marginLeft=a+"px",r.set(g.SETTINGS.sceneNavPos.tag,t),l.log("setNavPosition",[e,t,n[t],a])}};R=new WeakMap,k=new WeakMap,w=new WeakMap,U=new WeakMap,O=new WeakMap,ee=new WeakMap,te=new WeakMap,S(m,R),S(m,k),S(m,w),S(m,U),S(m,O),S(m,ee,e=>{var L,M,P,z,F;const t=(L=d(m,O))==null?void 0:L.offsetWidth,n=le.isModuleOn("compact-scene-navigation")?(M=d(m,U))==null?void 0:M.offsetWidth:0,a=(P=d(m,k))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),s=((z=d(m,k))==null?void 0:z.querySelectorAll("li.nav-item"))||[],i=a.offsetWidth,u=r.get(g.SETTINGS.sceneNavPos.tag)||0,y=Math.floor((((F=d(m,R))==null?void 0:F.offsetWidth)-(u===0?n:0)-t*2)/i);l.log("onNavLast",["currPos",u,y]);let f=u-y;f=f<0?0:f,l.log("onNavLast",["sceneCount",s.length,u,f]),m.setNavPosition(f)}),S(m,te,e=>{var L,M,P,z,F;const t=(L=d(m,O))==null?void 0:L.offsetWidth,n=le.isModuleOn("compact-scene-navigation")?(M=d(m,U))==null?void 0:M.offsetWidth:0,a=(P=d(m,k))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),s=((z=d(m,k))==null?void 0:z.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=a.offsetWidth,u=r.get(g.SETTINGS.sceneNavPos.tag)||0,y=Math.floor((((F=d(m,R))==null?void 0:F.offsetWidth)-(u===0?n:0)-t*2)/i);l.log("onNavLast",["currPos",u,y]);let f=u+y;f=f>s.length?s.length:f,m.setNavPosition(f)});let de=m;class Pe{static enrichCard(e,t){var n,a,s,i,u,y;if(h(),r.get(g.SETTINGS.enableChatStyles.tag)){const f=((s=(a=(n=e.flags)==null?void 0:n.dnd5e)==null?void 0:a.activity)==null?void 0:s.type)||((y=(u=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:u.roll)==null?void 0:y.type)||"custom",L=t.get(0);L.classList.add("crlngn"),L.classList.add(f)}}}class me{static init(){Hooks.on(C.RENDER_PLAYERS_LIST,me.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var ne;const v=class v{static init(){Hooks.once(C.INIT,()=>{var e;v.SETTINGS=h(),(e=document.querySelector("#ui-middle"))==null||e.classList.add("crlngn-ui"),l.log("Initiating module",[],!0),r.registerSettings(),Hooks.on(C.RENDER_CHAT_MESSAGE,d(v,ne))}),Hooks.once(C.READY,()=>{var e=r.get("debug-mode");e&&(CONFIG.debug.hooks=!0);const t=loadTemplates(["modules/crlngn-ui/templates/custom-fonts-settings.hbs"]).then(n=>{l.log("Loaded template",[n])});l.log("Core Ready",[t]),de.init(),D.init(),me.init()})}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;v.keysPressed.indexOf(t)<0&&v.keysPressed.push(t),l.log("Keydown",[v.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,n=v.keysPressed.indexOf(t);n>=0&&v.keysPressed.splice(n,1),l.log("Keyup",[v.keysPressed])})}};ne=new WeakMap,G(v,"SETTINGS"),S(v,ne,(e,t)=>{l.log(C.RENDER_CHAT_MESSAGE,[e,t]),Pe.enrichCard(e,t)});let g=v;g.init();
//# sourceMappingURL=module.js.map
