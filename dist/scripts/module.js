var ve=Object.defineProperty;var Se=f=>{throw TypeError(f)};var Me=(f,e,t)=>e in f?ve(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var G=(f,e,t)=>Me(f,typeof e!="symbol"?e+"":e,t),oe=(f,e,t)=>e.has(f)||Se("Cannot "+t);var g=(f,e,t)=>(oe(f,e,"read from private field"),t?t.call(f):e.get(f)),S=(f,e,t)=>e.has(f)?Se("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(f):e.set(f,t),L=(f,e,t,n)=>(oe(f,e,"write to private field"),n?n.call(f,t):e.set(f,t),t),y=(f,e,t)=>(oe(f,e,"access private method"),t);const T={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},Y="crlngn-ui",Ie="crlngn-ui",ee=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],N={select:"select",checkbox:"checkbox",text:"text",number:"number"},I={client:"client",world:"world"},te={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}};function p(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:N.button,fields:{uiFont:{tag:"ui-font",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.hint"),inputType:N.text},uiTitles:{tag:"ui-titles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:N.text},journalBody:{tag:"journal-body",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:N.text},journalTitles:{tag:"journal-title",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:N.text}},default:{uiFont:'"Work Sans", Arial, sans-serif',uiTitles:'"Work Sans", Arial, sans-serif',journalBody:'"Work Sans", Arial, sans-serif',journalTitles:'"Roboto Condensed", Arial, sans-serif'},scope:I.world,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:N.button,fields:{iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:N.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:N.checkbox}},default:{iconSize:te.small.name,autoHideSecondary:!1},scope:I.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:N.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:N.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:N.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:N.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:N.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:N.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:I.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:N.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:N.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:N.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:I.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:N.number,default:0,scope:I.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableChatStyles.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!0},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:N.checkbox,default:!0,scope:I.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:N.checkbox,default:!1,scope:I.client,config:!0}}}const{ApplicationV2:Ge,HandlebarsApplicationMixin:ke}=foundry.applications.api;var q,he,ye;const w=class w extends ke(Ge){static get DEFAULT_OPTIONS(){return{id:p().cameraDockMenu.tag,actions:{redefine:y(w,q,ye)},form:{handler:y(w,q,he),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=p(),n={...r.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return l.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){l.log("_onRender",[e,t,controlSettings])}};q=new WeakSet,he=async function(e,t,n){const s=p();let o=r.get(s.cameraDockMenu.tag),i=o.enableFloatingDock;e.preventDefault(),e.stopPropagation();const c=foundry.utils.expandObject(n.object);await r.set(s.cameraDockMenu.tag,c),o=r.get(s.cameraDockMenu.tag),l.log("Saving settings:",[s.cameraDockMenu.tag,t,n.object,c,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.enableFloatingDock!=i&&location.reload()},ye=async function(e,t){const n=p(),o=this.element.querySelectorAll("input, select"),i=n.cameraDockMenu.default;o.forEach(c=>{c.value=i[c.name],c.type==="checkbox"&&(c.checked=i[c.name])}),l.log("#onReset",[e,t,n.cameraDockMenu.default])},S(w,q),G(w,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ie=w;const{ApplicationV2:Pe,HandlebarsApplicationMixin:ze}=foundry.applications.api;var B,Ce,be;const x=class x extends ze(Pe){static get DEFAULT_OPTIONS(){return{id:p().customFontsMenu.tag,actions:{redefine:y(x,B,be)},form:{handler:y(x,B,Ce),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=p(),n=r.get(t.customFontsMenu.tag),s={uiFont:n.uiFont||t.customFontsMenu.default.uiFont,uiTitles:n.uiTitles||t.customFontsMenu.default.uiTitles,journalBody:n.journalBody||n.journalBodyFont||t.customFontsMenu.default.journalBody,journalTitles:n.journalTitles||n.journalTitleFont||t.customFontsMenu.default.journalTitles,default:{...t.customFontsMenu.default},fields:{...t.customFontsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]};return l.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){l.log("_onRender",[e,t])}};B=new WeakSet,Ce=async function(e,t,n){const s=p();e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);l.log("Saving settings:",[o]),r.set(s.customFontsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},be=async function(e,t){const n=p(),o=this.element.querySelectorAll("input[type=text]"),i=n.customFontsMenu.default;o.forEach(c=>{c.value=i[c.name]}),l.log("#onReset",[e,t,n.customFontsMenu.default])},S(x,B),G(x,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let le=x;const{ApplicationV2:De,HandlebarsApplicationMixin:Ue}=foundry.applications.api;var j,Te,Le;const A=class A extends Ue(De){static get DEFAULT_OPTIONS(){return{id:p().leftControlsMenu.tag,actions:{redefine:y(A,j,Le)},form:{handler:y(A,j,Te),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=p(),n={...r.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return l.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=p(),s=r.get(n.leftControlsMenu.tag);l.log("_onRender",[e,t,s])}};j=new WeakSet,Te=async function(e,t,n){const s=p();e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);await r.set(s.leftControlsMenu.tag,o);const i=r.get(s.leftControlsMenu.tag);l.log("Saving settings:",[s.leftControlsMenu.tag,t,n.object,o,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Le=async function(e,t){const n=p(),o=this.element.querySelectorAll("input, select"),i=n.leftControlsMenu.default;o.forEach(c=>{c.value=i[c.name],c.type==="checkbox"&&(c.checked=i[c.name])}),l.log("#onReset",[e,t,n.leftControlsMenu.default])},S(A,j),G(A,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ce=A;const{ApplicationV2:we,HandlebarsApplicationMixin:xe}=foundry.applications.api;var W,Ee,Re;const H=class H extends xe(we){static get DEFAULT_OPTIONS(){return{id:p().sceneNavMenu.tag,actions:{redefine:y(H,W,Re)},form:{handler:y(H,W,Ee),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=p(),n={...r.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return l.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,l.log("_preparePartContext",[e,t]),t}_onRender(e,t){l.log("_onRender",[e,t])}};W=new WeakSet,Ee=async function(e,t,n){const s=p();let o=r.get(s.sceneNavMenu.tag),i=o.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const c=foundry.utils.expandObject(n.object);await r.set(s.sceneNavMenu.tag,c),o=r.get(s.sceneNavMenu.tag),l.log("Saving settings...",[s.sceneNavMenu.tag,t,n.object,c,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.sceneNavEnabled!=i&&location.reload()},Re=async function(e,t){const n=p(),o=this.element.querySelectorAll("input, select"),i=n.sceneNavMenu.default;o.forEach(c=>{c.value=i[c.name],c.type==="checkbox"&&(c.checked=i[c.name])}),l.log("#onReset",[e,t,n.sceneNavMenu.default])},S(H,W),G(H,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let re=H;function Ae(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:le,restricted:!0},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:ce,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:ie,restricted:!0},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:re,restricted:!1}}}class ue{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,s=e.offsetParent;return(s?s.clientHeight:window.innerHeight)-(t+n)}}var V,X,K,Z,J,Q,_,E,ge,de,me,pe;const a=class a{static init(){const e=p(),t=r.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(T.RENDER_CAMERA_VIEWS,a.onRenderFloating),l.log("CameraUtil",[t]),a.onRenderFloating()):(Hooks.on(T.RENDER_CAMERA_VIEWS,a.onRenderPlain),a.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,i,c;const e=p(),t=r.get(e.cameraDockMenu.tag);(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),a.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),s=document.querySelector("#camera-views .camera-grid");l.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),a.cameraContainer&&s&&n&&((i=a.cameraContainer)==null||i.insertBefore(n,s),(c=document.querySelector("#camera-views .camera-container"))==null||c.classList.add("visible")),a.makeDraggable(),a.makeResizeable(),a.resetPositionAndSize(),a.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(l.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),s=document.createElement("button");s.classList.add("crlngn-video-toggle"),s.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(s,n)}static makeDraggable(){var e;(e=a.cameraContainer)==null||e.addEventListener("mousedown",t=>{var o,i;const n=document.querySelector("body.crlngn-ui");if(l.log("mousedown",[t.target]),(o=t.target.parentNode)!=null&&o.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",y(a,E,de)),n==null||n.addEventListener("mouseup",y(a,E,ge));const s=ue.getOffsetBottom(a.cameraContainer);a.isDragging=!0,L(a,V,t.clientX-((i=a.cameraContainer)==null?void 0:i.offsetLeft)),L(a,X,window.innerHeight-t.clientY-s),t.stopPropagation()})}static makeResizeable(){if(a.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),a.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),a.isResizing=!0,L(a,K,n.clientX),L(a,Z,n.clientY),L(a,_,parseInt(getComputedStyle(a.cameraContainer).bottom)||0),L(a,J,a.cameraContainer.offsetWidth),L(a,Q,a.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",y(a,E,me)),e==null||e.addEventListener("mouseup",y(a,E,pe))})}}static resetPositionAndSize({x:e,y:t,w:n,h:s}={x:null,y:null,w:null,h:null}){const o=p(),i=r.get(o.cameraDockMenu.tag);if(!(!i.enableFloatingDock||!a.cameraContainer))if(!e&&!t&&!n&&!s){const c=i.dockPosX||0,C=i.dockPosY||0,h=i.dockWidth||0,R=i.dockHeight||0;a.cameraContainer.style.left=`${c}px`,a.cameraContainer.style.bottom=`${C}px`,a.cameraContainer.style.width=`${h}px`,a.cameraContainer.style.height=`${R}px`}else e&&(a.cameraContainer.style.left=`${e}px`),t&&(a.cameraContainer.style.bottom=`${t}px`),n&&(a.cameraContainer.style.width=`${n}px`),s&&(a.cameraContainer.style.height=`${s}px`)}};V=new WeakMap,X=new WeakMap,K=new WeakMap,Z=new WeakMap,J=new WeakMap,Q=new WeakMap,_=new WeakMap,E=new WeakSet,ge=function(e){var s,o;const t=p(),n={...r.get(t.cameraDockMenu.tag)};if(a.isDragging){const i=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((s=a.cameraContainer)==null?void 0:s.style.left)||0,n.dockPosY=parseInt((o=a.cameraContainer)==null?void 0:o.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),r.set(t.cameraDockMenu.tag,n),i==null||i.removeEventListener("mousemove",y(a,E,de)),i==null||i.removeEventListener("mouseup",y(a,E,ge)),a.isDragging=!1,e.stopPropagation()}},de=function(e){if(a.isDragging&&(l.log("mousemove",[e.target.parentNode]),a.cameraContainer)){let t=e.clientX-g(a,V),n=window.innerHeight-e.clientY-g(a,X);t+a.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-a.cameraContainer.offsetWidt),a.cameraContainer.style.left=`${t}px`,n+a.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-a.cameraContainer.offsetHeight),a.cameraContainer.style.bottom=`${n}px`}},me=function(e){if(!a.isResizing)return;const t=g(a,J)+(e.clientX-g(a,K)),n=e.clientY-g(a,Z),s=g(a,Q)+n,o=g(a,_)-n;a.cameraContainer.style.width=`${t}px`,a.cameraContainer.style.height=`${s}px`,a.cameraContainer.style.bottom=`${o}px`},pe=function(){var s,o,i,c,C,h;const e=p(),t={...r.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");a.isResizing=!1,n==null||n.removeEventListener("mousemove",y(a,E,me)),n==null||n.removeEventListener("mouseup",y(a,E,pe)),l.log("onStopResize",[(s=a.cameraContainer)==null?void 0:s.style.width,(o=a.cameraContainer)==null?void 0:o.style.height,(i=a.cameraContainer)==null?void 0:i.style.bottom]),t.dockWidth=parseInt(((c=a.cameraContainer)==null?void 0:c.style.width)||0),t.dockHeight=parseInt(((C=a.cameraContainer)==null?void 0:C.style.height)||0),t.dockPosY=parseInt(((h=a.cameraContainer)==null?void 0:h.style.bottom)||0),r.set(m.SETTINGS.cameraDockMenu.tag,t)},S(a,E),S(a,V,0),S(a,X,0),G(a,"isDragging",!1),G(a,"cameraContainer"),G(a,"isResizing",!1),S(a,K,0),S(a,Z,0),S(a,J,0),S(a,Q,0),S(a,_,0);let D=a;const u=class u{static registerSettings(){document.querySelector("body").classList.add(Ie),Object.entries(m.SETTINGS).forEach(async n=>{const s=n[1];l.log("Registering... ",[n]);const o={name:s.label,hint:s.hint,default:s.default,type:s.propType,scope:s.scope,config:s.config,requiresReload:s.requiresReload||!1,onChange:i=>u.apply(s.tag,i)};s.choices&&(o.choices=s.choices),await game.settings.register(Y,s.tag,o),u.get(s.tag)===void 0&&u.set(s.tag,s.default),l.log("registerSettings",[s.tag,u.get(s.tag)])}),Object.entries(Ae()).forEach(async n=>{const s=n[1],o={name:s.tag,label:s.label,hint:s.hint,icon:s.icon,type:s.propType,restricted:s.restricted};await game.settings.registerMenu(Y,s.tag,o)}),Hooks.on(T.RENDER_SCENE_CONTROLS,u.applyLeftControlsSettings),Hooks.on(T.RENDER_PLAYERS_LIST,u.applyPlayersListSettings),Hooks.on(T.RENDER_HOTBAR,()=>{u.firstLoad&&(u.firstLoad=!1,u.applyHotBarCollapse()),u.applyHotBarSettings()}),u.applySceneNavPos(),u.get(m.SETTINGS.enableChatStyles.tag)&&document.querySelector("body").classList.add("crlngn-chat"),u.applyCustomFonts(),u.applyLeftControlsSettings(),u.applyControlIconSize()}static get(e,t=Y){if(!e)return null;let n=!1;if(t===Y)n=game.settings.get(t,e);else{let o=game.settings.storage.get("client")[`${t}.${e}`];o===void 0&&(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=o==null?void 0:o.value,l.log("GET Setting",[o,n])}return n}static set(e,t,n=Y){if(!e)return!1;let s=game.settings.storage.get("client")[`${n}.${e}`];s||(s=game.settings.storage.get("world").getSetting(`${n}.${e}`)),l.log("Setting",[e,s]);try{game.settings.set(n,e,t)}catch{l.log("Unable to change setting",[e,s])}return!0}static apply(e,t=void 0){const n=p();switch(t===void 0&&(t=u.get(e)),l.log("SettingsUtil.apply",[e,t,u.get(e)]),e){case n.enableMacroLayout.tag:u.applyHotBarSettings();break;case n.collapseMacroBar.tag:u.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:u.applyPlayersListSettings();break;case n.customFontsMenu.tag:u.applyCustomFonts(t);case n.leftControlsMenu.tag:u.applyLeftControlsSettings(),u.applyControlIconSize();break;case n.cameraDockMenu.tag:u.applyCameraPosX(),u.applyCameraPosY(),u.applyCameraWidth(),u.applyCameraHeight();break}}static applySettings(){}static applyHotBarSettings(){const e=u.get(m.SETTINGS.enableMacroLayout.tag),t=document.querySelector("#hotbar");!e&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){u.get(m.SETTINGS.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=p(),t=u.get(e.leftControlsMenu.tag),n=document.querySelector("#ui-left");t.autoHideSecondary?n.classList.add("auto-hide"):n.classList.remove("auto-hide")}static applyControlIconSize(){const e=p(),t=u.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),s=t.iconSize==te.small.name?te.small.size:te.regular.size;n.style.setProperty("--left-control-item-size",s)}static applyPlayersListSettings(){var e,t;l.log("applyPlayersListSettings",[document.querySelector("#players"),u.get(m.SETTINGS.autoHidePlayerList.tag)]),u.get(m.SETTINGS.autoHidePlayerList.tag)?(e=document.querySelector("#players"))==null||e.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide")}static applySceneNavPos(){u.set(m.SETTINGS.sceneNavPos.tag,0)}static applyCameraPosX(e){const t=u.get(m.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosX;D.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=u.get(m.SETTINGS.cameraDockMenu.tag),n=e||t.dockPosY;D.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=u.get(m.SETTINGS.cameraDockMenu.tag),n=e||t.dockWidth;D.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=u.get(m.SETTINGS.cameraDockMenu.tag),n=e||t.dockHeight;D.resetPositionAndSize({h:n})}static applyCustomFonts(){const e=p(),t=u.get(e.customFontsMenu.tag);if(l.log("applyCustomFonts",[t]),t){const n=document.querySelector("body.crlngn-ui");n.style.setProperty("--crlngn-font-family",t.uiFont||e.customFontsMenu.default.uiFont||""),n.style.setProperty("--crlngn-font-titles",t.uiTitles||e.customFontsMenu.default.uiTitles||""),n.style.setProperty("--crlngn-font-journal-body",t.journalBody||t.journalBodyFont||e.customFontsMenu.default.journalBody||""),n.style.setProperty("--crlngn-font-journal-title",t.journalTitles||t.journalTitleFont||e.customFontsMenu.default.journalTitles||"")}}};G(u,"firstLoad",!0);let r=u;class l{static log(e="",t=[],n=!1){try{const s=r.get(m.SETTINGS.debugMode.tag);if(!(n||s))return;console.log(...ee,e,...t)}catch{console.log(...ee,e,...t)}}static warn(e="",t=[]){console.warn(...ee,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ee,e)}}var b,M,U,O,F,ne,se;const d=class d{static init(){const e=document.querySelector("#ui-middle");if(r.get(m.SETTINGS.sceneNavMenu.tag).sceneNavEnabled&&e)e.classList.add("crlngn-ui");else if(e){e.classList.remove("crlngn-ui");return}d.addListeners(),l.log(T.RENDER_SCENE_NAV,[ui.nav,r.get(m.SETTINGS.sceneNavCollapsed.tag)]),d.setNavPosition(0),d.placeNavButtons(),r.get(m.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand(),Hooks.on(T.RENDER_SCENE_NAV,()=>{d.addListeners(),l.log(T.RENDER_SCENE_NAV,[ui.nav,r.get(m.SETTINGS.sceneNavCollapsed.tag)]),d.setNavPosition(),d.placeNavButtons(),r.get(m.SETTINGS.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(T.COLLAPSE_SIDE_BAR,n=>{d.placeNavButtons()}),Hooks.on(T.COLLAPSE_SCENE_NAV,(n,s)=>{r.set(m.SETTINGS.sceneNavCollapsed.tag,s),l.log("NAV toggle",[n,s])}),Hooks.on(T.EXPAND_SCENE_NAV,(n,s)=>{r.set(m.SETTINGS.sceneNavCollapsed.tag,!1),l.log("NAV expand",[n,!1])}),r.apply(m.SETTINGS.sceneNavCollapsed.tag),window.addEventListener("resize",()=>{d.placeNavButtons()}),d.observeNavOffset()}static addListeners(){var e,t;L(this,b,document.querySelector("#navigation")),L(this,M,document.querySelector("#scene-list")),L(this,O,document.querySelector("#navigation .nav-item.is-root")),L(this,F,document.querySelector("#nav-toggle")),(e=g(this,b))==null||e.addEventListener("mouseenter",()=>{const n=r.get(m.SETTINGS.sceneNavMenu.tag);if(!r.get(m.SETTINGS.sceneNavCollapsed.tag)||!(n!=null&&n.showNavOnHover))return;clearTimeout(g(this,U));const s=document.querySelector("#scene-list");s.style.display="flex",document.querySelector("#navigation").classList.remove("collapsed")}),(t=g(this,b))==null||t.addEventListener("mouseleave",o=>{const s=r.get(m.SETTINGS.sceneNavMenu.tag);if(!(!r.get(m.SETTINGS.sceneNavCollapsed.tag)||!(s!=null&&s.showNavOnHover))){if(!o)var o=window.event;o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),L(this,U,setTimeout(()=>{clearTimeout(g(this,U)),L(this,U,null);const i=document.querySelector("#scene-list");i.style.display="none",document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var c,C,h,R,k,P,z;const e=(c=g(this,b))==null?void 0:c.querySelectorAll("button.crlngn-nav"),t=((C=g(this,M))==null?void 0:C.scrollWidth)>=((h=g(this,b))==null?void 0:h.offsetWidth);if(l.log("placeNavButtons",[t,e,(R=g(this,M))==null?void 0:R.scrollWidth,(k=g(this,b))==null?void 0:k.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),n.addEventListener("click",g(this,ne)),n.append(s);const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),o.append(i),o.addEventListener("click",g(this,se)),(P=g(this,b))==null||P.appendChild(n),(z=g(this,b))==null||z.appendChild(o)}static setNavPosition(e){var o,i;const t=e!==void 0?e:r.get(m.SETTINGS.sceneNavPos.tag),n=((o=g(this,M))==null?void 0:o.querySelectorAll("li.nav-item"))||[],s=((i=n[t])==null?void 0:i.offsetLeft)*-1;g(this,M).style.marginLeft=s+"px",r.set(m.SETTINGS.sceneNavPos.tag,t),l.log("setNavPosition",[e,t,n[t],s])}static observeNavOffset(){function e(){if(!g(d,b))return;let n=37+g(d,b).offsetTop;const s=document.querySelector("body.crlngn-ui");s==null||s.style.setProperty("--crlngn-top-offset",n+"px"),l.log("updateCSSVars",[n])}new MutationObserver(e).observe(g(d,b).parentNode,{attributes:!0,childList:!0,characterData:!0}),e()}};b=new WeakMap,M=new WeakMap,U=new WeakMap,O=new WeakMap,F=new WeakMap,ne=new WeakMap,se=new WeakMap,S(d,b),S(d,M),S(d,U),S(d,O),S(d,F),S(d,ne,e=>{var R,k,P,z,$;const t=(R=g(d,F))==null?void 0:R.offsetWidth,n=ue.isModuleOn("compact-scene-navigation")?(k=g(d,O))==null?void 0:k.offsetWidth:0,s=(P=g(d,M))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),o=((z=g(d,M))==null?void 0:z.querySelectorAll("li.nav-item"))||[],i=s.offsetWidth,c=r.get(m.SETTINGS.sceneNavPos.tag)||0,C=Math.floor(((($=g(d,b))==null?void 0:$.offsetWidth)-(c===0?n:0)-t*2)/i);l.log("onNavLast",["currPos",c,C]);let h=c-C;h=h<0?0:h,l.log("onNavLast",["sceneCount",o.length,c,h]),d.setNavPosition(h)}),S(d,se,e=>{var R,k,P,z,$;const t=(R=g(d,F))==null?void 0:R.offsetWidth,n=ue.isModuleOn("compact-scene-navigation")?(k=g(d,O))==null?void 0:k.offsetWidth:0,s=(P=g(d,M))==null?void 0:P.querySelector("li.nav-item:not(.is-root)"),o=((z=g(d,M))==null?void 0:z.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=s.offsetWidth,c=r.get(m.SETTINGS.sceneNavPos.tag)||0,C=Math.floor(((($=g(d,b))==null?void 0:$.offsetWidth)-(c===0?n:0)-t*2)/i);l.log("onNavLast",["currPos",c,C]);let h=c+C;h=h>o.length?o.length:h,d.setNavPosition(h)});let fe=d;class He{static enrichCard(e,t){var n,s,o,i,c,C;if(p(),r.get(m.SETTINGS.enableChatStyles.tag)){const h=((o=(s=(n=e.flags)==null?void 0:n.dnd5e)==null?void 0:s.activity)==null?void 0:o.type)||((C=(c=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:c.roll)==null?void 0:C.type)||"custom",R=t.get(0);R.classList.add("crlngn"),R.classList.add(h)}}}class Ne{static init(){Hooks.on(T.RENDER_PLAYERS_LIST,Ne.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var ae;const v=class v{static init(){Hooks.once(T.INIT,()=>{var e;v.SETTINGS=p(),(e=document.querySelector("#ui-middle"))==null||e.classList.add("crlngn-ui"),l.log("Initiating module",[],!0),r.registerSettings(),Hooks.on(T.RENDER_CHAT_MESSAGE,g(v,ae))}),Hooks.once(T.READY,()=>{var e=r.get("debug-mode");e&&(CONFIG.debug.hooks=!0);const t=loadTemplates(["modules/crlngn-ui/templates/custom-fonts-settings.hbs"]).then(n=>{l.log("Loaded template",[n])});l.log("Core Ready",[t]),fe.init(),D.init(),Ne.init(),l.log("GAME",[game.collections.find(n=>n.key=="Scene"),game.collections.get("Scene"),ui])})}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;v.keysPressed.indexOf(t)<0&&v.keysPressed.push(t),l.log("Keydown",[v.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,n=v.keysPressed.indexOf(t);n>=0&&v.keysPressed.splice(n,1),l.log("Keyup",[v.keysPressed])})}};ae=new WeakMap,G(v,"SETTINGS"),S(v,ae,(e,t)=>{l.log(T.RENDER_CHAT_MESSAGE,[e,t]),He.enrichCard(e,t)});let m=v;m.init();
//# sourceMappingURL=module.js.map
