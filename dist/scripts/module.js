var Ve=Object.defineProperty;var De=C=>{throw TypeError(C)};var Ye=(C,e,t)=>e in C?Ve(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var z=(C,e,t)=>Ye(C,typeof e!="symbol"?e+"":e,t),be=(C,e,t)=>e.has(C)||De("Cannot "+t);var u=(C,e,t)=>(be(C,e,"read from private field"),t?t.call(C):e.get(C)),S=(C,e,t)=>e.has(C)?De("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(C):e.set(C,t),L=(C,e,t,n)=>(be(C,e,"write to private field"),n?n.call(C,t):e.set(C,t),t),R=(C,e,t)=>(be(C,e,"access private method"),t);const T={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},F="crlngn-ui",ge=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],b={select:"select",checkbox:"checkbox",text:"text",number:"number"},P={client:"client",world:"world"},de={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},Y={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}};function d(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:b.button,fields:{uiFont:{tag:"ui-font",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiFont.hint"),inputType:b.text},uiTitles:{tag:"ui-titles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:b.text},journalBody:{tag:"journal-body",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:b.text},journalTitles:{tag:"journal-title",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:b.text}},default:{uiFont:'"Work Sans", Arial, sans-serif',uiTitles:'"Roboto Slab", Arial, sans-serif',journalBody:'"Work Sans", Arial, sans-serif',journalTitles:'"Roboto Condensed", Arial, sans-serif'},scope:P.world,config:!1,requiresReload:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:b.button,fields:{enableChatStyles:{tag:"enable-chat-styles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:b.checkbox},borderColor:{tag:"border-color",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),inputType:b.select,options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")}},enforceDarkMode:{restricted:!0,tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:b.checkbox}},default:{enableChatStyles:!0,borderColor:Y.playerColor.name},scope:P.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:b.button,fields:{bottomBuffer:{tag:"control-bottom-buffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),inputType:b.number},iconSize:{tag:"control-icon-size",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:b.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")}},autoHideSecondary:{tag:"auto-hide-secondary-controls",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:b.checkbox},hideFoundryLogo:{tag:"hide-foundry-logo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:b.checkbox}},default:{bottomBuffer:200,iconSize:de.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:P.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:b.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:b.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:b.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:b.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:b.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:b.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:P.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:b.button,fields:{sceneNavEnabled:{tag:"scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),inputType:b.checkbox},showNavOnHover:{tag:"show-nav-on-hover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),inputType:b.checkbox}},default:{sceneNavEnabled:!0,showNavOnHover:!1},scope:P.client,config:!1,requiresReload:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:b.checkbox,default:!0,scope:P.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:b.number,default:0,scope:P.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:b.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:b.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:b.checkbox,default:!0,scope:P.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:b.checkbox,default:!1,scope:P.client,config:!0},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:b.checkbox,default:!0,scope:P.world,config:!1}}}const{ApplicationV2:Xe,HandlebarsApplicationMixin:Ke}=foundry.applications.api;var Z,Ue,Ae;const W=class W extends Ke(Xe){static get DEFAULT_OPTIONS(){return{id:d().cameraDockMenu.tag,actions:{redefine:R(W,Z,Ae)},form:{handler:R(W,Z,Ue),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=d(),n={...r.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};Z=new WeakSet,Ue=async function(e,t,n){const s=d();let o=r.get(s.cameraDockMenu.tag),a=o.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await r.set(s.cameraDockMenu.tag,i),o=r.get(s.cameraDockMenu.tag),c.log("Saving settings:",[s.cameraDockMenu.tag,t,n.object,i,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.enableFloatingDock!=a&&location.reload()},Ae=async function(e,t){const n=d(),o=this.element.querySelectorAll("input, select"),a=n.cameraDockMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.cameraDockMenu.default])},S(W,Z),z(W,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ce=W;const{ApplicationV2:Ze,HandlebarsApplicationMixin:Je}=foundry.applications.api;var J,xe,Oe;const j=class j extends Je(Ze){static get DEFAULT_OPTIONS(){return{id:d().chatMessagesMenu.tag,actions:{redefine:R(j,J,Oe)},form:{handler:R(j,J,xe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!0}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=d(),n={...r.get(t.chatMessagesMenu.tag),enforceDarkMode:r.get(t.enforceDarkMode.tag),default:{...t.chatMessagesMenu.default,enforceDarkMode:t.enforceDarkMode.default||null},isGM:game.user.isGM,fields:{...t.chatMessagesMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=d(),s=r.get(n.chatMessagesMenu.tag);c.log("_onRender",[e,t,s])}};J=new WeakSet,xe=async function(e,t,n){const s=d();e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);c.log("Saving settings:",[o]),(o.bottomBuffer===void 0||o.bottomBuffer==="")&&(o.bottomBuffer=s.chatMessagesMenu.default.bottomBuffer);const a=r.get(s.chatMessagesMenu.tag),i=a.borderColor;o.enforceDarkMode===void 0&&delete o.enforceDarkMode;const m=[];Object.entries(o).forEach(y=>{c.log("menuSettings",[y]),s.chatMessagesMenu.default[y[0]]&&m.push(y[1])}),c.log("menuSettings",[m]),await r.set(s.chatMessagesMenu.tag,o),await r.set(s.enforceDarkMode.tag,o.enforceDarkMode);const p=r.get(s.chatMessagesMenu.tag);c.log("Saving settings:",[a,o,p]),p.borderColor!==i&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Oe=async function(e,t){const n=d(),o=this.element.querySelectorAll("input, select"),a={...n.chatMessagesMenu.default,enforceDarkMode:n.enforceDarkMode.default};o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[a])},S(j,J),z(j,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Me=j;class U{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight,s=e.offsetParent;return(s?s.clientHeight:window.innerHeight)-(t+n)}static getAllFonts(){var a;const e=new Set(Object.keys(CONFIG.fontDefinitions));c.log("Foundry built-in fonts:",[Array.from(e)]);const t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([i])=>i);c.log("Custom fonts from settings:",[n]);const s=new Set;for(const i of document.styleSheets)try{if(i.ownerNode){let m="";if(i.ownerNode.tagName==="STYLE")m=i.ownerNode.textContent;else if(i.ownerNode.tagName==="LINK")try{if((a=i.href)!=null&&a.startsWith(window.location.origin)){const N=i.cssRules||i.rules;m=Array.from(N).map(h=>h.cssText).join(`
`)}}catch(N){console.warn("Could not read stylesheet rules:",N)}c.log("Processing stylesheet text:",[m.slice(0,200)+"..."]);const p=/@import\s+url\(['"]([^'"]+)['"]\)/g;let y;for(;(y=p.exec(m))!==null;){const N=y[1];if(c.log("Found import URL:",N),N.includes("fonts.googleapis.com")){const h=N.match(/family=([^&]+)/);h&&decodeURIComponent(h[1]).split("|").map(I=>I.split(":")[0].replace(/\+/g," ")).forEach(I=>{s.add(I),c.log("Added Google Font family:",I)})}else try{fetch(N).then(h=>h.text()).then(h=>{(h.match(/@font-face\s*{[^}]+}/g)||[]).forEach(I=>{const A=I.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(A){const we=A[1].trim();s.add(we),c.log("Added font family from @font-face:",we)}})}).catch(h=>console.warn("Error loading imported CSS:",h))}catch(h){console.warn("Error processing imported CSS:",h)}}}if(!i.href||i.href.startsWith(window.location.origin))try{const m=i.cssRules||i.rules;for(const p of m)if(p instanceof CSSFontFaceRule){const y=p.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();s.add(y),c.log("Found font-face rule for:",y)}}catch(m){console.warn("Could not read stylesheet rules:",m)}}catch(m){console.warn("Error processing stylesheet:",m)}return c.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(s)}]),Array.from(new Set([...e,...n,...s])).filter(i=>!i.includes("FontAwesome")&&!i.includes("Font Awesome")).map(i=>i.replace(/['"`]/g,"").trim()).sort((i,m)=>i.toLowerCase().localeCompare(m.toLowerCase()))}}z(U,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Qe,HandlebarsApplicationMixin:_e}=foundry.applications.api;var q,O,Fe,He,qe;const w=class w extends _e(Qe){static get DEFAULT_OPTIONS(){return{id:d().customFontsMenu.tag,actions:{redefine:R(w,O,qe)},form:{handler:R(w,O,Fe),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}_prepareContext(e){const t=d(),n=r.get(t.customFontsMenu.tag),s={uiFont:n.uiFont||t.customFontsMenu.default.uiFont,uiTitles:n.uiTitles||t.customFontsMenu.default.uiTitles,journalBody:n.journalBody||n.journalBodyFont||t.customFontsMenu.default.journalBody,journalTitles:n.journalTitles||n.journalTitleFont||t.customFontsMenu.default.journalTitles,default:{...t.customFontsMenu.default},fontList:U.getAllFonts(),fields:{...t.customFontsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]};return c.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){L(w,q,this.element),u(w,q).querySelectorAll('input[type="text"]').forEach(o=>{const a=o.closest(".dropdown-wrapper"),i=a==null?void 0:a.querySelector(".dropdown-options");if(!a||!i)return;const m=()=>{var p;R(p=w,O,He).call(p),i.classList.add("active")};o.addEventListener("focus",m),o.addEventListener("click",m),o.addEventListener("keydown",p=>{const y=i.classList.contains("active"),N=Array.from(i.querySelectorAll(".dropdown-option"));let h=N.findIndex(E=>E.classList.contains("highlighted"));p.key==="ArrowDown"||p.key==="ArrowUp"?(p.preventDefault(),y||i.classList.add("active"),N.forEach(E=>E.classList.remove("highlighted")),h===-1?h=p.key==="ArrowDown"?0:N.length-1:h=p.key==="ArrowDown"?(h+1)%N.length:(h-1+N.length)%N.length,N[h]&&(N[h].classList.add("highlighted"),N[h].scrollIntoView({block:"nearest"}))):p.key==="Enter"?(p.preventDefault(),y&&h!==-1&&N[h]&&N[h].click()):p.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",p=>{a.contains(p.target)||i.classList.remove("active")})}),u(w,q).querySelectorAll(".dropdown-option").forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",a=>{const i=o.closest(".dropdown-wrapper").querySelector("input");let m=o.dataset.value;c.log("Option clicked:",[m,o.dataset]),m.includes(" ")&&!m.startsWith('"')?m=`"${m}"`:m.startsWith("&quot;")&&(m=m.replace(/&quot;/g,'"')),i.value=m,o.closest(".dropdown-options").classList.remove("active"),i.focus()})})}};q=new WeakMap,O=new WeakSet,Fe=async function(e,t,n){const s=d();e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);c.log("Saving settings:",[o]),r.set(s.customFontsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},He=function(){u(w,q).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},qe=async function(e,t){const n=d(),o=this.element.querySelectorAll("input[type=text]"),a=n.customFontsMenu.default;o.forEach(i=>{i.value=a[i.name]}),c.log("#onReset",[e,t,n.customFontsMenu.default])},S(w,O),S(w,q),z(w,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Le=w;const{ApplicationV2:et,HandlebarsApplicationMixin:tt}=foundry.applications.api;var Q,Be,We;const $=class $ extends tt(et){static get DEFAULT_OPTIONS(){return{id:d().leftControlsMenu.tag,actions:{redefine:R($,Q,We)},form:{handler:R($,Q,Be),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=d(),n={...r.get(t.leftControlsMenu.tag),default:{...t.leftControlsMenu.default},fields:{...t.leftControlsMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){const n=d(),s=r.get(n.leftControlsMenu.tag);c.log("_onRender",[e,t,s])}};Q=new WeakSet,Be=async function(e,t,n){const s=d();e.preventDefault(),e.stopPropagation();const o=foundry.utils.expandObject(n.object);(o.bottomBuffer===void 0||o.bottomBuffer==="")&&(o.bottomBuffer=s.leftControlsMenu.default.bottomBuffer);const a=r.get(s.leftControlsMenu.tag);a.hideFoundryLogo===void 0&&(o.hideFoundryLogo=s.leftControlsMenu.default.hideFoundryLogo),await r.set(s.leftControlsMenu.tag,o);const i=r.get(s.leftControlsMenu.tag);c.log("Saving settings:",[a,o,i]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},We=async function(e,t){const n=d(),o=this.element.querySelectorAll("input, select"),a=n.leftControlsMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.leftControlsMenu.default])},S($,Q),z($,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let ve=$;const{ApplicationV2:nt,HandlebarsApplicationMixin:ot}=foundry.applications.api;var _,je,$e;const V=class V extends ot(nt){static get DEFAULT_OPTIONS(){return{id:d().sceneNavMenu.tag,actions:{redefine:R(V,_,$e)},form:{handler:R(V,_,je),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=d(),n={...r.get(t.sceneNavMenu.tag),default:{...t.sceneNavMenu.default},fields:{...t.sceneNavMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return c.log("_prepareContext",[n,e]),n}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,c.log("_preparePartContext",[e,t]),t}_onRender(e,t){c.log("_onRender",[e,t])}};_=new WeakSet,je=async function(e,t,n){const s=d();let o=r.get(s.sceneNavMenu.tag),a=o.sceneNavEnabled;e.preventDefault(),e.stopPropagation();const i=foundry.utils.expandObject(n.object);await r.set(s.sceneNavMenu.tag,i),o=r.get(s.sceneNavMenu.tag),c.log("Saving settings...",[s.sceneNavMenu.tag,t,n.object,i,o]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o.sceneNavEnabled!=a&&location.reload()},$e=async function(e,t){const n=d(),o=this.element.querySelectorAll("input, select"),a=n.sceneNavMenu.default;o.forEach(i=>{i.value=a[i.name],i.type==="checkbox"&&(i.checked=a[i.name])}),c.log("#onReset",[e,t,n.sceneNavMenu.default])},S(V,_),z(V,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Re=V;function st(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Le,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:Me,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:ve,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Ce,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:Re,restricted:!1}}}var ee,te,ne,oe,se,ae,ie,k,Te,Ee,Ie,ke;const l=class l{static init(){const e=d(),t=r.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(T.RENDER_CAMERA_VIEWS,l.onRenderFloating),c.log("CameraUtil",[t]),l.onRenderFloating()):(Hooks.on(T.RENDER_CAMERA_VIEWS,l.onRenderPlain),l.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,a,i;const e=d(),t=r.get(e.cameraDockMenu.tag);(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),l.cameraContainer=document.querySelector("#camera-views .camera-container");const n=document.querySelector("#camera-views .user-controls"),s=document.querySelector("#camera-views .camera-grid");c.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),l.cameraContainer&&s&&n&&((a=l.cameraContainer)==null||a.insertBefore(n,s),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),l.makeDraggable(),l.makeResizeable(),l.resetPositionAndSize(),l.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(c.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const n=document.querySelector("#camera-views .user-controls .control-bar"),s=document.createElement("button");s.classList.add("crlngn-video-toggle"),s.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(s,n)}static makeDraggable(){var e;(e=l.cameraContainer)==null||e.addEventListener("mousedown",t=>{var o,a;const n=document.querySelector("body.crlngn-ui");if(c.log("mousedown",[t.target]),(o=t.target.parentNode)!=null&&o.classList.contains("volume-bar"))return;n==null||n.addEventListener("mousemove",R(l,k,Ee)),n==null||n.addEventListener("mouseup",R(l,k,Te));const s=U.getOffsetBottom(l.cameraContainer);l.isDragging=!0,L(l,ee,t.clientX-((a=l.cameraContainer)==null?void 0:a.offsetLeft)),L(l,te,window.innerHeight-t.clientY-s),t.stopPropagation()})}static makeResizeable(){if(l.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),l.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),l.isResizing=!0,L(l,ne,n.clientX),L(l,oe,n.clientY),L(l,ie,parseInt(getComputedStyle(l.cameraContainer).bottom)||0),L(l,se,l.cameraContainer.offsetWidth),L(l,ae,l.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",R(l,k,Ie)),e==null||e.addEventListener("mouseup",R(l,k,ke))})}}static resetPositionAndSize({x:e,y:t,w:n,h:s}={x:null,y:null,w:null,h:null}){const o=d(),a=r.get(o.cameraDockMenu.tag);if(!(!a.enableFloatingDock||!l.cameraContainer))if(!e&&!t&&!n&&!s){const i=a.dockPosX||0,m=a.dockPosY||0,p=a.dockWidth||0,y=a.dockHeight||0;l.cameraContainer.style.left=`${i}px`,l.cameraContainer.style.bottom=`${m}px`,l.cameraContainer.style.width=`${p}px`,l.cameraContainer.style.height=`${y}px`}else e&&(l.cameraContainer.style.left=`${e}px`),t&&(l.cameraContainer.style.bottom=`${t}px`),n&&(l.cameraContainer.style.width=`${n}px`),s&&(l.cameraContainer.style.height=`${s}px`)}};ee=new WeakMap,te=new WeakMap,ne=new WeakMap,oe=new WeakMap,se=new WeakMap,ae=new WeakMap,ie=new WeakMap,k=new WeakSet,Te=function(e){var s,o;const t=d(),n={...r.get(t.cameraDockMenu.tag)};if(l.isDragging){const a=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((s=l.cameraContainer)==null?void 0:s.style.left)||0,n.dockPosY=parseInt((o=l.cameraContainer)==null?void 0:o.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),r.set(t.cameraDockMenu.tag,n),a==null||a.removeEventListener("mousemove",R(l,k,Ee)),a==null||a.removeEventListener("mouseup",R(l,k,Te)),l.isDragging=!1,e.stopPropagation()}},Ee=function(e){if(l.isDragging&&(c.log("mousemove",[e.target.parentNode]),l.cameraContainer)){let t=e.clientX-u(l,ee),n=window.innerHeight-e.clientY-u(l,te);t+l.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-l.cameraContainer.offsetWidt),l.cameraContainer.style.left=`${t}px`,n+l.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-l.cameraContainer.offsetHeight),l.cameraContainer.style.bottom=`${n}px`}},Ie=function(e){if(!l.isResizing)return;const t=u(l,se)+(e.clientX-u(l,ne)),n=e.clientY-u(l,oe),s=u(l,ae)+n,o=u(l,ie)-n;l.cameraContainer.style.width=`${t}px`,l.cameraContainer.style.height=`${s}px`,l.cameraContainer.style.bottom=`${o}px`},ke=function(){var s,o,a,i,m,p;const e=d(),t={...r.get(e.cameraDockMenu.tag)},n=document.querySelector("body.crlngn-ui");l.isResizing=!1,n==null||n.removeEventListener("mousemove",R(l,k,Ie)),n==null||n.removeEventListener("mouseup",R(l,k,ke)),c.log("onStopResize",[(s=l.cameraContainer)==null?void 0:s.style.width,(o=l.cameraContainer)==null?void 0:o.style.height,(a=l.cameraContainer)==null?void 0:a.style.bottom]),t.dockWidth=parseInt(((i=l.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((m=l.cameraContainer)==null?void 0:m.style.height)||0),t.dockPosY=parseInt(((p=l.cameraContainer)==null?void 0:p.style.bottom)||0),r.set(fe.SETTINGS.cameraDockMenu.tag,t)},S(l,k),S(l,ee,0),S(l,te,0),z(l,"isDragging",!1),z(l,"cameraContainer"),z(l,"isResizing",!1),S(l,ne,0),S(l,oe,0),S(l,se,0),S(l,ae,0),S(l,ie,0);let H=l;const f=class f{static registerSettings(){const e=d();document.querySelector("body").classList.add(F),Object.entries(e).forEach(async s=>{const o=s[1];c.log("Registering... ",[s]);const a={name:o.label,hint:o.hint,default:o.default,type:o.propType,scope:o.scope,config:o.config,requiresReload:o.requiresReload||!1,onChange:i=>f.apply(o.tag,i)};o.choices&&(a.choices=o.choices),await game.settings.register(F,o.tag,a),f.get(o.tag)===void 0&&f.set(o.tag,o.default),c.log("registerSettings",[o.tag,f.get(o.tag)])}),Object.entries(st()).forEach(async s=>{const o=s[1],a={name:o.tag,label:o.label,hint:o.hint,icon:o.icon,type:o.propType,restricted:o.restricted};await game.settings.registerMenu(F,o.tag,a)}),Hooks.on(T.RENDER_SCENE_CONTROLS,f.applyLeftControlsSettings),Hooks.on(T.RENDER_PLAYERS_LIST,f.applyPlayersListSettings),Hooks.on(T.RENDER_HOTBAR,()=>{f.firstLoad&&(f.firstLoad=!1,f.applyHotBarCollapse()),f.applyHotBarSettings()}),f.applySceneNavPos(),f.applyChatStyles(),f.applyBorderColors(),f.applyCustomFonts(),f.applyLeftControlsSettings(),f.applyControlIconSize(),f.applyControlsBuffer()}static get(e,t=F){if(!e)return null;let n=!1;if(t===F)n=game.settings.get(t,e);else{let o=game.settings.storage.get("client")[`${t}.${e}`];o===void 0&&(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=o==null?void 0:o.value,c.log("GET Setting",[o,n])}return n}static set(e,t,n=F){if(!e)return!1;let s=game.settings.storage.get("client")[`${n}.${e}`];s||(s=game.settings.storage.get("world").getSetting(`${n}.${e}`)),c.log("Setting",[e,s]);try{game.settings.set(n,e,t)}catch{c.log("Unable to change setting",[e,s])}return!0}static apply(e,t=void 0){const n=d();switch(t===void 0&&(t=f.get(e)),c.log("SettingsUtil.apply",[e,t,f.get(e)]),e){case n.enableMacroLayout.tag:f.applyHotBarSettings();break;case n.collapseMacroBar.tag:f.applyHotBarCollapse();break;case n.autoHidePlayerList.tag:f.applyPlayersListSettings();break;case n.customFontsMenu.tag:f.applyCustomFonts(t);break;case n.leftControlsMenu.tag:f.applyLeftControlsSettings(),f.applyControlIconSize(),f.applyControlsBuffer();break;case n.cameraDockMenu.tag:f.applyCameraPosX(),f.applyCameraPosY(),f.applyCameraWidth(),f.applyCameraHeight();break;case n.chatMessagesMenu.tag:f.applyBorderColors(),f.applyChatStyles();break;case n.enforceDarkMode.tag:f.resetFoundryThemeSettings();break}}static applyBorderColors(){const e=d(),t=f.get(e.chatMessagesMenu.tag);t.borderColor===Y.playerColor.name?(document.querySelector("body").classList.add("player-chat-borders"),document.querySelector("body").classList.remove("roll-chat-borders")):t.borderColor===Y.rollType.name?(document.querySelector("body").classList.add("roll-chat-borders"),document.querySelector("body").classList.remove("player-chat-borders")):(document.querySelector("body").classList.remove("player-chat-borders"),document.querySelector("body").classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=d();f.get(e.chatMessagesMenu.tag).enableChatStyles&&document.querySelector("body").classList.add("crlngn-chat")}static applyHotBarSettings(){const e=d(),t=f.get(e.enableMacroLayout.tag),n=document.querySelector("#hotbar");!t&&n?n.classList.add("foundry-default"):n&&n.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=d();f.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=d(),t=f.get(e.leftControlsMenu.tag),n=document.querySelector("#ui-left"),s=document.querySelector("#ui-left #logo");t.autoHideSecondary?n.classList.add("auto-hide"):n.classList.remove("auto-hide"),t.hideFoundryLogo===void 0||t.hideFoundryLogo===!0?s.classList.remove("visible"):s.classList.add("visible")}static applyControlIconSize(){const e=d(),t=f.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),s=t.iconSize==de.small.name?de.small.size:de.regular.size;n.style.setProperty("--left-control-item-size",s)}static applyControlsBuffer(){const e=d(),t=f.get(e.leftControlsMenu.tag),n=document.querySelector("body.crlngn-ui"),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;n.style.setProperty("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,n;const e=d();c.log("applyPlayersListSettings",[document.querySelector("#players"),f.get(e.autoHidePlayerList.tag)]),f.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(n=document.querySelector("#players"))==null||n.classList.remove("auto-hide")}static applySceneNavPos(){const e=d();f.set(e.sceneNavPos.tag,0)}static applyCameraPosX(e){const t=d(),n=f.get(t.cameraDockMenu.tag),s=e||n.dockPosX;H.resetPositionAndSize({x:s})}static applyCameraPosY(e){const t=d(),n=f.get(t.cameraDockMenu.tag),s=e||n.dockPosY;H.resetPositionAndSize({y:s})}static applyCameraWidth(e){const t=d(),n=f.get(t.cameraDockMenu.tag),s=e||n.dockWidth;H.resetPositionAndSize({w:s})}static applyCameraHeight(e){const t=d(),n=f.get(t.cameraDockMenu.tag),s=e||n.dockHeight;H.resetPositionAndSize({h:s})}static applyCustomFonts(){const e=d(),t=f.get(e.customFontsMenu.tag);if(c.log("applyCustomFonts",[t]),t){const n=document.querySelector("body.crlngn-ui");n.style.setProperty("--crlngn-font-family",t.uiFont||e.customFontsMenu.default.uiFont||""),n.style.setProperty("--crlngn-font-titles",t.uiTitles||e.customFontsMenu.default.uiTitles||""),n.style.setProperty("--crlngn-font-journal-body",t.journalBody||t.journalBodyFont||e.customFontsMenu.default.journalBody||""),n.style.setProperty("--crlngn-font-journal-title",t.journalTitles||t.journalTitleFont||e.customFontsMenu.default.journalTitles||"")}}static resetFoundryThemeSettings(){const e=d(),t=game.settings.get("core","colorScheme"),n=f.get(e.enforceDarkMode.tag);c.log("resetFoundryThemeSettings",[t,n]),!t&&n&&game.settings.set("core","colorScheme","dark")}};z(f,"firstLoad",!0);let r=f;class c{static log(e="",t=[],n=!1){const s=d();try{const o=r.get(s.debugMode.tag);if(!(n||o))return;console.log(...ge,e,...t)}catch{console.log(...ge,e,...t)}}static warn(e="",t=[]){console.warn(...ge,e,...t)}static logError(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...ge,e)}}var v,G,B,X,K,le,ce,me,pe;const g=class g{static init(){const e=d(),t=document.querySelector("#ui-middle");let n=r.get(e.sceneNavMenu.tag);g.resetLocalVars();const s=U.isModuleOn("monks-scene-navigation");if(s&&n.sceneNavEnabled&&(game.user.isGM&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),t.classList.remove("crlngn-ui"),r.set(e.sceneNavMenu.tag,{...n,sceneNavEnabled:!1})),n=r.get(e.sceneNavMenu.tag),n.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}c.log("TopNavigation - init",[s]),s||(g.resetLocalVars(),g.addListeners(),c.log(T.RENDER_SCENE_NAV,[ui.nav,r.get(e.sceneNavCollapsed.tag)]),g.setNavPosition(0),g.placeNavButtons()),Hooks.on(T.RENDER_SCENE_NAV,()=>{const o=U.isModuleOn("monks-scene-navigation");c.log(T.RENDER_SCENE_NAV,[o]),o||(g.resetLocalVars(),c.log(T.RENDER_SCENE_NAV,[ui.nav,r.get(e.sceneNavCollapsed.tag)]),g.placeNavButtons(),g.setNavPosition(),g.addListeners())}),Hooks.on(T.COLLAPSE_SIDE_BAR,o=>{const a=U.isModuleOn("monks-scene-navigation");c.log(T.COLLAPSE_SIDE_BAR,["isMonksScenenNavOn",a]),a||g.placeNavButtons()}),Hooks.on(T.COLLAPSE_SCENE_NAV,(o,a)=>{r.set(e.sceneNavCollapsed.tag,a),c.log("NAV toggle",[o,a])}),Hooks.on(T.EXPAND_SCENE_NAV,(o,a)=>{r.set(e.sceneNavCollapsed.tag,!1),c.log("NAV expand",[o,!1])}),r.apply(e.sceneNavCollapsed.tag),window.addEventListener("resize",()=>{U.isModuleOn("monks-scene-navigation")||g.placeNavButtons()}),c.log("TopNavigation - init",[n.sceneNavEnabled]),n.sceneNavEnabled&&g.observeNavOffset()}static resetLocalVars(){L(g,v,document.querySelector("#navigation")),L(g,G,document.querySelector("#scene-list")),L(g,X,document.querySelector("#navigation .nav-item.is-root")),L(g,K,document.querySelector("#nav-toggle")),L(g,le,document.querySelector("#ui-left #controls"))}static addListeners(){var t,n;const e=d();(t=u(g,v))==null||t.addEventListener("mouseenter",()=>{const s=r.get(e.sceneNavMenu.tag);if(!r.get(e.sceneNavCollapsed.tag)||!(s!=null&&s.showNavOnHover))return;clearTimeout(u(this,B));const o=document.querySelector("#scene-list");o&&(o.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(n=u(this,v))==null||n.addEventListener("mouseleave",a=>{const o=r.get(e.sceneNavMenu.tag);if(!(!r.get(e.sceneNavCollapsed.tag)||!(o!=null&&o.showNavOnHover))){if(!a)var a=window.event;a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),L(this,B,setTimeout(()=>{clearTimeout(u(this,B)),L(this,B,null);const i=document.querySelector("#scene-list");i&&(i.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var i,m,p,y,N,h,E;g.resetLocalVars();const e=(i=u(this,v))==null?void 0:i.querySelectorAll("button.crlngn-nav"),t=((m=u(this,G))==null?void 0:m.scrollWidth)>=((p=u(this,v))==null?void 0:p.offsetWidth);if(c.log("placeNavButtons",[t,e,(y=u(this,G))==null?void 0:y.scrollWidth,(N=u(this,v))==null?void 0:N.offsetWidth]),!t||e.length>0)return;const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),n.addEventListener("click",u(this,me)),n.append(s);const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-right");const a=document.createElement("i");a.classList.add("fa"),a.classList.add("fa-chevron-right"),o.append(a),o.addEventListener("click",u(this,pe)),(h=u(this,v))==null||h.appendChild(n),(E=u(this,v))==null||E.appendChild(o)}static setNavPosition(e){var a,i;const t=d();if(!u(this,G))return;const n=e!==void 0?e:r.get(t.sceneNavPos.tag),s=((a=u(this,G))==null?void 0:a.querySelectorAll("li.nav-item"))||[],o=((i=s[n])==null?void 0:i.offsetLeft)*-1;u(this,G).style.marginLeft=o+"px",r.set(t.sceneNavPos.tag,n),c.log("setNavPosition",[e,n,s[n],o])}static observeNavOffset(){if(c.log("observeNavOffset A",[]),!u(g,v)||!u(g,le))return;const e=U.isModuleOn("monks-scene-navigation");c.log("observeNavOffset B",[]);function t(){const n=d();if(L(g,v,document.querySelector("#navigation")),!u(g,v))return;const s=r.get(n.sceneNavCollapsed.tag);s||u(g,v).offsetHeight;let o=e?0:u(g,v).offsetTop;const a=document.querySelector("body.crlngn-ui");a==null||a.style.setProperty("--crlngn-top-offset",o+"px"),c.log("TopNavigation updateCSSVars",[e,s,o,u(g,v).offsetTop,u(g,v).offsetHeight])}L(g,ce,new MutationObserver(t)),e||u(g,ce).observe(u(g,v).parentNode,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),t()}};v=new WeakMap,G=new WeakMap,B=new WeakMap,X=new WeakMap,K=new WeakMap,le=new WeakMap,ce=new WeakMap,me=new WeakMap,pe=new WeakMap,S(g,v),S(g,G),S(g,B),S(g,X),S(g,K),S(g,le),S(g,ce),S(g,me,e=>{var N,h,E,I,A;const t=d(),n=(N=u(g,K))==null?void 0:N.offsetWidth,s=U.isModuleOn("compact-scene-navigation")?(h=u(g,X))==null?void 0:h.offsetWidth:0,o=(E=u(g,G))==null?void 0:E.querySelector("li.nav-item:not(.is-root)"),a=((I=u(g,G))==null?void 0:I.querySelectorAll("li.nav-item"))||[],i=o.offsetWidth,m=r.get(t.sceneNavPos.tag)||0,p=Math.floor((((A=u(g,v))==null?void 0:A.offsetWidth)-(m===0?s:0)-n*2)/i);c.log("onNavLast",["currPos",m,p]);let y=m-p;y=y<0?0:y,c.log("onNavLast",["sceneCount",a.length,m,y]),g.setNavPosition(y)}),S(g,pe,e=>{var N,h,E,I,A;const t=d(),n=(N=u(g,K))==null?void 0:N.offsetWidth,s=U.isModuleOn("compact-scene-navigation")?(h=u(g,X))==null?void 0:h.offsetWidth:0,o=(E=u(g,G))==null?void 0:E.querySelector("li.nav-item:not(.is-root)"),a=((I=u(g,G))==null?void 0:I.querySelectorAll("li.nav-item:not(.is-root)"))||[],i=o.offsetWidth,m=r.get(t.sceneNavPos.tag)||0,p=Math.floor((((A=u(g,v))==null?void 0:A.offsetWidth)-(m===0?s:0)-n*2)/i);c.log("onNavLast",["currPos",m,p]);let y=m+p;y=y>a.length?a.length:y,g.setNavPosition(y)});let Ge=g;class at{static enrichCard(e,t){var o,a,i,m,p,y,N,h;const n=d(),s=r.get(n.chatMessagesMenu.tag);if(s.enableChatStyles){const E=((i=(a=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:a.activity)==null?void 0:i.type)||((y=(p=(m=e.flags)==null?void 0:m.dnd5e)==null?void 0:p.roll)==null?void 0:y.type)||"custom";let I=t.get?t.get(0):t;I.classList.add("crlngn"),I.classList.add(E),c.log("enrichCard",[s.borderColor,Y.playerColor.name,(N=e.author)==null?void 0:N.id]),s.borderColor===Y.playerColor.name&&((h=e.author)!=null&&h.id)?I.style.setProperty("border-color",`var(--user-color-${e.author.id})`):(s.borderColor,Y.none.name)}}}class Pe{static init(){Hooks.on(T.RENDER_PLAYERS_LIST,Pe.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),n=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",n+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var he,x,Ne,re,ue,ye;const M=class M{static init(){c.log("LeftControls - init",[]),Hooks.on(T.RENDER_SCENE_CONTROLS,M.initSceneControls),M.initSceneControls()}static resetLocalVars(){L(M,he,document.querySelector("#ui-top #navigation")),L(M,x,document.querySelector("#ui-left #controls")),L(M,Ne,document.querySelector("#ui-middle")),L(M,re,document.querySelector("#ui-left"))}static initSceneControls(){c.log("initSceneControls",[]),M.resetLocalVars(),M.observeControlsWidth()}static observeControlsWidth(){c.log("observeControlsWidth",[]),u(M,x)&&(L(M,ue,new ResizeObserver(e=>{M.updateCSSVars()},{box:"border-box"})),u(M,ue).observe(u(M,x)),M.updateCSSVars())}static updateCSSVars(){if(!u(M,x))return;let e=Number(u(M,re).offsetWidth),t=Number(u(M,x).offsetWidth),n=-e+t+24;if(c.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)){const s=document.querySelector("body.crlngn-ui");s==null||s.style.setProperty("--ui-controls-margin-left",n+"px")}L(M,ye,t)}};he=new WeakMap,x=new WeakMap,Ne=new WeakMap,re=new WeakMap,ue=new WeakMap,ye=new WeakMap,S(M,he),S(M,x),S(M,Ne),S(M,re),S(M,ue),S(M,ye);let ze=M;var Se;const D=class D{static init(){Hooks.once(T.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(F),c.log("Initiating module",[],!0),r.registerSettings(),Hooks.on(T.RENDER_CHAT_MESSAGE,u(D,Se))}),Hooks.once(T.READY,()=>{const e=d();var t=r.get("debug-mode");t&&(CONFIG.debug.hooks=!0);const n=CONFIG.fontFamilies||[],s=r.get("fonts","core");c.log("Core Ready",[CONFIG,n,s]),Ge.init(),H.init(),Pe.init(),ze.init(),r.get(e.chatMessagesMenu.tag).enableChatStyles&&D.addCSSLocalization(),r.resetFoundryThemeSettings()})}static addCSSLocalization(){const e=document.querySelector("body"),t="CRLNGN_UI.dnd5e.chatCard.buttons";e.style.setProperty("--crlngn-i18n-attack",game.i18n.localize(`${t}.attack`)),e.style.setProperty("--crlngn-i18n-damage",game.i18n.localize(`${t}.damage`)),e.style.setProperty("--crlngn-i18n-summons",game.i18n.localize(`${t}.summons`)),e.style.setProperty("--crlngn-i18n-healing",game.i18n.localize(`${t}.healing`)),e.style.setProperty("--crlngn-i18n-template",game.i18n.localize(`${t}.template`)),e.style.setProperty("--crlngn-i18n-consume",game.i18n.localize(`${t}.consume`)),e.style.setProperty("--crlngn-i18n-refund",game.i18n.localize(`${t}.refund`)),e.style.setProperty("--crlngn-i18n-macro",game.i18n.localize(`${t}.macro`)),e.style.setProperty("--crlngn-i18n-save-dc",game.i18n.localize(`${t}.savedc`))}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;D.keysPressed.indexOf(t)<0&&D.keysPressed.push(t),c.log("Keydown",[D.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,n=D.keysPressed.indexOf(t);n>=0&&D.keysPressed.splice(n,1),c.log("Keyup",[D.keysPressed])})}};Se=new WeakMap,z(D,"SETTINGS"),S(D,Se,(e,t)=>{c.log(T.RENDER_CHAT_MESSAGE,[e,t]),at.enrichCard(e,t)});let fe=D;fe.init();
//# sourceMappingURL=module.js.map
