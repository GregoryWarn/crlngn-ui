var Z=Object.defineProperty;var Q=d=>{throw TypeError(d)};var U=(d,e,t)=>e in d?Z(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var F=(d,e,t)=>U(d,typeof e!="symbol"?e+"":e,t),G=(d,e,t)=>e.has(d)||Q("Cannot "+t);var i=(d,e,t)=>(G(d,e,"read from private field"),t?t.call(d):e.get(d)),b=(d,e,t)=>e.has(d)?Q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(d):e.set(d,t),P=(d,e,t,o)=>(G(d,e,"write to private field"),o?o.call(d,t):e.set(d,t),t),H=(d,e,t)=>(G(d,e,"access private method"),t);const p={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews"},B="crlngn-ui",_="crlngn-ui",M=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],m={select:"select",checkbox:"checkbox",text:"text",number:"number"},h={client:"client",world:"world"},n={enableChatStyles:{tag:"enable-chat-styles",label:"Enable styles for chat messages",hint:"Adds style modifications to chat cards. When dark mode is selected on Foundry, makes chat cards dark as well. MOSTLY FOR DND5E - only partial support for other systems.",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!0},customFont:{tag:"custom-font",label:"Custom fonts",hint:`You can type the name of custom fonts loaded on Foundry core and they will be used throughout the interface. Names with spaces must be written with double quotes ("Font Name"). If the font doesn't load you haven't typed the name correctly, or the font was not found. Default value: "Work Sans", Arial, sans-serif`,propType:String,inputType:m.text,default:'"Work Sans", "Roboto", Arial, sans-serif',scope:h.client,config:!0,requiresReload:!0},debugMode:{tag:"debug-mode",label:"Debug Mode",hint:"Enable or disable debug messages on browser console",propType:Boolean,inputType:m.checkbox,default:!1,scope:h.client,config:!0},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:"Scene Navigation Collapsed",hint:"Current state of the scene navigation toggle. Is it collapsed?",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!1},sceneNavEnabled:{tag:"scene-nav-enabled",label:"Enable Scene Nav Styles",hint:"If you are having layout issues with a non-compatible module, you can disable my custom styles for Scene Navigation.",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!0},sceneNavPos:{tag:"scene-nav-pos",label:"Scene Navigation Position",hint:"Stores current position of navigation for reset when it's re-rendered",propType:Number,inputType:m.number,default:0,scope:h.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:"Enable macro resize",hint:"The module reduces the size of macro slots on the hotbar, and enlarges the numbers. Disable this setting to use default Foundry layout.",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!1},showSceneNavOnHover:{tag:"show-scene-nav-on-hover",label:"Show scene list on hover",hint:"If the scene navigation is collapsed, you can show it by hovering the mouse over the top of screen.",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!1},autoHideLeftControls:{tag:"auto-hide-secondary-controls",label:"Auto hide secondary controls",hint:"Enable to keep the secondary bar on the left controls hidden unless you hover on the region or click on an item",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"auto-hide-player-list",label:"Auto hide player list",hint:"Enable to keep the bottom left players list minimized, except when hovered",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:"Collapse Macro Bar",hint:"Enable to have the macro hotbar start minimized by default on world load.",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.client,config:!0,requiresReload:!1},enableCameraStyles:{tag:"enable-camera-styles",label:"Enable floating camera dock",hint:"Apply styles to camera dock, so video players are floating and can be placed anywhere on screen. You may still pop out individual videos and move them independently",propType:Boolean,inputType:m.checkbox,default:!0,scope:h.world,config:!0,requiresReload:!0},cameraDockPosX:{tag:"camera-dock-pos-x",label:"Horizontal position of camera dock",hint:"Position of camera dock on X axis when not minimized, from left. In absolute pixels. ",propType:Number,inputType:m.number,default:0,scope:h.client,config:!0},cameraDockPosY:{tag:"camera-dock-pos-y",label:"Vertical position of camera dock",hint:"Position of camera dock on Y axis when not minimized, from bottom. In absolute pixels. ",propType:Number,inputType:m.number,default:100,scope:h.client,config:!0}};class X{static isModuleOn(e){var o;const t=(o=game.modules)==null?void 0:o.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,o=e.offsetHeight,s=e.offsetParent;return(s?s.clientHeight:window.innerHeight)-(t+o)}}var T,O,w,$,z;const r=class r{static init(){a.get(n.enableCameraStyles.tag)?(Hooks.on(p.RENDER_CAMERA_VIEWS,r.onRenderFloating),u.log("CameraUtil",[a.get(n.enableCameraStyles.tag)]),r.onRenderFloating()):(Hooks.on(p.RENDER_CAMERA_VIEWS,r.onRenderPlain),r.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var o,s,c;(o=document.querySelector("#camera-views"))==null||o.classList.add("crlngn-ui"),r.cameraContainer=document.querySelector("#camera-views .camera-container");const e=document.querySelector("#camera-views .user-controls"),t=document.querySelector("#camera-views .camera-grid");u.log("CameraUtil.onRender",[a.get(n.cameraDockPosX.tag),a.get(n.cameraDockPosY.tag)]),r.resetPosition(),r.placeControlsToggle(),r.cameraContainer&&t&&e&&((s=r.cameraContainer)==null||s.insertBefore(e,t),(c=document.querySelector("#camera-views .camera-container"))==null||c.classList.add("visible")),r.makeDraggable()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(u.log("placeControlsToggle",[e,t]),t.length>0)return;const o=document.querySelector("#camera-views .user-controls .control-bar"),s=document.createElement("button");s.classList.add("crlngn-video-toggle"),s.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(s,o)}static makeDraggable(){var e;(e=r.cameraContainer)==null||e.addEventListener("mousedown",t=>{var c;const o=document.querySelector("body.crlngn-ui");if(u.log("mousedown",[t.target]),t.target.parentNode.classList.contains("volume-bar"))return;o==null||o.addEventListener("mousemove",H(r,w,z)),o==null||o.addEventListener("mouseup",H(r,w,$));const s=X.getOffsetBottom(r.cameraContainer);r.isDragging=!0,P(r,T,t.clientX-((c=r.cameraContainer)==null?void 0:c.offsetLeft)),P(r,O,window.innerHeight-t.clientY-s),t.stopPropagation()})}static resetPosition({x:e,y:t}={x:null,y:null}){const o=e||a.get(n.cameraDockPosX.tag),s=t||a.get(n.cameraDockPosY.tag);!o||!s||r.cameraContainer&&(r.cameraContainer.style.left=`${o}px`,r.cameraContainer.style.bottom=`${s}px`)}};T=new WeakMap,O=new WeakMap,w=new WeakSet,$=function(e){var t,o;if(r.isDragging){const s=document.querySelector("body.crlngn-ui");a.set(n.cameraDockPosX.tag,parseInt((t=r.cameraContainer)==null?void 0:t.style.left)),a.set(n.cameraDockPosY.tag,parseInt((o=r.cameraContainer)==null?void 0:o.style.bottom)),s==null||s.removeEventListener("mousemove",H(r,w,z)),s==null||s.removeEventListener("mouseup",H(r,w,$)),r.isDragging=!1,e.stopPropagation()}},z=function(e){r.isDragging&&(u.log("mousemove",[e.target.parentNode]),r.cameraContainer&&(r.cameraContainer.style.left=`${e.clientX-i(r,T)}px`,r.cameraContainer.style.bottom=`${window.innerHeight-e.clientY-i(r,O)}px`))},b(r,w),b(r,T,0),b(r,O,0),F(r,"isDragging",!1),F(r,"cameraContainer");let I=r;class a{static registerSettings(){document.querySelector("body").classList.add(_),Object.entries(n).forEach(async o=>{const s=o[1];u.log("Registering... ",[o]);const c={name:s.label,hint:s.hint,default:s.default,type:s.propType,scope:s.scope,config:s.config,requiresReload:s.requiresReload||!1,onChange:g=>a.apply(s.tag,g)};await game.settings.register(B,s.tag,c),a.get(s.tag)===void 0&&a.set(s.tag,s.default),u.log("registerSettings",[s.tag,a.get(s.tag)])}),Hooks.on(p.RENDER_SCENE_CONTROLS,a.applyLeftControlsSettings),Hooks.on(p.RENDER_PLAYERS_LIST,a.applyPlayersListSettings),Hooks.on(p.RENDER_HOTBAR,()=>{a.applyHotBarSettings(),a.applyHotBarCollapse()}),a.applySceneNavSettings(),a.get(n.enableChatStyles.tag)&&document.querySelector("body").classList.add("crlngn-chat");const t=a.get(n.customFont.tag);t&&document.querySelector("body.crlngn-ui").style.setProperty("--crlngn-font-family",t)}static get(e,t=B){if(!e)return null;let o=!1;if(t===B)o=game.settings.get(t,e);else{let c=game.settings.storage.get("client")[`${t}.${e}`];c===void 0&&(c=game.settings.storage.get("world").getSetting(`${t}.${e}`)),o=c==null?void 0:c.value,u.log("GET Setting",[c,o])}return o}static set(e,t,o=B){if(!e)return!1;let s=game.settings.storage.get("client")[`${o}.${e}`];s||(s=game.settings.storage.get("world").getSetting(`${o}.${e}`)),u.log("Setting",[e,s]);try{game.settings.set(o,e,t)}catch{u.log("Unable to change setting",[e,s])}return!0}static apply(e,t=void 0){switch(t===void 0&&(t=a.get(e)),u.log("SettingsUtil.apply",[e,t,a.get(e)]),e){case n.enableMacroLayout.tag:a.applyHotBarSettings();break;case n.collapseMacroBar.tag:a.applyHotBarCollapse();break;case n.autoHideLeftControls.tag:a.applyLeftControlsSettings();break;case n.autoHidePlayerList.tag:a.applyPlayersListSettings();break;case n.cameraDockPosX:a.applyCameraPos();break;case n.cameraDockPosY:a.applyCameraPos();break}}static applySettings(){}static applyHotBarSettings(){const e=a.get(n.enableMacroLayout.tag),t=document.querySelector("#hotbar");!e&&t?t.classList.add("foundry-default"):t&&t.classList.remove("foundry-default")}static applyHotBarCollapse(){a.get(n.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(){const e=a.get(n.autoHideLeftControls.tag),t=document.querySelector("#ui-left");e?t.classList.add("auto-hide"):t.classList.remove("auto-hide")}static applyPlayersListSettings(){var e,t;u.log("applyPlayersListSettings",[document.querySelector("#players"),a.get(n.autoHidePlayerList.tag)]),a.get(n.autoHidePlayerList.tag)?(e=document.querySelector("#players"))==null||e.classList.add("auto-hide"):(t=document.querySelector("#players"))==null||t.classList.remove("auto-hide")}static applySceneNavSettings(){a.set(n.sceneNavPos.tag,0)}static applyCameraPos(){const e=a.get(n.cameraDockPosX.tag),t=a.get(n.cameraDockPosY.tag);I.resetPosition({x:e,y:t})}}class u{static log(e="",t=[],o=!1){try{const s=a.get(n.debugMode.tag);if(!(o||s))return;console.log(...M,e,...t)}catch{console.log(...M,e,...t)}}static warn(e="",t=[]){console.warn(...M,e,...t)}static logError(e,t){var o;t.ui&&((o=ui.notifications)==null||o.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...M,e)}}var v,E,D,q,x,W,Y;const l=class l{static init(){const e=document.querySelector("#ui-middle");if(a.get(n.sceneNavEnabled.tag)&&e)e.classList.add("crlngn-ui");else if(e){e.classList.remove("crlngn-ui");return}l.addListeners(),u.log(p.RENDER_SCENE_NAV,[ui.nav,a.get(n.sceneNavCollapsed.tag)]),l.setNavPosition(0),l.placeNavButtons(),a.get(n.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand(),Hooks.on(p.RENDER_SCENE_NAV,()=>{l.addListeners(),u.log(p.RENDER_SCENE_NAV,[ui.nav,a.get(n.sceneNavCollapsed.tag)]),l.setNavPosition(),l.placeNavButtons(),a.get(n.sceneNavCollapsed.tag)?ui.nav.collapse():ui.nav.expand()}),Hooks.on(p.COLLAPSE_SIDE_BAR,t=>{l.placeNavButtons()}),Hooks.on(p.COLLAPSE_SCENE_NAV,(t,o)=>{a.set(n.sceneNavCollapsed.tag,o),u.log("NAV toggle",[t,o])}),Hooks.on(p.EXPAND_SCENE_NAV,(t,o)=>{a.set(n.sceneNavCollapsed.tag,!1),u.log("NAV expand",[t,!1])}),a.apply(n.sceneNavCollapsed.tag)}static addListeners(){var e,t;P(this,v,document.querySelector("#navigation")),P(this,E,document.querySelector("#scene-list")),P(this,q,document.querySelector("#navigation .nav-item.is-root")),P(this,x,document.querySelector("#nav-toggle")),(e=i(this,v))==null||e.addEventListener("mouseenter",()=>{if(!a.get(n.sceneNavCollapsed.tag)||!a.get(n.showSceneNavOnHover.tag))return;clearTimeout(i(this,D));const o=document.querySelector("#scene-list");o.style.display="flex",document.querySelector("#navigation").classList.remove("collapsed")}),(t=i(this,v))==null||t.addEventListener("mouseleave",s=>{if(!(!a.get(n.sceneNavCollapsed.tag)||!a.get(n.showSceneNavOnHover.tag))){if(!s)var s=window.event;s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation(),P(this,D,setTimeout(()=>{clearTimeout(i(this,D)),P(this,D,null);const c=document.querySelector("#scene-list");c.style.display="none",document.querySelector("#navigation").classList.add("collapsed")},700))}})}static placeNavButtons(){var y,S,f,L,k,R,N;const e=(y=i(this,v))==null?void 0:y.querySelectorAll("button.crlngn-nav"),t=((S=i(this,E))==null?void 0:S.scrollWidth)>=((f=i(this,v))==null?void 0:f.offsetWidth);if(u.log("placeNavButtons",[t,e,(L=i(this,E))==null?void 0:L.scrollWidth,(k=i(this,v))==null?void 0:k.offsetWidth]),!t||e.length>0)return;const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-left");const s=document.createElement("i");s.classList.add("fa"),s.classList.add("fa-chevron-left"),o.addEventListener("click",i(this,W)),o.append(s);const c=document.createElement("button");c.classList.add("crlngn-nav"),c.classList.add("ui-nav-right");const g=document.createElement("i");g.classList.add("fa"),g.classList.add("fa-chevron-right"),c.append(g),c.addEventListener("click",i(this,Y)),(R=i(this,v))==null||R.appendChild(o),(N=i(this,v))==null||N.appendChild(c)}static setNavPosition(e){var c,g;const t=e!==void 0?e:a.get(n.sceneNavPos.tag),o=((c=i(this,E))==null?void 0:c.querySelectorAll("li.nav-item"))||[],s=((g=o[t])==null?void 0:g.offsetLeft)*-1;i(this,E).style.marginLeft=s+"px",a.set(n.sceneNavPos.tag,t),u.log("setNavPosition",[e,t,o[t],s])}};v=new WeakMap,E=new WeakMap,D=new WeakMap,q=new WeakMap,x=new WeakMap,W=new WeakMap,Y=new WeakMap,b(l,v),b(l,E),b(l,D),b(l,q),b(l,x),b(l,W,e=>{var L,k,R,N,A;const t=(L=i(l,x))==null?void 0:L.offsetWidth,o=X.isModuleOn("compact-scene-navigation")?(k=i(l,q))==null?void 0:k.offsetWidth:0,s=(R=i(l,E))==null?void 0:R.querySelector("li.nav-item:not(.is-root)"),c=((N=i(l,E))==null?void 0:N.querySelectorAll("li.nav-item"))||[],g=s.offsetWidth,y=a.get(n.sceneNavPos.tag)||0,S=Math.floor((((A=i(l,v))==null?void 0:A.offsetWidth)-(y===0?o:0)-t*2)/g);u.log("onNavLast",["currPos",y,S]);let f=y-S;f=f<0?0:f,u.log("onNavLast",["sceneCount",c.length,y,f]),l.setNavPosition(f)}),b(l,Y,e=>{var L,k,R,N,A;const t=(L=i(l,x))==null?void 0:L.offsetWidth,o=X.isModuleOn("compact-scene-navigation")?(k=i(l,q))==null?void 0:k.offsetWidth:0,s=(R=i(l,E))==null?void 0:R.querySelector("li.nav-item:not(.is-root)"),c=((N=i(l,E))==null?void 0:N.querySelectorAll("li.nav-item:not(.is-root)"))||[],g=s.offsetWidth,y=a.get(n.sceneNavPos.tag)||0,S=Math.floor((((A=i(l,v))==null?void 0:A.offsetWidth)-(y===0?o:0)-t*2)/g);u.log("onNavLast",["currPos",y,S]);let f=y+S;f=f>c.length?c.length:f,l.setNavPosition(f)});let K=l;class ee{static enrichCard(e,t){var o,s,c,g,y,S;if(a.get(n.enableChatStyles.tag)){const f=((c=(s=(o=e.flags)==null?void 0:o.dnd5e)==null?void 0:s.activity)==null?void 0:c.type)||((S=(y=(g=e.flags)==null?void 0:g.dnd5e)==null?void 0:y.roll)==null?void 0:S.type)||"custom",L=t.get(0);L.classList.add("crlngn"),L.classList.add(f)}}}class J{static init(){Hooks.on(p.RENDER_PLAYERS_LIST,J.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector('aside#players h3[aria-label="Players"]'),o=e.offsetHeight;document.querySelector("body.crlngn-ui").style.setProperty("--players-list-height",o+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var V;const C=class C{static init(){Hooks.once(p.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add("crlngn-ui"),u.log("Initiating module",[],!0),a.registerSettings(),Hooks.on(p.RENDER_CHAT_MESSAGE,i(C,V))}),Hooks.once(p.READY,()=>{var e=a.get("debug-mode");e&&(CONFIG.debug.hooks=!0),u.log("Core Ready",[]),K.init(),I.init(),J.init()})}static setupKeyListeners(){window.addEventListener("keydown",e=>{const t=e.key;C.keysPressed.indexOf(t)<0&&C.keysPressed.push(t),u.log("Keydown",[C.keysPressed])}),window.addEventListener("keyup",e=>{const t=e.key,o=C.keysPressed.indexOf(t);o>=0&&C.keysPressed.splice(o,1),u.log("Keyup",[C.keysPressed])})}};V=new WeakMap,b(C,V,(e,t)=>{u.log(p.RENDER_CHAT_MESSAGE,[e,t]),ee.enrichCard(e,t)});let j=C;j.init();
//# sourceMappingURL=module.js.map
